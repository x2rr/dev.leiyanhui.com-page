<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Vnc on 小类随手记</title><link>https://dev.leiyanhui.com/categories/vnc/</link><description>Recent content in Vnc on 小类随手记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Fri, 07 Jul 2023 11:02:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/categories/vnc/index.xml" rel="self" type="application/rss+xml"/><item><title>docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc</title><link>https://dev.leiyanhui.com/docker/debian-desktop/</link><pubDate>Fri, 07 Jul 2023 11:02:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop/</guid><description>&lt;p>debian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp&lt;/p>
&lt;p>没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。&lt;/p>
&lt;h2 id="本文说明">本文说明
&lt;/h2>&lt;p>joyanhui/debian-i3-xrdp-novnc 使用docker 和 lxc/lxd ，本文可能会滞后最新，更多问题问题请查看docker和lxd的使用手册。&lt;br>
如果您没有使用过i3 openbox lxc等软件，务必仔细阅读本文，至少会让你熟悉了解相关操作。&lt;/p>
&lt;h2 id="特性">特性
&lt;/h2>&lt;p>轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。&lt;br>
是一个完整的操作系统，systemd可正常使用，甚至可以再次安装docker&lt;br>
vnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3 &lt;br>
采用docker 运行lxd的方法 alpine3.18.2 =&amp;gt; lxd &lt;br>
集成软件：&lt;/p>
&lt;ul>
&lt;li>debian 12 bookworm&lt;/li>
&lt;li>i3 openbox polybar rofi alacritty dunst zsh firefox-esr thunar gvfs gvfs-backends gvfs-fuse sshfs&lt;/li>
&lt;li>tigervnc&lt;/li>
&lt;li>novnc websockify&lt;/li>
&lt;li>ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji 微软雅黑&lt;/li>
&lt;li>服务管理支持：systemd supervisor&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-next/" target="_blank" rel="noopener"
>更新记录和计划&lt;/a> &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-exec/" target="_blank" rel="noopener"
>公开的搭建过程&lt;/a> &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/" target="_blank" rel="noopener"
>如果你使用的旧版请查看旧版说明&lt;/a>&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name dt --hostname dt --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 3389:3389 -p 222:22 -p 2222:2222 -p 8080:8080 -p 5900-5905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> joyanhui/debian-i3-xrdp-novnc sh /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900 ，222 是alpine容器的ssh端口&lt;/p>
&lt;blockquote>
&lt;p>20230707 之前版本是纯docker实现，不包含浏览器和文件管理器，之后的版本是lxd lxc实现 并带firefox-esr 和thunar 网络挂载 并支持 systemd。&lt;/p>&lt;/blockquote>
&lt;h2 id="默认账号-以及相关用户名和密码">默认账号 以及相关用户名和密码
&lt;/h2>&lt;p>总共有三个密码：&lt;/p>
&lt;h3 id="debian的系统用户">debian的系统用户
&lt;/h3>&lt;p>用户名：yanhui 密码：1 （只有一个数字1）&lt;br>
这个用户名密码，同时对应debian的 ssh xrdp 的默认账号 对应默认端口：2222 和 3389
debian默认的root 没设置密码，禁止ssh登陆&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd yanhui
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="debian的vnc的密码">debian的vnc的密码
&lt;/h3>&lt;p>vnc 密码：111111（六个数字1）&lt;br>
此密码用于vnc 和novnc登陆 默认用户yanhui的桌面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">su yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vncpasswd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="alpine的root账户">alpine的root账户
&lt;/h3>&lt;p>用户名 root 密码:1（只有一个数字1）&lt;br>
此密码同时左右 alpine的ssh登陆密码，对应默认端口：222&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>部署完毕后，务必第一时间修改密码！&lt;/p>&lt;/blockquote>
&lt;h2 id="为什么选择debian-而不是arch--nixos">为什么选择debian 而不是arch nixos
&lt;/h2>&lt;p>因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 &lt;br>
放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。&lt;br>
arch和nixos一些其他缺点这里不多说。&lt;br>
其实最主要的是 不折腾 稳如老狗，以及 个人喜好 以及和服务器端的环境一致性&lt;/p>
&lt;h2 id="为什么用docker-套lxd">为什么用docker 套lxd
&lt;/h2>&lt;p>不直接用lxd 是因为部分环境不支持，另外docker的分层commit 更方便。 更可以推送到自己的私有regditer&lt;br>
不直接用docker 是因为 docker 限制太多，不算是太完整的系统，lxc lxd 是一个完整的系统。&lt;br>
所以20230707版本以后 改为 docker运行alpine 然后在alpine内用lxd运行 debian12&lt;br>
alpine是一个只有3m大小的linux系统，在用lxd嵌套后，比旧方案多占用30-60M内存，80M硬盘，但是带来的是一个完整的linux体验，并且性能吊打虚拟机模式！&lt;/p>
&lt;h2 id="为什么选择i3-和openbox-怎么换其他桌面">为什么选择i3 和openbox 怎么换其他桌面
&lt;/h2>&lt;p>因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。
因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。&lt;br>
而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面&lt;/p>
&lt;h3 id="更换为其他桌面的方法">更换为其他桌面的方法
&lt;/h3>&lt;p>例如，要换成 xfce4首先安装&lt;code>sudo apt install xfce4&lt;/code> ,然后修改 &lt;code>~/.vnc/xstartup &lt;/code> 可以更换vnc和novnc的桌面。&lt;br>
修改用户目录下的 &lt;code>~/.xsession&lt;/code> 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:&lt;code>sudo apt purge i3&lt;/code> or &lt;code>sudo apt purge openbox&lt;/code>&lt;/p>
&lt;h2 id="novnc-vnc为什么是黑屏">novnc vnc为什么是黑屏
&lt;/h2>&lt;p>就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 也没有壁纸，右键 有惊喜！&lt;/p>
&lt;h2 id="怎么启动shell-和常见快捷键">怎么启动shell 和常见快捷键
&lt;/h2>&lt;p>基本是i3 的默认快捷键&lt;br>
点屏幕顶部的 Apps&amp;gt; 系统 &amp;gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）&lt;br>
如果是rdp远程桌面下，按下键盘 ： win+回车 &lt;br>
启动管理器（开始菜单） :win d&lt;br>
程序切换 alt+tab
修改窗口大小：按住win 再按住 鼠标右键 来回拖动&lt;br>
修改窗口位置：按住win 再按住 鼠标左键 来回拖动&lt;br>
关闭软件：win shift q&lt;br>
注销：win shift e&lt;br>
更多使用方法 自己看一下i3 使用说明&lt;/p>
&lt;h2 id="如何从宿主机器直接进去debian-shell">如何从宿主机器直接进去debian shell
&lt;/h2>&lt;p>两步&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 进入docker alpine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 进入lxc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 或者直接
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>第一个dt 是docker的容器名称，第二个 是lxc 的容器名称&lt;br>
你也可以在登陆 vnc/xrdp后直接运行&lt;/p>
&lt;h2 id="怎么装中文输入法">怎么装中文输入法
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-chinese-addons
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>openbox 需要右键手动加载，其他现代的桌面系统，包括i3。安装完成后，注销重新登录一次桌面，会自动加载，拼音输入法可导入搜狗细胞词库，具体自己研究。&lt;br>
默认中英文切换快捷键是 ctrl+空格 ，如果你在非全屏的xrdp 或novnc /vnc 下切换，注意和本地的输入法快捷键冲突问题。&lt;/p>
&lt;h2 id="怎么新建用户怎么删除默认用户">怎么新建用户怎么删除默认用户
&lt;/h2>&lt;h3 id="新建用户">新建用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo adduser YouName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -aG sudo YouName
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="新用户vnc密码">新用户vnc密码
&lt;/h4>&lt;p>ssh 或者 xrdp 登陆新用户后，运行 &lt;code>vncpasswd&lt;/code>&lt;/p>
&lt;h4 id="更新-vnc服务">更新 vnc服务
&lt;/h4>&lt;p>修改里面的用户名&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/systemd/system/vncserver@0.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/supervisor/conf.d/novnc.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除默认用户">删除默认用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo deluser yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="怎么修改密码">怎么修改密码
&lt;/h2>&lt;h3 id="用户密码">用户密码
&lt;/h3>&lt;p>命令：&lt;code>passwd&lt;/code>&lt;/p>
&lt;h3 id="vnc密码">vnc密码
&lt;/h3>&lt;p>命令：&lt;code>vncpasswd .vnc/passwd&lt;/code> ，需要重启vnc服务，查看 &lt;code> systemctrl restart vncserver@0&lt;/code>&lt;/p>
&lt;h2 id="x11转发模式如何使用输入法">x11转发模式如何使用输入法
&lt;/h2>&lt;p>修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 &lt;code>fcitx5&amp;amp;&lt;/code> 再执行对应的软件。&lt;/p>
&lt;h2 id="x11-转发模式部分软件很卡">x11 转发模式部分软件很卡
&lt;/h2>&lt;p>没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。&lt;/p>
&lt;h2 id="novnc默认地址">novnc默认地址
&lt;/h2>&lt;p>http://你的ip:8080/ 其中端口docker内部默认使用8080，外部端口是你自己映射的。&lt;/p>
&lt;h2 id="novnc如何走https">novnc如何走https
&lt;/h2>&lt;p>建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。&lt;/p>
&lt;h2 id="vnc连不上">vnc连不上
&lt;/h2>&lt;p>此问题只在 20230707之前版本存在&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm /tmp/.X0-lock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器&lt;/p>
&lt;h2 id="天气预报出错以及如何修改天气预报城市">天气预报出错以及如何修改天气预报城市
&lt;/h2>&lt;p>&lt;code>~/.config/polybar/weather-plugin.py&lt;/code> 这个文件
天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。&lt;br>
你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）&lt;br>
&lt;code>https://api.openweathermap.org/data/2.5/weather?id=1793724&amp;amp;appid=440b47a5ffbc5421e4a9befcbc4d635b&amp;amp;units=Metric&amp;amp;lang=zh_cn&lt;/code>&lt;br>
你如果不想用，直接在 polybar的配置文件里面删掉即可。&lt;/p>
&lt;h2 id="如何调音量">如何调音量
&lt;/h2>&lt;p>在i3配置文件里面修改&lt;br>
调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。&lt;br>
进阶用法，自己配置i3和polybar&lt;/p>
&lt;h2 id="vnc-和xrdp-桌面不同步">vnc 和xrdp 桌面不同步
&lt;/h2>&lt;p>是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。&lt;/p>
&lt;h2 id="novnc-网页访问按键失灵乱跳">noVNC 网页访问按键失灵乱跳
&lt;/h2>&lt;p>1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法&lt;br>
2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。&lt;/p>
&lt;h2 id="xrdp-登陆后桌面灰色无显示">xrdp 登陆后桌面灰色无显示
&lt;/h2>&lt;p>长期无操作后，锁屏了而已。依次盲输入密码然后按下回车 验证成功后 即可登入桌面。&lt;br>
如果你不需要锁屏功能，可以删掉 &lt;code>sudo apt purge i3lock&lt;/code>&lt;/p>
&lt;h2 id="没声音或者--顶部音量不显示">没声音或者 顶部音量不显示
&lt;/h2>&lt;h3 id="vnc-和x11-没声音">vnc 和x11 没声音
&lt;/h3>&lt;p>vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp&lt;/p>
&lt;h3 id="xrdp的polybar-偶尔不显示音量">xrdp的polybar 偶尔不显示音量
&lt;/h3>&lt;p>这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。&lt;br>
临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">killall pulseaudio &amp;amp;&amp;amp; pulseaudio &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh .config/polybar/polybar_run.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>20230707 以后的版本，可以在polybar顶部菜单用依次点击： APPS &amp;gt; polybar &amp;gt; 重启声音 APPS &amp;gt; polybar &amp;gt; 重载polybar&lt;/p>
&lt;h2 id="如何修改分辨率">如何修改分辨率
&lt;/h2>&lt;h3 id="vnc-novnc">vnc novnc
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/systemd/system/vncserver@0.service # geometry 后面的参数是vnc的分辨率
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="xrdp">xrdp
&lt;/h3>&lt;p>xrdp的分辨率 由你的客户端 发起的时候配置&lt;/p>
&lt;h2 id="openbox的壁纸点好多次才换一张">openbox的壁纸点好多次才换一张
&lt;/h2>&lt;p>壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。&lt;/p>
&lt;h2 id="安装常用软件">安装常用软件
&lt;/h2>&lt;p>点屏幕左上角 APPS &amp;gt; 系统 &amp;gt; 终端 输入 &lt;code>sudo apt install &amp;lt;包名&amp;gt;&lt;/code>命令；启动软件 APPS &amp;gt; 系统 &amp;gt; &lt;code>rofi-run&lt;/code> 选择软件或者输入软件名称&lt;br>
或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install firefox-esr # 火狐 20230707以后版本自带
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install nemo nautilus # 文件管理器 任选一个 20230707以后版本自带 thunar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># todesk 中文不显示 需要另外处理，这里不多说
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://newdl.todesk.com/linux/todesk-v4.3.1.0-amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install ./todesk-v4.3.1.0-amd64.deb #sudo apt purge todesk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 远程其他电脑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install freerdp2-x11 #xfreerdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install remmina # 可选包 remmina-plugin-x2go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># neofetch 命令行装b工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install neofetch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># flameshot 截图工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install flameshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># linuxqq
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://dldir1.qq.com/qqfile/qq/QQNT/ad5b5393/linuxqq_3.1.2-13107_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install ./linuxqq_3.1.2-13107_amd64.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="如何访问文件">如何访问文件
&lt;/h2>&lt;h3 id="thunar--方式">thunar 方式
&lt;/h3>&lt;p>20230707以后版本集成了thunar 和smb sshfs webdav访问组件。
打开 thunar ，地址栏输入：&lt;code>smb://10.1.1.100&lt;/code> 或者&lt;code>dav://10.1.1.100&lt;/code> 即可&lt;/p>
&lt;h3 id="文件挂载">文件挂载
&lt;/h3>&lt;p>参考后文 目录映射 方法&lt;/p>
&lt;h2 id="不喜欢默认用户的shell">不喜欢默认用户的shell
&lt;/h2>&lt;p>默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 &lt;br>
然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可&lt;/p>
&lt;h2 id="pve-lxc-ct-或者docker宿主机-目录映射-端口-和显卡等">pve lxc ct 或者docker宿主机 目录映射 端口 和显卡等
&lt;/h2>&lt;h3 id="pve-硬盘到lxc">pve 硬盘到lxc
&lt;/h3>&lt;p>请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/&lt;/p>
&lt;h3 id="docker宿主机-目录映射">docker宿主机 目录映射
&lt;/h3>&lt;p>默认 映射 /mnt/sda1 到最终的debian12 &lt;br>
如果要映射其他目录，先映射到docker内，确保早docker内可以访问的情况下在docker内如下命令映射到 lxc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc config device add dt sda1 disk source=/mnt/sda1 path=/mnt/sda1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>更多使用方法，以及权限问题，请参考lxd手册&lt;/p>
&lt;h3 id="端口">端口
&lt;/h3>&lt;p>先映射端口到docker,而后在docker内 用如下命令映射到lxc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc config device add dt demoName proxy listen=tcp:0.0.0.0:8888 connect=tcp:127.0.0.1:8888
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>更多使用方法，请参考lxd手册&lt;/p>
&lt;h3 id="如何使用显卡加速">如何使用显卡加速
&lt;/h3>&lt;p>以nvidia为例在创建docker的时候 把显卡挂进去即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run ....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia0:/dev/nvidia0 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidiactl:/dev/nvidiactl \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia-uvm:/dev/nvidia-uvm \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ....
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="pve-群晖--unraid-esxi-下的安装方式">pve 群晖 unraid esxi 下的安装方式
&lt;/h3>&lt;p>pve下，你可以用lxc/vm 运行docker的方式运行，也可以，从本镜像内提取lxc模板直接导入到 CT容器。
其他系统 建议直接docker运行&lt;/p>
&lt;h2 id="目录和文件说明">目录和文件说明
&lt;/h2>&lt;p>&lt;code>/boot.sh&lt;/code> 在docker内 其他文件在 debian内&lt;/p>
&lt;h3 id="启动文件">启动文件
&lt;/h3>&lt;h4 id="bootsh">boot.sh
&lt;/h4>&lt;p>&lt;code>/boot.sh&lt;/code> 在docker内 用于启动alpine的 ssh 和 lxd/lxc 的debian&lt;/p>
&lt;h4 id="systemd-和-supervisord">systemd 和 supervisord
&lt;/h4>&lt;p>systemd 和 supervisord 在 lxc的debian内&lt;br>
novnc使用supervisord启动:&lt;code>/etc/supervisor/conf.d/&lt;/code>，vnc和其他服务使用systemd启动：&lt;code>/etc/systemd/system/&lt;/code>&lt;/p>
&lt;h3 id="i3-配置文件">i3 配置文件
&lt;/h3>&lt;p>/home/yanhui/.config/i3/config&lt;/p>
&lt;h3 id="openbox配置文件">openbox配置文件
&lt;/h3>&lt;p>/home/yanhui/.config/openbox/menu.xml #右键菜单 &lt;br>
feh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本&lt;/p>
&lt;h3 id="壁纸目录">壁纸目录
&lt;/h3>&lt;p>i3配置文件调用feh随机选
/home/yanhui/.config/i3/bg/&lt;/p>
&lt;h3 id="polybar">polybar
&lt;/h3>&lt;ul>
&lt;li>/home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单&lt;/li>
&lt;li>/home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本&lt;/li>
&lt;li>/home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。&lt;/li>
&lt;/ul>
&lt;h3 id="rofi">rofi
&lt;/h3>&lt;p>/home/yanhui/.config/rofi/config.rasi&lt;/p>
&lt;h3 id="dunst">dunst
&lt;/h3>&lt;p>/home/yanhui/.config/dunst/dunstrc&lt;/p>
&lt;h3 id="alacritty">alacritty
&lt;/h3>&lt;p>/home/yanhui/.config/alacritty/alacritty.yml&lt;/p>
&lt;h3 id="zsh">zsh
&lt;/h3>&lt;p>/home/yanhui/.zshrc
/home/yanhui/.oh-my-zsh&lt;/p></description></item><item><title>joyanhui/debian-i3-xrdp-novnc 公开的搭建过程</title><link>https://dev.leiyanhui.com/docker/debian-desktop-exec/</link><pubDate>Fri, 07 Jul 2023 00:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-exec/</guid><description>&lt;p>未使用Dockerfile 是因为搭建过程略微复杂，如果另外打包出来rootfs 也没有什么意义。所以干脆公开过程。&lt;/p>
&lt;p>本文可能存在滞后，未经过严格整理和核对,所有历史命令，你在 下述文件中均可以看到&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /root/.bash_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /home/yanhui/.bash_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /home/yanhui/.zsh_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt cat /root/.ash_history
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>宿主用alpine&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name &lt;span class="nb">test&lt;/span> --hostname &lt;span class="nb">test&lt;/span> --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 333:3389 -p 2221:2222 -p 2222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> alpine:3.18.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it &lt;span class="nb">test&lt;/span> /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apk/repositories
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add tzdata
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Asia/Shanghai&amp;#34;&lt;/span> &amp;gt; /etc/timezone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk del tzdata
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add openssh lxd lxd-client lxcfs dbus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&amp;#39;&lt;/span> /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;session optional pam_cgfs.so -c freezer,memory,name=systemd,unified&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/pam.d/system-login
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc.idmap = u 0 100000 65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/lxc/default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc.idmap = g 0 100000 65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/lxc/default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:100000:65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/subuid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:100000:65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/subgid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;systemd_container=yes&amp;#34;&lt;/span>&amp;gt;&amp;gt; /etc/conf.d/lxc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理 启动文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:1&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> chpasswd &lt;span class="c1"># alpine的root密码改为1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lxc lxd lxcfs dbus&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;/usr/sbin/sshd -D&amp;#34;&lt;/span> &amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxd &amp;amp;&amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc start dt &amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;tail -f /dev/null&amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">lxd &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxd init &lt;span class="c1"># 全部默认 除了自动更新那个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc launch images:debian/12 dt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 这个错误不影响 ERROR [2023-07-06T21:40:35+08:00] balance: Unable to set cpuset err=&amp;#34;setting cgroup item for the container failed&amp;#34; name=dt value=&amp;#34;0,1,10,11,2,3,4,5,6,7,8,9&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config &lt;span class="nb">set&lt;/span> dt security.privileged &lt;span class="nb">true&lt;/span> &lt;span class="c1">#特权&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config get dt security.privileged &lt;span class="c1">#检查&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc info dt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理端口映射&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt xrdp proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:3389 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:3389
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sshd proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:22 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt novnc proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:8080 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt vnc0 proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:5900 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:5900
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt vnc1 proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:5901 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:5901
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sshd proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:2222 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删除 lxc config device remove dt sshd&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 挂载目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sda1 disk &lt;span class="nv">source&lt;/span>&lt;span class="o">=&lt;/span>/mnt/sda1 &lt;span class="nv">path&lt;/span>&lt;span class="o">=&lt;/span>/mnt/sda1 &lt;span class="c1"># 挂载目录&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debian内处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc &lt;span class="nb">exec&lt;/span> dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s1">&amp;#39;s/deb.debian.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt update&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>apt upgrade
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 基础&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y wget curl nano openssh-server unzip sudo zsh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 桌面&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install i3 openbox
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 错误不影响 Failed to try-restart systemd-binfmt.service: Unit systemd-binfmt.service is masked.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 字体&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install fonts-jetbrains-mono fonts-noto-color-emoji
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p /usr/share/fonts/WindowsFonts &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> /usr/share/fonts/WindowsFonts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget -c https://ghproxy.com/https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/windows_font/msyh.ttc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fc-cache -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg-reconfigure locales &lt;span class="c1"># zh_CN.UTF-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 常用组件 状态了 图片查看壁纸 终端 任务切换和运行 shell pythone的模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y polybar feh dunst alacritty rofi zsh python3-requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 浏览器和文件管理器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y firefox-esr thunar &lt;span class="c1"># 不需要可以自己删除 ，占用硬盘400多M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thunar网络访问 nas所需要组件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y gvfs gvfs-backends gvfs-fuse sshfs &lt;span class="c1"># 占用硬盘61M openbox下无法使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 中文输入法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#apt install -y fcitx5-chinese-addons # 740M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 远程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y xrdp tigervnc-standalone-server novnc python3-websockify supervisor &lt;span class="c1"># 194M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 编译 xrdp 声音&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y pulseaudio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y build-essential dpkg-dev libpulse-dev git autoconf libtool &lt;span class="c1"># 此部分组建谨慎删除&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y lsb-release doxygen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git clone https://github.com/neutrinolabs/pulseaudio-module-xrdp.git &lt;span class="c1"># 基于v0.7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> pulseaudio-module-xrdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scripts/install_pulseaudio_sources_apt.sh &lt;span class="c1"># debian12 用这，另外一个是scripts/install_pulseaudio_sources_apt_wrapper.sh 不兼容debian12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./bootstrap &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ./configure &lt;span class="nv">PULSE_DIR&lt;/span>&lt;span class="o">=&lt;/span>~/pulseaudio.src
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 验证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ls &lt;span class="k">$(&lt;/span>pkg-config --variable&lt;span class="o">=&lt;/span>modlibexecdir libpulse&lt;span class="k">)&lt;/span> &lt;span class="p">|&lt;/span> grep xrdp &lt;span class="c1"># module-xrdp-sink.so 和 module-xrdp-source.so 就是成功了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">useradd -ms /bin/bash yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;yanhui:1&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> chpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">usermod -G sudo yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#loginctl enable-linger yanhui # 允许此用户推出登陆后 他的用户服务依旧执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 服务处理 vnc 和 novnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理用户 ======== start&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">su yanhui &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vnc 密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vncpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 默认shell 从 bash转zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;zsh&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.bashrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># xrdp 默认桌面&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> i3 &amp;gt;/home/yanhui/.xsession
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 壁纸 2张&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir ~/bg &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> ~/bg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/green.jpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/bing-jurenzhilu.jpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/joyanhui/oh-my-zsh/archive/refs/heads/main.zip -O main.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unzip main.zip &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> mv oh-my-zsh-main/.oh-my-zsh .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp oh-my-zsh-main/.zshrc .&lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm main.zip &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm -rf oh-my-zsh-main/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># i3 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># polybar 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dunst 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># alacritty 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># rofi 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># openbox 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user-dirs.dirs 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;openbox&amp;#34;&lt;/span> &amp;gt; ~/.vnc/xstartup &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> chmod +x ~/.vnc/xstartup &lt;span class="c1"># 配置vnc桌面为openbox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理用户 ======== end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span> &lt;span class="c1"># 退回到root&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置vnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 参考 /lib/systemd/system/tigervncserver@.service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/systemd/system/vncserver@0.service &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Unit]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Description=Start TightVNC server at startup
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">After=syslog.target network.target
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Service]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Type=forking
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">User=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Group=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">WorkingDirectory=/home/yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">PIDFile=/home/yanhui/.vnc/%H:%i.pid
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStartPre=-/usr/bin/vncserver -kill :%i &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStart=/usr/bin/vncserver -geometry 1900x930 -localhost no :%i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStop=/usr/bin/vncserver -kill :%i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Install]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">WantedBy=multi-user.target
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># novnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/supervisor/conf.d/novnc.conf &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[program:novnc]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">command= /usr/bin/websockify -D --web=/usr/share/novnc/ 8080 localhost:5900
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">user=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">autorestart=true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">priority=999
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">supervisorctl update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s /usr/share/novnc/vnc.html /usr/share/novnc/index.html &lt;span class="c1"># 首页&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> vncserver@0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 清理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /root/pulseaudio* &lt;span class="c1"># xrdp 历史文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /root/.bash_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /home/yanhui/.bash_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /home/yanhui/.zsh_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt autoremove &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt autoclean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt clean
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>alpine 入口启动文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 清理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /var/cache/apk/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm -rf ~/.ash_history&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>‍&lt;/p>
&lt;p>备份 docker&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker stop test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">export&lt;/span> test2 &amp;gt; 3.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker import 1.tar test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker stop test2 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker rm test2 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker rmi test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name test2 --hostname test2 --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 333:3389 -p 222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> test2 sh /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>‍&lt;/p>
&lt;p>推送到 hub.docker.com&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">logout&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker login
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 推送到阿里云 容器镜像&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># docker login --username=你的用户邮箱 registry.cn-地区.aliyuncs.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">datename&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>date +%Y%m%d%H%M%S&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag test2 joyanhui/debian-i3-xrdp-novnc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag test2 joyanhui/debian-i3-xrdp-novnc:a-lxd-d-&lt;span class="k">$(&lt;/span>datename&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker push joyanhui/debian-i3-xrdp-novnc:a-lxd-d-&lt;span class="si">${&lt;/span>&lt;span class="nv">datename&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker push joyanhui/debian-i3-xrdp-novnc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker joyanhui/debian-i3-xrdp-novnc 更新记录和更新计划</title><link>https://dev.leiyanhui.com/docker/debian-desktop-next/</link><pubDate>Tue, 04 Jul 2023 00:15:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-next/</guid><description>&lt;h2 id="为什么不经常更新">为什么不经常更新
&lt;/h2>&lt;p>因为定位是 xrdp+vnc+novnc+远程声音转发 可用的一个尽可能小巧的稳定linux, 这个基本功能是绝对稳定强壮可用的。&lt;br>
除非 pulseaudio-module-xrdp 有大版本更新，不然joyanhui/debian-i3-xrdp-novnc 不会继续更新。&lt;br>
安全更新 自己 &lt;code>apt upgrade&lt;/code> 即可！&lt;/p>
&lt;h2 id="建议和需求">建议和需求
&lt;/h2>&lt;p>mailto: am95YW5odWkoYXQpcXEuY29t （解码后联系）&lt;/p>
&lt;h2 id="更新计划">更新计划
&lt;/h2>&lt;blockquote>
&lt;p>不代表一定会添加上可能是还在权衡&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>天气预报默认显示 提示修改key&lt;/li>
&lt;li>openbox 集成dock 或者 任务栏 默认壁纸等&lt;/li>
&lt;li>默认用户 yanhui 免密码sudo&lt;/li>
&lt;li>物理机可直接启动版&lt;/li>
&lt;/ul>
&lt;h2 id="已经完成的">已经完成的
&lt;/h2>&lt;h3 id="2023-0708">2023-0708
&lt;/h3>&lt;ul>
&lt;li>修复 vnc和 novnc 的自动启动&lt;/li>
&lt;li>openbox 右键菜单增加 thunar&lt;/li>
&lt;li>集成 inetutils-ping iproute2 方便使用ping , ip a 命令&lt;/li>
&lt;/ul>
&lt;h3 id="old">old
&lt;/h3>&lt;ul>
&lt;li>alacritty 字体修复【2023-0707】&lt;/li>
&lt;li>i3 自动隐藏firefox-esr浏览器边框【2023-0707】&lt;/li>
&lt;li>修复时区 错误 &lt;code>sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&lt;/code>【2023-0707】&lt;/li>
&lt;li>用雅黑字体替换zhenhei 【2023-0707】&lt;/li>
&lt;li>openbox 右键菜单 rofi的提示【2023-0707】&lt;/li>
&lt;li>polybar 菜单增加 退出 和重启 polybar 【2023-0707】&lt;/li>
&lt;li>polybar 兼容雅黑字体【2023-0707】&lt;/li>
&lt;li>集成 thunar gvfs gvfs-backends gvfs-fuse 【2023-0707】&lt;/li>
&lt;li>集成 compton 【已经完成】&lt;/li>
&lt;li>天气预报 默认调用 firefox-esr 打开网址 【已经完成】&lt;/li>
&lt;li>vnc 和xrdp重复调用pulseaudio 导致的冲突问题 【使用双桌面方案解决】&lt;/li>
&lt;li>默认桌面尝试 兼容 xrdp 和 vnc多显示器 vnc 可能会采用openbox 【已经完成】&lt;/li>
&lt;li>状态栏 多显示器 【因为双桌面系统 已经不需要，i3现有配置文件可以满足】&lt;/li>
&lt;/ul></description></item><item><title>docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc</title><link>https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/</link><pubDate>Tue, 04 Jul 2023 00:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/</guid><description>&lt;p>本文为旧版本文档，新版文档在 ： &lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/debian-desktop/&lt;/a>&lt;/p>
&lt;p>debian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp&lt;/p>
&lt;p>没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。&lt;/p>
&lt;h3 id="特性">特性
&lt;/h3>&lt;p>轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。&lt;br>
vnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3
集成软件：&lt;/p>
&lt;ul>
&lt;li>debian 12 bookworm&lt;/li>
&lt;li>i3 openbox polybar rofi alacritty dunst zsh&lt;/li>
&lt;li>supervisord 服务器管理 及python3&lt;/li>
&lt;li>tigervnc&lt;/li>
&lt;li>novnc websockify&lt;/li>
&lt;li>ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji&lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-next/" target="_blank" rel="noopener"
>更新记录和计划&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="安装">安装
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name debian-i3 --hostname debian-i3 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 3389:3389 -p 2222:22 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 8080:8080 -p 5900-5905:5900-5905 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /mnt:/disk &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">TZ&lt;/span>&lt;span class="o">=&lt;/span>Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900&lt;/p>
&lt;h3 id="默认用户名和密码">默认用户名和密码
&lt;/h3>&lt;p>xrdp x11 ssh 的默认用户名：yanhui 密码：1 （只有一个数字1）
vnc 密码：111111（六个数字1）&lt;/p>
&lt;h3 id="为什么选择debian">为什么选择debian
&lt;/h3>&lt;p>因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 &lt;br>
放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。 arch的 一些其他缺点这里不多说。&lt;br>
而且debian12 2年更新 5年安全，以后也可以平滑升级到更新版本。&lt;/p>
&lt;h3 id="为什么选择i3-和openbox-怎么换其他桌面">为什么选择i3 和openbox 怎么换其他桌面
&lt;/h3>&lt;p>因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。
因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。&lt;br>
而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面&lt;/p>
&lt;h4 id="更换为其他桌面的方法">更换为其他桌面的方法
&lt;/h4>&lt;p>例如，要换成 xfce4首先安装&lt;code>sudo apt install xfce4&lt;/code> ,然后修改 &lt;code>/autoStart.sh&lt;/code> 可以更换vnc和novnc的桌面。&lt;br>
修改用户目录下的 &lt;code>~/.xsession&lt;/code> 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:&lt;code>sudo apt purge i3&lt;/code> or &lt;code>sudo apt purge openbox&lt;/code>&lt;/p>
&lt;h3 id="novnc-vnc为什么是黑屏">novnc vnc为什么是黑屏
&lt;/h3>&lt;p>就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 右键 有惊喜！&lt;/p>
&lt;h3 id="怎么启动shell-和常见快捷键">怎么启动shell 和常见快捷键
&lt;/h3>&lt;p>基本是i3 的默认快捷键&lt;br>
点屏幕顶部的 Apps&amp;gt; 系统 &amp;gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）&lt;br>
如果是rdp远程桌面下，按下键盘 ： win+回车 &lt;br>
启动管理器（开始菜单） :win d&lt;br>
程序切换 alt+tab
修改窗口大小：按住win 再按住 鼠标右键 来回拖动&lt;br>
修改窗口位置：按住win 再按住 鼠标左键 来回拖动&lt;br>
关闭软件：win shift q&lt;br>
注销：win shift e&lt;br>
更多使用方法 自己看一下i3 使用说明&lt;/p>
&lt;h3 id="怎么装中文输入法">怎么装中文输入法
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-chinese-addons
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完成后，注销重新登录一次桌面，会自动加载，然后在托盘位置配置添加输入法即可，拼音输入法可导入搜狗细胞词库，具体自己研究。&lt;/p>
&lt;h3 id="怎么新建用户怎么删除默认用户">怎么新建用户怎么删除默认用户
&lt;/h3>&lt;h4 id="新建用户">新建用户
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo adduser YouName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -aG sudo YouName
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="新用户vnc密码">新用户vnc密码
&lt;/h5>&lt;p>ssh 或者 xrdp 登陆新用户后，运行 &lt;code>vncpasswd&lt;/code>&lt;/p>
&lt;h5 id="更新-vnc服务">更新 vnc服务
&lt;/h5>&lt;p>修改里面的用户名&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="删除默认用户">删除默认用户
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo deluser yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="怎么修改密码">怎么修改密码
&lt;/h3>&lt;h4 id="用户密码">用户密码
&lt;/h4>&lt;p>命令：&lt;code>passwd&lt;/code>&lt;/p>
&lt;h4 id="vnc密码">vnc密码
&lt;/h4>&lt;p>命令：&lt;code>vncpasswd .vnc/passwd&lt;/code> ，需要重启vnc服务，命令查看 &lt;code>cat /autoStart.sh &lt;/code>&lt;/p>
&lt;h3 id="x11转发模式如何使用输入法">x11转发模式如何使用输入法
&lt;/h3>&lt;p>修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 &lt;code>fcitx5&amp;amp;&lt;/code> 再执行对应的软件。&lt;/p>
&lt;h3 id="x11-转发模式部分软件很卡">x11 转发模式部分软件很卡
&lt;/h3>&lt;p>没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。&lt;/p>
&lt;h3 id="novnc默认地址">novnc默认地址
&lt;/h3>&lt;p>http://你的ip:8080/ 其中端口docker内部默认使用80，外部端口是你自己映射的。&lt;/p>
&lt;h3 id="novnc如何走https">novnc如何走https
&lt;/h3>&lt;p>建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。&lt;/p>
&lt;h3 id="20230704版本vnc连不上">20230704版本vnc连不上
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm /tmp/.X0-lock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器&lt;/p>
&lt;h3 id="如何关掉vnc">如何关掉vnc
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo rm /etc/supervisor/conf.d/novnc.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt purge tigervnc-standalone-server novnc python3-websockify
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 注释掉 /autoStart.sh 的启动命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># su -c &amp;#34;/usr/bin/vncserver -xstartup /usr/bin/i3 -geometry 1900x930 -localhost no :0 &amp;#34; yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># sudo apt autoremove &amp;amp;&amp;amp; sudo apt autoclean &amp;amp;&amp;amp; sudo apt clean # 可选清理操作
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后卸载&lt;/p>
&lt;h3 id="天气预报出错以及如何修改天气预报城市">天气预报出错以及如何修改天气预报城市
&lt;/h3>&lt;p>&lt;code>~/.config/polybar/weather-plugin.py&lt;/code> 这个文件
天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。&lt;br>
你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）&lt;br>
&lt;code>https://api.openweathermap.org/data/2.5/weather?id=1793724&amp;amp;appid=440b47a5ffbc5421e4a9befcbc4d635b&amp;amp;units=Metric&amp;amp;lang=zh_cn&lt;/code>&lt;br>
你如果不想用，直接在 polybar的配置文件里面删掉即可。&lt;/p>
&lt;h3 id="如何调音量">如何调音量
&lt;/h3>&lt;p>在i3配置文件里面修改&lt;br>
调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。&lt;br>
进阶用法，自己配置i3和polybar&lt;/p>
&lt;h3 id="vnc-和xrdp-桌面不同步">vnc 和xrdp 桌面不同步
&lt;/h3>&lt;p>是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。&lt;/p>
&lt;h3 id="novnc-网页访问按键失灵乱跳">noVNC 网页访问按键失灵乱跳
&lt;/h3>&lt;p>1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法&lt;br>
2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。&lt;/p>
&lt;h3 id="没声音或者--顶部音量不显示">没声音或者 顶部音量不显示
&lt;/h3>&lt;h4 id="vnc-和x11-没声音">vnc 和x11 没声音
&lt;/h4>&lt;p>vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp&lt;/p>
&lt;h4 id="xrdp的polybar-偶尔不显示音量">xrdp的polybar 偶尔不显示音量
&lt;/h4>&lt;p>这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。&lt;br>
临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">killall pulseaudio &amp;amp;&amp;amp; pulseaudio &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh .config/polybar/polybar_run.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="如何修改分辨率">如何修改分辨率
&lt;/h3>&lt;h4 id="vnc-novnc">vnc novnc
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /autoStart.sh # geometry 后面的参数是vnc的分辨率
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="xrdp">xrdp
&lt;/h4>&lt;p>xrdp的分辨率 由你的客户端 发起的时候配置&lt;/p>
&lt;h3 id="openbox的壁纸点好多次才换一张">openbox的壁纸点好多次才换一张
&lt;/h3>&lt;p>壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。&lt;/p>
&lt;h3 id="自己添加开机启动项">自己添加开机启动项
&lt;/h3>&lt;p>三个方法&lt;/p>
&lt;ul>
&lt;li>跟随 i3桌面启动的软件，可以添加到i3 配置文件中。例如截图软件，蓝牙托盘等等&lt;/li>
&lt;li>后台服务，可以添加到 /autoStart.sh&lt;/li>
&lt;li>需要守护的后台服务 添加到 supervisor中目录： /etc/supervisor/conf.d/&lt;/li>
&lt;/ul>
&lt;h3 id="安装常用软件">安装常用软件
&lt;/h3>&lt;p>点屏幕左上角 APPS &amp;gt; 系统 &amp;gt; 终端 输入 &lt;code>apt install &lt;/code>命令；启动软件 APPS &amp;gt; 系统 &amp;gt; &lt;code>rofi-run&lt;/code> 选择软件或者输入软件名称&lt;br>
或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install firefox-esr # 火狐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install thunar nemo nautilus # 任选一个 dolphin有依赖冲突哈 ，参考后面 libpulse-mainloop-glib0 错误的说明
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="libpulse-mainloop-glib0-错误">libpulse-mainloop-glib0 错误
&lt;/h4>&lt;p>libpulse-mainloop-glib0 : Depends: libpulse0 (= 16.1+dfsg1-2+b1) but 1:13.99.1-1ubuntu3.10 is to be installed
部分软件 例如 pavucontrol dolphin 需要新版 libpulse0，但是因为 考虑到pulseaudio-module-xrdp 稳定性，我用的旧版本。
你可以卸载掉，然后重新编译pulseaudio-module-xrdp。&lt;/p>
&lt;h3 id="不喜欢默认用户的shell">不喜欢默认用户的shell
&lt;/h3>&lt;p>默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 &lt;br>
然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可&lt;/p>
&lt;h3 id="pve-lxc-ct-或者docker宿主机-目录映射-和显卡等">pve lxc ct 或者docker宿主机 目录映射 和显卡等
&lt;/h3>&lt;h4 id="pve-硬盘到lxc">pve 硬盘到lxc
&lt;/h4>&lt;p>请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/&lt;/p>
&lt;h4 id="docker宿主机-目录映射">docker宿主机 目录映射
&lt;/h4>&lt;p>docker 创建命令 里面的 &lt;code>-v /mnt:/disk &lt;/code> 就是把上层宿主的 /mnt 穿透到容器内部的/disk。
注意权限问题哈，可以用uid映射方法，权限要求不严格 也可以直接 &lt;code>chmod -R 777 /mnt&lt;/code>解决&lt;/p>
&lt;h4 id="如何使用显卡加速">如何使用显卡加速
&lt;/h4>&lt;p>以nvidia为例在创建docker的时候 把显卡挂进去即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --restart=always \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name debian-i3 --hostname debian-i3 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 3389:3389 -p 2222:22 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 8080:8080 -p 5900-5905:5900-5905 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /mnt:/disk \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia0:/dev/nvidia0 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidiactl:/dev/nvidiactl \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia-uvm:/dev/nvidia-uvm \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e TZ=Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="目录和文件说明">目录和文件说明
&lt;/h3>&lt;h4 id="启动文件">启动文件
&lt;/h4>&lt;p>启动文件分两个&lt;/p>
&lt;ul>
&lt;li>/autoStart.sh 启动vnc 并启动supervisord&lt;/li>
&lt;li>/etc/supervisor/conf.d/ supervisord 服务目录&lt;/li>
&lt;/ul>
&lt;h4 id="i3-配置文件">i3 配置文件
&lt;/h4>&lt;p>/home/yanhui/.config/i3/config&lt;/p>
&lt;h4 id="openbox配置文件">openbox配置文件
&lt;/h4>&lt;p>/home/yanhui/.config/openbox/menu.xml #右键菜单&lt;br>
feh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本&lt;/p>
&lt;h4 id="壁纸目录">壁纸目录
&lt;/h4>&lt;p>i3配置文件调用feh随机选
/home/yanhui/.config/i3/bg/&lt;/p>
&lt;h4 id="polybar">polybar
&lt;/h4>&lt;ul>
&lt;li>/home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单&lt;/li>
&lt;li>/home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本&lt;/li>
&lt;li>/home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。&lt;/li>
&lt;/ul>
&lt;h4 id="rofi">rofi
&lt;/h4>&lt;p>/home/yanhui/.config/rofi/config.rasi&lt;/p>
&lt;h4 id="dunst">dunst
&lt;/h4>&lt;p>/home/yanhui/.config/dunst/dunstrc&lt;/p>
&lt;h4 id="alacritty">alacritty
&lt;/h4>&lt;p>/home/yanhui/.config/alacritty/alacritty.yml&lt;/p>
&lt;h4 id="zsh">zsh
&lt;/h4>&lt;p>/home/yanhui/.zshrc
/home/yanhui/.oh-my-zsh&lt;/p></description></item></channel></rss>