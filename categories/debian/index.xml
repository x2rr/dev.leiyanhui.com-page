<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Debian on 小类随手记</title><link>https://dev.leiyanhui.com/categories/debian/</link><description>Recent content in Debian on 小类随手记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 07 Mar 2024 06:14:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/categories/debian/index.xml" rel="self" type="application/rss+xml"/><item><title>debian12安装微信原生版 非web 非electron 非wine</title><link>https://dev.leiyanhui.com/linux/wecha-new-debian/</link><pubDate>Thu, 07 Mar 2024 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/linux/wecha-new-debian/</guid><description>&lt;p>惊闻微信出linux版，一开始以为是uos的那个web微信升级了。后来知道是原生测试版本。
当然只支持银河麒麟和统信，不过有解决颁发。&lt;/p>
&lt;h2 id="新版微信">新版微信
&lt;/h2>&lt;p>debian12 可以直接安装&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">https://www.52pojie.cn/thread-1896902-1-1.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下载地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://cloud.cnxclm.com/s/XOxIb?path&lt;span class="o">=&lt;/span>%2F%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>不一定需要&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mkdir /usr/lib/license/ &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> cp ./libuosdevicea.so /usr/lib/license/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="卸载和安装">卸载和安装
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install dpkg-dev &lt;span class="c1"># 非必须&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install ./store.spark-app.wechat-linux-spark_2.2-real-1.0.0.145_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">killall wechat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt purge store.spark-app.wechat-linux-spark
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="体验">体验
&lt;/h2>&lt;p>比win的微信差了不是一点半点，比web微信强了也不是一点半点 。&lt;br>
内存 有一个weicha进程80-150M内存 有几个 wechatAPPex进程 每个 8-80M不等 总共 400M内存左右。 &lt;br>
xwayland和xorg 下fcitx5 都不需要单独处理 直接可用。&lt;/p>
&lt;ul>
&lt;li>托盘图标有，但是右键没反应 &lt;code>killall wechat&lt;/code> 就行了。 有时候需要点击两次才可以唤起微信窗口&lt;/li>
&lt;li>gnome dash图标空白的蓝色齿轮图&lt;/li>
&lt;li>消息提醒不显示消息内容 只有 &amp;ldquo;wechat is ready&amp;rdquo;&lt;/li>
&lt;li>wayland下截图不可用 黑屏，xorg下正常。alt+x 截图快捷键正常&lt;/li>
&lt;li>没有群消息折叠 群太多的话依旧蛋疼&lt;/li>
&lt;li>维持和 某一个好友的对话框的情况下，收到好友消息后，手机也会提醒。(web微信不可以，非常容易漏消息)&lt;/li>
&lt;li>没有暗黑模式适配，白晃晃的亮瞎眼睛&lt;/li>
&lt;li>聊天记录没有清理功能。可以删除消息但是只能一条一条的。&lt;/li>
&lt;li>被加好友 没有任何提醒&lt;/li>
&lt;li>没有朋友圈功能，有小程序 看一看 视频号&lt;/li>
&lt;li>群聊内无法点击好友头像转私聊&lt;/li>
&lt;li>查看图片功能 esc无效要 alt+f4&lt;/li>
&lt;li>貌似是qt开发的，发送文件的选择文件对话框 整个上古风，不过可以输入路径前缀定位文件。&lt;/li>
&lt;li>消息不能撤回！！！&lt;/li>
&lt;/ul>
&lt;p>据说在麒麟和uos下托盘和消息提醒功能适配的不错，但是debian下 只能凑合用&lt;/p>
&lt;p>其他参考 &lt;a class="link" href="https://www.52pojie.cn/thread-1896902-1-1.html" target="_blank" rel="noopener"
>https://www.52pojie.cn/thread-1896902-1-1.html&lt;/a>&lt;/p></description></item><item><title>docker swarm 集群debian基础镜像</title><link>https://dev.leiyanhui.com/docker/debian-fishbase/</link><pubDate>Sun, 19 Nov 2023 07:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-fishbase/</guid><description>&lt;h2 id="场景">场景
&lt;/h2>&lt;p>之前服务都是基于 rust和golang 所以一直使用公用镜像。但是在使用对象储存的时候发现缺少ssl支持。&lt;br>
不得不&lt;/p>
&lt;h2 id="准备文件">准备文件
&lt;/h2>&lt;ul>
&lt;li>sources.list （服务器上 没科学工具）&lt;/li>
&lt;li>zsh 配置文件（偶尔需要在容器内部操作所以还是加上）&lt;/li>
&lt;/ul>
&lt;h3 id="sourecelist">sourece.list
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zsh-配置文件">zsh 配置文件
&lt;/h3>&lt;p>&lt;a class="link" href="https://github.com/joyanhui/oh-my-zsh" target="_blank" rel="noopener"
>https://github.com/joyanhui/oh-my-zsh&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm -rf .oh-my-zsh yhZsh.zip .zshrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -L -e &amp;#39;; auto&amp;#39; -o yhZsh.zip https://mirror.ghproxy.com/https://github.com/joyanhui/oh-my-zsh/archive/refs/heads/main.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unzip yhZsh.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv oh-my-zsh-main/.oh-my-zsh . &amp;amp;&amp;amp; cp oh-my-zsh-main/.zshrc .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf yhZsh.zip oh-my-zsh-main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>适当删除一些没用的插件和主题&lt;/p>
&lt;h2 id="dockerfile">Dockerfile
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> debian:stable-20231120-slim&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">MAINTAINER&lt;/span>&lt;span class="s"> author &amp;#34;leiyanhui@gmail.com&amp;#34;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ADD&lt;/span> sources.list /etc/apt/&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ADD&lt;/span> .zshrc /root/&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> .oh-my-zsh /root/.oh-my-zsh&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c">#ADD rclone /usr/bin/&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> rm -rf /etc/apt/sources.list.d/debian.sources &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y apt-transport-https ca-certificates gnupg lsb-release &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get install -y psmisc wget curl unzip zip fuse zsh ntp iftop openssh-server &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt autoremove &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get clean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get autoclean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>WORKDIR /root&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">EXPOSE&lt;/span>&lt;span class="s"> 22&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">CMD&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;/usr/sbin/sshd&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;-D&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="容器服务">容器服务
&lt;/h2>&lt;p>因为更新较少，所以使用阿里云的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo docker login --username&lt;span class="o">=&lt;/span>&amp;lt;用户名&amp;gt; registry.cn-shanghai.aliyuncs.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">nowTime&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>date &lt;span class="s2">&amp;#34;+%Y%m%d%H%M%S&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker build -t registry.cn-shanghai.aliyuncs.com/fish/debian:base-&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">nowTime&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker tag registry.cn-shanghai.aliyuncs.com/fish/debian:base-&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">nowTime&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> registry.cn-shanghai.aliyuncs.com/fish/debian:base-latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker push registry.cn-shanghai.aliyuncs.com/fish/debian:base-&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">nowTime&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker push registry.cn-shanghai.aliyuncs.com/fish/debian:base-latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="swarm集群部署">swarm集群部署
&lt;/h2>&lt;p>在集群上分别登陆
然后&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">docker pull registry.cn-shanghai.aliyuncs.com/fish/debian:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>debian12 pipewire i3安装配置</title><link>https://dev.leiyanhui.com/linux/pipewire-debian/</link><pubDate>Sat, 22 Jul 2023 00:00:20 +0800</pubDate><guid>https://dev.leiyanhui.com/linux/pipewire-debian/</guid><description>&lt;h1 id="pulseaudio">pulseaudio
&lt;/h1>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install pulseaudio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install pavucontrol
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>不用创建服务，可以直接跟随i3启动和重载,i3配置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">exec_always --no-startup-id killall pulseaudio &amp;amp;&amp;amp; pulseaudio
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="pipewire">pipewire
&lt;/h1>&lt;p>可以不用安装PulseAudio,直接使用安装 pipewire即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install pipewire
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>包含：&lt;br>
libpipewire-0.3-0 libpipewire-0.3-common libpipewire-0.3-modules libspa-0.2-modules ibwireplumber-0.4-0 pipewire-bin pipewire-pulse rtkit wireplumber
可选：&lt;br>
libspa-0.2-bluetooth pulseaudio-utils wireplumber-doc&lt;/p>
&lt;p>可能需要：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apt install wireplumber pipewire-media-session-
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>另外装一个面板工具&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install pavucontrol
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>普通用户启动&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">systemctl --user --now enable wireplumber.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="有问题的时候重启">有问题的时候重启
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo systemctl restart pipewire
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl --user --now enable wireplumber.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="对比">对比
&lt;/h1>&lt;p>日常使用没啥感觉，在部分硬件上 pulseaudio下存在颤音，pipewire同样存在。 并且pipewire在设备长时间待机的时候 会无声音，需要重启服务&lt;/p></description></item><item><title>debian12 安装微信</title><link>https://dev.leiyanhui.com/linux/debian-wechat/</link><pubDate>Tue, 11 Jul 2023 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/linux/debian-wechat/</guid><description>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/linux/wecha-new-debian" target="_blank" rel="noopener"
>2024-03-7 已经有原生版微信，虽然目前之支持uos和麒麟等系统，实际上其他系统也可以用。&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/arch/new-qq2022/" target="_blank" rel="noopener"
>2022年12月07日 腾讯已经发布新版linux qq &lt;/a>&lt;/p>
&lt;p>因为各个版本的 都存在封号情况，目前只有deepin wine版本 尚可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget -O- https://deepin-wine.i-m.dev/setup.sh | sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install com.qq.weixin.deepin com.qq.im.deepin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 如无法发送照片
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install libjpeg62:i386
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/opt/apps/com.qq.weixin.deepin/files/run.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在i3 下有黑框影响观感，但是不影响使用。&lt;/p></description></item><item><title> usb 设备网络共享方案（免费） win=> linux</title><link>https://dev.leiyanhui.com/linux/usbip/</link><pubDate>Fri, 07 Jul 2023 11:02:20 +0800</pubDate><guid>https://dev.leiyanhui.com/linux/usbip/</guid><description>&lt;p>如果设备不多，可以接受只一个设备 的话，可以使用 virtualhere 这个的免费版本。但是免费版之能连接一个设备，收费版本价格不低。&lt;/p>
&lt;p>如果是双linux的话，可以用usbip直接处理。&lt;/p>
&lt;p>我设备在win电脑上，linux电脑来连接。
所以采取 virtualbox 运行一个 alpine,然后共享usb设备出来的方案。&lt;/p>
&lt;p>virtualbox 添加usb设备进去 alpine安装 配置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">usbip&lt;/span> &lt;span class="c1"># 注意要打开 community源&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">modprobe&lt;/span> &lt;span class="n">usbip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span> &lt;span class="n">usbip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">host&lt;/span> &lt;span class="n">vhci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hcd&lt;/span> &lt;span class="c1"># 内核要支持， 不能加载话 需要安装完整的alpine 不要用 virt的内核&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 写入到 /etc/modules 每次开机自启&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查询模块加载情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lsmod&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="n">usbip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看usb设备&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">usbip&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">l&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">usbipd&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">D&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="c1"># 启动服务，&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 把usb设备添加到usbip中去：可以添加多个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2-1就是上面的编号 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">usbip&lt;/span> &lt;span class="n">bind&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 解除绑定usb设备&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">usbip&lt;/span> &lt;span class="n">unbind&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>客户端 linux-debian # 如果是在容器中的，记得从宿主机器加载 并映射过来&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo modprobe usbip-core usbip-host vhci-hcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lsmod | grep usbip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install usbip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lsusb # sudo apt install usbutils
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usbip list -r 10.1.1.215 # 查看
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usbip attach -r 10.1.1.215 -b 2-1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc</title><link>https://dev.leiyanhui.com/docker/debian-desktop/</link><pubDate>Fri, 07 Jul 2023 11:02:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop/</guid><description>&lt;p>debian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp&lt;/p>
&lt;p>没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。&lt;/p>
&lt;h2 id="本文说明">本文说明
&lt;/h2>&lt;p>joyanhui/debian-i3-xrdp-novnc 使用docker 和 lxc/lxd ，本文可能会滞后最新，更多问题问题请查看docker和lxd的使用手册。&lt;br>
如果您没有使用过i3 openbox lxc等软件，务必仔细阅读本文，至少会让你熟悉了解相关操作。&lt;/p>
&lt;h2 id="特性">特性
&lt;/h2>&lt;p>轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。&lt;br>
是一个完整的操作系统，systemd可正常使用，甚至可以再次安装docker&lt;br>
vnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3 &lt;br>
采用docker 运行lxd的方法 alpine3.18.2 =&amp;gt; lxd &lt;br>
集成软件：&lt;/p>
&lt;ul>
&lt;li>debian 12 bookworm&lt;/li>
&lt;li>i3 openbox polybar rofi alacritty dunst zsh firefox-esr thunar gvfs gvfs-backends gvfs-fuse sshfs&lt;/li>
&lt;li>tigervnc&lt;/li>
&lt;li>novnc websockify&lt;/li>
&lt;li>ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji 微软雅黑&lt;/li>
&lt;li>服务管理支持：systemd supervisor&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-next/" target="_blank" rel="noopener"
>更新记录和计划&lt;/a> &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-exec/" target="_blank" rel="noopener"
>公开的搭建过程&lt;/a> &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/" target="_blank" rel="noopener"
>如果你使用的旧版请查看旧版说明&lt;/a>&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name dt --hostname dt --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 3389:3389 -p 222:22 -p 2222:2222 -p 8080:8080 -p 5900-5905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> joyanhui/debian-i3-xrdp-novnc sh /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900 ，222 是alpine容器的ssh端口&lt;/p>
&lt;blockquote>
&lt;p>20230707 之前版本是纯docker实现，不包含浏览器和文件管理器，之后的版本是lxd lxc实现 并带firefox-esr 和thunar 网络挂载 并支持 systemd。&lt;/p>&lt;/blockquote>
&lt;h2 id="默认账号-以及相关用户名和密码">默认账号 以及相关用户名和密码
&lt;/h2>&lt;p>总共有三个密码：&lt;/p>
&lt;h3 id="debian的系统用户">debian的系统用户
&lt;/h3>&lt;p>用户名：yanhui 密码：1 （只有一个数字1）&lt;br>
这个用户名密码，同时对应debian的 ssh xrdp 的默认账号 对应默认端口：2222 和 3389
debian默认的root 没设置密码，禁止ssh登陆&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd yanhui
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="debian的vnc的密码">debian的vnc的密码
&lt;/h3>&lt;p>vnc 密码：111111（六个数字1）&lt;br>
此密码用于vnc 和novnc登陆 默认用户yanhui的桌面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">su yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vncpasswd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="alpine的root账户">alpine的root账户
&lt;/h3>&lt;p>用户名 root 密码:1（只有一个数字1）&lt;br>
此密码同时左右 alpine的ssh登陆密码，对应默认端口：222&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>部署完毕后，务必第一时间修改密码！&lt;/p>&lt;/blockquote>
&lt;h2 id="为什么选择debian-而不是arch--nixos">为什么选择debian 而不是arch nixos
&lt;/h2>&lt;p>因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 &lt;br>
放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。&lt;br>
arch和nixos一些其他缺点这里不多说。&lt;br>
其实最主要的是 不折腾 稳如老狗，以及 个人喜好 以及和服务器端的环境一致性&lt;/p>
&lt;h2 id="为什么用docker-套lxd">为什么用docker 套lxd
&lt;/h2>&lt;p>不直接用lxd 是因为部分环境不支持，另外docker的分层commit 更方便。 更可以推送到自己的私有regditer&lt;br>
不直接用docker 是因为 docker 限制太多，不算是太完整的系统，lxc lxd 是一个完整的系统。&lt;br>
所以20230707版本以后 改为 docker运行alpine 然后在alpine内用lxd运行 debian12&lt;br>
alpine是一个只有3m大小的linux系统，在用lxd嵌套后，比旧方案多占用30-60M内存，80M硬盘，但是带来的是一个完整的linux体验，并且性能吊打虚拟机模式！&lt;/p>
&lt;h2 id="为什么选择i3-和openbox-怎么换其他桌面">为什么选择i3 和openbox 怎么换其他桌面
&lt;/h2>&lt;p>因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。
因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。&lt;br>
而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面&lt;/p>
&lt;h3 id="更换为其他桌面的方法">更换为其他桌面的方法
&lt;/h3>&lt;p>例如，要换成 xfce4首先安装&lt;code>sudo apt install xfce4&lt;/code> ,然后修改 &lt;code>~/.vnc/xstartup &lt;/code> 可以更换vnc和novnc的桌面。&lt;br>
修改用户目录下的 &lt;code>~/.xsession&lt;/code> 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:&lt;code>sudo apt purge i3&lt;/code> or &lt;code>sudo apt purge openbox&lt;/code>&lt;/p>
&lt;h2 id="novnc-vnc为什么是黑屏">novnc vnc为什么是黑屏
&lt;/h2>&lt;p>就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 也没有壁纸，右键 有惊喜！&lt;/p>
&lt;h2 id="怎么启动shell-和常见快捷键">怎么启动shell 和常见快捷键
&lt;/h2>&lt;p>基本是i3 的默认快捷键&lt;br>
点屏幕顶部的 Apps&amp;gt; 系统 &amp;gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）&lt;br>
如果是rdp远程桌面下，按下键盘 ： win+回车 &lt;br>
启动管理器（开始菜单） :win d&lt;br>
程序切换 alt+tab
修改窗口大小：按住win 再按住 鼠标右键 来回拖动&lt;br>
修改窗口位置：按住win 再按住 鼠标左键 来回拖动&lt;br>
关闭软件：win shift q&lt;br>
注销：win shift e&lt;br>
更多使用方法 自己看一下i3 使用说明&lt;/p>
&lt;h2 id="如何从宿主机器直接进去debian-shell">如何从宿主机器直接进去debian shell
&lt;/h2>&lt;p>两步&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 进入docker alpine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 进入lxc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 或者直接
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>第一个dt 是docker的容器名称，第二个 是lxc 的容器名称&lt;br>
你也可以在登陆 vnc/xrdp后直接运行&lt;/p>
&lt;h2 id="怎么装中文输入法">怎么装中文输入法
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-chinese-addons
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>openbox 需要右键手动加载，其他现代的桌面系统，包括i3。安装完成后，注销重新登录一次桌面，会自动加载，拼音输入法可导入搜狗细胞词库，具体自己研究。&lt;br>
默认中英文切换快捷键是 ctrl+空格 ，如果你在非全屏的xrdp 或novnc /vnc 下切换，注意和本地的输入法快捷键冲突问题。&lt;/p>
&lt;h2 id="怎么新建用户怎么删除默认用户">怎么新建用户怎么删除默认用户
&lt;/h2>&lt;h3 id="新建用户">新建用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo adduser YouName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -aG sudo YouName
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="新用户vnc密码">新用户vnc密码
&lt;/h4>&lt;p>ssh 或者 xrdp 登陆新用户后，运行 &lt;code>vncpasswd&lt;/code>&lt;/p>
&lt;h4 id="更新-vnc服务">更新 vnc服务
&lt;/h4>&lt;p>修改里面的用户名&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/systemd/system/vncserver@0.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/supervisor/conf.d/novnc.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除默认用户">删除默认用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo deluser yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="怎么修改密码">怎么修改密码
&lt;/h2>&lt;h3 id="用户密码">用户密码
&lt;/h3>&lt;p>命令：&lt;code>passwd&lt;/code>&lt;/p>
&lt;h3 id="vnc密码">vnc密码
&lt;/h3>&lt;p>命令：&lt;code>vncpasswd .vnc/passwd&lt;/code> ，需要重启vnc服务，查看 &lt;code> systemctrl restart vncserver@0&lt;/code>&lt;/p>
&lt;h2 id="x11转发模式如何使用输入法">x11转发模式如何使用输入法
&lt;/h2>&lt;p>修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 &lt;code>fcitx5&amp;amp;&lt;/code> 再执行对应的软件。&lt;/p>
&lt;h2 id="x11-转发模式部分软件很卡">x11 转发模式部分软件很卡
&lt;/h2>&lt;p>没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。&lt;/p>
&lt;h2 id="novnc默认地址">novnc默认地址
&lt;/h2>&lt;p>http://你的ip:8080/ 其中端口docker内部默认使用8080，外部端口是你自己映射的。&lt;/p>
&lt;h2 id="novnc如何走https">novnc如何走https
&lt;/h2>&lt;p>建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。&lt;/p>
&lt;h2 id="vnc连不上">vnc连不上
&lt;/h2>&lt;p>此问题只在 20230707之前版本存在&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm /tmp/.X0-lock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器&lt;/p>
&lt;h2 id="天气预报出错以及如何修改天气预报城市">天气预报出错以及如何修改天气预报城市
&lt;/h2>&lt;p>&lt;code>~/.config/polybar/weather-plugin.py&lt;/code> 这个文件
天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。&lt;br>
你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）&lt;br>
&lt;code>https://api.openweathermap.org/data/2.5/weather?id=1793724&amp;amp;appid=440b47a5ffbc5421e4a9befcbc4d635b&amp;amp;units=Metric&amp;amp;lang=zh_cn&lt;/code>&lt;br>
你如果不想用，直接在 polybar的配置文件里面删掉即可。&lt;/p>
&lt;h2 id="如何调音量">如何调音量
&lt;/h2>&lt;p>在i3配置文件里面修改&lt;br>
调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。&lt;br>
进阶用法，自己配置i3和polybar&lt;/p>
&lt;h2 id="vnc-和xrdp-桌面不同步">vnc 和xrdp 桌面不同步
&lt;/h2>&lt;p>是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。&lt;/p>
&lt;h2 id="novnc-网页访问按键失灵乱跳">noVNC 网页访问按键失灵乱跳
&lt;/h2>&lt;p>1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法&lt;br>
2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。&lt;/p>
&lt;h2 id="xrdp-登陆后桌面灰色无显示">xrdp 登陆后桌面灰色无显示
&lt;/h2>&lt;p>长期无操作后，锁屏了而已。依次盲输入密码然后按下回车 验证成功后 即可登入桌面。&lt;br>
如果你不需要锁屏功能，可以删掉 &lt;code>sudo apt purge i3lock&lt;/code>&lt;/p>
&lt;h2 id="没声音或者--顶部音量不显示">没声音或者 顶部音量不显示
&lt;/h2>&lt;h3 id="vnc-和x11-没声音">vnc 和x11 没声音
&lt;/h3>&lt;p>vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp&lt;/p>
&lt;h3 id="xrdp的polybar-偶尔不显示音量">xrdp的polybar 偶尔不显示音量
&lt;/h3>&lt;p>这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。&lt;br>
临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">killall pulseaudio &amp;amp;&amp;amp; pulseaudio &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh .config/polybar/polybar_run.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>20230707 以后的版本，可以在polybar顶部菜单用依次点击： APPS &amp;gt; polybar &amp;gt; 重启声音 APPS &amp;gt; polybar &amp;gt; 重载polybar&lt;/p>
&lt;h2 id="如何修改分辨率">如何修改分辨率
&lt;/h2>&lt;h3 id="vnc-novnc">vnc novnc
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/systemd/system/vncserver@0.service # geometry 后面的参数是vnc的分辨率
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="xrdp">xrdp
&lt;/h3>&lt;p>xrdp的分辨率 由你的客户端 发起的时候配置&lt;/p>
&lt;h2 id="openbox的壁纸点好多次才换一张">openbox的壁纸点好多次才换一张
&lt;/h2>&lt;p>壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。&lt;/p>
&lt;h2 id="安装常用软件">安装常用软件
&lt;/h2>&lt;p>点屏幕左上角 APPS &amp;gt; 系统 &amp;gt; 终端 输入 &lt;code>sudo apt install &amp;lt;包名&amp;gt;&lt;/code>命令；启动软件 APPS &amp;gt; 系统 &amp;gt; &lt;code>rofi-run&lt;/code> 选择软件或者输入软件名称&lt;br>
或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install firefox-esr # 火狐 20230707以后版本自带
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install nemo nautilus # 文件管理器 任选一个 20230707以后版本自带 thunar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># todesk 中文不显示 需要另外处理，这里不多说
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://newdl.todesk.com/linux/todesk-v4.3.1.0-amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install ./todesk-v4.3.1.0-amd64.deb #sudo apt purge todesk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 远程其他电脑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install freerdp2-x11 #xfreerdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install remmina # 可选包 remmina-plugin-x2go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># neofetch 命令行装b工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install neofetch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># flameshot 截图工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install flameshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># linuxqq
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://dldir1.qq.com/qqfile/qq/QQNT/ad5b5393/linuxqq_3.1.2-13107_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install ./linuxqq_3.1.2-13107_amd64.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="如何访问文件">如何访问文件
&lt;/h2>&lt;h3 id="thunar--方式">thunar 方式
&lt;/h3>&lt;p>20230707以后版本集成了thunar 和smb sshfs webdav访问组件。
打开 thunar ，地址栏输入：&lt;code>smb://10.1.1.100&lt;/code> 或者&lt;code>dav://10.1.1.100&lt;/code> 即可&lt;/p>
&lt;h3 id="文件挂载">文件挂载
&lt;/h3>&lt;p>参考后文 目录映射 方法&lt;/p>
&lt;h2 id="不喜欢默认用户的shell">不喜欢默认用户的shell
&lt;/h2>&lt;p>默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 &lt;br>
然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可&lt;/p>
&lt;h2 id="pve-lxc-ct-或者docker宿主机-目录映射-端口-和显卡等">pve lxc ct 或者docker宿主机 目录映射 端口 和显卡等
&lt;/h2>&lt;h3 id="pve-硬盘到lxc">pve 硬盘到lxc
&lt;/h3>&lt;p>请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/&lt;/p>
&lt;h3 id="docker宿主机-目录映射">docker宿主机 目录映射
&lt;/h3>&lt;p>默认 映射 /mnt/sda1 到最终的debian12 &lt;br>
如果要映射其他目录，先映射到docker内，确保早docker内可以访问的情况下在docker内如下命令映射到 lxc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc config device add dt sda1 disk source=/mnt/sda1 path=/mnt/sda1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>更多使用方法，以及权限问题，请参考lxd手册&lt;/p>
&lt;h3 id="端口">端口
&lt;/h3>&lt;p>先映射端口到docker,而后在docker内 用如下命令映射到lxc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc config device add dt demoName proxy listen=tcp:0.0.0.0:8888 connect=tcp:127.0.0.1:8888
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>更多使用方法，请参考lxd手册&lt;/p>
&lt;h3 id="如何使用显卡加速">如何使用显卡加速
&lt;/h3>&lt;p>以nvidia为例在创建docker的时候 把显卡挂进去即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run ....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia0:/dev/nvidia0 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidiactl:/dev/nvidiactl \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia-uvm:/dev/nvidia-uvm \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ....
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="pve-群晖--unraid-esxi-下的安装方式">pve 群晖 unraid esxi 下的安装方式
&lt;/h3>&lt;p>pve下，你可以用lxc/vm 运行docker的方式运行，也可以，从本镜像内提取lxc模板直接导入到 CT容器。
其他系统 建议直接docker运行&lt;/p>
&lt;h2 id="目录和文件说明">目录和文件说明
&lt;/h2>&lt;p>&lt;code>/boot.sh&lt;/code> 在docker内 其他文件在 debian内&lt;/p>
&lt;h3 id="启动文件">启动文件
&lt;/h3>&lt;h4 id="bootsh">boot.sh
&lt;/h4>&lt;p>&lt;code>/boot.sh&lt;/code> 在docker内 用于启动alpine的 ssh 和 lxd/lxc 的debian&lt;/p>
&lt;h4 id="systemd-和-supervisord">systemd 和 supervisord
&lt;/h4>&lt;p>systemd 和 supervisord 在 lxc的debian内&lt;br>
novnc使用supervisord启动:&lt;code>/etc/supervisor/conf.d/&lt;/code>，vnc和其他服务使用systemd启动：&lt;code>/etc/systemd/system/&lt;/code>&lt;/p>
&lt;h3 id="i3-配置文件">i3 配置文件
&lt;/h3>&lt;p>/home/yanhui/.config/i3/config&lt;/p>
&lt;h3 id="openbox配置文件">openbox配置文件
&lt;/h3>&lt;p>/home/yanhui/.config/openbox/menu.xml #右键菜单 &lt;br>
feh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本&lt;/p>
&lt;h3 id="壁纸目录">壁纸目录
&lt;/h3>&lt;p>i3配置文件调用feh随机选
/home/yanhui/.config/i3/bg/&lt;/p>
&lt;h3 id="polybar">polybar
&lt;/h3>&lt;ul>
&lt;li>/home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单&lt;/li>
&lt;li>/home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本&lt;/li>
&lt;li>/home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。&lt;/li>
&lt;/ul>
&lt;h3 id="rofi">rofi
&lt;/h3>&lt;p>/home/yanhui/.config/rofi/config.rasi&lt;/p>
&lt;h3 id="dunst">dunst
&lt;/h3>&lt;p>/home/yanhui/.config/dunst/dunstrc&lt;/p>
&lt;h3 id="alacritty">alacritty
&lt;/h3>&lt;p>/home/yanhui/.config/alacritty/alacritty.yml&lt;/p>
&lt;h3 id="zsh">zsh
&lt;/h3>&lt;p>/home/yanhui/.zshrc
/home/yanhui/.oh-my-zsh&lt;/p></description></item><item><title>joyanhui/debian-i3-xrdp-novnc 公开的搭建过程</title><link>https://dev.leiyanhui.com/docker/debian-desktop-exec/</link><pubDate>Fri, 07 Jul 2023 00:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-exec/</guid><description>&lt;p>未使用Dockerfile 是因为搭建过程略微复杂，如果另外打包出来rootfs 也没有什么意义。所以干脆公开过程。&lt;/p>
&lt;p>本文可能存在滞后，未经过严格整理和核对,所有历史命令，你在 下述文件中均可以看到&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /root/.bash_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /home/yanhui/.bash_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /home/yanhui/.zsh_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt cat /root/.ash_history
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>宿主用alpine&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name &lt;span class="nb">test&lt;/span> --hostname &lt;span class="nb">test&lt;/span> --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 333:3389 -p 2221:2222 -p 2222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> alpine:3.18.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it &lt;span class="nb">test&lt;/span> /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apk/repositories
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add tzdata
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Asia/Shanghai&amp;#34;&lt;/span> &amp;gt; /etc/timezone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk del tzdata
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add openssh lxd lxd-client lxcfs dbus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&amp;#39;&lt;/span> /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;session optional pam_cgfs.so -c freezer,memory,name=systemd,unified&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/pam.d/system-login
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc.idmap = u 0 100000 65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/lxc/default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc.idmap = g 0 100000 65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/lxc/default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:100000:65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/subuid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:100000:65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/subgid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;systemd_container=yes&amp;#34;&lt;/span>&amp;gt;&amp;gt; /etc/conf.d/lxc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理 启动文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:1&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> chpasswd &lt;span class="c1"># alpine的root密码改为1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lxc lxd lxcfs dbus&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;/usr/sbin/sshd -D&amp;#34;&lt;/span> &amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxd &amp;amp;&amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc start dt &amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;tail -f /dev/null&amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">lxd &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxd init &lt;span class="c1"># 全部默认 除了自动更新那个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc launch images:debian/12 dt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 这个错误不影响 ERROR [2023-07-06T21:40:35+08:00] balance: Unable to set cpuset err=&amp;#34;setting cgroup item for the container failed&amp;#34; name=dt value=&amp;#34;0,1,10,11,2,3,4,5,6,7,8,9&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config &lt;span class="nb">set&lt;/span> dt security.privileged &lt;span class="nb">true&lt;/span> &lt;span class="c1">#特权&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config get dt security.privileged &lt;span class="c1">#检查&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc info dt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理端口映射&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt xrdp proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:3389 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:3389
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sshd proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:22 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt novnc proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:8080 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt vnc0 proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:5900 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:5900
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt vnc1 proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:5901 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:5901
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sshd proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:2222 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删除 lxc config device remove dt sshd&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 挂载目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sda1 disk &lt;span class="nv">source&lt;/span>&lt;span class="o">=&lt;/span>/mnt/sda1 &lt;span class="nv">path&lt;/span>&lt;span class="o">=&lt;/span>/mnt/sda1 &lt;span class="c1"># 挂载目录&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debian内处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc &lt;span class="nb">exec&lt;/span> dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s1">&amp;#39;s/deb.debian.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt update&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>apt upgrade
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 基础&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y wget curl nano openssh-server unzip sudo zsh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 桌面&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install i3 openbox
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 错误不影响 Failed to try-restart systemd-binfmt.service: Unit systemd-binfmt.service is masked.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 字体&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install fonts-jetbrains-mono fonts-noto-color-emoji
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p /usr/share/fonts/WindowsFonts &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> /usr/share/fonts/WindowsFonts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget -c https://ghproxy.com/https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/windows_font/msyh.ttc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fc-cache -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg-reconfigure locales &lt;span class="c1"># zh_CN.UTF-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 常用组件 状态了 图片查看壁纸 终端 任务切换和运行 shell pythone的模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y polybar feh dunst alacritty rofi zsh python3-requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 浏览器和文件管理器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y firefox-esr thunar &lt;span class="c1"># 不需要可以自己删除 ，占用硬盘400多M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thunar网络访问 nas所需要组件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y gvfs gvfs-backends gvfs-fuse sshfs &lt;span class="c1"># 占用硬盘61M openbox下无法使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 中文输入法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#apt install -y fcitx5-chinese-addons # 740M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 远程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y xrdp tigervnc-standalone-server novnc python3-websockify supervisor &lt;span class="c1"># 194M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 编译 xrdp 声音&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y pulseaudio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y build-essential dpkg-dev libpulse-dev git autoconf libtool &lt;span class="c1"># 此部分组建谨慎删除&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y lsb-release doxygen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git clone https://github.com/neutrinolabs/pulseaudio-module-xrdp.git &lt;span class="c1"># 基于v0.7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> pulseaudio-module-xrdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scripts/install_pulseaudio_sources_apt.sh &lt;span class="c1"># debian12 用这，另外一个是scripts/install_pulseaudio_sources_apt_wrapper.sh 不兼容debian12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./bootstrap &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ./configure &lt;span class="nv">PULSE_DIR&lt;/span>&lt;span class="o">=&lt;/span>~/pulseaudio.src
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 验证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ls &lt;span class="k">$(&lt;/span>pkg-config --variable&lt;span class="o">=&lt;/span>modlibexecdir libpulse&lt;span class="k">)&lt;/span> &lt;span class="p">|&lt;/span> grep xrdp &lt;span class="c1"># module-xrdp-sink.so 和 module-xrdp-source.so 就是成功了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">useradd -ms /bin/bash yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;yanhui:1&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> chpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">usermod -G sudo yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#loginctl enable-linger yanhui # 允许此用户推出登陆后 他的用户服务依旧执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 服务处理 vnc 和 novnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理用户 ======== start&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">su yanhui &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vnc 密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vncpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 默认shell 从 bash转zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;zsh&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.bashrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># xrdp 默认桌面&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> i3 &amp;gt;/home/yanhui/.xsession
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 壁纸 2张&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir ~/bg &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> ~/bg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/green.jpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/bing-jurenzhilu.jpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/joyanhui/oh-my-zsh/archive/refs/heads/main.zip -O main.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unzip main.zip &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> mv oh-my-zsh-main/.oh-my-zsh .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp oh-my-zsh-main/.zshrc .&lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm main.zip &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm -rf oh-my-zsh-main/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># i3 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># polybar 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dunst 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># alacritty 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># rofi 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># openbox 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user-dirs.dirs 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;openbox&amp;#34;&lt;/span> &amp;gt; ~/.vnc/xstartup &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> chmod +x ~/.vnc/xstartup &lt;span class="c1"># 配置vnc桌面为openbox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理用户 ======== end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span> &lt;span class="c1"># 退回到root&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置vnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 参考 /lib/systemd/system/tigervncserver@.service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/systemd/system/vncserver@0.service &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Unit]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Description=Start TightVNC server at startup
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">After=syslog.target network.target
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Service]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Type=forking
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">User=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Group=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">WorkingDirectory=/home/yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">PIDFile=/home/yanhui/.vnc/%H:%i.pid
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStartPre=-/usr/bin/vncserver -kill :%i &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStart=/usr/bin/vncserver -geometry 1900x930 -localhost no :%i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStop=/usr/bin/vncserver -kill :%i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Install]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">WantedBy=multi-user.target
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># novnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/supervisor/conf.d/novnc.conf &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[program:novnc]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">command= /usr/bin/websockify -D --web=/usr/share/novnc/ 8080 localhost:5900
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">user=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">autorestart=true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">priority=999
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">supervisorctl update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s /usr/share/novnc/vnc.html /usr/share/novnc/index.html &lt;span class="c1"># 首页&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> vncserver@0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 清理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /root/pulseaudio* &lt;span class="c1"># xrdp 历史文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /root/.bash_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /home/yanhui/.bash_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /home/yanhui/.zsh_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt autoremove &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt autoclean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt clean
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>alpine 入口启动文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 清理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /var/cache/apk/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm -rf ~/.ash_history&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>‍&lt;/p>
&lt;p>备份 docker&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker stop test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">export&lt;/span> test2 &amp;gt; 3.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker import 1.tar test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker stop test2 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker rm test2 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker rmi test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name test2 --hostname test2 --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 333:3389 -p 222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> test2 sh /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>‍&lt;/p>
&lt;p>推送到 hub.docker.com&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">logout&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker login
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 推送到阿里云 容器镜像&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># docker login --username=你的用户邮箱 registry.cn-地区.aliyuncs.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">datename&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>date +%Y%m%d%H%M%S&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag test2 joyanhui/debian-i3-xrdp-novnc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag test2 joyanhui/debian-i3-xrdp-novnc:a-lxd-d-&lt;span class="k">$(&lt;/span>datename&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker push joyanhui/debian-i3-xrdp-novnc:a-lxd-d-&lt;span class="si">${&lt;/span>&lt;span class="nv">datename&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker push joyanhui/debian-i3-xrdp-novnc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker joyanhui/debian-i3-xrdp-novnc 更新记录和更新计划</title><link>https://dev.leiyanhui.com/docker/debian-desktop-next/</link><pubDate>Tue, 04 Jul 2023 00:15:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-next/</guid><description>&lt;h2 id="为什么不经常更新">为什么不经常更新
&lt;/h2>&lt;p>因为定位是 xrdp+vnc+novnc+远程声音转发 可用的一个尽可能小巧的稳定linux, 这个基本功能是绝对稳定强壮可用的。&lt;br>
除非 pulseaudio-module-xrdp 有大版本更新，不然joyanhui/debian-i3-xrdp-novnc 不会继续更新。&lt;br>
安全更新 自己 &lt;code>apt upgrade&lt;/code> 即可！&lt;/p>
&lt;h2 id="建议和需求">建议和需求
&lt;/h2>&lt;p>mailto: am95YW5odWkoYXQpcXEuY29t （解码后联系）&lt;/p>
&lt;h2 id="更新计划">更新计划
&lt;/h2>&lt;blockquote>
&lt;p>不代表一定会添加上可能是还在权衡&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>天气预报默认显示 提示修改key&lt;/li>
&lt;li>openbox 集成dock 或者 任务栏 默认壁纸等&lt;/li>
&lt;li>默认用户 yanhui 免密码sudo&lt;/li>
&lt;li>物理机可直接启动版&lt;/li>
&lt;/ul>
&lt;h2 id="已经完成的">已经完成的
&lt;/h2>&lt;h3 id="2023-0708">2023-0708
&lt;/h3>&lt;ul>
&lt;li>修复 vnc和 novnc 的自动启动&lt;/li>
&lt;li>openbox 右键菜单增加 thunar&lt;/li>
&lt;li>集成 inetutils-ping iproute2 方便使用ping , ip a 命令&lt;/li>
&lt;/ul>
&lt;h3 id="old">old
&lt;/h3>&lt;ul>
&lt;li>alacritty 字体修复【2023-0707】&lt;/li>
&lt;li>i3 自动隐藏firefox-esr浏览器边框【2023-0707】&lt;/li>
&lt;li>修复时区 错误 &lt;code>sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&lt;/code>【2023-0707】&lt;/li>
&lt;li>用雅黑字体替换zhenhei 【2023-0707】&lt;/li>
&lt;li>openbox 右键菜单 rofi的提示【2023-0707】&lt;/li>
&lt;li>polybar 菜单增加 退出 和重启 polybar 【2023-0707】&lt;/li>
&lt;li>polybar 兼容雅黑字体【2023-0707】&lt;/li>
&lt;li>集成 thunar gvfs gvfs-backends gvfs-fuse 【2023-0707】&lt;/li>
&lt;li>集成 compton 【已经完成】&lt;/li>
&lt;li>天气预报 默认调用 firefox-esr 打开网址 【已经完成】&lt;/li>
&lt;li>vnc 和xrdp重复调用pulseaudio 导致的冲突问题 【使用双桌面方案解决】&lt;/li>
&lt;li>默认桌面尝试 兼容 xrdp 和 vnc多显示器 vnc 可能会采用openbox 【已经完成】&lt;/li>
&lt;li>状态栏 多显示器 【因为双桌面系统 已经不需要，i3现有配置文件可以满足】&lt;/li>
&lt;/ul></description></item><item><title>docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc</title><link>https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/</link><pubDate>Tue, 04 Jul 2023 00:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/</guid><description>&lt;p>本文为旧版本文档，新版文档在 ： &lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/debian-desktop/&lt;/a>&lt;/p>
&lt;p>debian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp&lt;/p>
&lt;p>没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。&lt;/p>
&lt;h3 id="特性">特性
&lt;/h3>&lt;p>轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。&lt;br>
vnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3
集成软件：&lt;/p>
&lt;ul>
&lt;li>debian 12 bookworm&lt;/li>
&lt;li>i3 openbox polybar rofi alacritty dunst zsh&lt;/li>
&lt;li>supervisord 服务器管理 及python3&lt;/li>
&lt;li>tigervnc&lt;/li>
&lt;li>novnc websockify&lt;/li>
&lt;li>ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji&lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-next/" target="_blank" rel="noopener"
>更新记录和计划&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="安装">安装
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name debian-i3 --hostname debian-i3 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 3389:3389 -p 2222:22 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 8080:8080 -p 5900-5905:5900-5905 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /mnt:/disk &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">TZ&lt;/span>&lt;span class="o">=&lt;/span>Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900&lt;/p>
&lt;h3 id="默认用户名和密码">默认用户名和密码
&lt;/h3>&lt;p>xrdp x11 ssh 的默认用户名：yanhui 密码：1 （只有一个数字1）
vnc 密码：111111（六个数字1）&lt;/p>
&lt;h3 id="为什么选择debian">为什么选择debian
&lt;/h3>&lt;p>因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 &lt;br>
放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。 arch的 一些其他缺点这里不多说。&lt;br>
而且debian12 2年更新 5年安全，以后也可以平滑升级到更新版本。&lt;/p>
&lt;h3 id="为什么选择i3-和openbox-怎么换其他桌面">为什么选择i3 和openbox 怎么换其他桌面
&lt;/h3>&lt;p>因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。
因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。&lt;br>
而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面&lt;/p>
&lt;h4 id="更换为其他桌面的方法">更换为其他桌面的方法
&lt;/h4>&lt;p>例如，要换成 xfce4首先安装&lt;code>sudo apt install xfce4&lt;/code> ,然后修改 &lt;code>/autoStart.sh&lt;/code> 可以更换vnc和novnc的桌面。&lt;br>
修改用户目录下的 &lt;code>~/.xsession&lt;/code> 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:&lt;code>sudo apt purge i3&lt;/code> or &lt;code>sudo apt purge openbox&lt;/code>&lt;/p>
&lt;h3 id="novnc-vnc为什么是黑屏">novnc vnc为什么是黑屏
&lt;/h3>&lt;p>就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 右键 有惊喜！&lt;/p>
&lt;h3 id="怎么启动shell-和常见快捷键">怎么启动shell 和常见快捷键
&lt;/h3>&lt;p>基本是i3 的默认快捷键&lt;br>
点屏幕顶部的 Apps&amp;gt; 系统 &amp;gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）&lt;br>
如果是rdp远程桌面下，按下键盘 ： win+回车 &lt;br>
启动管理器（开始菜单） :win d&lt;br>
程序切换 alt+tab
修改窗口大小：按住win 再按住 鼠标右键 来回拖动&lt;br>
修改窗口位置：按住win 再按住 鼠标左键 来回拖动&lt;br>
关闭软件：win shift q&lt;br>
注销：win shift e&lt;br>
更多使用方法 自己看一下i3 使用说明&lt;/p>
&lt;h3 id="怎么装中文输入法">怎么装中文输入法
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-chinese-addons
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完成后，注销重新登录一次桌面，会自动加载，然后在托盘位置配置添加输入法即可，拼音输入法可导入搜狗细胞词库，具体自己研究。&lt;/p>
&lt;h3 id="怎么新建用户怎么删除默认用户">怎么新建用户怎么删除默认用户
&lt;/h3>&lt;h4 id="新建用户">新建用户
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo adduser YouName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -aG sudo YouName
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="新用户vnc密码">新用户vnc密码
&lt;/h5>&lt;p>ssh 或者 xrdp 登陆新用户后，运行 &lt;code>vncpasswd&lt;/code>&lt;/p>
&lt;h5 id="更新-vnc服务">更新 vnc服务
&lt;/h5>&lt;p>修改里面的用户名&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="删除默认用户">删除默认用户
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo deluser yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="怎么修改密码">怎么修改密码
&lt;/h3>&lt;h4 id="用户密码">用户密码
&lt;/h4>&lt;p>命令：&lt;code>passwd&lt;/code>&lt;/p>
&lt;h4 id="vnc密码">vnc密码
&lt;/h4>&lt;p>命令：&lt;code>vncpasswd .vnc/passwd&lt;/code> ，需要重启vnc服务，命令查看 &lt;code>cat /autoStart.sh &lt;/code>&lt;/p>
&lt;h3 id="x11转发模式如何使用输入法">x11转发模式如何使用输入法
&lt;/h3>&lt;p>修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 &lt;code>fcitx5&amp;amp;&lt;/code> 再执行对应的软件。&lt;/p>
&lt;h3 id="x11-转发模式部分软件很卡">x11 转发模式部分软件很卡
&lt;/h3>&lt;p>没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。&lt;/p>
&lt;h3 id="novnc默认地址">novnc默认地址
&lt;/h3>&lt;p>http://你的ip:8080/ 其中端口docker内部默认使用80，外部端口是你自己映射的。&lt;/p>
&lt;h3 id="novnc如何走https">novnc如何走https
&lt;/h3>&lt;p>建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。&lt;/p>
&lt;h3 id="20230704版本vnc连不上">20230704版本vnc连不上
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm /tmp/.X0-lock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器&lt;/p>
&lt;h3 id="如何关掉vnc">如何关掉vnc
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo rm /etc/supervisor/conf.d/novnc.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt purge tigervnc-standalone-server novnc python3-websockify
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 注释掉 /autoStart.sh 的启动命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># su -c &amp;#34;/usr/bin/vncserver -xstartup /usr/bin/i3 -geometry 1900x930 -localhost no :0 &amp;#34; yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># sudo apt autoremove &amp;amp;&amp;amp; sudo apt autoclean &amp;amp;&amp;amp; sudo apt clean # 可选清理操作
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后卸载&lt;/p>
&lt;h3 id="天气预报出错以及如何修改天气预报城市">天气预报出错以及如何修改天气预报城市
&lt;/h3>&lt;p>&lt;code>~/.config/polybar/weather-plugin.py&lt;/code> 这个文件
天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。&lt;br>
你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）&lt;br>
&lt;code>https://api.openweathermap.org/data/2.5/weather?id=1793724&amp;amp;appid=440b47a5ffbc5421e4a9befcbc4d635b&amp;amp;units=Metric&amp;amp;lang=zh_cn&lt;/code>&lt;br>
你如果不想用，直接在 polybar的配置文件里面删掉即可。&lt;/p>
&lt;h3 id="如何调音量">如何调音量
&lt;/h3>&lt;p>在i3配置文件里面修改&lt;br>
调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。&lt;br>
进阶用法，自己配置i3和polybar&lt;/p>
&lt;h3 id="vnc-和xrdp-桌面不同步">vnc 和xrdp 桌面不同步
&lt;/h3>&lt;p>是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。&lt;/p>
&lt;h3 id="novnc-网页访问按键失灵乱跳">noVNC 网页访问按键失灵乱跳
&lt;/h3>&lt;p>1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法&lt;br>
2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。&lt;/p>
&lt;h3 id="没声音或者--顶部音量不显示">没声音或者 顶部音量不显示
&lt;/h3>&lt;h4 id="vnc-和x11-没声音">vnc 和x11 没声音
&lt;/h4>&lt;p>vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp&lt;/p>
&lt;h4 id="xrdp的polybar-偶尔不显示音量">xrdp的polybar 偶尔不显示音量
&lt;/h4>&lt;p>这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。&lt;br>
临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">killall pulseaudio &amp;amp;&amp;amp; pulseaudio &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh .config/polybar/polybar_run.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="如何修改分辨率">如何修改分辨率
&lt;/h3>&lt;h4 id="vnc-novnc">vnc novnc
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /autoStart.sh # geometry 后面的参数是vnc的分辨率
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="xrdp">xrdp
&lt;/h4>&lt;p>xrdp的分辨率 由你的客户端 发起的时候配置&lt;/p>
&lt;h3 id="openbox的壁纸点好多次才换一张">openbox的壁纸点好多次才换一张
&lt;/h3>&lt;p>壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。&lt;/p>
&lt;h3 id="自己添加开机启动项">自己添加开机启动项
&lt;/h3>&lt;p>三个方法&lt;/p>
&lt;ul>
&lt;li>跟随 i3桌面启动的软件，可以添加到i3 配置文件中。例如截图软件，蓝牙托盘等等&lt;/li>
&lt;li>后台服务，可以添加到 /autoStart.sh&lt;/li>
&lt;li>需要守护的后台服务 添加到 supervisor中目录： /etc/supervisor/conf.d/&lt;/li>
&lt;/ul>
&lt;h3 id="安装常用软件">安装常用软件
&lt;/h3>&lt;p>点屏幕左上角 APPS &amp;gt; 系统 &amp;gt; 终端 输入 &lt;code>apt install &lt;/code>命令；启动软件 APPS &amp;gt; 系统 &amp;gt; &lt;code>rofi-run&lt;/code> 选择软件或者输入软件名称&lt;br>
或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install firefox-esr # 火狐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install thunar nemo nautilus # 任选一个 dolphin有依赖冲突哈 ，参考后面 libpulse-mainloop-glib0 错误的说明
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="libpulse-mainloop-glib0-错误">libpulse-mainloop-glib0 错误
&lt;/h4>&lt;p>libpulse-mainloop-glib0 : Depends: libpulse0 (= 16.1+dfsg1-2+b1) but 1:13.99.1-1ubuntu3.10 is to be installed
部分软件 例如 pavucontrol dolphin 需要新版 libpulse0，但是因为 考虑到pulseaudio-module-xrdp 稳定性，我用的旧版本。
你可以卸载掉，然后重新编译pulseaudio-module-xrdp。&lt;/p>
&lt;h3 id="不喜欢默认用户的shell">不喜欢默认用户的shell
&lt;/h3>&lt;p>默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 &lt;br>
然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可&lt;/p>
&lt;h3 id="pve-lxc-ct-或者docker宿主机-目录映射-和显卡等">pve lxc ct 或者docker宿主机 目录映射 和显卡等
&lt;/h3>&lt;h4 id="pve-硬盘到lxc">pve 硬盘到lxc
&lt;/h4>&lt;p>请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/&lt;/p>
&lt;h4 id="docker宿主机-目录映射">docker宿主机 目录映射
&lt;/h4>&lt;p>docker 创建命令 里面的 &lt;code>-v /mnt:/disk &lt;/code> 就是把上层宿主的 /mnt 穿透到容器内部的/disk。
注意权限问题哈，可以用uid映射方法，权限要求不严格 也可以直接 &lt;code>chmod -R 777 /mnt&lt;/code>解决&lt;/p>
&lt;h4 id="如何使用显卡加速">如何使用显卡加速
&lt;/h4>&lt;p>以nvidia为例在创建docker的时候 把显卡挂进去即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --restart=always \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name debian-i3 --hostname debian-i3 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 3389:3389 -p 2222:22 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 8080:8080 -p 5900-5905:5900-5905 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /mnt:/disk \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia0:/dev/nvidia0 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidiactl:/dev/nvidiactl \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia-uvm:/dev/nvidia-uvm \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e TZ=Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="目录和文件说明">目录和文件说明
&lt;/h3>&lt;h4 id="启动文件">启动文件
&lt;/h4>&lt;p>启动文件分两个&lt;/p>
&lt;ul>
&lt;li>/autoStart.sh 启动vnc 并启动supervisord&lt;/li>
&lt;li>/etc/supervisor/conf.d/ supervisord 服务目录&lt;/li>
&lt;/ul>
&lt;h4 id="i3-配置文件">i3 配置文件
&lt;/h4>&lt;p>/home/yanhui/.config/i3/config&lt;/p>
&lt;h4 id="openbox配置文件">openbox配置文件
&lt;/h4>&lt;p>/home/yanhui/.config/openbox/menu.xml #右键菜单&lt;br>
feh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本&lt;/p>
&lt;h4 id="壁纸目录">壁纸目录
&lt;/h4>&lt;p>i3配置文件调用feh随机选
/home/yanhui/.config/i3/bg/&lt;/p>
&lt;h4 id="polybar">polybar
&lt;/h4>&lt;ul>
&lt;li>/home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单&lt;/li>
&lt;li>/home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本&lt;/li>
&lt;li>/home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。&lt;/li>
&lt;/ul>
&lt;h4 id="rofi">rofi
&lt;/h4>&lt;p>/home/yanhui/.config/rofi/config.rasi&lt;/p>
&lt;h4 id="dunst">dunst
&lt;/h4>&lt;p>/home/yanhui/.config/dunst/dunstrc&lt;/p>
&lt;h4 id="alacritty">alacritty
&lt;/h4>&lt;p>/home/yanhui/.config/alacritty/alacritty.yml&lt;/p>
&lt;h4 id="zsh">zsh
&lt;/h4>&lt;p>/home/yanhui/.zshrc
/home/yanhui/.oh-my-zsh&lt;/p></description></item><item><title>linux-live环境定制 可U盘硬盘或者iso启动</title><link>https://dev.leiyanhui.com/linux/linux-live-diy/</link><pubDate>Sat, 03 Jun 2023 00:01:20 +0800</pubDate><guid>https://dev.leiyanhui.com/linux/linux-live-diy/</guid><description>&lt;h1 id="目标">目标
&lt;/h1>&lt;p>创建一个可以在fat/exfat/ext4 以及U盘 光盘可以启动的自定义linux系统环境&lt;/p>
&lt;h1 id="基于">基于
&lt;/h1>&lt;p>debian11 ：http://mirror.lzu.edu.cn/debian-cd/11.7.0/amd64/iso-dvd/debian-11.7.0-amd64-DVD-1.iso&lt;br>
其他linux系统差不多
脚本工具：http://linux-live.org/&lt;/p>
&lt;h1 id="原理">原理
&lt;/h1>&lt;p>基于自定义的initramfs挂载和启动到squashfs只读镜像启动默认的linux环境。&lt;br>
在只读媒体上，修改点映射到内存。&lt;br>
在linux原生磁盘分区上，修改内容映射到指定目录。 在fat exfat等磁盘分区上修改内容映射到data文件（限制12-16G）&lt;/p>
&lt;h1 id="基本步骤实现">基本步骤实现
&lt;/h1>&lt;p>新机器安装一个干净的linux 并必须安装以下工具包&lt;code>squashfs-tools genisoimage 或者 mkisofs zip&lt;/code>
另外 需要 &lt;code> xz rsync sshd sudo wget unzip nano&lt;/code> 等&lt;/p>
&lt;h1 id="打包">打包
&lt;/h1>&lt;h2 id="打包工具">打包工具
&lt;/h2>&lt;p>用 linux-live.org 的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir /mklive &amp;amp; cd /mklive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/Tomas-M/linux-live/archive/refs/heads/master.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unzip master.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd linux-live-master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="配置">配置
&lt;/h2>&lt;p>需要配置config 文件里面分别是&lt;/p>
&lt;ul>
&lt;li>LIVEKITNAME 目录 通常不需要修改&lt;/li>
&lt;li>VMLINUZ 内核位置，非chroot情况可以不修改，chroot过来的花需要修改为实际的内核路径，并且需要修改引导的cfg&lt;/li>
&lt;li>KERNEL 内核版本 通常不需要修改&lt;/li>
&lt;li>MKMOD 包含的目录，通常不需要修改，如果你有其他目录 单独加上&lt;/li>
&lt;li>NETWORK 是否支持网络引导 通常不需要修改&lt;/li>
&lt;li>LIVEKITDATA 最后打包的目标目录，其中包含 syslinux引导以及squashfs镜像和一些其他文件&lt;/li>
&lt;li>BEXT squashfs文件后缀名称 通常不需要修改&lt;/li>
&lt;li>LMK 内核ko模块目录，通常不需要修改&lt;/li>
&lt;/ul>
&lt;h2 id="创建">创建
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">./build
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>会在LIVEKITDATA指定的目录创建sb文件 initramfs 和其他需要的文件 也会吧内核复制一份过去
如果是alpine的话需要注意base的处理，另外&lt;code>initramfs/initramfs_create&lt;/code> 也需要执行权限。&lt;/p>
&lt;h2 id="打包-1">打包
&lt;/h2>&lt;p>最终的文件 是 在 /tmp/linux-data-XXX 目录 直接执行&lt;code>/tmp/gen_linux_zip.sh&lt;/code> 就可以了打包成zip 了，解压到U盘 或者硬盘 linux 或许win 执行里面的 bootinst.sh/bat 即可在对应设备上创建好引导。默认是用的syslinux引导的。
如果打包iso的话，默认不支持EFI启动。&lt;/p>
&lt;h2 id="启动背景">启动背景
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/tmp/linux-data-XXX/linux/boot/bootlogo.png
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>网上找了一个 &lt;a class="link" href="https://raw.githubusercontent.com/xenlism/Grub-themes/main/xenlism-grub-1080p-Debian/Xenlism-Debian/background.png" target="_blank" rel="noopener"
>https://raw.githubusercontent.com/xenlism/Grub-themes/main/xenlism-grub-1080p-Debian/Xenlism-Debian/background.png&lt;/a>
不合适&lt;/p>
&lt;h4 id="修改readme">修改readme
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat &amp;gt; ./readme.txt &amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Default (SeaBIOS) use syslinux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OVMF (UEFI) use grub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>打包iso&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/tmp/gen_linux_iso.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="测试">测试
&lt;/h1>&lt;p>pve 宿主机复制出来&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rsync yanhui@10.1.1.239:/tmp/linux-x86_64.iso /exfat/iso/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="efi启动">efi启动
&lt;/h1>&lt;h2 id="硬盘efigrub启动">硬盘efi+grub启动
&lt;/h2>&lt;p>自带一硬盘启动的sh和bat自动处理脚本，并支持 bios+syslinux 和 efi+syslinux
如果要修改为grub参考
&lt;a class="link" href="https://github.com/beatfan/UEFI_grub2/" target="_blank" rel="noopener"
>https://github.com/beatfan/UEFI_grub2/&lt;/a>&lt;/p>
&lt;h2 id="iso-efi-启动支持">iso efi 启动支持
&lt;/h2>&lt;p>自创建的iso支持bios启动，如果efi参考
&lt;a class="link" href="https://github.com/beatfan/USB_Boot_With_Grub_Grub2_ISOLINUX" target="_blank" rel="noopener"
>https://github.com/beatfan/USB_Boot_With_Grub_Grub2_ISOLINUX&lt;/a>&lt;/p></description></item><item><title>docker 配置一个支持sshd的debian</title><link>https://dev.leiyanhui.com/docker/debian-sshd/</link><pubDate>Tue, 29 Nov 2022 07:20:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-sshd/</guid><description>&lt;p>参考 &lt;a class="link" href="https://dev.leiyanhui.com/docker/alpine-sshd/" target="_blank" rel="noopener"
>docker中制作alpine+sshd的基础镜像&lt;/a>&lt;/p>
&lt;h2 id="选择基础系统镜像">选择基础系统镜像
&lt;/h2>&lt;p>还是考虑用debian系列，docker pull debian:bullseye-slim&lt;/p>
&lt;pre>&lt;code>docker run -itd --name debian-for-sshd -p 59010:2222 -p 59011:22 --privileged=true debian:bullseye-slim /bin/bash
docker exec -it debian-for-sshd /bin/bash
&lt;/code>&lt;/pre>
&lt;h2 id="安装sshd">安装sshd
&lt;/h2>&lt;h3 id="国内源更新安装sshd-nano-tzdata">国内源/更新/安装sshd nano tzdata
&lt;/h3>&lt;pre>&lt;code>sudo sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list
apt update
apt install openssh-server nano tzdata
cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/code>&lt;/pre>
&lt;h3 id="配置登录信息">配置登录信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sed -i &amp;#34;s/#PermitRootLogin.*/PermitRootLogin yes/g&amp;#34; /etc/ssh/sshd_config &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t dsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_dsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t rsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_rsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ecdsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ecdsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ed25519 -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ed25519_key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;root:root&amp;#34; | chpasswd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="打开sftp">打开sftp
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/pve/open-sftp/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/open-sftp/&lt;/a>&lt;/p>
&lt;h3 id="修改端口-为2222">修改端口 为2222
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/ssh restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="测试登录">测试登录
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ssh root@10.0.0.9 -p 59010
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置脚本自动启动">配置脚本自动启动
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;/etc/init.d/ssh start&amp;#34; &amp;gt; /autoboot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;tail -f /dev/null&amp;#34; &amp;gt;&amp;gt; /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后这行是防止退出的&lt;/p>
&lt;h3 id="清理">清理
&lt;/h3>&lt;pre>&lt;code>apt clean
apt autoclean
&lt;/code>&lt;/pre>
&lt;h3 id="备份容器">备份容器
&lt;/h3>&lt;p>在宿主机运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 打包压缩&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">gzip&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#备份&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">smb&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删除旧的容器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="创建新容器">创建新容器
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat debian11-for-sshd.tar.gz | docker import - debian11:sshd-autoboot.sh2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --name debian-go-codeserver-git --privileged=true \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 59010:2222 -p 59011-59019:59011-59019 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">debian11:sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以直接用我放在阿里云上的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --name debian-go-codeserver-git --privileged=true \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 59010:2222 -p 59011-59019:59011-59019 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">registry.cn-qingdao.aliyuncs.com/joyanhui/base-sh-debian:debian11-sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="搞其他的">搞其他的
&lt;/h3>&lt;p>ssh 连接上随便玩起来，如果要添加跟随容器启动的程序 就编辑 /autoboot.sh&lt;/p></description></item><item><title>pve/debian11 开启smb和 虚拟机以及局域网其他设备共享</title><link>https://dev.leiyanhui.com/pve/open-smb/</link><pubDate>Tue, 29 Nov 2022 00:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/pve/open-smb/</guid><description>&lt;blockquote>
&lt;p>win8以后的win系统默认不支持smb1，记得添加smb1的支持后方可&lt;/p>&lt;/blockquote>
&lt;h3 id="更新源到国内">更新源到国内
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/pve/guonei/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/guonei/&lt;/a>&lt;/p>
&lt;h3 id="安装smb">安装smb
&lt;/h3>&lt;pre>&lt;code>apt-get install samba
&lt;/code>&lt;/pre>
&lt;h3 id="启动">启动
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">systemctl enable smbd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start smbd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart smbd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="root直接使用">root直接使用
&lt;/h3>&lt;blockquote>
&lt;p>自己用的话，直接用root用户 就好了
设置root用户的 smb的密码 &lt;code>smbpasswd -a root &lt;/code> 这个密码和root的管理密码无关&lt;/p>&lt;/blockquote>
&lt;pre>&lt;code>nano /etc/samba/smb.conf
&lt;/code>&lt;/pre>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[nvme]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> comment = Share-rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path = /nvme
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> available = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> browsable = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> public = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> writable = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid users = root
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置账号">配置账号
&lt;/h3>&lt;pre>&lt;code>smbpasswd -a 【用户名】
&lt;/code>&lt;/pre>
&lt;p>需要提前新建用户&lt;/p>
&lt;pre>&lt;code>addgroup wheel
useradd -m -G wheel -s /bin/bash 【用户名】
passwd 【用户名】
#最好顺带配置一下sudo https://dev.leiyanhui.com/arch/base-install/#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7
# 或者干脆 groupadd test -g 6000&amp;amp; useradd test -u 6000 -g 6000 -s /sbin/nologin -d /dev/null
&lt;/code>&lt;/pre>
&lt;h3 id="配置共享">配置共享
&lt;/h3>&lt;pre>&lt;code>nano /etc/samba/smb.conf
&lt;/code>&lt;/pre>
&lt;p>添加内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[shareMNT]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> comment = Share-rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ;共享目录全路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path = /mnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> available = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> browsable = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">;写入权限
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> public = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> writable = yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">;可访问的用户
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid users = yourUserName
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="可能还需要配置权限">可能还需要配置权限
&lt;/h3>&lt;pre>&lt;code>chmod -R 777 /mnt #简单一点
&lt;/code>&lt;/pre>
&lt;h3 id="关闭默认主目录">关闭默认主目录
&lt;/h3>&lt;p>把 homes 哪段删掉就好&lt;/p>
&lt;h3 id="其他命令">其他命令
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">smbpasswd -d 冻结用户，就是这个用户不能在登录了
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smbpasswd -e 恢复用户，解冻用户，让冻结的用户可以在使用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smbpasswd -n 把用户的密码设置成空.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 要在global中写入 null passwords -true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status nmbd // 查询SMB状态
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status smbd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl enable smbd // 允许SMB开机启动
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>pve 打开sftp 直接上传文件 debian centos arch 同理</title><link>https://dev.leiyanhui.com/pve/open-sftp/</link><pubDate>Sun, 27 Nov 2022 00:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/pve/open-sftp/</guid><description>&lt;p>客户端 可以用 winscp MobaXterm 或者 其他 支持 sftp的软件，直接上传文件。这对 新手（老手也是） 来说更方便。另外也可以挂载到alist统一管理。&lt;/p>
&lt;p>但是pve 默认是关闭 sftp的，打开方法也很简单。&lt;/p>
&lt;p>用 vim 或者 nano 编辑sshd配置文件，我这里用nano&lt;/p>
&lt;pre>&lt;code># apt install nano
# mkdir /root/other-etc-bak &amp;amp;&amp;amp; cp /etc/ssh/sshd_config /root/other-etc-bak
nano /etc/ssh/sshd_config
&lt;/code>&lt;/pre>
&lt;p>往下翻，找到&lt;code>Subsystem sftp /usr/lib/openssh/sftp-server&lt;/code> 这行，注释掉，然后添加一行&lt;code>Subsystem sftp internal-sftp&lt;/code>&lt;/p>
&lt;pre>&lt;code>#Subsystem sftp /usr/lib/openssh/sftp-server
Subsystem sftp internal-sftp
&lt;/code>&lt;/pre>
&lt;p>重启ssh&lt;/p>
&lt;pre>&lt;code>/etc/init.d/ssh restart
&lt;/code>&lt;/pre>
&lt;p>使用支持sftp的客户端 重新登录ssh&lt;/p>
&lt;p>搞定&lt;/p></description></item><item><title>纯docker无盘打造个人媒体中心</title><link>https://dev.leiyanhui.com/docker/mediavodcenter/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/mediavodcenter/</guid><description>&lt;p>博主 已经全部切换到 lxc 方案。暂时抛弃Nastools
2023-02-17 后使用的方案为：全lxc 每个lxc运行1-多个服务 分开管理&lt;/p>
&lt;ul>
&lt;li>lxc 10000 alpine 运行 cloudereve + rclone（挂载cr的webdav） + smb + sftp&lt;/li>
&lt;li>lxc 10001 alpine 运行 alist 挂网盘&lt;/li>
&lt;li>lxc 10002 alpine 运行 aria2+ariaNG 和 cloudereve 直通同一个硬盘 处理离线下载&lt;/li>
&lt;li>lxc 10003 alpine 运行 rclone +crontab 和 duplicati 同步 以及 加密备份文件 到 云盘&lt;/li>
&lt;li>lxc 10010 alpine 运行 nginx + docker版onlyoffice 和cloudereve配合处理在线文档&lt;/li>
&lt;li>其他 更多 查看原文：&lt;a class="link" href="https://dev.leiyanhui.com/pve/lxc-nas/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/lxc-nas/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="目标和环境">目标和环境
&lt;/h2>&lt;h3 id="环境">环境
&lt;/h3>&lt;p>在一个弱鸡电脑上（N2600+4G+32G）用纯docker搭建个人媒体中心&lt;/p>
&lt;p>并配合 阿里云盘 或者本地硬盘 实现大容量储存，&lt;/p>
&lt;h3 id="目标">目标
&lt;/h3>&lt;p>自动搜索下载自己在豆瓣或者微信标注的影片，并存储到阿里云盘，可以用emby或者阿里云盘客户端app播放。
进阶目标：自动清理删除许久为观看的电影 节省阿里云盘空间。我只有4T啊。。&lt;/p>
&lt;h2 id="前置准备工作">前置准备工作
&lt;/h2>&lt;p>docker 环境 【&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openwrt-plus/" target="_blank" rel="noopener"
>openwrt下docker的和其他插件的安装&lt;/a>和&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/docker-cant-network/" target="_blank" rel="noopener"
>网络异常处理&lt;/a>】&lt;br>
豆瓣账号&lt;br>
我这里docker 就是路由器系统是openwrt,其他linux 操作一样。&lt;/p>
&lt;h2 id="准备储存">准备储存
&lt;/h2>&lt;p>我这里没有额外的多余硬盘做这个工作，所以直接使用阿里云盘了。&lt;br>
先把阿里云盘挂载到本地。具体方法查看： &lt;a class="link" href="https://dev.leiyanhui.com//openwrt/rclone/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com//openwrt/rclone/&lt;/a>&lt;br>
如果你有其他硬盘 最好格式好后自行挂载到宿主机。
我这里单独挂载一个 阿里云盘的目录 空白目录MediaVodCenter 到 &lt;code>/mnt/MediaVodCenter&lt;/code> 稍后会从云盘里面 移动之前的硬盘过来，也会测试下载功能，之所以单独创建一个目录，是为了避免误操作丢失文件&lt;/p>
&lt;blockquote>
&lt;p>使用阿里云盘 就要忍受 刷新延迟带来的麻烦哈。肯定没有本地磁盘来的反应速度快，这个是无论如何也解决不聊的。只能忍受了哦&lt;/p>&lt;/blockquote>
&lt;h2 id="安装配置nastools-媒体中心">安装配置Nastools 媒体中心
&lt;/h2>&lt;h3 id="docker安装nastools">docker安装Nastools
&lt;/h3>&lt;p>我这里是openwrt 直接用root用户，如果你用其他用户管理，自行查看Nastools文档 &lt;a class="link" href="https://github.com/jxxghp/nas-tools" target="_blank" rel="noopener"
>https://github.com/jxxghp/nas-tools&lt;/a>
Nastools 的配置项众多，而且可能会出现依赖变动无法更新的情况，所以单独创建一个目录储存系统配置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir /mnt/config_MediaVodCenter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">itd&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">hostname&lt;/span> &lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">50300&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MediaVodCenter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MediaVodCenter&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config_MediaVodCenter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PGID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">UMASK&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">REPO_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">ghproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jxxghp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">git&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">NASTOOL_AUTO_UPDATE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jxxghp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>http://IP:50300/ 去登录，这个docker启动略微慢，稍微等待 默认用户密码：admin/password&lt;/p>
&lt;h3 id="初步配置nastools">初步配置Nastools
&lt;/h3>&lt;p>修改账户名密码，配置。系统提示还要配置&lt;code>TMDB API Key &lt;/code> 下一步去申请&lt;/p>
&lt;h4 id="注册申请tmdb">注册申请TMDB
&lt;/h4>&lt;p>网址 ： &lt;a class="link" href="https://www.themoviedb.org/signup" target="_blank" rel="noopener"
>https://www.themoviedb.org/signup&lt;/a> 网站虽然是中文的，但是在境外，可能会打不开，挂科研软件或者修改hosts&lt;br>
注册完成以后登录TMDB，点击首页右上角的头像→帐户设置。&lt;br>
点击左侧列表的API，然后点击请求API秘钥下面的 click here 再点击 开发者（developer） 同意协议后，继续填写&lt;/p>
&lt;p>简介的地方填写选择 个人 名称“家用” 地址，写一个内网地址，&lt;code>10.0.0.1&lt;/code> 简介&lt;code>Meet personalized needs, enrich website interfaces and functions&lt;/code>&lt;/p>
&lt;p>会马上生气申请成功，&lt;code>API 密钥 (v3 auth)&lt;/code> 里面的内容就是我们需要的&lt;code>TMDB API Key &lt;/code>&lt;/p>
&lt;h4 id="继续配置媒体部分设置">继续配置媒体部分设置
&lt;/h4>&lt;p>输入上面获取到&lt;code>TMDB API Key &lt;/code> TMDB域名 选择你不挂梯子能打开的 ， 默认文件转移方式 我这里是rclone挂载的阿里云盘 就选择 rclone移动，如你的是物理硬盘或者 nas 自行选择其他方法。&lt;/p>
&lt;h4 id="准备和配置豆瓣">准备和配置豆瓣
&lt;/h4>&lt;h5 id="豆瓣id">豆瓣id
&lt;/h5>&lt;p>暂时先只配置豆瓣id ，注册一个豆瓣账号，点个人中心 个人主页 地址栏地址 类似 &lt;code>https://www.douban.com/people/88888/?_i=99999 &lt;/code> 其中888 就是我们的豆瓣id&lt;/p>
&lt;h5 id="都把cookies">都把cookies
&lt;/h5>&lt;p>随便打开一个豆瓣内容页 例如&lt;code>https://movie.douban.com/subject/35197639/&lt;/code> 按F12键(chrome类浏览器)，弹出如图所示的开发页面。点击Network&lt;/p>
&lt;p>首先点击左上角一个灰色的圈圈，把下面东西的清除一下&lt;/p>
&lt;p>刷新这个页面，你可以点刷新按钮或者F5键&lt;/p>
&lt;p>Network页面开始弹出一些东西，不要怕，向上划找到 “35197639/”这一个 然后看右侧的 cookies，找到你的dbcl2，这是根据分号（;）分割的，你把dbcl2:xxx复制下来。（不要把分号复制进来）例：&lt;code>dbcl2=&amp;quot;8888888:AAAAAA&amp;quot;&lt;/code>&lt;/p>
&lt;h6 id="配置nastools中的豆瓣id和cookies">配置Nastools中的豆瓣id和cookies
&lt;/h6>&lt;p>打开nastools ，左侧 设置 豆瓣，分别输入对应的id 数字 和上面的 &lt;code>dbcl2=&amp;quot;8888888:AAAAAA&amp;quot;&lt;/code> 其他也根据需要设置一下&lt;/p>
&lt;h3 id="安装下载工具qbittorrent">安装下载工具qBittorrent
&lt;/h3>&lt;p>我这里用qBittorrent ,并省略了config目录的映射&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">bt&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">WEBUI_PORT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">50808&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">9821&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6881&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">9821&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6881&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">50808&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">50808&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MediaVodCenter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">downloads&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span> &lt;span class="n">unless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stopped&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">linuxserver&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">qbittorrent&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置qbittorrent">配置qBittorrent
&lt;/h3>&lt;p>访问&lt;code>http://10.0.0.1:50808/&lt;/code> webUI 账户：admin 密码：adminadmin&lt;br>
点 Tools -&amp;gt; options 打开设置窗口 选择 webui 设置用户名 密码 还有 语言简体&lt;/p>
&lt;h3 id="配置nastools的下载工具">配置Nastools的下载工具
&lt;/h3>&lt;p>http://10.0.0.1:50300/ 设置 下载器 选择 qBittorrent 地址输入 宿主地址 10.0.0.1 端口 上面的WEBUI_PORT 50808 输入上面设置的用户密码，测试成功&lt;/p>
&lt;h3 id="安装媒体中心jellyfin">安装媒体中心jellyfin
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name=jellyfin \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50096:8096 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 7359:7359/udp \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 1900:1900/udp \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /mnt/jellyfin_config:/config \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /mnt/MediaVodCenter:/data \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --restart unless-stopped \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> linuxserver/jellyfin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个地方 需要注意 /config 目录会吃硬盘空间，某些情况下可能会高达几十个G 注意经常检查,这个是无法避免的&lt;/p>
&lt;blockquote>
&lt;p>硬解问题，稍后晚点配置.我的显示是N2600带的核显GMA3600，上古设备，那时候intel并未开源驱动，所以也就无法硬解。硬解问题，之后会挪到另外一台主机上进行处理。&lt;/p>&lt;/blockquote>
&lt;h3 id="配置-jellyfin">配置 jellyfin
&lt;/h3>&lt;p>打开 &lt;code>http://10.0.0.1:50096/&lt;/code> 按照提示设置，注意创建文件夹的时候 选择/data&lt;/p>
&lt;p>然后 点左侧 三个点 打开设置 控制台 高级 api 生成 记住这个 api&lt;/p>
&lt;h3 id="再nastools-配置jellyfin">再Nastools 配置jellyfin
&lt;/h3>&lt;p>http://10.0.0.1:50300/ 设置 媒体服务器 选择jellyfin 地址输入上面 &lt;code>http://10.0.0.1:50096/&lt;/code> apikey 输入刚刚的生成的&lt;/p>
&lt;h3 id="收工">收工！
&lt;/h3>&lt;h3 id="结尾的话">结尾的话
&lt;/h3>&lt;p>N2600 性能堪忧，我最终 还是切换到了 i7 8代主机上&lt;/p></description></item></channel></rss>