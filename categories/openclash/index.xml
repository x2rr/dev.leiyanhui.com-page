<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Openclash on 小类随手记</title><link>https://dev.leiyanhui.com/categories/openclash/</link><description>Recent content in Openclash on 小类随手记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 03 Oct 2024 12:14:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/categories/openclash/index.xml" rel="self" type="application/rss+xml"/><item><title>爱快无感分流 自动更新规则 ikuai-bypass 修改版</title><link>https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui/</link><pubDate>Thu, 03 Oct 2024 12:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui/</guid><description>&lt;h2 id="更新说明">更新说明
&lt;/h2>&lt;p>旧版文档地址:&lt;a class="link" href="https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui-old/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui-old/&lt;/a> 本文内容未覆盖到信息请参考旧版文档。&lt;/p>
&lt;h2 id="项目说明">项目说明
&lt;/h2>&lt;p>ikuai-bypass 是一个自动维护爱快分流规则的小工具，基于golang开发。
项目地址 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/" target="_blank" rel="noopener"
>https://github.com/joyanhui/ikuai-bypass/&lt;/a>&lt;/p>
&lt;h2 id="爱快分流原理">爱快分流原理
&lt;/h2>&lt;p>爱快分流方式不同与传统的旁路由方案，更加直观，速度也更加好。&lt;br>
下述文档中 以爱快+openwrt为例，（实际上 openwrt可以用其他linux甚至win/macos替代，只要能运行你想要的对应的工具即可。可以在docker/lxc/kvm/vmware/virtuabox/物理设备）中运行openwrt.&lt;br>
分流方式主要有两种：
1、isp分流和域名分流配合： 基于爱快的自定义isp的ip功能，实现针对wan口的分流，把非国内ip和部分域名分流到wan2口由openwrt处理后 回流到wan1，国内ip和国内大站直接分流到wan1。&lt;br>
2、ip分组+端口分流和下一跳网关： 基于爱快的ip分组功能和端口分流功能，把国内ip直接走wan1,其他ip或者指定的ip用下一跳网关的方式到达openwrt再回流到wan1。&lt;/p>
&lt;h2 id="爱快分流的优点">爱快分流的优点
&lt;/h2>&lt;ul>
&lt;li>比单openwrt方案更加直观容易维护&lt;/li>
&lt;li>比旁路由方案更加稳定 速度也好很多。&lt;/li>
&lt;li>和自建dns配合更简单。&lt;/li>
&lt;/ul>
&lt;h2 id="openwrt的安装方式">openwrt的安装方式
&lt;/h2>&lt;p>以下均为有效的方式 ，这里的openwrt泛指可以运行你喜欢的那些工具的系统。&lt;/p>
&lt;ul>
&lt;li>爱快内的docker 其他设备的docker 或者lxc运行的openwrt或者其他配置好的系统。&lt;/li>
&lt;li>爱快内的kvm 或者其他的 kvm vmware virtualbox 和hyper-v 等虚拟机系统。&lt;/li>
&lt;li>双网口设备 / 单网口设备。&lt;/li>
&lt;li>测试过的系统 openwrt 老毛子 alpine macos11-15 win8-11 debian pve opensuse nixos &amp;hellip;..&lt;/li>
&lt;li>支持的深度学习工具软件：暂时未发现无法支持的工具。&lt;/li>
&lt;/ul>
&lt;h2 id="常规使用方式--isp分流和域名分流配合">常规使用方式 isp分流和域名分流配合
&lt;/h2>&lt;p>较为复杂，但是高可用性网络自愈性比较好。&lt;/p>
&lt;h3 id="简单说明">简单说明
&lt;/h3>&lt;p>建议在pve/esxi/unraid/群晖/docker/lxc/podman中运行爱快+openwrt，当然也可以物理设备。 &lt;br>
单网卡 pve测试没问题，其他环境同样不会有问题。
爱快3个或者3个以上网卡/虚拟网卡 作为主路由&lt;br>
openwrt/其他linux 双网卡/虚拟网卡，作为下级路由（非旁路由）&lt;/p>
&lt;h3 id="pve下推荐配置">pve下推荐配置
&lt;/h3>&lt;p>推荐 2G内存安装ikuai 32位版，硬盘1G即可，然后修改为 512M内存&lt;br>
openwrt 官方版，或者自编译版本 内存 256-512M（开clash要300M，v2系256M就可以） 硬盘512M即可，或者看你img的分区。或lxc运行&lt;br>
iKuai Bypass 运行在 openwrt &lt;br>
mosdns 也可以运行在 openwrt &lt;a class="link" href="https://dev.leiyanhui.com/route/mosdns-all-in-one/" target="_blank" rel="noopener"
>mosdns all in one方案&lt;/a> &lt;a class="link" href="https://dev.leiyanhui.com/route/safe-dns/" target="_blank" rel="noopener"
>modns配adg方案&lt;/a>
64位 爱快，kvm/docker 运行 openwrt 和 iKuai Bypass 以及 mosdns 也可以，但是不推荐。&lt;/p>
&lt;h3 id="物理网络虚拟网卡配置-举例">物理网络/虚拟网卡配置 举例
&lt;/h3>&lt;p>爱快 lan1 绑定到 eth0 开DHCP dhcp范围 10.1.1.5-10.1.1.254&lt;br>
爱快 wan1 绑定到 eth1 pppoe拨号 wan1先设置为默认线路
爱快 wan2 绑定到 eth2 静态ip指定 10.0.0.2 网关10.0.0.1&lt;/p>
&lt;p>openwrt wan 绑定到eth0 DHCP客户端，连接到爱快lan1 从爱快静态ip绑定为10.1.1.3 &lt;br>
openwrt lan 绑定套eth1 关闭DHCP服务，ip地址配置 10.0.0.1 即为爱快wan2的上游网关&lt;/p>
&lt;blockquote>
&lt;p>openwrt的两个网口绑定到那个eth不影响使用,用默认的就好。&lt;/p>&lt;/blockquote>
&lt;p>可以参考top图&lt;a class="link" href="https://raw.githubusercontent.com/joyanhui/ikuai-bypass/refs/heads/main/assets/img.png" target="_blank" rel="noopener"
>github&lt;/a>&lt;/p>
&lt;p>下文说配置都以上述为例&lt;/p>
&lt;h3 id="避免死循环">避免死循环
&lt;/h3>&lt;p>在爱快内手动添加一个分流规则 流控分流 &amp;gt; 分流设置 &amp;gt; 端口分流&lt;br>
分流方式：外网线路 线路：wan1 源地址 ip/mac分组 添加一个 10.1.1.3 点加入 保存&lt;br>
此时 openwrt出来的流量 走wan1 不会再到wan2回到openwrt 导致死循环。&lt;br>
此时openwrt 可以正常访问外部网络。&lt;br>
注意：备注不建议包含字符：&lt;code>IKUAI_BYPASS&lt;/code> ，否则有概率会被ikuai_bypass工具清理掉。&lt;/p>
&lt;h3 id="配置--wan2-为默认线路">配置 wan2 为默认线路
&lt;/h3>&lt;p>此时所有对外网访问 都会 经过wan2 到openwrt,然后根据你的深度学习软件的分流情况决定是否加密，再回到爱快的lan1 再流向外网。&lt;br>
此时你的上网速度和传统的旁路由模式完全一样，略慢。&lt;/p>
&lt;h3 id="配置国内域名强制走wan1直连">配置国内域名强制走wan1直连
&lt;/h3>&lt;p>流控分流 &amp;gt; 分流设置 &amp;gt; 域名分流，选择wan1 ，输入几个域名，输入客户端ip,建议 10.1.1.5-10.1.1.254 ，此时10.1.1.5-10.1.1.254 的设备访问这个域名会直接走wan1 , 不经过openwrt，速度飞快。&lt;br>
当然你自己输入太麻烦了。ikuai-bypass 可以自动帮你维护这个域名列表，通过ikuai-bypass可以自己托管一个域名列表并保证规则的id是最大。&lt;/p>
&lt;h3 id="配置某些域名强制走wan2-交给openwrt处理">配置某些域名强制走wan2 交给openwrt处理
&lt;/h3>&lt;p>目的是啥，你肯定知道。配置和上面一样，同样 ikuai-bypass 可以自动帮你维护这个域名列表。&lt;/p>
&lt;h3 id="配置国内ip强制走wan1">配置国内ip强制走wan1
&lt;/h3>&lt;p>因为域名清单里面的域名不能覆盖所有网站，还有一些是没有域名直接ip连接情况。所以需要维护一个根据ip分流的规则。&lt;br>
流控分流 &amp;gt; 分流设置 &amp;gt; 多线负载 自定义运营商 添加运营商 名称：&lt;code>国内ip地址&lt;/code> 目的地址：输入几个国内的ip,备注：&lt;code>自定义&lt;/code>&lt;br>
返回 流控分流 &amp;gt; 分流设置 &amp;gt; 多线负载 点右侧添加 运营商：选择你刚刚添加的名称，点wan1 后面的启用，保存。&lt;br>
此时 你访问这个ip上的网站或者其他东西，会强制走wan1 不经过openwrt，速度飞快。 &lt;br>
同样 ikuai-bypass 可以自动帮你维护这个IP地址列表。&lt;/p>
&lt;h3 id="配置默认线路-确保网络100可用性">配置默认线路 确保网络100%可用性
&lt;/h3>&lt;p>把wan2 配置为默认线路，网络设置 &amp;gt; 内外网设置 wan2 同时打开&lt;/p>
&lt;ul>
&lt;li>默认网关：设此条线路为默认网关&lt;/li>
&lt;li>自动切换：掉线自动切换&lt;/li>
&lt;li>线路检测：HTTP &lt;a class="link" href="https://www.google.com" target="_blank" rel="noopener"
>www.google.com&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>此时，访问不在国内域名清单的域名，并且ip不再自定义运营商的&lt;code>国内ip地址&lt;/code>的服务器，会默认走wan2。如果openwrt死机或者google连不上，会自动临时禁用wan2 默认走wan1。&lt;/p>
&lt;h3 id="使用ikuai-bypass-自动维护ip和域名规则">使用ikuai-bypass 自动维护ip和域名规则。
&lt;/h3>&lt;p>较为简单&lt;/p>
&lt;h4 id="部署ikuai-bypass">部署ikuai-bypass
&lt;/h4>&lt;p>ikuai-bypass 只要部署在可以访问到 爱快路由器的地方即可。一般建议以服务模式直接部署到openwrt内。&lt;/p>
&lt;h4 id="服务模式-openwrtalpinercsystemd">服务模式 openwrt/alpine/rc/systemd
&lt;/h4>&lt;p>以openwrt为例 请参考 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/blob/main/script-example/AddOpenwrtService.sh" target="_blank" rel="noopener"
>github&lt;/a>&lt;/p>
&lt;h4 id="下载最新版">下载最新版
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/releases" target="_blank" rel="noopener"
>https://github.com/joyanhui/ikuai-bypass/releases&lt;/a>&lt;/p>
&lt;h4 id="配置文件">配置文件
&lt;/h4>&lt;p>需要自定义一个配置文件 config.yml 格式如下。&lt;br>
然后运行 &lt;code>./ikuai-bypass -c /路径/config.yml&lt;/code> 即可在启动时候 自动更新一次规则文件，并在 cron指定的时间内定时运行。&lt;br>
下面的配置文件 会执行一下操作&lt;/p>
&lt;ol>
&lt;li>自动登陆到 网址是 http://10.1.1.1 的爱快 使用用户名admin 密码 admin888登陆，如果登陆成功。&lt;/li>
&lt;li>运营商/IP分流规则 他会帮你添加 一个 &lt;code>国内IP列表&lt;/code> 的运营商，你需要去爱快 流控分流 &amp;gt; 分流设置 &amp;gt; 多线负载 添加规则，选择 国内IP列表 启用wan1&lt;br>
也会添加几个 telegram google 等ip地址，你可以删掉那几行，也可以添加规则 启用wan2&lt;/li>
&lt;li>另外会添加4个域名分流规则 分别强制走wan1 和wan2 你可以在下面配置文件清晰看到。需要注意的是 china-list 和 gfw两个清单 都很长，添加/更新的时候会很慢。你可以根据你的需求决定是否要保留，添加后会增加你访问网址的速度，但是会增加ikuai的性能消耗（大概增加30-120M内存消耗，cpu负载也会增加一点），如果你的ikuai配置很烂，可以去掉其他规则 只使用 国内IP列表 的IP分流即可 。&lt;/li>
&lt;/ol>
&lt;p>文件内容参考 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/blob/main/config.yml" target="_blank" rel="noopener"
>https://github.com/joyanhui/ikuai-bypass/blob/main/config.yml&lt;/a>&lt;/p>
&lt;h4 id="运行命令参考">运行命令参考
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">./ikuai-bypass -r cron -m ispdomain -c /opt/ikuai-bypass/config.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="另外一种使用方式-ip分组端口分流和下一跳网关">另外一种使用方式 ip分组+端口分流和下一跳网关
&lt;/h2>&lt;p>这种方式较为简单，并且不需要openwrt设备有2个网口。爱快也只需要2个网口。&lt;/p>
&lt;h3 id="网络结构">网络结构
&lt;/h3>&lt;p>爱快配置好wan1 和lan1 以及pppoe等 正常上网。&lt;/p>
&lt;h3 id="配置好一个openwrt">配置好一个openwrt
&lt;/h3>&lt;p>这里的openwrt依旧是泛指可以运行你想要的工具软件的系统，作为爱快的下级普通设备。 可以使用单臂路由，手动指定ip为 10.1.1.3 或者有ikuai的dhcp分配均可&lt;/p>
&lt;h3 id="避免死循环-1">避免死循环
&lt;/h3>&lt;p>参考上文&lt;/p>
&lt;h3 id="下一跳网关和ip分组">下一跳网关和ip分组
&lt;/h3>&lt;p>由ikuai-bypass来维护，从ikuai-bypass的配置文件中修改即可。&lt;/p>
&lt;h3 id="使用ikuai-bypass-自动维护ip分组端口分流和下一跳网关">使用ikuai-bypass 自动维护ip分组、端口分流和下一跳网关
&lt;/h3>&lt;h4 id="部署ikuai-bypass-1">部署ikuai-bypass
&lt;/h4>&lt;p>参考上文&lt;/p>
&lt;h4 id="配置文件-1">配置文件
&lt;/h4>&lt;p>参考上文&lt;/p>
&lt;h4 id="运行命令参考-1">运行命令参考
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">./ikuai-bypass -r cron -m ipgroup -c /opt/ikuai-bypass/config.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="docker">docker
&lt;/h3>&lt;p>我没有打包docker镜像，因为完全没必要，你可以自己用下面的命令启动一个docker &lt;br>
请参考 ： &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/blob/main/Dockerfile_example" target="_blank" rel="noopener"
>github&lt;/a>&lt;br>
以及 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/tree/main?tab=readme-ov-file#docker" target="_blank" rel="noopener"
>github的readme中的docker部分 &lt;/a>&lt;/p>
&lt;h2 id="常用参数">常用参数
&lt;/h2>&lt;p>最新的参数说明请参考github的文档桌面，这里更新可能存在滞后。&lt;/p>
&lt;ul>
&lt;li>&lt;code>-c&lt;/code> : 配置文件路径 默认为当前目录下&lt;code>config.yml&lt;/code> 可用相对路径或者绝对路径&lt;/li>
&lt;li>&lt;code>-m&lt;/code> : 是否启用ip分组和下一跳网关模式（端口分流）v2.0以后版本有效
&lt;ul>
&lt;li>&lt;code>ispdomain&lt;/code> : 使用isp和域名分流功能(默认，为了兼容v1.x版本)&lt;/li>
&lt;li>&lt;code>ipgroup&lt;/code> : 使用ip分组和下一跳网关模式（端口分流)&lt;/li>
&lt;li>&lt;code>ii&lt;/code> : 同时使用 上面两种模式&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>-r&lt;/code> : 运行模式 默认为&lt;code>cron&lt;/code>
&lt;ul>
&lt;li>&lt;code>cron&lt;/code> : 先运行一次 而后等待计划任务触发&lt;/li>
&lt;li>&lt;code>nocron&lt;/code> 或 &lt;code>once&lt;/code>或 &lt;code>1&lt;/code>: 忽略配置文件的cron定时配置配置 运行一次然后就直接退出结束，适合调试使用或者使用系统自带的计划任务或serverless/函数计算等方式触发。&lt;/li>
&lt;li>&lt;code>cronAft&lt;/code> : 先不运行等计划任务触发&lt;/li>
&lt;li>&lt;code>clean&lt;/code> : 清理模式 默认可选附加参数为 &lt;code>-tag cleanAll&lt;/code>&lt;/li>
&lt;li>&lt;code>exportDomainSteamToTxt&lt;/code> : 导出域名分流规则到txt文件模式 方便手动从爱快导入 默认可选附加参数为 &lt;code>-exportPath /tmp&lt;/code> 暂时只支持域名分流功能导出，&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>-tag&lt;/code> : 备注信息 &lt;code>clean&lt;/code>清理模式下的附加参数
&lt;ul>
&lt;li>默认为cleanAll(即清理所有备注中包含&lt;code>IKUAI_BYPASS&lt;/code>字符的规则)&lt;/li>
&lt;li>单独指定备注的关键词 可以不添写&lt;code>IKUAI_BYPASS_&lt;/code>前缀 例如&lt;code>-r clean -tag ipcn&lt;/code> 或 &lt;code>-r clean -tag IKUAI_BYPASS_ipcn&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>-exportPath&lt;/code> : 导出域名分流规则的路径&lt;/li>
&lt;li>&lt;code>-login&lt;/code> : ikuai登陆地址和账户密码，优先级比配置文件的优先级更高。格式: &lt;code>http://10.1.1.1,admin,password&lt;/code> 为空则使用配置文件内登陆信息&lt;/li>
&lt;li>&lt;code>-delOldRule&lt;/code> : 删除旧规则顺序，默认为 &lt;code>after&lt;/code>
&lt;ul>
&lt;li>&lt;code>after&lt;/code> : 先更新规则成功后再删除旧规则&lt;/li>
&lt;li>&lt;code>before&lt;/code> : 先删除旧规则再更新新规则，如果更新失败会丢失规则&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="其他补充">其他补充
&lt;/h2>&lt;p>本文有一定滞后性，内容以 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/" target="_blank" rel="noopener"
>https://github.com/joyanhui/ikuai-bypass/&lt;/a> 的最新说明为准。&lt;/p>
&lt;h3 id="自定义规则和ikuai-bypass的规则">自定义规则和ikuai-bypass的规则
&lt;/h3>&lt;p>ikuai-bypass 自动维护的规则 都会添加备注 &lt;code>IKUAI_BYPASS&lt;/code> ，只要你添加的自定义的规则备注不包含这个字符即可。&lt;/p>
&lt;h3 id="关于实例配置文件">关于实例配置文件
&lt;/h3>&lt;p>实例配置文件使用了 &lt;a class="link" href="https://mirror.ghproxy.com" target="_blank" rel="noopener"
>https://mirror.ghproxy.com&lt;/a> 作为github的代理方便可以在无科学环境更新规则，但是ghproxy有被gfw污染的先例，请自行更新更稳定的或者自建的github代理。&lt;br>
配置文件中有一些额外的选项和注释，可以自行酌情删除。&lt;/p>
&lt;h3 id="是否可以替代原版ikuai-bypass">是否可以替代原版ikuai-bypass
&lt;/h3>&lt;p>原版是基于docker的，所以也可以直接替代，参考上面的docker配置&lt;/p></description></item><item><title>爱快无感分流 自动更新规则 ikuai-bypass 修改版</title><link>https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui-old/</link><pubDate>Sun, 26 Nov 2023 12:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui-old/</guid><description>&lt;h2 id="分流说明">分流说明
&lt;/h2>&lt;p>使用爱快分流规则 + 一个二级路由的方式 实现比旁路由模式更稳定 速度更快的 深度学习网络。&lt;/p>
&lt;h2 id="ikuai-bypass修改版-说明">iKuai Bypass修改版 说明
&lt;/h2>&lt;p>项目地址 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/" target="_blank" rel="noopener"
>https://github.com/joyanhui/ikuai-bypass/&lt;/a>&lt;/p>
&lt;p>fork 自 &lt;a class="link" href="https://github.com/ztc1997/ikuai-bypass/" target="_blank" rel="noopener"
>https://github.com/ztc1997/ikuai-bypass/&lt;/a>&lt;/p>
&lt;h2 id="ikuai-bypass-功能">iKuai Bypass 功能
&lt;/h2>&lt;p>ip分流规则和域名分流规则添加到爱快的自定义运营商和域名分流，并自动更新规则文件。&lt;/p>
&lt;h2 id="更新">更新
&lt;/h2>&lt;ul>
&lt;li>并发处理 运营商/IP分流 和 域名分流&lt;/li>
&lt;li>更新成功后再删除旧规则&lt;/li>
&lt;li>支持无docker运行&lt;/li>
&lt;li>支持单次运行参数&lt;code>-r nocron&lt;/code>忽略配置文件的cron配置&lt;/li>
&lt;li>支持单独清理模式&lt;code>-r clean&lt;/code> 清理本工具添加的备注为&lt;code>IKUAI_BYPASS&lt;/code>的分流规则&lt;/li>
&lt;li>支持cron运行参数&lt;code>-r cron&lt;/code> &lt;code>-r cronAft&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="命令">命令
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">ikuai-bypass -c 配置文件路径 -r 运行模式
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>配置文件路径：默认为当前目录下的 config.yml&lt;/li>
&lt;li>运行模式&lt;/li>
&lt;li>cron 默认，会先执行一次然后使用配置文件的cron定时重复执行，如果cron为空那么执行依次后直接退出&lt;/li>
&lt;li>cronAft 不马上执行,等到cron定时任务触发后再执行&lt;/li>
&lt;li>nocron为单次执行 运行完成后自动推出&lt;/li>
&lt;li>clean 清理本工具添加的备注为&lt;code>IKUAI_BYPASS&lt;/code>的分流规则&lt;/li>
&lt;/ul>
&lt;h2 id="通常使用方法">通常使用方法
&lt;/h2>&lt;h3 id="简单说明">简单说明
&lt;/h3>&lt;p>建议在pve/esxi/unraid/群晖/docker/lxc/podman中运行爱快+openwrt，当然也可以物理设备。 &lt;br>
单网卡 pve测试没问题，其他环境同样不会有问题。
爱快3个或者3个以上网卡/虚拟网卡 作为主路由&lt;br>
openwrt/其他linux 双网卡/虚拟网卡，作为下级路由（非旁路由）&lt;/p>
&lt;h3 id="pve下推荐配置">pve下推荐配置
&lt;/h3>&lt;p>推荐 2G内存安装ikuai 32位版，硬盘1G即可，然后修改为 512M内存&lt;br>
openwrt 官方版，或者自编译版本 内存 256-512M（开clash要300M，v2系256M就可以） 硬盘512M即可，或者看你img的分区。或lxc运行&lt;br>
iKuai Bypass 运行在 openwrt &lt;br>
mosdns 也可以运行在 openwrt &lt;a class="link" href="https://dev.leiyanhui.com/route/mosdns-all-in-one/" target="_blank" rel="noopener"
>mosdns all in one方案&lt;/a> &lt;a class="link" href="https://dev.leiyanhui.com/route/safe-dns/" target="_blank" rel="noopener"
>modns配adg方案&lt;/a>
64位 爱快，kvm/docker 运行 openwrt 和 iKuai Bypass 以及 mosdns 也可以，但是不推荐。&lt;/p>
&lt;h2 id="物理网络虚拟网卡配置-举例">物理网络/虚拟网卡配置 举例
&lt;/h2>&lt;p>爱快 lan1 绑定到 eth0 开DHCP dhcp范围 10.1.1.5-10.1.1.254&lt;br>
爱快 wan1 绑定到 eth1 pppoe拨号 wan1先设置为默认线路
爱快 wan2 绑定到 eth2 静态ip指定 10.0.0.2 网关10.0.0.1&lt;/p>
&lt;p>openwrt wan 绑定到eth1 DHCP客户端，连接到爱快lan1 从爱快静态ip绑定为10.1.1.3
openwrt lan 绑定套eth0 关闭DHCP服务，ip地址配置 10.1.1.1&lt;/p>
&lt;p>下文说配置都以上述为例&lt;/p>
&lt;h2 id="避免死循环">避免死循环
&lt;/h2>&lt;p>爱快添加一个分流规则 流控分流 &amp;gt; 分流设置 &amp;gt; 端口分流&lt;br>
分流方式：外网线路 线路：wan1 源地址 ip/mac分组 添加一个 10.1.1.3 点加入 保存&lt;br>
此时 openwrt出来的流量 走wan1 不会再到wan2回到openwrt 导致死循环。&lt;br>
此时openwrt 可以正常访问外部网络。&lt;/p>
&lt;h2 id="配置--wan2-为默认线路">配置 wan2 为默认线路
&lt;/h2>&lt;p>此时所有对外网访问 都会 经过wan2 到openwrt,然后根据你的深度学习软件的分流情况决定是否加密，再回到爱快的lan1 再流向外网。&lt;br>
此时你的上网速度和传统的旁路由模式完全一样，略慢。&lt;/p>
&lt;h2 id="配置国内域名强制走wan1直连">配置国内域名强制走wan1直连
&lt;/h2>&lt;p>流控分流 &amp;gt; 分流设置 &amp;gt; 域名分流，选择wan1 ，输入几个域名，输入客户端ip,建议 10.1.1.5-10.1.1.254 ，此时10.1.1.5-10.1.1.254 的设备访问这个域名会直接走wan1 , 不经过openwrt，速度飞快。&lt;br>
当然你自己输入太麻烦了。ikuai-bypass 可以自动帮你维护这个域名列表。&lt;/p>
&lt;h2 id="配置某些域名强制走wan2-交给openwrt处理">配置某些域名强制走wan2 交给openwrt处理
&lt;/h2>&lt;p>目的是啥，你肯定知道。配置和上面一样，同样 ikuai-bypass 可以自动帮你维护这个域名列表。&lt;/p>
&lt;h2 id="配置国内ip强制走wan1">配置国内ip强制走wan1
&lt;/h2>&lt;p>因为域名清单里面的域名不能覆盖所有网站，还有一些是没有域名直接ip连接情况。所以需要维护一个根据ip分流的规则。&lt;br>
流控分流 &amp;gt; 分流设置 &amp;gt; 多线负载 自定义运营商 添加运营商 名称：&lt;code>国内ip地址&lt;/code> 目的地址：输入几个国内的ip,备注：&lt;code>自定义&lt;/code>&lt;br>
返回 流控分流 &amp;gt; 分流设置 &amp;gt; 多线负载 点右侧添加 运营商：选择你刚刚添加的名称，点wan1 后面的启用，保存。&lt;br>
此时 你访问这个ip上的网站或者其他东西，会强制走wan1 不经过openwrt，速度飞快。 &lt;br>
同样 ikuai-bypass 可以自动帮你维护这个IP地址列表。&lt;/p>
&lt;h2 id="配置默认线路-确保网络100可用性">配置默认线路 确保网络100%可用性
&lt;/h2>&lt;p>把wan2 配置为默认线路，网络设置 &amp;gt; 内外网设置 wan2 同时打开&lt;/p>
&lt;ul>
&lt;li>默认网关：设此条线路为默认网关&lt;/li>
&lt;li>自动切换：掉线自动切换&lt;/li>
&lt;li>线路检测：HTTP &lt;a class="link" href="https://www.google.com" target="_blank" rel="noopener"
>www.google.com&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>此时，访问不在国内域名清单的域名，并且ip不再自定义运营商的&lt;code>国内ip地址&lt;/code>的服务器，会默认走wan2。如果openwrt死机或者google连不上，会自动临时禁用wan2 默认走wan1。&lt;/p>
&lt;h2 id="使用ikuai-bypass-自动维护ip和域名规则">使用ikuai-bypass 自动维护ip和域名规则。
&lt;/h2>&lt;h3 id="配置文件">配置文件
&lt;/h3>&lt;p>需要自定义一个配置文件 config.yml 格式如下。&lt;br>
然后运行 &lt;code>./ikuai-bypass -c /路径/config.yml&lt;/code> 即可在启动时候 自动更新一次规则文件，并在 cron指定的时间内定时运行。&lt;br>
下面的配置文件 会执行一下操作&lt;/p>
&lt;ol>
&lt;li>自动登陆到 网址是 http://10.1.1.1 的爱快 使用用户名admin 密码 admin888登陆，如果登陆成功。&lt;/li>
&lt;li>运营商/IP分流规则 他会帮你添加 一个 &lt;code>国内IP列表&lt;/code> 的运营商，你需要去爱快 流控分流 &amp;gt; 分流设置 &amp;gt; 多线负载 添加规则，选择 国内IP列表 启用wan1&lt;br>
也会添加几个 telegram google 等ip地址，你可以删掉那几行，也可以添加规则 启用wan2&lt;/li>
&lt;li>另外会添加4个域名分流规则 分别强制走wan1 和wan2 你可以在下面配置文件清晰看到。需要注意的是 china-list 和 gfw两个清单 都很长，添加/更新的时候会很慢。你可以根据你的需求决定是否要保留，添加后会增加你访问网址的速度，但是会增加ikuai的性能消耗（大概增加30-120M内存消耗，cpu负载也会增加一点），如果你的ikuai配置很烂，可以去掉其他规则 只使用 国内IP列表 的IP分流即可 。&lt;/li>
&lt;/ol>
&lt;p>文件内容参考 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/blob/main/config_example.yml" target="_blank" rel="noopener"
>https://github.com/joyanhui/ikuai-bypass/blob/main/config_example.yml&lt;/a>&lt;/p>
&lt;h3 id="部署ikuai-bypass">部署ikuai-bypass
&lt;/h3>&lt;p>ikuai-bypass 只要部署在可以访问到 爱快路由器的地方即可。&lt;/p>
&lt;h3 id="下载最新版">下载最新版
&lt;/h3>&lt;p>&lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass/releases" target="_blank" rel="noopener"
>https://github.com/joyanhui/ikuai-bypass/releases&lt;/a>&lt;/p>
&lt;h3 id="直接运行">直接运行
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">./ikuai-bypass_linux_amd64 -c /opt/ikuai-bypass/config_example.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="服务模式-openwrtalpinercsystemd">服务模式 openwrt/alpine/rc/systemd
&lt;/h3>&lt;p>以openwrt为例&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/joyanhui/ikuai-bypass/releases/download/v版本号/ikuai-bypass_v版本号_linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -zxvf ikuai-bypass*linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm ikuai-bypass*linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 默认配置文件 自己可以根据需求编辑一下&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget -c https://github.com/joyanhui/ikuai-bypass/raw/main/config_example.yml -O kuai-bypass.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 测试 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/root/ikuai-bypass -c /root/kuai-bypass.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加服务&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat &amp;gt;/etc/init.d/ikuai-bypass&lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#!/bin/sh /etc/rc.common
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#service startup sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">START=99
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">start() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> #start your process with parameters in background
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> /root/ikuai-bypass -c /root/kuai-bypass.yml &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">stop() {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> killall ikuai-bypass
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x /etc/init.d/ikuai-bypass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 开机启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service ikuai-bypass &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 现在启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service ikuai-bypass start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#或者&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/ikuai-bypass start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启 openwrt,然后shell运行 &lt;code>ps |grep ikuai-bypass&lt;/code> 验证一下是否开机自动启动。&lt;br>
如果不能自动启动，在系统 启动项 本地启动脚本 添加一行 放到 exit 0 前面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sh -c &lt;span class="s1">&amp;#39;sleep 30 &amp;amp;&amp;amp; /etc/init.d/ikuai-bypass start &amp;#39;&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="docker">docker
&lt;/h3>&lt;p>我没有打包docker镜像，因为完全没必要，你可以自己用下面的命令启动一个docker&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mkdir ~/ikuai-bypass/ &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> ～/ikuai-bypass_exe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget -c https://github.com/joyanhui/ikuai-bypass/raw/main/ikuai-bypass_linux_amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x ./ikuai-bypass_linux_amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget -c https://github.com/joyanhui/ikuai-bypass/raw/main/config_example.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --name ikuai-bypass --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> --restart&lt;span class="o">=&lt;/span>always &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v ~/ikuai-bypass/:/opt/ikuai-bypass/ &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> alpine:3.18.4 /opt/ikuai-bypass/ikuai-bypass_linux_amd64 -c /opt/ikuai-bypass/config_example.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果你想部署到爱快内的docker里面 下载 alpine镜像，上传两个文件，然后入口 命令修改为 类似下面的命令即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">chmod +x /opt/ikuai-bypass/ikuai-bypass_linux_amd64 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> /opt/ikuai-bypass/ikuai-bypass_linux_amd64 -c /opt/ikuai-bypass/config_example.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="其他补充">其他补充
&lt;/h2>&lt;h3 id="自定义规则和ikuai-bypass的规则">自定义规则和ikuai-bypass的规则
&lt;/h3>&lt;p>ikuai-bypass 自动维护的规则 都会添加备注 &lt;code>IKUAI_BYPASS&lt;/code> ，只要你添加的自定义的规则备注不是这个即可。&lt;/p>
&lt;h3 id="关于实例配置文件">关于实例配置文件
&lt;/h3>&lt;p>实例配置文件使用了 &lt;a class="link" href="https://mirror.ghproxy.com" target="_blank" rel="noopener"
>https://mirror.ghproxy.com&lt;/a> 作为github的代理方便可以在无科学环境更新规则，但是ghproxy有被gfw污染的先例，请自行更新更稳定的或者自建的github代理。&lt;/p>
&lt;h3 id="是否可以替代原版ikuai-bypass">是否可以替代原版ikuai-bypass
&lt;/h3>&lt;p>可以直接替代，参考上面的docker配置&lt;/p></description></item><item><title>mosdns all in one 分流加自定义解析，不依赖 AdGuardHome</title><link>https://dev.leiyanhui.com/route/mosdns-all-in-one/</link><pubDate>Tue, 21 Nov 2023 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/mosdns-all-in-one/</guid><description>&lt;p>AdGuardHome 的主要优点是可视化，有去广告规则可用。 但是AdGuardHome自己的分流规则配置较为复杂，有第三方提供分流规则，但是实际测试因为无法使用adg的并发查询以及adg自身的性能局限所以效果并不好。所以一般都是和msdns配合使用，例如 mosdns代理两个adg分别负责国内和国外dns,或者adg作为前端后端使用modns。&lt;br>
但是如果你对可视化管理和dns统计没啥需求的话，完全没必要，单独mosdns即可完成。&lt;/p>
&lt;p>下文以pve lxc alpine为例 openwrt或其他linux发行版同样操作&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;p>直接下载 mosdns 下载unzip解压到 /opt/mosdns运行 ./mosdns service install 即可。&lt;/p>
&lt;h2 id="准备几个规则文件">准备几个规则文件
&lt;/h2>&lt;p>主要是 国内ip清单 国内名站域名清单 国外名站域名清单 一个空白的hosts.txt 如果你有自选cf ip需求还需要准备 cf ip自动列表&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /opt/mosdns/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/IceCodeNew/4Share/master/geoip_china/china_ip_list.txt -O geoip_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt -O geosite_category-ads-all.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt -O geosite_geolocation-!cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt -O geosite_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;localhost 127.0.0.1&amp;#34;&lt;/span>&amp;gt; /opt/mosdns/hosts.txt &lt;span class="c1">#注意格式和系统的hosts文件不一样&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://www.cloudflare.com/ips-v4 -O cf4.txt &lt;span class="c1">#cf ip地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://www.cloudflare.com/ips-v6 -O cf6.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat cf4.txt &amp;lt;&lt;span class="o">(&lt;/span>&lt;span class="nb">echo&lt;/span>&lt;span class="o">)&lt;/span> cf6.txt &amp;gt;geoip_cloudflare.txt &lt;span class="c1">#合并&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="可选的自建doh">可选的自建doh
&lt;/h2>&lt;p>目的是在深度学习环境不用的情况下依旧可以正确返回域名实际ip.
&lt;a class="link" href="https://dev.leiyanhui.com/route/safe-dns" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/safe-dns&lt;/a> 查看 cfwork自建doh&lt;/p>
&lt;h2 id="configyaml">config.yaml
&lt;/h2>&lt;p>基本逻辑，国内域名&lt;code>geosite_cn.txt&lt;/code>使用国内dns（dot）并发解析，国外域名&lt;code>geosite_geolocation-!cn.txt&lt;/code>使用 国外dns和自建doh解析&lt;br>
如果非清单内的域名，并且国内dns查询的一个域名返回的是一个非国内ip，那么使用国外 国外dns和自建doh解析 重新解析一次解决被污染问题 &lt;br>
因为去广告&lt;code>geosite_category-ads-all.txt&lt;/code> 会导致一些问题，并且我这里没这个需求，所以没有添加去广告规则。你可以自己添加上&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat &amp;gt; /opt/mosdns/config.yaml &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">log:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> level: error #日志级别。可选 &amp;#34;debug&amp;#34; &amp;#34;info&amp;#34; &amp;#34;warn&amp;#34; &amp;#34;error&amp;#34;。默认 &amp;#34;info&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> file: &amp;#34;/opt/mosdns/log.log&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># API 入口设置
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">api:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> http: &amp;#34;0.0.0.0:9091&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">include: []
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">plugins:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 自定义hosts 注意格式和系统hosts不同 支持泛域名domain和fulldomain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: mosdns_hosts
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: hosts
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/hosts.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># 测试pipeline ./mosdns probe pipeline tls://101.226.4.6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 阿里和360的不支持
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 转发至本地服务器 国内解析
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: forward_local
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: forward
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> concurrent: 3 #mosdns限制最大3并发
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> upstreams: #因为最大3并发所以三个就够了自己选速度好的
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: &amp;#34;tls://223.5.5.5&amp;#34; #阿里
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: &amp;#34;tls://1.12.12.12&amp;#34; #腾讯 dnspod
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: &amp;#34;tls://101.226.4.6&amp;#34; #360电信
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 转发至远程服务器 境外解析上游
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: forward_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: forward
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> concurrent: 3 #最大3并发
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> upstreams:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: tls://8.8.8.8
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: tls://1.1.1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: https://你的自建doh地址
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> bootstrap: 223.5.5.5 #bootstrap地址负责解析doh域名 只能udp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> bootstrap_version: 4 #解析的doh域名返回ipv4还是v6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_http3: false #http3 udp不稳 还是强制走http2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国内域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: geosite_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: domain_set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/geosite_cn.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国内 IP
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: geoip_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: ip_set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/geoip_cn.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国外域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: geosite_no_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: domain_set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/geosite_geolocation-!cn.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 缓存
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: lazy_cache
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: cache
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> size: 20000
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> lazy_cache_ttl: 86400
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> #dump_file: &amp;#34;/opt/mosdns/cache.dump&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> #dump_interval: 600
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国内解析
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: local_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $forward_local
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国外解析
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: remote_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: prefer_ipv4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $forward_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 有响应终止返回
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: has_resp_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: has_resp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: accept
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # fallback 用本地服务器 sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 返回非国内 ip 则 drop_resp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_local_ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $local_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: &amp;#34;!resp_ip $geoip_cn&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: drop_resp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # fallback 用远程服务器 sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $remote_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # fallback 用远程服务器 sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: fallback
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: fallback
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> primary: query_is_local_ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> secondary: query_is_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> threshold: 500
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> always_standby: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 查询国内域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: qname $geosite_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: $local_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 查询国外域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_no_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: qname $geosite_no_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: $remote_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 主要的运行逻辑插件
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # sequence 插件中调用的插件 tag 必须在 sequence 前定义，
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 否则 sequence 找不到对应插件。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: main_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $mosdns_hosts
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: query_summary entry
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $lazy_cache
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $query_is_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: jump has_resp_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $query_is_no_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: jump has_resp_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $fallback
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> #### 最后配置 server........略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: udp_server # 目前有 udp/tcp/http_server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> entry: main_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> listen: 0.0.0.0:53
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: server_tcp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: tcp_server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> entry: main_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> listen: 0.0.0.0:53
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: &amp;#34;server_http&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: &amp;#34;http_server&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> entries: # []extry
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - path: /dns-query # 本路径执行
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: main_sequence # 可执行插件的 tag。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> src_ip_header: &amp;#34;X-Forwarded-For&amp;#34; # 从 HTTP 头获取用户 IP。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> listen: 0.0.0.0:80 # 监听地址。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> cert: &amp;#34;&amp;#34; # 留空 cert 和 key 后会禁用 TLS。 这里没有配置证书，外网使用另外有acme和nginx处理https
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> key: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> idle_timeout: 10 # 空连接超时。单位秒。默认 30。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/mosdns restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="部署">部署
&lt;/h2>&lt;h3 id="路由器和内网机器">路由器和内网机器
&lt;/h3>&lt;p>因为我这里是独立部署在 pve lxc里面，ip是 10.1.1.104。&lt;br>
在openwrt 或者 ikuai中配置上游dns为 10.1.1.104即可，内网内其他机器的dns可以用路由器ip作为dns或者mosdns的10.1.1.104均可&lt;/p>
&lt;h3 id="clash">clash
&lt;/h3>&lt;p>clash 删除其他dns NameServer FallBack Default-NameServer 全部设置为 10.1.1.104&lt;/p>
&lt;h3 id="外网部署">外网部署
&lt;/h3>&lt;p>因为家宽是没有53端口的，你可以从路由器用端口映射修改一下udp tcp的端口，或者外网直接用server_http 走doh&lt;/p>
&lt;h2 id="存在的问题">存在的问题
&lt;/h2>&lt;p>主要是自定义域名解析：&lt;br>
&lt;a class="link" href="https://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v5/ru-he-pei-zhi-mosdns/yu-ming-pi-pei-gui-ze" target="_blank" rel="noopener"
>https://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v5/ru-he-pei-zhi-mosdns/yu-ming-pi-pei-gui-ze&lt;/a>
mosdns 的hosts方法，支持domain 和 full keyword 和 正则。 可以解决多数自定义域名解析的问题。&lt;br>
但是修改hosts文件后 需要重启才能生效 这就搞的很烦。&lt;/p></description></item><item><title>利用cfwokr免费搭建自己的节点</title><link>https://dev.leiyanhui.com/cloudflare/vless/</link><pubDate>Thu, 09 Nov 2023 18:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/cloudflare/vless/</guid><description>&lt;h2 id="简介">简介
&lt;/h2>&lt;p>利用cfwork搭建 一个反向代理，相信很多人都会玩。同样我们可以在cfwork搭建一个vless节点。来实现自建一个稳定的准私有节点。&lt;br>
本文记录相关操作以及如何导入到现有的clash订阅和v2rayN中。&lt;/p>
&lt;h2 id="准备">准备
&lt;/h2>&lt;ul>
&lt;li>cloudflare账号&lt;/li>
&lt;li>在cloudflare中添加一个你自己的域名（非必需）&lt;/li>
&lt;/ul>
&lt;h2 id="创建">创建
&lt;/h2>&lt;h3 id="创建一个cfwork">创建一个cfwork
&lt;/h3>&lt;p>添加 一个，脚本用 &lt;a class="link" href="https://github.com/zizifn/edgetunnel/blob/main/src/worker-vless.js" target="_blank" rel="noopener"
>https://github.com/zizifn/edgetunnel/blob/main/src/worker-vless.js&lt;/a> 这位大佬的&lt;br>
也有一些别人复制的 &lt;a class="link" href="https://github.com/Misaka-blog/cf-wkrs-pages-vless/blob/main/_worker.js" target="_blank" rel="noopener"
>https://github.com/Misaka-blog/cf-wkrs-pages-vless/blob/main/_worker.js&lt;/a>&lt;br>
推荐使用Misaka的，他在原版基础上加了站点伪装和初始的proxyIP
需要修改两个地方 userID 和 proxyIP 。&lt;br>
userID可以理解为 为了隐藏我们的节点，也防止被人白嫖。 可以随便填写，也可以用在线工具生成 &lt;a class="link" href="https://www.uuidgenerator.net" target="_blank" rel="noopener"
>https://www.uuidgenerator.net&lt;/a>
proxyIP 这个是访问某一些本身部署在 cf cdn上的网站要用的，可以自己去筛选，也可以用别人已经筛选好的。 这里直接选别人的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> cdn-all.xn--b6gac.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cdn.xn--b6gac.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cdn-b100.xn--b6gac.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> edgetunnel.anycast.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cdn.anycast.eu.org
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="获取节点地址">获取节点地址
&lt;/h3>&lt;p>打开 https://cf分给你的域名.workers.dev/xxxx-d424-4583-b36e-524ab1f0afa4 后面是你的userid&lt;/p>
&lt;h3 id="替换域名">替换域名
&lt;/h3>&lt;p>workers.dev 默认是被墙的状态，需要替换成你的自己的域名，在触发器的地方添加自定义域，然后输入一个你托管在cf的域名即可。&lt;br>
然后打开 https://你自己的域名v/xxxx-d424-4583-b36e-524ab1f0afa4&lt;br>
注意 域名会被墙识别到，所以你最好用一个看起来正常的域名 ，当然也可以伪装。&lt;/p>
&lt;h3 id="客户端优选ip">客户端优选ip
&lt;/h3>&lt;h4 id="在线方式">在线方式
&lt;/h4>&lt;blockquote>
&lt;p>这个方式凑合能用&lt;/p>&lt;/blockquote>
&lt;p>&lt;a class="link" href="https://vfarid.github.io/cf-ip-scanner/?max=30" target="_blank" rel="noopener"
>https://vfarid.github.io/cf-ip-scanner/?max=30&lt;/a>&lt;/p>
&lt;h4 id="本地测试方式">本地测试方式
&lt;/h4>&lt;blockquote>
&lt;p>略微复杂一些，本地运行工具逐个测试。&lt;/p>&lt;/blockquote>
&lt;p>网上很多相关教程不再赘述，推荐 &lt;a class="link" href="https://github.com/XIU2/CloudflareSpeedTest" target="_blank" rel="noopener"
>https://github.com/XIU2/CloudflareSpeedTest&lt;/a>&lt;/p>
&lt;h4 id="白嫖方式">白嫖方式
&lt;/h4>&lt;p>这个方式 ，就通过你用在线或者本地优选的方式 获取到的感觉速度尚可ip 去ip反查网站，看有没有别的大佬做好的域名。然后逐个去在线ping网站ping他域名。&lt;br>
&lt;a class="link" href="https://ipchaxun.com/" target="_blank" rel="noopener"
>https://ipchaxun.com/&lt;/a> 这里，下面选择一个低成本后缀的域名，或者域名里面在cf或者ip,或yx之类的意思的，大概率就是别人配置好的。&lt;br>
这里提供几个热门ip 140.238.12.33 140.238.12.33 47.245.37.41 &lt;br>
然后去 itdog chinaz之类的网站在线ping确认一下。&lt;br>
这里直接贴几个查到的域名
443.cf.bestl.de 80.cf.bestl.de cdn.chigua.tk
yx.piaosir.link cf.yumy.gay yx.pztvdiao.link yx.s2.gay
yx.skyvps.link ip.zijingshan.link cdn-ip.tgbird.top yxip.tgood.eu.org cf.gzgrd.com&lt;/p>
&lt;p>同样的道理，你也可以用这种方式来搞定msdos对cf的优选ip的重写。&lt;/p>
&lt;h4 id="最后的地址处理">最后的地址处理
&lt;/h4>&lt;p>无论那方式，你获取到的ip 最终都要替换到上面你的cfwork提示的vless地址的里面
vless://XXXXX-d424-4583-b36e-524ab1f0afa4@这里选择优选ip优选域名:443?encryption=none&amp;amp;security=tls&amp;amp;sni=XXXX&amp;amp;fp=randomized&amp;amp;type=ws&amp;amp;host=XXXX&amp;amp;path=%2F%3Fed%3D2048#XXXX&lt;/p>
&lt;h3 id="附加到现有clash订阅">附加到现有clash订阅
&lt;/h3>&lt;p>一般我们使用第三方转换的网站 添加上，然后再用转换网站提供的地址即可。 否则只能添加到本地的yaml文件里面&lt;/p></description></item><item><title>clash删库事件发生后的替代方案</title><link>https://dev.leiyanhui.com/route/clash-new/</link><pubDate>Wed, 08 Nov 2023 20:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/clash-new/</guid><description>&lt;p>因为 clash for windows 作者自我开盒（不小心泄露车牌号码）随后删库导致的连锁反应，clash和clash meta 等相继把仓库设置为归档并暂时停止更新。
其实clash for windows 只是clash一个在windows的ui配置工具 ui部分基于Electron,后端还是 clash和clash meta。但是因为他比较直观并且很美观，所以使用者众多。&lt;/p>
&lt;p>目前暂时看 clash和clash meta ，应该不会一直停止更新。所以可以继续使用。&lt;/p>
&lt;p>重点：clash 和clash-mete clash-tun 依旧可以正常使用！！！&lt;/p>
&lt;p>clash meta的优点 有很多，主要分流规则完善且灵活，并且支持的协议多，基本上覆盖所有协议。但其实有两个问题。
1、在低配硬件上跑不满带宽，甚至只有带宽的10-20%&lt;br>
2、配置较为繁琐，对新手不友好，甚至不少大神也对clash的配置很懵&lt;/p>
&lt;p>主流的替代软件客户端内核 比如 v2ray xray sing-box Hysteria,只是其他软件的分流和协议支持度或者易用性都没有clash好。&lt;br>
这些可以不操心，其他非基于clash的客户端有：&lt;/p>
&lt;p>V2rayN (Win端)https://github.com/2dust/v2rayN/wiki/List-of-supported-cores&lt;br>
v2rayA( linux + win + macos)&lt;br>
v2flyNG(android) V2rayNG (android) &lt;br>
Nekoray (win+linux) &lt;a class="link" href="https://github.com/MatsuriDayo/nekoray" target="_blank" rel="noopener"
>https://github.com/MatsuriDayo/nekoray&lt;/a>&lt;br>
Nekobox (android)&lt;br>
Surge (收费 macos ios) sing-box（全平台）
IOS端：sing-box Shadowrocket QuantumultX Surge等&lt;/p>
&lt;p>上面支持linux的在openwrt上都可以用，但是另外有一些带luci界面： PassWall Bypass SSR-Plus PassWall2 VSSR (Hello World)，&lt;/p>
&lt;p>最后： 较为看好sing-box,已经有部分机场开始支持（也有一些clash转换sing-box的转换工具）ios客户端是免费的。&lt;/p></description></item><item><title>关于dns泄露的那些事情 路由器 mosdns分流 clash</title><link>https://dev.leiyanhui.com/route/safe-dns/</link><pubDate>Sat, 28 Oct 2023 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/safe-dns/</guid><description>&lt;h2 id="dns-为什么会被泄露">dns 为什么会被泄露
&lt;/h2>&lt;p>因为默认情况下家庭网络的dns都是走 明文 udp的53端口。但是即便是配置了走doh/dot也会泄露。&lt;/p>
&lt;h2 id="dns-泄露后有什么不好的">dns 泄露后有什么不好的
&lt;/h2>&lt;p>如果 你对运营商或者国内dns 发起了一个 查询某一个域名dns的请求，随后你又加密连接到了一个境外ip并传输了大流量数据。
你在干什么 就非常显而易见了。 在这个红色恐怖充斥的2023年，这是一个非常作死的事情。&lt;/p>
&lt;h2 id="什么是dns污染-阻断和劫持">什么是dns污染 阻断和劫持
&lt;/h2>&lt;p>简单的说，就是 你请求了某一个公共dns,但返回的数据是错误的，或者半路被篡改掉了。&lt;br>
返回错误数据 是因为国内政策要求，所以公共dns服务器对某一些域名进行了阻断，一般会返回一个本地局域网i或者随意一个国外ip。所以需要使用国外公共dns来处理一些域名的解析。
数据被篡改，只有你在明文进行dns请求的时候，返回数据被运营商或者某部门或者恶意第四方篡改掉，这种情况仅限明文dns请求的情况下。所以有了doh和dot的加密dns请求。&lt;/p>
&lt;h2 id="什么是doh和dot">什么是doh和dot
&lt;/h2>&lt;p>dns over tls 和 dns over https 就是用用tcp tls 或者 https 加密你的 dns请求。&lt;br>
一般浏览器和操作系统 都支持。&lt;/p>
&lt;h2 id="doh和dot可以避免污染-阻断-劫持和-泄露吗">doh和dot可以避免污染 阻断 劫持和 泄露吗
&lt;/h2>&lt;p>并不能完全避免。
doh和dot是可以避免dns解析记录被中间人篡改和窥探的，但是使用国内公共dns无法解决政策原因导致的污染。&lt;br>
如果你 doh/dot到 国内的 doh/dot的dns服务，那么只是你上游网络（宽带运营商）无法得知你的dns请求了而已。但是对应的国内dns服务商依旧可以得知。&lt;/p>
&lt;p>你直接使用国外加密dns,理论去是可以的避免所有问题，但是国外加密dns有三个问题：&lt;/p>
&lt;ul>
&lt;li>国内直接访问速度太慢 严重影响使用&lt;/li>
&lt;li>国外加密dns都已经被干扰并且不定期阻断和重定向 无法正常稳定使用&lt;/li>
&lt;li>有一些国内网站基于dns做了分地区或者一些优化，例如你访问某一个网站用的国外的dns可能会被重定向到对方的国际站点。&lt;/li>
&lt;/ul>
&lt;h2 id="怎么完美解决">怎么完美解决
&lt;/h2>&lt;p>三句话：&lt;/p>
&lt;ul>
&lt;li>使用clash代理国外主流doh/dot的dns服务，一般情况下所有的第三方clash转换规则包括机场自带的规则 以及常见的路由器分流配置 都可以识别到这部分流量 都会帮你代理出去。&lt;/li>
&lt;li>国内域名到 国内的doh/dot的dns服务商，gfw清单中的域名到国外主流doh/dot的dns服务商&lt;/li>
&lt;li>如果非gfw清单中域名，但是返回了国外ip,那么到国外主流doh/dot上再次查询一次 &lt;br>
这样就完美规避了上述所有问题。&lt;/li>
&lt;/ul>
&lt;h2 id="怎么实现">怎么实现
&lt;/h2>&lt;p>mosdns分流搞定一切。如果有特殊需求，加辅助dns的上游,例如AdGuardHome和自建doh。&lt;/p>
&lt;h2 id="怎么优雅实现">怎么优雅实现
&lt;/h2>&lt;h3 id="原理">原理
&lt;/h3>&lt;p>使用mosdns，mosdns 判断是gfw域名直接请求 google和cf或者你的自建doh。否则请求国内doh/dot 如果请求了国内dns但是返回了一个国外ip,那么再次请求 google和cf或者你的自建doh 确认修正一次。
国内doh/dot 我们也可以作为AdGuardHome的上游，顺带去广告或者处理一下别的情况。&lt;/p>
&lt;h3 id="最佳方案新手推荐">最佳方案（新手推荐）
&lt;/h3>&lt;p>mosdns 作为网内的主dns,或者路由器的上游主dns。
两个 AdGuardHome 分别处理 境外网站和国内网站，这两个AdGuardHome作为mosdns的上游dns.
这样的好处是 AdGuardHome有较为直观的webui管理界面，并顺带处理广告问题。
另外一个猴版方案 是 AdGuardHome作为主dns, mosdns作为 AdGuardHome 的上游，一样可以实现。这样省一个AdGuardHome，但是有特殊要求的情况下不适用。&lt;/p>
&lt;h3 id="单mosdns方案老手推荐">单mosdns方案（老手推荐）
&lt;/h3>&lt;p>也是我目前使用的方案，优点是更加灵活性能也比较好。 &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/route/mosdns-all-in-one" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/mosdns-all-in-one&lt;/a>&lt;/p>
&lt;h3 id="为什么不直接用clash自带的dns劫持">为什么不直接用clash自带的dns劫持
&lt;/h3>&lt;p>主要是自带的clash dns规则较为复杂，一不消息就会泄露dns。&lt;/p>
&lt;h3 id="这么复杂不会拖累速度吗">这么复杂不会拖累速度吗
&lt;/h3>&lt;p>不会，因为mosdns速度非常快，而且自己有良好的缓存机制。 我们使用运营商的dns他也会逐级请求上层dns,只是不需要我们配置而已。&lt;/p>
&lt;h3 id="准备">准备：
&lt;/h3>&lt;p>1、mosdns和对应的geoip.dat，geosite.dat &lt;br>
2、（可选）cfwork自建一个doh &lt;br>
3、（可选）AdGuardHome顺带去广告&lt;/p>
&lt;h3 id="mosdns">mosdns
&lt;/h3>&lt;p>建议docker安装 推荐 &lt;a class="link" href="https://hub.docker.com/r/601096721/mosdns" target="_blank" rel="noopener"
>https://hub.docker.com/r/601096721/mosdns&lt;/a>&lt;/p>
&lt;h3 id="cfwork自建doh">cfwork自建doh
&lt;/h3>&lt;p>因为cf和google包括其他知名国外的dns,无论是否doh/dot都被干扰了，非常不稳定甚至某些时候无法使用。 而有时候我们需要直连查询。 &lt;br>
推荐index.js &lt;a class="link" href="https://github.com/tina-hello/doh-cf-workers" target="_blank" rel="noopener"
>https://github.com/tina-hello/doh-cf-workers&lt;/a> &lt;br>
记得绑定一个自己的域名，因为cfwork默认分配的域名本身是被墙的状态，那么你自己搭建的反向代理也就无意义了。 &lt;br>
cfwork每个账户每天有免费10万次查询额度，自己用足够了。上面的代码中没有包含路由功能，你可以自己配置一下，防止被盗用。&lt;br>
这个方式自建doh 速度肯定是不好的，因为我们一般会在clash或者软路由的分流规则直连这个地址，本身速度就不快，而且我们的自建doh实际是反向代理了一次cf的doh,所以速度方面就不用想会多快了。这只是在我们无法使用代理，并且需要正确dns的时候最后的手段。&lt;/p>
&lt;blockquote>
&lt;p>因为cfwork只支持http/https请求，所以不能搭建dot只能doh,理论上doh因为基于http协议需要携带http头部信息，数据包大一些，速度会慢一点，实际上两者使用体验上并无差别
上面的脚本可以适当的修改后缀，或者在cf面板中添加规则防止被别人白嫖。js语法很简单，自己看注释修改一下即可。&lt;/p>&lt;/blockquote>
&lt;h3 id="adguardhome">AdGuardHome
&lt;/h3>&lt;p>为什么要AdGuardHome ？ 除了去广告之外 AdGuardHome的并发dns查询可以加快访问速度。另外ddns的域名，我们可以直接指向内网ip,这样在我们ip变化后但是ddns因为受到ttl的限制不能马上刷新的情况下不会影响内网使用。 &lt;br>
AdGuardHome的配置较为简单 就不用多说了。dns里面加一堆国内的dot运营商即可,参考下面的上游 DNS 服务器 分别配置的阿里云 360和腾讯dnspod的dot&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">tls://223.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://223.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://101.226.4.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://123.125.81.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://1.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://120.53.53.53
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建议全部直接用ip走dot或doh 而不是用域名 ,这样可以避免Bootstrap dns配置错误导致的问题。
你可以先用https://ip地址 访问对应的dns如果没有提示证书错误 那么他就是支持ip直连doh，那也可以ip走dot。也可以查询对应dns服务器的文档。&lt;/p>
&lt;h2 id="在爱快和ros-openwrt下如何配置">在爱快和ros openwrt下如何配置
&lt;/h2>&lt;p>建议 mosdns和AdGuardHome都不要劫持本地的dns.而在 路由器设置吧mosdns的内网ip或者dockerip作为路由的首选dns。&lt;br>
爱快3.7.7 体验版本已经支持 dns的第三方代理模式 配置主dns（mosdns）和三个备用dns（国内公共dns），虽然目前测试存在问题，但是后续版本应该会修复。&lt;/p>
&lt;h2 id="openclash里面怎么配置">openclash里面怎么配置
&lt;/h2>&lt;p>直接吧clash的dns 所有dns全部替换为mosdns&lt;/p>
&lt;h2 id="mosdns配置文件">mosdns配置文件
&lt;/h2>&lt;p>mosdns 相当于是我们的核心dns了。我目前的配置如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># 日志&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">log&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">level&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#日志级别。可选 &amp;#34;debug&amp;#34; &amp;#34;info&amp;#34; &amp;#34;warn&amp;#34; &amp;#34;error&amp;#34;。默认 &amp;#34;info&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">production&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># api:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># http: 127.0.0.1:8888&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># include: []&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">plugins&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># forward 可以将所有的 upstream 写一起，sequence 里按需调用 &amp;#34;$插件tag 上游tag...&amp;#34;。看下一条注释。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">size&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1024&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">lazy_cache_ttl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 自定义Hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;./hosts&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">upstreams&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">forward&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">upstreams&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">adguardhome&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp://10.10.1.3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#上游是境内dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">adguardhome2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#上游是境外dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp://10.10.1.5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 后面的作为备用暂时不使用,这里直接使用两个adg作为上游&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cf_worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://xxxxx &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#自己在cfwork搭建的doh&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudflare_tls&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://1.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">google_tls&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://8.8.8.8&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dnspod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://1.12.12.12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">aliyun&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://dns.alidns.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bootstrap&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">223.5.5.5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># cn域名的规则&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">geosite_cn_seq&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$upstreams adguardhome&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 替换 cloudflare 的 IP 成自己的最优 IP 的规则&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 没找到txt，不用这条&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - tag: fastest_cf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># type: sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># args:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - matches: resp_ip &amp;amp;./geoip_cloudflare.txt # 是不是 cloudflare 的 IP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># exec: black_hole 1.1.1.1 ::1 # 用 black_hole 强制换成这些 IP 的应答。注意，这里的 IP 只是示例不是 cloudflare 的。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 远程域名的规则&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">remote_seq&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">prefer_ipv4 &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 希望 remote 优先 ipv4.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- exec: $upstreams adguardhome2 cf_worker cloudflare_tls google_tls&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$upstreams adguardhome2 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - exec: jump fastest_cf # jump 相对于把 fastest_cf 的规则链插到此处。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 这个 sequence 转发请求到本地，返回只包含 cn IP 的应答。(过滤掉非 cn 的应答)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local_must_has_cn&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- exec: $upstreams adguardhome dnspod aliyun&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$upstreams adguardhome&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;!resp_ip &amp;amp;./geoip_cn.txt&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">drop_resp &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 如果应答里没有 cn IP，丢掉。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 利用 fallback 机制按 IP 分流。如果 local 服务器返回了 cn 的应答就接受，非 cn 的应答会被丢弃，使用 remote 服务器的应答。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fallback_ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fallback&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">primary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local_must_has_cn &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 空应答(本地服务器返回了非cn IP然后应答被丢弃了)触发 fallback。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secondary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">remote_seq &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># fallback 后就会使用 remote 的应答。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">always_standby&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">##############################&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 配置主 sequence 规则，作为服务器的入口。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">query_summary entry&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - qname &amp;amp;./geosite_category-ads-all.txt #自带的广告过滤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># exec: reject 0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- {&lt;span class="nt">matches: has_resp, exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">accept} &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># cache/hosts 等插件不再“命中记录自动跳过后续插件”，需用户自行判断是否有应答。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 方便需要 ipset/nftables 用户定制流程。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># yaml 支持这种简写。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">qname &amp;amp;./geosite_cn.txt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># cn 域名&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">goto geosite_cn_seq &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># goto 到 local 规则，不在执行后续规则。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">qname &amp;amp;./geosite_geolocation-!cn.txt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 非 cn 域名&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">goto remote_seq &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># goto 到 remote 规则。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$fallback_ip &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 剩余域名用 ip 分流。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#### 动态路由 + cache。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 新版的cache只会将命中的应答放在请求，不再自动终止后续规则。所以需要动态路由时，可以将&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># sequence 的转发操作用 !has_resp 短路。做到每次请求都能刷新路由表。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - tag: s1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># type: sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># args:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - exec: $cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - &amp;#34;!has_resp&amp;#34; # 上一步cache命中缓存有应答了就不转发了。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># exec: $forward_remote&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - exec: ipset ...... # ipset 每次请求都能执行。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#####&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">####### mark 使用示例&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># mark 在 exec 内是打标。在 matches 内是匹配。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># mark 当作开关的示例。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - tag: s1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># type: sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># args:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - exec: mark 1 2 # 先打标。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - mark 1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># exec: $cache # 有 mark 1 缓存会生效&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - mark 2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># exec: ecs 1.2.3.4 # 有 mark 2 请求会被附加 ecs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - mark 3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># exec: jump fastest_cf # 没 mark 3 不会替换 cloudflare ip。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#### 最后配置 server........略&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp_server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 目前有 udp/tcp/http_server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">53&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">server_tcp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tcp_server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">53&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;server_http&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;http_server&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entries&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># []extry&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dns-query &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 本路径执行 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 可执行插件的 tag。 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src_ip_header&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;X-Forwarded-For&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 从 HTTP 头获取用户 IP。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 监听地址。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cert&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 留空 cert 和 key 后会禁用 TLS。 这里没有配置证书，外网使用我这里另外有acme和nginx处理https&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 空连接超时。单位秒。默认 30。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">#######&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="手动更新mosdns的分流数据">手动更新mosdns的分流数据
&lt;/h2>&lt;p>601096721/mosdns的docker镜像没有添加计划任务，只有在更新镜像的时候 才会更新。
可以在容器内部执行下面的命令更新数据库文件，也可以在容器内部安装crond 定时更新。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/IceCodeNew/4Share/master/geoip_china/china_ip_list.txt -O /geoip_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt -O /geosite_category-ads-all.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt -O /geosite_geolocation-!cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt -O /geosite_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geoip_cn.txt /etc/mosdns/geoip_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geosite_category-ads-all.txt /etc/mosdns/geosite_category-ads-all.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geosite_geolocation-!cn.txt /etc/mosdns/geosite_geolocation-!cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geosite_cn.txt /etc/mosdns/geosite_cn.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="补充">补充
&lt;/h2>&lt;p>adguardhome 本身可以利用规则的方式实现分流协议。有第三方作者的规则，实际测试效果不好，主要是速度不理想。&lt;br>
adguardhome 搭建自己的私有doh需要强制证书，略微不方便。而mosdns 性能更好，且可以不使用证书搭建 dns over http（非https），而后用nginx+acme.sh统一反代到https。
但是mosdns没有简单方便的webui管理工具，去广告功能也没有adguardhome那么方便。所以如果不是内存特别紧张的情况下，mosdns+adguardhome依旧是新手的最佳方案。&lt;br>
adguardhome 本身大概需要 40-80M内存，我在使用mosdns+双adguardhome的时候，大概需要消耗150-180M内存。&lt;br>
如果对可视化管理没有需求，建议用单mosdns方案 &lt;a class="link" href="https://dev.leiyanhui.com/route/mosdns-all-in-one" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/mosdns-all-in-one&lt;/a>&lt;/p></description></item><item><title>爱快无感分流</title><link>https://dev.leiyanhui.com/route/ikuai-bypass-gfw/</link><pubDate>Mon, 23 Oct 2023 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/ikuai-bypass-gfw/</guid><description>&lt;h2 id="前">前
&lt;/h2>&lt;p>基于 ztc1997/ikuai-bypass/ 二开的 ikuai-bypass 已经 测试完成，请阅读本文：&lt;/p>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui/&lt;/a>&lt;/p>
&lt;h2 id="优点">优点
&lt;/h2>&lt;ul>
&lt;li>可以接受 OpenWrt 死机/故障。完全无感 深造炸了不会有任何影响 OpenWrt关闭也不影响正常上网。&lt;/li>
&lt;li>丝毫不影响ipv6,无视fake-ip模式带来的一系列问题。&lt;/li>
&lt;li>爱快下内网设备同一个网络内，没有跨三层问题。&lt;/li>
&lt;li>依旧可以在爱快上设置某个或者某些设备走 OpenWrt ，或者不深造。&lt;/li>
&lt;li>内网流量和国内流量仅经过一个网关，没有网关损耗问题。&lt;/li>
&lt;li>可以无感覆盖ipsec拨入的外网设备。&lt;/li>
&lt;li>国内网站秒开，国外网站速度也不比clash差。&lt;/li>
&lt;li>op和clash有问题的情况下，国外未墙网站可以正常访问。&lt;/li>
&lt;li>不用操心clash自定义规则，可以用爱快完成全部分流。&lt;/li>
&lt;li>不用给设备分配独立网关，所有设备都用爱快作为网关即可。&lt;/li>
&lt;/ul>
&lt;h2 id="缺点">缺点
&lt;/h2>&lt;p>家里是多线宽带的情况，会略微复杂一些，单线的话非常简单明了。&lt;/p>
&lt;h2 id="情况">情况
&lt;/h2>&lt;p>物理机，单网卡主机。安装pve 10.1.1.5&lt;br>
光猫 开桥接&lt;br>
pve物理机和、光猫、ap 以及其他设备都接入交换机器 &lt;br>
pve 创建虚拟机安装爱快 10.1.1.1 &lt;br>
lxc 或者 docker 或者 vm 运行 openwrt+openclash或者linux+clash或者v2ray等均可 &lt;br>
top图 &lt;a class="link" href="https://i.imgur.com/jZZePwJ.png" target="_blank" rel="noopener"
>点击这里查看&lt;/a> 或者&lt;a class="link" href="https://www.right.com.cn/forum/thread-8310402-1-1.html" target="_blank" rel="noopener"
>恩山帖子&lt;/a>&lt;/p>
&lt;h2 id="原理">原理
&lt;/h2>&lt;ul>
&lt;li>openwrt作为爱快的下级路由器，但是作为爱快的wan2的上级路由器，端口分流规则避免环回问题。&lt;/li>
&lt;li>利用爱快的流控分流功能和自动wan检测功能，根据ip或者域名分流到openwrt再回到pppoe.&lt;/li>
&lt;li>爱快默认的分流优先级顺序为：静态路由&amp;gt;域名分流&amp;gt;端口分流&amp;gt;协议分流&amp;gt;多线负载&amp;gt;默认网关。&lt;/li>
&lt;li>我们要用的是 多线负载分流 和 默认网关分流。文末也有提供域名分流方法。&lt;/li>
&lt;li>利用pve esxi等虚拟网卡和内部交换机功能 不增加物理设备的情况下 高效连接爱快和OpenWrt.&lt;/li>
&lt;/ul>
&lt;h2 id="原理图">原理图
&lt;/h2>&lt;blockquote>
&lt;p>没想到很多人看不明白，也有朋友来询问，所以简单说明如下&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#爱快网口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">爱快lan1&lt;span class="o">[&lt;/span>10.1.1.1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">爱快wan2&lt;span class="o">[&lt;/span>192.168.10.2&lt;span class="o">]&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="o">[&lt;/span>lan 192.168.10.1&lt;span class="o">]&lt;/span> openwrt/clash &lt;span class="o">[&lt;/span>wan 10.1.1.3&lt;span class="o">]&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt;爱快&lt;span class="o">==&lt;/span>&amp;gt;爱快wan1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">爱快wan1&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; pppoe/宽带运营商
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#分流规则&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="nv">gfw域名&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt; 固定走爱快wan2 &lt;span class="o">[==&lt;/span>&amp;gt;openwrt&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">访问请求&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="nv">国内ip&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt; &lt;span class="nv">固定走爱快wan1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="nv">其他情况且wan2可用&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt; 爱快wan2 &lt;span class="o">[==&lt;/span>&amp;gt;openwrt&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="nv">其他情况且wan2不可用&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt; &lt;span class="nv">爱快wan1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="nv">来自openwrt的流量&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt;爱快wan1 &lt;span class="c1">#避免回到wan2死循环&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="nv">其他自定义规则&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt; 爱快wan1或者wan2自由配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#dns&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DNS请求&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; &lt;span class="nv">爱快DNS加速&lt;/span>&lt;span class="o">==&lt;/span>&amp;gt;第三方代理模式&lt;span class="o">==&lt;/span>&amp;gt;mosdns可用 &lt;span class="o">==&lt;/span>&amp;gt;mosdns/adg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">==&lt;/span>&amp;gt;mosdns不可用 &lt;span class="o">==&lt;/span>&amp;gt; 备用dns（爱快3.7.7,需要20秒左右才能切换）
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="网口设置">网口设置
&lt;/h3>&lt;h4 id="爱快">爱快
&lt;/h4>&lt;p>三个虚拟网口&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">lan1 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wan1 pppoe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wan2 IP：192.168.10.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 网关：192.168.10.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 掩码：255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 默认网关： √ 设此条线路为默认网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 自动切换： √ 掉线自动切换
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 线路检测：HTTP www.google.com 或者 ping 192.168.10.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="openwrt">openwrt
&lt;/h4>&lt;p>两个虚拟网口&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">br-lan lan 静态ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPv4 地址：192.168.10.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPv4 掩码：255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPv4 网关 留空
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPv4 广播地址 留空
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DHCP服务器 √ 忽略此接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wan eth1 DHCP客户端 （去爱快的静态dhcp里面给配置为 10.1.1.3）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wan6 不用管，你开启ipv6 和wan配置为DHCP客户端的情况下，wan6会自动获取ipv6地址
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>此时，相当于 openwrt作为爱快的下级路由器，但是作为爱快的wan2的上级路由器。下面会添加一个端口分流规则避免环回问题。&lt;/p>
&lt;h3 id="爱快分流规则">爱快分流规则
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">访问请求&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; 爱快判断请求中的域名或者ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">如果请求是gfw的域名&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; wan2 &lt;span class="o">(&lt;/span>流控分流&amp;gt;分流设置&amp;gt;域名分流&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">如果请求的ip是国内ip&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; wan1直连 &lt;span class="o">(&lt;/span>流控分流&amp;gt;分流设置&amp;gt;多线负载&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>自定义运营商添加国内所有ip地址&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">其他情况且wan2可用&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; wan2 （因为上文中吧wan2设置为默认了）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">其他情况且wan2不可用&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; wan1直连
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">如果流量是来自openwrt&lt;/span> &lt;span class="o">==&lt;/span>&amp;gt; wan1 &lt;span class="o">(&lt;/span>流控分流&amp;gt;分流设置&amp;gt;端口分流&lt;span class="o">)&lt;/span>把10.1.1.3&lt;span class="o">(&lt;/span>openwrt&lt;span class="o">)&lt;/span>定向到wan1避免环回
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="辅助工具和其他说明">辅助工具和其他说明
&lt;/h3>&lt;p>ztc1997/ikuai-bypass 可以自动给爱快添加gwf域名列表和国内ip地址列表，并可以自动更新。&lt;br>
后文中的openwrt可以运行在kvm docker lxc 都可以无影响，爱快内的docker和kvm也可以。 &lt;br>
这个方案适合pve esxi unraid 。
如果是kvm 这个方案中所有的网口都要用 virtio 性能是最好的，可以最低的资源占用跑满。&lt;br>
openwrt 可以用lxc/docker/kvm运行的普通linux+clash替代，开ipv4和ipv6转发就好 。&lt;/p>
&lt;h2 id="准备工作">准备工作
&lt;/h2>&lt;p>后面是原始记录&lt;/p>
&lt;h3 id="爱快设备">爱快设备
&lt;/h3>&lt;p>我这里是pve 用vm运行的设备。先添加两个虚拟网卡，一个做wan一个做lan,
配置wan1到 eth1 pppoe
配置lan1 到 eth0 ip配置为10.1.1.1
配置dhcp 为 10.1.1.X段 dns为10.1.1.1 ，配置dns 输入两个国内正常的dns,先配置DNS加速模式 为代理模式 doh &lt;a class="link" href="https://doh.pub/dns-query" target="_blank" rel="noopener"
>https://doh.pub/dns-query&lt;/a>
这样接入爱快的设备 均可正常上网，只是不能深造学习。
再添加一个虚拟网卡 并从pve关闭爱快后重新打开,爱快中可以看到多了一个 eth2 备用&lt;/p>
&lt;h3 id="深造设备">深造设备
&lt;/h3>&lt;p>可以用lxc docker 或者 vm 都可以 看自己。 也可以物理设备 n1 之类的。
我这里因为是pve,所以 lxc 运行了一个 openwrt+openclash.
openwrt 需要注意的是这里的openwrt不是旁路由模式，所以需要添加两个虚拟网卡 用于lan(192.168.10.1)和wan(10.1.1.3 也可以从爱快dhcp)
正常lxc或者vm安装openwrt。配置好深造。
然后找一个电脑或者vm/lxc ip设置为 和lan同一个网段的ip 网关和dns都配置为192.168.10.1.
wan 口也可以配置为dhcp,然后在爱快里给他静态分配一个也可以。&lt;/p>
&lt;h3 id="手动ip-v4-配置方法">手动ip v4 配置方法
&lt;/h3>&lt;p>先确保关闭爱快和&lt;/p>
&lt;h4 id="国内ip-v4地址列表">国内ip v4地址列表
&lt;/h4>&lt;p>先看手动添加方法，文末有自动维护方法。
&lt;a class="link" href="https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt" target="_blank" rel="noopener"
>https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt&lt;/a>
如果没有深造，可以用https://ghproxy.com/https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt 这个地址打开
因为爱快一次只能输入5000个ip,但是国内的ip地址有6000多条，我们需要前5000条和后面1000多条分两次插入。
所以把上面的地址复制到一个支持行数显示的文本编辑器里面。备用。&lt;/p>
&lt;h4 id="爱快内配置国内ipv4">爱快内配置国内ipv4
&lt;/h4>&lt;p>爱快 流控分流&amp;gt;多线负载&amp;gt;自定义运营商. 添加运营商 名称叫做 国内 ip地址粘贴前5000条 备注国内1
同样后面的1000多条 也粘贴进来 名称也是叫做国内 备注 国内2&lt;/p>
&lt;h4 id="分流">分流
&lt;/h4>&lt;p>爱快 流控分流&amp;gt;多线负载，点添加
负载模式：源IP+目的IP+目的端口
运营商 选择国内 负载比例：wan1 1 点操作后面的开启。然后保存&lt;/p>
&lt;h4 id="wan2">wan2
&lt;/h4>&lt;p>然后返回 网络设置 &amp;gt; 内外网设置 创建一个接口 wan2 ，绑定到 eth2。使用静态ip 192.168.10.2 ，网关为192.168.10.1（openwrt的地址）&lt;/p>
&lt;p>下面 勾选 设此条线路为默认网关 和 掉线自动切换
可以设置为:线路检测 HTTP 检测地址 google.com 这样当 OpenWrt 不能正常访问国外网，流量会切换到 wan1
也可以 线路检测：ping 检测地址 192.168.10.1 ,这个地址是 OpenWrt 的 lan 地址，检查它的存在与否，用来确定是不是要将流量切换到 wan1 。&lt;/p>
&lt;h4 id="设置openwrt出口强制为wan1">设置openwrt出口强制为wan1
&lt;/h4>&lt;p>不然 外网ip会分流到op又再次分流会wan2到openwrt 死循环。
爱快 流控分流 &amp;gt; 分流设置 &amp;gt; 端口分流 添加一条规则
分流方式：外网 线路 wan1
IP/分组： 添加openwrt的wan地址 10.1.1.3&lt;/p>
&lt;h3 id="打开ipv6">打开ipv6
&lt;/h3>&lt;p>测试没有问题的时候，爱快 网络设置 &amp;gt; IPv6 &amp;gt; IPv6设置 wan1 DHCPv6客户端(动态获取) 启用
openwrt 系统 设置向导 启用 ipv6 （没有这个选项的固件可能需要 另外配置）&lt;/p>
&lt;h3 id="关闭openwrt的dhcp">关闭openwrt的dhcp
&lt;/h3>&lt;p>因为我这里 都是虚拟网卡 理论上都会接入唯一的主交换机，所以爱快和op都开dhcp的话，有可能会有冲突。所以关掉openwrt的dchp.
网络 接口 lan 关闭 dhcp&lt;/p>
&lt;h3 id="进阶">进阶
&lt;/h3>&lt;h4 id="ipv4-地址列表">ipv4 地址列表
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/17mon/china_ip_list" target="_blank" rel="noopener"
>https://github.com/17mon/china_ip_list&lt;/a>
&lt;a class="link" href="https://github.com/Loyalsoldier/geoip/tree/release/text" target="_blank" rel="noopener"
>https://github.com/Loyalsoldier/geoip/tree/release/text&lt;/a>
&lt;a class="link" href="https://ispip.clang.cn/all_cn.txt" target="_blank" rel="noopener"
>https://ispip.clang.cn/all_cn.txt&lt;/a>&lt;/p>
&lt;h4 id="ipv6-地址列表">ipv6 地址列表
&lt;/h4>&lt;p>&lt;a class="link" href="https://ispip.clang.cn/all_cn_ipv6.txt" target="_blank" rel="noopener"
>https://ispip.clang.cn/all_cn_ipv6.txt&lt;/a>&lt;/p>
&lt;h4 id="基于域名的">基于域名的
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/Loyalsoldier/v2ray-rules-dat/tree/release" target="_blank" rel="noopener"
>https://github.com/Loyalsoldier/v2ray-rules-dat/tree/release&lt;/a>&lt;/p>
&lt;h4 id="docker自动更新规则">docker自动更新规则
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/ztc1997/ikuai-bypass" target="_blank" rel="noopener"
>https://github.com/ztc1997/ikuai-bypass&lt;/a>
ztc1997大佬的docker支持自动更新ip列表和gfw域名列表。支持爱快内docker运行或者其他能访问爱快面板的地方运行。支持定时任务。
配制文件优化如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">## 本文件/data/ikuai-bypass/config.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## /data/ikuai-bypass/ 映射到 /etc/ikuai-bypass&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 爱快管理页面的 URL，结尾不要加 &amp;#34;/&amp;#34;，&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 如不填写，则使用第一个接口的网关地址作为爱快地址，&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">ikuai-url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://10.1.1.1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#爱快地址&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">username&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">admin&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 爱快用户名&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">password&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cp">******&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 爱快密码&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">cron&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">4&lt;/span>&lt;span class="w"> &lt;/span>*&lt;span class="w"> &lt;/span>*&lt;span class="w"> &lt;/span>*&lt;span class="w"> &lt;/span>&lt;span class="c"># 执行更新的周期 crontab&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">custom-isp&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 自定义运营商&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">国内 &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 自定义运营商名称cnip就直接走wan1 非cnip走在默认可用的情况下走默认即wan2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">## 自定义运营商 cidr 列表网址，每行一个，超过5000行会自动分为多个，ipv6 地址会被删除&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/cn.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">## 下面的ip 可以分别添加到到wan2的 多线负载 规则&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">telegram&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/telegram.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">google&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/google.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">twitter&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/twitter.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">facebook&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/facebook.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">stream-domain&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 域名分流 被墙的域名 无脑走wan2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">interface&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">wan2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 分流线路&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src-addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.1.1.5-10.1.1.250&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 分流的源地址 我这边10.1.1.1是爱快 2/4是AP 3是openwrt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">## 域名列表网址，每行一个，超过1000行会自动分为多个&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/gfw.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">interface&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">wan2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src-addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.1.1.5-10.1.1.250&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">url&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/greatfire.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>这个容器在更新的时候只会删除 备注名称为IKUAI_BYPASS的规则，自己添加的规则不会有影响。&lt;/p>&lt;/blockquote>
&lt;h4 id="去广告和dns加速">去广告和dns加速
&lt;/h4>&lt;p>adguardhome 配制 爱快的dns加速即可。
adg 分流 &lt;a class="link" href="https://github.com/mouyase/ChinaListForAdGuardHome/" target="_blank" rel="noopener"
>https://github.com/mouyase/ChinaListForAdGuardHome/&lt;/a>&lt;br>
也可以不单独分流，直接一股脑把dns全部写入 也可以.&lt;br>
另外最好用 爱快 3.7.7 版本，目前是体验版 ikuai9.com:555/1/main/iKuai_x86_beta 直接后台直接上传升级。3.7.7 的第三方代理加速模式支持设置备用dns.可以在adguardhome关闭或者宕机保证正常。&lt;/p>
&lt;h4 id="关于ipv6">关于ipv6
&lt;/h4>&lt;p>上面ipv4 正常后，op和爱快这边都可以打开ipv6 可以正常支持。&lt;/p>
&lt;h2 id="部分配置截图">部分配置截图
&lt;/h2>&lt;blockquote>
&lt;p>默认上传到imgur 请挂深度学习工具查看，也可能失效&lt;/p>&lt;/blockquote>
&lt;p>爱快 网络设置 &amp;gt; 内外网设置 &lt;a class="link" href="https://i.imgur.com/lZBdtGc.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a>&lt;br>
爱快 wan2 设置 &lt;a class="link" href="https://i.imgur.com/7k7R7ZU.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a>&lt;br>
爱快 基于ip的分流设置 &lt;a class="link" href="https://i.imgur.com/Xsb6nQr.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a>&lt;br>
爱快 基于ip的自定义运营商的设置，红框部分由ztc1997/ikuai-bypass自动管理 &lt;a class="link" href="https://i.imgur.com/6Ht7Xvr.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a> &lt;br>
爱快 基于域名的设置 红框部分由ztc1997/ikuai-bypass自动管理 &lt;a class="link" href="https://i.imgur.com/AzAcED8.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a> &lt;br>
爱快 强制openwrt的出口流量走wan1的设置 10.1.1.3是爱快通过dhcp给openwrt分配的域名 &lt;a class="link" href="https://i.imgur.com/qrQVUM5.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a> &lt;br>
爱快内kvm运行的openwrt的配置 pve/lxc/docker运行都是一样，关键是需要两个虚拟网口 &lt;a class="link" href="https://i.imgur.com/FAuTRsl.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a> &lt;br>
openwrt 两个网口的设置 &lt;a class="link" href="https://i.imgur.com/fgjAkgK.png" target="_blank" rel="noopener"
>点击查看imgur&lt;/a>&lt;/p>
&lt;h2 id="附lxc的openwrt配置文件">附lxc的openwrt配置文件
&lt;/h2>&lt;p>cat /etc/pve/lxc/103.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">arch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">amd64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">cores&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">hostname&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">op&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">memory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">512&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">net0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">name=eth0,bridge=vmbr0,hwaddr=1A:C2:8D:8D:56:70,type=veth&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">net1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">name=eth1,bridge=vmbr0,hwaddr=EA:49:A6:98:4D:59,type=veth&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">ostype&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unmanaged&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">rootfs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nvme_btrfs:103/vm-103-disk-0.raw,size=512M&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">swap&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">lxc.include&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/share/lxc/config/openwrt.common.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">lxc.cgroup2.devices.allow&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">c 108:0 rwm&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">lxc.mount.entry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dev/ppp dev/ppp none bind,create=file&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">lxc.mount.entry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dev/net dev/net none bind,create=dir&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">lxc.cap.drop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>lxc.cgroup2 适合pve7-8版本 旧版是 lxc.cgroup&lt;br>
/dev/ppp 因为这里op不需要拨号所以非必需 &lt;br>
/dev/net 是 clash-tun要用的&lt;/p>&lt;/blockquote>
&lt;h2 id="附ikuai的kvm配置文件">附ikuai的kvm配置文件
&lt;/h2>&lt;p>cat /etc/pve/qemu-server/101.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">agent&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">boot&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">order=scsi0;ide2;net0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">cores&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">cpu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">host&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">ide2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nvme_btrfs:iso/iKuai8_x64_3.7.6_Build202309081651.iso,media=cdrom,size=52604K&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">machine&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">q35&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">memory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">4096&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">meta&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">creation-qemu=8.0.2,ctime=1698058265&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ikuai&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">net0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">virtio=F6:9E:AC:C8:3B:64,bridge=vmbr0,firewall=1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">net1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">virtio=0A:58:E2:6F:14:21,bridge=vmbr0,firewall=1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">net2&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">virtio=DA:36:A5:E6:93:9B,bridge=vmbr0,firewall=1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">numa&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">onboot&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">ostype&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">l26&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">scsi0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nvme_btrfs:101/vm-101-disk-0.qcow2,cache=unsafe,iothread=1,size=4G&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">scsihw&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">virtio-scsi-single&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">smbios1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">uuid=cd6edce3-e6d4-44e2-abd7-f6907dcaf34c&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">sockets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">vmgenid&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">42a99cea-820b-48fe-9ef5-2989a97e9758&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>可以用3.7.6安装后升级到3.7.7&lt;br>
三个虚拟网口&lt;/p>&lt;/blockquote>
&lt;h2 id="本文另外发布到恩山帖">本文另外发布到恩山帖
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.right.com.cn/forum/thread-8310402-1-1.html" target="_blank" rel="noopener"
>https://www.right.com.cn/forum/thread-8310402-1-1.html&lt;/a>&lt;/p>
&lt;h2 id="本文参考">本文参考
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.right.com.cn/forum/thread-8252571-1-1.html" target="_blank" rel="noopener"
>https://www.right.com.cn/forum/thread-8252571-1-1.html&lt;/a>&lt;/p></description></item><item><title>fake-ip代理的问题 ddns失效 等</title><link>https://dev.leiyanhui.com/openwrt/oc-fakeip/</link><pubDate>Tue, 19 Sep 2023 00:01:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/oc-fakeip/</guid><description>&lt;p>fake-ip和 redir-host两者区别，哪个好？&lt;/p>
&lt;p>在redir-host模式下，Clash先将域名进行解析，再将具体的IP地址响应给客户端，并且记录其对应关系。&lt;/p>
&lt;p>而在fake-ip模式下则不进行DNS解析，而是直接生成一个“假IP”并响应给客户端，再记录对应关系。&lt;/p>
&lt;p>这可以有如下两个好处：
1、fake-ip的响应会更快(因为会马上给你一个假IP)，如果最后判定为代理，则有可能节省一次本地的DNS请求.在访问国内网站的时候，速度会提升0.1-0.3m
2、不需要担心DNS污染（因为配置文件中的DNS仅用作规则判定）&lt;/p>
&lt;p>坏处 就是，你ping任何域名 获得的ip的都是假的。哪怕不存在的域名。ping的超时时间也肯定是错误的。&lt;/p>
&lt;p>日常使用不会有太大的影响，但是你在内网访问ddns的域名时候，默认请求到你的公网ip然后路由器直接环回到内网。因为这个ip是假的 就导致 无法 完成后面的操作。&lt;/p>
&lt;p>在不配置 smartdns的情况下，使用fake-ip 也不用其它的dns插件。不代理udp（游戏），代理ipv6 。
整体使用感受会很舒适。&lt;/p>
&lt;p>解决方法也很简单，在openclash中 开启fake-ip 后切换到 覆写设置 dns设置 Fake-IP-Filter 里面配置你要绕过 fake-ip 直接访问的域名。&lt;/p>
&lt;p>例如&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#LAN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">lan&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">localdomain&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">example&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">invalid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">localhost&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">arpa&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#放行NTP服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">gov&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ios&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time1&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time2&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time3&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time4&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time5&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time6&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time7&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp1&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp2&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp3&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp4&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp5&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp6&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntp7&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">ntp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ntp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cloud&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tencent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#放行网易云音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">163.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">163.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="mf">126.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#百度音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">musicapi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">taihe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">taihe&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#酷狗音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">songsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kugou&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">trackercdn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kugou&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#酷我音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">kuwo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#JOOX音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">api&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">jooxtt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sanook&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">joox&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">joox&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#QQ音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">streamoc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mobileoc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">isure&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qqmusic&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qqmusic&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">aqqmusic&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">amobile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#虾米音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">xiami&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#咪咕音乐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">migu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">music&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">migu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#win10本地连接检测&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">msftconnecttest&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">msftncsi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#QQ登录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ptlogin2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">localhost&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">qq&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">tencent&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Game&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Nintendo Switch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">srv&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nintendo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">srv&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nintendo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Sony PlayStation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">stun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">playstation&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Microsoft Xbox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xbox&lt;/span>&lt;span class="o">.*.*.&lt;/span>&lt;span class="n">microsoft&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.*.&lt;/span>&lt;span class="n">xboxlive&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xbox&lt;/span>&lt;span class="o">.*.&lt;/span>&lt;span class="n">microsoft&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xnotify&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">xboxlive&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Wotgame&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">battlenet&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">wotgame&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">wggames&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">wowsgame&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">wargaming&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Golang&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">proxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">golang&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#STUN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stun&lt;/span>&lt;span class="o">.*.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stun&lt;/span>&lt;span class="o">.*.*.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">stun&lt;/span>&lt;span class="o">.*.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">stun&lt;/span>&lt;span class="o">.*.*.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">stun&lt;/span>&lt;span class="o">.*.*.*.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">stun&lt;/span>&lt;span class="o">.*.*.*.*.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Linksys Router&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">heartbeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">belkin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">linksys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">linksyssmartwifi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#ASUS Router&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">asus&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Apple Software Update Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mesu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">swscan&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">swquery&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">swdownload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">swcdn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">swdist&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Google&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lens&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">google&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">l&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">google&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">na&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Netflix&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">nflxvideo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#FinalFantasy XIV Worldwide Server &amp;amp; CN Server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">square&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">enix&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">finalfantasyxiv&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">ffxiv&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">ff14&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sdo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ff&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dorado&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sdo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Bilibili&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*.&lt;/span>&lt;span class="n">mcdn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bilivideo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Disney Plus&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">media&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dssott&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#shark007 Codecs &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">shark007&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Mijia&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Mijia&lt;/span> &lt;span class="n">Cloud&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#招商银行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">cmbchina&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">cmbimg&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#AdGuard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">local&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">adguard&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#迅雷&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">sandai&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">net&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">n0808&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#自己&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+.&lt;/span>&lt;span class="n">leiyanhui&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>smartdns和openclash的配合</title><link>https://dev.leiyanhui.com/openwrt/smartdns-openclash/</link><pubDate>Tue, 19 Sep 2023 00:01:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/smartdns-openclash/</guid><description>&lt;h2 id="安装配置-smartdns">安装配置 smartdns
&lt;/h2>&lt;p>opkg install luci-app-smartdns&lt;/p>
&lt;p>然后配置上游dns 即可&lt;/p>
&lt;p>需要配置多个 上游dns ， 最好 几个国内的 几个境外&lt;/p>
&lt;h2 id="openclash-配置">openclash 配置
&lt;/h2>&lt;p>openclash 使用redir-host 模式即可，然后追加上游dns 为本地 127.0.0.1:smartdns端口&lt;/p>
&lt;h2 id="注意">注意
&lt;/h2>&lt;p>smartdns 并发请求 上游dns，也就是默认情况下，你访问某一个网站，多个dns 都会收到查询请求。&lt;/p>
&lt;p>所以需要进一步调整 配置 域名列表&lt;/p>
&lt;h2 id="一般建议">一般建议
&lt;/h2>&lt;p>通常来说 非必要情况下 不建议 smartdns 和 openclash 一起使用，广告过滤可以 openclash规则处理掉 ，国内域名的dns加速，可以 fake-ip 处理掉。&lt;/p>
&lt;p>mosdns 也是一个不错的选择！&lt;/p>
&lt;h2 id="mosdns">mosdns
&lt;/h2>&lt;p>白名单：加入的域名始终允许使用 “本地 DNS” 进行解析，且优先级最高（每个域名一行，支持域名匹配规则）
黑名单：加入的域名将屏蔽 DNS 解析（每个域名一行，支持域名匹配规则）
灰名单：加入的域名始终使用 “远程 DNS” 进行解析（每个域名一行，支持域名匹配规则）
DDNS 域名：加入的域名始终使用 “本地 DNS” 进行解析，并且强制 TTL 5 秒，解析结果不会进入缓存（每个域名一行，支持域名匹配规则）
Hosts：自定义 Hosts 重写，如：baidu.com 10.0.0.1（每个规则一行）
重定向：重定向请求的域名。请求域名 A，但返回域名 B 的记录，如：baidu.com qq.com（每个规则一行）
PTR 黑名单：加入的域名将阻止 PTR 请求（每个域名一行，支持域名匹配规则）&lt;/p></description></item><item><title>双网卡 pve8.0.3 lxc 运行 openwrt作为主路由 最靠谱简单教程</title><link>https://dev.leiyanhui.com/openwrt/lxc-mian-op/</link><pubDate>Sat, 16 Sep 2023 00:01:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/lxc-mian-op/</guid><description>&lt;p>在pve上运行openwrt作为主路由使用。无论单个网卡或者多个网卡其实操作都操作。&lt;br>
lxc运行的openwrt 对虚拟机方式运行的性能更好，资源占用更低。&lt;/p>
&lt;p>我目前是有两台pve 均为单网卡。
一台 x240主板 15-20w i3-4030U 8G 128G+1T。
上面lxc 运行 openwrt做主路由，同时在lxc里面运行了几个开源软件做核心数据的nas. 另外虚拟机运行了一个win 和一个备用mac（x240内存8G跑太多不够玩）&lt;br>
一台 qnct组装机 20-60w 6核32G nvme 500G+12T
pve装了桌面系统做日用机。并且挂了4块硬盘 也开了nas,虚拟运行win直通显卡打游戏 macos直通核显偶尔签app用。&lt;/p>
&lt;h2 id="场景">场景
&lt;/h2>&lt;h3 id="pve单网卡">pve单网卡
&lt;/h3>&lt;p>pve 单个网卡 接入交换机
光猫 桥接 接入交换机
其他设备 包括ap等同样接入交换机。
光猫通常插到交换机的第一个口上，不过家用交换机一般都是傻瓜式的，随便插都可以。
这是最常用的方案,top图大概如下 ，就是所有设备都接到交换机就ok&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 光猫 这里光猫是桥接
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 其他设备
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 其他设备
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 其他设备
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; pve物理网卡===&amp;gt; pve vmbr0 ===&amp;gt; lxc和kvm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>vmbr0 你可以视作一个虚拟万兆交换机就好理解了。pve默认用你在/etc/network/interfaces配置的ip,lxc和kvm内用你指定或者网内任意一个
使用虚拟机的情况下 pve内 就是 vmbr0 映射一个虚拟网卡到 到虚拟机。然后虚拟内部配置静态ip的和pve以及交换机上的其他设备在同一个网段就可以完成互相访问了。
那么到lxc的话也是一样。但是到openwrt的因为需要一个lan一个wan,所以我们这里直接映射两个虚拟网卡给openwrt就好了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vmbr0 ===&amp;gt; net0 === lxc openwrt eth0做lan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmbr0 ===&amp;gt; net1 === lxc openwrt eth1做wan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>反应到lxc的配置文件里面就是&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">net0: name=eth0,bridge=vmbr0,hwaddr=随便填写个MAC地址,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net1: name=eth1,bridge=vmbr0,hwaddr=随便再来个MAC地址,type=veth
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然你也可以去openewrt内部做网桥来弄，但是完全没有必要。&lt;/p>
&lt;h3 id="pve多网卡">pve多网卡
&lt;/h3>&lt;p>pve 多个网卡，直接直通网卡给openwrt即可。
下面的例子是pve双网卡 板载接入交换机 usb网卡接入光猫。
pve 为单板载网卡enp0s25，但是有一个usb3千兆网卡enx0023545ca007。为例，多网卡一样操作。&lt;br>
在pve中 左侧 点数据中心下的pve ，然后点 中间的 系统下面的网络 ，查看这两个网口的名称。&lt;br>
板载网卡做为pve管理口 插入交换机 局域网其他设备也插入普通交换机。
usb网卡作为链接外网的网卡 插入光猫。 记住这usb3网口的名字即可。下文统一以 enx0023545ca007 代替。&lt;/p>
&lt;h2 id="步骤">步骤
&lt;/h2>&lt;h3 id="获取-openwrt-rootfs包">获取 openwrt rootfs包
&lt;/h3>&lt;p>可以从IMG.GZ/SQUASHFS.IMG.GZ 提取，或者直接下载 ROOTFS.TAR.GZ 包。
从IMG.GZ/SQUASHFS.IMG.GZ 提取 提取的思路：解压gz 挂载img/SQUASHFS ，打包挂载后的文件到 ROOTFS.TAR.GZ
建议直接用 ROOTFS.TAR.GZ 即可。
我这里用 &lt;a class="link" href="https://openwrt.ai/" target="_blank" rel="noopener"
>https://openwrt.ai/&lt;/a> supe提供的 ROOTFS.TAR.GZ&lt;/p>
&lt;h3 id="rootfs包上传到-pve">rootfs包上传到 pve
&lt;/h3>&lt;p>pve 后台找到 CT模板 点上传。我这里是手动下载到pve的 &lt;code> /var/lib/vz/template/cache/&lt;/code> 都是一样的&lt;/p>
&lt;h3 id="创建一个ctlxc">创建一个CT/lxc
&lt;/h3>&lt;p>pve目前依旧无法直接创建op的lxc，这里还是用命令行。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pct create &lt;span class="m">100&lt;/span> local:vztmpl/openwrt-09.26.2023-x86-64-generic-rootfs.tar.gz --rootfs local:1 --ostype unmanaged --hostname OP --arch amd64 --cores &lt;span class="m">2&lt;/span> --memory &lt;span class="m">1024&lt;/span> --swap &lt;span class="m">0&lt;/span> -net0 &lt;span class="nv">bridge&lt;/span>&lt;span class="o">=&lt;/span>vmbr0,name&lt;span class="o">=&lt;/span>eth0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="解释">解释
&lt;/h4>&lt;ul>
&lt;li>pct create 100 是pve里面CT或者VM的id值，你可以修改成你的&lt;/li>
&lt;li>local:vztmpl/openwrt-09.26.2023-x86-64-generic-rootfs.tar.gz 是上面你上传到rootfs的包名&lt;/li>
&lt;li>rootfs local:1 是本lxc储存位置和硬盘占用大小限制1G 如果用其他地方储存 rootfs local-lvm:1 rootfs local-brtfs:0.5&lt;/li>
&lt;li>ostype unmanaged 操作系统类型&lt;/li>
&lt;li>hostname OP 节点名称&lt;/li>
&lt;li>arch amd64 cpu平台&lt;/li>
&lt;li>cores 2 可占用的cpu核心数&lt;/li>
&lt;li>memory 1024 swap 0 内存和交换内存，建议关闭交换内存 也就是0&lt;/li>
&lt;li>net0 bridge=vmbr0,name=eth0 把pve的管理网桥给op用，也就是op把他作为 lan&lt;/li>
&lt;/ul>
&lt;h3 id="手动修改配置">手动修改配置
&lt;/h3>&lt;h4 id="2-n网卡直通一个进去">2-N网卡直通一个进去
&lt;/h4>&lt;p>cat /etc/pve/nodes/pve/lxc/100.conf 添加下面几行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc.include: /usr/share/lxc/config/openwrt.common.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.type: phys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.link: enx0023545ca007
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.flags: up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.name: eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup2.devices.allow: c 108:0 rwm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="完整配置">完整配置
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cores: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostname: OP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">memory: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net0: name=eth0,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A4,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">onboot: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ostype: unmanaged
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootfs: local:100/vm-100-disk-1.raw,size=1G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">startup: up=2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">swap: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.include: /usr/share/lxc/config/openwrt.common.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.type: phys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.link: enx0023545ca007
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.flags: up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.name: eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup2.devices.allow: c 108:0 rwm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/net dev/net none bind,create=dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="解释-1">解释
&lt;/h5>&lt;ul>
&lt;li>lxc.include 包含pve自带的op配置模板&lt;/li>
&lt;li>lxc.net.1 直通网卡enx0023545ca007进去作为 eth1&lt;/li>
&lt;li>lxc.cgroup2 的配置，这是lxc运行一些服务类的系统必须的&lt;/li>
&lt;li>lxc.mount.entry 挂载ppoe和tun到lxc内&lt;/li>
&lt;li>lxc.cap.drop: 取消 openwrt.common.conf 里面 对 cap的限制，不然openclash无法使用&lt;/li>
&lt;/ul>
&lt;h4 id="单网卡">单网卡
&lt;/h4>&lt;h5 id="完整配置-1">完整配置
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cores: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostname: OP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">memory: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net0: name=eth0,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A4,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net1: name=eth1,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A3,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">onboot: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ostype: unmanaged
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootfs: local:100/vm-100-disk-1.raw,size=1G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">startup: up=2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">swap: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.include: /usr/share/lxc/config/openwrt.common.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup2.devices.allow: c 108:0 rwm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/net dev/net none bind,create=dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="解释-2">解释
&lt;/h5>&lt;p>两个虚拟网卡直接映射进去就可以了e .&lt;/p>
&lt;h3 id="启动">启动
&lt;/h3>&lt;p>pct start 100&lt;/p>
&lt;h3 id="目前发现的问题">目前发现的问题
&lt;/h3>&lt;h4 id="nat-环回-无效">NAT 环回 无效
&lt;/h4>&lt;p>简单的说，就是内网使用ddns的域名访问内网的服务器，无法访问。 &lt;br>
目前尚不知道如何解决。貌似和openwrt的版本有关系，在使用git-24.286.72457-5518424编译 并且未在openwrt内部使用docker的情况下此问题正常。 但是在更新的版本中又再次出现。
临时解决方法有两种&lt;/p>
&lt;h5 id="别名主机">别名主机
&lt;/h5>&lt;p>别名主机可以在 openwrt 网络 -&amp;gt; dncp -&amp;gt; 主机名映射的地方 添加域名到对应的内网机器ip上。然后清理本地dns缓存后即可访问。也可以在openwrt里面运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">uci add dhcp domain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci set dhcp.@domain[-1].name=&amp;#39;nas.leiyanhui.com&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add_list dhcp.@domain[-1].ip=&amp;#39;10.1.1.50&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dnsmasq restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="自定域名解析">自定域名解析
&lt;/h5>&lt;p>如果你有使用adguardHome 之类的自建dns,可以在dns内添加对应的域名解析记录到内网ip。或者修改需要访问的的电脑的hosts文件。&lt;/p>
&lt;h4 id="openclash-tun无法使用">openclash tun无法使用
&lt;/h4>&lt;p>暂时不知道如何解决。&lt;/p>
&lt;h4 id="部分情况下-udp无法转发">部分情况下 udp无法转发
&lt;/h4>&lt;p>需要PVE系统加载 xt_TPROXY 模块。在PVE系统下执行改命令后重启。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="s1">&amp;#39;xt_TPROXY&amp;#39;&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">load&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="偶尔发生pve外机器无法上网">偶尔发生pve外机器无法上网
&lt;/h4>&lt;p>后续发现是ap的原因，重启ap后解决。 如果你的ap刷过系统，可以在ap内检测主路由状态，如果ping不到lxc的主路由，那么重启即可。&lt;/p>
&lt;h4 id="openclash配置参考">openclash配置参考
&lt;/h4>&lt;p>/etc/config/openclash
注意下文中的 testingcf.jsdelivr.net 地址在部分地区可能已经干扰，请&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;span class="lnt">242
&lt;/span>&lt;span class="lnt">243
&lt;/span>&lt;span class="lnt">244
&lt;/span>&lt;span class="lnt">245
&lt;/span>&lt;span class="lnt">246
&lt;/span>&lt;span class="lnt">247
&lt;/span>&lt;span class="lnt">248
&lt;/span>&lt;span class="lnt">249
&lt;/span>&lt;span class="lnt">250
&lt;/span>&lt;span class="lnt">251
&lt;/span>&lt;span class="lnt">252
&lt;/span>&lt;span class="lnt">253
&lt;/span>&lt;span class="lnt">254
&lt;/span>&lt;span class="lnt">255
&lt;/span>&lt;span class="lnt">256
&lt;/span>&lt;span class="lnt">257
&lt;/span>&lt;span class="lnt">258
&lt;/span>&lt;span class="lnt">259
&lt;/span>&lt;span class="lnt">260
&lt;/span>&lt;span class="lnt">261
&lt;/span>&lt;span class="lnt">262
&lt;/span>&lt;span class="lnt">263
&lt;/span>&lt;span class="lnt">264
&lt;/span>&lt;span class="lnt">265
&lt;/span>&lt;span class="lnt">266
&lt;/span>&lt;span class="lnt">267
&lt;/span>&lt;span class="lnt">268
&lt;/span>&lt;span class="lnt">269
&lt;/span>&lt;span class="lnt">270
&lt;/span>&lt;span class="lnt">271
&lt;/span>&lt;span class="lnt">272
&lt;/span>&lt;span class="lnt">273
&lt;/span>&lt;span class="lnt">274
&lt;/span>&lt;span class="lnt">275
&lt;/span>&lt;span class="lnt">276
&lt;/span>&lt;span class="lnt">277
&lt;/span>&lt;span class="lnt">278
&lt;/span>&lt;span class="lnt">279
&lt;/span>&lt;span class="lnt">280
&lt;/span>&lt;span class="lnt">281
&lt;/span>&lt;span class="lnt">282
&lt;/span>&lt;span class="lnt">283
&lt;/span>&lt;span class="lnt">284
&lt;/span>&lt;span class="lnt">285
&lt;/span>&lt;span class="lnt">286
&lt;/span>&lt;span class="lnt">287
&lt;/span>&lt;span class="lnt">288
&lt;/span>&lt;span class="lnt">289
&lt;/span>&lt;span class="lnt">290
&lt;/span>&lt;span class="lnt">291
&lt;/span>&lt;span class="lnt">292
&lt;/span>&lt;span class="lnt">293
&lt;/span>&lt;span class="lnt">294
&lt;/span>&lt;span class="lnt">295
&lt;/span>&lt;span class="lnt">296
&lt;/span>&lt;span class="lnt">297
&lt;/span>&lt;span class="lnt">298
&lt;/span>&lt;span class="lnt">299
&lt;/span>&lt;span class="lnt">300
&lt;/span>&lt;span class="lnt">301
&lt;/span>&lt;span class="lnt">302
&lt;/span>&lt;span class="lnt">303
&lt;/span>&lt;span class="lnt">304
&lt;/span>&lt;span class="lnt">305
&lt;/span>&lt;span class="lnt">306
&lt;/span>&lt;span class="lnt">307
&lt;/span>&lt;span class="lnt">308
&lt;/span>&lt;span class="lnt">309
&lt;/span>&lt;span class="lnt">310
&lt;/span>&lt;span class="lnt">311
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">config openclash &amp;#39;config&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proxy_port &amp;#39;7892&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option tproxy_port &amp;#39;7895&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option mixed_port &amp;#39;7893&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option socks_port &amp;#39;7891&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option http_port &amp;#39;7890&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dns_port &amp;#39;7874&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option en_mode &amp;#39;redir-host&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option cn_port &amp;#39;9090&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dashboard_password &amp;#39;123456&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dashboard_forward_ssl &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option rule_source &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_custom_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipv6_enable &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipv6_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_custom_clash_rules &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option other_rule_auto_update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option core_version &amp;#39;linux-amd64&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_redirect_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option servers_if_update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option disable_masq_cache &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option servers_update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option log_level &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proxy_mode &amp;#39;rule&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option intranet_allowed &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option disable_udp_quic &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option lan_ac_mode &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option operation_mode &amp;#39;redir-host&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_rule_proxy &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option redirect_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option cachesize_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option filter_aaaa_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option small_flash_memory &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface_name &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option common_ports &amp;#39;21 22 23 53 80 123 143 194 443 465 587 853 993 995 998 2052 2053 2082 2083 2086 2095 2096 5222 5228 5229 5230 8080 8443 8880 8888 8889&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option log_size &amp;#39;1024&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option tolerance &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option store_fakeip &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_fallback_filter &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_fakeip_filter &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_host &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_name_policy &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option append_wan_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option stream_domains_prefetch &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option stream_auto_select &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option bypass_gateway_compatible &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option github_address_mod &amp;#39;自定义的github代理地址&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option urltest_address_mod &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option urltest_interval_mod &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option delay_start &amp;#39;15&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option router_self_proxy &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option release_branch &amp;#39;master&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_core &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dashboard_type &amp;#39;Official&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option yacd_type &amp;#39;Official&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option append_default_dns &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_custom_url &amp;#39;https://ispip.clang.cn/all_cn.txt&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr6_custom_url &amp;#39;https://ispip.clang.cn/all_cn_ipv6.txt&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option cndomain_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/felixonmars/dnsmasq-china-list@master/accelerated-domains.china.conf&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option default_resolvfile &amp;#39;/tmp/resolv.conf.d/resolv.conf.auto&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option find_process_mode &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option global_client_fingerprint &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geodata_loader &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_geoip_dat &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_sniffer &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_sniffer_pure_ip &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_sniffer_custom &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_reload &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_auto_update_mode &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_update_interval &amp;#39;45&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_path &amp;#39;/etc/openclash/config/skyvpn.yaml&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option restricted_mode &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_resolvfile &amp;#39;/tmp/resolv.conf.d/resolv.conf.auto&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_custom_domain_dns_server &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option china_ip_route &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_update_day_time &amp;#39;6&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_update_day_time &amp;#39;3&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_restart &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_restart_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_restart_day_time &amp;#39;13&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option core_type &amp;#39;Meta&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_udp_proxy &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_update_day_time &amp;#39;7&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_update_day_time &amp;#39;8&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_noresolv &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipv6_mode &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_v6_udp_proxy &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option china_ip6_route &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_cachesize &amp;#39;10000&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_filter_aaaa &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;114.114.114.114&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;119.29.29.29&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;119.28.28.28&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;223.5.5.5&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.pub/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.alidns.com/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.cloudflare.com/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.google&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;853&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;1.1.1.1/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;1.1.1.1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;853&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;8.8.8.8&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;853&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;2001:4860:4860::8888&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;53&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;2001:4860:4860::8844&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;53&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;2001:da8::666&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;53&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;public.dns.iij.jp/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;jp.tiar.app/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;jp.tiarap.org/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;jp.tiar.app&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dot.tiar.app&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.dnslify.com/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.twnic.tw/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.oszx.co/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.applied-privacy.net/query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dnsforge.de/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.ffmuc.net/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.mullvad.net/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config authentication&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option username &amp;#39;Clash&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option password &amp;#39;socket合同http（s）代理密码&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;10.1.1.104&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_resolve &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option specific_group &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;10.1.1.104&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_resolve &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option specific_group &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;default&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;10.1.1.104&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_resolve &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config config_subscribe&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option name &amp;#39;skyvpn&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option address &amp;#39;你的订阅地址&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option sub_convert &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option convert_address &amp;#39;https://api.dler.io/sub&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option template &amp;#39;ACL4SSR 规则 Online Full&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option emoji &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option udp &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option skip_cert_verify &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option sort &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_type &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option rule_provider &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt 下openclash 常用规则和配置</title><link>https://dev.leiyanhui.com/openwrt/openclash/</link><pubDate>Fri, 13 Jan 2023 02:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/openclash/</guid><description>&lt;p>openclash 可以说是最强大的科学软件，缺点就是 略微繁琐界面不友好，另外对路由器性能有要求，低端的硬路由刷op的情况 就不太适合。x86的话因为性能富裕，所以非常适合。&lt;/p>
&lt;p>openclash 安装后，只要添加订阅地址后 就可以 愉快使用。如果有更多要求部分地方可能还需要自己手动调整一下。&lt;br>
记录一下 我的配置&lt;/p>
&lt;h2 id="在线订阅转换-推荐使用">在线订阅转换 推荐使用
&lt;/h2>&lt;p>acl4ssr oneline full，添加Emoji 启用 udp。弄完之后 要重启一下 openclash&lt;/p>
&lt;h2 id="自动测速自动切换节点">自动测速自动切换节点
&lt;/h2>&lt;p>Dashboard 控制面板 ，Selector 选择 自动&lt;/p>
&lt;h2 id="ipv6支持和ddns无法获取ipv6地址的处理">ipv6支持和ddns无法获取ipv6地址的处理
&lt;/h2>&lt;p>openwrt 全局设置：dns设置 &lt;code>允许 IPv6 类型 DNS 解析&lt;/code>&lt;br>
ddns myddns_ipv6 -&amp;gt; IP 地址来源 -&amp;gt; 接口 接口选择 br-lan&lt;/p>
&lt;blockquote>
&lt;p>节点不支持ipv6的情况下 会自动走v4,当然也打不开纯v6站点&lt;br>
模式设置里面 &lt;code>IPv6 流量代理&lt;/code> 不建议打开&lt;/p>&lt;/blockquote>
&lt;h2 id="指定网站强制走代理">指定网站强制走代理
&lt;/h2>&lt;p>例如 dev.leiyanhui.com 我同时在国内cdn 和 GitHub page 两个镜像，因为国内cdn延迟更新，所以自己访问 强制到 GitHub&lt;br>
在全局设置 访问控制 &lt;code>绕过中国大陆 IPv4 黑名单&lt;/code> 里面添加 dev.leiyanhui.com 即可，同理可以ipv6的也添加上域名&lt;/p>
&lt;h2 id="全局dohdot的实现">全局doh/dot的实现
&lt;/h2>&lt;p>全局设置 dns 打开 &lt;code>本地 DNS 劫持&lt;/code> &lt;code>自定义上游 DNS 服务器&lt;/code> &lt;code>*远程域名解析&lt;/code> &lt;code>追加上游 DNS&lt;/code> &lt;code>追加默认 DNS&lt;/code> &lt;code>禁止 Dnsmasq 缓存 DNS&lt;/code>&lt;br>
然后 在下面的&lt;code>设置自定义上游 DNS 服务器&lt;/code> 里面 只勾选 http和 tls 类的dns，也可以自己添加&lt;/p>
&lt;h2 id="需要自定义配置文件的一些功能实现">需要自定义配置文件的一些功能实现
&lt;/h2>&lt;p>自定义规则 可以附加到 机场的规则前面。 全局设置 规则设置 自定义规则 勾选上，规则 添加到 &lt;code>设置自定义规则（优先匹配）&lt;/code> 的rules:里面&lt;/p>
&lt;h2 id="全局被走代理">全局被走代理
&lt;/h2>&lt;p>检查规则没问题，但是用国内的网站查询ip依旧是梯子的工具。&lt;br>
经过测试，在 openclash 代理模式 切换一次 即可。
常用ip查询网站：&lt;br>
&lt;a class="link" href="https://ip.skk.moe/" target="_blank" rel="noopener"
>https://ip.skk.moe/&lt;/a> （境外cf，openclash默认绕过）&lt;br>
&lt;a class="link" href="https://ip.cn/" target="_blank" rel="noopener"
>https://ip.cn/&lt;/a> (注意，这个网站在境外cf) &lt;br>
&lt;a class="link" href="https://ip138.com/" target="_blank" rel="noopener"
>https://ip138.com/&lt;/a> （境内，不少机场默认阻断）
&lt;a class="link" href="https://ip.chinaz.com/" target="_blank" rel="noopener"
>https://ip.chinaz.com/&lt;/a> （境内，不少机场默认阻断）
&lt;a class="link" href="http://checkip.synology.com/" target="_blank" rel="noopener"
>http://checkip.synology.com/&lt;/a> (境内)
&lt;a class="link" href="https://test-ipv6.com/" target="_blank" rel="noopener"
>https://test-ipv6.com/&lt;/a> (境外，可以检测ipv6)
&lt;a class="link" href="http://checkip.dyndns.com" target="_blank" rel="noopener"
>http://checkip.dyndns.com&lt;/a> （境外，IPv4 ）
&lt;a class="link" href="http://checkipv6.dyndns.com" target="_blank" rel="noopener"
>http://checkipv6.dyndns.com&lt;/a> （境外，IPv6 ）&lt;/p>
&lt;h3 id="指定网站强制不走代理">指定网站强制不走代理
&lt;/h3>&lt;p>例如&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,checkip.dyndns.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,checkipv6.dyndns.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,checkip.synology.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ifconfig.co,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,api.myip.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ip-api.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ipapi.co,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ip6.seeip.org,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,members.3322.org,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,github.dev,DIRECT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="内网指定设备强制走固定线路">内网指定设备强制走固定线路
&lt;/h3>&lt;p>比如，内网某一个手机强制 走 香港01 这个线路&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- SRC-IP-CIDR,192.168.1.201/32,26, 🇸🇬 新加坡 01 | 专线
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- SRC-IP-CIDR,10.0.0.1/32,🇭🇰 香港节点
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>