<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Openwrt on 小类随手记</title><link>https://dev.leiyanhui.com/categories/openwrt/</link><description>Recent content in Openwrt on 小类随手记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 11 Jun 2025 08:30:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/categories/openwrt/index.xml" rel="self" type="application/rss+xml"/><item><title>adguard home单实例自动更新分流规则</title><link>https://dev.leiyanhui.com/c/adguardhome-rules/</link><pubDate>Wed, 11 Jun 2025 08:30:20 +0800</pubDate><guid>https://dev.leiyanhui.com/c/adguardhome-rules/</guid><description>&lt;blockquote>
&lt;p>本文更新可能滞后于 &lt;a class="link" href="https://github.com/joyanhui/adguardhome-rules" target="_blank" rel="noopener"
>github仓库的说明文档&lt;/a>&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>使用问题交流请去恩山或&lt;a class="link" href="https://github.com/joyanhui/adguardhome-rules/discussions" target="_blank" rel="noopener"
>discussions&lt;/a>&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>bug反馈和建议以及公共doh/github proxy分享都可以提&lt;a class="link" href="https://github.com/joyanhui/adguardhome-rules/issues" target="_blank" rel="noopener"
>issues&lt;/a>，我会尽快处理.给个star我会很开心.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>PR请尽量通过一次commit提交过来.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>关于爱快的分流规则请查看我另外的仓库 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass" target="_blank" rel="noopener"
>[joyanhui/ikuai-bypass]&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="单adguardhome分流解析">单adguardhome分流解析
&lt;/h2>&lt;h3 id="安装和启动">安装和启动
&lt;/h3>&lt;p>这里以opwenwrt主路由的情况为例子，其他环境随便使用docker或者官方的安装命令等都可以正常安装。此文不涵盖相关内容。&lt;/p>
&lt;p>非常不建议使用luci-app-adguardhome,不但没必要而且会带来更多困扰。&lt;/p>
&lt;p>先确定你的openwrt配置了正确的源，并且没有项目展会用3000端口，然后依次运行下面两行命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">opkg update &lt;span class="c1">#更新软件列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg install adguardhome &lt;span class="c1">#安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/adguardhome start &lt;span class="c1">#启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/adguardhome &lt;span class="nb">enable&lt;/span> &lt;span class="c1">#下次开机自动运行&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="adguardhome-替代路由器自带的dnsmasq">adguardhome 替代路由器自带的Dnsmasq
&lt;/h3>&lt;ul>
&lt;li>关闭Dnsmasq的dns功能：openwrt web界面：网络&amp;gt;DHCP/DNS&amp;gt;高级设置 &lt;code>DNS 服务器端口&lt;/code> 默认是53修改为0 即可关闭&lt;/li>
&lt;li>修改dhcp下发的dns ：openwrt web界面：网络&amp;gt;接口 找到&lt;code>br-lan&lt;/code> 编辑 一般在这个接口的DHCP服务器的高级设置里面 找到 &lt;code>DHCP 选项&lt;/code> 添加或者修改一协调&lt;code>6,192.168.1.1,223.6.6.6&lt;/code> 即给dhcp客户端分配两个dns地址192.168.1.1,223.6.6.6 如果你的 adguardhome的安装ip不是在192.168.1.1那么这里要修改一下&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>如果是爱快直接使用dns代理功能指定到adguardhome即可&lt;/p>&lt;/blockquote>
&lt;h3 id="adguardhome-基本配置">adguardhome 基本配置
&lt;/h3>&lt;p>访问你运行adguardhome的加端口号 3000，例如:http://192.168.1.1:3000&lt;/p>
&lt;p>dns端口就用53,因为上面我们已经把Dnsmasq的dns功能关闭了，所以这里adguard可以站哟机构53端口。 web访问端口不要用80,还是3000就好啦。&lt;/p>
&lt;p>以及配置好管理账号密码以后 进入adg的管理面板&lt;/p>
&lt;h4 id="adguardhome-基本dns配置">adguardhome 基本dns配置
&lt;/h4>&lt;p>adg的管理面板：设置 &amp;gt; DNS设置&lt;/p>
&lt;ul>
&lt;li>上游 DNS 服务器 随便输入一个可用的，不用配置太多，因为后面我们要用配置路径的方式用文件来配置上游dns规则。建议就输入一个 &lt;code>223.5.5.5&lt;/code>&lt;/li>
&lt;li>负载均衡/并行请求/最快ip地址 建议选择 并行请求&lt;/li>
&lt;li>Bootstrap DNS 服务器 输入几个公共dns的ip 例如 &lt;code>123.125.81.6&lt;/code> &lt;code>223.6.6.6&lt;/code> &lt;code>119.29.29.29&lt;/code>一行一个&lt;/li>
&lt;li>DNS 服务配置 速度限制 建议修改20-100左右，我这里配置为50&lt;/li>
&lt;li>DNS缓存配置 根据自己需求和硬件性能配置我这里配置 缓存大小&lt;code>1024000&lt;/code> 最小ttl&lt;code>30&lt;/code> 最大ttl&lt;code>1800&lt;/code>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>此时 整个局域网的，包括路由器openwrt自己的dns 均由adguard接管。测试未访问过的网站是否可以正常ping到ip地址。例如：&lt;code>ping news.163.com&lt;/code> &lt;code>ping news.baidu.com&lt;/code> &lt;code>ping image.baidu.com&lt;/code>&lt;/p>&lt;/blockquote>
&lt;h3 id="adguardhome-配置分流规则">adguardhome 配置分流规则
&lt;/h3>&lt;h4 id="adguardhome-分流思路">adguardhome 分流思路
&lt;/h4>&lt;p>adguard home支持 &lt;code>[/example.local/]94.140.14.140: 指定为特定域名的上游服务器；&lt;/code> 这样的规则，那么我们只需要整理对应的域名列表 然后指定对应的上游dns即可。但是在adguard home的管理面部中的上游dns配置这个页面 显然不可能输入上几万个域名。但是adguard支持直接用文件配置。而我们又可以从Loyalsoldier等大佬的仓库获得一些我们需要的域名清单。虽然格式不符合要求，但是我们可以自己用程序稍微处理一下让他符合adguard home的格式，再把多个域名清单列表合并到一个里面那就大功告成了。&lt;/p>
&lt;p>所以我提供好了 每天会更新的规则文件，你只需要下载回去自己再用脚本修改一下即可。 然后这个脚本 可以用wget下载sed修改，然后添加到计划人物每天运行就可以自动更新了。 地址是 &lt;code>https://github.com/joyanhui/adguardhome-rules/tree/release_file&lt;/code>&lt;/p>
&lt;h4 id="无辅助上网环境的情况下">无辅助上网环境的情况下
&lt;/h4>&lt;p>你要确定你有办法可以直接方法github的文件，以及有无污染的dns上游可用，建议自己准备一个域名自己从cloudflare自建一个github镜像站和自建一个私有doh.&lt;/p>
&lt;p>域名，可以申请免费那些域名。不过建议从阿里云或者cloudflare或者其他地方购买一个。8位数字的xyz域名一年只要几块钱。免费的二级域名比较容易在敏感时期全部被大局域网屏蔽，然后dns托管到cloudflare,开通 cloudflare worker。这个网络很多教程。&lt;/p>
&lt;ul>
&lt;li>配置自己的 github代理镜像网址 worker源码 &lt;a class="link" href="https://github.com/joyanhui/gh-proxy/blob/master/index.js" target="_blank" rel="noopener"
>https://github.com/joyanhui/gh-proxy/blob/master/index.js&lt;/a>&lt;/li>
&lt;li>配置自己的 doh源码： &lt;a class="link" href="https://github.com/joyanhui/adguardhome-rules/blob/main/cfworks_doh.js" target="_blank" rel="noopener"
>cfworks_doh.js&lt;/a> 记得修改里面的?dns-query=&lt;/li>
&lt;/ul>
&lt;p>如果你不想折腾可以从网络搜索其他人的，这里提供几个目前可用的&lt;/p>
&lt;h5 id="github-proxy-地址收集">github proxy 地址收集
&lt;/h5>&lt;ul>
&lt;li>&lt;a class="link" href="https://goppx.com/" target="_blank" rel="noopener"
>https://goppx.com/&lt;/a>&lt;/li>
&lt;li>github proxy: &lt;a class="link" href="https://github.akams.cn/" target="_blank" rel="noopener"
>https://github.akams.cn/&lt;/a>&lt;/li>
&lt;li>github proxy: &lt;a class="link" href="https://ghproxy.net/" target="_blank" rel="noopener"
>https://ghproxy.net/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h5 id="无污染的-dns-地址收集">无污染的 dns 地址收集
&lt;/h5>&lt;p>dot因为端口特殊的问题基本都不稳定，doh的话 cloudclare在多数下可用&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://dns.cloudflare.com/dns-query" target="_blank" rel="noopener"
>https://dns.cloudflare.com/dns-query&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="创建一个自动更新adguard上游dns规则文件的脚本">创建一个自动更新adguard上游dns规则文件的脚本
&lt;/h4>&lt;p>创建一个自动更新脚本 比如&lt;/p>
&lt;p>&lt;code>nano /overlay/data/adguard_upstream_dns_file_update.sh&lt;/code> 内容如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>rm -rf /overlay/data/adguard_upstream_dns_file.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget &lt;span class="s2">&amp;#34;https://你的githubProxy代理站地址/https://raw.githubusercontent.com/joyanhui/adguardhome-rules/refs/heads/release_file/ADG_chinaDirect_WinUpdate_Gfw.txt&amp;#34;&lt;/span> -O /overlay/data/adguard_upstream_dns_file.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/d-o-h.you-cf-domain.com/你的doh域名部分/g&amp;#39;&lt;/span> /overlay/data/adguard_upstream_dns_file.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/your-suffix/你的doh后缀部分/g&amp;#39;&lt;/span> /overlay/data/adguard_upstream_dns_file.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/adguardhome restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果你没有自己的私有githubPoryx和doh&lt;/p>
&lt;ul>
&lt;li>GithubProxy
&lt;ul>
&lt;li>&lt;code>https://你的githubProxy代理站地址/&lt;/code> 修改为 &lt;code>https://goppx.com/&lt;/code>。也可以把wget的完整地址更换为&lt;/li>
&lt;li>&lt;code>https://joyanhui.github.io/adguardhome-rules/ADG_chinaDirect_WinUpdate_Gfw.txt&lt;/code>&lt;/li>
&lt;li>&lt;code>https://gcore.jsdelivr.net/gh/joyanhui/adguardhome-rules@release_file/ADG_chinaDirect_WinUpdate_Gfw.txt&lt;/code>&lt;/li>
&lt;li>&lt;code>https://testingcf.jsdelivr.net/gh/joyanhui/adguardhome-rules@release_file/ADG_chinaDirect_WinUpdate_Gfw.txt&lt;/code>&lt;/li>
&lt;li>&lt;code>https://cdn.jsdmirror.com/gh/joyanhui/adguardhome-rules@release_file/ADG_chinaDirect_WinUpdate_Gfw.txt&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>无污染的dns,udp/tcp无可用的，tls不稳定，目前只有cloudflare的多数时间和地区可用。强烈建议自建
&lt;ul>
&lt;li>&lt;code>你的doh域名部分&lt;/code> 可以修改为 &lt;code>dns.cloudflare.com&lt;/code> &lt;code>你的doh后缀部分&lt;/code> 修改为&lt;code>dns-query&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://github.com/joyanhui/adguardhome-rules/tree/release_file" target="_blank" rel="noopener"
>[joyanhui/adguardhome-rules/tree/release_file]&lt;/a> 分支中有多个每日自动更新的规则文件，选择其中一个适合你的&lt;/p>
&lt;p>你需要根据你的情况修改一下 里面两个地址 以及文件路径。如果不是openwrt还需要修改对应的重启adgurd的命令&lt;/p>
&lt;p>运行一次 &lt;code>sh /overlay/data/adguard_upstream_dns_file_update.sh&lt;/code>,然后自己检查获取到的adguard_upstream_dns_file.txt这个文件是否正常。&lt;/p>
&lt;p>如果你中间运行出错了，导致dns全部失效 可以执行下面命令恢复dns基本的运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;114.114.114.114
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">223.6.6.6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&lt;/span>&amp;gt;/overlay/data/adguard_upstream_dns_file.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="添加到计划任务">添加到计划任务
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">chmod +x /overlay/data/adguard_upstream_dns_file_update.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后在openwrt的web管理里面：系统&amp;gt;计划任务 增加一行 本机时间每天早上8点15运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="m">15&lt;/span> &lt;span class="m">8&lt;/span> * * * /overlay/data/adguard_upstream_dns_file_update.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置adguard-home-的上游dns为规则文件模式">配置adguard home 的上游dns为规则文件模式
&lt;/h4>&lt;p>找到你的adguardhome的yaml配置文件。上面按照的是在&lt;code>/etc/adguardhome.yaml&lt;/code>,如果你不确定可以搜索一下 &lt;code>find / -name &amp;quot;*uard*ome.yaml&amp;quot;&lt;/code>&lt;/p>
&lt;p>编辑这个文件 找到这行 &lt;code>upstream_dns_file&lt;/code> 修改为&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">upstream_dns_file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/overlay/data/adguard_upstream_dns_file.txt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在修改&lt;code>upstream_dns_file&lt;/code>并重启adguardhome后&lt;code>upstream_dns&lt;/code> 部分的配置会失效，adguardhome的网页端也可以看到&lt;/p>
&lt;p>在修改upstream_dns_file 之前可以先ping一个gfw的域名。例如 &lt;code>ping google.com&lt;/code>,修改完成后 重启adguardhome ，然后再ping一下看看能否获取正确的ip&lt;/p>
&lt;h3 id="进阶-adguardhome-搭建自己的doh">进阶 adguardhome 搭建自己的doh
&lt;/h3>&lt;p>本地的adguardhome也可以对外提供 doh。有两种方式 一种是自签证书&lt;a class="link" href="https://www.toolhelper.cn/SSL/SSLGenerate" target="_blank" rel="noopener"
>[在线生成]&lt;/a>或者购买一个长期证书。另外一种方式就是配合证书管理和反向代理工具，下面用 lucky来做简单说明。&lt;/p>
&lt;h4 id="adguardhome-启用doh">adguardhome 启用doh
&lt;/h4>&lt;p>在 adguardhome 的设置 加密设置里面 启用加密 HTTPS 端口 配置为一个可用的端口，例如 30443 不要打开https重定向，无意义&lt;/p>
&lt;p>DNS-over-TLS 端口 和 DNS-over-QUIC 端口 因为牵扯到证书续签的问题，这里就干脆设置为0,不使用了。&lt;/p>
&lt;p>然后 证书内容 粘贴一下随便一个目前可用的域名证书（暂时可用的就ok） 可以从lucky的ssl管理的 映射路径 里面 crt 和key文件里面获取到。&lt;/p>
&lt;p>然后保存修改&lt;/p>
&lt;h4 id="lucky接管-adguardhome的https">lucky接管 adguardhome的https
&lt;/h4>&lt;p>lucky web服务正常可用的情况下，添加一个子规则：&lt;/p>
&lt;ul>
&lt;li>前端地址 你的域名&lt;/li>
&lt;li>后端地址 adguardhome 的https地址 例如 https://192.168.1.1:30443&lt;/li>
&lt;li>忽略后端TLS证书验证 一定要勾选 这样我们就不用关心adguardhome的证书是否可用。&lt;/li>
&lt;/ul>
&lt;h4 id="doh-测试命令-大全">doh 测试命令 大全
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dnslookup x.com https://你的doh域名/你的doh后缀
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">doggo x.com A AAAA MX --time @https://你的doh域名/你的doh后缀
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">doggo x.com @https://你的doh域名/你的doh后缀
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">doggo x.com @https://cloudflare-dns.com/dns-query
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="adguard-广告过滤规则-收集">adguard 广告过滤规则 收集
&lt;/h2>&lt;p>adguard home广告过滤&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># easylist国际网页&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://easylist-downloads.adblockplus.org/easylist.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># easylist国内网页&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://easylist-downloads.adblockplus.org/easylistchina.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># easylist-cookis 阻止Cookie标语，GDPR覆盖窗口和其他与隐私相关的通知&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://easylist-downloads.adblockplus.org/easylist-cookie.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># anti-AD中文区命中率最高 的广告过滤列表 电视盒子 日志收集、大数据统计&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://gh.leiyanhui.com/https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-easylist.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="感谢">感谢
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="github.com/Loyalsoldier" >[Loyalsoldier]&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>旁路由-主路由自动替代旁路由的自动切换方案</title><link>https://dev.leiyanhui.com/openwrt/replacebypass/</link><pubDate>Tue, 19 Mar 2024 07:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/replacebypass/</guid><description>&lt;p>旁路由/网关在维护的时候导致断网或其他一些地方肯定不是够稳定，所以需要一个更加智能无感的自动切换方案。 传统dhcp切换网关的方式相应速度慢，掉线时间长。爱快分流方案虽然可以无感切换但是需要一个x86设备运行不开源有过黑历史的爱快。&lt;/p>
&lt;p>于是想到想到了一个新的方案，我姑且称之为 主路由自动切换ip接位网关方案&lt;/p>
&lt;h2 id="旧的旁路由自动方案">旧的旁路由自动方案
&lt;/h2>&lt;p>目前主要有两种&lt;/p>
&lt;ul>
&lt;li>传统的旁网关形式，内外设备单独配置一个网关设备。在这个网关设备失效的后，通过自动脚本配合dhcp等方式实现切换，需要下游设备断开重连，或重启主路由切换时间较长。这是效果最差的一种启动切换方案。&lt;/li>
&lt;li>主路由用爱快根据ip和域名通过运营商配置绑定wan2的分流方案，也就是 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass" target="_blank" rel="noopener"
>ikuai-bypass&lt;/a>，使用体验上要比上一种方式好非常多，不存在短时断网，堪称完美，但是需要x86做主路由并刷闭源的爱快。切换时间最少1分钟，但是切换期间不会导致断网。如果您用 &lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass" target="_blank" rel="noopener"
>ikuai-bypass&lt;/a> 方案，也期待能给我点一个star。&lt;/li>
&lt;/ul>
&lt;h2 id="思路">思路
&lt;/h2>&lt;h3 id="新方案使用主路由和旁路由-ip轮替的方式原理">新方案使用主路由和旁路由 ip轮替的方式，原理：
&lt;/h3>&lt;p>旁路由用桥接/别名或虚拟网卡的方式配置两个ip 第一个ip我们暂且称之为工作ip，第二个ip姑且叫辅助ip。&lt;/p>
&lt;p>主路由不断ping旁路由的第二个ip，如果ping不通，那么主路由把自己的ip修改为旁路有工作ip接替旁路由的工作。旁路路由正常再把自己改回去。这样就实现免重连切换。&lt;/p>
&lt;h3 id="新方案优点">新方案优点
&lt;/h3>&lt;p>原理简单维护也简单。切换速度快（3-10秒以内），不需要内网设备断网后重联，主路由不需要是x86设备，不需要闭源的爱快。&lt;/p>
&lt;p>各方面体验远高于dhcp切换方案，缺点是不如&lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass" target="_blank" rel="noopener"
>ikuai-bypass&lt;/a>的完全无缝切换，切换期间会有3-10秒断网。&lt;/p>
&lt;h2 id="切换和配置">切换和配置
&lt;/h2>&lt;p>我们为了便于理解和管理方式，干脆给两个设备规划4个ip，分别为：&lt;/p>
&lt;p>主路由 默认IP(10.1.1.1) 主路由辅助ip(10.1.1.11，用来登录主路由的web管理界面)&lt;/p>
&lt;p>旁路由 工作IP(10.1.1.2) 旁路路由辅助ip(10.1.1.22，用来检测是否旁路由在线)&lt;/p>
&lt;p>主路由负责dhcp服务，旁路由关闭dhcp。dhcp指定下游设备的网关均为旁路由工作IP(10.1.1.2)。&lt;/p>
&lt;p>下文以openwrt为例（文末有Padavan/梅林的兼容实现），内核为5.15.148 版本git-25.050.75038-257d60d 使用 &lt;code>openwrt.ai&lt;/code> 的在线编译固件 感谢 supes&lt;/p>
&lt;p>主路由为一个4口ramips硬路由 旁路有为vm内的x86路由 已经配置好低调上网插件以及dns分流 广告屏蔽等。&lt;/p>
&lt;h3 id="双ip的实现">双ip的实现
&lt;/h3>&lt;p>openwrt网络-接口面板，新建一个接口 和lan口一样 桥接 br-lan 然后静态ip配置为另外一个ip即可。参考/etc/config/network 中lan部分如下&lt;/p>
&lt;p>主路由 正常工作状态 （主路由是一个四口硬路由） 用桥接方式配置了两个ip&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">config device&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option name &amp;#39;br-lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;bridge&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">list ports &amp;#39;lan1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">list ports &amp;#39;lan2&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">list ports &amp;#39;lan3&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">list ports &amp;#39;lan4&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option promisc &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config interface &amp;#39;lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option device &amp;#39;br-lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proto &amp;#39;static&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipaddr &amp;#39;10.1.1.1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option netmask &amp;#39;255.255.255.0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip6assign &amp;#39;60&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dns &amp;#39;223.5.5.5 114.114.114.114&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config interface &amp;#39;lanManager&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proto &amp;#39;static&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option device &amp;#39;br-lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipaddr &amp;#39;10.1.1.11&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option netmask &amp;#39;255.255.255.0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>旁路由正常工作状态 旁路由是一个单口虚拟机的openwrt 用桥接方式配置了两个ip&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">config device&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option name &amp;#39;br-lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;bridge&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">list ports &amp;#39;eth0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option promisc &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config interface &amp;#39;lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option device &amp;#39;br-lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proto &amp;#39;static&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipaddr &amp;#39;10.1.1.2&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipaddr &amp;#39;10.1.1.1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option netmask &amp;#39;255.255.255.0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip6assign &amp;#39;60&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">list dns &amp;#39;223.5.5.5&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config interface &amp;#39;lanCheck&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proto &amp;#39;static&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option device &amp;#39;br-lan&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipaddr &amp;#39;10.1.1.22&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option netmask &amp;#39;255.255.255.0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>两个路由器的lan口的配置截图 请参考 我的恩山帖子 &lt;a class="link" href="https://www.right.com.cn/forum/thread-8355919-1-1.html" target="_blank" rel="noopener"
>https://www.right.com.cn/forum/thread-8355919-1-1.html&lt;/a>&lt;/p>
&lt;h3 id="openwrt-配置dhcp网关">openwrt 配置dhcp网关
&lt;/h3>&lt;p>主路由openwrt 配置dhcp服务分配给下游设备的网关为10.1.1.2 ssh登录到主路由后 运行下面两行命令 。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">uci add_list dhcp.lan.dhcp_option&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;3,10.1.1.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit dhcp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完成后重启dhcp 并重连下游设备，或干脆重启一下路由器。&lt;/p>
&lt;p>dhcp_option的含义以及指定的下游设备通过dhcp分组或按照mac给下游设备分别配置不同网关功能，本文不扩展&lt;/p>
&lt;h3 id="检查状态">检查状态
&lt;/h3>&lt;p>此时 下游设备dhcp分配的网关应该是10.1.1.2 在旁路由正常的情况下，下游被分配到10.1.1.2网关的设备应该都可以正常低调上网。&lt;/p>
&lt;p>此时和传统旁路方案完全一致。旁路由断开后，下游设备无法上网，需要通过dhcp重新分配网关ip，下游设备断开重连或手动修改下游设备网关 才可以恢复网络。说不上完美，只能说凑合而已。&lt;/p>
&lt;p>下面实现在旁路由下线后，主路由自动接替旁路由工作，并在旁路由上线后让位给旁路由。&lt;/p>
&lt;h2 id="自动切换程序">自动切换程序
&lt;/h2>&lt;h3 id="openwrt-主路由">openwrt 主路由
&lt;/h3>&lt;p>这个脚本运行在主路由上。 以openwrt为例。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mkdir /opt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vi /opt/ReplaceBypass.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/sh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_ip_available&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ping -c &lt;span class="m">3&lt;/span> &lt;span class="nv">$1&lt;/span> &lt;span class="p">|&lt;/span> grep packets &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $4}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;ping 10.1.1.22 ...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">res&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>check_ip_available 10.1.1.22&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">current_ip&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>uci get network.lan.ipaddr&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;current_ip &lt;/span>&lt;span class="nv">$current_ip&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="k">$((&lt;/span>&lt;span class="nv">$res&lt;/span>&lt;span class="k">))&lt;/span> -eq &lt;span class="m">0&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;bypass is offline&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$current_ip&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> !&lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;10.1.1.2&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;change to 10.1.1.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;s/10.1.1.1&amp;#39;/10.1.1.2&amp;#39;/&amp;#34;&lt;/span> /etc/config/network
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ifdown lan &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ifup lan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;bypass is online&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$current_ip&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> !&lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;10.1.1.1&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;change to 10.1.1.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s2">&amp;#34;s/10.1.1.2&amp;#39;/10.1.1.1&amp;#39;/&amp;#34;&lt;/span> /etc/config/network
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ifdown lan &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ifup lan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sleep &lt;span class="m">2&lt;/span> &lt;span class="c1">#时间可以修改为1-5秒 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这是一个循环shell脚本程序，间隔5秒用ping命令检测一次旁路由的辅助ip然后如果路由在线那么切换自己到10.1.1.1这个ip，否则切换到10.1.1.2替代路由工作。&lt;/p>
&lt;p>先手动执行&lt;code>sh /opt/ReplaceBypass.sh&lt;/code>，期间反复断开和联通旁路由观察 主路由ip切换情况。期间可以用 10.1.1.11 这个ip登录到主路由web管理界面检查。&lt;/p>
&lt;p>测试正常后，我们在主路由创建一个服务来运行这个脚本，并并让openwrt的开机自启这个服务。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">vi /etc/init.d/ReplaceBypass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">===========================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/bin/sh /etc/rc.common&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">START&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">99&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">start&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;ReplaceBypass service is staring&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sh /opt/ReplaceBypass.sh &amp;gt; /dev/null 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stop&lt;span class="o">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">PID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>ps &lt;span class="p">|&lt;/span> grep &lt;span class="s2">&amp;#34;sh /opt/ReplaceBypass.sh&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> grep -v grep &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $1}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">kill&lt;/span> &lt;span class="nv">$PID&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;ReplaceBypass service is stoped&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑完成后 启用这个服务&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">chmod +x /etc/init.d/ReplaceBypass &lt;span class="c1"># 必须执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service ReplaceBypass &lt;span class="nb">enable&lt;/span> &lt;span class="c1"># 开启自启&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service ReplaceBypass start &lt;span class="c1"># 手动执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ps &lt;span class="p">|&lt;/span>grep ReplaceBypass &lt;span class="c1"># 检查进程是否存在&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="padavan主路由">Padavan主路由
&lt;/h3>&lt;p>补充一个Padavan作为主路由的检测脚本，写完未测试 理论可行， 供参考。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/storage/change_ip.sh &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">MainDefaultIp=&amp;#39;10.1.1.1&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">BypassWorkIp=&amp;#39;10.1.1.2&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">BypassCheckIp=&amp;#39;10.1.1.22&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">check_ip_available(){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> ping -c 3 $1 | grep packets | awk &amp;#39;{print $4}&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">res=`check_ip_available $BypassCheckIp` #检测旁路由是否存在
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">current_ip=`nvram get lan_ipaddr` #主路由当前ip 更多命令 nvram show
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">change_ip(){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> nvram set lan_ipaddr=$1 #设置ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> nvram set lan_gateway=$1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> nvram commit #提交修改
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> sleep 3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> reboot # 需要重启设备 老毛子单独重启lan口貌似无效
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">if [ $(($res)) -eq 0 ]; #即旁路由不存在，主路由应该把自己修改旁路路由的工作ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">then
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if [ &amp;#34;$current_ip&amp;#34; != &amp;#34;$BypassWorkIp&amp;#34; ]; then #如果当前ip不是工作ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> echo &amp;#34;change ip to $BypassWorkIp &amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> `change_ip $BypassWorkIp`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> fi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exit 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">fi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">if [ $(($res)) -ne 0 ]; # 即旁路由存在，主路由应该把自己改为默认ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">then
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if [ &amp;#34;$current_ip&amp;#34; != &amp;#34;$MainDefaultIp&amp;#34; ]; then #如果当前ip不是默认ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> echo &amp;#34;change ip to $MainDefaultIp &amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> `change_ip $MainDefaultIp`
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> fi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exit 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">fi
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x /etc/storage/change_ip.sh &lt;span class="c1">#设置脚本运行权限&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/sbin/mtd_storage.sh save &lt;span class="c1">#保存脚本，防止重启丢失&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 自动定时运行脚本（每一分钟检测一次）：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在老毛子的 `系统管理 - 服务 ` 调度任务 (Crontab) 加入 `*/1 * * * * /etc/storage/change_ip.sh` &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果您在使用&lt;a class="link" href="https://github.com/joyanhui/ikuai-bypass" target="_blank" rel="noopener"
>ikuai-bypass&lt;/a> 方案，希望能给点个star&lt;/p></description></item><item><title>mosdns all in one 分流加自定义解析，不依赖 AdGuardHome</title><link>https://dev.leiyanhui.com/route/mosdns-all-in-one/</link><pubDate>Tue, 21 Nov 2023 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/mosdns-all-in-one/</guid><description>&lt;p>AdGuardHome 的主要优点是可视化，有去广告规则可用。 但是AdGuardHome自己的分流规则配置较为复杂，有第三方提供分流规则，但是实际测试因为无法使用adg的并发查询以及adg自身的性能局限所以效果并不好。所以一般都是和msdns配合使用，例如 mosdns代理两个adg分别负责国内和国外dns,或者adg作为前端后端使用modns。&lt;br>
但是如果你对可视化管理和dns统计没啥需求的话，完全没必要，单独mosdns即可完成。&lt;/p>
&lt;p>下文以pve lxc alpine为例 openwrt或其他linux发行版同样操作&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;p>直接下载 mosdns 下载unzip解压到 /opt/mosdns运行 ./mosdns service install 即可。&lt;/p>
&lt;h2 id="准备几个规则文件">准备几个规则文件
&lt;/h2>&lt;p>主要是 国内ip清单 国内名站域名清单 国外名站域名清单 一个空白的hosts.txt 如果你有自选cf ip需求还需要准备 cf ip自动列表&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /opt/mosdns/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/IceCodeNew/4Share/master/geoip_china/china_ip_list.txt -O geoip_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt -O geosite_category-ads-all.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt -O geosite_geolocation-!cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt -O geosite_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;localhost 127.0.0.1&amp;#34;&lt;/span>&amp;gt; /opt/mosdns/hosts.txt &lt;span class="c1">#注意格式和系统的hosts文件不一样&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://www.cloudflare.com/ips-v4 -O cf4.txt &lt;span class="c1">#cf ip地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://www.cloudflare.com/ips-v6 -O cf6.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat cf4.txt &amp;lt;&lt;span class="o">(&lt;/span>&lt;span class="nb">echo&lt;/span>&lt;span class="o">)&lt;/span> cf6.txt &amp;gt;geoip_cloudflare.txt &lt;span class="c1">#合并&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="可选的自建doh">可选的自建doh
&lt;/h2>&lt;p>目的是在深度学习环境不用的情况下依旧可以正确返回域名实际ip.
&lt;a class="link" href="https://dev.leiyanhui.com/route/safe-dns" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/safe-dns&lt;/a> 查看 cfwork自建doh&lt;/p>
&lt;h2 id="configyaml">config.yaml
&lt;/h2>&lt;p>基本逻辑，国内域名&lt;code>geosite_cn.txt&lt;/code>使用国内dns（dot）并发解析，国外域名&lt;code>geosite_geolocation-!cn.txt&lt;/code>使用 国外dns和自建doh解析&lt;br>
如果非清单内的域名，并且国内dns查询的一个域名返回的是一个非国内ip，那么使用国外 国外dns和自建doh解析 重新解析一次解决被污染问题 &lt;br>
因为去广告&lt;code>geosite_category-ads-all.txt&lt;/code> 会导致一些问题，并且我这里没这个需求，所以没有添加去广告规则。你可以自己添加上&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat &amp;gt; /opt/mosdns/config.yaml &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">log:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> level: error #日志级别。可选 &amp;#34;debug&amp;#34; &amp;#34;info&amp;#34; &amp;#34;warn&amp;#34; &amp;#34;error&amp;#34;。默认 &amp;#34;info&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> file: &amp;#34;/opt/mosdns/log.log&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># API 入口设置
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">api:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> http: &amp;#34;0.0.0.0:9091&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">include: []
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">plugins:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 自定义hosts 注意格式和系统hosts不同 支持泛域名domain和fulldomain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: mosdns_hosts
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: hosts
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/hosts.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"># 测试pipeline ./mosdns probe pipeline tls://101.226.4.6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 阿里和360的不支持
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 转发至本地服务器 国内解析
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: forward_local
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: forward
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> concurrent: 3 #mosdns限制最大3并发
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> upstreams: #因为最大3并发所以三个就够了自己选速度好的
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: &amp;#34;tls://223.5.5.5&amp;#34; #阿里
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: &amp;#34;tls://1.12.12.12&amp;#34; #腾讯 dnspod
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: &amp;#34;tls://101.226.4.6&amp;#34; #360电信
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 转发至远程服务器 境外解析上游
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: forward_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: forward
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> concurrent: 3 #最大3并发
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> upstreams:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: tls://8.8.8.8
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: tls://1.1.1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - addr: https://你的自建doh地址
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> bootstrap: 223.5.5.5 #bootstrap地址负责解析doh域名 只能udp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> bootstrap_version: 4 #解析的doh域名返回ipv4还是v6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_pipeline: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> enable_http3: false #http3 udp不稳 还是强制走http2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国内域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: geosite_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: domain_set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/geosite_cn.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国内 IP
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: geoip_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: ip_set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/geoip_cn.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国外域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: geosite_no_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: domain_set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> files:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - &amp;#34;/opt/mosdns/geosite_geolocation-!cn.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 缓存
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: lazy_cache
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: cache
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> size: 20000
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> lazy_cache_ttl: 86400
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> #dump_file: &amp;#34;/opt/mosdns/cache.dump&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> #dump_interval: 600
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国内解析
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: local_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $forward_local
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 国外解析
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: remote_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: prefer_ipv4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $forward_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 有响应终止返回
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: has_resp_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: has_resp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: accept
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # fallback 用本地服务器 sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 返回非国内 ip 则 drop_resp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_local_ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $local_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: &amp;#34;!resp_ip $geoip_cn&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: drop_resp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # fallback 用远程服务器 sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $remote_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # fallback 用远程服务器 sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: fallback
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: fallback
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> primary: query_is_local_ip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> secondary: query_is_remote
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> threshold: 500
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> always_standby: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 查询国内域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: qname $geosite_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: $local_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 查询国外域名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: query_is_no_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - matches: qname $geosite_no_cn
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: $remote_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 主要的运行逻辑插件
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # sequence 插件中调用的插件 tag 必须在 sequence 前定义，
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # 否则 sequence 找不到对应插件。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: main_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $mosdns_hosts
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: query_summary entry
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $lazy_cache
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $query_is_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: jump has_resp_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $query_is_no_local_domain
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: jump has_resp_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - exec: $fallback
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> #### 最后配置 server........略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: udp_server # 目前有 udp/tcp/http_server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> entry: main_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> listen: 0.0.0.0:53
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: server_tcp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: tcp_server
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> entry: main_sequence
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> listen: 0.0.0.0:53
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - tag: &amp;#34;server_http&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> type: &amp;#34;http_server&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> args:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> entries: # []extry
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> - path: /dns-query # 本路径执行
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> exec: main_sequence # 可执行插件的 tag。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> src_ip_header: &amp;#34;X-Forwarded-For&amp;#34; # 从 HTTP 头获取用户 IP。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> listen: 0.0.0.0:80 # 监听地址。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> cert: &amp;#34;&amp;#34; # 留空 cert 和 key 后会禁用 TLS。 这里没有配置证书，外网使用另外有acme和nginx处理https
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> key: &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> idle_timeout: 10 # 空连接超时。单位秒。默认 30。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/mosdns restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="部署">部署
&lt;/h2>&lt;h3 id="路由器和内网机器">路由器和内网机器
&lt;/h3>&lt;p>因为我这里是独立部署在 pve lxc里面，ip是 10.1.1.104。&lt;br>
在openwrt 或者 ikuai中配置上游dns为 10.1.1.104即可，内网内其他机器的dns可以用路由器ip作为dns或者mosdns的10.1.1.104均可&lt;/p>
&lt;h3 id="clash">clash
&lt;/h3>&lt;p>clash 删除其他dns NameServer FallBack Default-NameServer 全部设置为 10.1.1.104&lt;/p>
&lt;h3 id="外网部署">外网部署
&lt;/h3>&lt;p>因为家宽是没有53端口的，你可以从路由器用端口映射修改一下udp tcp的端口，或者外网直接用server_http 走doh&lt;/p>
&lt;h2 id="存在的问题">存在的问题
&lt;/h2>&lt;p>主要是自定义域名解析：&lt;br>
&lt;a class="link" href="https://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v5/ru-he-pei-zhi-mosdns/yu-ming-pi-pei-gui-ze" target="_blank" rel="noopener"
>https://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v5/ru-he-pei-zhi-mosdns/yu-ming-pi-pei-gui-ze&lt;/a>
mosdns 的hosts方法，支持domain 和 full keyword 和 正则。 可以解决多数自定义域名解析的问题。&lt;br>
但是修改hosts文件后 需要重启才能生效 这就搞的很烦。&lt;/p></description></item><item><title>利用cfwokr免费搭建自己的节点</title><link>https://dev.leiyanhui.com/cloudflare/vless/</link><pubDate>Thu, 09 Nov 2023 18:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/cloudflare/vless/</guid><description>&lt;h2 id="简介">简介
&lt;/h2>&lt;p>利用cfwork搭建 一个反向代理，相信很多人都会玩。同样我们可以在cfwork搭建一个vless节点。来实现自建一个稳定的准私有节点。&lt;br>
本文记录相关操作以及如何导入到现有的clash订阅和v2rayN中。&lt;/p>
&lt;h2 id="准备">准备
&lt;/h2>&lt;ul>
&lt;li>cloudflare账号&lt;/li>
&lt;li>在cloudflare中添加一个你自己的域名（非必需）&lt;/li>
&lt;/ul>
&lt;h2 id="创建">创建
&lt;/h2>&lt;h3 id="创建一个cfwork">创建一个cfwork
&lt;/h3>&lt;p>添加 一个，脚本用 &lt;a class="link" href="https://github.com/zizifn/edgetunnel/blob/main/src/worker-vless.js" target="_blank" rel="noopener"
>https://github.com/zizifn/edgetunnel/blob/main/src/worker-vless.js&lt;/a> 这位大佬的&lt;br>
也有一些别人复制的 &lt;a class="link" href="https://github.com/Misaka-blog/cf-wkrs-pages-vless/blob/main/_worker.js" target="_blank" rel="noopener"
>https://github.com/Misaka-blog/cf-wkrs-pages-vless/blob/main/_worker.js&lt;/a>&lt;br>
推荐使用Misaka的，他在原版基础上加了站点伪装和初始的proxyIP
需要修改两个地方 userID 和 proxyIP 。&lt;br>
userID可以理解为 为了隐藏我们的节点，也防止被人白嫖。 可以随便填写，也可以用在线工具生成 &lt;a class="link" href="https://www.uuidgenerator.net" target="_blank" rel="noopener"
>https://www.uuidgenerator.net&lt;/a>
proxyIP 这个是访问某一些本身部署在 cf cdn上的网站要用的，可以自己去筛选，也可以用别人已经筛选好的。 这里直接选别人的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> cdn-all.xn--b6gac.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cdn.xn--b6gac.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cdn-b100.xn--b6gac.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> edgetunnel.anycast.eu.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cdn.anycast.eu.org
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="获取节点地址">获取节点地址
&lt;/h3>&lt;p>打开 https://cf分给你的域名.workers.dev/xxxx-d424-4583-b36e-524ab1f0afa4 后面是你的userid&lt;/p>
&lt;h3 id="替换域名">替换域名
&lt;/h3>&lt;p>workers.dev 默认是被墙的状态，需要替换成你的自己的域名，在触发器的地方添加自定义域，然后输入一个你托管在cf的域名即可。&lt;br>
然后打开 https://你自己的域名v/xxxx-d424-4583-b36e-524ab1f0afa4&lt;br>
注意 域名会被墙识别到，所以你最好用一个看起来正常的域名 ，当然也可以伪装。&lt;/p>
&lt;h3 id="客户端优选ip">客户端优选ip
&lt;/h3>&lt;h4 id="在线方式">在线方式
&lt;/h4>&lt;blockquote>
&lt;p>这个方式凑合能用&lt;/p>&lt;/blockquote>
&lt;p>&lt;a class="link" href="https://vfarid.github.io/cf-ip-scanner/?max=30" target="_blank" rel="noopener"
>https://vfarid.github.io/cf-ip-scanner/?max=30&lt;/a>&lt;/p>
&lt;h4 id="本地测试方式">本地测试方式
&lt;/h4>&lt;blockquote>
&lt;p>略微复杂一些，本地运行工具逐个测试。&lt;/p>&lt;/blockquote>
&lt;p>网上很多相关教程不再赘述，推荐 &lt;a class="link" href="https://github.com/XIU2/CloudflareSpeedTest" target="_blank" rel="noopener"
>https://github.com/XIU2/CloudflareSpeedTest&lt;/a>&lt;/p>
&lt;h4 id="白嫖方式">白嫖方式
&lt;/h4>&lt;p>这个方式 ，就通过你用在线或者本地优选的方式 获取到的感觉速度尚可ip 去ip反查网站，看有没有别的大佬做好的域名。然后逐个去在线ping网站ping他域名。&lt;br>
&lt;a class="link" href="https://ipchaxun.com/" target="_blank" rel="noopener"
>https://ipchaxun.com/&lt;/a> 这里，下面选择一个低成本后缀的域名，或者域名里面在cf或者ip,或yx之类的意思的，大概率就是别人配置好的。&lt;br>
这里提供几个热门ip 140.238.12.33 140.238.12.33 47.245.37.41 &lt;br>
然后去 itdog chinaz之类的网站在线ping确认一下。&lt;br>
这里直接贴几个查到的域名
443.cf.bestl.de 80.cf.bestl.de cdn.chigua.tk
yx.piaosir.link cf.yumy.gay yx.pztvdiao.link yx.s2.gay
yx.skyvps.link ip.zijingshan.link cdn-ip.tgbird.top yxip.tgood.eu.org cf.gzgrd.com&lt;/p>
&lt;p>同样的道理，你也可以用这种方式来搞定msdos对cf的优选ip的重写。&lt;/p>
&lt;h4 id="最后的地址处理">最后的地址处理
&lt;/h4>&lt;p>无论那方式，你获取到的ip 最终都要替换到上面你的cfwork提示的vless地址的里面
vless://XXXXX-d424-4583-b36e-524ab1f0afa4@这里选择优选ip优选域名:443?encryption=none&amp;amp;security=tls&amp;amp;sni=XXXX&amp;amp;fp=randomized&amp;amp;type=ws&amp;amp;host=XXXX&amp;amp;path=%2F%3Fed%3D2048#XXXX&lt;/p>
&lt;h3 id="附加到现有clash订阅">附加到现有clash订阅
&lt;/h3>&lt;p>一般我们使用第三方转换的网站 添加上，然后再用转换网站提供的地址即可。 否则只能添加到本地的yaml文件里面&lt;/p></description></item><item><title>clash删库事件发生后的替代方案</title><link>https://dev.leiyanhui.com/route/clash-new/</link><pubDate>Wed, 08 Nov 2023 20:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/clash-new/</guid><description>&lt;p>因为 clash for windows 作者自我开盒（不小心泄露车牌号码）随后删库导致的连锁反应，clash和clash meta 等相继把仓库设置为归档并暂时停止更新。
其实clash for windows 只是clash一个在windows的ui配置工具 ui部分基于Electron,后端还是 clash和clash meta。但是因为他比较直观并且很美观，所以使用者众多。&lt;/p>
&lt;p>目前暂时看 clash和clash meta ，应该不会一直停止更新。所以可以继续使用。&lt;/p>
&lt;p>重点：clash 和clash-mete clash-tun 依旧可以正常使用！！！&lt;/p>
&lt;p>clash meta的优点 有很多，主要分流规则完善且灵活，并且支持的协议多，基本上覆盖所有协议。但其实有两个问题。
1、在低配硬件上跑不满带宽，甚至只有带宽的10-20%&lt;br>
2、配置较为繁琐，对新手不友好，甚至不少大神也对clash的配置很懵&lt;/p>
&lt;p>主流的替代软件客户端内核 比如 v2ray xray sing-box Hysteria,只是其他软件的分流和协议支持度或者易用性都没有clash好。&lt;br>
这些可以不操心，其他非基于clash的客户端有：&lt;/p>
&lt;p>V2rayN (Win端)https://github.com/2dust/v2rayN/wiki/List-of-supported-cores&lt;br>
v2rayA( linux + win + macos)&lt;br>
v2flyNG(android) V2rayNG (android) &lt;br>
Nekoray (win+linux) &lt;a class="link" href="https://github.com/MatsuriDayo/nekoray" target="_blank" rel="noopener"
>https://github.com/MatsuriDayo/nekoray&lt;/a>&lt;br>
Nekobox (android)&lt;br>
Surge (收费 macos ios) sing-box（全平台）
IOS端：sing-box Shadowrocket QuantumultX Surge等&lt;/p>
&lt;p>上面支持linux的在openwrt上都可以用，但是另外有一些带luci界面： PassWall Bypass SSR-Plus PassWall2 VSSR (Hello World)，&lt;/p>
&lt;p>最后： 较为看好sing-box,已经有部分机场开始支持（也有一些clash转换sing-box的转换工具）ios客户端是免费的。&lt;/p></description></item><item><title>关于dns泄露的那些事情 路由器 mosdns分流 clash</title><link>https://dev.leiyanhui.com/route/safe-dns/</link><pubDate>Sat, 28 Oct 2023 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/route/safe-dns/</guid><description>&lt;h2 id="dns-为什么会被泄露">dns 为什么会被泄露
&lt;/h2>&lt;p>因为默认情况下家庭网络的dns都是走 明文 udp的53端口。但是即便是配置了走doh/dot也会泄露。&lt;/p>
&lt;h2 id="dns-泄露后有什么不好的">dns 泄露后有什么不好的
&lt;/h2>&lt;p>如果 你对运营商或者国内dns 发起了一个 查询某一个域名dns的请求，随后你又加密连接到了一个境外ip并传输了大流量数据。
你在干什么 就非常显而易见了。 在这个红色恐怖充斥的2023年，这是一个非常作死的事情。&lt;/p>
&lt;h2 id="什么是dns污染-阻断和劫持">什么是dns污染 阻断和劫持
&lt;/h2>&lt;p>简单的说，就是 你请求了某一个公共dns,但返回的数据是错误的，或者半路被篡改掉了。&lt;br>
返回错误数据 是因为国内政策要求，所以公共dns服务器对某一些域名进行了阻断，一般会返回一个本地局域网i或者随意一个国外ip。所以需要使用国外公共dns来处理一些域名的解析。
数据被篡改，只有你在明文进行dns请求的时候，返回数据被运营商或者某部门或者恶意第四方篡改掉，这种情况仅限明文dns请求的情况下。所以有了doh和dot的加密dns请求。&lt;/p>
&lt;h2 id="什么是doh和dot">什么是doh和dot
&lt;/h2>&lt;p>dns over tls 和 dns over https 就是用用tcp tls 或者 https 加密你的 dns请求。&lt;br>
一般浏览器和操作系统 都支持。&lt;/p>
&lt;h2 id="doh和dot可以避免污染-阻断-劫持和-泄露吗">doh和dot可以避免污染 阻断 劫持和 泄露吗
&lt;/h2>&lt;p>并不能完全避免。
doh和dot是可以避免dns解析记录被中间人篡改和窥探的，但是使用国内公共dns无法解决政策原因导致的污染。&lt;br>
如果你 doh/dot到 国内的 doh/dot的dns服务，那么只是你上游网络（宽带运营商）无法得知你的dns请求了而已。但是对应的国内dns服务商依旧可以得知。&lt;/p>
&lt;p>你直接使用国外加密dns,理论去是可以的避免所有问题，但是国外加密dns有三个问题：&lt;/p>
&lt;ul>
&lt;li>国内直接访问速度太慢 严重影响使用&lt;/li>
&lt;li>国外加密dns都已经被干扰并且不定期阻断和重定向 无法正常稳定使用&lt;/li>
&lt;li>有一些国内网站基于dns做了分地区或者一些优化，例如你访问某一个网站用的国外的dns可能会被重定向到对方的国际站点。&lt;/li>
&lt;/ul>
&lt;h2 id="怎么完美解决">怎么完美解决
&lt;/h2>&lt;p>三句话：&lt;/p>
&lt;ul>
&lt;li>使用clash代理国外主流doh/dot的dns服务，一般情况下所有的第三方clash转换规则包括机场自带的规则 以及常见的路由器分流配置 都可以识别到这部分流量 都会帮你代理出去。&lt;/li>
&lt;li>国内域名到 国内的doh/dot的dns服务商，gfw清单中的域名到国外主流doh/dot的dns服务商&lt;/li>
&lt;li>如果非gfw清单中域名，但是返回了国外ip,那么到国外主流doh/dot上再次查询一次 &lt;br>
这样就完美规避了上述所有问题。&lt;/li>
&lt;/ul>
&lt;h2 id="怎么实现">怎么实现
&lt;/h2>&lt;p>mosdns分流搞定一切。如果有特殊需求，加辅助dns的上游,例如AdGuardHome和自建doh。&lt;/p>
&lt;h2 id="怎么优雅实现">怎么优雅实现
&lt;/h2>&lt;h3 id="原理">原理
&lt;/h3>&lt;p>使用mosdns，mosdns 判断是gfw域名直接请求 google和cf或者你的自建doh。否则请求国内doh/dot 如果请求了国内dns但是返回了一个国外ip,那么再次请求 google和cf或者你的自建doh 确认修正一次。
国内doh/dot 我们也可以作为AdGuardHome的上游，顺带去广告或者处理一下别的情况。&lt;/p>
&lt;h3 id="最佳方案新手推荐">最佳方案（新手推荐）
&lt;/h3>&lt;p>mosdns 作为网内的主dns,或者路由器的上游主dns。
两个 AdGuardHome 分别处理 境外网站和国内网站，这两个AdGuardHome作为mosdns的上游dns.
这样的好处是 AdGuardHome有较为直观的webui管理界面，并顺带处理广告问题。
另外一个猴版方案 是 AdGuardHome作为主dns, mosdns作为 AdGuardHome 的上游，一样可以实现。这样省一个AdGuardHome，但是有特殊要求的情况下不适用。&lt;/p>
&lt;h3 id="单mosdns方案老手推荐">单mosdns方案（老手推荐）
&lt;/h3>&lt;p>也是我目前使用的方案，优点是更加灵活性能也比较好。 &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/route/mosdns-all-in-one" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/mosdns-all-in-one&lt;/a>&lt;/p>
&lt;h3 id="为什么不直接用clash自带的dns劫持">为什么不直接用clash自带的dns劫持
&lt;/h3>&lt;p>主要是自带的clash dns规则较为复杂，一不消息就会泄露dns。&lt;/p>
&lt;h3 id="这么复杂不会拖累速度吗">这么复杂不会拖累速度吗
&lt;/h3>&lt;p>不会，因为mosdns速度非常快，而且自己有良好的缓存机制。 我们使用运营商的dns他也会逐级请求上层dns,只是不需要我们配置而已。&lt;/p>
&lt;h3 id="准备">准备：
&lt;/h3>&lt;p>1、mosdns和对应的geoip.dat，geosite.dat &lt;br>
2、（可选）cfwork自建一个doh &lt;br>
3、（可选）AdGuardHome顺带去广告&lt;/p>
&lt;h3 id="mosdns">mosdns
&lt;/h3>&lt;p>建议docker安装 推荐 &lt;a class="link" href="https://hub.docker.com/r/601096721/mosdns" target="_blank" rel="noopener"
>https://hub.docker.com/r/601096721/mosdns&lt;/a>&lt;/p>
&lt;h3 id="cfwork自建doh">cfwork自建doh
&lt;/h3>&lt;p>因为cf和google包括其他知名国外的dns,无论是否doh/dot都被干扰了，非常不稳定甚至某些时候无法使用。 而有时候我们需要直连查询。 &lt;br>
推荐index.js &lt;a class="link" href="https://github.com/tina-hello/doh-cf-workers" target="_blank" rel="noopener"
>https://github.com/tina-hello/doh-cf-workers&lt;/a> &lt;br>
记得绑定一个自己的域名，因为cfwork默认分配的域名本身是被墙的状态，那么你自己搭建的反向代理也就无意义了。 &lt;br>
cfwork每个账户每天有免费10万次查询额度，自己用足够了。上面的代码中没有包含路由功能，你可以自己配置一下，防止被盗用。&lt;br>
这个方式自建doh 速度肯定是不好的，因为我们一般会在clash或者软路由的分流规则直连这个地址，本身速度就不快，而且我们的自建doh实际是反向代理了一次cf的doh,所以速度方面就不用想会多快了。这只是在我们无法使用代理，并且需要正确dns的时候最后的手段。&lt;/p>
&lt;blockquote>
&lt;p>因为cfwork只支持http/https请求，所以不能搭建dot只能doh,理论上doh因为基于http协议需要携带http头部信息，数据包大一些，速度会慢一点，实际上两者使用体验上并无差别
上面的脚本可以适当的修改后缀，或者在cf面板中添加规则防止被别人白嫖。js语法很简单，自己看注释修改一下即可。&lt;/p>&lt;/blockquote>
&lt;h3 id="adguardhome">AdGuardHome
&lt;/h3>&lt;p>为什么要AdGuardHome ？ 除了去广告之外 AdGuardHome的并发dns查询可以加快访问速度。另外ddns的域名，我们可以直接指向内网ip,这样在我们ip变化后但是ddns因为受到ttl的限制不能马上刷新的情况下不会影响内网使用。 &lt;br>
AdGuardHome的配置较为简单 就不用多说了。dns里面加一堆国内的dot运营商即可,参考下面的上游 DNS 服务器 分别配置的阿里云 360和腾讯dnspod的dot&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">tls://223.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://223.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://101.226.4.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://123.125.81.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://1.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tls://120.53.53.53
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建议全部直接用ip走dot或doh 而不是用域名 ,这样可以避免Bootstrap dns配置错误导致的问题。
你可以先用https://ip地址 访问对应的dns如果没有提示证书错误 那么他就是支持ip直连doh，那也可以ip走dot。也可以查询对应dns服务器的文档。&lt;/p>
&lt;h2 id="在爱快和ros-openwrt下如何配置">在爱快和ros openwrt下如何配置
&lt;/h2>&lt;p>建议 mosdns和AdGuardHome都不要劫持本地的dns.而在 路由器设置吧mosdns的内网ip或者dockerip作为路由的首选dns。&lt;br>
爱快3.7.7 体验版本已经支持 dns的第三方代理模式 配置主dns（mosdns）和三个备用dns（国内公共dns），虽然目前测试存在问题，但是后续版本应该会修复。&lt;/p>
&lt;h2 id="openclash里面怎么配置">openclash里面怎么配置
&lt;/h2>&lt;p>直接吧clash的dns 所有dns全部替换为mosdns&lt;/p>
&lt;h2 id="mosdns配置文件">mosdns配置文件
&lt;/h2>&lt;p>mosdns 相当于是我们的核心dns了。我目前的配置如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># 日志&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">log&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">level&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#日志级别。可选 &amp;#34;debug&amp;#34; &amp;#34;info&amp;#34; &amp;#34;warn&amp;#34; &amp;#34;error&amp;#34;。默认 &amp;#34;info&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">production&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># api:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># http: 127.0.0.1:8888&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># include: []&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">plugins&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># forward 可以将所有的 upstream 写一起，sequence 里按需调用 &amp;#34;$插件tag 上游tag...&amp;#34;。看下一条注释。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">size&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1024&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">lazy_cache_ttl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 自定义Hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">files&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;./hosts&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">upstreams&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">forward&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">upstreams&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">adguardhome&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp://10.10.1.3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#上游是境内dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">adguardhome2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#上游是境外dns&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp://10.10.1.5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 后面的作为备用暂时不使用,这里直接使用两个adg作为上游&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cf_worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://xxxxx &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#自己在cfwork搭建的doh&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudflare_tls&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://1.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">google_tls&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://8.8.8.8&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">50&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dnspod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://1.12.12.12&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">aliyun&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tls://dns.alidns.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">bootstrap&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">223.5.5.5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enable_pipeline&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">30&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">insecure_skip_verify&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># cn域名的规则&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">geosite_cn_seq&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$upstreams adguardhome&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 替换 cloudflare 的 IP 成自己的最优 IP 的规则&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 没找到txt，不用这条&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - tag: fastest_cf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># type: sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># args:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - matches: resp_ip &amp;amp;./geoip_cloudflare.txt # 是不是 cloudflare 的 IP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># exec: black_hole 1.1.1.1 ::1 # 用 black_hole 强制换成这些 IP 的应答。注意，这里的 IP 只是示例不是 cloudflare 的。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 远程域名的规则&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">remote_seq&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">prefer_ipv4 &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 希望 remote 优先 ipv4.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- exec: $upstreams adguardhome2 cf_worker cloudflare_tls google_tls&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$upstreams adguardhome2 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - exec: jump fastest_cf # jump 相对于把 fastest_cf 的规则链插到此处。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 这个 sequence 转发请求到本地，返回只包含 cn IP 的应答。(过滤掉非 cn 的应答)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local_must_has_cn&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- exec: $upstreams adguardhome dnspod aliyun&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$upstreams adguardhome&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;!resp_ip &amp;amp;./geoip_cn.txt&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">drop_resp &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 如果应答里没有 cn IP，丢掉。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 利用 fallback 机制按 IP 分流。如果 local 服务器返回了 cn 的应答就接受，非 cn 的应答会被丢弃，使用 remote 服务器的应答。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fallback_ip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">fallback&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">primary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local_must_has_cn &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 空应答(本地服务器返回了非cn IP然后应答被丢弃了)触发 fallback。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">secondary&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">remote_seq &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># fallback 后就会使用 remote 的应答。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">always_standby&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">##############################&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 配置主 sequence 规则，作为服务器的入口。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$hosts&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">query_summary entry&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#- matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - qname &amp;amp;./geosite_category-ads-all.txt #自带的广告过滤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># exec: reject 0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- {&lt;span class="nt">matches: has_resp, exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">accept} &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># cache/hosts 等插件不再“命中记录自动跳过后续插件”，需用户自行判断是否有应答。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 方便需要 ipset/nftables 用户定制流程。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># yaml 支持这种简写。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">qname &amp;amp;./geosite_cn.txt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># cn 域名&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">goto geosite_cn_seq &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># goto 到 local 规则，不在执行后续规则。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">qname &amp;amp;./geosite_geolocation-!cn.txt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 非 cn 域名&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">goto remote_seq &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># goto 到 remote 规则。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$fallback_ip &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 剩余域名用 ip 分流。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#### 动态路由 + cache。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 新版的cache只会将命中的应答放在请求，不再自动终止后续规则。所以需要动态路由时，可以将&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># sequence 的转发操作用 !has_resp 短路。做到每次请求都能刷新路由表。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - tag: s1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># type: sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># args:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - exec: $cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - &amp;#34;!has_resp&amp;#34; # 上一步cache命中缓存有应答了就不转发了。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># exec: $forward_remote&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - exec: ipset ...... # ipset 每次请求都能执行。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#####&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">####### mark 使用示例&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># mark 在 exec 内是打标。在 matches 内是匹配。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># mark 当作开关的示例。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - tag: s1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># type: sequence&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># args:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - exec: mark 1 2 # 先打标。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - mark 1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># exec: $cache # 有 mark 1 缓存会生效&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># - mark 2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># exec: ecs 1.2.3.4 # 有 mark 2 请求会被附加 ecs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># ...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - matches:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># - mark 3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># exec: jump fastest_cf # 没 mark 3 不会替换 cloudflare ip。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#### 最后配置 server........略&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">udp_server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 目前有 udp/tcp/http_server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">53&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">server_tcp&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tcp_server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entry&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">53&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;server_http&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;http_server&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">entries&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># []extry&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dns-query &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 本路径执行 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">exec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">main&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 可执行插件的 tag。 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src_ip_header&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;X-Forwarded-For&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 从 HTTP 头获取用户 IP。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listen&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 监听地址。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cert&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 留空 cert 和 key 后会禁用 TLS。 这里没有配置证书，外网使用我这里另外有acme和nginx处理https&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">idle_timeout&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># 空连接超时。单位秒。默认 30。&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">#######&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="手动更新mosdns的分流数据">手动更新mosdns的分流数据
&lt;/h2>&lt;p>601096721/mosdns的docker镜像没有添加计划任务，只有在更新镜像的时候 才会更新。
可以在容器内部执行下面的命令更新数据库文件，也可以在容器内部安装crond 定时更新。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/IceCodeNew/4Share/master/geoip_china/china_ip_list.txt -O /geoip_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt -O /geosite_category-ads-all.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt -O /geosite_geolocation-!cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt -O /geosite_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geoip_cn.txt /etc/mosdns/geoip_cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geosite_category-ads-all.txt /etc/mosdns/geosite_category-ads-all.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geosite_geolocation-!cn.txt /etc/mosdns/geosite_geolocation-!cn.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp -u /geosite_cn.txt /etc/mosdns/geosite_cn.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="补充">补充
&lt;/h2>&lt;p>adguardhome 本身可以利用规则的方式实现分流协议。有第三方作者的规则，实际测试效果不好，主要是速度不理想。&lt;br>
adguardhome 搭建自己的私有doh需要强制证书，略微不方便。而mosdns 性能更好，且可以不使用证书搭建 dns over http（非https），而后用nginx+acme.sh统一反代到https。
但是mosdns没有简单方便的webui管理工具，去广告功能也没有adguardhome那么方便。所以如果不是内存特别紧张的情况下，mosdns+adguardhome依旧是新手的最佳方案。&lt;br>
adguardhome 本身大概需要 40-80M内存，我在使用mosdns+双adguardhome的时候，大概需要消耗150-180M内存。&lt;br>
如果对可视化管理没有需求，建议用单mosdns方案 &lt;a class="link" href="https://dev.leiyanhui.com/route/mosdns-all-in-one" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/mosdns-all-in-one&lt;/a>&lt;/p></description></item><item><title>双网卡 pve8.0.3 lxc 运行 openwrt作为主路由 最靠谱简单教程</title><link>https://dev.leiyanhui.com/openwrt/lxc-mian-op/</link><pubDate>Sat, 16 Sep 2023 00:01:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/lxc-mian-op/</guid><description>&lt;p>在pve上运行openwrt作为主路由使用。无论单个网卡或者多个网卡其实操作都操作。&lt;br>
lxc运行的openwrt 对虚拟机方式运行的性能更好，资源占用更低。&lt;/p>
&lt;p>我目前是有两台pve 均为单网卡。
一台 x240主板 15-20w i3-4030U 8G 128G+1T。
上面lxc 运行 openwrt做主路由，同时在lxc里面运行了几个开源软件做核心数据的nas. 另外虚拟机运行了一个win 和一个备用mac（x240内存8G跑太多不够玩）&lt;br>
一台 qnct组装机 20-60w 6核32G nvme 500G+12T
pve装了桌面系统做日用机。并且挂了4块硬盘 也开了nas,虚拟运行win直通显卡打游戏 macos直通核显偶尔签app用。&lt;/p>
&lt;h2 id="场景">场景
&lt;/h2>&lt;h3 id="pve单网卡">pve单网卡
&lt;/h3>&lt;p>pve 单个网卡 接入交换机
光猫 桥接 接入交换机
其他设备 包括ap等同样接入交换机。
光猫通常插到交换机的第一个口上，不过家用交换机一般都是傻瓜式的，随便插都可以。
这是最常用的方案,top图大概如下 ，就是所有设备都接到交换机就ok&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 光猫 这里光猫是桥接
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 其他设备
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 其他设备
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; 其他设备
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">交换机 &amp;lt;====&amp;gt; pve物理网卡===&amp;gt; pve vmbr0 ===&amp;gt; lxc和kvm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>vmbr0 你可以视作一个虚拟万兆交换机就好理解了。pve默认用你在/etc/network/interfaces配置的ip,lxc和kvm内用你指定或者网内任意一个
使用虚拟机的情况下 pve内 就是 vmbr0 映射一个虚拟网卡到 到虚拟机。然后虚拟内部配置静态ip的和pve以及交换机上的其他设备在同一个网段就可以完成互相访问了。
那么到lxc的话也是一样。但是到openwrt的因为需要一个lan一个wan,所以我们这里直接映射两个虚拟网卡给openwrt就好了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vmbr0 ===&amp;gt; net0 === lxc openwrt eth0做lan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vmbr0 ===&amp;gt; net1 === lxc openwrt eth1做wan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>反应到lxc的配置文件里面就是&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">net0: name=eth0,bridge=vmbr0,hwaddr=随便填写个MAC地址,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net1: name=eth1,bridge=vmbr0,hwaddr=随便再来个MAC地址,type=veth
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然你也可以去openewrt内部做网桥来弄，但是完全没有必要。&lt;/p>
&lt;h3 id="pve多网卡">pve多网卡
&lt;/h3>&lt;p>pve 多个网卡，直接直通网卡给openwrt即可。
下面的例子是pve双网卡 板载接入交换机 usb网卡接入光猫。
pve 为单板载网卡enp0s25，但是有一个usb3千兆网卡enx0023545ca007。为例，多网卡一样操作。&lt;br>
在pve中 左侧 点数据中心下的pve ，然后点 中间的 系统下面的网络 ，查看这两个网口的名称。&lt;br>
板载网卡做为pve管理口 插入交换机 局域网其他设备也插入普通交换机。
usb网卡作为链接外网的网卡 插入光猫。 记住这usb3网口的名字即可。下文统一以 enx0023545ca007 代替。&lt;/p>
&lt;h2 id="步骤">步骤
&lt;/h2>&lt;h3 id="获取-openwrt-rootfs包">获取 openwrt rootfs包
&lt;/h3>&lt;p>可以从IMG.GZ/SQUASHFS.IMG.GZ 提取，或者直接下载 ROOTFS.TAR.GZ 包。
从IMG.GZ/SQUASHFS.IMG.GZ 提取 提取的思路：解压gz 挂载img/SQUASHFS ，打包挂载后的文件到 ROOTFS.TAR.GZ
建议直接用 ROOTFS.TAR.GZ 即可。
我这里用 &lt;a class="link" href="https://openwrt.ai/" target="_blank" rel="noopener"
>https://openwrt.ai/&lt;/a> supe提供的 ROOTFS.TAR.GZ&lt;/p>
&lt;h3 id="rootfs包上传到-pve">rootfs包上传到 pve
&lt;/h3>&lt;p>pve 后台找到 CT模板 点上传。我这里是手动下载到pve的 &lt;code> /var/lib/vz/template/cache/&lt;/code> 都是一样的&lt;/p>
&lt;h3 id="创建一个ctlxc">创建一个CT/lxc
&lt;/h3>&lt;p>pve目前依旧无法直接创建op的lxc，这里还是用命令行。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">pct create &lt;span class="m">100&lt;/span> local:vztmpl/openwrt-09.26.2023-x86-64-generic-rootfs.tar.gz --rootfs local:1 --ostype unmanaged --hostname OP --arch amd64 --cores &lt;span class="m">2&lt;/span> --memory &lt;span class="m">1024&lt;/span> --swap &lt;span class="m">0&lt;/span> -net0 &lt;span class="nv">bridge&lt;/span>&lt;span class="o">=&lt;/span>vmbr0,name&lt;span class="o">=&lt;/span>eth0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="解释">解释
&lt;/h4>&lt;ul>
&lt;li>pct create 100 是pve里面CT或者VM的id值，你可以修改成你的&lt;/li>
&lt;li>local:vztmpl/openwrt-09.26.2023-x86-64-generic-rootfs.tar.gz 是上面你上传到rootfs的包名&lt;/li>
&lt;li>rootfs local:1 是本lxc储存位置和硬盘占用大小限制1G 如果用其他地方储存 rootfs local-lvm:1 rootfs local-brtfs:0.5&lt;/li>
&lt;li>ostype unmanaged 操作系统类型&lt;/li>
&lt;li>hostname OP 节点名称&lt;/li>
&lt;li>arch amd64 cpu平台&lt;/li>
&lt;li>cores 2 可占用的cpu核心数&lt;/li>
&lt;li>memory 1024 swap 0 内存和交换内存，建议关闭交换内存 也就是0&lt;/li>
&lt;li>net0 bridge=vmbr0,name=eth0 把pve的管理网桥给op用，也就是op把他作为 lan&lt;/li>
&lt;/ul>
&lt;h3 id="手动修改配置">手动修改配置
&lt;/h3>&lt;h4 id="2-n网卡直通一个进去">2-N网卡直通一个进去
&lt;/h4>&lt;p>cat /etc/pve/nodes/pve/lxc/100.conf 添加下面几行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc.include: /usr/share/lxc/config/openwrt.common.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.type: phys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.link: enx0023545ca007
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.flags: up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.name: eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup2.devices.allow: c 108:0 rwm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="完整配置">完整配置
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cores: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostname: OP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">memory: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net0: name=eth0,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A4,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">onboot: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ostype: unmanaged
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootfs: local:100/vm-100-disk-1.raw,size=1G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">startup: up=2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">swap: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.include: /usr/share/lxc/config/openwrt.common.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.type: phys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.link: enx0023545ca007
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.flags: up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.net.1.name: eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup2.devices.allow: c 108:0 rwm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/net dev/net none bind,create=dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="解释-1">解释
&lt;/h5>&lt;ul>
&lt;li>lxc.include 包含pve自带的op配置模板&lt;/li>
&lt;li>lxc.net.1 直通网卡enx0023545ca007进去作为 eth1&lt;/li>
&lt;li>lxc.cgroup2 的配置，这是lxc运行一些服务类的系统必须的&lt;/li>
&lt;li>lxc.mount.entry 挂载ppoe和tun到lxc内&lt;/li>
&lt;li>lxc.cap.drop: 取消 openwrt.common.conf 里面 对 cap的限制，不然openclash无法使用&lt;/li>
&lt;/ul>
&lt;h4 id="单网卡">单网卡
&lt;/h4>&lt;h5 id="完整配置-1">完整配置
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cores: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostname: OP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">memory: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net0: name=eth0,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A4,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net1: name=eth1,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A3,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">onboot: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ostype: unmanaged
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootfs: local:100/vm-100-disk-1.raw,size=1G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">startup: up=2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">swap: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.include: /usr/share/lxc/config/openwrt.common.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup2.devices.allow: c 108:0 rwm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.entry: /dev/net dev/net none bind,create=dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="解释-2">解释
&lt;/h5>&lt;p>两个虚拟网卡直接映射进去就可以了e .&lt;/p>
&lt;h3 id="启动">启动
&lt;/h3>&lt;p>pct start 100&lt;/p>
&lt;h3 id="目前发现的问题">目前发现的问题
&lt;/h3>&lt;h4 id="nat-环回-无效">NAT 环回 无效
&lt;/h4>&lt;p>简单的说，就是内网使用ddns的域名访问内网的服务器，无法访问。 &lt;br>
目前尚不知道如何解决。貌似和openwrt的版本有关系，在使用git-24.286.72457-5518424编译 并且未在openwrt内部使用docker的情况下此问题正常。 但是在更新的版本中又再次出现。
临时解决方法有两种&lt;/p>
&lt;h5 id="别名主机">别名主机
&lt;/h5>&lt;p>别名主机可以在 openwrt 网络 -&amp;gt; dncp -&amp;gt; 主机名映射的地方 添加域名到对应的内网机器ip上。然后清理本地dns缓存后即可访问。也可以在openwrt里面运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">uci add dhcp domain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci set dhcp.@domain[-1].name=&amp;#39;nas.leiyanhui.com&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add_list dhcp.@domain[-1].ip=&amp;#39;10.1.1.50&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dnsmasq restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="自定域名解析">自定域名解析
&lt;/h5>&lt;p>如果你有使用adguardHome 之类的自建dns,可以在dns内添加对应的域名解析记录到内网ip。或者修改需要访问的的电脑的hosts文件。&lt;/p>
&lt;h4 id="openclash-tun无法使用">openclash tun无法使用
&lt;/h4>&lt;p>暂时不知道如何解决。&lt;/p>
&lt;h4 id="部分情况下-udp无法转发">部分情况下 udp无法转发
&lt;/h4>&lt;p>需要PVE系统加载 xt_TPROXY 模块。在PVE系统下执行改命令后重启。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="s1">&amp;#39;xt_TPROXY&amp;#39;&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">load&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="偶尔发生pve外机器无法上网">偶尔发生pve外机器无法上网
&lt;/h4>&lt;p>后续发现是ap的原因，重启ap后解决。 如果你的ap刷过系统，可以在ap内检测主路由状态，如果ping不到lxc的主路由，那么重启即可。&lt;/p>
&lt;h4 id="openclash配置参考">openclash配置参考
&lt;/h4>&lt;p>/etc/config/openclash
注意下文中的 testingcf.jsdelivr.net 地址在部分地区可能已经干扰，请&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;span class="lnt">242
&lt;/span>&lt;span class="lnt">243
&lt;/span>&lt;span class="lnt">244
&lt;/span>&lt;span class="lnt">245
&lt;/span>&lt;span class="lnt">246
&lt;/span>&lt;span class="lnt">247
&lt;/span>&lt;span class="lnt">248
&lt;/span>&lt;span class="lnt">249
&lt;/span>&lt;span class="lnt">250
&lt;/span>&lt;span class="lnt">251
&lt;/span>&lt;span class="lnt">252
&lt;/span>&lt;span class="lnt">253
&lt;/span>&lt;span class="lnt">254
&lt;/span>&lt;span class="lnt">255
&lt;/span>&lt;span class="lnt">256
&lt;/span>&lt;span class="lnt">257
&lt;/span>&lt;span class="lnt">258
&lt;/span>&lt;span class="lnt">259
&lt;/span>&lt;span class="lnt">260
&lt;/span>&lt;span class="lnt">261
&lt;/span>&lt;span class="lnt">262
&lt;/span>&lt;span class="lnt">263
&lt;/span>&lt;span class="lnt">264
&lt;/span>&lt;span class="lnt">265
&lt;/span>&lt;span class="lnt">266
&lt;/span>&lt;span class="lnt">267
&lt;/span>&lt;span class="lnt">268
&lt;/span>&lt;span class="lnt">269
&lt;/span>&lt;span class="lnt">270
&lt;/span>&lt;span class="lnt">271
&lt;/span>&lt;span class="lnt">272
&lt;/span>&lt;span class="lnt">273
&lt;/span>&lt;span class="lnt">274
&lt;/span>&lt;span class="lnt">275
&lt;/span>&lt;span class="lnt">276
&lt;/span>&lt;span class="lnt">277
&lt;/span>&lt;span class="lnt">278
&lt;/span>&lt;span class="lnt">279
&lt;/span>&lt;span class="lnt">280
&lt;/span>&lt;span class="lnt">281
&lt;/span>&lt;span class="lnt">282
&lt;/span>&lt;span class="lnt">283
&lt;/span>&lt;span class="lnt">284
&lt;/span>&lt;span class="lnt">285
&lt;/span>&lt;span class="lnt">286
&lt;/span>&lt;span class="lnt">287
&lt;/span>&lt;span class="lnt">288
&lt;/span>&lt;span class="lnt">289
&lt;/span>&lt;span class="lnt">290
&lt;/span>&lt;span class="lnt">291
&lt;/span>&lt;span class="lnt">292
&lt;/span>&lt;span class="lnt">293
&lt;/span>&lt;span class="lnt">294
&lt;/span>&lt;span class="lnt">295
&lt;/span>&lt;span class="lnt">296
&lt;/span>&lt;span class="lnt">297
&lt;/span>&lt;span class="lnt">298
&lt;/span>&lt;span class="lnt">299
&lt;/span>&lt;span class="lnt">300
&lt;/span>&lt;span class="lnt">301
&lt;/span>&lt;span class="lnt">302
&lt;/span>&lt;span class="lnt">303
&lt;/span>&lt;span class="lnt">304
&lt;/span>&lt;span class="lnt">305
&lt;/span>&lt;span class="lnt">306
&lt;/span>&lt;span class="lnt">307
&lt;/span>&lt;span class="lnt">308
&lt;/span>&lt;span class="lnt">309
&lt;/span>&lt;span class="lnt">310
&lt;/span>&lt;span class="lnt">311
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">config openclash &amp;#39;config&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proxy_port &amp;#39;7892&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option tproxy_port &amp;#39;7895&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option mixed_port &amp;#39;7893&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option socks_port &amp;#39;7891&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option http_port &amp;#39;7890&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dns_port &amp;#39;7874&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option en_mode &amp;#39;redir-host&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option cn_port &amp;#39;9090&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dashboard_password &amp;#39;123456&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dashboard_forward_ssl &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option rule_source &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_custom_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipv6_enable &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipv6_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_custom_clash_rules &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option other_rule_auto_update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option core_version &amp;#39;linux-amd64&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_redirect_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option servers_if_update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option disable_masq_cache &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option servers_update &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option log_level &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option proxy_mode &amp;#39;rule&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option intranet_allowed &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option disable_udp_quic &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option lan_ac_mode &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option operation_mode &amp;#39;redir-host&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_rule_proxy &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option redirect_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option cachesize_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option filter_aaaa_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option small_flash_memory &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface_name &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option common_ports &amp;#39;21 22 23 53 80 123 143 194 443 465 587 853 993 995 998 2052 2053 2082 2083 2086 2095 2096 5222 5228 5229 5230 8080 8443 8880 8888 8889&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option log_size &amp;#39;1024&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option tolerance &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option store_fakeip &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_fallback_filter &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_fakeip_filter &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_host &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option custom_name_policy &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option append_wan_dns &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option stream_domains_prefetch &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option stream_auto_select &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option bypass_gateway_compatible &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option github_address_mod &amp;#39;自定义的github代理地址&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option urltest_address_mod &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option urltest_interval_mod &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option delay_start &amp;#39;15&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option router_self_proxy &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option release_branch &amp;#39;master&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_core &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dashboard_type &amp;#39;Official&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option yacd_type &amp;#39;Official&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option append_default_dns &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_custom_url &amp;#39;https://ispip.clang.cn/all_cn.txt&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr6_custom_url &amp;#39;https://ispip.clang.cn/all_cn_ipv6.txt&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option cndomain_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/felixonmars/dnsmasq-china-list@master/accelerated-domains.china.conf&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option default_resolvfile &amp;#39;/tmp/resolv.conf.d/resolv.conf.auto&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option find_process_mode &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option global_client_fingerprint &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geodata_loader &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_geoip_dat &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_sniffer &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_sniffer_pure_ip &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_meta_sniffer_custom &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_reload &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_auto_update_mode &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_update_interval &amp;#39;45&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option config_path &amp;#39;/etc/openclash/config/skyvpn.yaml&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option restricted_mode &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_resolvfile &amp;#39;/tmp/resolv.conf.d/resolv.conf.auto&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_custom_domain_dns_server &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option china_ip_route &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geo_update_day_time &amp;#39;6&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_auto_update &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option chnr_update_day_time &amp;#39;3&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_restart &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_restart_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option auto_restart_day_time &amp;#39;13&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option core_type &amp;#39;Meta&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_udp_proxy &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_update_day_time &amp;#39;7&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geoip_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_update_week_time &amp;#39;*&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_update_day_time &amp;#39;8&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option geosite_custom_url &amp;#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_noresolv &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ipv6_mode &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enable_v6_udp_proxy &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option china_ip6_route &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_cachesize &amp;#39;10000&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option dnsmasq_filter_aaaa &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;114.114.114.114&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;119.29.29.29&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;119.28.28.28&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;223.5.5.5&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.pub/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.alidns.com/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.cloudflare.com/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.google&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;853&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;1.1.1.1/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;1.1.1.1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;853&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;8.8.8.8&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;853&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;2001:4860:4860::8888&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;53&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;2001:4860:4860::8844&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;53&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;2001:da8::666&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option port &amp;#39;53&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;public.dns.iij.jp/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;jp.tiar.app/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;jp.tiarap.org/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;jp.tiar.app&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dot.tiar.app&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;tls&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.dnslify.com/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.twnic.tw/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dns.oszx.co/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.applied-privacy.net/query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;dnsforge.de/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.ffmuc.net/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;https&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;doh.mullvad.net/dns-query&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config authentication&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option username &amp;#39;Clash&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option password &amp;#39;socket合同http（s）代理密码&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;nameserver&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;10.1.1.104&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_resolve &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option specific_group &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;fallback&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;10.1.1.104&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_resolve &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option specific_group &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config dns_servers&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option group &amp;#39;default&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option type &amp;#39;udp&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option ip &amp;#39;10.1.1.104&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option interface &amp;#39;Disable&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_resolve &amp;#39;0&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">config config_subscribe&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option enabled &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option name &amp;#39;skyvpn&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option address &amp;#39;你的订阅地址&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option sub_convert &amp;#39;1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option convert_address &amp;#39;https://api.dler.io/sub&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option template &amp;#39;ACL4SSR 规则 Online Full&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option emoji &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option udp &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option skip_cert_verify &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option sort &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option node_type &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">option rule_provider &amp;#39;false&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt 常用命令记录</title><link>https://dev.leiyanhui.com/openwrt/uci/</link><pubDate>Tue, 12 Sep 2023 00:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/uci/</guid><description>&lt;p>为了方便重新刷机后快速手动恢复，记录一下。&lt;/p>
&lt;h2 id="openssh替代dropbear">openssh替代dropbear
&lt;/h2>&lt;p>x86下 建议编译的时候就去掉dropbear 用openssh
用ttyd或者 启动脚本执行 下面命令 写入证书&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir -p /root/.ssh/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /root/.ssh/authorized_keys &amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-rsa XXXXXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod -R 600 ~/.ssh/authorized_keys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/sshd restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者允许root密码登陆&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/bin/cp -n /etc/ssh/sshd_config /etc/ssh/sshd_config-bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s/#PermitRootLogin without-password/PermitRootLogin yes/g&amp;#39; /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&amp;#39; /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/sshd restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="防火墙">防火墙
&lt;/h2>&lt;h3 id="允许内网设备ip6v对外服务">允许内网设备ip6v对外服务
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ 允许内网ipv6 ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add firewall rule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@rule&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.name&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;MY_Allow_IPv6_Services&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@rule&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;wan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@rule&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@rule&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.proto&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;tcp udp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@rule&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.family&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ipv6&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@rule&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.target&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ACCEPT&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit firewall
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="端口映射">端口映射
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ nginx ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add firewall redirect
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.name&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;nginx&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.family&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;wan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;lan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.target&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;DNAT&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_ip&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.50&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_port&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;50400-50443&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src_dport&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;50400-50443&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit firewall
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ redis_tcp ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 省略&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ ipsec4500 ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add firewall redirect
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.name&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ipsec4500&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.family&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;wan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;lan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.target&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;DNAT&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_ip&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.45&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_port&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;4500&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src_dport&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;4500&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit firewall
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add firewall redirect
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.name&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ipsec500&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.family&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;wan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;lan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.target&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;DNAT&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_ip&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.45&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_port&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;500&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src_dport&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;500&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit firewall
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ RustDesk ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add firewall redirect
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.name&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;RustDesk&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.family&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ipv4&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;wan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;lan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.target&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;DNAT&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_ip&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.15&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.dest_port&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;21115-21119&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> firewall.@redirect&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.src_dport&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;21115-21119&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit firewall
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ npc ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># # 省略&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#更多...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/firewall restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="dhcp静态绑定">dhcp静态绑定
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">uci commit dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add dhcp host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> dhcp.@host&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.name&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;usbWifi&amp;#39;&lt;/span> &lt;span class="c1"># 客户端名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> dhcp.@host&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.mac&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;xx:xx:xx:xx:xx:xx&amp;#39;&lt;/span> &lt;span class="c1"># 客户端的MAC地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> dhcp.@host&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.ip&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.70&amp;#39;&lt;/span> &lt;span class="c1"># 静态IP地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add dhcp host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> dhcp.@host&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.name&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;iphoneL&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> dhcp.@host&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.mac&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;xx:xx:xx:xx:xx:xx&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci &lt;span class="nb">set&lt;/span> dhcp.@host&lt;span class="o">[&lt;/span>-1&lt;span class="o">]&lt;/span>.ip&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.71&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#更多...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dnsmasq restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="openclash">openclash
&lt;/h2>&lt;h3 id="自定义规则">自定义规则
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c">##script:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">##rules:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,gitea.io,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,mypikpak.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,dwz.date,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,chaojijichang.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,acme.sh,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,github.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,netlify.app,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,geekdocs.de,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,dmdy12.cc,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,restic.net,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,codigoparallevar.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,mypikpak.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,go.dev,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,v2ex.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,virtualhere.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,shiftr.io,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,nuaa.cf,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,bitwarden.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## linux&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN,dl-cdn.alpinelinux.org,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN,gitlab.archlinux.org,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alpinelinux.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,archlinux.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,archlinuxcn.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN,deb.debian.org,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN,cn.archive.ubuntu.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 安卓&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,coloros.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## github&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ghproxy.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ghproxy.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## docker &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,docker.io,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 淘宝 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,taobao.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,tmall.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,taobao.com.cn,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,tmall.com.cn,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alibaba.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,aliexpress.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alipay.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,etao.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,juhuasuan.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,fliggy.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alimama.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alibaba-inc.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alibabacloud.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alicdn.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,alibaba.net,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,aliyuncs.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## netdisk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,r2.cloudflarestorage.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,koofr.net,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,pcloud.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 微软 补充规则 &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,bing.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ecosia.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,microsoft.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">#- DOMAIN-SUFFIX,packages.microsoft.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,live.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,microsoftonline.cn,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,sharepoint.cn,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># ipv6 用镜像站区分&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,test-ipv6.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ip.zxinc.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## DDNS https://ip.skk.moe/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,checkip.dyndns.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,checkipv6.dyndns.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,checkip.synology.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ifconfig.co,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,api.myip.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ip-api.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ipapi.co,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ip6.seeip.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,members.3322.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## eu.org&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,nic.eu.org,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,eu.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 天气相关&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## poltbar&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,openweathermap.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## nextcloud&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,openstreetmap.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,opentopodata.org,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,met.no,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## cloudflare ipv4 ipv6&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## https://www.cloudflare.com/ips-v4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,1.1.1.1/8,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,173.245.48.0/20,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,103.21.244.0/22,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,103.22.200.0/22,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,103.31.4.0/22,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,141.101.64.0/18,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,108.162.192.0/18,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,190.93.240.0/20,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,188.114.96.0/20,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,197.234.240.0/22,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,198.41.128.0/17,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,162.158.0.0/15,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,104.16.0.0/13,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,104.24.0.0/14,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,172.64.0.0/13,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR,131.0.72.0/22,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## https://www.cloudflare.com/ips-v6&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR6,2400:cb00::/32,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR6,2606:4700::/32,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR6,2803:f800::/32,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR6,2405:b500::/32,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR6,2405:8100::/32,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR6,2a06:98c0::/29,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">IP-CIDR6,2c0f:f248::/32,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## dash.cloudflare.com /&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,wwww.cloudflare.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,dash.cloudflare.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,static.dash.cloudflare.com,🚀 节点选择&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## vod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ffzy-play5.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,ffzypic.com,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 强制直连 密码插件&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,bitwarden.net,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 屏蔽清单&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 鼠标右键插件&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">DOMAIN-SUFFIX,mousegesturesapi.com,REJECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">## 其他国内ip强制直连&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="l">GEOIP,CN,DIRECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="基本配置文件">基本配置文件
&lt;/h3>&lt;p>rm /etc/config/openclash &amp;amp;&amp;amp; nano /etc/config/openclash&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;span class="lnt">242
&lt;/span>&lt;span class="lnt">243
&lt;/span>&lt;span class="lnt">244
&lt;/span>&lt;span class="lnt">245
&lt;/span>&lt;span class="lnt">246
&lt;/span>&lt;span class="lnt">247
&lt;/span>&lt;span class="lnt">248
&lt;/span>&lt;span class="lnt">249
&lt;/span>&lt;span class="lnt">250
&lt;/span>&lt;span class="lnt">251
&lt;/span>&lt;span class="lnt">252
&lt;/span>&lt;span class="lnt">253
&lt;/span>&lt;span class="lnt">254
&lt;/span>&lt;span class="lnt">255
&lt;/span>&lt;span class="lnt">256
&lt;/span>&lt;span class="lnt">257
&lt;/span>&lt;span class="lnt">258
&lt;/span>&lt;span class="lnt">259
&lt;/span>&lt;span class="lnt">260
&lt;/span>&lt;span class="lnt">261
&lt;/span>&lt;span class="lnt">262
&lt;/span>&lt;span class="lnt">263
&lt;/span>&lt;span class="lnt">264
&lt;/span>&lt;span class="lnt">265
&lt;/span>&lt;span class="lnt">266
&lt;/span>&lt;span class="lnt">267
&lt;/span>&lt;span class="lnt">268
&lt;/span>&lt;span class="lnt">269
&lt;/span>&lt;span class="lnt">270
&lt;/span>&lt;span class="lnt">271
&lt;/span>&lt;span class="lnt">272
&lt;/span>&lt;span class="lnt">273
&lt;/span>&lt;span class="lnt">274
&lt;/span>&lt;span class="lnt">275
&lt;/span>&lt;span class="lnt">276
&lt;/span>&lt;span class="lnt">277
&lt;/span>&lt;span class="lnt">278
&lt;/span>&lt;span class="lnt">279
&lt;/span>&lt;span class="lnt">280
&lt;/span>&lt;span class="lnt">281
&lt;/span>&lt;span class="lnt">282
&lt;/span>&lt;span class="lnt">283
&lt;/span>&lt;span class="lnt">284
&lt;/span>&lt;span class="lnt">285
&lt;/span>&lt;span class="lnt">286
&lt;/span>&lt;span class="lnt">287
&lt;/span>&lt;span class="lnt">288
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">openclash&lt;/span> &lt;span class="s1">&amp;#39;config&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">proxy_port&lt;/span> &lt;span class="s1">&amp;#39;7892&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">tproxy_port&lt;/span> &lt;span class="s1">&amp;#39;7895&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">mixed_port&lt;/span> &lt;span class="s1">&amp;#39;7893&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">socks_port&lt;/span> &lt;span class="s1">&amp;#39;7891&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">http_port&lt;/span> &lt;span class="s1">&amp;#39;7890&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dns_port&lt;/span> &lt;span class="s1">&amp;#39;7874&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">update&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">en_mode&lt;/span> &lt;span class="s1">&amp;#39;redir-host&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">auto_update&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">cn_port&lt;/span> &lt;span class="s1">&amp;#39;9090&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dashboard_password&lt;/span> &lt;span class="s1">&amp;#39;123456&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dashboard_forward_ssl&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">rule_source&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_custom_dns&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ipv6_enable&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ipv6_dns&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_custom_clash_rules&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">other_rule_auto_update&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">core_version&lt;/span> &lt;span class="s1">&amp;#39;linux-amd64&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_redirect_dns&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">servers_if_update&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">disable_masq_cache&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">servers_update&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">log_level&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">proxy_mode&lt;/span> &lt;span class="s1">&amp;#39;rule&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">intranet_allowed&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_udp_proxy&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">disable_udp_quic&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">lan_ac_mode&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">operation_mode&lt;/span> &lt;span class="s1">&amp;#39;redir-host&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_rule_proxy&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">redirect_dns&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">cachesize_dns&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">filter_aaaa_dns&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">small_flash_memory&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">interface_name&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">common_ports&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">log_size&lt;/span> &lt;span class="s1">&amp;#39;1024&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">tolerance&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">store_fakeip&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">custom_fallback_filter&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">custom_fakeip_filter&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">custom_host&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">custom_name_policy&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">append_wan_dns&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">stream_domains_prefetch&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">stream_auto_select&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">bypass_gateway_compatible&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">github_address_mod&lt;/span> &lt;span class="s1">&amp;#39;https://ghproxy.com/&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">urltest_address_mod&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">urltest_interval_mod&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">delay_start&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">router_self_proxy&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">release_branch&lt;/span> &lt;span class="s1">&amp;#39;master&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_meta_core&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dashboard_type&lt;/span> &lt;span class="s1">&amp;#39;Official&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">yacd_type&lt;/span> &lt;span class="s1">&amp;#39;Official&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">append_default_dns&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geo_custom_url&lt;/span> &lt;span class="s1">&amp;#39;https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">chnr_custom_url&lt;/span> &lt;span class="s1">&amp;#39;https://ispip.clang.cn/all_cn.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">chnr6_custom_url&lt;/span> &lt;span class="s1">&amp;#39;https://ispip.clang.cn/all_cn_ipv6.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">cndomain_custom_url&lt;/span> &lt;span class="s1">&amp;#39;https://testingcf.jsdelivr.net/gh/felixonmars/dnsmasq-china-list@master/accelerated-domains.china.conf&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">default_resolvfile&lt;/span> &lt;span class="s1">&amp;#39;/tmp/resolv.conf.d/resolv.conf.auto&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">config_auto_update_mode&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">config_update_interval&lt;/span> &lt;span class="s1">&amp;#39;45&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">config_path&lt;/span> &lt;span class="s1">&amp;#39;/etc/openclash/config/skyvpn.yaml&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">restricted_mode&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">config_reload&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dnsmasq_resolvfile&lt;/span> &lt;span class="s1">&amp;#39;/tmp/resolv.conf.d/resolv.conf.auto&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_custom_domain_dns_server&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">china_ip_route&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">other_rule_update_week_time&lt;/span> &lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">other_rule_update_day_time&lt;/span> &lt;span class="s1">&amp;#39;22&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geo_auto_update&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geo_update_week_time&lt;/span> &lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geo_update_day_time&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geoip_auto_update&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geosite_auto_update&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">chnr_auto_update&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">chnr_update_week_time&lt;/span> &lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">chnr_update_day_time&lt;/span> &lt;span class="s1">&amp;#39;4&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">auto_restart&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">auto_restart_week_time&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">auto_restart_day_time&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geoip_update_week_time&lt;/span> &lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geoip_update_day_time&lt;/span> &lt;span class="s1">&amp;#39;2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geoip_custom_url&lt;/span> &lt;span class="s1">&amp;#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geosite_update_week_time&lt;/span> &lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geosite_update_day_time&lt;/span> &lt;span class="s1">&amp;#39;3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geosite_custom_url&lt;/span> &lt;span class="s1">&amp;#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">restart&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dnsmasq_noresolv&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">find_process_mode&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">global_client_fingerprint&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">geodata_loader&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_geoip_dat&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_meta_sniffer&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_meta_sniffer_pure_ip&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enable_meta_sniffer_custom&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">dnsmasq_cachesize&lt;/span> &lt;span class="s1">&amp;#39;10000&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;doh.pub/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;nameserver&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;dns.alidns.com/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;nameserver&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;dns.cloudflare.com/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;dns.google&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="s1">&amp;#39;853&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;tls&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;1.1.1.1/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;1.1.1.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="s1">&amp;#39;853&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;tls&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;8.8.8.8&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="s1">&amp;#39;853&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;tls&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;udp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;2001:4860:4860::8888&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="s1">&amp;#39;53&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;udp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;2001:4860:4860::8844&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="s1">&amp;#39;53&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;udp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;2001:da8::666&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">port&lt;/span> &lt;span class="s1">&amp;#39;53&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;public.dns.iij.jp/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;jp.tiar.app/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;jp.tiarap.org/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;jp.tiar.app&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;tls&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;dot.tiar.app&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;tls&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;doh.dnslify.com/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;dns.twnic.tw/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;dns.oszx.co/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;doh.applied-privacy.net/query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;dnsforge.de/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;doh.ffmuc.net/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">dns_servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;fallback&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="s1">&amp;#39;https&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="s1">&amp;#39;doh.mullvad.net/dns-query&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">authentication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">username&lt;/span> &lt;span class="s1">&amp;#39;Clash&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">password&lt;/span> &lt;span class="s1">&amp;#39;PxWRaBiU&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">config_subscribe&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="s1">&amp;#39;skyvpn&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="s1">&amp;#39;&amp;lt;订阅地址&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">sub_convert&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">convert_address&lt;/span> &lt;span class="s1">&amp;#39;https://api.dler.io/sub&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">template&lt;/span> &lt;span class="s1">&amp;#39;ACL4SSR 规则 Online Full&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">emoji&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">udp&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">skip_cert_verify&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">node_type&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">rule_provider&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">config_subscribe&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="s1">&amp;#39;yiyuan&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="s1">&amp;#39;&amp;lt;订阅地址&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">sub_convert&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">convert_address&lt;/span> &lt;span class="s1">&amp;#39;https://api.dler.io/sub&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">template&lt;/span> &lt;span class="s1">&amp;#39;ACL4SSR 规则 Online Full&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">emoji&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">udp&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">skip_cert_verify&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">node_type&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">rule_provider&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config&lt;/span> &lt;span class="n">config_subscribe&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="s1">&amp;#39;feiniaoyun&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="s1">&amp;#39;&amp;lt;订阅地址&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">sub_convert&lt;/span> &lt;span class="s1">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">convert_address&lt;/span> &lt;span class="s1">&amp;#39;https://api.dler.io/sub&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">template&lt;/span> &lt;span class="s1">&amp;#39;ACL4SSR 规则 Online Full&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">emoji&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">udp&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">skip_cert_verify&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">node_type&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">option&lt;/span> &lt;span class="n">rule_provider&lt;/span> &lt;span class="s1">&amp;#39;false&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt更换openssh后无法ssh登陆root的解决方法</title><link>https://dev.leiyanhui.com/openwrt/openssh/</link><pubDate>Mon, 11 Sep 2023 07:15:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/openssh/</guid><description>&lt;p>openwrt默认是使用dropbear，虽然轻量，但是使用起来会带来一些麻烦。 你可以通过修改dropbear端口再安装openssh 或者 在编译固件的时候直接编译进去。&lt;/p>
&lt;p>但是你会发root登陆，不上。如果 dropbear 还可以登陆 或者有显示器，那么修改/etc/ssh/sshd_config 后重启ssh即可。&lt;/p>
&lt;p>如果只有网页可以登陆。 那么打开 启动脚本：http://10.1.1.1/cgi-bin/luci/admin/system/startup&lt;/p>
&lt;p>在exit 0 前面 输入 几行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/bin/cp -n /etc/ssh/sshd_config /etc/ssh/sshd_config-bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s/#PermitRootLogin without-password/PermitRootLogin yes/g&amp;#39; /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&amp;#39; /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>有的版本是 without-password 有的版本是 prohibit-password，所以添加两行。
然后重启路由器即可 用root密码登陆。&lt;/p>
&lt;p>或者 干脆直接写入key 也是在 exit 0 前面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir -p /root/.ssh/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /root/.ssh/authorized_keys &amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...你的key内容...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod -R 600 ~/.ssh/authorized_keys
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt内网设备无法通过外网域名/ip访问的解决</title><link>https://dev.leiyanhui.com/openwrt/dnat/</link><pubDate>Mon, 11 Sep 2023 07:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/dnat/</guid><description>&lt;p>默认情况下，直接在openwrt配置端口转发，会自动启用 NAT 环回。 但是在部分固件下，尤其是存在docker 和ipsec等服务的时候 就会失效。&lt;/p>
&lt;p>在帮多个网友排查处理的时候 总结出来的小经验：不讲复杂的原理，只说实现方法&lt;/p>
&lt;h3 id="常见解决方法">常见解决方法
&lt;/h3>&lt;ul>
&lt;li>修改 wan=&amp;gt; lan的防火墙配置 （ 旧版有效）&lt;/li>
&lt;li>在对应的端口转发的位置 关闭重新打开启用 NAT 环回 （看脸）&lt;/li>
&lt;li>修改/etc/sysctl.conf （部分固件有效）&lt;/li>
&lt;li>/etc/dnsmasq.hosts 即 dnsmasq 在科学软件劫持dns后概率失效 且仅限基于域名的业务&lt;/li>
&lt;li>内网机器hosts大法 （肯定有效，但是仅限域名业务）&lt;/li>
&lt;li>别名主机大法 （有效，但是仅限域名业务）&lt;/li>
&lt;/ul>
&lt;p>前面几种方法 网上都有对应的教材不用细说，在不同的源码固件下不太通用，在更新内核后也有可能失效。这里只说 最后一种方法。&lt;/p>
&lt;h3 id="最通用的解决方法">最通用的解决方法
&lt;/h3>&lt;p>别名主机&lt;/p>
&lt;h4 id="luci">luci
&lt;/h4>&lt;p>根据版本不同，入口位置不同 一般在 http://&lt;!-- raw HTML omitted -->/cgi-bin/luci/admin/network/dhcp 别名主机 的位置&lt;/p>
&lt;h4 id="uci">uci
&lt;/h4>&lt;p>和luci一样，但是可以直接shell运行，更简单直观。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">uci add dhcp domain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci set dhcp.@domain[-1].name=&amp;#39;域名地址&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci add_list dhcp.@domain[-1].ip=&amp;#39;10.1.1.50&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dnsmasq restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意 如论是别名主机 还是 hosts 都不支持泛域名,要支持泛域名只有dnsmasq。&lt;/p>
&lt;h3 id="最后">最后
&lt;/h3>&lt;h4 id="月经bug">月经bug
&lt;/h4>&lt;p>openwrt 这个问题，在不同的版本，包括官方版都反复出现。 用的还算稳定的情况下，尽量不折腾。浪费青春。&lt;/p>
&lt;h4 id="建议">建议
&lt;/h4>&lt;p>不是太特殊的情况下，建议用别名主机的来处理。如果有特殊需求，建议弃用docker ，opkg的软件还是蛮多的，部分没有的可以用可以在其他机器上用 docker导出后 在openwrt chroot使用。&lt;/p></description></item><item><title>debian做路由器的思考</title><link>https://dev.leiyanhui.com/mq/debian-router/</link><pubDate>Thu, 07 Sep 2023 01:15:20 +0800</pubDate><guid>https://dev.leiyanhui.com/mq/debian-router/</guid><description>&lt;p>先说openwrt作为路由器 我们需要的功能，以及debian下的替代方案&lt;/p>
&lt;ul>
&lt;li>拨号 和 网络转发 dhcp 这是路由器的基本功能 不用多说&lt;/li>
&lt;li>科学 太多选择了，v2raya 是一个不错的选择 都比较简单易用&lt;/li>
&lt;li>ddns 有很多其他的选择&lt;/li>
&lt;li>端口转发nat转发 iptable/nftable 都是通用的&lt;/li>
&lt;li>UPnP miniupnpd&lt;/li>
&lt;li>ipv6 wide-dhcpv6-client&lt;/li>
&lt;/ul>
&lt;p>参考：&lt;br>
&lt;a class="link" href="https://blog.bling.moe/post/3/" target="_blank" rel="noopener"
>https://blog.bling.moe/post/3/&lt;/a>&lt;/p></description></item><item><title>openwrt /Dropbear 开启sftp完整记录</title><link>https://dev.leiyanhui.com/openwrt/sftp/</link><pubDate>Thu, 11 May 2023 13:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/sftp/</guid><description>&lt;p>openwrt一般自带的ssh服务器 是dropbear ,而不是其他linux产用的openssh。dropbear 更加轻量化，更适合嵌入式设备。但是dropbear的文件传输只支持scp而不支持sftp。&lt;/p>
&lt;p>但是某些适合，scp协议无法替代sftp。所以还是要处理一下。&lt;/p>
&lt;p>一般情况下，直接安装 openssh-sftp-server 后 dropbear就可以支持sftp但是有时候不生效。&lt;/p>
&lt;p>为了节省时间去检查排错，有两个方案 1、使用rclone serve 或者sftpgo直接搞定sftp 2使用openssh替换掉dropbear&lt;/p>
&lt;blockquote>
&lt;p>2023 09 12 更新，硬盘不紧张的话 建议固件编译的时候就 使用openssh&lt;/p>&lt;/blockquote>
&lt;h1 id="使用rclone">使用rclone
&lt;/h1>&lt;h2 id="安装rclone">安装rclone
&lt;/h2>&lt;p>opkg仓库安装&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">opkg install rclone
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者手动安装，注意选择你的cpu架构&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">wget&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">ghproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">62.2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">62.2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">unzip&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">*.&lt;/span>&lt;span class="n">zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">62.2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">chmod&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="配置本地储存节点">配置本地储存节点
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone config --config /etc/rclone/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加一个本地储存 ，或者直接在rclone.conf文件添加&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[localhost]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">type = local
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="搭建服务">搭建服务
&lt;/h2>&lt;p>编辑 /etc/rc.local 在exit 0前面 添加一行，或者路由器界面中 系统&amp;gt; 启动项&amp;gt; 本地其中脚本中输入&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone serve sftp localhost:/ --addr :1022 --user 用户名 --pass 密码 --dir-cache-time 10s --config /etc/rclone/rclone.conf &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone serve ftp localhost:/ --addr :1021 --user 用户名 --pass 密码 --dir-cache-time 10s --config /etc/rclone/rclone.conf &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone serve webdav localhost:/ --addr :1023 --user 用户名 --pass 密码 --dir-cache-time 10s --config /etc/rclone/rclone.conf &amp;amp;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面的命令，没一行对应一个服务协议，选择你需要的即可。一般局域网内没必要sftp，ftp性能更好
重启路由器即可，或者 手动运行一次 上面命令。&lt;/p>
&lt;h1 id="使用openssh">使用openssh
&lt;/h1>&lt;h2 id="首先给root一个设置密码">首先给root一个设置密码
&lt;/h2>&lt;p>过程略 sd&lt;/p>
&lt;h2 id="修改dropbear端口">修改dropbear端口
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">uci set dropbear.@dropbear[0].Port=2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci commit dropbear
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dropbear restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后客户端重新连接 &lt;code>ssh root@10.1.1.1 -p 2222&lt;/code>&lt;br>
这样 dropbear 就在2222 临时提供 ssh和scp协议&lt;/p>
&lt;h2 id="安装openssh-和sftp">安装openssh 和sftp
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm /etc/ssh/sshd_config #如果有这个文件最好删掉 重新配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg install openssh-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg install openssh-sftp-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="修改配置文件">修改配置文件
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>需要修改和检查多数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">UsePAM yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PermitRootLogin yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Subsystem sftp /usr/lib/sftp-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="启动或者重启">启动或者重启
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/init.d/sshd enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/sshd restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="客户端连接">客户端连接
&lt;/h2>&lt;p>部分客户端 可能需要处理 .ssh/known_hosts 文件或者密钥&lt;/p>
&lt;h2 id="最后禁用dropbear">最后禁用dropbear
&lt;/h2>&lt;p>非必需&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/init.d/dropbear disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dropbear stop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>路由器这个圈子，不忍直视。一个错误的恩山论坛回帖 能转载的整个简中网都是。&lt;/p>&lt;/blockquote></description></item><item><title>openwrt dhcp指定不同网关的解决版本</title><link>https://dev.leiyanhui.com/openwrt/openwrt-other-netgay/</link><pubDate>Sun, 16 Apr 2023 13:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/openwrt-other-netgay/</guid><description>&lt;p>openwrt其实是可以手动指定部分设备的网关的。可以实现局域网内部分设备用指定的网关自动自动dhcp&lt;/p>
&lt;h2 id="场景">场景
&lt;/h2>&lt;p>设备A 主路由 IP:10.1.1.1
设备B 旁路由/网关 IP:10.1.1.6&lt;/p>
&lt;p>自己的手机 IP:10.1.1.71
自己笔记本 IP:10.1.1.72&lt;/p>
&lt;p>家人设备 IP段： 10.1.1.200-254&lt;/p>
&lt;h2 id="操作">操作
&lt;/h2>&lt;p>主路由和旁路路由 谁开dhcp 都不影响 下面的操作。
本文内容是openwrt dhcp的指定网关，所以主路由和旁路路由 负责dchp的设备肯定是openwrt的系统。
登陆 这个负责dchp的设备的webui界面，在dhcp静态分配的地方先配置好静态ip。&lt;br>
而后 ssh登陆这个设备，编辑文件 &lt;code>/etc/config/dhcp&lt;/code>，如果你对linux不熟悉 可以用winscp 之类的软件下载到本机修改，并做好备份。
需要编辑两个地址，1是添加一个tag 2是修改需要用10.1.1.6作为网关的设备让他使用这个tag&lt;br>
在文件的第一个 config host 段落前面添加一段，内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">config tag &amp;#39;need_outernet&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> list dhcp_option &amp;#39;3,10.1.1.6&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option force &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>10.1.1.6&lt;/code> 就是我们需要的网关地址 &lt;code>need_outernet&lt;/code> 是tag的名称，可以用别的名字
找到 需要配置旁路网关的设备，添加上这个 tag 就是加一行&lt;code> option tag 'need_outernet'&lt;/code>
例如 iphoneL 和reamme 这两个都是我的手机，k2p是一个做AP用的硬路由，原来的格式如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;realme&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;D0:97:FE:DC:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.72&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;k2p&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;74:7D:24:BE:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.2&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;iphoneL&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;3A:9F:13:9D:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.71&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改为后&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;realme&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;D0:97:FE:DC:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.72&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option tag &amp;#39;need_outernet&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;k2p&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;74:7D:24:BE:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.2&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;iphoneL&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;3A:9F:13:9D:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.71&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option tag &amp;#39;need_outernet&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改完成后 保存推出。 vi/vim 是按下 esc，然后按下键盘上 :wq ,nano的话 ctrl+x ，然后 y确认回车
执行 &lt;code>dnsmasq --test&lt;/code> 检查，应该会提示 dnsmasq: syntax check OK. 那就是可以了。
然后重启 dns 命令: &lt;code>/etc/init.d/dnsmasq restart&lt;/code>。
而后 两个手机重新连接一下wifi 就好了。台式机话重新拔插网线或者禁用启用一下网卡。&lt;/p>
&lt;p>最后，一个完整的&lt;code>/etc/config/dhcp&lt;/code> 参考如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 前面可能有 dnsmasq lan wan odhcpd srvhost
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># config tag 这段是我们添加的
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config tag &amp;#39;need_outernet&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> list dhcp_option &amp;#39;3,10.1.1.6&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option force &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># config host 是对应静态地址分配的每一个设备
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;kvm-win10&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;2A:95:2A:A1:37:9D&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.10&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;realme&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;D0:97:FE:DC:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.72&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option tag &amp;#39;need_outernet&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;k2p&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;74:7D:24:BE:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.2&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">config host
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option name &amp;#39;iphoneL&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option dns &amp;#39;1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option mac &amp;#39;3A:9F:13:9D:XX:XX&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option ip &amp;#39;10.1.1.71&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> option tag &amp;#39;need_outernet&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 还有其他设备的 config host 段落
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>一个适合爱快docker运行的openwrt</title><link>https://dev.leiyanhui.com/openwrt/ikuai/</link><pubDate>Sat, 25 Feb 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/ikuai/</guid><description>&lt;h3 id="特点">特点
&lt;/h3>&lt;p>干净整洁，不集成任何插件，但是 可以随意安装科学插件，可以任意重新打包备份 导出到本地等等。&lt;/p>
&lt;p>是最新最新的源构建！ 版本: 22.03.3 内核版本：肯定是爱快的内核。&lt;/p>
&lt;p>尤其适合不支持的虚拟化的主机安装爱快的情况下 使用openwrt 作为旁路由 接替 网关 dns 提供 科学学习 以及去广告等服务。&lt;/p>
&lt;p>支持 docker的其他环境 也可以用。&lt;/p>
&lt;p>爱快后台可以直接点几下 就安装。&lt;/p>
&lt;p>一键开机 ipv6
默认主题：argon
Web服务器 : nginx&lt;/p>
&lt;h3 id="使用教程">使用教程
&lt;/h3>&lt;p>仅供赞助用户，赞助 20 元，邮件 &lt;a class="link" href="mailto:joyanhui@qq.com" >joyanhui@qq.com&lt;/a> 索取。邮件标题注明 爱快 docker运行 openwrt&lt;/p>
&lt;p>另外接受定制，可以 提供 lxc docker镜像 VMware镜像 以及物理机镜像，&lt;/p></description></item><item><title>pve 用lxc容器运行docker最小化部署，以及lxc所有问题汇总！</title><link>https://dev.leiyanhui.com/pve/docker-mini/</link><pubDate>Mon, 06 Feb 2023 00:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/pve/docker-mini/</guid><description>&lt;p>为什么用lxc运行docker，因为更轻量，相对vm运行 管理更方便。 &lt;br>
比如 家用环境的 aio上， 可以把路由器常用的功能 全部集成到一个或者多个lxc里面。 &lt;br>
pve 跑vm 再去跑docker 虽然上手简单，但是会有一些其他问题。&lt;br>
之所以用lxc去运行docker，因为很多软件只有docker版本 或为了部署/更新/备份/更方便。&lt;/p>
&lt;h3 id="最小化部署docker">最小化部署docker
&lt;/h3>&lt;p>模板选择alpine，改一下ct源。不改也可以直接去国内镜像下载，例如： &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/alpine-3.17-default_20221129_amd64.tar.xz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>去掉无特权容器的勾号，ip的地方选择dhcp，然后先不开机。其他按照默认设置即可&lt;br>
点选项 功能，选中 fuse 和 嵌套。
编辑&lt;code>nano ​ /etc/pve/lxc/容器id.conf&lt;/code> 具体查看本文 &lt;code>lxc 特权容器 和非特权容器的选择&lt;/code> 章节，编辑完成后启动
启动后逐行运行，都有注释&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 替换国内源&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sed&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="s1">&amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">repositories&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装时区设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">tzdata&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">zoneinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">localtime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;Asia/Shanghai&amp;#34;&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">timezone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 卸载时区&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">del&lt;/span> &lt;span class="n">tzdata&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apk&lt;/span>&lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="c1">#nano&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apk&lt;/span>&lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 开机启动启动docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">update&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">boot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 手动启动docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">service&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">start&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看docker版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">version&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>这样运行的docker 不会有兼容性问题，也不会存在那些一知半解的人说的 什么什么不能运行的问题。&lt;/p>&lt;/blockquote>
&lt;h3 id="lxc模板的选择">lxc模板的选择
&lt;/h3>&lt;p>主要是 debian/ubuntu 和 alpine的 二选一&lt;br>
如果lxc 只打算用来跑docker 那么 肯定是首选alpine，alpine宿主lxc只有几M。如果要跑一些非docker的软件。
有几种情况下，建议选 debian/ubuntu&lt;/p>
&lt;ul>
&lt;li>alpine因为musl 和 rc的问题 和部分软件兼容性不好，可能需要手动处理一些东西。 如果你没有时间弄那些&lt;/li>
&lt;li>部分软件的发行版 不支持alpine&lt;/li>
&lt;li>想直接装deb&lt;/li>
&lt;/ul>
&lt;h3 id="lxc-特权容器-和非特权容器的选择">lxc 特权容器 和非特权容器的选择
&lt;/h3>&lt;p>无特殊情况，首选特权容器。特权容器外挂pve的目录更方便，而且特权容器也是支持docker的。&lt;code>nano ​ /etc/pve/lxc/容器id.conf&lt;/code> 添加下面几行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc.apparmor.profile: unconfined
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup.devices.allow: a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="lxc内运行的服务-是直接安装还是再套一次docker">lxc内运行的服务 是直接安装还是再套一次docker
&lt;/h3>&lt;p>看服务的软件情况。优选直接安装，尤其是依赖很少的服务。 &lt;br>
例如 ddns-go 作者提供二进制包，而且支持alpine，那么就没必要再套docker了。&lt;br>
再比如 思源笔记，作者没有提供二进制包，服务版只有docker版，那么就肯定就是docker来运行了。&lt;br>
再比如 alist ，如果你lxc跑的alpine ，alist能运行，但是不支持安装的启动服务里面，那么手写启动脚本，还是直接docker 那就随便你了。&lt;/p>
&lt;h3 id="一个lxc里面可以运行多少个服务多少个docker">一个lxc里面可以运行多少个服务，多少个docker
&lt;/h3>&lt;p>没有限制，但lxc也是容器，通常而言最好也遵循 一个容器一个服务的原则。 比如
lxc 100 运行openwrt 做旁路由/网关
lxc 101 运行 mosdns
lxc 102 运行 alist
lxc 103 运行 rustdesk 的两个中继服务
lxc 104 跑一个nginx webdav网盘
互相独立，这样最合理，备份和管理也方便一些。 但是你全部放到一个lxc里面 也没毛病。&lt;/p>
&lt;h3 id="lxc-创建那么多内容够用嘛">lxc 创建那么多内容够用嘛？
&lt;/h3>&lt;p>lxc 的内存 是上限内存 不是分给他就就全占用了。 所以创建你几十个lxc，但是都没有太大负载，每个都分给他10G内存，也是没问题的。&lt;/p>
&lt;h3 id="lxc-里面可以再套一次pve嘛">lxc 里面可以再套一次pve嘛？
&lt;/h3>&lt;p>理论上可以，直接套kvm 再去跑一个windows 是可以的。&lt;/p>
&lt;h3 id="lxc-内部的ssh反映慢">lxc 内部的ssh反映慢
&lt;/h3>&lt;p>选项里面 勾选 嵌套 。重启即可&lt;/p>
&lt;h3 id="lxc-内无法运行appimage-程序">lxc 内无法运行appimage 程序
&lt;/h3>&lt;p>选项里面 勾选 fuse 。重启即可&lt;/p>
&lt;h3 id="lxc-挂载外部目录-没有写权限">lxc 挂载外部目录 没有写权限
&lt;/h3>&lt;p>非特权容器需要处理用户映射，特权容器可以直接读写。详情查看 本站内文章： &lt;a class="link" href="https://dev.leiyanhui.com/pve/lxc-mount-dir/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/lxc-mount-dir/&lt;/a>&lt;/p>
&lt;h3 id="lxc-无法直接导入-openwrt的包">lxc 无法直接导入 openwrt的包
&lt;/h3>&lt;p>因为ostype 的问题，pve的webui界面操作里面不支持这个配置。用命令行导入即可,例子：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">pct&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="mi">2008&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">openwrt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dmz&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">02.05&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2023&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">generic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rootfs__1_&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">arch&lt;/span> &lt;span class="n">amd64&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">hostname&lt;/span> &lt;span class="n">dmz&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">OpenWrt&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">rootfs&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">memory&lt;/span> &lt;span class="mi">2048&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">swap&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">cores&lt;/span> &lt;span class="mi">12&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">ostype&lt;/span> &lt;span class="n">unmanaged&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">unprivileged&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">net0&lt;/span> &lt;span class="n">bridge&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">vmbr0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">eth0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="lxc-可以运行出来一个桌面嘛">lxc 可以运行出来一个桌面嘛
&lt;/h3>&lt;p>当然可以，你正常在lxc里面 安装桌面包就ok了。比如 gnome kde i3w 等等 都是可以的，而且可以开显卡加速&lt;/p>
&lt;h3 id="lxc-里面可以运行一个windows嘛">lxc 里面可以运行一个windows嘛
&lt;/h3>&lt;p>可以，甚至 运行一个macos都是可以的。当然就是和docker里面跑win跑macos一样 都是需要 lxc 里面套kvm了。&lt;/p>
&lt;h3 id="现有虚拟机导入lxc-可以嘛">现有虚拟机导入lxc 可以嘛？
&lt;/h3>&lt;p>可以，但是仅限linux虚拟机 ： &lt;a class="link" href="https://dev.leiyanhui.com/pve/kvm-to-lxc/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/kvm-to-lxc/&lt;/a>&lt;/p></description></item><item><title>pve下以lxc模式运行 ipsec （套docker）</title><link>https://dev.leiyanhui.com/pve/ipsec/</link><pubDate>Fri, 03 Feb 2023 16:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/pve/ipsec/</guid><description>&lt;p>因为 安卓和ios 都默认支持ipsec 而不需要另外安装软件。所以 作为内网服务使用还是非常方便。&lt;/p>
&lt;p>加上之前openwrt迁移到lxc后，发现自带的ipsec 有问题。所以干脆lxc单独运行一个，独立运行 备份和使用都方便太多了。&lt;/p>
&lt;p>lxc 也应该遵守 one 容器 one server&lt;/p>
&lt;p>废话到此为止&lt;/p>
&lt;h3 id="创建-一个lxc">创建 一个lxc
&lt;/h3>&lt;p>母盘 我选的 alpine 3.16 , dhcp分配ip，然后在dhcp路由上绑定静态ip 。 系统盘1g就够用 内存随便给一点 swap关闭，cpu给12核心
运行一下命令先安装配置docker&lt;/p>
&lt;blockquote>
&lt;p>之所以lxc套docker 是因为懒得折腾，而且alpine体积很小。&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39; /etc/apk/repositories
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc-update add docker boot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service docker start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="准备配置文件">准备配置文件
&lt;/h3>&lt;blockquote>
&lt;p>下面的命令 要一次性输入&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cat&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ipsec&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">env&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Define your own values for these variables&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - DO NOT put &amp;#34;&amp;#34; or &amp;#39;&amp;#39; around values, or add space around =&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - DO NOT use these special characters within values: \ &amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># psk密钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VPN_IPSEC_PSK&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">密钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置用于登陆VPN的账号和密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VPN_USER&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">主用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VPN_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">主用户名的密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如下应该填写本机的外网IP 不强制&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># VPN_PUBLIC_IP=10.1.1.45&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (Optional) Define additional VPN users&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - Uncomment and replace with your own values&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - Usernames and passwords must be separated by spaces&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置额外的用户名和密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VPN_ADDL_USERS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">用户&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="err">用户&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VPN_ADDL_PASSWORDS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">用户&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="err">的密码&lt;/span> &lt;span class="err">用户&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="err">的密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (Optional) Use alternative DNS servers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - By default, clients are set to use Google Public DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - Example below shows using Cloudflare&amp;#39;s DNS service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VPN_DNS_SRV1&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">VPN_DNS_SRV2&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">223.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="启动docker">启动docker
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name ipsec --network=host \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --env-file /root/ipsec.env \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --restart=always \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v ikev2-vpn-data:/etc/ipsec.d \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /lib/modules:/lib/modules:ro \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 500:500/udp \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 4500:4500/udp \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -d --privileged \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hwdsl2/ipsec-vpn-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看状态">查看状态
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker exec -it ipsec ipsec status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看用户链接">查看用户链接
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker exec -it ipsec ipsec whack --trafficstatus
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="测试和公网访问">测试和公网访问
&lt;/h3>&lt;p>主路由上 或者 dmz上，创建 端口映射 500 和4500 两个端口的 udp即可。&lt;/p>
&lt;h3 id="备份">备份
&lt;/h3>&lt;p>lxc 容器，直接在pve后台备份即可&lt;/p>
&lt;h3 id="更多">更多
&lt;/h3>&lt;p>查看作者的：https://github.com/hwdsl2/docker-ipsec-vpn-server/blob/master/docs/advanced-usage-zh.md&lt;/p></description></item><item><title>pve下虚拟机kvm转lxc docker转lxc 正在运行的虚拟机也可以， 以及lxc和docker kvm之间的对比</title><link>https://dev.leiyanhui.com/pve/kvm-to-lxc/</link><pubDate>Fri, 03 Feb 2023 12:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/pve/kvm-to-lxc/</guid><description>&lt;p>如果是linux 不需要显示屏显示的话，建议lxc运行。&lt;/p>
&lt;h3 id="对比">对比
&lt;/h3>&lt;h4 id="lxc-和-虚拟机kvm对比">lxc 和 虚拟机kvm对比
&lt;/h4>&lt;p>lxc没办法支持 macos win 以及黑群晖 爱快等非常规系统，支持常见linux类服务，支持嵌套docker&lt;br>
lxc 支持热备份&lt;br>
lxc 性能更高，几乎就是原声性能，尤其是是需要硬件的服务，例如 openwrt jellyfin 等差距很大&lt;br>
kvm多了一层转换，性能略低于lxc，部分情况下差距很大！ 例如 openwrt&lt;/p>
&lt;h4 id="lxc-和-docker-对比">lxc 和 docker 对比
&lt;/h4>&lt;p>lxc 和docker 差不多。&lt;br>
lxc 没有分层文件系统，在频繁需要修改东西上。比如数据库，openwrt这种经常修改配置的服务上，更适合。&lt;br>
lxc 可以在创建完成后 修改挂载 甚至不需要中断服务&lt;br>
lxc 在pve上 约等于一个独立的 linux虚拟机，比docker的更完整&lt;br>
pve上的lxc 在网络配置上可以直接使用桥接接入宿主机器物理网络&lt;br>
lxc 可以独立且简单方便的嵌套docker &lt;br>
docker 优势：更多的原始镜像的支持&lt;br>
但是在pve下 因为自带lxc的支持，所以能用lxc跑的 就不要麻烦docker了。 实要用docker 可以 lxc套docker 或者 pve直接装docker 都可以。&lt;/p>
&lt;blockquote>
&lt;p>lxc 有一个小小的缺点： 无特权容器 外挂目录有权限问题要处理否则只能只读，特权容器跑docker有一点点问题，需要额外处理。你可以在本站找到相关教程。&lt;/p>&lt;/blockquote>
&lt;h4 id="pve官网建议">pve官网建议
&lt;/h4>&lt;p>原文&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">If you want to run application containers, for example, Docker images, it is recommended that you run them inside a Proxmox Qemu VM. This will give you all the advantages of application containerization, while also providing the benefits that VMs offer, such as strong isolation from the host and the ability to live-migrate, which otherwise isn’t possible with containers.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>大概就是说 vm跑docker 迁移性和强制隔离效果更好。&lt;br>
实际使用中，你会发现 lxc套docker 一个lxc 跑一个alpine 套1-N个更方便。一些家用必须有的服务，比如 ipsec nginx反代&lt;/p>
&lt;h3 id="关于lxc-导入的格式">关于lxc 导入的格式
&lt;/h3>&lt;p>就是带权限的压缩包，比如 tar gz zst等格式。所以 无论原始是什么，我们只要最终 打包文件就可以了。&lt;/p>
&lt;h3 id="虚拟机">虚拟机
&lt;/h3>&lt;p>虚拟机如果可以关机的话，直接转换原来磁盘文件为img即可，qcow2 也可以直接在pve下挂载，下面以img为例。 其他格式 包括 vmware 和 virtualbox的 都可以转换。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mkdir&lt;/span> &lt;span class="n">op&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">root_partition&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="err">`&lt;/span>&lt;span class="n">fdisk&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">l&lt;/span> &lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">img&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="o">.&lt;/span>&lt;span class="n">img2&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">awk&lt;/span> &lt;span class="s1">&amp;#39;{print $2}&amp;#39;&lt;/span>&lt;span class="err">`&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">512&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mount&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">loop&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">offset&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="n">root_partition&lt;/span> &lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">img&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">op&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="n">op&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">tar&lt;/span> &lt;span class="n">zcf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="n">cd&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="c1"># 打包至PVE中LXC模板路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">umount&lt;/span> &lt;span class="n">op&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="n">op&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm -rf 固件名称.img&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最终拿到压缩包 op.tar.gz，然后就可以直接在pve 创建ct容器了。&lt;/p>
&lt;p>如果是 openwrt等系统，可能还需要另外处理一下。 参考：https://dev.leiyanhui.com/openwrt/pve-lxc-install-op/&lt;/p>
&lt;h3 id="正在运行的虚拟机">正在运行的虚拟机
&lt;/h3>&lt;p>如果是pve的话，直接备份，然后 再导入到虚拟机，然后再处理磁盘即可。&lt;/p>
&lt;p>参考：https://dev.leiyanhui.com/openwrt/pve-lxc-install-op/&lt;/p>
&lt;h3 id="docker的话直接导出">docker的话，直接导出
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">save&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">centos&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">tar&lt;/span> &lt;span class="n">centos&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">latest&lt;/span> &lt;span class="c1">#将centos:latest 镜像导出 为centos. tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">go&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">codeserver&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">git&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span> &lt;span class="c1"># 将正在运行的容器 不保留历史记录 直接导出&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>部分容器 导出的后的 压缩包不能直接导入到lxc，建议 lxc 嵌套docker&lt;/p>&lt;/blockquote></description></item><item><title>pve下以lxc模式运行openwrt</title><link>https://dev.leiyanhui.com/openwrt/pve-lxc-install-op/</link><pubDate>Fri, 03 Feb 2023 04:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/pve-lxc-install-op/</guid><description>&lt;blockquote>
&lt;p>本文是旁路路由模式，主路由模式 请浏览 ： &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/lxc-mian-op/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/lxc-mian-op/&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>pve 没有默认docker，需要单独安装。通常不推荐这样做。原因是那个&lt;code>尽量不动pve自身的原则&lt;/code>。一般在大量使用容器的情况下，采用lxc 开启一个debian11，然后在里面安装docker。 或者干脆开一个 alpine虚拟机。&lt;/p>
&lt;p>那么openwrt 因为要接管我们网络的网关，最好在一个独立的容器里面运行。
用虚拟机方式跑openwrt ，在内网没人下载东西的时候，它依旧会吃相当一部分cpu，所以还是用lxc方式合适，其性能就是你物理机的性能&lt;/p>
&lt;p>另外lxc 没有docker的层概念，所以非常适合运行这种独立的服务！&lt;/p>
&lt;h2 id="获取openwrt的-rootfs">获取openwrt的 rootfs
&lt;/h2>&lt;p>我这里是自己编译的，如果你有这个需求，可以联系我编译。也可以用官网版本（新手不建议，坑多）&lt;/p>
&lt;h3 id="代编译说明-直接拿到targz包">代编译说明 直接拿到tar.gz包
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/diy" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/diy&lt;/a>&lt;/p>
&lt;h3 id="原有镜像转lxc">原有镜像转lxc
&lt;/h3>&lt;h4 id="转换为img">转换为img
&lt;/h4>&lt;h5 id="qcow2vmdk">qcow2/vmdk
&lt;/h5>&lt;p>如果原来镜像是 qcow2 vmdk&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">qemu-img convert -p -f qcow2 -O raw op.qcow2 op.img
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qemu-img convert -p -f vmdk -O raw op.vmdk op.img
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="imggz">img.gz
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">gzip -d openwrt-01.10.2023-x86-64-generic-squashfs-combined.img.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="正在运行的虚拟机openwrt转lxc">正在运行的虚拟机openwrt转lxc
&lt;/h5>&lt;p>直接在pve web控制台点备份，选择 gzip格式 ,得到文件 &lt;code>/var/lib/vz/dump/vzdump-qemu-100-2023_02_03-12_29_56.vma.gz&lt;/code>&lt;/p>
&lt;p>在 local 备份里面 找到这个文件 点恢复 导入到一个新虚拟机 102&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">qemu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">img&lt;/span> &lt;span class="nb">convert&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="n">qcow2&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">O&lt;/span> &lt;span class="n">raw&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">images&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">102&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">102&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">disk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">0.&lt;/span>&lt;span class="n">qcow2&lt;/span> &lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">img&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="挂载和打包">挂载和打包
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mkdir&lt;/span> &lt;span class="n">op&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">root_partition&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="err">`&lt;/span>&lt;span class="n">fdisk&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">l&lt;/span> &lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">img&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="o">.&lt;/span>&lt;span class="n">img2&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">awk&lt;/span> &lt;span class="s1">&amp;#39;{print $2}&amp;#39;&lt;/span>&lt;span class="err">`&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">512&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mount&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">loop&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">offset&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="n">root_partition&lt;/span> &lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">img&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">op&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="n">op&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">tar&lt;/span> &lt;span class="n">zcf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="n">cd&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="c1"># 打包至PVE中LXC模板路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">umount&lt;/span> &lt;span class="n">op&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="n">op&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm -rf 固件名称.img&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>如果img是正在运行的系统且使用的Overlay模式，会丢失Overlay内容（恢复默认了）。你需要在原来系统里面 导出 后覆盖过来。&lt;/p>&lt;/blockquote>
&lt;h3 id="上传lxc">上传lxc
&lt;/h3>&lt;p>上传到 local节点 ct模板 op.tar.gz 后面操作都基于local和这个文件名。&lt;/p>
&lt;h2 id="创建ct容器">创建CT容器
&lt;/h2>&lt;p>直接在pve里面创建 会提示 &lt;code>unknown ID 'openwrt' in /etc/os-release file, trying fallback detection TASK ERROR: unable to create CT 2000 - unable to detect OS distribution&lt;/code> 这样的错误，我们需要修改ostype，这在pve的webui里面是无法是实现的。
登录 pve shell 命令 创建 2000 使用上面的rootfs 磁盘和内存 cpu 也配置一下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">pct&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="mi">2000&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vz&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">op&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">arch&lt;/span> &lt;span class="n">amd64&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">hostname&lt;/span> &lt;span class="n">lxc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">OpenWrt&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">rootfs&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">memory&lt;/span> &lt;span class="mi">2048&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">swap&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">cores&lt;/span> &lt;span class="mi">12&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">ostype&lt;/span> &lt;span class="n">unmanaged&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">unprivileged&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">net0&lt;/span> &lt;span class="n">bridge&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">vmbr0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">eth0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>--rootfs local:2 &lt;/code> 代表放到 local 2g大小&lt;/p>
&lt;blockquote>
&lt;p>你需要根据你的情况修改上面命令的部分内容，btrfs 的话路径是&lt;code>/var/lib/pve/local-btrfs/template/cache/&lt;/code>&lt;/p>&lt;/blockquote>
&lt;h3 id="网络配置">网络配置
&lt;/h3>&lt;p>创建 添加网卡&lt;/p>
&lt;p>我这里是做旁路由使用，如果你做主路由用，还需要把映射 /dev/ppp 以及分配额外的网卡过来。 一般不建议 aio平台跑主路由哈。&lt;/p>
&lt;h3 id="启动">启动
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pct start 2000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="其他操作">其他操作
&lt;/h3>&lt;p>如果你是用的别人编译的 或者官网的，还需要去容器里面 修改一下ip，如果是定制版本的 直接就可以开始用了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc-attach 2000 # 进入容器终端
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="其他常见问题">其他常见问题
&lt;/h3>&lt;h4 id="luci-static-错误">luci-static 错误
&lt;/h4>&lt;p>部分固件提示：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Function statements require a function name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> in http://10.1.1.20/luci-static/resources/network.js?v=git-94eb2a9:?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at http://10.1.1.20/luci-static/resources/luci.js?v=git-24.033.44588-94eb2a9:179:29
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> at async Promise.all (index 4)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>固件本身的问题 换固件。&lt;/p>
&lt;h4 id="ssh无法登录">ssh无法登录
&lt;/h4>&lt;p>固件问题&lt;/p>
&lt;h4 id="ipsec无法链接的问题">ipsec无法链接的问题
&lt;/h4>&lt;p>问题不明，最佳方案，单独一个lxc/docker 运行 ipsec 详情： &lt;a class="link" href="https://dev.leiyanhui.com/pve/ipsec" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/ipsec&lt;/a>&lt;/p></description></item><item><title>openwrt定制说明</title><link>https://dev.leiyanhui.com/openwrt/diy/</link><pubDate>Wed, 01 Feb 2023 02:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/diy/</guid><description>&lt;h3 id="特色">特色
&lt;/h3>&lt;ul>
&lt;li>可以后台一键安装市面上有的任何插件，可以内置你常用插件。 不用你自己搜ipk包上传&lt;/li>
&lt;li>有很多可以自由定制项&lt;/li>
&lt;li>基于最近源码构建，每日同步3次官方库&lt;/li>
&lt;/ul>
&lt;h3 id="支持平台">支持平台
&lt;/h3>&lt;ul>
&lt;li>市面上多数主流可以刷机的硬路由&lt;/li>
&lt;li>vmware esxi镜像&lt;/li>
&lt;li>pve unraid镜像&lt;/li>
&lt;li>群晖等nas和爱快的vm镜像&lt;/li>
&lt;li>docker镜像&lt;/li>
&lt;li>lxc镜像&lt;/li>
&lt;/ul>
&lt;h3 id="硬路由注意事项">硬路由注意事项
&lt;/h3>&lt;p>部分硬路由 需要先刷 &lt;code>不死uboot&lt;/code> 或者解锁ssh等，请提前处理好，需要我远程代为处理的，需要提供 额外的网络环境（另外一个路由 或者手机热点）
太古老的路由器可能不支持了，因为最新的op对芯片要求和十年前已经不太一样&lt;/p>
&lt;h3 id="支持的定制项目">支持的定制项目
&lt;/h3>&lt;ul>
&lt;li>插件自选（详情查看后文）&lt;/li>
&lt;li>默认ip &lt;code>10.0.0.1&lt;/code>&lt;/li>
&lt;li>默认root密码 &lt;code>root&lt;/code>&lt;/li>
&lt;li>ipv6 默认是否开启 &lt;code>关闭&lt;/code>&lt;/li>
&lt;li>是否内置ppoe宽带帐号 &lt;code>dhcp&lt;/code>&lt;/li>
&lt;li>默认主题 &lt;code>argon&lt;/code>&lt;/li>
&lt;li>Web服务器 &lt;code>nginx/uhttpd&lt;/code>&lt;/li>
&lt;li>默认旁路由模式 &lt;code>否&lt;/code> （详情查看后文）&lt;/li>
&lt;li>wifi帐号密码 &lt;code>openwrt/无密码&lt;/code>&lt;/li>
&lt;li>防火墙 &lt;code>firewall&lt;/code> （可选nftables）&lt;/li>
&lt;li>端口转发 &lt;code>firewall 不叠加socat&lt;/code> (socat支持ipv6转v4)&lt;/li>
&lt;li>主机名 &lt;code>opwnert&lt;/code> （可以修改为指定的名称）&lt;/li>
&lt;li>自定义签名 &lt;code>dev.leiyanhui.com&lt;/code>&lt;/li>
&lt;li>固件版本 主机名称 日期 by 签名 / LuCI Master git-*&lt;/li>
&lt;li>每次初始化自定义shell脚本 &lt;code>无&lt;/code>&lt;/li>
&lt;li>x86/vm软路由平台可以选 Overlay分区容量（0.5-6G），磁盘格式&lt;code>SquashFS/EXT4&lt;/code>&lt;/li>
&lt;li>x86 可选EFI或Legacy&lt;/li>
&lt;/ul>
&lt;h3 id="关于插件自选">关于插件自选
&lt;/h3>&lt;p>如果不选择任何插件，就是一个干净整洁的openwrt 你稍后可以自行在后台可视化一键安装插件&lt;br>
如果不懂，可以一次性告诉我你的需求，我来帮你选择。&lt;/p>
&lt;h4 id="常见插件需求">常见插件需求
&lt;/h4>&lt;p>每个人需求不同，常用插件包已经有9千多个，这里按照分类，你自己说清具体软件名称，或者需求&lt;/p>
&lt;ul>
&lt;li>NAS类/网盘类（抛砖：alist rclone istorage nastools vm-群晖等 ）&lt;/li>
&lt;li>影音解码类 （抛砖：docker处理 等）&lt;/li>
&lt;li>docker 虚拟机类&lt;/li>
&lt;li>远程控制类 （抛砖：ddnsto frpc rustdesk 端口转发 等）&lt;/li>
&lt;li>内网穿透类 （抛砖：ddnsto frpc ipv6映射等）&lt;/li>
&lt;li>学习类（抛砖：*** ）&lt;/li>
&lt;li>内网服务类 （抛砖：端口转发，内网反代，宝塔，nginx-proxy等）&lt;/li>
&lt;/ul>
&lt;h3 id="附加收费">附加收费
&lt;/h3>&lt;p>技术栈：&lt;code>linux winsServer ios开发 ios签名 nginx golang php pythone node.js openwrt 爱快 黑群晖 黑苹果 kvm pve unraid vmware/hyper-v/virtualbox&lt;/code>&lt;/p></description></item><item><title>padaven 固件端口转发配置无效的问题</title><link>https://dev.leiyanhui.com/openwrt/padaven-port-rule/</link><pubDate>Tue, 31 Jan 2023 11:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/padaven-port-rule/</guid><description>&lt;p>具体表现，padaven路由器打开允许外网访问，外网可以访问到路由器web管理界面。然后端口转发的内网的服务器 均无法访问。&lt;br>
有人说是网关问题，测试后发现 应该就是 固件的bug，修改端口转发协议也无效。。。&lt;/p>
&lt;p>因为我内网还有一个旁路由，所以 干脆就不辛苦这个10年老古董的k2p（padaven）了，开dmz 到旁路由，端口转发转移到旁路由来处理。。。&lt;/p>
&lt;p>因为我这个旁路由 性能过得去，所以这里也就干脆 用 Socat 在旁路由上处理了。&lt;/p>
&lt;p>Socat 的优点，设置简单，支持ipv6 ipv4 缺点：比防火墙转发更加消耗cpu性能，不适合太低配置的路由器使用。&lt;/p>
&lt;p>也可以用op自带的防火墙&lt;/p></description></item><item><title>我的all in one 以及路由器 nas 的纠结和最终的方案</title><link>https://dev.leiyanhui.com/all-in-one/my-jiujie/</link><pubDate>Tue, 31 Jan 2023 11:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/my-jiujie/</guid><description>&lt;h2 id="设备情况如下">设备情况如下：
&lt;/h2>&lt;p>1、AP： 小米路由器 AP 2个 1个是访客网络 一个是北厂区的AP，还有一个K2P 在用
2、x86 ： 两台 一个i7 8850h 装的pve 另外一个是信步的N2600 装的openwrt
3、终端：几十个2.4G的物联网设备 14个ppoe监控 监控硬盘机 手机 笔记本若干&lt;/p>
&lt;p>一直没扔的k2p 是因为他的2.4G信号很稳，适合物联网设备覆盖。之前也是拿他当作主路由使用了10多年。&lt;/p>
&lt;p>一直以来的纠结 就是 软路由和 pve 的功能重叠，以及信步这个板子的一些问题。&lt;/p>
&lt;h2 id="纠结的地方">纠结的地方
&lt;/h2>&lt;h3 id="关于-信步这个板子">关于 信步这个板子
&lt;/h3>&lt;p>断电后偶尔会出现不能自动启动，另外N2600 不支持虚拟化，自带显卡也无法在linux下驱动 这就导致很多限制。&lt;/p>
&lt;p>还是想去掉他，卖掉的钱还能换一个 1-2T矿场硬盘。&lt;/p>
&lt;h3 id="路由的思考">路由的思考
&lt;/h3>&lt;p>在不添加新硬件（穷）的情况下，想用靠谱的网络。 最终的解决方案 可能还是 旁路由（旁网关）方案。
我的k2p 在不跑科学软件的情况下，实际是可以跑满带宽，内网有交换机不需要他。驼子里面拔将军，还是尝试用他做主路由。然后再尝试指定ip的网关到pve上的旁路由。
这就需要，k2p刷的固件的dhcp支持这个功能.&lt;br>
因为 运行pve的aio本身是不需要科学的。 为了全局科学（物联网设备可以在openwrt排除） 考虑方案如下&lt;/p>
&lt;h3 id="新方案">新方案
&lt;/h3>&lt;p>尽量不影响现有设备的情况下快速平滑过度。&lt;/p>
&lt;h4 id="k2p-固件">k2p 固件
&lt;/h4>&lt;p>k2p 是肯定不能刷爱快的，硬改后可以但是不少人说内网都会掉到500M。剩下的就是高ge 官改 openwrt 和 Padavan。&lt;br>
openwrt 熟悉很多，但是padaven 有人说 是可以跑满1000M 的，而openwrt 不太清楚，本着能用就行的态度。我决定 还是 用 padaven ，只是dhcp静态绑定的迁移有一点麻烦。两者的配置文件不通用。&lt;/p>
&lt;h4 id="旁路由网关">旁路由网关
&lt;/h4>&lt;p>系统肯定是op了。 用pve的虚拟机跑吧 省心。然后除了跑openclash ipsec 其他基本都不需要。dhcp也暂定关掉。&lt;/p>
&lt;h4 id="最重要的-自动网关文末">最重要的： 自动网关（文末）
&lt;/h4>&lt;p>因为我主路由受固件限制无法指定部分设备走旁路由网关，手动处理确实也比较麻烦，并且我需要 新设备加入后可以自动科学 ipsec拨进来的设备也可以。 所以打算在主路由上定时（1分钟）ping一下旁路由，如果不通，那么就把dhcp的网关切换回主路由，并重启 dhcp服务器。
另外 dhcp的生命周期也尽可能短一些 这样才能尽快生效。 （虽然对padaven不熟悉，但是好在他也提供ssh的，总可以搞定。 ）&lt;br>
这样就完美实现了，全局都走科学，部分不需要科学的设备，单独从openclash里面用规则处理掉即可。&lt;/p>
&lt;p>这样带来的好处就是 ，无论怎么折腾 主路由都可以提供基本的上网服务。旁路由上线 后 就提供科学和ipsec等。&lt;/p>
&lt;h4 id="小问题的处理">小问题的处理
&lt;/h4>&lt;h5 id="padaven-的内置ddns">padaven 的内置ddns
&lt;/h5>&lt;p>不支持我常用的3322（自定义可以） 和 dnspod 以及 cloudfare， 暂时注册一个它支持的，然后用cname解决。&lt;/p>
&lt;h5 id="padaven-的静态dhcp的备份">padaven 的静态dhcp的备份
&lt;/h5>&lt;p>喜欢备份是一个好习惯。。 系统管理 - 配置管理 直接备份&lt;/p>
&lt;h5 id="padaven--的ipv6">padaven 的ipv6
&lt;/h5>&lt;p>可以开启 ，以及 padaven 详情：https://www.jianshu.com/p/cb51fb0fb2ac&lt;/p>
&lt;h5 id="padaven-p段的迁移">padaven p段的迁移
&lt;/h5>&lt;p>之前的ip段是10.1.1.1 自定义的op固件，但padaven 默认的ip&lt;/p>
&lt;h5 id="vlmcsd">vlmcsd
&lt;/h5>&lt;p>padaven 有自带&lt;/p>
&lt;h5 id="alist">alist
&lt;/h5>&lt;p>挪到pve里面，单独一个容器/vm运行&lt;/p>
&lt;h5 id="nginxwebui">nginxWebUI
&lt;/h5>&lt;p>挪到pve里面，单独一个容器/vm运行&lt;/p>
&lt;h5 id="rustdesk服务">rustdesk服务
&lt;/h5>&lt;p>挪到pve里面，单独一个容器/vm运行&lt;/p>
&lt;h5 id="内网穿透">内网穿透
&lt;/h5>&lt;p>因为我有公网ip所以不需要其他穿透，仅需要80个443的穿透映射。
pve 和 路由器的 web界面 用 ddnsto 直接弄 简单省心。
3389 之类的端口可以直接用不费心。
80和443端口穿透 有两个解决，是备案过的域名 用 腾讯cdn穿透，未备案的域名用cloudfare穿透&lt;br>
一些应用级的，直接用非标端口解决&lt;/p>
&lt;h5 id="端口转发">端口转发
&lt;/h5>&lt;p>怎么都没想到，会在端口转发的上遇到问题 padaven 的固件的端口转发竟然有问题。&lt;br>
临时解决方案：dmz 到旁路由，在旁路由上 直接上 socat&lt;/p>
&lt;h5 id="pve的自动备份">pve的自动备份
&lt;/h5>&lt;p>qm stop 后，直接cp磁盘出来。&lt;/p>
&lt;h5 id="nas的处理">nas的处理
&lt;/h5>&lt;p>暂时用黑群晖简单很多，核心数据定时导出备份，影片等数据外挂直通的矿渣机械盘&lt;/p>
&lt;h4 id="自动检测旁路由脚本">自动检测旁路由脚本
&lt;/h4>&lt;p>实现：全局科学，去广告等，外网可以用ipsec协议链回家并科学。指定ip段 禁止科学。
旁路由离线后1-2分钟内，全局改为普通模式上网。 旁路由上限后 自动恢复。
&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/auto-change-gatway" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/auto-change-gatway&lt;/a>&lt;/p></description></item><item><title>openwrt回收（释放）已经分出去的dchp的ip地址</title><link>https://dev.leiyanhui.com/openwrt/del-dhcp/</link><pubDate>Fri, 27 Jan 2023 11:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/del-dhcp/</guid><description>&lt;p>打开 &lt;code>/tmp/dhcp.leases&lt;/code> 删除想要回收的那行，然后重启dhcp &lt;code>/etc/init.d/dnsmasq restart&lt;/code>
文件也可以完全清空&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm -rf /tmp/dhcp.leases &amp;amp;&amp;amp; touch /tmp/dhcp.leases
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dnsmasq restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重新在op里面静态分配绑定好地址，然后重启对应机器的dhcp客户端服务即可 或者干脆重启客户端机器，或者重新链接wifi或者网线 均可&lt;/p>
&lt;blockquote>
&lt;p>这个文件的地址，在路由的 网络&amp;gt; dhcp &amp;gt; host和解析文件 ：租约文件 是可以看到的。&lt;/p>&lt;/blockquote></description></item><item><title>openwrt 定制版本 我自用的版本- kvm版本</title><link>https://dev.leiyanhui.com/openwrt/kvm-my/</link><pubDate>Tue, 24 Jan 2023 02:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/kvm-my/</guid><description>&lt;p>尝试在 单网口的 all in one 主机上 使用kvm运行 openwrt 实现替代一个x86软路由的方案。 &lt;br>
为什么 要吧路由器放到 aio主机上，是因为想节省一台设备 避免维护复杂化。 为了避免 all in boom，单独找了一个闲置小米路由，配置好dhcp静态分配和ppoe 作为备用路由器。&lt;/p>
&lt;p>硬件设备：&lt;/p>
&lt;ul>
&lt;li>光猫 桥接模式&lt;/li>
&lt;li>硬路由 k2p 信号不错，但是性能不够，所以做AP模式&lt;/li>
&lt;li>交换机 4口万兆 8口千兆&lt;/li>
&lt;li>16口poe交换机 和监控若干&lt;/li>
&lt;li>组装机一台 24小时开机，qnct魔改U 8代4核，64G内存 pio主板 带一个pice口 单网卡 nvme硬盘512G 机械盘 4块 加起来 5T
软件情况：&lt;/li>
&lt;li>硬路由 k2p 刷 Padavan&lt;/li>
&lt;li>all in one主机，自己做的 ventoy+ archlinux+docker+kvm系统 &lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/arch-aio/&lt;/a>&lt;br>
all in one系统情况：&lt;br>
主要跑三个系统 win archlinux/kde（kvm） 直通macos win主要做rdp转发和游戏串流 日用 archlinux&lt;/li>
&lt;/ul>
&lt;h2 id="编译适合主机的openwrt">编译适合主机的openwrt
&lt;/h2>&lt;h3 id="核心软件包">核心软件包
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">autocore&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86&lt;/span> &lt;span class="n">automount&lt;/span> &lt;span class="n">base&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">files&lt;/span> &lt;span class="n">bash&lt;/span> &lt;span class="n">block&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mount&lt;/span> &lt;span class="n">busybox&lt;/span> &lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bundle&lt;/span> &lt;span class="n">coremark&lt;/span> &lt;span class="n">curl&lt;/span> &lt;span class="n">dnsmasq&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">full&lt;/span> &lt;span class="n">dropbear&lt;/span> &lt;span class="n">ds&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lite&lt;/span> &lt;span class="n">e2fsprogs&lt;/span> &lt;span class="n">fdisk&lt;/span> &lt;span class="n">firewall&lt;/span> &lt;span class="n">fstools&lt;/span> &lt;span class="n">grub2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bios&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">setup&lt;/span> &lt;span class="n">htop&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8139&lt;/span>&lt;span class="n">cp&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8139&lt;/span>&lt;span class="n">too&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alx&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amazon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ena&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">xgbe&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bnx2&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bnx2x&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">button&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hotplug&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">drm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amdgpu&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">drm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i915&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">e1000&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">e1000e&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">forcedeth&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vfat&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i40e&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">iavf&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">igb&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">igbvf&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">igc&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">nat&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">nat6&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ixgbe&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">zstd&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mlx4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mlx5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mmc&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pcnet32&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">phy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">broadcom&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r8125&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r8168&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sdhci&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tcp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bbr&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tg3&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tulip&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">usb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hid&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vmxnet3&lt;/span> &lt;span class="n">libc&lt;/span> &lt;span class="n">libgcc&lt;/span> &lt;span class="n">libustream&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">wolfssl&lt;/span> &lt;span class="n">lm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sensors&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">detect&lt;/span> &lt;span class="n">logd&lt;/span> &lt;span class="n">lsblk&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">advanced&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">autoreboot&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">firewall&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">gpsysupgrade&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">opkg&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">upnp&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">wizard&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">compat&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fs&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipkg&lt;/span> &lt;span class="n">mkf2fs&lt;/span> &lt;span class="n">mtd&lt;/span> &lt;span class="n">nano&lt;/span> &lt;span class="n">netifd&lt;/span> &lt;span class="n">odhcp6c&lt;/span> &lt;span class="n">odhcpd&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipv6only&lt;/span> &lt;span class="n">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sftp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span> &lt;span class="n">opkg&lt;/span> &lt;span class="n">partx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">utils&lt;/span> &lt;span class="n">pciutils&lt;/span> &lt;span class="n">ppp&lt;/span> &lt;span class="n">ppp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pppoe&lt;/span> &lt;span class="n">procd&lt;/span> &lt;span class="n">procd&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">seccomp&lt;/span> &lt;span class="n">resolveip&lt;/span> &lt;span class="n">swconfig&lt;/span> &lt;span class="n">uci&lt;/span> &lt;span class="n">uclient&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fetch&lt;/span> &lt;span class="n">urandom&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">seed&lt;/span> &lt;span class="n">urngd&lt;/span> &lt;span class="n">usbutils&lt;/span> &lt;span class="n">wget&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssl&lt;/span> &lt;span class="n">zram&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">swap&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="附加软件包">附加软件包
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">luci-app-socat luci-app-ipsec-vpnd luci-app-ddns luci-app-diskman luci-app-ksmbd luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>去掉了docker 和alist等 增加了 openclash&lt;/p>
&lt;h3 id="其他配置">其他配置
&lt;/h3>&lt;ul>
&lt;li>内置ppoe帐号&lt;/li>
&lt;li>ip 改为 10.1.0.1&lt;/li>
&lt;li>初始密码： &lt;code>dev.leiyanhui.com&lt;/code>&lt;/li>
&lt;li>主机名称 kvm-op&lt;/li>
&lt;li>根目录(Overlay)容量(M) : 512M 因为不打算用他跑太多东西了。所以512M足够了。&lt;/li>
&lt;/ul>
&lt;h2 id="创建op虚拟主机">创建op虚拟主机
&lt;/h2>&lt;p>12核 512M内存。
cd /home/yanhui/mnt/nvme/vdisk/
qemu-img convert -p -f ram -O qcow2 openwrt-01.24.2023-x86-64-generic-squashfs-combined.img op.qcow2&lt;/p>
&lt;p>创建 虚拟主机 12核 1G内存。 注意要另外添加一个虚拟网卡给这个虚拟机。都是走桥接，arch-aio 桥接问题看 &lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/&lt;/a>&lt;/p>
&lt;h2 id="更改物理布局">更改物理布局
&lt;/h2>&lt;p>光猫 -&amp;gt; 交换机 -&amp;gt; arch-aio主机 去掉 原来的n2600的op&lt;/p>
&lt;h3 id="后续">后续
&lt;/h3>&lt;p>可能会尝试 用docker来跑 openwrt 作为主路由&lt;/p></description></item><item><title>openwrt 定制版本 我自用的版本</title><link>https://dev.leiyanhui.com/openwrt/my/</link><pubDate>Fri, 13 Jan 2023 02:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/my/</guid><description>&lt;h2 id="概述">概述
&lt;/h2>&lt;p>这是我目前 2023-01-14 自用的版本，尽可能的极致精简，集成了常用必备插件。&lt;/p>
&lt;h2 id="基本说明">基本说明
&lt;/h2>&lt;p>ip：&lt;code>10.1.1.1&lt;/code>&lt;br>
用户名：&lt;code>root&lt;/code>&lt;br>
密码：&lt;code>dev.leiyanhui.com&lt;/code>
luci环境：nginx
ipv6支持，ipv6端口转发支持，墙体内外分流全局doh &lt;br>
默认开ppoe有内置我自己的宽带账号，自己改成你自己的即可(&lt;em>) &lt;br>
没有内置任何usb网卡 驱动和WiFi驱动。(&lt;/em>) &lt;br>
默认主题：argon 漂亮不花哨&lt;br>
~~ 使用Firewall4(nftables)~~ &lt;br>
根目录(Overlay)容量 2048M &lt;br>
内核版本：5.15.86&lt;br>
平台：x86/64&lt;br>
支持用ventoy启动&lt;/p>
&lt;blockquote>
&lt;p>其他插件尽量能docker允许的尽量docker。这是一个稳定的软路由器的基本使用习惯。&lt;br>
同容量的Overlay 系统升级，不会丢失Overlay 分区之外的数据&lt;/p>&lt;/blockquote>
&lt;h2 id="基本使用">基本使用
&lt;/h2>&lt;p>下载后，直接用balenaEtcher写盘即可。 或者用ventoy的openwrt工具解压后启动。 &lt;br>
支持efi 和 Legacy ，VMware/esxi/pve/unraid/kvm ，docker/lxc 启动&lt;br>
或者在你路由器后台直接上传下载的gz包&lt;br>
使用步骤 概述 &lt;code>https://dev.leiyanhui.com/openwrt/my_use&lt;/code>&lt;/p>
&lt;h2 id="下载地址">下载地址
&lt;/h2>&lt;p>因为带了docker，所以体积较大（120M+）
暂时删除下载连接.联系joyanhui@qq.com免费索取&lt;/p>
&lt;h2 id="软件包">软件包
&lt;/h2>&lt;h3 id="核心基础包">核心基础包
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">autocore&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86&lt;/span> &lt;span class="n">automount&lt;/span> &lt;span class="n">base&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">files&lt;/span> &lt;span class="n">bash&lt;/span> &lt;span class="n">block&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mount&lt;/span> &lt;span class="n">busybox&lt;/span> &lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bundle&lt;/span> &lt;span class="n">coremark&lt;/span> &lt;span class="n">curl&lt;/span> &lt;span class="n">dnsmasq&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">full&lt;/span> &lt;span class="n">dropbear&lt;/span> &lt;span class="n">ds&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lite&lt;/span> &lt;span class="n">e2fsprogs&lt;/span> &lt;span class="n">fdisk&lt;/span> &lt;span class="n">firewall&lt;/span> &lt;span class="n">fstools&lt;/span> &lt;span class="n">grub2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bios&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">setup&lt;/span> &lt;span class="n">htop&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8139&lt;/span>&lt;span class="n">cp&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8139&lt;/span>&lt;span class="n">too&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alx&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amazon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ena&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">xgbe&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bnx2&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bnx2x&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">button&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hotplug&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">drm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amdgpu&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">drm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i915&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">e1000&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">e1000e&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">forcedeth&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vfat&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i40e&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">iavf&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">igb&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">igbvf&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">igc&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">nat&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">nat6&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ixgbe&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">zstd&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mlx4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mlx5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">core&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mmc&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pcnet32&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">phy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">broadcom&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r8125&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r8168&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sdhci&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tcp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bbr&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tg3&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tulip&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">usb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hid&lt;/span> &lt;span class="n">kmod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vmxnet3&lt;/span> &lt;span class="n">libc&lt;/span> &lt;span class="n">libgcc&lt;/span> &lt;span class="n">libustream&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">wolfssl&lt;/span> &lt;span class="n">lm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sensors&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">detect&lt;/span> &lt;span class="n">logd&lt;/span> &lt;span class="n">lsblk&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">advanced&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">autoreboot&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">firewall&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">gpsysupgrade&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">opkg&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">upnp&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">wizard&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">compat&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fs&lt;/span> &lt;span class="n">luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipkg&lt;/span> &lt;span class="n">mkf2fs&lt;/span> &lt;span class="n">mtd&lt;/span> &lt;span class="n">nano&lt;/span> &lt;span class="n">netifd&lt;/span> &lt;span class="n">odhcp6c&lt;/span> &lt;span class="n">odhcpd&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ipv6only&lt;/span> &lt;span class="n">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sftp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span> &lt;span class="n">opkg&lt;/span> &lt;span class="n">partx&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">utils&lt;/span> &lt;span class="n">pciutils&lt;/span> &lt;span class="n">ppp&lt;/span> &lt;span class="n">ppp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mod&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pppoe&lt;/span> &lt;span class="n">procd&lt;/span> &lt;span class="n">procd&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">seccomp&lt;/span> &lt;span class="n">resolveip&lt;/span> &lt;span class="n">swconfig&lt;/span> &lt;span class="n">uci&lt;/span> &lt;span class="n">uclient&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fetch&lt;/span> &lt;span class="n">urandom&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">seed&lt;/span> &lt;span class="n">urngd&lt;/span> &lt;span class="n">usbutils&lt;/span> &lt;span class="n">wget&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssl&lt;/span> &lt;span class="n">zram&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">swap&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="附加包">附加包
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">luci-app-socat luci-app-ipsec-vpnd luci-app-alist luci-app-ddns luci-app-diskman luci-app-dockerman luci-app-ksmbd luci-app-rclone luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>大概说明&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">luci-app-socat # 端口转发工具 问题更少
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-ipsec-vpnd #仅ipsec 支持 ios 安卓原生连接，支持外网拨号进来后访问外网可走梯子 ios连接改个配置文件 https://dev.leiyanhui.com/openwrt/ipsec-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-alist # 网盘列表程序 以及转webdav
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-ddns # 动态dns 支持3322 aliyun等几乎所有ddns，支持ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-diskman #磁盘管理 和挂载工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-dockerman #docker 可视化管理工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-ksmbd # smb共享，内核级
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-rclone # 多网盘挂载程序，可以和alist配合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-ttyd #网页shell
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-vlmcsd #kms激活 自动启动自动激活内网win
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">luci-app-watchcat # 掉网重启检测
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uci-app-argon-config #argon主题配置
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="其他">其他
&lt;/h3>&lt;p>~~ luci-app-passwall2 : 支持doh 支持自定义分流 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/passwall2" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/passwall2&lt;/a> ~~ 学习工具后来不再打包进来是因为太多软件了各有特色还在摸索适合自己的。暂时是用的passwall2 后面可能会换openclash dns软件同理 &lt;br>
ipv6 支持
luci-app-socat 端口转发，支持ipv4 ipv6 ，用于替代自带的防火墙转发 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/ipv6-v4-port" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/ipv6-v4-port&lt;/a>&lt;/p>
&lt;h2 id="常见问题">常见问题
&lt;/h2>&lt;h3 id="端口转发">端口转发
&lt;/h3>&lt;p>请使用socat&lt;/p>
&lt;h3 id="整机备份和自动备份">整机备份和自动备份
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/backup" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/backup&lt;/a>&lt;/p>
&lt;h3 id="iphone连不上ipsec的vpn">iphone连不上ipsec的vpn
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/ipsec-server" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/ipsec-server&lt;/a>&lt;/p>
&lt;h3 id="ipsec的vpn的客户端无法访问外网">ipsec的vpn的客户端无法访问外网
&lt;/h3>&lt;p>参考上文&lt;/p>
&lt;h3 id="部分软件界面部分显示英文">部分软件界面部分显示英文
&lt;/h3>&lt;p>ctrl+F5 刷新一下浏览器缓存。&lt;/p>
&lt;h2 id="一点看法">一点看法
&lt;/h2>&lt;h3 id="关于集成的软件">关于集成的软件
&lt;/h3>&lt;p>ddns kms docker ipsec socat 这几个软件是我必用的 ，且非常适合我自己的,对我来说也是路由的核心。虽然可以自行安装，但是我日常备份系统，直接在线tar，所以为了减少备份文件体积，这里就预装了。如果你不需要可以自行卸载。或者找我定制均可。&lt;/p>
&lt;h3 id="关于x86平台插件和docker的选择">关于x86平台插件和docker的选择
&lt;/h3>&lt;p>x86软路由算是一个宿主机运行docker的低配版all in one，甚至包括我在内的很多人还会再docker上直接开nas 虚拟机等，为了避免all in boom（梗），宿主机的稳定性非常重要。但是linux系统原生的docker支持，不使用真的可惜。&lt;br>
比如 smartdns 这种会影响全局的功能，你插件安装，一个不小心可能就全家掉线了。但是你用docker跑，等调试测试完成后，再把ip或端口指向 就完事了。还有一些防火墙的调试配置等&lt;br>
其他必用的软件，比如 alist rclone smb acme nginx-proxy smartdns 等 还有一些pcdn收益软件 尽量能docker的不装插件。以牵扯宿主机机依赖，备份迁移都方便很多。&lt;br>
当然 硬路由等硬件资源受限的情况下，还是插件安装吧至少省很多储存空间。或者对docker不熟悉，感觉没图形界面方便，那么还是插件安装&lt;/p>
&lt;h3 id="关于overlay容量-为什么选择2g">关于Overlay容量 为什么选择2G
&lt;/h3>&lt;p>我是32G磁盘，但是依旧选择了 2G的Overlay，因为 &lt;br>
1、其他分区挂到/opt 后 ，单纯常用软件其实1G都勉强够用，但是折腾太多的话1G其实有点紧张。 &lt;br>
2、分区小了以后DD备份，刷入和迁移都方便 &lt;br>
3、即便是装上桌面系统2G 都够用了。何况还有docek可以跑桌面软件&lt;br>
所以权衡之下 overlay分区默认1.5-2G 较为合理&lt;/p>
&lt;h3 id="不用默认ip的原因">不用默认ip的原因
&lt;/h3>&lt;p>内网还有其他路由和下级ap 他们的默认固件的默认ip可能会导致冲突。所以这里不用10.0.0.1 192.168.31.1 或者192.168.1.1 &lt;br>
另外我的设备没有那么多, 肯定是254个设备以内的，所以也就不用多折腾了。&lt;/p></description></item><item><title>openwrt 定制版本 我自用的版本 - 使用</title><link>https://dev.leiyanhui.com/openwrt/my_use/</link><pubDate>Fri, 13 Jan 2023 02:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/my_use/</guid><description>&lt;h2 id="登录">登录
&lt;/h2>&lt;p>登录地址和密码参考 &lt;code>https://dev.leiyanhui.com/openwrt/my/&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>部分界面如果是英文，在浏览器里面按下 crtl+F5 就好了。&lt;/p>&lt;/blockquote>
&lt;h2 id="修改密码">修改密码
&lt;/h2>&lt;p>系统 - 管理权 修改&lt;/p>
&lt;h2 id="ddns配置">ddns配置
&lt;/h2>&lt;p>配置了一组 3322 的ipv4 一组 dnspods的v4和v6 ，配置很简单不用多说。 dnspods需要用token的id和key。&lt;br>
注意：ipv6地址的获取，可以用 &lt;code>lan&lt;/code> 口，默认wan口是获取不到的。如果配置好了 科学软件的情况下或者不使用科学上网，也可以用 url &lt;code>http://checkipv6.dyndns.com&lt;/code> 获取&lt;/p>
&lt;blockquote>
&lt;p>科学上网工具可能影响ipv6的使用 ，需要额外配置&lt;/p>&lt;/blockquote>
&lt;h2 id="配置-vpn">配置 vpn
&lt;/h2>&lt;p>参考 &lt;code>https://dev.leiyanhui.com/openwrt/ipsec-server/&lt;/code>&lt;/p>
&lt;h2 id="kms服务器">KMS服务器
&lt;/h2>&lt;p>不用配置，默认启动的。会自动激活内网的win，如果不能 自己找一个key手动激活。会自动续签。&lt;/p>
&lt;h2 id="alist挂载">alist挂载
&lt;/h2>&lt;p>略过&lt;/p>
&lt;h2 id="rclone挂载alist的webdav">rclone挂载alist的webdav
&lt;/h2>&lt;p>略过&lt;/p>
&lt;h2 id="挂载和扩容">挂载和扩容
&lt;/h2>&lt;p>我这里overlay分区比较大，2G。装日常插件足够了。甚至都可以装上桌面环境，但是如果跑kvm和太多docker 是肯定不够的。所以新建一个分区挂载到/opt&lt;br>
点击 系统 - DiskMan 磁盘管理 ，编辑主硬盘msata /dev/sda 新建一个分区。sda3。然后返回 系统 - 挂载点 挂到/opt&lt;/p>
&lt;p>我这里，习惯用它的自动挂载，默认是自动挂载到 /mnt/sda3 的，所以 docker直接把储存目录 切换到 /mnt/sda3 或者软连接到/opt 都可以。&lt;/p>
&lt;blockquote>
&lt;p>我主路由器 没有跑虚拟机，虚拟机平台 是在另外一台机器上。&lt;/p>&lt;/blockquote>
&lt;h2 id="docker恢复">docker恢复
&lt;/h2>&lt;p>略过 如果 docker切换到之前存放docker的位置，会自动还原的。&lt;br>
docker - 配置 Docker 根目录 设置为msata上的空闲分区的自动挂载地址 /mnt/sda3&lt;/p>
&lt;h2 id="端口转发">端口转发
&lt;/h2>&lt;p>用 网络 - socat 来转发&lt;/p>
&lt;blockquote>
&lt;p>网络 防火墙 转发的端口，openwrt自己 不能用 公网地址+端口 访问（内网其他机器和外网可以访问），所以最好用socat 更简单省心&lt;/p>&lt;/blockquote>
&lt;h2 id="系统备份和还原">系统备份和还原
&lt;/h2>&lt;p>建议直接用命令行来备份和还原，参考&lt;code>https://dev.leiyanhui.com/openwrt/backup&lt;/code> 同时也建议使用&lt;code>squashfs-combined&lt;/code>固件&lt;br>
简单示例 备份&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir /mnt/sda3/openwrt-backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -czvf /mnt/sda3/openwrt-backup/$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 计划任务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 45 8 * * * tar -czvf /mnt/sda3/openwrt-backup/$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>还原&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm -rvf /overlay/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd /
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -xzvf /mnt/sda1/openwrt-backup/XXXX-overlay.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reboot # 很重要 马上重启
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>还原后 一定马上重启 否则会带来一些其他奇奇怪怪问题&lt;/p>&lt;/blockquote>
&lt;h2 id="科学软件配置">科学软件配置
&lt;/h2>&lt;p>用暂时用passwall2 支持全局doh，自定义规则简单。但是 ipv6 好像会受影响，另外有几个编译版本bug也比较多。&lt;br>
v2rayA 相对简单一些，只是单纯翻墙，不折腾自定义规则 那些乱七八糟的，可以用，也稳定&lt;/p>
&lt;p>另外推荐 openclash 界面复杂，但是使用并不复杂，而且功能好太多了。&lt;/p></description></item><item><title>openwrt 挂载网盘alist常见问题整理</title><link>https://dev.leiyanhui.com/openwrt/alist/</link><pubDate>Fri, 13 Jan 2023 02:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/alist/</guid><description>&lt;p>alist支持主流网盘程序的挂载，并支持全部管理员转webdav，部分目录隐藏或者加密 ，以及针对个别目录单独管理 等等。。。&lt;br>
但是有一些常见问题，官方没有给出解决方案。&lt;br>
lxc + alpine linux 安装alist请参考 &lt;a class="link" href="https://dev.leiyanhui.com/pve/lxc-nas-alist" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/lxc-nas-alist&lt;/a>&lt;/p>
&lt;h2 id="openwrt下安装">openwrt下安装
&lt;/h2>&lt;p>三种方式，1是官方命令模式安装 2是插件安装&lt;code>luci-app-alist&lt;/code> 3是docker安装&lt;/p>
&lt;blockquote>
&lt;p>插件安装最直观方便，但是在op里面 会显示出管理员密码
alist貌似是golang写的，而且支持json导出备份迁移方便，所以要不要docker安装，看个人需求吧。&lt;/p>&lt;/blockquote>
&lt;h3 id="docker安装">docker安装
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --restart=always -v /opt/docker_file/op_alist:/opt/alist/data -v /:/openwrt -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name=&amp;#34;alist&amp;#34; --hostname &amp;#34;alist&amp;#34; xhofe/alist:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ssl-加密通讯">ssl 加密通讯
&lt;/h2>&lt;p>op插件安装话可以直接配置证书，但是不建议。因为我们家用用户的证书通常都是短期的最长也就1年 维护麻烦。 所以证书都是统一管理的。&lt;br>
我使用的国产的 nginxWebUI工具的docker版，在op上运行，统一管理内网证书，并反带所有内网的服务套上ssl，
详情查看：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl/&lt;/p>
&lt;h2 id="上传文件504错误">上传文件504错误
&lt;/h2>&lt;p>这个主要是前端用nginx反代后出现的。因为nginx限制了后端超时时间。 &lt;code>Request failed with status code 504&lt;/code>&lt;/p>
&lt;h2 id="上传文件413错误">上传文件413错误
&lt;/h2>&lt;p>这个主要是前端用nginx反代后出现的。 因为nginx限制了上传文件大小。 如果是用的nginxWebUI，那么在对应的反代站点里面 设置额外参数 &lt;code>client_max_body_size&lt;/code> 值&lt;code>51200m; #上传限制&lt;/code>&lt;/p>
&lt;h2 id="上传文件504错误-1">上传文件504错误
&lt;/h2>&lt;p>这个主要是前端用nginx反代后出现的。因为nginx限制了后端超时时间。 &lt;code>Request failed with status code 504&lt;/code>&lt;br>
如果是用的nginxWebUI，那么在对应的反代站点里面 设置额外参数 对照巷陌413错误的处理方式 分别添加额外参数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">proxy_send_timeout 7200;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">proxy_read_timeout 7200;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">proxy_connect_timeout 7200;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="nginx反向代理">nginx反向代理
&lt;/h2>&lt;p>最终代码如下，如果你用宝塔之类的，自行调整。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name pan.jia.leiyanhui.com;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 50443 ssl http2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/fullchain.cer;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/*.jia.leiyanhui.com.key;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 50081;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ($scheme = http) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host:50443$request_uri;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> error_page 497 https://$host:50443; #解决http到ssl端口的400错误;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> client_max_body_size 51200m; #上传限制;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_send_timeout 7200; #超时时间send和上传有关;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_read_timeout 7200; #超时时间read和下载有关;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_connect_timeout 60; #超时时间connect和于后端alist建立连接有关;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://10.1.1.1:5244;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host $host;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Real-IP $remote_addr;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-Host $http_host;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-Port $server_port;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-Proto $scheme;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_redirect http:// https://;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="其他问题">其他问题
&lt;/h2>&lt;p>如果是上传 常见系统镜像，建议使用对应网盘的标准客户端来处理。 因为会本地验证后秒传。&lt;/p></description></item><item><title>openwrt 下openclash 常用规则和配置</title><link>https://dev.leiyanhui.com/openwrt/openclash/</link><pubDate>Fri, 13 Jan 2023 02:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/openclash/</guid><description>&lt;p>openclash 可以说是最强大的科学软件，缺点就是 略微繁琐界面不友好，另外对路由器性能有要求，低端的硬路由刷op的情况 就不太适合。x86的话因为性能富裕，所以非常适合。&lt;/p>
&lt;p>openclash 安装后，只要添加订阅地址后 就可以 愉快使用。如果有更多要求部分地方可能还需要自己手动调整一下。&lt;br>
记录一下 我的配置&lt;/p>
&lt;h2 id="在线订阅转换-推荐使用">在线订阅转换 推荐使用
&lt;/h2>&lt;p>acl4ssr oneline full，添加Emoji 启用 udp。弄完之后 要重启一下 openclash&lt;/p>
&lt;h2 id="自动测速自动切换节点">自动测速自动切换节点
&lt;/h2>&lt;p>Dashboard 控制面板 ，Selector 选择 自动&lt;/p>
&lt;h2 id="ipv6支持和ddns无法获取ipv6地址的处理">ipv6支持和ddns无法获取ipv6地址的处理
&lt;/h2>&lt;p>openwrt 全局设置：dns设置 &lt;code>允许 IPv6 类型 DNS 解析&lt;/code>&lt;br>
ddns myddns_ipv6 -&amp;gt; IP 地址来源 -&amp;gt; 接口 接口选择 br-lan&lt;/p>
&lt;blockquote>
&lt;p>节点不支持ipv6的情况下 会自动走v4,当然也打不开纯v6站点&lt;br>
模式设置里面 &lt;code>IPv6 流量代理&lt;/code> 不建议打开&lt;/p>&lt;/blockquote>
&lt;h2 id="指定网站强制走代理">指定网站强制走代理
&lt;/h2>&lt;p>例如 dev.leiyanhui.com 我同时在国内cdn 和 GitHub page 两个镜像，因为国内cdn延迟更新，所以自己访问 强制到 GitHub&lt;br>
在全局设置 访问控制 &lt;code>绕过中国大陆 IPv4 黑名单&lt;/code> 里面添加 dev.leiyanhui.com 即可，同理可以ipv6的也添加上域名&lt;/p>
&lt;h2 id="全局dohdot的实现">全局doh/dot的实现
&lt;/h2>&lt;p>全局设置 dns 打开 &lt;code>本地 DNS 劫持&lt;/code> &lt;code>自定义上游 DNS 服务器&lt;/code> &lt;code>*远程域名解析&lt;/code> &lt;code>追加上游 DNS&lt;/code> &lt;code>追加默认 DNS&lt;/code> &lt;code>禁止 Dnsmasq 缓存 DNS&lt;/code>&lt;br>
然后 在下面的&lt;code>设置自定义上游 DNS 服务器&lt;/code> 里面 只勾选 http和 tls 类的dns，也可以自己添加&lt;/p>
&lt;h2 id="需要自定义配置文件的一些功能实现">需要自定义配置文件的一些功能实现
&lt;/h2>&lt;p>自定义规则 可以附加到 机场的规则前面。 全局设置 规则设置 自定义规则 勾选上，规则 添加到 &lt;code>设置自定义规则（优先匹配）&lt;/code> 的rules:里面&lt;/p>
&lt;h2 id="全局被走代理">全局被走代理
&lt;/h2>&lt;p>检查规则没问题，但是用国内的网站查询ip依旧是梯子的工具。&lt;br>
经过测试，在 openclash 代理模式 切换一次 即可。
常用ip查询网站：&lt;br>
&lt;a class="link" href="https://ip.skk.moe/" target="_blank" rel="noopener"
>https://ip.skk.moe/&lt;/a> （境外cf，openclash默认绕过）&lt;br>
&lt;a class="link" href="https://ip.cn/" target="_blank" rel="noopener"
>https://ip.cn/&lt;/a> (注意，这个网站在境外cf) &lt;br>
&lt;a class="link" href="https://ip138.com/" target="_blank" rel="noopener"
>https://ip138.com/&lt;/a> （境内，不少机场默认阻断）
&lt;a class="link" href="https://ip.chinaz.com/" target="_blank" rel="noopener"
>https://ip.chinaz.com/&lt;/a> （境内，不少机场默认阻断）
&lt;a class="link" href="http://checkip.synology.com/" target="_blank" rel="noopener"
>http://checkip.synology.com/&lt;/a> (境内)
&lt;a class="link" href="https://test-ipv6.com/" target="_blank" rel="noopener"
>https://test-ipv6.com/&lt;/a> (境外，可以检测ipv6)
&lt;a class="link" href="http://checkip.dyndns.com" target="_blank" rel="noopener"
>http://checkip.dyndns.com&lt;/a> （境外，IPv4 ）
&lt;a class="link" href="http://checkipv6.dyndns.com" target="_blank" rel="noopener"
>http://checkipv6.dyndns.com&lt;/a> （境外，IPv6 ）&lt;/p>
&lt;h3 id="指定网站强制不走代理">指定网站强制不走代理
&lt;/h3>&lt;p>例如&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,checkip.dyndns.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,checkipv6.dyndns.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,checkip.synology.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ifconfig.co,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,api.myip.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ip-api.com,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ipapi.co,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,ip6.seeip.org,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,members.3322.org,DIRECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- DOMAIN-SUFFIX,github.dev,DIRECT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="内网指定设备强制走固定线路">内网指定设备强制走固定线路
&lt;/h3>&lt;p>比如，内网某一个手机强制 走 香港01 这个线路&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- SRC-IP-CIDR,192.168.1.201/32,26, 🇸🇬 新加坡 01 | 专线
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- SRC-IP-CIDR,10.0.0.1/32,🇭🇰 香港节点
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt上配置doh/dot，以及科学工具分流解析的方法 以及自定义分流等 简单方法</title><link>https://dev.leiyanhui.com/openwrt/passwall2/</link><pubDate>Thu, 12 Jan 2023 08:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/passwall2/</guid><description>&lt;p>之前用 smartdns+ssrp 来解决，后来发现过于复杂。&lt;/p>
&lt;p>简单的方法 还是用 openclash 或者 passwall2。但是openclash 规则设置过于繁琐。所以我这里简单的用passwall2 来实现。&lt;/p>
&lt;blockquote>
&lt;p>本文停止更新，新文章优化解决方案：&lt;/p>&lt;/blockquote>
&lt;h3 id="passwall2-方案简单容易且靠谱">passwall2 方案简单容易且靠谱
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/passwall2" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/passwall2&lt;/a>&lt;/p>
&lt;h3 id="ssrpsmartdns-略微麻烦">ssrp+smartdns 略微麻烦
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/ssr_doh" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/ssr_doh&lt;/a>&lt;/p>
&lt;h3 id="openclash-自由-强大">openclash 自由 强大
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openclash" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/openclash&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>如果可以接受openclash的繁琐，还是建议openclash，自由，强大 ：&lt;/p>&lt;/blockquote>
&lt;p>本文基于 passwall2&lt;/p>
&lt;h2 id="实现目标">实现目标
&lt;/h2>&lt;p>1、国内不走代理，dns走doh到阿里云，境外ip全部走代理，doh用cloudflare
2、可以指定部分域名走 或者 不走 代理&lt;/p>
&lt;h2 id="配置passwall2">配置passwall2
&lt;/h2>&lt;p>可能需要卸载smartdns，然后安装&lt;code>luci-app-passwall2&lt;/code> 关闭其他代理工具。&lt;br>
节点订阅 配置好，以及自动更新 订阅 启动切换 等等&lt;/p>
&lt;h3 id="配置代理环境">配置代理环境
&lt;/h3>&lt;p>基本配置 mian 这个地方 Node 选分流总节点
其他看情况自己配置，他自带了一个Direct规则，内置的国内dns 还有常用的苹果 微软等规则。这个选直连，其他的看自己需求 包括奈飞 和去广告 还有国内那个 china等等。&lt;br>
最关键的是 下面那个 其他或者叫做* 默认 这行是配置好首选节点&lt;/p>
&lt;p>这就完成了 基本的上网环境&lt;/p>
&lt;h3 id="全局doh配置">全局doh配置
&lt;/h3>&lt;p>基本设置，dns直连dns，选doh选阿里云。远程 DNS 协议 同样设置 选cf。&lt;/p>
&lt;p>完毕&lt;/p>
&lt;h2 id="自定义两个规则">自定义两个规则
&lt;/h2>&lt;p>passwall2 自带的规则 基本上可以满足日常使用。不需要额外定制。但是有一些特殊的情况。&lt;/p>
&lt;h3 id="强制走代理的域名">强制走代理的域名
&lt;/h3>&lt;p>新建以规则名称&lt;code>my_proxy&lt;/code> 拖到 最前面，编辑内容。
域名这个地方,有说明，我这里 以本站为例,输入下面两行任意一行都是可以的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">dev.leiyanhui.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">full:dev.leiyanhui.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>返回，基本设置，给 my_proxy 配置一个线路&lt;/p>
&lt;h3 id="强制不走代理的域名">强制不走代理的域名
&lt;/h3>&lt;p>新建以规则名称&lt;code>my_direct&lt;/code> 拖到 最前面&lt;code>my_proxy&lt;/code>之前，编辑内容。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">test-ipv6.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dyndns.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>返回，基本设置，给 my_direct 设置为直连&lt;/p>
&lt;h3 id="测试">测试
&lt;/h3>&lt;p>可能需要重启浏览器 或者清理本机缓存，打开 test-ipv6.com 查看自己的ip 不在是梯子的ip，
还有：http://checkipv6.dyndns.com &lt;a class="link" href="http://checkip.dyndns.com/" target="_blank" rel="noopener"
>http://checkip.dyndns.com/&lt;/a>&lt;/p>
&lt;p>ping dev.leiyanhui.com 也应该返回国外的ip段（gitbub.io），用国内在线ping 工具返回国内ip（阿里云）
打开网站查看 dev.leiyanhui.com 查看证书是le的 也就是强制走了代理。国内的是亚洲诚信的证书&lt;/p>
&lt;h3 id="进阶ip直连">进阶ip直连
&lt;/h3>&lt;p>直连doh的ip，可以查看之前的文章 末尾
&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/ssr_doh" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/ssr_doh&lt;/a>&lt;/p>
&lt;h2 id="配合smartdns">配合smartdns
&lt;/h2>&lt;p>smartdns 支持预更新dns等功能 支持ttl缓存等等 如果性能够用可能会舒服一些更方便一些。&lt;br>
如果需要，可以另外搭建smartdns 到docker，这里设置为smartdns的地址即可。&lt;/p></description></item><item><title>openwrt上配置doh/dot，以及科学工具分流解析的方法</title><link>https://dev.leiyanhui.com/openwrt/ssr_doh/</link><pubDate>Thu, 12 Jan 2023 07:12:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/ssr_doh/</guid><description>&lt;h2 id="简单的说明">简单的说明
&lt;/h2>&lt;blockquote>
&lt;p>最简单的方法 是用 passwall2&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>本文停止更新，新文章优化解决方案：
passwall2 方案简单容易且靠谱
&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/passwall2" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/passwall2&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>科学工具 用 ssrp &lt;code>luci-app-ssr-plus&lt;/code> dns 工具用 &lt;code>luci-app-smartdns&lt;/code>&lt;/p>
&lt;p>smartdns 里面添加两种dns上游服务器&lt;/p>
&lt;p>一组境内的 组名称 china，一组境外的，组名称 gfw&lt;/p>
&lt;p>境外的doh均勾选上 从default默认服务器组中排除&lt;/p>
&lt;p>同时 smartdns 也开启两组服务&lt;/p>
&lt;p>常规设置里面，端口修改掉不要用53 防止故障导致全家断网，我这里用 6453&lt;/p>
&lt;p>第二DNS服务器 也开启 端口 6553 ，服务器组 选择 gfw&lt;/p>
&lt;p>这样 在 6453端口上 走国内doh解析，在 6553 走国外doh解析&lt;/p>
&lt;p>然后 在 ssrp里面 访问国外域名 DNS 服务器 自定义输入 &lt;code>127.0.0.1:6553&lt;/code> 国内 DNS 服务器 &lt;code>127.0.0.1:6453&lt;/code>&lt;/p>
&lt;p>这样就ok了&lt;/p>
&lt;blockquote>
&lt;p>smartdns 支持明文上游dns 也支持 doh和dot&lt;/p>&lt;/blockquote>
&lt;h3 id="我在用的上游dns">我在用的上游dns
&lt;/h3>&lt;h4 id="china组">china组
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://dns.alidns.com/dns-query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://doh.pub/dns-query
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>台湾也有一组：https://dns.twnic.tw/dns-query&lt;/p>
&lt;h3 id="gwf组">gwf组
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://dns.google/dns-query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://cloudflare-dns.com/dns-query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://dns.quad9.net/dns-query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://doh.sb/dns-query
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="关键点来了">关键点来了
&lt;/h3>&lt;p>如果ssrp上的用的ip分流。。他需要先解析出来 再判断，所以。。就会导致 所有的网站 可能都无法访问。。。&lt;/p>
&lt;p>解决方法也简单，就是上游doh服务器，用ip直接链接。而不是用域名。。&lt;/p>
&lt;p>阿里云的也可以这样写&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://223.5.5.5/dns-query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://223.6.6.6/dns-query
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>腾讯的貌似不支持直接ip的方式，不过腾讯的doh和dot 一直不怎么稳定，测试运行了几百年了还是不稳定&lt;/p>
&lt;p>360的 电信移动
https://101.226.4.6
https://218.30.118.6
360的 联通
https://123.125.81.6
https://140.207.198.6&lt;/p>
&lt;p>cf的可以这样写
https://1.1.1.1/dns-query
google的这样写
https://8.8.8.8&lt;/p>
&lt;h3 id="为什么不选择其他工具">为什么不选择其他工具
&lt;/h3>&lt;p>pypass 内置了一个smartdns，但是pypass 自己有域名 走代理和不走代理的 配置bug ，也就是无效。暂时不支持新版会不会解决&lt;br>
clash 规则过于复杂，没时间折腾&lt;/p>
&lt;p>mosdns 不错，支持域名别名解析，比如 可以强制自己在国内对象储存和githubpage 同时存在的网站，可以强制别名到 xxx.github.io ,但是，mosdns 真的太简陋了。&lt;/p>
&lt;p>同时 smartdns支持 域名 指定的上游组解析，所以别名解析 也不需要了。&lt;/p></description></item><item><title>docker运行nginx 并反代内网的一些服务2(nginxwebui修改版)</title><link>https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl/</link><pubDate>Sat, 07 Jan 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl/</guid><description>&lt;p>家里路由器是openwrt x86，内外有跑一些服务。这里用路由器上配置nginx+ssl，然后内网的所有web服务都经过nginx到公网，因为家用宽带不只&lt;/p>
&lt;p>nginxwebui是国产基于java的开源nginx配置文件生成器，用于替代死板的nginx-proxy-manage 。&lt;/p>
&lt;p>优点是 更加灵活 强大 支持中文，几乎支持所有的nginx功能的可视化配置。&lt;/p>
&lt;p>缺点是 略微繁琐，尤其是不能自动载入配置文件，创建项目后，要手动在webui里面，点替换和重载。&lt;/p>
&lt;h2 id="docker安装">docker安装
&lt;/h2>&lt;p>nginxwebui 官网docker实例是用的host模式运行，不建议。还是自定义端口映射。&lt;/p>
&lt;p>我这里需要3个端口 nginxwebui管理端口50088，http 端口50081 https 端口50443&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --restart=always --name=nginxwebui --hostname nginxwebui -e BOOT_OPTIONS=&amp;#34;--server.port=50088&amp;#34; -p 50081:50081 -p 50088:50088 -p 50443:50443 --privileged=true cym1102/nginxwebui:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>证书目录 是保存在： &lt;code>/home/nginxWebUI/.acme.sh/&lt;/code> 下面&lt;br>
配置文件&lt;code>/home/nginxWebUI/nginx.conf&lt;/code> 。&lt;/p>
&lt;p>如果需要对证书单独管理，可以映射出来。也恩可以用docker cp 定时复制出来。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd -v /opt/docker_file/op_nginxWebUI:/home/nginxWebUI --restart=always --name=nginxwebui --hostname nginxwebui -e BOOT_OPTIONS=&amp;#34;–server.port=50088&amp;#34; -p 50081:50081 -p 50088:50088 -p 50443:50443 --privileged=true cym1102/nginxwebui:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>而后在 nginxwebui 内部 再反代 管理端口出来 套上ssl 即可从外网ssl访问。&lt;/p>
&lt;p>为了方便备份，我这里没有映射目录出来。记得自行定时清理日志：&lt;code>/home/nginxWebUI/log/nginxWebUI.log&lt;/code>&lt;/p>
&lt;p>注意： http://10.0.0.1:50088/ web界面 打开可能会空白，这个&amp;hellip;.大概是因为java启动慢的原因，等一会 刷新一下就好了。&lt;/p>
&lt;h2 id="一个典型的反代配置">一个典型的反代配置
&lt;/h2>&lt;p>包括http自动跳转ssl&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">转发类型 http
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">监听端口：这个如果要开启ssl的话要输入ssl端口 50443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">选择密码文件：这个是base的密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开机ssl：是
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">选择内置证书：（提前配置）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开启https：是
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssl协议版本：全部勾选
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">http跳转https：是
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">从该端口跳转：第一个留空 第二个输入ssl的端口后 50081
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就可以实现，访问http的时候自动跳转到ssl &lt;br>
最终配置文件大概如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name 域名;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 50443 ssl http2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /home/nginxWebUI/.acme.sh/jia.leiyanhui.com/fullchain.cer;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /home/nginxWebUI/.acme.sh/jia.leiyanhui.com/jia.leiyanhui.com.key;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 50081;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ($scheme = http) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host:50443$request_uri;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 自己;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://10.0.0.1:50088;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host $host;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Real-IP $remote_addr;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-Host $http_host;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-Port $server_port;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-Proto $scheme;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_http_version 1.1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Upgrade $http_upgrade;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Connection &amp;#34;upgrade&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_redirect http:// https://;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="自动备份到阿里云镜像">自动备份到阿里云镜像
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/docker/img-to-aliyun/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/img-to-aliyun/&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">10 3 * * 6 sh /etc/docker_up_aliyun_nginxWebUi.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="使用nginxwebui反代-主路由的一个小问题">使用nginxWebUI反代 主路由的一个小问题
&lt;/h2>&lt;p>如果op主路由配置了 根据域名跳转（https://dev.leiyanhui.com/openwrt/acme-ssl/），op需要绑定一个不属于最终配置文件的域名 。或者 使用下面的方法。
另外 op里面的网页终端需要单独处理（我选择 直接弃用）。&lt;/p>
&lt;p>还有一个方案 是 不传递host参数，然后直接访问 https://你的域名:端口/cgi-bin/luci/ 也可以解决。&lt;/p>
&lt;h3 id="关于使用http协议访问https端口的400错误处理">关于使用http协议访问https端口的400错误处理
&lt;/h3>&lt;p>例如我正常访问我的路由器应该是&lt;code>https://域名:50443&lt;/code>如果用&lt;code>http://域名:50443&lt;/code>访问端口还是https的端口就会提示400错误。 因为服务是家人也用。 不能指望他们理解http（S）这些。所以我采取的方法是直接拦截错误，并跳转到正确的首页地址。&lt;/p>
&lt;p>首先这个错误是 497 错误，nginxWebUI支持参数模板，添加一个参数模板，名字随意，添加参数&lt;code>error_page 497&lt;/code> 值&lt;code>https://$host:50443; #解决http到ssl端口的400错误&lt;/code> 然后用默认配置应用到反向代理。完毕&lt;/p>
&lt;h3 id="最好的解决方案">最好的解决方案
&lt;/h3>&lt;p>编辑对应的ningxWebUi反向代理配置，
添加一个 &lt;code>= / &lt;/code> 自定义localtions 添加参数 &lt;code>return&lt;/code> 值&lt;code> 301 https://$host:50443/cgi-bin/luci&lt;/code> （意思就是网址后面没有东西的情况下跳转到后面地址）即可 （注意好要清理浏览器缓存不然不会生效） &lt;br>
最终代码如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name op.jia.leiyanhui.com;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 50443 ssl http2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/fullchain.cer;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/*.jia.leiyanhui.com.key;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 50081;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ($scheme = http) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host:50443$request_uri;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> error_page 497 https://$host:50443; #解决http到ssl端口的400错误;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location = / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # op自动跳转;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host:50443/cgi-bin/luci;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # op代理;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://10.1.1.1/;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_redirect http:// https://;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="进阶">进阶
&lt;/h3>&lt;p>1、解决 在web界面直接点击 域名 链接打开的是不带端口的导致非标端口打不开的情况。 &lt;a class="link" href="https://github.com/joyanhui/nginxWebUI" target="_blank" rel="noopener"
>https://github.com/joyanhui/nginxWebUI&lt;/a>
2、解决 定时续签2点拥堵的问题，
下载 我自己的修改的 jar，替换到docker里面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">exec&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">it&lt;/span> &lt;span class="n">nginxwebui&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jar&lt;/span> &lt;span class="c1">#删除原版jar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">joyanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="n">st&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">cp&lt;/span> &lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jar&lt;/span> &lt;span class="n">nginxwebui&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jar&lt;/span> &lt;span class="c1"># 复制宿主机上的修改过的jar进去&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">restart&lt;/span> &lt;span class="n">nginxwebui&lt;/span> &lt;span class="c1">#重启&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jar&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="下载地址">下载地址
&lt;/h4>&lt;p>&lt;a class="link" href="https://www.123pan.com/s/EqorVv-n0nPA" target="_blank" rel="noopener"
>https://www.123pan.com/s/EqorVv-n0nPA&lt;/a> 提取码:yhjt&lt;/p>
&lt;p>详细 &lt;a class="link" href="https://github.com/joyanhui/nginxWebUI" target="_blank" rel="noopener"
>https://github.com/joyanhui/nginxWebUI&lt;/a>&lt;/p>
&lt;h3 id="其他问题">其他问题
&lt;/h3>&lt;p>nginxwebui 和 nginx-proxy-manager 都同样的问题，就是在web界面直接点击 域名 链接打开的是不带端口的。在前者的github 提交过issues但是作者没有回应。后at作者后，作者表示：&lt;code>这个界面是展示信息用，不是给你高强度使用的&lt;/code> 不知所云。&lt;/p>
&lt;blockquote>
&lt;p>已经自己修改 &lt;a class="link" href="https://github.com/joyanhui/nginxWebUI" target="_blank" rel="noopener"
>https://github.com/joyanhui/nginxWebUI&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>不过nginxwebui 相对 nginx-proxy-manager 依旧适合非标端口的
如果是内网使用，家用宽带没有标准端口的情况下，可以通过一个简单方法实现，就是在路由器上转发跳转一次，详情：https://dev.leiyanhui.com/openwrt/acme-ssl/&lt;/p>
&lt;p>另外 nginxwebui 的证书申请 有几个小遗憾，1 证书检查时间固定在凌晨2点不可以修改，还是很拥挤的。2 没有日志显示，如果出错你也不知道。。。只能等待。。。&lt;/p></description></item><item><title>openwrt 下配置IPSec</title><link>https://dev.leiyanhui.com/openwrt/ipsec-server/</link><pubDate>Sat, 07 Jan 2023 04:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/ipsec-server/</guid><description>&lt;p>openwrt下配置ipsec,基于&lt;code>luci-app-ipsec-vpnd&lt;/code> 注意不是&lt;code>luci-app-ipsec-server&lt;/code> 后者有一些奇奇怪怪问题。&lt;/p>
&lt;p>默认设置发现 外网无法拨上来。随后发现内网也无法拨上来。&lt;/p>
&lt;h2 id="配置文件">配置文件
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/ipsec.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>找到&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># strictcrlpolicy=yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>取消注释，然后重启ipsec 就好了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/init.d/ipsec restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="启动脚本">启动脚本
&lt;/h3>&lt;p>如果重启后 这个上面的文件自动恢复，那就是有其它脚本处理过这个文件。经过检查 发现 是 /etc/init.d/ipsec 这个脚本，。找到 &lt;code>start_service() &lt;/code> 这段 的&lt;code>config setup&lt;/code>&lt;/p>
&lt;p>修改下面的内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">config setup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # strictcrlpolicy=yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # edit this form /etc/init.d/ipsec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> strictcrlpolicy=yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uniqueids=never
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其他无法访问内网 等其他问题 没发现。都正常。&lt;/p>
&lt;h2 id="防火墙处理">防火墙处理
&lt;/h2>&lt;p>另外 网络-防火墙-转发 将拒绝改为接受 ， 检查 通讯规则里面 应该有自动添加的 500 和4500 两个端口&lt;/p>
&lt;p>如果是二级路由器 还需要在主路由做端口转发，这个不用多说了。&lt;/p>
&lt;p>另外防火墙规则，我vpn网段是 10.10.10.2/24 添加如下内容（非必须）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">tables -t nat -I POSTROUTING -s 10.10.10.0/24 -j MASQUERADE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tables -I FORWARD -i vpn -s 10.10.10.0/24 -j ACCEPT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ptables -I INPUT -i vpn -s 10.10.10.0/24 -j ACCEPT
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果想让vpn客户端也可以 科学上网，需要在对应的科学软件里面配置。 比如：ssrp的话，默认配置的情况下，只从访问控制 接口控制里面 选中两个vpn接口即可&lt;/p>
&lt;h2 id="启动ipsec-vpn">启动ipsec vpn
&lt;/h2>&lt;p>系统，启动项，找到 ipsec 重启 或者启动&lt;/p></description></item><item><title>openwrt Signature check failed.错误的解决</title><link>https://dev.leiyanhui.com/openwrt/source-signature-err/</link><pubDate>Fri, 06 Jan 2023 15:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/source-signature-err/</guid><description>&lt;p>openwrt更新的时候 出现 Signature check failed,，然后部分软件包也有问题，就是源的签名有问题。&lt;/p>
&lt;p>在 某些修改版固件上常见，尤其腾讯云的源，解决方法 就是找到&lt;/p>
&lt;p>/cgi-bin/luci/admin/system/packages/ipkg OPKG 基础配置 或者直接编辑 &lt;code>/etc/opkg.conf &lt;/code>&lt;/p>
&lt;p>把最后一行 option check_signature 或者 option check_signature 1 注释掉&lt;/p></description></item><item><title>openwrt端口转发的一个小问题，端口回流的问题</title><link>https://dev.leiyanhui.com/openwrt/forwards-err/</link><pubDate>Fri, 06 Jan 2023 15:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/forwards-err/</guid><description>&lt;p>在使用openwrt的端口转发时候遇到一个小问题，就是 外网可以用 公网IP/域名 + 端口的方式 访问内网。但是内网内不可以这样访问。&lt;/p>
&lt;p>经过电报群里面大佬&lt;code>Gx Hunter&lt;/code>的提醒，检查了一下端口回流。然后查阅其他人文章 发现 是docker导致的端口回流问题。&lt;/p>
&lt;p>简单处理放方法&lt;/p>
&lt;p>&lt;code>vi /etc/sysctl.d/11-br-netfilter.conf&lt;/code> 检查和修改下面三行内容，没有的话添加，有的话修改&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-arptables=0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables=0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables=0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>vi /etc/sysctl.conf&lt;/code> 检查和修改 ，没有的话添加，有的话修改 文件不存在的话创建，内容也是前面的三行&lt;/p>
&lt;p>验证&lt;code>sysctl -p&lt;/code> 输出内容应该也是这三行内容，检查无误后，重启sysctl&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/init.d/sysctl restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt上的docker提示iptable错误的解决方案</title><link>https://dev.leiyanhui.com/openwrt/docker-iptable-err/</link><pubDate>Fri, 06 Jan 2023 15:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/docker-iptable-err/</guid><description>&lt;p>报错信息&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker: Error response from daemon: driver failed programming external connectivity on endpoint alist (53d606bcf21ac0e0943a9d21eddb3934f0d2f71c75a8fa7fb652685e3fdd9253): (iptables failed: iptables --wait -t nat -A DOCKER -p tcp -d 0/0 --dport XXX -j DNAT --to-destination 172.17.0.2:XXX ! -i docker0: iptables: No chain/target/match by that name.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>检查了一圈没有找到问题，然后从openwrt的luci里面重启了一下docker 解决。。。&lt;/p></description></item><item><title>openwrt上配置cloudflare内网穿透</title><link>https://dev.leiyanhui.com/openwrt/cloudflare-net/</link><pubDate>Fri, 06 Jan 2023 15:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/cloudflare-net/</guid><description>&lt;p>我这里选择用docker运行,需要你先在openwrt上配置好docker。&lt;/p>
&lt;p>1、注册配置好cf
登录后，在cf点击域名/网站， 点击左侧的 流量 -》 Cloudflare Tunnel 启动 Cloudflare Zero Trust 仪表盘&lt;/p>
&lt;p>在仪表盘 选择 access -》 Tunnel 按照提示配置 即可。&lt;/p>
&lt;p>路由上直接运行 仪表盘提示的docker命令&lt;/p></description></item><item><title>openwrt上配置doh，让全体用上doh (内有新解决方案)</title><link>https://dev.leiyanhui.com/openwrt/doh/</link><pubDate>Fri, 06 Jan 2023 15:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/doh/</guid><description>&lt;p>dns 是非常古老的协议，非常容易劫持 容易泄露隐私。主要是劫持这点非常不方便。&lt;/p>
&lt;p>doh 也就是 dns over https，就是让dns协议去走https协议，可以完全防止dns污染，也防止隐私泄露。主流系统都一直支持自行配置，但是在每台设备上弄 还是麻烦。
所以 还是弄到路由器上省心。&lt;/p>
&lt;blockquote>
&lt;p>本文停止更新，新文章优化解决方案：&lt;/p>&lt;/blockquote>
&lt;h3 id="passwall2-方案简单容易且靠谱">passwall2 方案简单容易且靠谱
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/passwall2" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/passwall2&lt;/a>&lt;/p>
&lt;h3 id="ssrpsmartdns-略微麻烦">ssrp+smartdns 略微麻烦
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/ssr_doh" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/ssr_doh&lt;/a>&lt;/p>
&lt;h3 id="openclash-自由-强大">openclash 自由 强大
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openclash" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/openclash&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>如果可以接受openclash的繁琐，还是建议openclash，自由，强大 ：&lt;/p>&lt;/blockquote>
&lt;p>安装插件&lt;code>https-dns-proxy&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#核心
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg install https-dns-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#网页界面
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg install luci-app-https-dns-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#中文
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg install luci-i18n-https-dns-proxy-zh-cn
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>中文语言包 好像失效了。找到一个
&lt;code>https://openwrt.pkgs.org/19.07/openwrt-luci-x86_64/luci-i18n-https-dns-proxy-zh-cn_2021-07-29-1-1_all.ipk.html&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>注意 &lt;code>https-dns-proxy&lt;/code> 安装后会默认启动，并接管dns，且默认使用google和cf的dns 墙内肯定 会导致全局网络无法dns，需要尽快去配置为国内可用的。&lt;/p>&lt;/blockquote>
&lt;h2 id="常用doh服务商">常用doh服务商
&lt;/h2>&lt;p>测试&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">curl --http2 -H &amp;#39;accept: application/dns-json&amp;#39; https://1.1.1.1/dns-query?name=cloudflare.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl https://dns.alidns.com/resolve?name=taobao.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="境内">境内
&lt;/h3>&lt;p>腾讯/dnspods &lt;code>https://doh.pub/dns-query&amp;quot;&lt;/code>
阿里云 &lt;code>https://dns.alidns.com/dns-query&lt;/code>&lt;/p>
&lt;h2 id="另外说一下阿里云的doh">另外说一下阿里云的doh
&lt;/h2>&lt;p>阿里云的doh会强制显示client ip，google cf等没有这情况。但是总所周知，google和cf 都相对比较慢一些，而且需要你有网络学习环境。&lt;br>
目前阿里云的doh在手动指定 client-subnet的时候设置为墙外ip会返回没有污染的结果。
这个小漏洞的起因应该是阿里云在墙外有上级纯净的权威dns&lt;/p>
&lt;p>但是我们可以在墙内使用阿里云doh来获取没有污染的结果。&lt;/p></description></item><item><title>docker 一个可用的完整桌面系统</title><link>https://dev.leiyanhui.com/docker/docker-linux-desktop/</link><pubDate>Sun, 01 Jan 2023 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/docker-linux-desktop/</guid><description>&lt;p>选择 用 &lt;a class="link" href="https://hub.docker.com/r/linuxserver/webtop" target="_blank" rel="noopener"
>https://hub.docker.com/r/linuxserver/webtop&lt;/a>&lt;/p>
&lt;p>默认用户名：abc 密码：abc&lt;/p>
&lt;h2 id="3d加速-ubuntu">3D加速 Ubuntu
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">--device=/dev/dri:/dev/dri
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="fuse">fuse
&lt;/h2>&lt;p>宿主机要安装fuse&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> --privileged
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>另外一个方案 是&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">--device /dev/fuse \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --cap-add SYS_ADMIN \
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="端口">端口
&lt;/h2>&lt;p>3000 是web-vnc 3389 和22 不用多说&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">-p 10100:3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 10101:3389
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 10102:22
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ubuntu-3d">ubuntu 3D
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ubuntu&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">privileged&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">opt&lt;/span> &lt;span class="n">seccomp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">unconfined&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PGID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TZ&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">SUBFOLDER&lt;/span>&lt;span class="o">=/&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">KEYBOARD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">us&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qwerty&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TITLE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ubuntu&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10101&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3389&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10102&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span> &lt;span class="n">unless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stopped&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lscr&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linuxserver&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kde&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="输入法">输入法
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-rime
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>另外需要编辑 /init 实现自动启动&lt;/p>
&lt;h2 id="arch">arch
&lt;/h2>&lt;blockquote>
&lt;p>kde的镜像 有点问题，xrdp连不上&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">privileged&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">opt&lt;/span> &lt;span class="n">seccomp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">unconfined&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PGID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TZ&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">SUBFOLDER&lt;/span>&lt;span class="o">=/&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">KEYBOARD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">us&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qwerty&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TITLE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10101&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3389&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10102&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span> &lt;span class="n">unless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stopped&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lscr&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linuxserver&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>旁路由方案，自动切换网关方案 参考</title><link>https://dev.leiyanhui.com/openwrt/auto-change-gatway/</link><pubDate>Fri, 30 Dec 2022 09:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/auto-change-gatway/</guid><description>&lt;h2 id="旁路由方案的痛点">旁路由方案的痛点
&lt;/h2>&lt;p>旁路由在出问题的时候，会影响网关配置为旁路由的设备使用。所以需要自动检测旁路由。&lt;br>
首先 主路由要有完整权限的系统，就是有ssh权限的！ 爱快请使用分流方案 到二级路由以及环回等方式实现。&lt;br>
旁路由的自动切换方案是很多的人的刚性需求。&lt;br>
用软路由做主路由，主要问题两点，折腾过程中的失误一些不确定东西，容易断网。还有x86软路由 不少人遇到突然断电导致的无法启动后全家断网 &lt;br>
自动切换旁路由方案，更加稳定一些。&lt;/p>
&lt;blockquote>
&lt;p>本文撰写于2019年，后期虽有修改补充，但是部分内容已经落后 &lt;br>
有能力有时间的朋友，建议还是上x86 方案，不需要旁路由。 或者使用爱快分流方案。 &lt;a class="link" href="https://dev.leiyanhui.com/route/ikuai-bypass-gfw/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/route/ikuai-bypass-gfw/&lt;/a>&lt;br>
个人经验 爱快分流方案更为稳健，但是需要另外开一个op 以及docker来处理分流规则。 对设备内存要求较高（x32爱快不支持kvm docker可用镜像有限，爱快x64 需要4G内存安装 2G内存运行）。 如果内存紧张最好还是选择openwrt one only&lt;/p>&lt;/blockquote>
&lt;h3 id="实现目标">实现目标
&lt;/h3>&lt;p>主路由为硬路由负责上网和dhcp 顺带wifi，硬交换负责nas和机顶盒 台式机之间通讯。
去掉 x86 软路由 &lt;br>
nas或者aio主机 或者 N1 或者闲置手机作为旁路由/旁网关(后面统称旁路由)&lt;/p>
&lt;h4 id="重点目标">重点目标：
&lt;/h4>&lt;ul>
&lt;li>旁路由离线后，所有设备自动切换到主路由网关&lt;/li>
&lt;li>双旁路由A和B A正常运行的时候B删除不存在在需要调整的时候，复制一个独立的旁路由出来，自己手动修改主机电脑的网关到旁路由B测试没问题后替换A&lt;/li>
&lt;li>可控制部分设备科学，部分设备不科学&lt;/li>
&lt;li>ksm ipsec 科学 广告过滤 alist ddns nas 等，全部由旁路由或者aio/nas处理。&lt;/li>
&lt;/ul>
&lt;h3 id="实现原理">实现原理
&lt;/h3>&lt;p>旁路由用pve 或者 unraid 或者docker运行，关闭dhcp服务，静态ip（10.0.0.50），网关指定为主路由。也就是旁路由只是主路由下面的一个普通设备而已。&lt;/p>
&lt;blockquote>
&lt;p>双DHCP 存在抢dhcp的情况，所以dhcp本身占不了太多资源，还是主路由统一管理。
主路由10.1.1.1 开启dhcp dhcp的网关改为程序脚本控制 dhcp的租期尽可能短一些（120秒）
主路由 dhcp的ip段为 10.1.1.200-245 重点设备 静态绑定到 10.1.1.200以内的ip段。&lt;/p>&lt;/blockquote>
&lt;h4 id="逻辑如下">逻辑如下
&lt;/h4>&lt;p>主路由每隔一定时间 30秒或者1分钟，检查一次旁路由是否在线，
如果在线那么 dhcp服务的网关改为旁路由（10.0.0.50）&lt;br>
如果旁路由不在线 那么dhcp服务的网关改为主路由（10.0.0.1）&lt;/p>
&lt;blockquote>
&lt;p>如果旁路由状态发生了变化，那么重启一次dnsmasq（或者再重启wifi 或者重启整个系统）&lt;br>
科学部分，由openclash 实现分流，就是部分设备不走科学还有部分设备强制全局科学等等。 这个可以看我以前的文章 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openclash/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/openclash/&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h3 id="具体实现">具体实现
&lt;/h3>&lt;p>我主路由依旧用10多年前的 古董级k2p刷Padavan 固件，因为他的2.4G信号一直很好，Padavan 可以跑满1000M，5G的话也能跑到500M，另外一个5G路由器因为2.4G信号一般所以只能做ap用。 万兆由下级一个交换机处理，千兆以内众生平等 适合自己的才是最好的。&lt;br>
Padavan 也是开源linux 和openwrt使用起来在系统层面差距不是很大 ，只要有ssh权限，所有固件都大同小异。&lt;br>
旁路由 用 pve 跑的自己编译的openwrt，直接挂的vm跑的，因为我这边，8核心，64G内存 所以没用lxc和docker。&lt;/p>
&lt;h4 id="脚本测试">脚本测试
&lt;/h4>&lt;p>padvan默认是关闭ssh的，系统管理 - 服务 找到ssh 打开，客户端登录ssh&lt;/p>
&lt;h5 id="检查旁路由是否在线">检查旁路由是否在线
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">curl http://10.1.1.50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这是openwrt的登录页面 他会自动301跳转，查看返回http代码 &lt;code>-m 3&lt;/code> 是3秒&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">curl -I -s -m 3 http://10.1.1.50 -w %{http_code} | tail -n1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>应该会自动返回一个301代码, http://10.1.1.50/cgi-bin/luci/ 的话应该是返回403，这个先不管
如果是不存在的地址，那么应该是返回 000&lt;/p>
&lt;h5 id="找dnsmasql的配置文件地址">找dnsmasql的配置文件地址
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">find / -name &amp;#34;*dnsmasq*&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>返回 结果 逐个检查后发现Padavan和openwrt一样 都是&lt;code>/etc/dnsmasq.conf&lt;/code> 这个文件，同时已经分配的列表也是&lt;code>/tmp/dnsmasq.leases&lt;/code>这个文件。&lt;br>
在主路由中 设置dhcp的网关为 旁路由地址10.1.1.50 ，然后执行 &lt;code>cat /etc/dnsmasq.conf&lt;/code>应该有一行&lt;code>dhcp-option=tag:lan,3,10.1.1.50&lt;/code>&lt;/p>
&lt;h5 id="测试配置文件的查找和替换">测试配置文件的查找和替换
&lt;/h5>&lt;p>记住上面的那段 &lt;code>dhcp-option=tag:lan,3,10.1.1.50&lt;/code> 用grep搜索试试&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">grep dhcp-option=tag:lan,3,10.1.1.50 /etc/dnsmasq.conf |wc -l # 查找 如果有的话应该返回1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>替换&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sed -i &amp;#34;s/dhcp-option=tag:lan,3,10.1.1.50/dhcp-option=tag:lan,3,10.1.1.1/g&amp;#34; /etc/dnsmasq.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 检查
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat /etc/dnsmasq.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果padavan的话不用这么麻烦 用&lt;code>nvram set dhcp_gateway_x=10.1.1.1 &lt;/code>&lt;/p>
&lt;h5 id="重启-dnsmasq">重启 dnsmasq
&lt;/h5>&lt;p>openwrt 下面这两个命令 都一样的效果&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">service dnsmasq restart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/dnsmasq restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Padavan 下可执行文件是 &lt;code>/usr/sbin/dnsmasq&lt;/code> 通过查询网上资料得知 Padavan把服务脚本放在/sbin 直接执行&lt;code>/sbin/restart_dhcpd&lt;/code> 即可&lt;/p>
&lt;h4 id="编写脚本">编写脚本
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">default_gateway&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.1&amp;#39;&lt;/span> &lt;span class="c1">#主路由 IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">up_gateway&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;10.1.1.50&amp;#39;&lt;/span> &lt;span class="c1">#旁路由 IP （需设置的主路由 DNS 地址）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_ip_available&lt;span class="o">(){&lt;/span> &lt;span class="c1">#使用 ping 命令检测旁路由是否在线&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ping -c &lt;span class="m">3&lt;/span> &lt;span class="nv">$1&lt;/span> &lt;span class="p">|&lt;/span> grep packets &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $4}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">change_gateway_dns&lt;span class="o">(){&lt;/span> &lt;span class="c1">#网关 DNS 切换&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nvram &lt;span class="nb">set&lt;/span> &lt;span class="nv">dhcp_gateway_x&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span> &lt;span class="c1">#设置网关&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nvram &lt;span class="nb">set&lt;/span> &lt;span class="nv">dhcp_dns1_x&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nvram &lt;span class="nb">set&lt;/span> &lt;span class="nv">dhcp_dns2_x&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span> &lt;span class="c1">#设置 DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nvram commit &lt;span class="c1">#提交修改&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sleep &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rc rc_service restart_net_and_phy &lt;span class="c1">#重启主路由 网络服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> restart_dns &lt;span class="c1">#重启主路由 DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> restart_dhcpd &lt;span class="c1">#重启主路由 DHCP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sleep 5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># reboot #自动修改后存在网络故障，可能需要直接重启路由器， 等待时间较长&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the gateway of the up close, the network is completely unusable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">res&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>check_ip_available &lt;span class="nv">$up_gateway&lt;/span>&lt;span class="sb">`&lt;/span> &lt;span class="c1">#检测旁路由是否存在&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">current_gateway&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>nvram get dhcp_gateway_x&lt;span class="sb">`&lt;/span> &lt;span class="c1">#获取主路由当前网关&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="k">$((&lt;/span>&lt;span class="nv">$res&lt;/span>&lt;span class="k">))&lt;/span> -eq &lt;span class="m">0&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">#检测结果等于 0，即旁路由不存在，应设置网关和 DNS 为主路由地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$current_gateway&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> !&lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$default_gateway&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="c1">#如果当前网关地址不是主路由地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;up_gateway to default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>change_gateway_dns &lt;span class="nv">$default_gateway&lt;/span>&lt;span class="sb">`&lt;/span> &lt;span class="c1">#将网关和DNS切换为主路由地址 并重启&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;use default gateway , nothing changed&amp;#34;&lt;/span> &lt;span class="c1"># 什么都不用做&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="k">$((&lt;/span>&lt;span class="nv">$res&lt;/span>&lt;span class="k">))&lt;/span> -ne &lt;span class="m">0&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">#检测结果不等于 0，即旁路由存在，应设置网关和 DNS 为旁路由地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$current_gateway&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> !&lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$up_gateway&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="c1">#如果当前网关地址不是主路由地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;up_gateway to auxiliary_gateway&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>change_gateway_dns &lt;span class="nv">$up_gateway&lt;/span>&lt;span class="sb">`&lt;/span> &lt;span class="c1">#将网关和DNS切换为旁路由地址 并重启&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;use auxiliary_gateway , nothing changed&amp;#34;&lt;/span> &lt;span class="c1"># 什么都不用做&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#将脚本置于 /etc/storage/change_gatway.sh &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设置脚本运行权限：`chmod +x /etc/storage/change_gatway.sh ` &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#保存脚本，防止重启丢失：`/sbin/mtd_storage.sh save`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#自动定时运行脚本（每一分钟检测一次）：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#`系统管理 - 服务 ` 调度任务 (Crontab) 加入 `*/1 * * * * /etc/storage/change_gatway.sh` &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后&lt;/p>
&lt;p>将脚本置于 /etc/storage/change_gatway.sh
设置脚本运行权限：&lt;code>chmod +x /etc/storage/change_gatway.sh &lt;/code>&lt;br>
保存脚本，防止重启丢失：&lt;code>/sbin/mtd_storage.sh save&lt;/code>
自动定时运行脚本（每一分钟检测一次）：
&lt;code>系统管理 - 服务 &lt;/code> 调度任务 (Crontab) 加入 &lt;code>*/1 * * * * /etc/storage/change_gatway.sh&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>以上内容抄 自：恩山，xuezou&lt;/p>&lt;/blockquote>
&lt;h2 id="最后存在的问题">最后存在的问题
&lt;/h2>&lt;p>经过测试 无论是wifi接入还是网线加入的设备 都可以在短暂掉线后 自动切换成功&lt;/p></description></item><item><title>openwrt常用计划任务</title><link>https://dev.leiyanhui.com/openwrt/crontab/</link><pubDate>Thu, 01 Dec 2022 23:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/crontab/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 挂载阿里云盘 webdav，这个写计划任务靠谱一些
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*/1 * * * * rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*/1 * * * * rclone mount aliyunpan:/MediaVodCenter /mnt/MediaVodCenter --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 整机重启
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15 5 * * * sleep 70 &amp;amp;&amp;amp; echo &amp;#34;每天5点15分+70秒路由器自动重启&amp;#34; &amp;gt; /etc/banner &amp;amp;&amp;amp; reboot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15 17 * * * sleep 70 &amp;amp;&amp;amp; echo &amp;#34;每天17点15分+70秒路由器自动重启&amp;#34; &amp;gt; /etc/banner &amp;amp;&amp;amp; reboot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 重启dnsmasq
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">15 */3 * * * sleep 70 &amp;amp;&amp;amp; echo &amp;#34;三小时重启一次dnsmasp&amp;#34; &amp;gt; /etc/banner &amp;amp;&amp;amp; /etc/init.d/dnsmasq restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker运行 官方宝塔</title><link>https://dev.leiyanhui.com/docker/baota/</link><pubDate>Sun, 27 Nov 2022 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/baota/</guid><description>&lt;p>宝塔 终于出官方docker了 基于&lt;code>CentOS 7.9.2009 x86_64&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://hub.docker.com/r/btpanel/baota" target="_blank" rel="noopener"
>https://hub.docker.com/r/btpanel/baota&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.bt.cn/bbs/thread-79499-1-1.html" target="_blank" rel="noopener"
>https://www.bt.cn/bbs/thread-79499-1-1.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>LNMP镜像大小大概 733.3MB 解压后大概3006.51MB 。。。没得办法，宝塔的依赖项真的是太多了。。。
在软路由上搞起来先&lt;/p>
&lt;h2 id="先整理端口">先整理端口
&lt;/h2>&lt;p>不打算映射数据出来，方便转移，并预留ssh 和常用端口&lt;/p>
&lt;pre>&lt;code>#宝塔面板 22 ssl http phpmyadmin
-p 51888:8888 -p 51022:22 -p 51443:443 -p 51080:80 -p 51188:888 \
# 路由器封80 443自定义web端口 以及22重复
-p 51081:51081 -p 51444:51444 -p 51000:22 \
# mysql
-p 51306:3306 \
# redis
-p 51379:6379 \
# pgsql
-p 51432:5432 \
# MongoDB
-p 51017:27017 \
# 备用端口
-p 51200-51299:51200-51299 \
&lt;/code>&lt;/pre>
&lt;p>你问我为啥开这么多端口。。我开心我乐意，反正外网又访问不到。。。&lt;/p>
&lt;h2 id="镜像和标签的选择">镜像和标签的选择
&lt;/h2>&lt;p>latest 标签拉取的是lib标签，安装了面板并且安装集成依赖包，安装每个软件都会快一点。&lt;br>
fresh 标签表示安装了面板但是没有安装集成依赖包，安装第一个软件会比较慢，因为需要装依赖包。&lt;br>
lib 标签表示安装了面板并且安装集成依赖包，安装每个软件都会快一点。&lt;br>
lnmp 标签表示安装了面板、集成包并且集成LNMP【Nginx1.22+MySQL5.7+PHP7.4】arm标签是MySQL5.6&lt;br>
lamp 标签表示安装了面板、集成包并且集成LAMP【Apache2.4+MySQL5.7+PHP7.4】arm标签是MySQL5.6&lt;br>
我这里选择&lt;code>lnmp&lt;/code> 经过测试发现，其实还集成了ftp&lt;/p>
&lt;h2 id="目录的挂载">目录的挂载
&lt;/h2>&lt;p>/www/server/data 数据库&lt;br>
/www/wwwroot 网站目录 或者说 静态文件目录&lt;br>
/www/server/panel/vhost 虚拟机主机配置文件&lt;br>
其他目录参考宝塔官网&lt;br>
我不打算映射出来，因为可以在宝塔内挂载oss之类的网盘自动备份。&lt;br>
而且不映射任何目录的话，docker的备份和迁移更为简单简单一些。&lt;/p>
&lt;h2 id="最终命令的整理">最终命令的整理
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --restart unless-stopped --name baota \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51888:8888 -p 51022:22 -p 51443:443 -p 51080:80 -p 51188:888 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51081:51081 -p 51444:51444 -p 51000:22 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51306:3306 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51379:6379 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51432:5432 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51017:27017 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51200-51299:51200-51299 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">btpanel/baota:lnmp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="默认账户名密码-和登录地址">默认账户名密码 和登录地址
&lt;/h2>&lt;p>现在，您可以在浏览器访问默认地址 http://您的ip地址:8888/btpanel 上的宝塔面板。
默认用户：btpanel
默认密码：btpaneldocker
默认SSH密码：用户名 root 密码 btpaneldocker&lt;/p>
&lt;p>默认用户：btpanel&lt;br>
默认密码：btpaneldocker&lt;br>
容器默认SSH密码：btpaneldocker&lt;/p>
&lt;h2 id="其他">其他
&lt;/h2>&lt;h3 id="容器内的服务处理">容器内的服务处理
&lt;/h3>&lt;p>是使用的&lt;code>/bt.sh&lt;/code> 这个文件，除了默认服务之外，其他服务需要自行添加默认内容&lt;/p>
&lt;pre>&lt;code>#!/bin/bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH
init_path=/etc/init.d
Root_Path=`cat /var/bt_setupPath.conf`
Setup_Path=$Root_Path/server/mysql
Data_Path=$Root_Path/server/data
soft_start(){
${init_path}/nginx start
${init_path}/php-fpm-74 start
${init_path}/pure-ftpd start
${init_path}/bt restart
pkill crond
/sbin/crond
/usr/sbin/sshd -D &amp;amp;
}
is_empty_Data(){
return `ls -A ${Data_Path}/|wc -w`
}
init_mysql(){
# initialize_mysql
if [ -f /init_mysql.sh ];then
sh /init_mysql.sh
rm -f /init_mysql.sh
fi
}
start_mysql(){
chown -R mysql:mysql ${Data_Path}
chgrp -R mysql ${Setup_Path}/.
${init_path}/mysqld start
rm -f /init_mysql.sh
}
soft_start &amp;gt; /dev/null
is_empty_Data &amp;gt; /dev/null
if [ $? == 0 ];then
init_mysql &amp;gt; /dev/null
else
start_mysql &amp;gt; /dev/null
fi
tail -f /dev/null
&lt;/code>&lt;/pre>
&lt;h3 id="计划任务的bug">计划任务的bug
&lt;/h3>&lt;p>宿主机运行&lt;/p>
&lt;pre>&lt;code> docker exec -it 容器名称baota bash
pkill crond &amp;amp;&amp;amp; /sbin/crond
&lt;/code>&lt;/pre>
&lt;p>然后重新添加计划任务&lt;/p>
&lt;h3 id="容器内的ssh的bug">容器内的ssh的bug
&lt;/h3>&lt;p>已经默认安装了openssh，但是可能还需要处理一下才可以连接，注意 复制的时候 要看一下宿主机的情况。如果不是host模式的话不存在这个问题&lt;/p>
&lt;pre>&lt;code>#获取容器ID
docker ps|awk 'NR &amp;gt; 1{print$1}'
#复制必要密钥文件到容器内
\cp -r /etc/ssh/ssh_host_* /home/
chmod 600 /home/ssh_host_*
docker cp /home/ssh_host_rsa_key 容器ID:/etc/ssh/
docker cp /home/ssh_host_ecdsa_key 容器ID:/etc/ssh/
docker cp /home/ssh_host_ed25519_key 容器ID:/etc/ssh/
#给容器设置一个root密码，qqwwee123替换成自己想要的密码
docker exec -it 容器ID /bin/bash -c &amp;quot;echo 'qqwwee123'|passwd --stdin root&amp;quot;
#让sshd运行起来
docker exec 容器ID /usr/sbin/sshd -D &amp;amp;
rm -rf /home/ssh_host_*
&lt;/code>&lt;/pre>
&lt;h2 id="问题和其他bug">问题和其他bug
&lt;/h2>&lt;ul>
&lt;li>docker版本更新滞后，也不算大事，宝塔新版问题更多哈哈&lt;/li>
&lt;li>web控制面板卡顿，web终端卡顿 甚至打不开，不缺点是宝塔新版的问题，还是软路由器性能问题&lt;/li>
&lt;li>宝塔内置系统防火墙不可用（docker的限制。不过确实没必要）&lt;/li>
&lt;li>ssl的证书夹在某些特定情况下 无法保存的问题。这个应该是宝塔自己的bug，月经bug 宝塔反反复复，经常间隔几个版本就出现一次 .重新登录一次面板，然后续签一次证书，或者重新部署一次。运气好的话 就好了，或者整个站点都删掉重新添加，运气不好的话，。。。。删了宝塔吧。。&lt;/li>
&lt;li>innodb_log_buffer_size 的bug，这个以及是宝塔本身的月经bug 反复出现，手动设置一下就好&lt;/li>
&lt;li>web面板 配置mysql的界面 mysql状态不显示，这个应该也是宝塔自己的bug，月经bug&lt;/li>
&lt;li>web面板 终端偶尔打不开 应该是xterm和bug，宝塔本身也或许有问题，退出重新登录就好，或者清理浏览器缓存 重新登录&lt;/li>
&lt;li>通知模块偶尔显示 名称：undefined xxx，无配置。。这个也是宝塔的月经bug&lt;/li>
&lt;li>不算是问题，但一定注意第一时间修改 面板用户名密码以及ssh的root密码&lt;/li>
&lt;/ul>
&lt;h2 id="题外话">题外话
&lt;/h2>&lt;p>其实已经很久没有新装过宝塔了，然后发现 现在的宝塔 是bug成堆。。。硬硬把用户当作实验台，略有能力的情况下能不用就不用了吧&lt;br>
以前会去宝塔论坛 认真截图 说复现步骤，反馈，然后论坛客服 除了一堆毫无意义的机械回复，也没啥，有时候反馈一个bug 竟然要回帖数次。。。
基本上 修补了上一个bug 然后出现新bug&lt;/p>
&lt;p>正经的生产环境，真的不怎么建议用宝塔。。。毕竟现在docker环境可选多部署一个新环境也不难&lt;/p></description></item><item><title>docker运行nginx 并反代内网的一些服务，</title><link>https://dev.leiyanhui.com/docker/nginx-proxy-manage/</link><pubDate>Sun, 27 Nov 2022 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/nginx-proxy-manage/</guid><description>&lt;p>本文停止更新，建议使用 nginxwebui ：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl&lt;/p>
&lt;p>支持中文，也支持静态站，甚至可以转发php之类的。&lt;/p>
&lt;p>&lt;code>nginx-proxy-manage&lt;/code> 是一个有web管理解决的 纯nginx管理工具，基于node开发的。类似宝塔。。自带了ssl证书管理（基于Let’s Encrypt的）&lt;/p>
&lt;p>适合 在轻量的主机上运行，例如 软路由。。。&lt;/p>
&lt;p>比宝塔来说优势有&lt;/p>
&lt;ul>
&lt;li>支持更多dns验证api，几乎支持所有的常见国内外域名和dns商，并且支持 acmedns_api&lt;/li>
&lt;li>更加轻量简单
缺点嘛，，就是没有别的功能了。只有nginx 和 ssl 。所以很适合 路由上使用&lt;/li>
&lt;/ul>
&lt;p>要求多的话，还是建议使用宝塔，&lt;a class="link" href="https://dev.leiyanhui.com/docker/baota" target="_blank" rel="noopener"
>现在宝塔官网已经发布docker&lt;/a>&lt;/p>
&lt;h2 id="基本命令">基本命令
&lt;/h2>&lt;p>参考：https://hub.docker.com/r/jlesage/nginx-proxy-manager
改动一下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name=nginx-proxy-manager \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50181:8181 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50080:8080 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50443:4443 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jlesage/nginx-proxy-manager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>web访问端口 是 50080:8080 ssl 50443:4443 管理端口 50181:8181
默认用户名密码 &lt;code>admin@example.com&lt;/code> &lt;code>changeme&lt;/code>&lt;/p>
&lt;h3 id="后续我发现真正的官网镜像实际不是这个">后续我发现真正的官网镜像实际不是这个！
&lt;/h3>&lt;p>而是 &lt;code>jc21/nginx-proxy-manager:latest&lt;/code> 文档地址：https://nginxproxymanager.com/setup/#using-mysql-mariadb-database
并且官网文档是明确支持ipv6的 只是默认禁用&lt;/p>
&lt;h2 id="基本使用">基本使用
&lt;/h2>&lt;h3 id="修改用户密码">修改用户密码
&lt;/h3>&lt;p>登录后就会自动提示修改，按照提示修改一下&lt;/p>
&lt;h3 id="试着申请个域名ssl">试着申请个域名ssl
&lt;/h3>&lt;p>很简单 不用多说，看不懂 自己开翻译软件（吐槽：软路由圈子 英语不好 还不肯开翻译软件的人。。多好。。）&lt;/p>
&lt;h2 id="这个工具存在的问题">这个工具存在的问题
&lt;/h2>&lt;ul>
&lt;li>只支持LE的证书，我本想和acme.sh的配合 使用，发现。。。这货好像把证书放在了数据库里面，，服了。。。然后自定义证书 也只能是上传。。。
&lt;ul>
&lt;li>后续发现存放到了/etc/letsencrypt ，但是格式和acme.sh 不能完全兼容。。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>dns api的配置记录不能自动保存，添加多个证书的时候 需要每次都输入一次 api接口的key信息&lt;/li>
&lt;li>下载回来的证书，只有nginx格式&lt;/li>
&lt;li>面板本身好像不可以直接启用ssl，应该需要sh进去改配置文件，或者自己代理自己一次&lt;/li>
&lt;li>没有中文界面&lt;/li>
&lt;li>镜像体积不小， 182.90MB 左右&lt;/li>
&lt;li>在主机列表页面直接打开对应的域名，是使用默认端口打开。不会帮你跳到&lt;code>50080:8080 ssl 50443:4443&lt;/code>,我node 水平一般也没有找打 队以ing的文件&lt;/li>
&lt;li>同时 在反代 pve 或 openwrt等应用的适合，会导致 vnc或者终端控制台打不开。（这个好像是 noVNC 以及xterm.js的问题）
&lt;ul>
&lt;li>pve可以用 /etc/pve/local/qemu-server/&lt;!-- raw HTML omitted -->.conf &lt;a class="link" href="https://pve.proxmox.com/wiki/VNC_Client_Access" target="_blank" rel="noopener"
>添加vnc配置的方法用客户端链接&lt;/a>&lt;/li>
&lt;li>oc的控制docker台 可以用shell登录后 &lt;code> docker exec -it 容器名 /bin/bash&lt;/code>&lt;/li>
&lt;li>或者docker 另外跑一个浏览器 来访问内网的这个web，然后nginx-proxy-manager再套上ssl 就可以了&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>其他暂未发现&lt;/li>
&lt;/ul>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>很适合要求不高的情况下使用，也适合小白。
其实 还是建议直接docker跑一个宝塔算了，自己用debian、centos基础做也行，现在宝塔官方也支持docker了&lt;/p>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/docker/baota" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/baota&lt;/a>&lt;/p>
&lt;h2 id="另外一个替代项目">另外一个替代项目
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.nginxwebui.cn/" target="_blank" rel="noopener"
>https://www.nginxwebui.cn/&lt;/a>&lt;/p>
&lt;p>简单看了一下 国产的，支持中文，支持负载均衡，但是证书虽然是用 acme.sh ,但是同样也是 只支持 LE的自动续期和申请。。&lt;/p>
&lt;p>使用说明 ：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl&lt;/p>
&lt;p>官网：https://github.com/cym1102/nginxWebUI#docker%E5%AE%89%E8%A3%85%E8%AF%B4%E6%98%8E&lt;/p></description></item><item><title>docker 运行证书管理工具acme.sh</title><link>https://dev.leiyanhui.com/docker/acme-sh/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/acme-sh/</guid><description>&lt;p>支持在所有运行docker的设备上 linux系统 windows macos openwrt unraid pve等 自动申请签发证书（爱快这种畸形的除外）&lt;/p>
&lt;h2 id="简单的运行">简单的运行
&lt;/h2>&lt;pre>&lt;code>docker run --rm -itd \
-v &amp;quot;$(pwd)/out&amp;quot;:/acme.sh \
--net=host \
--name=acme.sh \
neilpang/acme.sh daemon
&lt;/code>&lt;/pre>
&lt;h2 id="使用方法">使用方法
&lt;/h2>&lt;pre>&lt;code>docker exec acme.sh --help
docker exec acme.sh --issue --dns dns_cf -d *.example.com -d example.com
&lt;/code>&lt;/pre>
&lt;h2 id="指定dns的api">指定dns的api
&lt;/h2>&lt;p>走dns验证的，例如cf家的&lt;/p>
&lt;pre>&lt;code>docker run --rm -itd \
-v &amp;quot;$(pwd)/ssl_out&amp;quot;:/acme.sh \
-e CF_Email=&amp;quot;example@example.com&amp;quot; \
-e CF_Key=&amp;quot;asasasasasadasasas&amp;quot; \
--net=host \
--name=acme.sh \
neilpang/acme.sh daemon
&lt;/code>&lt;/pre>
&lt;p>如果是 dnspod&lt;/p>
&lt;pre>&lt;code>export DP_Key=&amp;quot;sADDsdasdgdsf&amp;quot;
docker run --rm -itd \
-v &amp;quot;$(pwd)/ssl_out&amp;quot;:/acme.sh \
-e DP_Id=&amp;quot;1234&amp;quot; \
-e DP_Key=&amp;quot;sADDsdasdgdsf&amp;quot; \
--net=host \
--name=acme.sh \
neilpang/acme.sh daemon
&lt;/code>&lt;/pre>
&lt;p>其他的dns 的api参考 &lt;a class="link" href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi" target="_blank" rel="noopener"
>https://github.com/acmesh-official/acme.sh/wiki/dnsapi&lt;/a>&lt;/p>
&lt;p>如果不支持自动api的话，参考他官网的别名解析验证 &lt;a class="link" href="https://github.com/acmesh-official/acme.sh/wiki/DNS-alias-mode" target="_blank" rel="noopener"
>https://github.com/acmesh-official/acme.sh/wiki/DNS-alias-mode&lt;/a>&lt;/p>
&lt;h2 id="进阶">进阶
&lt;/h2>&lt;p>可以和其他容器 包括 宝塔 或者 nginx-proxy-manager 配合使用（这两个只支持LE的免费域名，兼容性极差）&lt;/p>
&lt;h2 id="其他资源">其他资源
&lt;/h2>&lt;p>支持180天的 （半年的）泛域名 以及 ip申请 ，应该 还是不支持内网ip的&lt;/p>
&lt;p>&lt;a class="link" href="https://hostloc.com/forum.php?mod=viewthread&amp;amp;tid=1050449" target="_blank" rel="noopener"
>https://hostloc.com/forum.php?mod=viewthread&amp;tid=1050449&lt;/a>&lt;/p>
&lt;p>作者主页：https://github.com/Neilpang&lt;/p></description></item><item><title>docker5.7</title><link>https://dev.leiyanhui.com/docker/mysql5-7/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/mysql5-7/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">mysql5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">3306&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3306&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">MYSQL_ROOT_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">123456&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker_data&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker_data&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker_data&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">logs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mysql&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">5.7&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>利用github的actions 编译openwrt</title><link>https://dev.leiyanhui.com/openwrt/github-to-build/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/github-to-build/</guid><description>&lt;p>优势：免去自己搭建环境，利用GitHub的带宽&lt;/p>
&lt;p>本次使用灯大的源,并借鉴KFERMercer的ci&lt;/p>
&lt;pre>&lt;code>https://github.com/coolsnowwolf/lede
https://github.com/KFERMercer/OpenWrt-CI
&lt;/code>&lt;/pre>
&lt;h2 id="复制fork-coolsnowwolf的源">复制Fork coolsnowwolf的源
&lt;/h2>&lt;p>Fork Openwrt&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/coolsnowwolf/lede/fork" target="_blank" rel="noopener"
>https://github.com/coolsnowwolf/lede/fork&lt;/a>&lt;/p>
&lt;h2 id="编辑action文件">编辑action文件
&lt;/h2>&lt;p>复制 &lt;a class="link" href="https://github.com/KFERMercer/OpenWrt-CI/blob/master/openwrt-ci.yml" target="_blank" rel="noopener"
>https://github.com/KFERMercer/OpenWrt-CI/blob/master/openwrt-ci.yml&lt;/a> 的内容编辑&lt;/p>
&lt;p>放置到你fork的仓库的 .github/workflows/openwrt-ci.yml&lt;/p>
&lt;h2 id="其中需要修改的">其中需要修改的
&lt;/h2>&lt;h3 id="启动">启动
&lt;/h3>&lt;pre>&lt;code>on:
push:
branches:
- master
&lt;/code>&lt;/pre>
&lt;p>改为手动执行&lt;/p>
&lt;pre>&lt;code>on:
workflow_dispatch:
&lt;/code>&lt;/pre>
&lt;h3 id="自定义包">自定义包
&lt;/h3>&lt;p>找到你需要安装的包名，官方https://openwrt.org/packages/index/start
Lean/coolsnowwolf 的软件包可以从 make defconfig 配置文件 .config 中找到
添加包到openwrt-ci.yml 中 cat &amp;raquo; .config &amp;laquo;EOF后面&lt;/p>
&lt;h3 id="手动开始">手动开始
&lt;/h3>&lt;p>先更新你的OpenWrt源-&amp;gt; Fetch upstream -&amp;gt; Fetch Merge&lt;/p>
&lt;p>手动开始编译 Action -&amp;gt; OpenWrt-CI -&amp;gt; Run workflow&lt;/p>
&lt;p>大概需要2-3小时，然后下载 ，下载OpenWrt_firmware即可&lt;/p>
&lt;h3 id="初始内容">初始内容
&lt;/h3>&lt;p>&lt;a class="link" href="https://github.com/KFERMercer/OpenWrt-CI/blob/master/openwrt-ci.yml" target="_blank" rel="noopener"
>https://github.com/KFERMercer/OpenWrt-CI/blob/master/openwrt-ci.yml&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is free software, lisence use MIT.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Copyright (C) 2019 P3TERX &amp;lt;https://p3terx.com&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Copyright (C) 2020 KFERMercer &amp;lt;KFER.Mercer@gmail.com&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;lt;https://github.com/KFERMercer/OpenWrt-CI&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">CI&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">on&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">push&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">branches&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># schedule:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># - cron: 0 20 * * *&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">release&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">types&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">published&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">jobs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">build_openwrt&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Build&lt;/span> &lt;span class="n">OpenWrt&lt;/span> &lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">runs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">latest&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">repository&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">owner&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">steps&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Checkout&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">checkout&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ref&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Space&lt;/span> &lt;span class="n">cleanup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">env&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DEBIAN_FRONTEND&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">noninteractive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">docker&lt;/span> &lt;span class="n">rmi&lt;/span> &lt;span class="err">`&lt;/span>&lt;span class="n">docker&lt;/span> &lt;span class="n">images&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="err">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dotnet&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">php&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sources&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">android&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="n">purge&lt;/span> &lt;span class="n">azure&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cli&lt;/span> &lt;span class="n">ghc&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">zulu&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">hhvm&lt;/span> &lt;span class="n">llvm&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">firefox&lt;/span> &lt;span class="n">google&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">dotnet&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">powershell&lt;/span> &lt;span class="n">openjdk&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">adoptopenjdk&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">php&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">mongodb&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">dotnet&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">moby&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">snapd&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="n">update&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">build&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">essential&lt;/span> &lt;span class="n">asciidoc&lt;/span> &lt;span class="n">binutils&lt;/span> &lt;span class="n">bzip2&lt;/span> &lt;span class="n">gawk&lt;/span> &lt;span class="n">gettext&lt;/span> &lt;span class="n">git&lt;/span> &lt;span class="n">libncurses5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">libz&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">patch&lt;/span> &lt;span class="n">python3&lt;/span> &lt;span class="n">unzip&lt;/span> &lt;span class="n">zlib1g&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">lib32gcc1&lt;/span> &lt;span class="n">libc6&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i386&lt;/span> &lt;span class="n">subversion&lt;/span> &lt;span class="n">flex&lt;/span> &lt;span class="n">uglifyjs&lt;/span> &lt;span class="n">gcc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">multilib&lt;/span> &lt;span class="n">g&lt;/span>&lt;span class="o">++-&lt;/span>&lt;span class="n">multilib&lt;/span> &lt;span class="n">p7zip&lt;/span> &lt;span class="n">p7zip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">full&lt;/span> &lt;span class="n">msmtp&lt;/span> &lt;span class="n">libssl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">texinfo&lt;/span> &lt;span class="n">libglib2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">xmlto&lt;/span> &lt;span class="n">qemu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">utils&lt;/span> &lt;span class="n">upx&lt;/span> &lt;span class="n">libelf&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">autoconf&lt;/span> &lt;span class="n">automake&lt;/span> &lt;span class="n">libtool&lt;/span> &lt;span class="n">autopoint&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">compiler&lt;/span> &lt;span class="n">antlr3&lt;/span> &lt;span class="n">gperf&lt;/span> &lt;span class="n">swig&lt;/span> &lt;span class="n">libtinfo5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="n">autoremove&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">purge&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="n">clean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sudo mkdir -p -m 777 /mnt/openwrt/bin /mnt/openwrt/build_dir/host /mnt/openwrt/build_dir/hostpkg /mnt/openwrt/dl /mnt/openwrt/feeds /mnt/openwrt/staging_dir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/bin ./bin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># mkdir -p ./build_dir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s -f /mnt/openwrt/build_dir/host ./build_dir/host&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s -f /mnt/openwrt/build_dir/hostpkg ./build_dir/hostpkg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/dl ./dl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/feeds ./feeds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/staging_dir ./staging_dir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Update&lt;/span> &lt;span class="n">feeds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">./&lt;/span>&lt;span class="n">scripts&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">feeds&lt;/span> &lt;span class="n">update&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">./&lt;/span>&lt;span class="n">scripts&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">feeds&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Generate&lt;/span> &lt;span class="n">configuration&lt;/span> &lt;span class="n">file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="o">./.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">touch&lt;/span> &lt;span class="o">./.&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 在 cat &amp;gt;&amp;gt; .config &amp;lt;&amp;lt;EOF 到 EOF 之间粘贴你的编译配置, 需注意缩进关系&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 例如:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cat&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_TARGET_IMAGES_GZIP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_KERNEL_BUILD_USER&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;OpenWrt-CI&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_KERNEL_BUILD_DOMAIN&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Azure&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ===============================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sed&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="s1">&amp;#39;s/^[ &lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">]*//g&amp;#39;&lt;/span> &lt;span class="o">./.&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">make&lt;/span> &lt;span class="n">defconfig&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Make&lt;/span> &lt;span class="n">download&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">make&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j8&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">make&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j1&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">dl&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1024&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Compile&lt;/span> &lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">make&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nproc&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">make&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j1&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;=======================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;Space usage:&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;=======================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;=======================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">du&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="o">./&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">depth&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">du&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">openwrt&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">depth&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Prepare&lt;/span> &lt;span class="n">artifact&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">buildinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">d&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;packages&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cp&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">firmware&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cp&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">packages&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;*.ipk&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">package&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cp&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;*.buildinfo&amp;#34;&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;*.manifest&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">buildinfo&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Deliver&lt;/span> &lt;span class="n">buildinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt_buildinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">buildinfo&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Deliver&lt;/span> &lt;span class="n">package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt_package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">package&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Deliver&lt;/span> &lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt_firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Upload&lt;/span> &lt;span class="n">release&lt;/span> &lt;span class="n">asset&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">event&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;release&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">svenstaro&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">release&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">action&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">repo_token&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{{&lt;/span> &lt;span class="n">secrets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">YOURTOKEN&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">firmware&lt;/span>&lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tag&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{{&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ref&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_glob&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="一个例子">一个例子
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is free software, lisence use MIT.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Copyright (C) 2019 P3TERX &amp;lt;https://p3terx.com&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Copyright (C) 2020 KFERMercer &amp;lt;KFER.Mercer@gmail.com&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;lt;https://github.com/KFERMercer/OpenWrt-CI&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">CI&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">on&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">workflow_dispatch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#push:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># branches: &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># - master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># schedule:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># - cron: 0 20 * * *&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">release&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">types&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">published&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">jobs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">build_openwrt&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Build&lt;/span> &lt;span class="n">OpenWrt&lt;/span> &lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">runs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">latest&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">repository&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">owner&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sender&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">steps&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Checkout&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">checkout&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ref&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Space&lt;/span> &lt;span class="n">cleanup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">env&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DEBIAN_FRONTEND&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">noninteractive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">docker&lt;/span> &lt;span class="n">rmi&lt;/span> &lt;span class="err">`&lt;/span>&lt;span class="n">docker&lt;/span> &lt;span class="n">images&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">q&lt;/span>&lt;span class="err">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dotnet&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">php&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sources&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">android&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="n">purge&lt;/span> &lt;span class="n">azure&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cli&lt;/span> &lt;span class="n">ghc&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">zulu&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">hhvm&lt;/span> &lt;span class="n">llvm&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">firefox&lt;/span> &lt;span class="n">google&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">dotnet&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">powershell&lt;/span> &lt;span class="n">openjdk&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">adoptopenjdk&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">mysql&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">php&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">mongodb&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">dotnet&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">moby&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">snapd&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="n">update&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">build&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">essential&lt;/span> &lt;span class="n">asciidoc&lt;/span> &lt;span class="n">binutils&lt;/span> &lt;span class="n">bzip2&lt;/span> &lt;span class="n">gawk&lt;/span> &lt;span class="n">gettext&lt;/span> &lt;span class="n">git&lt;/span> &lt;span class="n">libncurses5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">libz&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">patch&lt;/span> &lt;span class="n">python3&lt;/span> &lt;span class="n">unzip&lt;/span> &lt;span class="n">zlib1g&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">lib32gcc1&lt;/span> &lt;span class="n">libc6&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i386&lt;/span> &lt;span class="n">subversion&lt;/span> &lt;span class="n">flex&lt;/span> &lt;span class="n">uglifyjs&lt;/span> &lt;span class="n">gcc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">multilib&lt;/span> &lt;span class="n">g&lt;/span>&lt;span class="o">++-&lt;/span>&lt;span class="n">multilib&lt;/span> &lt;span class="n">p7zip&lt;/span> &lt;span class="n">p7zip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">full&lt;/span> &lt;span class="n">msmtp&lt;/span> &lt;span class="n">libssl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">texinfo&lt;/span> &lt;span class="n">libglib2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">xmlto&lt;/span> &lt;span class="n">qemu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">utils&lt;/span> &lt;span class="n">upx&lt;/span> &lt;span class="n">libelf&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dev&lt;/span> &lt;span class="n">autoconf&lt;/span> &lt;span class="n">automake&lt;/span> &lt;span class="n">libtool&lt;/span> &lt;span class="n">autopoint&lt;/span> &lt;span class="n">device&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tree&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">compiler&lt;/span> &lt;span class="n">antlr3&lt;/span> &lt;span class="n">gperf&lt;/span> &lt;span class="n">swig&lt;/span> &lt;span class="n">libtinfo5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="n">autoremove&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">purge&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="n">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">get&lt;/span> &lt;span class="n">clean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sudo mkdir -p -m 777 /mnt/openwrt/bin /mnt/openwrt/build_dir/host /mnt/openwrt/build_dir/hostpkg /mnt/openwrt/dl /mnt/openwrt/feeds /mnt/openwrt/staging_dir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/bin ./bin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># mkdir -p ./build_dir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s -f /mnt/openwrt/build_dir/host ./build_dir/host&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s -f /mnt/openwrt/build_dir/hostpkg ./build_dir/hostpkg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/dl ./dl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/feeds ./feeds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ln -s /mnt/openwrt/staging_dir ./staging_dir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Update&lt;/span> &lt;span class="n">feeds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;src-git helloworld https://github.com/fw876/helloworld.git&amp;#34;&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="s2">&amp;#34;feeds.conf.default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">./&lt;/span>&lt;span class="n">scripts&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">feeds&lt;/span> &lt;span class="n">update&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">./&lt;/span>&lt;span class="n">scripts&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">feeds&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Generate&lt;/span> &lt;span class="n">configuration&lt;/span> &lt;span class="n">file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="o">./.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">touch&lt;/span> &lt;span class="o">./.&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 在 cat &amp;gt;&amp;gt; .config &amp;lt;&amp;lt;EOF 到 EOF 之间粘贴你的编译配置, 需注意缩进关系&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 例如:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cat&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_LUCI_LANG_en&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_LUCI_LANG_zh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">baidupcs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cifs&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mount&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">wireguard&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dns&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">netdata&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">p910nd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">plus&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">plus_INCLUDE_Hysteria&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">plus_INCLUDE_IPT2Socks&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">plus_INCLUDE_Trojan&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">turboacc_INCLUDE_DNSFORWARDER&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">turboacc_INCLUDE_DNSPROXY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">uugamebooster&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">syncdial&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># CONFIG_PACKAGE_luci-app-unblockmusic is not set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># CONFIG_PACKAGE_luci-app-ttyd is not set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># CONFIG_PACKAGE_luci-app-xlnetacc is not set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">theme&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">argon&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">theme&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">theme&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">material&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_luci&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">theme&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">netgear&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_ddns&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scripts_cloudflare&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v4&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_ddns&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scripts_no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ip_com&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_ddns&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">scripts_route53&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_bind&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dig&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_nano&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_qrencode&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_open&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_whois&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_nmap&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONFIG_PACKAGE_ipv6helper&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ===============================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sed&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="s1">&amp;#39;s/^[ &lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">]*//g&amp;#39;&lt;/span> &lt;span class="o">./.&lt;/span>&lt;span class="n">config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">make&lt;/span> &lt;span class="n">defconfig&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Make&lt;/span> &lt;span class="n">download&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">make&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j8&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">make&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j1&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">dl&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1024&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Compile&lt;/span> &lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">make&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nproc&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">make&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">j1&lt;/span> &lt;span class="n">V&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;=======================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;Space usage:&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;=======================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;=======================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">du&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="o">./&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">depth&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">du&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">h&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">openwrt&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">depth&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Prepare&lt;/span> &lt;span class="n">artifact&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mkdir&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">buildinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">d&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;packages&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cp&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">firmware&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cp&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">packages&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;*.ipk&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">package&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cp&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;*.buildinfo&amp;#34;&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="s2">&amp;#34;*.manifest&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">buildinfo&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Deliver&lt;/span> &lt;span class="n">buildinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt_buildinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">buildinfo&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Deliver&lt;/span> &lt;span class="n">package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt_package&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">package&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Deliver&lt;/span> &lt;span class="n">firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">actions&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">OpenWrt_firmware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">targets&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Upload&lt;/span> &lt;span class="n">release&lt;/span> &lt;span class="n">asset&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">event&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;release&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uses&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">svenstaro&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">upload&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">release&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">action&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">v2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">with&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">repo_token&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{{&lt;/span> &lt;span class="n">secrets&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">YOURTOKEN&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">artifact&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">firmware&lt;/span>&lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tag&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{{&lt;/span> &lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ref&lt;/span> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_glob&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>本文参考：https://github.com/P3TERX/Actions-OpenWrt&lt;/p></description></item><item><title>openwrt 的docker无法联网的问题</title><link>https://dev.leiyanhui.com/openwrt/docker-cant-network/</link><pubDate>Fri, 25 Nov 2022 22:27:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/docker-cant-network/</guid><description>&lt;p>这个好像也是openwrt的问题。。&lt;/p>
&lt;h2 id="临时方法用host网络解决">临时方法，用host网络解决
&lt;/h2>&lt;p>例如创建一个支持sshd的alpine&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -i -t -d --name alpine-sshd --network host --privileged=true --restart=always alpine:sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然不能和宿主机的端口冲突。。。 这个问题不算彻底解决 ,用host的方式 如果多个容器使用同样的默认端口 就 gg了&lt;/p>
&lt;h2 id="彻底解决">彻底解决
&lt;/h2>&lt;p>如果要彻底解决，还是要修改防火墙设置&lt;/p>
&lt;p>打开 openwrt的网络设置，Luci&amp;gt;网络&amp;gt;防火墙&amp;gt;Luci&amp;gt;网络&amp;gt;防火墙&amp;gt;转发：接受 （Forward：accept）&lt;code>http://**/cgi-bin/luci/admin/network/firewall&lt;/code>&lt;/p>
&lt;p>然后 shell登录到openwrt 执行命令&lt;/p>
&lt;pre>&lt;code>iptables -t nat -A POSTROUTING -s 172.17.0.1/16 ! -o docker0 -j MASQUERADE
&lt;/code>&lt;/pre>
&lt;p>注意&lt;code>172.17.0.1&lt;/code>要修改成的你自己的docker的桥接地址段&lt;/p>
&lt;p>查看方式&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker network ls # 看一下 bridge 对的那一串id
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker network inspect 1914ac9dc9c9 | grep Subnet # 1914ac9dc9c9 是上面对应的那一串id
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后需要重启一下docker&lt;/p>
&lt;pre>&lt;code> /etc/init.d/dockerd restart
&lt;/code>&lt;/pre>
&lt;h2 id="进阶">进阶
&lt;/h2>&lt;h3 id="把docker作为内网的一台机器使用">把docker作为内网的一台机器使用
&lt;/h3>&lt;p>因为没有系统的学习过docker，简单看了一下手册就用了多年，一直不知道docker的虚拟网络是怎么玩的，在一次使用路由器的国产垃圾固件爱快的时候发现了他默认的docekr网络模式，然后才去翻看手册&lt;/p>
&lt;p>可以实现，自定义docker的ip端， 并实现 网内机器互联，并可以在路由上直接转发对应的端口&lt;/p>
&lt;pre>&lt;code>docker network create --subnet=10.0.100.1/24 mynet # 删除命令 docker network rm mynet
docker run -i -t -d --name alpine-188 --network=mynet --ip 10.0.100.188 --privileged=true --restart=always alpine:sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/code>&lt;/pre></description></item><item><title>openwrt /linux下 使用rclone挂载 网络磁盘到本地：阿里云盘为例</title><link>https://dev.leiyanhui.com/openwrt/rclone/</link><pubDate>Fri, 25 Nov 2022 04:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/rclone/</guid><description>&lt;h2 id="最近已经全部改为alist">最近已经全部改为alist
&lt;/h2>&lt;p>alist支持的网盘更一些，而且默认支持webdav。直接装到路由器上了。&lt;br>
然后路由器安装了&lt;code>luci-app-rclone&lt;/code>，运行&lt;code>rclone config --config /etc/rclone/rclone.conf&lt;/code> 处理配置文件，添加一个节点 alist到 http://10.1.1.1:5244/dav 配置好帐号密码&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir /alist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone mount alist: /alist --allow-other --allow-non-empty --vfs-cache-mode writes --config /etc/rclone/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="后面是原文">后面是原文
&lt;/h2>&lt;p>要想挂载阿里云盘，需要先把阿里云盘挂载到webdav&lt;/p>
&lt;h2 id="阿里云盘的处理">阿里云盘的处理
&lt;/h2>&lt;h3 id="先挂载阿里云盘到webdav">先挂载阿里云盘到webdav
&lt;/h3>&lt;h4 id="openwrt-插件方法">openwrt 插件方法
&lt;/h4>&lt;blockquote>
&lt;p>虽然实际很稳定，但是不建议，能docker的不要做插件&lt;/p>&lt;/blockquote>
&lt;p>插件方式 参考 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openwrt-plus/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/openwrt-plus/&lt;/a>&lt;/p>
&lt;h4 id="docker方法">docker方法
&lt;/h4>&lt;pre>&lt;code>docker run -d --name=aliyundrive-webdav --restart=unless-stopped -p 50082:8080 \
-e REFRESH_TOKEN='48e136dc87ce4d44bf1af9ef8ff3987d' \
-e WEBDAV_AUTH_USER=77777 \
-e WEBDAV_AUTH_PASSWORD=88888888 \
messense/aliyundrive-webdav
&lt;/code>&lt;/pre>
&lt;p>docker的网络问题处理，请查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/docker-cant-network" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/docker-cant-network&lt;/a>&lt;/p>
&lt;h2 id="rclone安装和使用">rclone安装和使用
&lt;/h2>&lt;h3 id="插件或者直接安装方式">插件或者直接安装方式
&lt;/h3>&lt;p>插件安装方式 参考 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openwrt-plus/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/openwrt-plus/&lt;/a>&lt;/p>
&lt;h3 id="配置">配置
&lt;/h3>&lt;p>运行&lt;code>rcone config&lt;/code> 按照提示先创建一个挂载配置，选择&lt;code>webdav&lt;/code>，然后 输入webdav的用户名密码，使用 &lt;code>Nextcloud WebDAV&lt;/code> 模式，&lt;/p>
&lt;p>最后放到openwrt的计划任务里面，写到启动命令里面 ，有时候 无效&lt;/p>
&lt;p>&lt;code>/mnt/aliyunpan&lt;/code> 是要挂载到本地的目录，提前&lt;code>mkdir /mnt/aliyunpan&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">*/1 * * * * rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="docker方式">docker方式。
&lt;/h3>&lt;p>说实话 有点复制，因为要操作宿主机，还要配置。但是不是不可以实现。官网的解决方法 是宿主机配置config文件后映射进去 (问号脸，，宿主机不安装rclone怎么弄他配置文件嘛。。。)
另外还有权限问题 需要处理 要用用户信息 还有fuse的处理，&lt;/p>
&lt;p>如果你要弄的话，不在宿主机安装rclone 就需要docker运行多次后重新打包镜像。
我这里就不折腾rclone docker化了。
shell如下，官网说明 &lt;a class="link" href="https://rclone.org/install/" target="_blank" rel="noopener"
>https://rclone.org/install/&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir -p ~/data/mount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run --rm \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --volume ~/.config/rclone:/config/rclone \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --volume ~/data:/data:shared \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --user $(id -u):$(id -g) \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --volume /etc/passwd:/etc/passwd:ro --volume /etc/group:/etc/group:ro \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/fuse --cap-add SYS_ADMIN --security-opt apparmor:unconfined \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rclone/rclone \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mount dropbox:Photos /data/mount &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ls ~/data/mount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kill %1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="挂载其他网盘">挂载其他网盘
&lt;/h2>&lt;p>如果是 google 或者 OneDrive国外版，需要全局科学上网。 其他都没啥问题，不用多说。&lt;/p></description></item><item><title>openwrt 常用插件 的docker处理</title><link>https://dev.leiyanhui.com/openwrt/docker-plus/</link><pubDate>Fri, 25 Nov 2022 04:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/docker-plus/</guid><description>&lt;p>插件尽量docker化，1是更新方便 2 是出问题 不会影响 主要功能。&lt;/p>
&lt;h2 id="docker-安装">docker 安装
&lt;/h2>&lt;pre>&lt;code>opkg install docker dockerd luci-app-dockerman luci-i18n-dockerman-zh-cn
&lt;/code>&lt;/pre>
&lt;h2 id="docker-内容器无法联网的bug处理">docker 内容器无法联网的bug处理
&lt;/h2>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/docker-cant-network/" target="_blank" rel="noopener"
>这个应该是openwrt的默认设置问题，也可以说是bug,点这里查看&lt;/a>&lt;/p>
&lt;h2 id="docker里面跑一个支持sshd的linux系统的方法">docker里面跑一个支持sshd的Linux系统的方法
&lt;/h2>&lt;p>因为docker 一般不建议多个服务在同一个容器里面，所以默认并没有提供类似的方法。
但是不建议，不是说不可以。 &lt;a class="link" href="https://dev.leiyanhui.com/docker/alpine-sshd" target="_blank" rel="noopener"
>点这里查看，也可以用我打包好&lt;/a>&lt;/p>
&lt;h2 id="docker里面运行一个桌面版linux的方法">docker里面运行一个桌面版Linux的方法
&lt;/h2>&lt;p>同样 也是可以实现的，甚至可以调用显卡加速。&lt;a class="link" href="https://dev.leiyanhui.com/c/docker-linux-desktop/" target="_blank" rel="noopener"
>点这里查看&lt;/a>&lt;/p>
&lt;h2 id="网上教程没有告诉你的几个坑">网上教程没有告诉你的几个坑
&lt;/h2>&lt;p>限于多数openwrt的新玩家都是linux小白，难免会遇到很多坑&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/docker-cant-network/" target="_blank" rel="noopener"
>openwrt的docker默认无法访问外网的处理&lt;/a>&lt;/li>
&lt;li>部分容器内的时间错误：启动的时候加环境变量 &lt;code>-e TZ=Asia/Shanghai&lt;/code>&lt;/li>
&lt;li>容器自定义网段 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/docker-cant-network/" target="_blank" rel="noopener"
>本文文末&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ddns">DDNS
&lt;/h2>&lt;p>&lt;code>jeessy/ddns-go:latest &lt;/code> 支持 阿里 腾讯 百度 华为 cf 等 几个国内常用的，但是不支持 3322
&lt;code>qmcgaw/ddns-updater&lt;/code> 支持很多国内国外的，但是貌似也不支持3322&lt;/p>
&lt;p>但是 3322 可以直接 lynx -mime_header -auth=用户名:密码 &amp;ldquo;&lt;a class="link" href="http://members.3322.net/dyndns/update?system=dyndns&amp;amp;hostname=" target="_blank" rel="noopener"
>http://members.3322.net/dyndns/update?system=dyndns&amp;hostname=&lt;/a>域名&amp;rdquo; 这样&lt;/p>
&lt;h2 id="阿里云盘webdav">阿里云盘webdav
&lt;/h2>&lt;p>&lt;code> messense/aliyundrive-webdav&lt;/code>
因为 插件的这个 还不错，所以暂时没有docker化&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --name=aliyundrive-webdav --restart=unless-stopped -p 50082:8080 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /etc/aliyundrive-webdav/:/etc/aliyundrive-webdav/ \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e REFRESH_TOKEN=&amp;#39;&amp;lt;your refresh token&amp;gt;&amp;#39; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e WEBDAV_AUTH_USER=admin \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e WEBDAV_AUTH_PASSWORD=admin \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> messense/aliyundrive-webdav
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>精简一下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --name=aliyundrive-webdav --restart=unless-stopped -p 50082:8080 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e REFRESH_TOKEN=&amp;#39;tttttttttttttt&amp;#39; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e WEBDAV_AUTH_USER=uuuuuuuuuu \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e WEBDAV_AUTH_PASSWORD=ppppppppppppppp \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> messense/aliyundrive-webdav
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="frps-内网穿透服务端">frps 内网穿透服务端
&lt;/h2>&lt;pre>&lt;code>snowdreamtech/frpc
这个暂时用插件，没有docker化，懒得弄
&lt;/code>&lt;/pre>
&lt;h2 id="kms">kms
&lt;/h2>&lt;pre>&lt;code>mikolatero/vlmcsd
opkg remove luci-app-vlmcsd
rm -rf /etc/config/vlmcsd
opkg remove vlmcsd
docker run -d -p 1688:1688 --restart=always --name=&amp;quot;kms-vlmcsd&amp;quot; -e TZ=Asia/Shanghai mikolatero/vlmcsd
&lt;/code>&lt;/pre>
&lt;p>激活方法： &lt;a class="link" href="https://hub.docker.com/r/mikolatero/vlmcsd/" target="_blank" rel="noopener"
>https://hub.docker.com/r/mikolatero/vlmcsd/&lt;/a>&lt;/p>
&lt;h2 id="v2ray">v2ray
&lt;/h2>&lt;pre>&lt;code>mzz2017/v2raya
docker run -d --restart=always --privileged \
--network=host \
--name v2raya \
-e TZ=Asia/Shanghai \
-v /etc/resolv.conf:/etc/resolv.conf \
mzz2017/v2raya
&lt;/code>&lt;/pre>
&lt;p>挂载 /etc/resolv.conf 是为了开透明代理，我测试发现 v2ray 里面 经常会导致 全局断网。。。有点坑 所以还是docker 来跑,并且还是不用host模式了
，非host模式 不可以使用透明模式的全局代理，但是同样不会影响局域网内其他不需要科学学习的用户。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> docker run -d --restart=unless-stopped \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 2017:2017 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 20170-20173:20170-20173 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name v2raya \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e TZ=Asia/Shanghai \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mzz2017/v2raya
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="文件管理-filebrowser">文件管理 filebrowser
&lt;/h2>&lt;p>也是一个网盘工具&lt;/p>
&lt;pre>&lt;code>docker run -d \
--name filebrowser \
-v /CUSTOM_PATH:/srv \
-v /PATH_OF_DATABASE/filebrowser.db:/database.db \
--user $(id -u):$(id -g) \
-p 8080:80 \
-e TZ=Asia/Shanghai \
--restart=unless-stopped \
filebrowser/filebrowser
&lt;/code>&lt;/pre>
&lt;h2 id="让他可以直接访问-openwrt的根目录">让他可以直接访问 openwrt的根目录
&lt;/h2>&lt;p>简化一下&lt;/p>
&lt;pre>&lt;code>docker run -d \
--name filebrowser \
-v /:/srv \
--user $(id -u):$(id -g) \
-p 50088:80 \
-e TZ=Asia/Shanghai \
--restart=unless-stopped \
filebrowser/filebrowser
&lt;/code>&lt;/pre>
&lt;h2 id="另外运行一个作为正经-网盘使用">另外运行一个作为正经 网盘使用
&lt;/h2>&lt;pre>&lt;code>docker run -d \
--name filebrowser-netdisk \
-v /mnt:/srv \
--user $(id -u):$(id -g) \
-p 50089:80 \
-e TZ=Asia/Shanghai \
--restart=unless-stopped \
filebrowser/filebrowser
&lt;/code>&lt;/pre>
&lt;p>临时用是可以的，正经用，还是用nextcloud owncloud 之类的&lt;/p>
&lt;h2 id="全docker搭建媒体中心">全docker搭建媒体中心
&lt;/h2>&lt;p>比较长，点击本文查看
&lt;a class="link" href="https://dev.leiyanhui.com/docker/mediavodcenter/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/mediavodcenter/&lt;/a>&lt;/p>
&lt;h2 id="docker搭建-rustdesk-私有中转服务器">docker搭建 rustdesk 私有中转服务器
&lt;/h2>&lt;p>以前有记录 &lt;a class="link" href="https://dev.leiyanhui.com/docker/rustdesk-server/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/rustdesk-server/&lt;/a>&lt;/p></description></item><item><title>openwrt 常用插件安装</title><link>https://dev.leiyanhui.com/openwrt/openwrt-plus/</link><pubDate>Fri, 25 Nov 2022 04:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/openwrt-plus/</guid><description>&lt;h2 id="准备安装">准备安装
&lt;/h2>&lt;p>opkg update
软件包名称里面字带luci 都是可以再openwrt网页端管理的，安装后 都要重启一次openwrt后 网页端才可以显示出来。&lt;br>
名字里面带 luci-i18n 都是网页端语言包&lt;/p>
&lt;p>下面常用的命令 &lt;code>wget &lt;/code> 是下载 &lt;code>rm -rf *.ipk &lt;/code>是删除当前目录下的所有 ipk文件 opkg 前文解释过&lt;/p>
&lt;h3 id="软件安装的原则和整个网络的部署">软件安装的原则和整个网络的部署
&lt;/h3>&lt;p>关于路由器的软件和插件的一个原则。&lt;/p>
&lt;ul>
&lt;li>如果你路由器磁盘工具不是特紧张，尽量用docker跑第三方插件。这样某一个插件挂了，也只会影响其中一个服务。能用docker跑的，就不要装单独的插件。这也是 我一直不推荐 使用第三方固件的一个原因。&lt;/li>
&lt;li>同样，能用路由解决的，尽量不装到主路由上。&lt;/li>
&lt;li>all in one 方案，因为经常折腾甚至重启，尽量不要把主路由的功能弄进来。&lt;/li>
&lt;li>x86的主路由，虽然说不需要太高性能，但是还是尽量提一点点。哪怕cpu不好升级，内存尽可能高一点。那么做ramdisk 都比小的了。我们软路由用的都是古董级的平台，内存又不值钱。&lt;/li>
&lt;li>主路由器上 尽量不折腾虚拟机，能用docker的不要用虚拟机。所以是否支持虚拟化真的不重要，有那个钱，不如加点内存和ssd 换一个好点的电源。省下钱，以后蹲万兆机器多好。除非你机器性能真的可以，而且还真的需要跑一个win。。另外docker里面可以套kvm的 性能也没啥损耗，自己慢慢研究&lt;/li>
&lt;/ul>
&lt;p>后面这些软件，都是我多年使用可以稳定运行 不会影响主路由器，也不出现乱七八糟幺蛾子的软件，所以我暂时直接安装，先跑起来，后续慢慢挪到docker&lt;/p>
&lt;h3 id="docker容器">docker容器
&lt;/h3>&lt;pre>&lt;code>opkg install docker dockerd luci-app-dockerman luci-i18n-dockerman-zh-cn
&lt;/code>&lt;/pre>
&lt;h3 id="frps-内网穿透服务端">frps 内网穿透服务端
&lt;/h3>&lt;p>你要装客户端 就是 frpc了，在openwrt 的software里面 网页端搜索 frpc 安装对应名称的三个包 就ok了&lt;/p>
&lt;pre>&lt;code>opkg install frps luci-app-frps luci-i18n-frps-zh-cn
&lt;/code>&lt;/pre>
&lt;h3 id="阿里云盘webdav">阿里云盘webdav
&lt;/h3>&lt;p>我这里wget命令后面多了&lt;code>https://ghproxy.com/&lt;/code> 这个地址，是为了给github加速的，目前最新版是1.10.3-1,如果你看到这个文章很久了，那么就去 &lt;a class="link" href="https://github.com/messense/aliyundrive-webdav/" target="_blank" rel="noopener"
>https://github.com/messense/aliyundrive-webdav/&lt;/a> 作者主页看看哦，releases里面 找最新版 然后 show all 就可以看到 ipk的文件了，右键复制链接就好&lt;/p>
&lt;pre>&lt;code>wget https://ghproxy.com/https://github.com/messense/aliyundrive-webdav/releases/download/v1.10.3/aliyundrive-webdav_1.10.3-1_x86_64.ipk
wget https://ghproxy.com/https://github.com/messense/aliyundrive-webdav/releases/download/v1.10.3/luci-app-aliyundrive-webdav_1.10.3_all.ipk
wget https://ghproxy.com/https://github.com/messense/aliyundrive-webdav/releases/download/v1.10.3/luci-i18n-aliyundrive-webdav-zh-cn_1.10.3-1_all.ipk
opkg install aliyundrive-webdav_1.10.3-1_x86_64.ipk
opkg install luci-app-aliyundrive-webdav_1.10.3_all.ipk
opkg install luci-i18n-aliyundrive-webdav-zh-cn_1.10.3-1_all.ipk
rm -rf *.ipk #清理
&lt;/code>&lt;/pre>
&lt;h3 id="kms-那个啥啥啥你懂就好">kms 那个啥啥啥你懂就好
&lt;/h3>&lt;pre>&lt;code>wget https://op.supes.top/packages/x86_64/vlmcsd_svn1113-19_x86_64.ipk
wget https://op.supes.top/packages/x86_64/luci-app-vlmcsd_git-23.326.49742-f588991_all.ipk
opkg install vlmcsd_svn1113-19_x86_64.ipk
opkg install luci-app-vlmcsd_git-23.326.49742-f588991_all.ipk
rm -rf *.ipk #清理
&lt;/code>&lt;/pre>
&lt;h3 id="v2raya-那个啥啥啥你懂就好">v2raya 那个啥啥啥你懂就好
&lt;/h3>&lt;pre>&lt;code>opkg install v2raya
wget https://op.supes.top/packages/x86_64/luci-app-v2raya_git-23.326.49742-f588991_all.ipk
opkg install luci-app-v2raya_git-23.326.49742-f588991_all.ipk
rm -rf *.ipk #清理
&lt;/code>&lt;/pre>
&lt;h3 id="ddns-动态dns">ddns 动态dns
&lt;/h3>&lt;pre>&lt;code>opkg install luci-app-ddns
opkg install luci-i18n-ddns-zh-cn
&lt;/code>&lt;/pre>
&lt;h3 id="doh-dns-over-https">doh dns over https
&lt;/h3>&lt;p>这个安装配置完成后，需要再次重启一次 才可以生效&lt;/p>
&lt;pre>&lt;code>opkg install https-dns-proxy luci-app-https-dns-proxy luci-i18n-https-dns-proxy-zh-cn
ping whoami.akamai.net # 测试doh
&lt;/code>&lt;/pre>
&lt;h1 id="rclone">rclone
&lt;/h1>&lt;pre>&lt;code>opkg install rclone
wget https://op.supes.top/packages/x86_64/luci-app-rclone_git-23.298.65872-3ec93ac_all.ipk
opkg install luci-app-rclone_git-23.298.65872-3ec93ac_all.ipk #依赖 rclone rclone-config rclone-webui-react rclone-ng. luci-app-rclone
&lt;/code>&lt;/pre>
&lt;h2 id="rclone-配置">rclone 配置
&lt;/h2>&lt;p>测试了一下 rclone-webui-react rclone-ng 莫名其妙的一堆错误，懒得处理，还是直接命令行来搞&lt;/p>
&lt;pre>&lt;code>rclone config
&lt;/code>&lt;/pre>
&lt;p>如果要挂载ali云盘的话 在 aliyundrive-webdav 要勾选 禁用重定向 也就是 &amp;ndash;no-redirec 参数，
后面也是以阿里云盘为例子 路径的写法 为 rclone配置名称:/远程路径 /本地路径&lt;/p>
&lt;pre>&lt;code>mkdir /mnt/aliyunpan
rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime
&lt;/code>&lt;/pre>
&lt;p>测试没问题问题后，把这个命令 放到 计划任务 cron 里面 或者 后面加&lt;code> &amp;amp;&lt;/code>写到 openwrt的开机启动&lt;/p></description></item><item><title>openwrt分区扩容的问题---多数openwrt固件的一个巨坑 保姆教程/ 顺带 linux和openwrt 扫盲 /常用扩展插件安装</title><link>https://dev.leiyanhui.com/openwrt/disk-part-bug/</link><pubDate>Thu, 24 Nov 2022 04:40:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/disk-part-bug/</guid><description>&lt;p>今天第一次弄x86的openwrt，遇到分区扩容的一个坑。网上太多太多的资料 都是坑。&lt;/p>
&lt;p>原因是原版的openwrt 有一个挂载的覆盖的bug，多数固件并未解决。我一开始用squashfs的固件，都没有搞定，最后换到ext4 解决。前后折腾2个多小时。
具体可以参考：https://github.com/openwrt/openwrt/issues/7352&lt;/p>
&lt;p>然后下午在群里，发现有人手把手教别人弄，最后还是出现和我一样的问题。&lt;/p>
&lt;blockquote>
&lt;p>df -h 查看容量正常，但是网页端 software查看容量 并没有增加。装软件也会提示容量不足&lt;/p>&lt;/blockquote>
&lt;p>我的解决办法 就是用ext4模式安装，我用的官网的ext4固件。因为我设备是x86 并且没有很特殊的硬件，官网固件都是可以驱动的（N2600显卡除外，非efi模式启动黑屏）&lt;/p>
&lt;p>如果你也和我一样 是x86的路由，那么强烈建议你用最精简的官网固件,原因&lt;/p>
&lt;ul>
&lt;li>第三方固件，不安全，虽然说都号称没有后门，但是你有时间和精力 或者有能力去查找后门嘛？&lt;/li>
&lt;li>鉴于openwrt这个圈子的特殊性，与其相信第三方固件作者是用爱发电，我更多相信他是一个半吊子菜鸟一时的热忱&lt;/li>
&lt;li>但openwrt圈内也确实有一些 完全开源甚至编译过程都开源的第三方固件，但是我们没有那么多时间去甄别，更没有那么多时间和经历 去折腾试用&lt;/li>
&lt;li>openwrt 是一个完整的linux系统，官网固件只要能开机，能识别你的有线网卡，或者usb口，哪怕只能识别显示屏，那么剩下的都可以解决&lt;/li>
&lt;li>openwrt 本身是一个很强壮 稳定高性能的 路由器系统，所有的问题 都出在第三方固件作者和 第三方插件上！！！看看那些第三方固件作者的声明&lt;/li>
&lt;li>第三方作者的水平层次不齐，甚至论坛上下载过万的固件 哪怕他最精简的版本bug多到都无法完成最基本的路由功能！&lt;/li>
&lt;li>当然，如果你网卡不识别，并且还是linux小白，又不想学习，那么就冒险试用第三方，或者付费找人编译吧。能用钱和安全解决的 问题，都不是问题 哈哈。&lt;/li>
&lt;li>如果有时间又能力去编译自定义固件，那么这个文章和这个观点也不适合你，自己忽略就好了。&lt;/li>
&lt;/ul>
&lt;p>今天群里还有人问 官网地址。。。&lt;code> www.openwrt.org&lt;/code>&lt;/p>
&lt;h2 id="下载官网稳定版固件">下载官网稳定版固件
&lt;/h2>&lt;p>下载地址： &lt;a class="link" href="https://archive.openwrt.org/releases/" target="_blank" rel="noopener"
>https://archive.openwrt.org/releases/&lt;/a>
选择版本 再选择 cpu平台 就可以了。我这里是x86 64位的 cpu，所以 依次点击 22.03.2 -&amp;gt; targets -&amp;gt; x86 -&amp;gt; 64 ，然后选择 generic-ext4-combined.img.gz 这个ext4分区的&lt;/p>
&lt;p>如果你机器只支持efi启动不支持传统bois启动，那就选generic-ext4-combined-efi.img.gz，如果同时支持，那么还是建议无脑选这个。如果你情况特殊非要用efi 那就选择 generic-ext4-combined-efi.img.gz 这个&lt;/p>
&lt;p>很多第三方固件是 squashfs-combined 的，如果制作者没有处理overlay的bug，那么肯定会遇到挂载问题，网上有资料说可以通过删除/etc 目录的方法来解决，但是我试过也不行。&lt;/p>
&lt;p>还有群友说看不懂英文的官网。。那么你就直接点我下面地址下载好了&lt;/p>
&lt;p>我最终选中的固件是截至目前最新的稳定版：https://archive.openwrt.org/releases/22.03.2/targets/x86/64/openwrt-22.03.2-x86-64-generic-ext4-combined.img.gz&lt;/p>
&lt;p>下载后 解压，不会解压或者你的解压工具出错，那么就直接用 winrar 解压他。 解压后是一个img文件&lt;/p>
&lt;h2 id="刷入硬盘">刷入硬盘
&lt;/h2>&lt;p>如果你原来是squashfs 那么是无法从op的网页后台升级刷入ext4的固件的，需要重新硬刷。&lt;/p>
&lt;p>一般建议 是 吧上面的&lt;code>openwrt-22.03.2-x86-64-generic-ext4-combined.img.gz&lt;/code> 解压后，从winpe下，或者linux live下 或者干脆把 硬盘挂到另外一个电脑，用&lt;code>balenaEtcher&lt;/code> 或DD命令等 写盘工具写入到对应的磁盘&lt;/p>
&lt;p>这个经常折腾系统的，都会，就不用细说了。 不会刷的，就自己搜一下balenaEtcher 的教程，基本就是 选择磁盘文件*.img 选择磁盘，写入 等待写入 等待校验 ，就完事了。&lt;/p>
&lt;h2 id="什么都不要动-直接去开机">什么都不要动 直接去开机
&lt;/h2>&lt;p>网上很多教程，甚至是都一个文章抄出来的，说让你 在diskgen下调整分区，这个方法很不靠谱，且不说 diskgen对linux的分区支持不好，你可能压根操作不了，再说，diskgen可能会破坏UUID或者分区表兼容性，会导致 fstab和gurb出错。导致你的openwrt 压根启动不起来&lt;/p>
&lt;p>linux下的文件系统，你尽量少用win下的软件去鼓捣。第三方的这些商业化软件 ，真的不靠谱。&lt;/p>
&lt;p>所以 如果你调整不了 或 调整后启动不起来 那么是正常的。 不要用diskgen调整分区！！！ 不要用diskgen调整分区！！！不要用diskgen调整分区！！！&lt;/p>
&lt;h2 id="启动openwrt">启动openwrt
&lt;/h2>&lt;p>电脑接入openwrt，可以网线直接插上，也可以接入下属ap设备的wifi。自动获取ip，获取到 192.168.1.XX的就对了。
官网版本默认网页地址是： http://192.168.1.1 用户名 root 密码 空的&lt;/p>
&lt;p>进入后，先拨号 联网，官网版本全英文界面 ，看不懂 自己手机翻译&lt;/p>
&lt;p>点击 NetWork &amp;gt; Interfaces&lt;/p>
&lt;p>编辑 edit wan口，接入方式 默认是dhcp 切换到 pppoe 会提示一次确认切换，然后输入 宽带用户密码，保存 应用保存(aplay save)&lt;/p>
&lt;p>或者干脆直接接到 你现在的路由下dhcp自动获取ip，然后在现在的路由器 的dhcp列表里面找到他的ip然后用对应的ip 打开网页 以及登录shell
正常就可以拨号成功了。&lt;/p>
&lt;h2 id="shell登录openwrt">shell登录openwrt
&lt;/h2>&lt;p>如果用putty 或者 其他工具比如MobaXterm fineshell 等等，甚至 win10以上电脑的cmd都可以。这里以简单的cmd命令好为例,win10、win11 下 win+R 快捷键，运行 cmd
在 cmd 窗口输入
执行 &lt;code>ssh root@192.168.1.1&lt;/code> 第一次登录 会处理key的问题，输入yes 确认， 因为现在密码是空的不用输入密码 就可以了登录了。&lt;/p>
&lt;p>如果有提示known_hosts的错误，打开 &lt;code>C:\Users\你的用户名\.ssh&lt;/code> 这个隐藏文件夹，删除 known_hosts 文件，或者记事本打开编辑一下删除对应的行。&lt;/p>
&lt;p>后面多数操作都是基于shell下的openwrt 。虽然很多操作是可以在网页端完成的，只是点来点去麻烦&lt;/p>
&lt;h2 id="准备安装软件">准备安装软件
&lt;/h2>&lt;h3 id="修改国内源此步骤可以省略">修改国内源（此步骤可以省略）
&lt;/h3>&lt;p>以修改清华源为例，执行以下命令sed正则替换downloads.openwrt.org为清华源的地址，如果你用其他源 找一下官网帮助，修改下面的命令就好&lt;/p>
&lt;pre>&lt;code>sed -i 's_downloads.openwrt.org_mirrors.tuna.tsinghua.edu.cn/openwrt_' /etc/opkg/distfeeds.conf
&lt;/code>&lt;/pre>
&lt;p>或者你用&lt;code>vim /etc/opkg/distfeeds.conf&lt;/code> 手动编辑也行。
执行完成后更新一次本地list，记得openwrt每次重启后，如果要安装软件，都需要在网页端更新一次list 或者 shell执行下面命令。这个是openwrt的机制，他把源的数据放内存去了。重启就就没有了。&lt;/p>
&lt;pre>&lt;code>opkg update
&lt;/code>&lt;/pre>
&lt;h2 id="安装常用的磁盘工具">安装常用的磁盘工具
&lt;/h2>&lt;p>op的官网版本 极度精简，精简到只有核心的基本功能，所以多数工具需要自己装。用过opwnwrt的都知道 ，约少的功能和插件，才越稳定。很多国内第三方固件，精简版，还要收费。。。真的 是坑小白。。。&lt;/p>
&lt;pre>&lt;code>opkg install block-mount fdisk cfdisk lsblk
&lt;/code>&lt;/pre>
&lt;p>解释下opkg 是openwrt的包管理工具的安装,同其他linux发行版的 apk apt yum pacman 等命令一样道理 ，你可以理解成 Windows的 exe msi setup等可以直接双击安装的安装包&lt;/p>
&lt;p>安装：&lt;code>opkg install 在线软件包名称或者本地路径&lt;/code> &lt;br>
卸载:先查看&lt;code>opkg list_installed&lt;/code> 然后卸载&lt;code>opkg remove 软件包名（上一步找到的名称）&lt;/code>&lt;/p>
&lt;ul>
&lt;li>block-mount 是一个可以在openwrt网页端 操作挂载点的工具，这也是为什么你的openwrt菜单 系统下 没有挂载点这个按钮的原因 就是缺少这个包&lt;/li>
&lt;li>fdisk 磁盘分区工具管理 同Windows下的fdisk 一样的&lt;/li>
&lt;li>cfdisk 命令行可视化的磁盘分区工具，你可以理解为 这就是一个简化的linux版本 diskgen，或者fdisk的易用性工具&lt;/li>
&lt;li>lsblk 磁盘分区和挂载点的一个查看工具&lt;/li>
&lt;/ul>
&lt;p>上面的 cfdisk lsblk 甚至block-mount 都不是必须软件，但是为了简单使用，还是建议你参考我教程 都装上，这些软件也都很小&lt;/p>
&lt;p>block-mount 安装完成后 需要重启一下 openwrt ，才可以在网页端的 系统菜单 找到 mount/挂载点 这个按钮&lt;/p>
&lt;h2 id="安装网页中文汉化包和主题此步骤可以省略">安装网页中文汉化包和主题（此步骤可以省略）
&lt;/h2>&lt;pre>&lt;code>opkg install luci-i18n-base-zh-cn luci-theme-material
&lt;/code>&lt;/pre>
&lt;p>解释&lt;/p>
&lt;ul>
&lt;li>luci-i18n-base-zh-cn 是网页端的中文语言包&lt;/li>
&lt;li>luci-theme-material 是一个左右分栏，并且兼容手机等设备的openwrt网页界面主题，也可以不装，随便你。&lt;/li>
&lt;/ul>
&lt;p>中文语言包，虽然可以自动识别，但是部分软件 会显示中英文混杂的情况，所以最好 还是在 openwrt网页端的 system(系统) -&amp;gt; system(系统) -&amp;gt; lanuage and style(语言和主题) 选择一下 简体中文&lt;/p>
&lt;p>主题 可以选择前面安装的 material，也可用默认的&lt;/p>
&lt;h2 id="开始之前-linux的磁盘管理的入门扫盲小知识">开始之前 linux的磁盘管理的入门扫盲小知识
&lt;/h2>&lt;p>window 我们都知道 有C盘D盘什么的，但是linux 不存在这个，Linux下 一切皆为文件，包括硬件设备的：内存 硬盘 usb 甚至显卡 等等，这些都是文件，对应的 都是 Linux下 /dev下的文件。
我们所有的硬件的操作，都是对 /dev下的文件的操作。&lt;/p>
&lt;p>因为没有C D 盘符的概念，linux下完整的路径 都是以&lt;code>/xxx&lt;/code> 开头的，而非Windows下 C:/ D:/ 这样开头的&lt;/p>
&lt;p>我们都知道 Windows可以修改盘符，比如 我可以把D盘从windows磁盘管理里面 分别E给他，他就同时可以用D和E 两个盘符了，删掉D 就变成E。 linux下就是用挂载和解除挂载的方式来解决不同分区的路径变化。。&lt;/p>
&lt;p>如果是临时的挂载，我们直接用 &lt;code>mount /dev/【磁盘名称】【分区编号】 /【挂载地址】&lt;/code> 命令就可以了。如果是开机启动挂载，就需要修改/etc 目录的下的 fstab文件&lt;/p>
&lt;p>/etc这个目录，你可以理解成 Windows 的注册表 组策略。 几乎所有的软件和系统的配置项 都在这个目录里面。&lt;/p>
&lt;p>但是因为直接编辑 /etc/fstab 这个文本文件，需要处理uuid可能不太直观，而且可能还存在其他分区甚至U盘 sd卡等，所以我们在openwrt下借用 上面说的&lt;code>block-mount&lt;/code> 这个软件包，可以可视化的在openwrt网页端来操作。后续管理u盘sd卡 或nas也方便&lt;/p>
&lt;h2 id="处理分区和磁盘">处理分区和磁盘
&lt;/h2>&lt;p>cmd再次登录到openwrt的shell下，执行命令 &lt;code>fdisk -l&lt;/code> 查看磁盘&lt;/p>
&lt;pre>&lt;code>root@OpenWrt:~# fdisk -l
Disk /dev/sda: 29.5 GiB, 31675383808 bytes, 61865984 sectors
Disk model: BIWIN SSD
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: C120D9F5-D6F9-D15B-05A7-0D348F8A4B00
Device Start End Sectors Size Type
/dev/sda1 512 33279 32768 16M Linux filesystem
/dev/sda2 33280 246271 212992 104M Linux filesystem
/dev/sda128 34 511 478 239K BIOS boot
Partition table entries are not in disk order.
&lt;/code>&lt;/pre>
&lt;p>我这里 就一个磁盘 磁盘名称是 sda&lt;code>Disk /dev/sda: 29.5 GiB&lt;/code>，有三个分区 sda1 sda2 sda128&lt;/p>
&lt;ul>
&lt;li>sda1 是他的基本启动文件&lt;/li>
&lt;li>sda2 就是openwrt的系统分区，如果是overlay的openwrt固件情况还要复杂一些，如果你要用overlay,不妨去看一下overlay相关的文章。我这里是ext4的固件，所以简单很多。
如果你是efi的镜像，可能还多出来一个efi分区。&lt;/li>
&lt;/ul>
&lt;p>如果你要有多个磁盘，注意看 每一个磁盘的名字 还有 磁盘的编号。如果是nvme 磁盘的换，多数是&lt;code>/dev/nvmeXXX&lt;/code> mmc磁盘的话&lt;code>/dev/mmcXXX&lt;/code> 虚拟机的话根据虚拟平台不一样可能是&lt;code>/dev/vdXXXX&lt;/code> &lt;code>/dev/vmXXX&lt;/code> &lt;code>/dev/virXXX&lt;/code> &lt;code>/dev/qemuXXX&lt;/code> u盘或者sd卡的话，那么多数就usb 或者 sd开头的&lt;/p>
&lt;p>我们现在需要增加容量的磁盘上扩建空间，我这里 以我的/dev/sda 这个磁盘为例子，shell命令再次执行&lt;code>cfdisk /dev/sda&lt;/code>（ 空格后面 指的要操作的磁盘 ）&lt;/p>
&lt;p>用键盘方向键操作，上下键盘，选择中绿色的部分 free space （空闲空间） 左右键 选择 New（新建）回车，输入新分区的容量。 你可以弄一个1-2G的给系统用，剩下一点分区给docker用（挂载到/opt）或者干脆简单简单的 全部空间 给到系统&lt;/p>
&lt;p>然后 会新建一个分区 /dev/sdaXXX 我 这里是/dev/sda3, 然后左右键 选择 保存（write）输入 &lt;code>yes&lt;/code>确认 左右键选择退出（quit）&lt;/p>
&lt;p>这样我们就新建了一个分区&lt;/p>
&lt;h2 id="格式化这个新分区">格式化这个新分区
&lt;/h2>&lt;p>Windows下格式化命令 我们都知道 是format，Linux下用 mkfs.XXX, Linux常用的分区很多种，这里不展开说，但是这里肯定适合用NTFS exfat fat之类，不是说不能用，而是说稳定性和速度在linux下表现不好，
所以还是用linux的常用分区格式，我这里用传统的ext4 兼容性和稳定最好&lt;/p>
&lt;pre>&lt;code>mkfs.ext4 /dev/sda3
&lt;/code>&lt;/pre>
&lt;h2 id="不要关闭shell回到openwrt网页端处理挂载">不要关闭shell，回到openwrt网页端处理挂载
&lt;/h2>&lt;p>点 系统&amp;gt; 挂载点 &lt;code>生成配置&lt;/code> 自动生成配置&lt;/p>
&lt;p>在挂载点那个位置，可以看到 多出来的一个分区/dev/sda3 他想自动挂载到/mnt/sda3上，我们编辑一下这条&lt;/p>
&lt;p>UUID 保持是这个分区的没错 我这里是&lt;code>xx-xx-xx /dev/sda3 29.38G&lt;/code>&lt;/p>
&lt;p>挂载点选择 &lt;code>/ 作为根目录使用&lt;/code>&lt;/p>
&lt;p>然后看一下这行地方有一个提示&lt;code> 根目录准备，确保使用以下命令来复制根文件系统&lt;/code>，后面几行命令，其中一行 &lt;code>mount /dev/sda1 /tmp/extroot&lt;/code>&lt;/p>
&lt;p>这个地方 他的实例是处理的/dev/sda1 第一分区，需要改为你刚刚新建的分区 我这是&lt;code>/dev/sda3&lt;/code>，最终命令和解释&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir -p /tmp/introot #创建一个文件夹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p /tmp/extroot #创建一个文件夹
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount --bind / /tmp/introot # 用临时屏蔽的方法 挂载/ 到introot这个目录 方便我们后面复制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/sda3 /tmp/extroot # 这行需要编辑一下 把我们的新建的分区 临时挂载到extroot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -C /tmp/introot -cvf - . | tar -C /tmp/extroot -xf - # 用tar的方式，把原来根分区的 文件 保留权限同步复制到extroot（/dev/sda3 就是新分区） 并打印出详细信息和进度
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">umount /tmp/introot # 取消挂载
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">umount /tmp/extroot # 取消挂载
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>先在网页的 保存挂载点的配置，然后删除 和sda2 之前的那个100M左右的分区的挂载。 然后应用保存。
再把上面的命令逐行 或者全部复制到 openwrt的shell 里面 执行&lt;/p>
&lt;p>注意顺序别搞错了。&lt;/p>
&lt;h2 id="重启检查">重启检查
&lt;/h2>&lt;p>重启路由器，启动完成后检查 shell运行&lt;code>df -h&lt;/code>&lt;/p>
&lt;pre>&lt;code>root@OpenWrt:~# df -h
Filesystem Size Used Available Use% Mounted on
/dev/root 102.3M 20.5M 79.7M 20% /rom
tmpfs 1.9G 572.0K 1.9G 0% /tmp
/dev/sda3 28.8G 348.8M 26.9G 1% /
/dev/sda1 16.0M 5.7M 10.2M 36% /boot
/dev/sda1 16.0M 5.7M 10.2M 36% /boot
tmpfs 512.0K 0 512.0K 0% /dev
/dev/sda3 28.8G 348.8M 26.9G 1% /opt/docker
&lt;/code>&lt;/pre>
&lt;p>shell运行&lt;code>lsblk&lt;/code>&lt;/p>
&lt;pre>&lt;code>root@OpenWrt:~# lsblk
NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS
sda 8:0 0 29.5G 0 disk
├─sda1 8:1 0 16M 0 part /boot
│ /boot
├─sda2 8:2 0 104M 0 part /rom
├─sda3 8:3 0 29.4G 0 part /opt/docker
│ /
└─sda128 259:0 0 239K 0 part
&lt;/code>&lt;/pre>
&lt;p>网页端依次点开 系统 Software 查看 Free space 30G 左右&lt;/p>
&lt;p>这就正常了&lt;/p>
&lt;h2 id="后续--安装常用插件">后续- 安装常用插件
&lt;/h2>&lt;p>能用docker跑的，尽量用docker，能放到旁路路由的尽量不要放主路由&lt;/p>
&lt;p>安装方法和清单 &lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openwrt-plus/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/openwrt-plus/&lt;/a>&lt;/p>
&lt;h2 id="最后写在结尾的话">最后写在结尾的话
&lt;/h2>&lt;p>openwrt这个国内圈子有一点畸形，做固件的也不是什么大神，更多是一些linux一知半解的小白的做，可能比完全不懂linux的你好不到哪里去。甚至还有收费的第三方定制固件，甚至还有x86的精简固件收费。。有点匪夷所思。&lt;/p>
&lt;p>openwrt群里，还一些人自己可以编译固件 沾沾自喜自诩为大神 甚至收费。。&lt;/p>
&lt;p>其实 openwrt 是一个完整的linux系统，只是官网没有出iso安装镜像，而且img格式的磁盘镜像。 大部分内容你甚至可以直接挂载img文件编辑后写入磁盘。。。&lt;/p>
&lt;p>最后，openwrt本身很强壮很稳定， 不稳定的是第三方插件。&lt;/p>
&lt;p>所以能不用第三方固件 就不要用，能用精简版 就不要用什么高大全，能修改img文件搞定的事情，就不要自己编译固件。折腾。&lt;/p>
&lt;p>如果是x86_64 尽量用ext4的方法安装，系统如果损坏有资料需要导出或者文件误删除 都好处理。overlay 系统恢复初始化简单一些。但是扩容这个地方需要自己编译固件，或者用第三方已经处理好的固件来弄。
完整编译一次固件，看网络和机器性能 差不多需要2-4小时时间，得不偿失。。&lt;/p></description></item><item><title>输入法的选择，win linux macos 安卓 ios</title><link>https://dev.leiyanhui.com/c/inputexe/</link><pubDate>Sat, 22 Oct 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/c/inputexe/</guid><description>&lt;h1 id="输入法的选择">输入法的选择
&lt;/h1>&lt;h2 id="输入法的选择-1">输入法的选择
&lt;/h2>&lt;h2 id="先说结论">先说结论
&lt;/h2>&lt;blockquote>
&lt;p>rime为主，独立帐号的百度输入法 辅助&lt;/p>&lt;/blockquote>
&lt;h2 id="本文最后一次更新2022年11月29日">本文最后一次更新2022年11月29日。
&lt;/h2>&lt;p>win linux 已经 全部切换到 rime。安卓有客户端，但是研究过怎么用，我安卓是备用电话机。。
ios 暂时还是用的百度输入法。 美区有&lt;code>iRime&lt;/code> (没开源国区下架了)1.99刀，可以用。
linux下偶尔也用&lt;code>fcitx-googlepinyin&lt;/code> 比较轻量&lt;/p>
&lt;p>优点:&lt;/p>
&lt;ul>
&lt;li>流畅 非常非常流畅，哪怕momo7w这种N年前都百元平板上都可以流畅输入&lt;/li>
&lt;li>无隐私问题&lt;/li>
&lt;li>字库可以自己git 或者 坚果云 备份&lt;/li>
&lt;li>除了ios之外所有平台可用&lt;/li>
&lt;li>皮肤可以自定义 可以自行配置&lt;/li>
&lt;li>扩展性很强&lt;/li>
&lt;li>开源 快平台&lt;/li>
&lt;li>标准词库格式&lt;/li>
&lt;/ul>
&lt;p>缺点：&lt;/p>
&lt;ul>
&lt;li>新人初次上手难度大 需要设置的地方多 部分配置需要自行修改配置文件&lt;/li>
&lt;li>没有云输入，也就是新鲜热词词库是没有的&lt;/li>
&lt;li>linux不支持&lt;code>fcitx-cloudpinyin&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>官网地址：https://rime.im 下载链接：&lt;a class="link" href="https://rime.im/download/" target="_blank" rel="noopener"
>https://rime.im/download/&lt;/a>
win下叫做 小狼毫 linux下可选 fcitx-rime(第三方) 或者 ibus-rime
===========以下是旧文章================&lt;/p>
&lt;h2 id="再说原因">再说原因
&lt;/h2>&lt;blockquote>
&lt;p>win mac ios 安卓 部分Linux桌面版可以用 词库过得去 ios下基本完美 语音识别准确率过得去&lt;/p>&lt;/blockquote>
&lt;h2 id="不选择其他的原因">不选择其他的原因
&lt;/h2>&lt;blockquote>
&lt;p>· QQ拼音 不支持非Linux 和mac 不考虑 · 搜狗拼音且不说广告【百度拼音可以说没有】，ios下频繁消失的问题频繁出现 · 讯飞 mac和linux支持不好 · 搜狗 另外在多数linux发行版上面没有词库同步&lt;/p>&lt;/blockquote>
&lt;p>#再说缺点&lt;/p>
&lt;blockquote>
&lt;p>· 李彦宏家的 这货&amp;hellip; 隐私问题 独立账号登陆吧 · 设置同步 好像有逻辑问题，比如候选词9个，就不行 · 有时候按错键莫名其妙插入emjo表情，在一些在线编辑器就成了上传图片 · 没有错键识别纠正，比如 jiuzheng 我如果按成kiuzheng 不会自动纠正&lt;/p>&lt;/blockquote></description></item><item><title>openwrt上搭建rustdesk中转服务器</title><link>https://dev.leiyanhui.com/openwrt/rustdesk/</link><pubDate>Thu, 27 Jan 2022 23:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/rustdesk/</guid><description>&lt;p>rustdesk 是一个免费开源的远程桌面控制软件。但是官方默认提供的中转服务器速度较慢。&lt;/p>
&lt;p>如果你有公网ip可以自己搭建一个中转服务器。&lt;/p>
&lt;p>以下基于openwrt x86_64 ，使用docker安装,root登录openwrt shell 执行下面命令&lt;/p>
&lt;h2 id="安装和启动">安装和启动
&lt;/h2>&lt;p>我这里禁止了没有key的用户链接，防止被滥用 就是hbbr加参数&lt;code> -k _&lt;/code>。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker image pull rustdesk/rustdesk-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /v/rustdesk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker stop hbbs &amp;amp;&amp;amp; docker rm hbbs &amp;amp;&amp;amp; docker stop hbbr &amp;amp;&amp;amp; docker rm hbbr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --restart=always --name=hbbs --hostname hbbs \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --net=host \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-v /v/rustdesk:/root rustdesk/rustdesk-server hbbs -r 外网IP或者DDNS域名 -k
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --restart=always --name=hbbr --hostname hbbr \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --net=host \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-v /v/rustdesk:/root rustdesk/rustdesk-server hbbr -k _
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>官方文档没说明&lt;/p>&lt;/blockquote>
&lt;h2 id="防火墙">防火墙
&lt;/h2>&lt;p>然后需要在openwrt下防火墙开放对应的端口。
我这里是用的Socat,添加对应的 &lt;code>21115-21119&lt;/code> 端口到路由器自己即可&lt;/p>
&lt;h2 id="客户端链接">客户端链接
&lt;/h2>&lt;p>客户端只需要修改 id服务器地址，然后输入key即可。 需要 控制端 和被控端 都要添加！&lt;/p>
&lt;blockquote>
&lt;p>有偿提供上行500M的国内中转，支持ipv6 ，加密链接，支持2k 60帧。35元一年，联系 &lt;a class="link" href="mailto:joyanhui@qq.com" >joyanhui@qq.com&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="查看key">查看key
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat /root/id_ed25519.pub
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="重置key-以及删除-中转服务">重置key 以及删除 中转服务
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm -rf /v/rustdesk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker stop hbbs &amp;amp;&amp;amp; docker rm hbbs &amp;amp;&amp;amp; docker stop hbbr &amp;amp;&amp;amp; docker rm hbbr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>删除后重新创建 即可&lt;/p>
&lt;h2 id="更新">更新
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker stop hbbs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker stop hbbr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull rustdesk/rustdesk-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker start hbbs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker start hbbr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt上搭建私有网盘 和 私有网盘的备份</title><link>https://dev.leiyanhui.com/docker/my-net-disk/</link><pubDate>Thu, 27 Jan 2022 23:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/my-net-disk/</guid><description>&lt;h2 id="需求">需求
&lt;/h2>&lt;p>备份 书签 密码，一些脚本 配置文件等。支持webdav sftp smb 等，支持手机照片视频备份。还有在线编辑md文件 sh文件等。&lt;/p>
&lt;h2 id="为什么要搭建私有网盘">为什么要搭建私有网盘
&lt;/h2>&lt;ul>
&lt;li>穷，但是有公网宽带，以及本身就有一个24小时的开机的pc server&lt;/li>
&lt;li>国内网盘审查太严，lsp都懂&lt;/li>
&lt;li>国内网盘功能阉割太离谱，比如 webdav sftp等协议都不要想了。&lt;/li>
&lt;li>唯一一个支持webdav的网盘 很坑&lt;/li>
&lt;li>自主可控，部分文件可以推送到github备份一次&lt;/li>
&lt;/ul>
&lt;h2 id="私有网盘适合储存什么东西">私有网盘适合储存什么东西
&lt;/h2>&lt;p>私密文件（不是说的自拍视频），还有一些 一些脚本，代码 等。&lt;/p>
&lt;h2 id="lsp应该选什么网盘">lsp应该选什么网盘
&lt;/h2>&lt;p>自建nas可能是最适合的，没条件的可以选择 115 pikpak，而不是我这个方案&lt;/p>
&lt;h2 id="私有网盘的选择">私有网盘的选择
&lt;/h2>&lt;p>选择用户群相对较多的 nextcloud&lt;/p>
&lt;h2 id="照片和视频的处理">照片和视频的处理
&lt;/h2>&lt;p>因为openwrt上没有那么多磁盘工具，所有照片和视频 用Nextcloud 加密后，储存到本地挂载的其他网盘（阿里云盘 123pan）&lt;/p>
&lt;h2 id="代码和脚本的备份">代码和脚本的备份
&lt;/h2>&lt;p>集成到docker内部&lt;/p>
&lt;h2 id="为什么要docker弄">为什么要docker弄
&lt;/h2>&lt;p>为了方便备份 ，op折腾挂了，不会有问题。可以从别的机器上秒启动。&lt;/p>
&lt;h2 id="最后说-all-in-one-和群晖">最后说 All in one 和群晖
&lt;/h2>&lt;p>我之前 一直是k2p 刷的op 用了好像10多年，但是随着宽带的升级，越来越力不从心。
后来尝试更换到 以N2600 做主路由，k2p 做AP 使用，再加上一个 i7 8代 的all in one。。而后发现一个问题。。&lt;/p>
&lt;h2 id="最后说某果云">最后说某果云
&lt;/h2>&lt;p>之前一直用 某果云 用 作为floccus的同步空间。
先不说价格，问题是他付费后速度也很拉跨，而且不可以退款！！！
免费版说是有1G流量，帐号一直显示只用30M的时候，客户端停止工作。。。&lt;/p></description></item><item><title>openwrt端口转发 包括ipv6</title><link>https://dev.leiyanhui.com/openwrt/ipv6-v4-port/</link><pubDate>Wed, 12 Jan 2022 07:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/ipv6-v4-port/</guid><description>&lt;h2 id="简单的说">简单的说
&lt;/h2>&lt;p>基于supes.top的定制固件&lt;br>
1、防火墙选nftables&lt;br>
2、安装软件包&lt;code>socat&lt;/code> 包名称&lt;code>luci-app-socat&lt;/code>&lt;/p>
&lt;h2 id="可以解决的问题">可以解决的问题
&lt;/h2>&lt;p>1、 ipv6 和ipv4 一起转发给内网ipv4&lt;br>
2、 解决 openwrt 不能自己访问 公网地址：自己转发的端口 &lt;br>
3、luci-app-ipsec-server 的一些莫名其妙问题，比如无法链接，链接上缺无法访问内网 或者无法访问外网 无法走梯子 等等&lt;/p>
&lt;p>第二个问题 是多数固件都存在的问题，如果你想在openwrt上作一个转发内网的服务 并用公网地址访问的就麻烦&lt;/p></description></item><item><title>openwrt 内网套ssl，以及内网标准端口自动跳转非标端口的方法</title><link>https://dev.leiyanhui.com/openwrt/acme-ssl/</link><pubDate>Mon, 10 Jan 2022 20:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/acme-ssl/</guid><description>&lt;p>使用acme.sh 自动管理申请证书，并在openwrt上的luci（nginx）上使用。&lt;/p>
&lt;p>由于家用宽带没有80 443端口，所以内网访问到 https://你的域名 自动跳转到 https://你的域名:10443&lt;/p>
&lt;h2 id="op上套ssl">op上套ssl
&lt;/h2>&lt;h3 id="在openwrt上安装acmesh">在openwrt上安装acme.sh
&lt;/h3>&lt;p>直接安装 &lt;code>luci-app-acme&lt;/code> 这个包，依赖会自动安装上。 配置&lt;/p>
&lt;blockquote>
&lt;p>如果是x86路由，建议docker运行nginx-proxy-manage 或 nginxWebUi等工具，他们自带了acme.sh。支持反向代理什么的。
luci-app-acme 界面有一点怪。&lt;br>
新增 Certificate config 名称随便输入不能用特殊符号 &lt;br>
配置，输入 Domain names，如果要泛域名 一起输入，例如 dev.leiyanhui.com 和 *.dev.leiyanhui.com&lt;/p>&lt;/blockquote>
&lt;p>Challenge Validation 这里设置一下&lt;/p>
&lt;p>Validation method 验证模式，在沒有80 443端口的情況下，要實現自動續簽只能使用dns验证的哈
DNS API 接口，我这里用dnspods的，输入&lt;code>dns_dp&lt;/code>
DNS API credentials: 这里输入 你dnspods的 token id 和密码 例如：&lt;code>DP_Id=&amp;quot;123456&amp;quot;&lt;/code> 再加一行&lt;code>DP_Key=&amp;quot;XXXXXXXX&amp;quot;&lt;/code>&lt;br>
nginx 的那个勾选上&lt;br>
高级设置里面，Days until renewal 输入一个时间，就是续签时间证书的有窍时间，输入一个小于90的数字&lt;/p>
&lt;p>稍后会自动申请ssl下来，证书目录 在&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/acme/你的域名/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="简单处理openwrt的nginx证书">简单处理openwrt的nginx证书
&lt;/h3>&lt;p>openwrt的配置文件 /etc/nginx/uci.conf 但这个文件实际是tmp目录ln过来的修改后无效&lt;/p>
&lt;p>如果你不需要443自动重定向端口功能，可以直接用ls方法 替换证书文件，可以跳过下面的操作继续看后面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mv /etc/nginx/conf.d/_lan.crt /etc/nginx/conf.d/_lan.crt.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv /etc/nginx/conf.d/_lan.key /etc/nginx/conf.d/_lan.key.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s /etc/acme/你的域名/fullchain.cer /etc/nginx/conf.d/_lan.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s /etc/acme/你的域名/你的域名.key /etc/nginx/conf.d/_lan.key
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="重启nginx">重启nginx
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> /etc/init.d/nginx restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完毕&lt;/p>
&lt;h2 id="配置443-自动转发到10443">配置443 自动转发到10443
&lt;/h2>&lt;blockquote>
&lt;p>因为在openwrt搭建了nginxWebUI 用来套内网的服务，并且使用了非标准端口。为了避免麻烦，所以加一个自动跳转&lt;/p>&lt;/blockquote>
&lt;p>可以使用插件&lt;code>luci-app-nginx-manager&lt;/code> ，或者自己在shell里面编辑 文件&lt;code>/etc/config/nginx &lt;/code>(可以替换证书)&lt;/p>
&lt;p>我这里用&lt;code>luci-app-nginx-manager&lt;/code> 新增一个配置文件&lt;code>web_jump&lt;/code> 路径&lt;code>/etc/nginx/conf.d/web_jump.conf&lt;/code> 内容如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen [::]:80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 443 ssl http2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen [::]:443 ssl http2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name 你的域名;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /etc/acme/你的域名/fullchain.cer;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /etc/acme/你的域名/你的域名.key;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host:10443$request_uri;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>注意，如果自己在其他地方反代http（s）://路由器内网ip，请不要传递host，不然这里会定位 这里站点造成死循环多次跳转 就打不开了。&lt;/p>&lt;/blockquote>
&lt;h3 id="nginxwebui的双acmesh">nginxWebUI的双acme.sh
&lt;/h3>&lt;p>另外 如果 和 nginxWebUI 配合的话，可以不用在op上另外安装acme.sh，改为计划任务定时从 nginxWebUI容器cp证书出来。当然也可以挂载出来。&lt;br>
为了方便docker的备份（阿里云提供免费容器镜像），这种轻量的docker一般不建议挂载目录出来。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">0 13 * * * rm -rf /etc/acme.sh &amp;amp;&amp;amp; docker cp nginxwebui:/home/nginxWebUI/.acme.sh /etc/acme.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>同时也要修改上面的nginx的配置文件里面的路径和域名地址即可,example&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen [::]:80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 443 ssl http2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen [::]:443 ssl http2;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name jia.leiyanhui.com *.jia.leiyanhui.com;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /etc/acme.sh/*.jia.leiyanhui.com/fullchain.cer;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /etc/acme.sh/*.jia.leiyanhui.com/*.jia.leiyanhui.com.key;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return 301 https://$host:10443$request_uri;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>openwrt部署甜糖</title><link>https://dev.leiyanhui.com/openwrt/ttnode/</link><pubDate>Sun, 09 Jan 2022 23:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/ttnode/</guid><description>&lt;p>docker run -d &lt;br>
-v /mnt/sdb1/tiantang:/mnt/data/ttnode &lt;br>
-v /var/run/docker.sock:/var/run/docker.sock &lt;br>
-v /proc:/host/proc:ro &lt;br>
&amp;ndash;name ttnode &lt;br>
&amp;ndash;hostname ttnode &lt;br>
&amp;ndash;privileged &lt;br>
&amp;ndash;net=host &lt;br>
&amp;ndash;restart=always &lt;br>
registry.cn-hangzhou.aliyuncs.com/tiptime/ttnode:latest&lt;/p>
&lt;p>启动完成后 过一会 从app 绑定即可&lt;/p></description></item><item><title>openwrt全盘系统备份</title><link>https://dev.leiyanhui.com/openwrt/backup/</link><pubDate>Sun, 09 Jan 2022 23:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/openwrt/backup/</guid><description>&lt;h2 id="为什么要做完整备份">为什么要做完整备份
&lt;/h2>&lt;blockquote>
&lt;p>因为一个完全适合自己的软路由器系统，实际上是需要配置和折腾很多东西的。有时候一个不小心 能会影响某一些功能的使用。&lt;br>
另外也是为了无缝升级配置&lt;/p>&lt;/blockquote>
&lt;p>电报群里网友帮忙从op.supes.top 大神那边定制了一个固件。包含了一些我常用的一些功能。&lt;br>
但是实际使用的使用，还是发现很多问题：&lt;/p>
&lt;p>主要是几个小问题&lt;br>
1、ipv6的转发问题（我ipv6 80 443 等端口都是封的，无法使用，所以还是干脆和ipv4一起从路由上转发后统一管理方便一些）&lt;br>
2、防火墙的一点小问题：op自己不能访问 外网+自己转发的端口。&lt;br>
3、vpn（ipsec）的一点问题，什么都不如自己随时连接到内网爽。&lt;br>
4、vpn访问外网和内网 以及梯子分流等&lt;/p>
&lt;p>解决这些问题在朋友帮助下依旧花费了一个下午去调试。 为了防止后面搞坏，除了在luci界面备份一份etc之外，还是全盘备份一下比较安心。&lt;/p>
&lt;p>原始img文件分区 为 2个分区 一个efi（/dev/sda1） 一个5G根（/dev/sda2），实际硬盘是32G msata&lt;/p>
&lt;p>我这里挂上一个1T机械盘（/dev/sdb1）会自动挂载到 /mnt/sdb1&lt;/p>
&lt;h2 id="dd备份方法">DD备份方法
&lt;/h2>&lt;h3 id="备份整个分区">备份整个分区
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 创建备份目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir /mnt/sdb1/openwrt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 直接备份
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dd if=/dev/sda2 of=/mnt/sdb1/openwrt/backup-20230110-overlay.img
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 压缩备份
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dd if=/dev/sda1 | gzip &amp;gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-efi.img.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dd if=/dev/sda2 | gzip &amp;gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay.img.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="还原">还原
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">gzip -dc /mnt/sdb1/openwrt/backup-XXXX.img.gz | dd of=/dev/sda2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>记得 已经挂载的分区 是不可以还原的，需要先卸载后还原，但是肯定是无法从op里面直接卸载的。所以还原需要从另外一个系统里面操作 ，还是不太方便。&lt;/p>
&lt;h2 id="tar备份方法">tar备份方法
&lt;/h2>&lt;h3 id="备份">备份
&lt;/h3>&lt;p>efi备份（没太大必要）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-efi.tar.gz /boot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>overlay备份 openwrt的精髓&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>单独备份/etc （没太大必要）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay-etc.tar.gz /overlay/upper/etc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="还原-1">还原
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm -rvf /overlay/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd /
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -xzvf /mnt/sdb1/openwrt/backup-XXXX-overlay.tar.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="备份软件列表">备份软件列表
&lt;/h2>&lt;p>方便自己后期查看管理&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">opkg list-installed &amp;gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-soft-list.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="关于自动备份">关于自动备份
&lt;/h2>&lt;p>把上面命令 选择性 添加到计划任务 吧。也可以使用rclone等方法定时同步到云盘。自己折腾吧。&lt;/p>
&lt;p>例如 每周2、周五 早上9点33 和50分 备份overlay 和软件列表&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">0 33 9 * * 2,5 * tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 53 9 * * 2,5 * opkg list-installed &amp;gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-soft-list.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="优化的自动备份脚本">优化的自动备份脚本
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/auto_backup.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">backupfilename=$(date +%Y%m%d_%H%M%S)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">backuppath1=&amp;#34;/opt/openwrt-backup&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mkdir /opt/openwrt-backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -czvf $backuppath1/$backupfilename-overlay.tar.gz /overlay
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">opkg list-installed &amp;gt; $backuppath1/$backupfilename-soft-list.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># rm -rvf /overlay/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># cd /
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># tar -xzvf /mnt/sdb1/openwrt/backup-XXXX-overlay.tar.gz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加计划任务 每天6点12点18点23点分别备份一次&lt;br>
等折腾顺利，就不用这样频繁备份了&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">32 6,12,18,23 * * * sh /etc/auto_backup.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参考文章：https://zhzhzhy.github.io/2022/03/20/2022/openwrt-bakcup-step&lt;/p></description></item><item><title>联系小类</title><link>https://dev.leiyanhui.com/c/1/</link><pubDate>Thu, 09 Sep 2004 13:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/c/1/</guid><description>&lt;p>邮箱：joyanhui@qq.com &lt;a class="link" href="mailto:leiyanhui@gmail.com" >leiyanhui@gmail.com&lt;/a>&lt;/p></description></item></channel></rss>