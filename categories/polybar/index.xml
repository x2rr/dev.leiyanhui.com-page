<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Polybar on å°ç±»éšæ‰‹è®°</title><link>https://dev.leiyanhui.com/categories/polybar/</link><description>Recent content in Polybar on å°ç±»éšæ‰‹è®°</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sat, 13 May 2023 12:14:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/categories/polybar/index.xml" rel="self" type="application/rss+xml"/><item><title>polybarå¤©æ°”é¢„æŠ¥æ’ä»¶</title><link>https://dev.leiyanhui.com/linux/polybar-weather-plugin/</link><pubDate>Sat, 13 May 2023 12:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/linux/polybar-weather-plugin/</guid><description>&lt;p>è‡ªå·±æ‰‹å†™ä¸€ä¸ªï¼Œä½ å¯ä»¥ç›´æ¥æŠ„ä½œä¸šã€‚&lt;/p>
&lt;h2 id="è·å–å¤©æ°”é¢„æŠ¥api">è·å–å¤©æ°”é¢„æŠ¥api
&lt;/h2>&lt;p>é¦–å…ˆéœ€è¦è‡ªå·±æ³¨å†Œä¸€ä¸ªapi,æˆ‘è¿™é‡Œç”¨çš„ openweathermap,æ³¨å†Œè´¦å·åæ‰“å¼€ &lt;a class="link" href="https://home.openweathermap.org/api_keys" target="_blank" rel="noopener"
>https://home.openweathermap.org/api_keys&lt;/a>,æŸ¥çœ‹è‡ªå·±çš„ api_key&lt;br>
openweathermap çš„api_keyæœ‰å»¶è¿Ÿï¼Œç•Œé¢æ˜¾ç¤ºå¯ç”¨çš„æœ‰æ—¶å€™å¥½åƒéœ€è¦åŠä¸ªå¤šå°æ—¶æ‰å¯ä»¥ä½¿ç”¨ï¼Œå¦åˆ™æ¥å£ä¸€ç›´è¿”å›401é”™è¯¯&lt;br>
openweathermap è™½ç„¶æœ‰è¯¸å¤šä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚è‹±æ–‡ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†æ˜¯å¤©æ°”é¢„æŠ¥å¾ˆå‡†ç¡® è€Œä¸”æ¥å£ç¨³å®šï¼Œå¹¶åˆ†é’Ÿçº§å®æ—¶é¢„æŠ¥ï¼Œå¤©æ°”äº‘å›¾ï¼Œå›½å†…å¾ˆå¤šå…è´¹çš„æ¥å£ä¸ç¨³å®šã€‚&lt;/p>
&lt;h2 id="è·å–åŸå¸‚id">è·å–åŸå¸‚id
&lt;/h2>&lt;p>openweathermap æ”¯æŒåŸå¸‚åç§°æœç´¢æŸ¥è¯¢ï¼Œæˆ‘è¿™é‡Œä¸ºäº†ç®€åŒ–ç›´æ¥ç”¨åŸå¸‚idäº†ã€‚ æ‰“å¼€openweathermapç½‘ç«™ è¾“å…¥ä½ æ‰€åœ¨åœ°åŸå¸‚çš„æ‹¼éŸ³/è‹±æ–‡åæœç´¢ï¼ŒæŸ¥çœ‹å¤©æ°”ï¼Œåœ°å€æ çš„ä¾‹å¦‚ &lt;a class="link" href="https://openweathermap.org/city/1793724" target="_blank" rel="noopener"
>https://openweathermap.org/city/1793724&lt;/a> 1793724å°±æ˜¯åŸå¸‚idäº†&lt;/p>
&lt;h2 id="æ‰‹åŠ¨æµ‹è¯•api">æ‰‹åŠ¨æµ‹è¯•api
&lt;/h2>&lt;p>è®¿é—®åœ°å€ï¼š &lt;a class="link" href="https://api.openweathermap.org/data/2.5/weather?id=%7b" target="_blank" rel="noopener"
>https://api.openweathermap.org/data/2.5/weather?id={&lt;/a>åŸå¸‚ID}&amp;amp;appid={api_key}&amp;amp;units=Metric&amp;amp;lang=zh_cn
åé¢unitsæ˜¯å•ä½å…¬åˆ¶æˆ–è€…è‹±åˆ¶ä¹‹ç±»çš„ lang å°±æ˜¯è¯­è¨€äº†&lt;br>
æ­£å¸¸åº”è¯¥å¯ä»¥è¿”å›jsonæ•°æ®ï¼Œå¦‚æœæ˜¯401é”™è¯¯ï¼Œé‚£ä¹ˆå°±æ˜¯api_keyé”™è¯¯ï¼Œæˆ–è€…æ²¡ç”Ÿæ•ˆï¼Œæˆ–è€…è¯·æ±‚å¤ªé¢‘ç¹ï¼ˆ1åˆ†é’Ÿä¸Šé™60æ¬¡ï¼‰&lt;/p>
&lt;h2 id="æœ¬åœ°å‡†å¤‡">æœ¬åœ°å‡†å¤‡
&lt;/h2>&lt;p>å› ä¸ºæ˜¯polybarç”¨ï¼Œé‚£ä¹ˆé“å®šæ˜¯linuxä¸‹æ—¥ç”¨ï¼Œä¹Ÿè‚¯å®šæœ‰pyhoneäº†ã€‚æˆ‘æŠ„çš„åˆ«äººçš„ï¼ˆåŸä½œè€…å¿˜è®°ï¼‰ç›´æ¥ç”¨äº†pyhoneã€‚&lt;br>
éœ€è¦å…ˆå¼•ç”¨requests, æ²¡æœ‰å®‰è£…ã€‚æå‰å®‰è£…ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S python-pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip3 install requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -Rns python-pip #æ˜¯å¦å¸è½½æ‰çœ‹ä½ è‡ªå·±
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ›å»ºè„šæœ¬">åˆ›å»ºè„šæœ¬
&lt;/h2>&lt;p>æŠŠä¸‹é¢è„šæœ¬çš„apt_keyå’ŒåŸå¸‚idï¼ˆ1793724ï¼‰æ¢æˆä½ è‡ªå·±çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># éœ€è¦requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># sudo pacman -S python-pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># pip3 install requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; ~/.config/polybar/weather-plugin.py&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#!/bin/python
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># -*- coding: utf-8 -*-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REQ = requests.get(&amp;#34;https://api.openweathermap.org/data/2.5/weather?id=1793724&amp;amp;appid=XXXXXXXXXXXX&amp;amp;units=Metric&amp;amp;lang=zh_cn&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">try:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # HTTP CODE = OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if REQ.status_code == 200:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON_ID = REQ.json()[&amp;#34;weather&amp;#34;][0][&amp;#34;icon&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Set the weather icon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if ICON_ID == &amp;#34;01d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;â˜€&amp;#34; # æ™´å¤© Clear Sky
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;01n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;â­&amp;#34; # Night, Clear Sky
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;02d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ¤&amp;#34; # Day,å°‘äº‘ Few Clouds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;02n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ¤&amp;#34; # Night, å°‘äº‘ Few Clouds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;03d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ¤&amp;#34; # Day, å°‘äº‘ Scattered Clouds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;03n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ¤&amp;#34; # Night, å°‘äº‘ Scattered Clouds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;04d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;å¤šäº‘&amp;#34; # Day, å¤šäº‘ Broken Clouds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;04n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;å¤šäº‘&amp;#34; # Night, å¤šäº‘ Broken Clouds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;09d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ§&amp;#34; # Day, å°é›¨ Shower Rain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;09n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ§&amp;#34; # Night,å°é›¨ Shower Rain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;10d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ§&amp;#34; # Day, Rain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;10n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ§&amp;#34; # Night, Rain
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;11d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;â›ˆ&amp;#34; # Day, é›·é›¨ Thunderstorm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;11n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;â›ˆ&amp;#34; # Night, é›·é›¨ Thunderstorm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;13d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;â„&amp;#34; # Day,é›ª Snow
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;13n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;â„&amp;#34; # Night, é›ª Snow
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;50d&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ«&amp;#34; # Day, é›¾ Mist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elif ICON_ID == &amp;#34;50n&amp;#34;:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;ğŸŒ«&amp;#34; # Night,é›¾ Mist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ICON = &amp;#34;å¤©æ°” &amp;#34; # å…¶ä»– Just Weather Icon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CURRENT = REQ.json()[&amp;#34;weather&amp;#34;][0][&amp;#34;description&amp;#34;].capitalize()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TEMP = int(float(REQ.json()[&amp;#34;main&amp;#34;][&amp;#34;temp&amp;#34;]))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> WIND = int(float(REQ.json()[&amp;#34;wind&amp;#34;][&amp;#34;speed&amp;#34;]))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # è¾“å‡ºæ ¼å¼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> print(&amp;#34;{} {}, {} Â°C ğŸŒ¬ {}m/s&amp;#34;.format(ICON, CURRENT, TEMP, WIND))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> print(&amp;#34;Error: BAD HTTP STATUS CODE &amp;#34; + str(REQ.status_code))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">except (ValueError, IOError):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> print(&amp;#34;Error: Unable print the data&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æµ‹è¯•ä¸€ä¸‹ï¼Œæ­£å¸¸å¯ä»¥åœ¨ç»ˆç«¯è¾“å‡ºå¤©æ°”&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python3 ~/.config/polybar/weather-plugin.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="polybarå¼•ç”¨">polybarå¼•ç”¨
&lt;/h2>&lt;p>ç¼–è¾‘é…ç½®æ–‡ä»¶ ~/.config/polybar/config.ini æ·»åŠ ä¸€è¡Œ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">; ===å¤©æ°”é¢„æŠ¥ éœ€è¦å•ç‹¬çš„pyhtoneæ’ä»¶===
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[module/weather]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">type = custom/script
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">exec = python3 ~/.config/polybar/weather-plugin.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interval = 960
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tail = true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">click-left= exec firefox https://openweathermap.org/city/1793724
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®Œæ¯•">å®Œæ¯•
&lt;/h2></description></item></channel></rss>