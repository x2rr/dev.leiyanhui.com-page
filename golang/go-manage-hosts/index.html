<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='redis公网集群指定了域名，但是在同局域网的客户端程序中，应该直接用内网ip连接。\n华为云那边可以直接在vpc的内网域名配置redis域名的ip,阿里云这边需要自建dns，本着服务之间尽量不耦合的原则，加上阿里云这边的函数计算实际是独立的hosts文件可以直接修改。\n下面算法，先用环境变量判断是否修改hosts文件（华为云fc没有修改权限），然后从redis中根据环境得到要修改的hosts内容。而后复制备份/etc/hosts 文件，创建一个新的hosts 然后合并两个文件。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 package lib_hosts import ( "bufio" "context" "fmt" "io" "log" "net" "os" "regexp" "strings" "time" "github.com/buger/jsonparser" "github.com/redis/go-redis/v9" ) func UpdateHostsFileFormRedisAndLookupIP(rdb redis.ClusterClient, ctx context.Context) { EnvHostsTag := os.Getenv("EnvHostsTag") if EnvHostsTag == "" { log.Println("== 不需要检查和修改 域名解析") return } //是否更新 hosts文件，华为云那边不能修改，需要通过vpc的内网域名的A记录来控制 enableUpdataHostsFile := os.Getenv("EnvHostsEndEnableUpdateFile") == "1" //执行完成后是否ping一下 EnablePing := os.Getenv("EnvHostsEndEnablePing") == "1" val, err := rdb.Get(ctx, "f501:Config:/etc/hosts").Result() if err != nil { log.Println("UpdateHostsFileFormRedis f501:Config:/etc/hosts 错误！！！", err) return } else { linesString, err := jsonparser.GetString([]byte(val), EnvHostsTag, "Lines") if err != nil { log.Println("UpdateHostsFileFormRedis 没找到相关信息 ", err) return } if enableUpdataHostsFile { UpdateHostsFile(linesString) //更新hosts文件 华为那边zip部署的fc不支持需要手动配置修改vpc } else { log.Println("部分环境不启用/etc/hosts更新,如果要启动请 到redis修改...") log.Println("跳过/etc/hosts配置,你可能需要手动配置dns或vpc组网的内网域名的A记录 ...") } if EnablePing { //执行ping命令 log.Println("所有域名分别LookupIP ...") time.Sleep(200 * time.Microsecond) re := regexp.MustCompile(`\\s+`) linesString = re.ReplaceAllString(linesString, " ") lines := strings.Split(linesString, ",") for _, line := range lines { linesArr := strings.Split(line, " ") if len(linesArr) > 1 { ipAddresses, err := net.LookupIP(linesArr[1]) if err != nil { log.Println("net.LookupIP Error:", err) return } for _, ip := range ipAddresses { log.Println("net.LookupIP :", linesArr[1], ip) } } else { log.Println("UpdateHostsFileFormRedis 长度不符", linesArr) } } } } } // 修改hosts文件 func UpdateHostsFile(linesString string) { log.Println("更新hosts 文件...") lines := strings.Split(linesString, ",") exists := FileExists("/etc/hosts-fish-source") if !exists { err := CopyFile("/etc/hosts", "/etc/hosts-fish-source") if err != nil { log.Println(err) return } else { //log.Println("复制hosts文件 到 /etc/hosts-fish-source") } } fileAppend, err := os.Create("/etc/hosts-fish-append") if err != nil { log.Println("无法创建目标文件: ", err) return } defer fileAppend.Close() writer := bufio.NewWriter(fileAppend) defer writer.Flush() for _, line := range lines { _, err := writer.WriteString(line + "\\n") if err != nil { log.Println("写入文件失败:", err) return } } writer.Flush() /*\tbuf2, err := os.ReadFile("/etc/hosts-fish-append") if err != nil { log.Println("文件读取失败", "append", err) return } log.Println("###---###内容 wjx append", string(buf2)) // 将内容转换为字符串并打印 */ //log.Println("新建文件 到 /etc/hosts-fish-append 准备合并") err = MergeFiles("/etc/hosts-fish-source", "/etc/hosts-fish-append", "/etc/hosts") if err != nil { log.Println("文件合并成功错误", err) } else { //log.Println("文件合并成功") } } func FileExists(filename string) bool { _, err := os.Stat(filename) if err == nil { return true // 文件存在 } if os.IsNotExist(err) { return false // 文件不存在 } return false // 其他错误，无法确定文件是否存在 } func MergeFiles(file1, file2, outputFile string) error { err := ClearFile(outputFile) if err != nil { log.Println("文件清空失败", err) return err } /*\tcontent, err := os.ReadFile(outputFile) // 读取文件内容 if err != nil { log.Println("文件清空后重新读取失败", outputFile, err) return err } log.Println("###---###内容", outputFile, string(content)) // 将内容转换为字符串并打印 */ buf1, err := os.ReadFile(file1) if err != nil { log.Println("文件读取失败", file1, err) return err } //log.Println("###---###内容", file1, string(buf1)) // 将内容转换为字符串并打印 buf2, err := os.ReadFile(file2) if err != nil { log.Println("文件读取失败", file2, err) return err } //log.Println("###---###内容", file2, string(buf2)) // 将内容转换为字符串并打印 file, err := os.OpenFile(outputFile, os.O_CREATE|os.O_RDWR|os.O_APPEND, 0666) if err != nil { log.Println("文件打开失败", outputFile, err) return err } defer file.Close() writer := bufio.NewWriter(file) writer.Write(buf1) writer.Write(buf2) writer.Flush() return nil } func ClearFile(filename string) error { // 打开文件并截断内容 file, err := os.OpenFile(filename, os.O_RDWR|os.O_TRUNC, 0666) if err != nil { return err } defer file.Close() // 清空文件内容 err = file.Truncate(0) if err != nil { return err } //log.Printf("文件 %s 已成功清空", filename) return nil } func CopyFile(sourceFile string, destinationFile string) error { src, err := os.Open(sourceFile) if err != nil { return fmt.Errorf("无法打开源文件 %s: %s", sourceFile, err) } defer src.Close() dst, err := os.Create(destinationFile) if err != nil { return fmt.Errorf("无法创建目标文件 %s: %s", destinationFile, err) } defer dst.Close() _, err = io.Copy(dst, src) if err != nil { return fmt.Errorf("复制文件时出错: %s", err) } return nil } '><title>golang 维护 hosts,兼容阿里云函数计算</title><link rel=canonical href=https://dev.leiyanhui.com/golang/go-manage-hosts/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="golang 维护 hosts,兼容阿里云函数计算"><meta property='og:description' content='redis公网集群指定了域名，但是在同局域网的客户端程序中，应该直接用内网ip连接。\n华为云那边可以直接在vpc的内网域名配置redis域名的ip,阿里云这边需要自建dns，本着服务之间尽量不耦合的原则，加上阿里云这边的函数计算实际是独立的hosts文件可以直接修改。\n下面算法，先用环境变量判断是否修改hosts文件（华为云fc没有修改权限），然后从redis中根据环境得到要修改的hosts内容。而后复制备份/etc/hosts 文件，创建一个新的hosts 然后合并两个文件。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 package lib_hosts import ( "bufio" "context" "fmt" "io" "log" "net" "os" "regexp" "strings" "time" "github.com/buger/jsonparser" "github.com/redis/go-redis/v9" ) func UpdateHostsFileFormRedisAndLookupIP(rdb redis.ClusterClient, ctx context.Context) { EnvHostsTag := os.Getenv("EnvHostsTag") if EnvHostsTag == "" { log.Println("== 不需要检查和修改 域名解析") return } //是否更新 hosts文件，华为云那边不能修改，需要通过vpc的内网域名的A记录来控制 enableUpdataHostsFile := os.Getenv("EnvHostsEndEnableUpdateFile") == "1" //执行完成后是否ping一下 EnablePing := os.Getenv("EnvHostsEndEnablePing") == "1" val, err := rdb.Get(ctx, "f501:Config:/etc/hosts").Result() if err != nil { log.Println("UpdateHostsFileFormRedis f501:Config:/etc/hosts 错误！！！", err) return } else { linesString, err := jsonparser.GetString([]byte(val), EnvHostsTag, "Lines") if err != nil { log.Println("UpdateHostsFileFormRedis 没找到相关信息 ", err) return } if enableUpdataHostsFile { UpdateHostsFile(linesString) //更新hosts文件 华为那边zip部署的fc不支持需要手动配置修改vpc } else { log.Println("部分环境不启用/etc/hosts更新,如果要启动请 到redis修改...") log.Println("跳过/etc/hosts配置,你可能需要手动配置dns或vpc组网的内网域名的A记录 ...") } if EnablePing { //执行ping命令 log.Println("所有域名分别LookupIP ...") time.Sleep(200 * time.Microsecond) re := regexp.MustCompile(`\\s+`) linesString = re.ReplaceAllString(linesString, " ") lines := strings.Split(linesString, ",") for _, line := range lines { linesArr := strings.Split(line, " ") if len(linesArr) > 1 { ipAddresses, err := net.LookupIP(linesArr[1]) if err != nil { log.Println("net.LookupIP Error:", err) return } for _, ip := range ipAddresses { log.Println("net.LookupIP :", linesArr[1], ip) } } else { log.Println("UpdateHostsFileFormRedis 长度不符", linesArr) } } } } } // 修改hosts文件 func UpdateHostsFile(linesString string) { log.Println("更新hosts 文件...") lines := strings.Split(linesString, ",") exists := FileExists("/etc/hosts-fish-source") if !exists { err := CopyFile("/etc/hosts", "/etc/hosts-fish-source") if err != nil { log.Println(err) return } else { //log.Println("复制hosts文件 到 /etc/hosts-fish-source") } } fileAppend, err := os.Create("/etc/hosts-fish-append") if err != nil { log.Println("无法创建目标文件: ", err) return } defer fileAppend.Close() writer := bufio.NewWriter(fileAppend) defer writer.Flush() for _, line := range lines { _, err := writer.WriteString(line + "\\n") if err != nil { log.Println("写入文件失败:", err) return } } writer.Flush() /*\tbuf2, err := os.ReadFile("/etc/hosts-fish-append") if err != nil { log.Println("文件读取失败", "append", err) return } log.Println("###---###内容 wjx append", string(buf2)) // 将内容转换为字符串并打印 */ //log.Println("新建文件 到 /etc/hosts-fish-append 准备合并") err = MergeFiles("/etc/hosts-fish-source", "/etc/hosts-fish-append", "/etc/hosts") if err != nil { log.Println("文件合并成功错误", err) } else { //log.Println("文件合并成功") } } func FileExists(filename string) bool { _, err := os.Stat(filename) if err == nil { return true // 文件存在 } if os.IsNotExist(err) { return false // 文件不存在 } return false // 其他错误，无法确定文件是否存在 } func MergeFiles(file1, file2, outputFile string) error { err := ClearFile(outputFile) if err != nil { log.Println("文件清空失败", err) return err } /*\tcontent, err := os.ReadFile(outputFile) // 读取文件内容 if err != nil { log.Println("文件清空后重新读取失败", outputFile, err) return err } log.Println("###---###内容", outputFile, string(content)) // 将内容转换为字符串并打印 */ buf1, err := os.ReadFile(file1) if err != nil { log.Println("文件读取失败", file1, err) return err } //log.Println("###---###内容", file1, string(buf1)) // 将内容转换为字符串并打印 buf2, err := os.ReadFile(file2) if err != nil { log.Println("文件读取失败", file2, err) return err } //log.Println("###---###内容", file2, string(buf2)) // 将内容转换为字符串并打印 file, err := os.OpenFile(outputFile, os.O_CREATE|os.O_RDWR|os.O_APPEND, 0666) if err != nil { log.Println("文件打开失败", outputFile, err) return err } defer file.Close() writer := bufio.NewWriter(file) writer.Write(buf1) writer.Write(buf2) writer.Flush() return nil } func ClearFile(filename string) error { // 打开文件并截断内容 file, err := os.OpenFile(filename, os.O_RDWR|os.O_TRUNC, 0666) if err != nil { return err } defer file.Close() // 清空文件内容 err = file.Truncate(0) if err != nil { return err } //log.Printf("文件 %s 已成功清空", filename) return nil } func CopyFile(sourceFile string, destinationFile string) error { src, err := os.Open(sourceFile) if err != nil { return fmt.Errorf("无法打开源文件 %s: %s", sourceFile, err) } defer src.Close() dst, err := os.Create(destinationFile) if err != nil { return fmt.Errorf("无法创建目标文件 %s: %s", destinationFile, err) } defer dst.Close() _, err = io.Copy(dst, src) if err != nil { return fmt.Errorf("复制文件时出错: %s", err) } return nil } '><meta property='og:url' content='https://dev.leiyanhui.com/golang/go-manage-hosts/'><meta property='og:site_name' content='小类随手记'><meta property='og:type' content='article'><meta property='article:section' content='Golang'><meta property='article:published_time' content='2023-11-24T08:14:20+08:00'><meta property='article:modified_time' content='2023-11-24T08:14:20+08:00'><meta name=twitter:title content="golang 维护 hosts,兼容阿里云函数计算"><meta name=twitter:description content='redis公网集群指定了域名，但是在同局域网的客户端程序中，应该直接用内网ip连接。\n华为云那边可以直接在vpc的内网域名配置redis域名的ip,阿里云这边需要自建dns，本着服务之间尽量不耦合的原则，加上阿里云这边的函数计算实际是独立的hosts文件可以直接修改。\n下面算法，先用环境变量判断是否修改hosts文件（华为云fc没有修改权限），然后从redis中根据环境得到要修改的hosts内容。而后复制备份/etc/hosts 文件，创建一个新的hosts 然后合并两个文件。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 package lib_hosts import ( "bufio" "context" "fmt" "io" "log" "net" "os" "regexp" "strings" "time" "github.com/buger/jsonparser" "github.com/redis/go-redis/v9" ) func UpdateHostsFileFormRedisAndLookupIP(rdb redis.ClusterClient, ctx context.Context) { EnvHostsTag := os.Getenv("EnvHostsTag") if EnvHostsTag == "" { log.Println("== 不需要检查和修改 域名解析") return } //是否更新 hosts文件，华为云那边不能修改，需要通过vpc的内网域名的A记录来控制 enableUpdataHostsFile := os.Getenv("EnvHostsEndEnableUpdateFile") == "1" //执行完成后是否ping一下 EnablePing := os.Getenv("EnvHostsEndEnablePing") == "1" val, err := rdb.Get(ctx, "f501:Config:/etc/hosts").Result() if err != nil { log.Println("UpdateHostsFileFormRedis f501:Config:/etc/hosts 错误！！！", err) return } else { linesString, err := jsonparser.GetString([]byte(val), EnvHostsTag, "Lines") if err != nil { log.Println("UpdateHostsFileFormRedis 没找到相关信息 ", err) return } if enableUpdataHostsFile { UpdateHostsFile(linesString) //更新hosts文件 华为那边zip部署的fc不支持需要手动配置修改vpc } else { log.Println("部分环境不启用/etc/hosts更新,如果要启动请 到redis修改...") log.Println("跳过/etc/hosts配置,你可能需要手动配置dns或vpc组网的内网域名的A记录 ...") } if EnablePing { //执行ping命令 log.Println("所有域名分别LookupIP ...") time.Sleep(200 * time.Microsecond) re := regexp.MustCompile(`\\s+`) linesString = re.ReplaceAllString(linesString, " ") lines := strings.Split(linesString, ",") for _, line := range lines { linesArr := strings.Split(line, " ") if len(linesArr) > 1 { ipAddresses, err := net.LookupIP(linesArr[1]) if err != nil { log.Println("net.LookupIP Error:", err) return } for _, ip := range ipAddresses { log.Println("net.LookupIP :", linesArr[1], ip) } } else { log.Println("UpdateHostsFileFormRedis 长度不符", linesArr) } } } } } // 修改hosts文件 func UpdateHostsFile(linesString string) { log.Println("更新hosts 文件...") lines := strings.Split(linesString, ",") exists := FileExists("/etc/hosts-fish-source") if !exists { err := CopyFile("/etc/hosts", "/etc/hosts-fish-source") if err != nil { log.Println(err) return } else { //log.Println("复制hosts文件 到 /etc/hosts-fish-source") } } fileAppend, err := os.Create("/etc/hosts-fish-append") if err != nil { log.Println("无法创建目标文件: ", err) return } defer fileAppend.Close() writer := bufio.NewWriter(fileAppend) defer writer.Flush() for _, line := range lines { _, err := writer.WriteString(line + "\\n") if err != nil { log.Println("写入文件失败:", err) return } } writer.Flush() /*\tbuf2, err := os.ReadFile("/etc/hosts-fish-append") if err != nil { log.Println("文件读取失败", "append", err) return } log.Println("###---###内容 wjx append", string(buf2)) // 将内容转换为字符串并打印 */ //log.Println("新建文件 到 /etc/hosts-fish-append 准备合并") err = MergeFiles("/etc/hosts-fish-source", "/etc/hosts-fish-append", "/etc/hosts") if err != nil { log.Println("文件合并成功错误", err) } else { //log.Println("文件合并成功") } } func FileExists(filename string) bool { _, err := os.Stat(filename) if err == nil { return true // 文件存在 } if os.IsNotExist(err) { return false // 文件不存在 } return false // 其他错误，无法确定文件是否存在 } func MergeFiles(file1, file2, outputFile string) error { err := ClearFile(outputFile) if err != nil { log.Println("文件清空失败", err) return err } /*\tcontent, err := os.ReadFile(outputFile) // 读取文件内容 if err != nil { log.Println("文件清空后重新读取失败", outputFile, err) return err } log.Println("###---###内容", outputFile, string(content)) // 将内容转换为字符串并打印 */ buf1, err := os.ReadFile(file1) if err != nil { log.Println("文件读取失败", file1, err) return err } //log.Println("###---###内容", file1, string(buf1)) // 将内容转换为字符串并打印 buf2, err := os.ReadFile(file2) if err != nil { log.Println("文件读取失败", file2, err) return err } //log.Println("###---###内容", file2, string(buf2)) // 将内容转换为字符串并打印 file, err := os.OpenFile(outputFile, os.O_CREATE|os.O_RDWR|os.O_APPEND, 0666) if err != nil { log.Println("文件打开失败", outputFile, err) return err } defer file.Close() writer := bufio.NewWriter(file) writer.Write(buf1) writer.Write(buf2) writer.Flush() return nil } func ClearFile(filename string) error { // 打开文件并截断内容 file, err := os.OpenFile(filename, os.O_RDWR|os.O_TRUNC, 0666) if err != nil { return err } defer file.Close() // 清空文件内容 err = file.Truncate(0) if err != nil { return err } //log.Printf("文件 %s 已成功清空", filename) return nil } func CopyFile(sourceFile string, destinationFile string) error { src, err := os.Open(sourceFile) if err != nil { return fmt.Errorf("无法打开源文件 %s: %s", sourceFile, err) } defer src.Close() dst, err := os.Create(destinationFile) if err != nil { return fmt.Errorf("无法创建目标文件 %s: %s", destinationFile, err) } defer dst.Close() _, err = io.Copy(dst, src) if err != nil { return fmt.Errorf("复制文件时出错: %s", err) } return nil } '></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_6049d840d4e2d14.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🐟</span></figure><div class=site-meta><h1 class=site-name><a href=/>小类随手记</a></h1><h2 class=site-description>just so so.</h2></div></header><ol class=menu-social><li><a href=https://github.com/joyanhui/dev.leiyanhui.com-src target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>列表</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>站内搜索</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>links</span></a></li><li><a href=/contact/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>contact</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/golang/>Golang
</a><a href=/categories/hosts/>Hosts</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/golang/go-manage-hosts/>golang 维护 hosts,兼容阿里云函数计算</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2023-11-24</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 4 分钟</time></div></footer></div></header><section class=article-content><p>redis公网集群指定了域名，但是在同局域网的客户端程序中，应该直接用内网ip连接。<br>华为云那边可以直接在vpc的内网域名配置redis域名的ip,阿里云这边需要自建dns，本着服务之间尽量不耦合的原则，加上阿里云这边的函数计算实际是独立的hosts文件可以直接修改。</p><p>下面算法，先用环境变量判断是否修改hosts文件（华为云fc没有修改权限），然后从redis中根据环境得到要修改的hosts内容。而后复制备份/etc/hosts 文件，创建一个新的hosts 然后合并两个文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>lib_hosts</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;bufio&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;io&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;regexp&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/buger/jsonparser&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/redis/go-redis/v9&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UpdateHostsFileFormRedisAndLookupIP</span><span class=p>(</span><span class=nx>rdb</span> <span class=nx>redis</span><span class=p>.</span><span class=nx>ClusterClient</span><span class=p>,</span> <span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>EnvHostsTag</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;EnvHostsTag&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>EnvHostsTag</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;== 不需要检查和修改 域名解析&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>//是否更新 hosts文件，华为云那边不能修改，需要通过vpc的内网域名的A记录来控制</span>
</span></span><span class=line><span class=cl>	<span class=nx>enableUpdataHostsFile</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;EnvHostsEndEnableUpdateFile&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>//执行完成后是否ping一下</span>
</span></span><span class=line><span class=cl>	<span class=nx>EnablePing</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;EnvHostsEndEnablePing&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>val</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rdb</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;f501:Config:/etc/hosts&#34;</span><span class=p>).</span><span class=nf>Result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;UpdateHostsFileFormRedis f501:Config:/etc/hosts  错误！！！&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>linesString</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>jsonparser</span><span class=p>.</span><span class=nf>GetString</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>val</span><span class=p>),</span> <span class=nx>EnvHostsTag</span><span class=p>,</span> <span class=s>&#34;Lines&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;UpdateHostsFileFormRedis 没找到相关信息 &#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>enableUpdataHostsFile</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nf>UpdateHostsFile</span><span class=p>(</span><span class=nx>linesString</span><span class=p>)</span> <span class=c1>//更新hosts文件 华为那边zip部署的fc不支持需要手动配置修改vpc</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;部分环境不启用/etc/hosts更新,如果要启动请 到redis修改...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;跳过/etc/hosts配置,你可能需要手动配置dns或vpc组网的内网域名的A记录 ...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>EnablePing</span> <span class=p>{</span> <span class=c1>//执行ping命令</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;所有域名分别LookupIP ...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>200</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Microsecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>re</span> <span class=o>:=</span> <span class=nx>regexp</span><span class=p>.</span><span class=nf>MustCompile</span><span class=p>(</span><span class=s>`\s+`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>linesString</span> <span class=p>=</span> <span class=nx>re</span><span class=p>.</span><span class=nf>ReplaceAllString</span><span class=p>(</span><span class=nx>linesString</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>lines</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=nx>linesString</span><span class=p>,</span> <span class=s>&#34;,&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>line</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>lines</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>linesArr</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=nx>line</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>linesArr</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=nx>ipAddresses</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>LookupIP</span><span class=p>(</span><span class=nx>linesArr</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>					<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>						<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;net.LookupIP Error:&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>						<span class=k>return</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>ip</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>ipAddresses</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>						<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;net.LookupIP :&#34;</span><span class=p>,</span> <span class=nx>linesArr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>ip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>					<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;UpdateHostsFileFormRedis 长度不符&#34;</span><span class=p>,</span> <span class=nx>linesArr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 修改hosts文件</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UpdateHostsFile</span><span class=p>(</span><span class=nx>linesString</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;更新hosts 文件...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>lines</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=nx>linesString</span><span class=p>,</span> <span class=s>&#34;,&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>exists</span> <span class=o>:=</span> <span class=nf>FileExists</span><span class=p>(</span><span class=s>&#34;/etc/hosts-fish-source&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>exists</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=o>:=</span> <span class=nf>CopyFile</span><span class=p>(</span><span class=s>&#34;/etc/hosts&#34;</span><span class=p>,</span> <span class=s>&#34;/etc/hosts-fish-source&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>//log.Println(&#34;复制hosts文件 到 /etc/hosts-fish-source&#34;)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fileAppend</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=s>&#34;/etc/hosts-fish-append&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;无法创建目标文件: &#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>fileAppend</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span> <span class=o>:=</span> <span class=nx>bufio</span><span class=p>.</span><span class=nf>NewWriter</span><span class=p>(</span><span class=nx>fileAppend</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>writer</span><span class=p>.</span><span class=nf>Flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>line</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>lines</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>writer</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nx>line</span> <span class=o>+</span> <span class=s>&#34;\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;写入文件失败:&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span><span class=p>.</span><span class=nf>Flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=cm>/*	buf2, err := os.ReadFile(&#34;/etc/hosts-fish-append&#34;)
</span></span></span><span class=line><span class=cl><span class=cm>		if err != nil {
</span></span></span><span class=line><span class=cl><span class=cm>			log.Println(&#34;文件读取失败&#34;, &#34;append&#34;, err)
</span></span></span><span class=line><span class=cl><span class=cm>			return
</span></span></span><span class=line><span class=cl><span class=cm>		}
</span></span></span><span class=line><span class=cl><span class=cm>		log.Println(&#34;###---###内容 wjx  append&#34;, string(buf2)) // 将内容转换为字符串并打印
</span></span></span><span class=line><span class=cl><span class=cm>	*/</span>
</span></span><span class=line><span class=cl>	<span class=c1>//log.Println(&#34;新建文件 到 /etc/hosts-fish-append  准备合并&#34;)</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=p>=</span> <span class=nf>MergeFiles</span><span class=p>(</span><span class=s>&#34;/etc/hosts-fish-source&#34;</span><span class=p>,</span> <span class=s>&#34;/etc/hosts-fish-append&#34;</span><span class=p>,</span> <span class=s>&#34;/etc/hosts&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;文件合并成功错误&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>//log.Println(&#34;文件合并成功&#34;)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>FileExists</span><span class=p>(</span><span class=nx>filename</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Stat</span><span class=p>(</span><span class=nx>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>true</span> <span class=c1>// 文件存在</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>os</span><span class=p>.</span><span class=nf>IsNotExist</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span> <span class=c1>// 文件不存在</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>false</span> <span class=c1>// 其他错误，无法确定文件是否存在</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>MergeFiles</span><span class=p>(</span><span class=nx>file1</span><span class=p>,</span> <span class=nx>file2</span><span class=p>,</span> <span class=nx>outputFile</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nf>ClearFile</span><span class=p>(</span><span class=nx>outputFile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;文件清空失败&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=cm>/*	content, err := os.ReadFile(outputFile) // 读取文件内容
</span></span></span><span class=line><span class=cl><span class=cm>		if err != nil {
</span></span></span><span class=line><span class=cl><span class=cm>			log.Println(&#34;文件清空后重新读取失败&#34;, outputFile, err)
</span></span></span><span class=line><span class=cl><span class=cm>			return err
</span></span></span><span class=line><span class=cl><span class=cm>		}
</span></span></span><span class=line><span class=cl><span class=cm>		log.Println(&#34;###---###内容&#34;, outputFile, string(content)) // 将内容转换为字符串并打印
</span></span></span><span class=line><span class=cl><span class=cm>	*/</span>
</span></span><span class=line><span class=cl>	<span class=nx>buf1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=nx>file1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;文件读取失败&#34;</span><span class=p>,</span> <span class=nx>file1</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>//log.Println(&#34;###---###内容&#34;, file1, string(buf1)) // 将内容转换为字符串并打印</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>buf2</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>ReadFile</span><span class=p>(</span><span class=nx>file2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;文件读取失败&#34;</span><span class=p>,</span> <span class=nx>file2</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>//log.Println(&#34;###---###内容&#34;, file2, string(buf2)) // 将内容转换为字符串并打印</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>file</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>OpenFile</span><span class=p>(</span><span class=nx>outputFile</span><span class=p>,</span> <span class=nx>os</span><span class=p>.</span><span class=nx>O_CREATE</span><span class=p>|</span><span class=nx>os</span><span class=p>.</span><span class=nx>O_RDWR</span><span class=p>|</span><span class=nx>os</span><span class=p>.</span><span class=nx>O_APPEND</span><span class=p>,</span> <span class=mo>0666</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;文件打开失败&#34;</span><span class=p>,</span> <span class=nx>outputFile</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>file</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span> <span class=o>:=</span> <span class=nx>bufio</span><span class=p>.</span><span class=nf>NewWriter</span><span class=p>(</span><span class=nx>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>buf1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>buf2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>writer</span><span class=p>.</span><span class=nf>Flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ClearFile</span><span class=p>(</span><span class=nx>filename</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 打开文件并截断内容</span>
</span></span><span class=line><span class=cl>	<span class=nx>file</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>OpenFile</span><span class=p>(</span><span class=nx>filename</span><span class=p>,</span> <span class=nx>os</span><span class=p>.</span><span class=nx>O_RDWR</span><span class=p>|</span><span class=nx>os</span><span class=p>.</span><span class=nx>O_TRUNC</span><span class=p>,</span> <span class=mo>0666</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>file</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 清空文件内容</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=p>=</span> <span class=nx>file</span><span class=p>.</span><span class=nf>Truncate</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//log.Printf(&#34;文件 %s 已成功清空&#34;, filename)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>CopyFile</span><span class=p>(</span><span class=nx>sourceFile</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>destinationFile</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>src</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=nx>sourceFile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;无法打开源文件 %s: %s&#34;</span><span class=p>,</span> <span class=nx>sourceFile</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>src</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>dst</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>destinationFile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;无法创建目标文件 %s: %s&#34;</span><span class=p>,</span> <span class=nx>destinationFile</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>dst</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>io</span><span class=p>.</span><span class=nf>Copy</span><span class=p>(</span><span class=nx>dst</span><span class=p>,</span> <span class=nx>src</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;复制文件时出错: %s&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/golang/goget/><div class=article-details><h2 class=article-title>go get 获取不到最新版？</h2></div></a></article><article><a href=/nixos/golang/><div class=article-details><h2 class=article-title>nixos下golang+goland开发环境</h2></div></a></article><article><a href=/golang/funpointerparameter/><div class=article-details><h2 class=article-title>golang 指针传参和直接传的性能简单对比</h2></div></a></article><article><a href=/golang/getkeyswithprefixforcluster/><div class=article-details><h2 class=article-title>golang 从redis cluster获取所有keys</h2></div></a></article><article><a href=/golang/webview/><div class=article-details><h2 class=article-title>golang 比较靠谱的 webview</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//xiao-lei-sui-shou-ji.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 小类随手记</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>