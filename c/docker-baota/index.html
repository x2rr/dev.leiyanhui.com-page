<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='alpine/linux 下快速搭建可以随意整体迁移的宝塔面板 这里以alpine为例，安装后占用50M左右硬盘的一个完整linux系统\n下载iso 安装 https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/x86_64/alpine-virt-3.16.2-x86_64.iso\n安装过程使用国内neusoft镜像,用的虚拟机镜像联网安装，安装后就是最新版\n重启后登录：vi /etc/apk/repositories 去掉稳定版的community注释\n1 2 3 apk add docker #安装docker rc-update add docker boot #开机自动启动 service docker start #启动 重启一下，启动过程中可以看到dhcp的ip，启动后 ip a 也可以看到，路由器里面dhcp绑定一下ip。\nssh登录 修改docker源 文件不存在 会自动新建\n1 vi /etc/docker/daemon.json { &ldquo;registry-mirrors&rdquo;: [ &ldquo;https://hub-mirror.c.163.com&rdquo;, &ldquo;https://ustc-edu-cn.mirror.aliyuncs.com&rdquo;, &ldquo;https://docker.mirrors.ustc.edu.cn&rdquo; ] }\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 service docker restart # 然后虚拟机关机，整机备份 ``` **容器的选择**， 宝塔支持 是 Centos7.x > Debian10 > Ubuntu 20.04 > Centos8 stream > Ubuntu 18.04 > 其它系统 这几个系统的最后支持时间 centos7（2024-6-30）debian10 （2019年7月发布也差不多2024-7）ubuntu20.04(2025-4) Ubuntu 22.04.1 LTS 安全更新至2027年4月 debian11（2026 年 12 月）尽量选择前三个系统，1是因为在debian系下多数组件是编译安装的 2是宝塔最近小bug非常多，centos下会好一些 安装docker centos 和 宝塔 ``` docker pull centos:7 docker images # 启动容器 # 目录不映射出来，因为这里需要做一个全部都在docker的可迁移的 # 先把端口考虑好，后续修改麻烦 宝塔面板的两个 80 和 443 mysql MongoDB Redis PgSQL # 1122:22 算是备用的，另外需要预留几个golang用的端口 数字80开头的 docker run -i -t -d --name baota -p 8888:8888 -p 180:80 -p 1122:22 -p 1443:443 -p 13306:3306 -p 888:888 -p 16379:6379 -p 27017:27017 -p 27018:27018 -p 27019:27019 -p 28017:28017 -p 5432:5432 -p 8180-8199:8180-8199 --privileged=true --restart=always centos:7 /bin/bash #开始安装宝塔 docker exec -it baota /bin/bash #安装脚本 yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec ``` 登录宝塔面板 修改面板入口地址 安装 nginx mysql5.7 php7.4 redis7 php alioss打开常用扩展，因为版本的原因，均为编译安装，速度非常慢，耐心等待，选centos7的话就没有这个问题 配置好dnspod 的key 方便续签域名证书 宝塔 7.9.4 的alioss 有配置错误，经过测试又是一个小bug，导致它无论什么系统无法配置。 vi /www/server/panel/data/aliossAS.conf ``` {"access_key": "XXXXX", "secret_key": "XXXX", "bucket_name": "XXXX", "bucket_domain": "XXXX.oss-cn-qingdao.aliyuncs.com", "backup_path": "/bt_backup/"} ``` 可以正常用了 下载我的开源项目webdavgo 把/www目录映射出来到webdav ``` #https://dev.leiyanhui.com/c/webdavgo/ cd /www wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1.1/webdav chmod -x ./webdav #wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1/webdavgo.json ``` 编辑配置文件 关闭文件服务，webdav定位到 /www vim webdavgo.json ``` { "server_port":8189, "webdav_user_name":"admin", "webdav_user_psw":"12345", "webdav_file_path":"/www", "list_server_path":"", "list_file_path":"" } ``` 宝塔新建一个go项目 站点 端口输入上面的端口后，可执行文件 /www/webdav 剩下的不在说明 这样 /www 可以在外网通过webdav访问 测试完成后，修改server\\_port端口为没有映射过的端口，nginx开启ssl 同时在自己的域名控制面板里面 添加几个指向本地的子域名，免得测试项目老修改hosts文件 1.host.leiyanhui.com 到10.0.0.1 10.host.leiyanhui.com 到10.0.0.10 \\*.10.host.leiyanhui.com 到10.0.0.10 127.host.leiyanhui.com 到 127.0.0.1 \\*.127.host.leiyanhui.com 到127.0.0.1 配置docker里面的宝塔自动启动 在容器内新建文件 vi /www/wwwroot/bt.sh ``` ## 宝塔 在容器内自动启动 /etc/init.d/bt start /etc/init.d/redis start /etc/init.d/php-fpm-74 start /etc/init.d/mongodb start /etc/init.d/pgsql start /etc/init.d/mysqld start /etc/init.d/memcached start /etc/init.d/nginx start crond seelp 5 /etc/init.d/mysqld stop /etc/init.d/mysqld start /etc/init.d/redis stop /etc/init.d/redis start crond ``` 推出容器，在宿主系统中添加开机启动项，这里以apline为例子 ``` cd /etc/local.d vi bt.start # 添加内容 docker exec -it baota sh /www/wwwroot/bt.sh chmod +x bt.start rc-update add local ``` 备份容器 到tar ``` docker export baota> baota.tar gzip baota.tar #简化一下 事实证明没啥用 其实还是tar宝 docker export -o baota.tar.gz baota ``` 这个压缩包迁移到其他主机上 或 阿里docker服务 ``` # 导入到 镜像 baota:v1 docker import baota.tar.gz baota:v1 ``` docker重启后 要执行一次 '><title>alpine/linux 下快速搭建可以随意整体迁移的宝塔面板</title><link rel=canonical href=https://dev.leiyanhui.com/c/docker-baota/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="alpine/linux 下快速搭建可以随意整体迁移的宝塔面板"><meta property='og:description' content='alpine/linux 下快速搭建可以随意整体迁移的宝塔面板 这里以alpine为例，安装后占用50M左右硬盘的一个完整linux系统\n下载iso 安装 https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/x86_64/alpine-virt-3.16.2-x86_64.iso\n安装过程使用国内neusoft镜像,用的虚拟机镜像联网安装，安装后就是最新版\n重启后登录：vi /etc/apk/repositories 去掉稳定版的community注释\n1 2 3 apk add docker #安装docker rc-update add docker boot #开机自动启动 service docker start #启动 重启一下，启动过程中可以看到dhcp的ip，启动后 ip a 也可以看到，路由器里面dhcp绑定一下ip。\nssh登录 修改docker源 文件不存在 会自动新建\n1 vi /etc/docker/daemon.json { &ldquo;registry-mirrors&rdquo;: [ &ldquo;https://hub-mirror.c.163.com&rdquo;, &ldquo;https://ustc-edu-cn.mirror.aliyuncs.com&rdquo;, &ldquo;https://docker.mirrors.ustc.edu.cn&rdquo; ] }\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 service docker restart # 然后虚拟机关机，整机备份 ``` **容器的选择**， 宝塔支持 是 Centos7.x > Debian10 > Ubuntu 20.04 > Centos8 stream > Ubuntu 18.04 > 其它系统 这几个系统的最后支持时间 centos7（2024-6-30）debian10 （2019年7月发布也差不多2024-7）ubuntu20.04(2025-4) Ubuntu 22.04.1 LTS 安全更新至2027年4月 debian11（2026 年 12 月）尽量选择前三个系统，1是因为在debian系下多数组件是编译安装的 2是宝塔最近小bug非常多，centos下会好一些 安装docker centos 和 宝塔 ``` docker pull centos:7 docker images # 启动容器 # 目录不映射出来，因为这里需要做一个全部都在docker的可迁移的 # 先把端口考虑好，后续修改麻烦 宝塔面板的两个 80 和 443 mysql MongoDB Redis PgSQL # 1122:22 算是备用的，另外需要预留几个golang用的端口 数字80开头的 docker run -i -t -d --name baota -p 8888:8888 -p 180:80 -p 1122:22 -p 1443:443 -p 13306:3306 -p 888:888 -p 16379:6379 -p 27017:27017 -p 27018:27018 -p 27019:27019 -p 28017:28017 -p 5432:5432 -p 8180-8199:8180-8199 --privileged=true --restart=always centos:7 /bin/bash #开始安装宝塔 docker exec -it baota /bin/bash #安装脚本 yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec ``` 登录宝塔面板 修改面板入口地址 安装 nginx mysql5.7 php7.4 redis7 php alioss打开常用扩展，因为版本的原因，均为编译安装，速度非常慢，耐心等待，选centos7的话就没有这个问题 配置好dnspod 的key 方便续签域名证书 宝塔 7.9.4 的alioss 有配置错误，经过测试又是一个小bug，导致它无论什么系统无法配置。 vi /www/server/panel/data/aliossAS.conf ``` {"access_key": "XXXXX", "secret_key": "XXXX", "bucket_name": "XXXX", "bucket_domain": "XXXX.oss-cn-qingdao.aliyuncs.com", "backup_path": "/bt_backup/"} ``` 可以正常用了 下载我的开源项目webdavgo 把/www目录映射出来到webdav ``` #https://dev.leiyanhui.com/c/webdavgo/ cd /www wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1.1/webdav chmod -x ./webdav #wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1/webdavgo.json ``` 编辑配置文件 关闭文件服务，webdav定位到 /www vim webdavgo.json ``` { "server_port":8189, "webdav_user_name":"admin", "webdav_user_psw":"12345", "webdav_file_path":"/www", "list_server_path":"", "list_file_path":"" } ``` 宝塔新建一个go项目 站点 端口输入上面的端口后，可执行文件 /www/webdav 剩下的不在说明 这样 /www 可以在外网通过webdav访问 测试完成后，修改server\\_port端口为没有映射过的端口，nginx开启ssl 同时在自己的域名控制面板里面 添加几个指向本地的子域名，免得测试项目老修改hosts文件 1.host.leiyanhui.com 到10.0.0.1 10.host.leiyanhui.com 到10.0.0.10 \\*.10.host.leiyanhui.com 到10.0.0.10 127.host.leiyanhui.com 到 127.0.0.1 \\*.127.host.leiyanhui.com 到127.0.0.1 配置docker里面的宝塔自动启动 在容器内新建文件 vi /www/wwwroot/bt.sh ``` ## 宝塔 在容器内自动启动 /etc/init.d/bt start /etc/init.d/redis start /etc/init.d/php-fpm-74 start /etc/init.d/mongodb start /etc/init.d/pgsql start /etc/init.d/mysqld start /etc/init.d/memcached start /etc/init.d/nginx start crond seelp 5 /etc/init.d/mysqld stop /etc/init.d/mysqld start /etc/init.d/redis stop /etc/init.d/redis start crond ``` 推出容器，在宿主系统中添加开机启动项，这里以apline为例子 ``` cd /etc/local.d vi bt.start # 添加内容 docker exec -it baota sh /www/wwwroot/bt.sh chmod +x bt.start rc-update add local ``` 备份容器 到tar ``` docker export baota> baota.tar gzip baota.tar #简化一下 事实证明没啥用 其实还是tar宝 docker export -o baota.tar.gz baota ``` 这个压缩包迁移到其他主机上 或 阿里docker服务 ``` # 导入到 镜像 baota:v1 docker import baota.tar.gz baota:v1 ``` docker重启后 要执行一次 '><meta property='og:url' content='https://dev.leiyanhui.com/c/docker-baota/'><meta property='og:site_name' content='小类随手记'><meta property='og:type' content='article'><meta property='article:section' content='C'><meta property='article:tag' content='docker'><meta property='article:tag' content='baota'><meta property='article:published_time' content='2022-09-07T19:56:11+00:00'><meta property='article:modified_time' content='2022-09-07T19:56:11+00:00'><meta name=twitter:title content="alpine/linux 下快速搭建可以随意整体迁移的宝塔面板"><meta name=twitter:description content='alpine/linux 下快速搭建可以随意整体迁移的宝塔面板 这里以alpine为例，安装后占用50M左右硬盘的一个完整linux系统\n下载iso 安装 https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/x86_64/alpine-virt-3.16.2-x86_64.iso\n安装过程使用国内neusoft镜像,用的虚拟机镜像联网安装，安装后就是最新版\n重启后登录：vi /etc/apk/repositories 去掉稳定版的community注释\n1 2 3 apk add docker #安装docker rc-update add docker boot #开机自动启动 service docker start #启动 重启一下，启动过程中可以看到dhcp的ip，启动后 ip a 也可以看到，路由器里面dhcp绑定一下ip。\nssh登录 修改docker源 文件不存在 会自动新建\n1 vi /etc/docker/daemon.json { &ldquo;registry-mirrors&rdquo;: [ &ldquo;https://hub-mirror.c.163.com&rdquo;, &ldquo;https://ustc-edu-cn.mirror.aliyuncs.com&rdquo;, &ldquo;https://docker.mirrors.ustc.edu.cn&rdquo; ] }\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 service docker restart # 然后虚拟机关机，整机备份 ``` **容器的选择**， 宝塔支持 是 Centos7.x > Debian10 > Ubuntu 20.04 > Centos8 stream > Ubuntu 18.04 > 其它系统 这几个系统的最后支持时间 centos7（2024-6-30）debian10 （2019年7月发布也差不多2024-7）ubuntu20.04(2025-4) Ubuntu 22.04.1 LTS 安全更新至2027年4月 debian11（2026 年 12 月）尽量选择前三个系统，1是因为在debian系下多数组件是编译安装的 2是宝塔最近小bug非常多，centos下会好一些 安装docker centos 和 宝塔 ``` docker pull centos:7 docker images # 启动容器 # 目录不映射出来，因为这里需要做一个全部都在docker的可迁移的 # 先把端口考虑好，后续修改麻烦 宝塔面板的两个 80 和 443 mysql MongoDB Redis PgSQL # 1122:22 算是备用的，另外需要预留几个golang用的端口 数字80开头的 docker run -i -t -d --name baota -p 8888:8888 -p 180:80 -p 1122:22 -p 1443:443 -p 13306:3306 -p 888:888 -p 16379:6379 -p 27017:27017 -p 27018:27018 -p 27019:27019 -p 28017:28017 -p 5432:5432 -p 8180-8199:8180-8199 --privileged=true --restart=always centos:7 /bin/bash #开始安装宝塔 docker exec -it baota /bin/bash #安装脚本 yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec ``` 登录宝塔面板 修改面板入口地址 安装 nginx mysql5.7 php7.4 redis7 php alioss打开常用扩展，因为版本的原因，均为编译安装，速度非常慢，耐心等待，选centos7的话就没有这个问题 配置好dnspod 的key 方便续签域名证书 宝塔 7.9.4 的alioss 有配置错误，经过测试又是一个小bug，导致它无论什么系统无法配置。 vi /www/server/panel/data/aliossAS.conf ``` {"access_key": "XXXXX", "secret_key": "XXXX", "bucket_name": "XXXX", "bucket_domain": "XXXX.oss-cn-qingdao.aliyuncs.com", "backup_path": "/bt_backup/"} ``` 可以正常用了 下载我的开源项目webdavgo 把/www目录映射出来到webdav ``` #https://dev.leiyanhui.com/c/webdavgo/ cd /www wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1.1/webdav chmod -x ./webdav #wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1/webdavgo.json ``` 编辑配置文件 关闭文件服务，webdav定位到 /www vim webdavgo.json ``` { "server_port":8189, "webdav_user_name":"admin", "webdav_user_psw":"12345", "webdav_file_path":"/www", "list_server_path":"", "list_file_path":"" } ``` 宝塔新建一个go项目 站点 端口输入上面的端口后，可执行文件 /www/webdav 剩下的不在说明 这样 /www 可以在外网通过webdav访问 测试完成后，修改server\\_port端口为没有映射过的端口，nginx开启ssl 同时在自己的域名控制面板里面 添加几个指向本地的子域名，免得测试项目老修改hosts文件 1.host.leiyanhui.com 到10.0.0.1 10.host.leiyanhui.com 到10.0.0.10 \\*.10.host.leiyanhui.com 到10.0.0.10 127.host.leiyanhui.com 到 127.0.0.1 \\*.127.host.leiyanhui.com 到127.0.0.1 配置docker里面的宝塔自动启动 在容器内新建文件 vi /www/wwwroot/bt.sh ``` ## 宝塔 在容器内自动启动 /etc/init.d/bt start /etc/init.d/redis start /etc/init.d/php-fpm-74 start /etc/init.d/mongodb start /etc/init.d/pgsql start /etc/init.d/mysqld start /etc/init.d/memcached start /etc/init.d/nginx start crond seelp 5 /etc/init.d/mysqld stop /etc/init.d/mysqld start /etc/init.d/redis stop /etc/init.d/redis start crond ``` 推出容器，在宿主系统中添加开机启动项，这里以apline为例子 ``` cd /etc/local.d vi bt.start # 添加内容 docker exec -it baota sh /www/wwwroot/bt.sh chmod +x bt.start rc-update add local ``` 备份容器 到tar ``` docker export baota> baota.tar gzip baota.tar #简化一下 事实证明没啥用 其实还是tar宝 docker export -o baota.tar.gz baota ``` 这个压缩包迁移到其他主机上 或 阿里docker服务 ``` # 导入到 镜像 baota:v1 docker import baota.tar.gz baota:v1 ``` docker重启后 要执行一次 '></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_6049d840d4e2d14.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🐟</span></figure><div class=site-meta><h1 class=site-name><a href=/>小类随手记</a></h1><h2 class=site-description>just so so.</h2></div></header><ol class=menu-social><li><a href=https://github.com/joyanhui/dev.leiyanhui.com-src target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>列表</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>站内搜索</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>links</span></a></li><li><a href=/contact/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>contact</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/c/docker-baota/>alpine/linux 下快速搭建可以随意整体迁移的宝塔面板</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2022-09-07</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 3 分钟</time></div></footer></div></header><section class=article-content><h1 id=alpinelinux-下快速搭建可以随意整体迁移的宝塔面板>alpine/linux 下快速搭建可以随意整体迁移的宝塔面板</h1><p>这里以alpine为例，安装后占用50M左右硬盘的一个完整linux系统</p><p>下载iso 安装 <a class=link href=https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/x86 target=_blank rel=noopener>https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/x86</a>_64/alpine-virt-3.16.2-x86_64.iso</p><p>安装过程使用国内neusoft镜像,用的虚拟机镜像联网安装，安装后就是最新版</p><p>重启后登录：vi /etc/apk/repositories 去掉稳定版的community注释</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apk add docker #安装docker
</span></span><span class=line><span class=cl>rc-update add docker boot #开机自动启动
</span></span><span class=line><span class=cl>service docker start #启动
</span></span></code></pre></td></tr></table></div></div><p>重启一下，启动过程中可以看到dhcp的ip，启动后 ip a 也可以看到，路由器里面dhcp绑定一下ip。</p><p>ssh登录 修改docker源 文件不存在 会自动新建</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vi /etc/docker/daemon.json
</span></span></code></pre></td></tr></table></div></div><p>{ &ldquo;registry-mirrors&rdquo;: [ &ldquo;<a class=link href=https://hub-mirror.c.163.com target=_blank rel=noopener>https://hub-mirror.c.163.com</a>&rdquo;, &ldquo;<a class=link href=https://ustc-edu-cn.mirror.aliyuncs.com target=_blank rel=noopener>https://ustc-edu-cn.mirror.aliyuncs.com</a>&rdquo;, &ldquo;<a class=link href=https://docker.mirrors.ustc.edu.cn target=_blank rel=noopener>https://docker.mirrors.ustc.edu.cn</a>&rdquo; ] }</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>service</span> <span class=n>docker</span> <span class=n>restart</span>
</span></span><span class=line><span class=cl><span class=c1># 然后虚拟机关机，整机备份</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>**</span><span class=err>容器的选择</span><span class=o>**</span><span class=err>，</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>宝塔支持</span> <span class=err>是</span> <span class=n>Centos7</span><span class=o>.</span><span class=n>x</span> <span class=o>&gt;</span> <span class=n>Debian10</span> <span class=o>&gt;</span> <span class=n>Ubuntu</span> <span class=mf>20.04</span> <span class=o>&gt;</span> <span class=n>Centos8</span> <span class=n>stream</span> <span class=o>&gt;</span> <span class=n>Ubuntu</span> <span class=mf>18.04</span> <span class=o>&gt;</span> <span class=err>其它系统</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>这几个系统的最后支持时间</span> <span class=n>centos7</span><span class=err>（</span><span class=mi>2024</span><span class=o>-</span><span class=mi>6</span><span class=o>-</span><span class=mi>30</span><span class=err>）</span><span class=n>debian10</span> <span class=err>（</span><span class=mi>2019</span><span class=err>年</span><span class=mi>7</span><span class=err>月发布也差不多</span><span class=mi>2024</span><span class=o>-</span><span class=mi>7</span><span class=err>）</span><span class=n>ubuntu20</span><span class=o>.</span><span class=mi>04</span><span class=p>(</span><span class=mi>2025</span><span class=o>-</span><span class=mi>4</span><span class=p>)</span> <span class=n>Ubuntu</span> <span class=mf>22.04</span><span class=o>.</span><span class=mi>1</span> <span class=n>LTS</span> <span class=err>安全更新至</span><span class=mi>2027</span><span class=err>年</span><span class=mi>4</span><span class=err>月</span> <span class=n>debian11</span><span class=err>（</span><span class=mi>2026</span> <span class=err>年</span> <span class=mi>12</span> <span class=err>月）尽量选择前三个系统，</span><span class=mi>1</span><span class=err>是因为在</span><span class=n>debian系下多数组件是编译安装的</span> <span class=mi>2</span><span class=err>是宝塔最近小</span><span class=n>bug非常多</span><span class=err>，</span><span class=n>centos下会好一些</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>安装</span><span class=n>docker</span> <span class=n>centos</span> <span class=err>和</span> <span class=err>宝塔</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>pull</span> <span class=n>centos</span><span class=p>:</span><span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>images</span>
</span></span><span class=line><span class=cl><span class=c1># 启动容器</span>
</span></span><span class=line><span class=cl><span class=c1># 目录不映射出来，因为这里需要做一个全部都在docker的可迁移的</span>
</span></span><span class=line><span class=cl><span class=c1># 先把端口考虑好，后续修改麻烦 宝塔面板的两个 80 和 443 mysql MongoDB Redis PgSQL</span>
</span></span><span class=line><span class=cl><span class=c1># 1122:22 算是备用的，另外需要预留几个golang用的端口 数字80开头的</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>run</span> <span class=o>-</span><span class=n>i</span> <span class=o>-</span><span class=n>t</span> <span class=o>-</span><span class=n>d</span>   <span class=o>--</span><span class=n>name</span> <span class=n>baota</span> <span class=o>-</span><span class=n>p</span> <span class=mi>8888</span><span class=p>:</span><span class=mi>8888</span> <span class=o>-</span><span class=n>p</span> <span class=mi>180</span><span class=p>:</span><span class=mi>80</span> <span class=o>-</span><span class=n>p</span> <span class=mi>1122</span><span class=p>:</span><span class=mi>22</span> <span class=o>-</span><span class=n>p</span> <span class=mi>1443</span><span class=p>:</span><span class=mi>443</span> <span class=o>-</span><span class=n>p</span> <span class=mi>13306</span><span class=p>:</span><span class=mi>3306</span> <span class=o>-</span><span class=n>p</span> <span class=mi>888</span><span class=p>:</span><span class=mi>888</span> <span class=o>-</span><span class=n>p</span> <span class=mi>16379</span><span class=p>:</span><span class=mi>6379</span> <span class=o>-</span><span class=n>p</span> <span class=mi>27017</span><span class=p>:</span><span class=mi>27017</span>  <span class=o>-</span><span class=n>p</span> <span class=mi>27018</span><span class=p>:</span><span class=mi>27018</span>  <span class=o>-</span><span class=n>p</span> <span class=mi>27019</span><span class=p>:</span><span class=mi>27019</span> <span class=o>-</span><span class=n>p</span> <span class=mi>28017</span><span class=p>:</span><span class=mi>28017</span> <span class=o>-</span><span class=n>p</span> <span class=mi>5432</span><span class=p>:</span><span class=mi>5432</span> <span class=o>-</span><span class=n>p</span> <span class=mi>8180</span><span class=o>-</span><span class=mi>8199</span><span class=p>:</span><span class=mi>8180</span><span class=o>-</span><span class=mi>8199</span> <span class=o>--</span><span class=n>privileged</span><span class=o>=</span><span class=bp>true</span> <span class=o>--</span><span class=n>restart</span><span class=o>=</span><span class=n>always</span> <span class=n>centos</span><span class=p>:</span><span class=mi>7</span> <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=c1>#开始安装宝塔</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>exec</span> <span class=o>-</span><span class=n>it</span> <span class=n>baota</span> <span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=c1>#安装脚本</span>
</span></span><span class=line><span class=cl><span class=n>yum</span> <span class=n>install</span> <span class=o>-</span><span class=n>y</span> <span class=n>wget</span> <span class=o>&amp;&amp;</span> <span class=n>wget</span> <span class=o>-</span><span class=n>O</span> <span class=n>install</span><span class=o>.</span><span class=n>sh</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>download</span><span class=o>.</span><span class=n>bt</span><span class=o>.</span><span class=n>cn</span><span class=o>/</span><span class=n>install</span><span class=o>/</span><span class=n>install_6</span><span class=o>.</span><span class=mf>0.</span><span class=n>sh</span> <span class=o>&amp;&amp;</span> <span class=n>sh</span> <span class=n>install</span><span class=o>.</span><span class=n>sh</span> <span class=n>ed8484bec</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>登录宝塔面板</span> <span class=err>修改面板入口地址</span> <span class=err>安装</span> <span class=n>nginx</span> <span class=n>mysql5</span><span class=o>.</span><span class=mi>7</span> <span class=n>php7</span><span class=o>.</span><span class=mi>4</span> <span class=n>redis7</span> <span class=n>php</span> <span class=n>alioss打开常用扩展</span><span class=err>，因为版本的原因，均为编译安装，速度非常慢，耐心等待，选</span><span class=n>centos7的话就没有这个问题</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>配置好</span><span class=n>dnspod</span> <span class=err>的</span><span class=n>key</span> <span class=err>方便续签域名证书</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>宝塔</span> <span class=mf>7.9</span><span class=o>.</span><span class=mi>4</span> <span class=err>的</span><span class=n>alioss</span> <span class=err>有配置错误，经过测试又是一个小</span><span class=n>bug</span><span class=err>，导致它无论什么系统无法配置。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vi</span> <span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>panel</span><span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>aliossAS</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;access_key&#34;</span><span class=p>:</span> <span class=s2>&#34;XXXXX&#34;</span><span class=p>,</span> <span class=s2>&#34;secret_key&#34;</span><span class=p>:</span> <span class=s2>&#34;XXXX&#34;</span><span class=p>,</span> <span class=s2>&#34;bucket_name&#34;</span><span class=p>:</span> <span class=s2>&#34;XXXX&#34;</span><span class=p>,</span> <span class=s2>&#34;bucket_domain&#34;</span><span class=p>:</span> <span class=s2>&#34;XXXX.oss-cn-qingdao.aliyuncs.com&#34;</span><span class=p>,</span> <span class=s2>&#34;backup_path&#34;</span><span class=p>:</span> <span class=s2>&#34;/bt_backup/&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>可以正常用了</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>下载我的开源项目</span><span class=n>webdavgo</span> <span class=err>把</span><span class=o>/</span><span class=n>www目录映射出来到webdav</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=c1>#https://dev.leiyanhui.com/c/webdavgo/</span>
</span></span><span class=line><span class=cl><span class=n>cd</span> <span class=o>/</span><span class=n>www</span>
</span></span><span class=line><span class=cl><span class=n>wget</span> <span class=o>-</span><span class=n>c</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>gitee</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>joyanhui</span><span class=o>/</span><span class=n>webdavgo</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=mf>1.1</span><span class=o>.</span><span class=mi>1</span><span class=o>/</span><span class=n>webdav</span>
</span></span><span class=line><span class=cl><span class=n>chmod</span> <span class=o>-</span><span class=n>x</span> <span class=o>./</span><span class=n>webdav</span>
</span></span><span class=line><span class=cl><span class=c1>#wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1/webdavgo.json</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>编辑配置文件</span> <span class=err>关闭文件服务，</span><span class=n>webdav定位到</span> <span class=o>/</span><span class=n>www</span>  
</span></span><span class=line><span class=cl><span class=n>vim</span> <span class=n>webdavgo</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;server_port&#34;</span><span class=p>:</span><span class=mi>8189</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;webdav_user_name&#34;</span><span class=p>:</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;webdav_user_psw&#34;</span><span class=p>:</span><span class=s2>&#34;12345&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;webdav_file_path&#34;</span><span class=p>:</span><span class=s2>&#34;/www&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;list_server_path&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;list_file_path&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>宝塔新建一个</span><span class=n>go项目</span> <span class=err>站点</span> <span class=err>端口输入上面的端口后，可执行文件</span> <span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>webdav</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>剩下的不在说明</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>这样</span> <span class=o>/</span><span class=n>www</span> <span class=err>可以在外网通过</span><span class=n>webdav访问</span> <span class=err>测试完成后，修改</span><span class=n>server</span>\<span class=n>_port端口为没有映射过的端口</span><span class=err>，</span><span class=n>nginx开启ssl</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>同时在自己的域名控制面板里面</span> <span class=err>添加几个指向本地的子域名，免得测试项目老修改</span><span class=n>hosts文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>1.</span><span class=n>host</span><span class=o>.</span><span class=n>leiyanhui</span><span class=o>.</span><span class=n>com</span> <span class=err>到</span><span class=mf>10.0</span><span class=o>.</span><span class=mf>0.1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>10.</span><span class=n>host</span><span class=o>.</span><span class=n>leiyanhui</span><span class=o>.</span><span class=n>com</span> <span class=err>到</span><span class=mf>10.0</span><span class=o>.</span><span class=mf>0.10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>\<span class=o>*.</span><span class=mf>10.</span><span class=n>host</span><span class=o>.</span><span class=n>leiyanhui</span><span class=o>.</span><span class=n>com</span> <span class=err>到</span><span class=mf>10.0</span><span class=o>.</span><span class=mf>0.10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>127.</span><span class=n>host</span><span class=o>.</span><span class=n>leiyanhui</span><span class=o>.</span><span class=n>com</span> <span class=err>到</span> <span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>\<span class=o>*.</span><span class=mf>127.</span><span class=n>host</span><span class=o>.</span><span class=n>leiyanhui</span><span class=o>.</span><span class=n>com</span> <span class=err>到</span><span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>配置</span><span class=n>docker里面的宝塔自动启动</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>在容器内新建文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vi</span> <span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>wwwroot</span><span class=o>/</span><span class=n>bt</span><span class=o>.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=c1>## 宝塔 在容器内自动启动</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>bt</span> <span class=n>start</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>redis</span> <span class=n>start</span> 
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>php</span><span class=o>-</span><span class=n>fpm</span><span class=o>-</span><span class=mi>74</span> <span class=n>start</span> 
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>mongodb</span> <span class=n>start</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>pgsql</span> <span class=n>start</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>mysqld</span> <span class=n>start</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>memcached</span> <span class=n>start</span> 
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>nginx</span> <span class=n>start</span> 
</span></span><span class=line><span class=cl><span class=n>crond</span>
</span></span><span class=line><span class=cl><span class=n>seelp</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>mysqld</span> <span class=n>stop</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>mysqld</span> <span class=n>start</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>redis</span> <span class=n>stop</span> 
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>init</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>redis</span> <span class=n>start</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>crond</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>推出容器，在宿主系统中添加开机启动项，这里以</span><span class=n>apline为例子</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=n>cd</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>local</span><span class=o>.</span><span class=n>d</span>
</span></span><span class=line><span class=cl><span class=n>vi</span> <span class=n>bt</span><span class=o>.</span><span class=n>start</span>
</span></span><span class=line><span class=cl><span class=c1># 添加内容 </span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>exec</span> <span class=o>-</span><span class=n>it</span> <span class=n>baota</span> <span class=n>sh</span> <span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>wwwroot</span><span class=o>/</span><span class=n>bt</span><span class=o>.</span><span class=n>sh</span> 
</span></span><span class=line><span class=cl><span class=n>chmod</span> <span class=o>+</span><span class=n>x</span> <span class=n>bt</span><span class=o>.</span><span class=n>start</span>
</span></span><span class=line><span class=cl><span class=n>rc</span><span class=o>-</span><span class=n>update</span> <span class=n>add</span> <span class=n>local</span> 
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>备份容器</span> <span class=err>到</span><span class=n>tar</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=k>export</span> <span class=n>baota</span><span class=o>&gt;</span> <span class=n>baota</span><span class=o>.</span><span class=n>tar</span>
</span></span><span class=line><span class=cl><span class=n>gzip</span> <span class=n>baota</span><span class=o>.</span><span class=n>tar</span>
</span></span><span class=line><span class=cl><span class=c1>#简化一下 事实证明没啥用 其实还是tar宝</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=k>export</span> <span class=o>-</span><span class=n>o</span> <span class=n>baota</span><span class=o>.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span>  <span class=n>baota</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>这个压缩包迁移到其他主机上</span> <span class=err>或</span> <span class=err>阿里</span><span class=n>docker服务</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl><span class=c1># 导入到 镜像 baota:v1</span>
</span></span><span class=line><span class=cl><span class=n>docker</span> <span class=n>import</span> <span class=n>baota</span><span class=o>.</span><span class=n>tar</span><span class=o>.</span><span class=n>gz</span> <span class=n>baota</span><span class=p>:</span><span class=n>v1</span>
</span></span><span class=line><span class=cl><span class=err>```</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>docker重启后</span> <span class=err>要执行一次</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/docker/>Docker</a>
<a href=/tags/baota/>Baota</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>最后更新于 2022-09-07 19:56 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/c/docker-baota-cn/><div class=article-details><h2 class=article-title>docker运行宝塔的几个问题：开启不自启动，计划任务无法运行等</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//xiao-lei-sui-shou-ji.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 小类随手记</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>