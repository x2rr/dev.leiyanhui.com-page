[{"content":"通常 我们使用 go get -u XXXX@XXX 来更新\n但是 有时发现无效， 于是 go clean -modcache 发现也没啥卵用\n但是 go get -u XXXX@commitID 是可以的。\n其实 这个时候 其实 你要考虑一下 是不是配置了GOPROXY,大概率是你的用的GOPROXY的缓存的问题。\nGOPROXY=direct go get -u XXX@XX 就ok了\n所以 大内网下写代码 很涨知识。 让个人/小企业都能体验大企业/涉密单位的Goproxy.io Enterprise 版的 缺点。。。。\n","date":"2025-07-09T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/goget/","title":"go get 获取不到最新版？"},{"content":" 本文更新可能滞后于 github仓库的说明文档\n使用问题交流请去恩山或discussions\nbug反馈和建议以及公共doh/github proxy分享都可以提issues，我会尽快处理.给个star我会很开心.\nPR请尽量通过一次commit提交过来.\n关于爱快的分流规则请查看我另外的仓库 [joyanhui/ikuai-bypass]\n单adguardhome分流解析 安装和启动 这里以opwenwrt主路由的情况为例子，其他环境随便使用docker或者官方的安装命令等都可以正常安装。此文不涵盖相关内容。\n非常不建议使用luci-app-adguardhome,不但没必要而且会带来更多困扰。\n先确定你的openwrt配置了正确的源，并且没有项目展会用3000端口，然后依次运行下面两行命令\n1 2 3 4 opkg update #更新软件列表 opkg install adguardhome #安装 /etc/init.d/adguardhome start #启动 /etc/init.d/adguardhome enable #下次开机自动运行 adguardhome 替代路由器自带的Dnsmasq 关闭Dnsmasq的dns功能：openwrt web界面：网络\u0026gt;DHCP/DNS\u0026gt;高级设置 DNS 服务器端口 默认是53修改为0 即可关闭 修改dhcp下发的dns ：openwrt web界面：网络\u0026gt;接口 找到br-lan 编辑 一般在这个接口的DHCP服务器的高级设置里面 找到 DHCP 选项 添加或者修改一协调6,192.168.1.1,223.6.6.6 即给dhcp客户端分配两个dns地址192.168.1.1,223.6.6.6 如果你的 adguardhome的安装ip不是在192.168.1.1那么这里要修改一下 如果是爱快直接使用dns代理功能指定到adguardhome即可\nadguardhome 基本配置 访问你运行adguardhome的加端口号 3000，例如:http://192.168.1.1:3000\ndns端口就用53,因为上面我们已经把Dnsmasq的dns功能关闭了，所以这里adguard可以站哟机构53端口。 web访问端口不要用80,还是3000就好啦。\n以及配置好管理账号密码以后 进入adg的管理面板\nadguardhome 基本dns配置 adg的管理面板：设置 \u0026gt; DNS设置\n上游 DNS 服务器 随便输入一个可用的，不用配置太多，因为后面我们要用配置路径的方式用文件来配置上游dns规则。建议就输入一个 223.5.5.5 负载均衡/并行请求/最快ip地址 建议选择 并行请求 Bootstrap DNS 服务器 输入几个公共dns的ip 例如 123.125.81.6 223.6.6.6 119.29.29.29一行一个 DNS 服务配置 速度限制 建议修改20-100左右，我这里配置为50 DNS缓存配置 根据自己需求和硬件性能配置我这里配置 缓存大小1024000 最小ttl30 最大ttl1800 此时 整个局域网的，包括路由器openwrt自己的dns 均由adguard接管。测试未访问过的网站是否可以正常ping到ip地址。例如：ping news.163.com ping news.baidu.com ping image.baidu.com\nadguardhome 配置分流规则 adguardhome 分流思路 adguard home支持 [/example.local/]94.140.14.140: 指定为特定域名的上游服务器； 这样的规则，那么我们只需要整理对应的域名列表 然后指定对应的上游dns即可。但是在adguard home的管理面部中的上游dns配置这个页面 显然不可能输入上几万个域名。但是adguard支持直接用文件配置。而我们又可以从Loyalsoldier等大佬的仓库获得一些我们需要的域名清单。虽然格式不符合要求，但是我们可以自己用程序稍微处理一下让他符合adguard home的格式，再把多个域名清单列表合并到一个里面那就大功告成了。\n所以我提供好了 每天会更新的规则文件，你只需要下载回去自己再用脚本修改一下即可。 然后这个脚本 可以用wget下载sed修改，然后添加到计划人物每天运行就可以自动更新了。 地址是 https://github.com/joyanhui/adguardhome-rules/tree/release_file\n无辅助上网环境的情况下 你要确定你有办法可以直接方法github的文件，以及有无污染的dns上游可用，建议自己准备一个域名自己从cloudflare自建一个github镜像站和自建一个私有doh.\n域名，可以申请免费那些域名。不过建议从阿里云或者cloudflare或者其他地方购买一个。8位数字的xyz域名一年只要几块钱。免费的二级域名比较容易在敏感时期全部被大局域网屏蔽，然后dns托管到cloudflare,开通 cloudflare worker。这个网络很多教程。\n配置自己的 github代理镜像网址 worker源码 https://github.com/joyanhui/gh-proxy/blob/master/index.js 配置自己的 doh源码： cfworks_doh.js 记得修改里面的?dns-query= 如果你不想折腾可以从网络搜索其他人的，这里提供几个目前可用的\ngithub proxy 地址收集 https://goppx.com/ github proxy: https://github.akams.cn/ github proxy: https://ghproxy.net/ 无污染的 dns 地址收集 dot因为端口特殊的问题基本都不稳定，doh的话 cloudclare在多数下可用\nhttps://dns.cloudflare.com/dns-query 创建一个自动更新adguard上游dns规则文件的脚本 创建一个自动更新脚本 比如\nnano /overlay/data/adguard_upstream_dns_file_update.sh 内容如下\n1 2 3 4 5 6 7 8 #!/bin/sh rm -rf /overlay/data/adguard_upstream_dns_file.txt wget \u0026#34;https://你的githubProxy代理站地址/https://raw.githubusercontent.com/joyanhui/adguardhome-rules/refs/heads/release_file/ADG_chinaDirect_WinUpdate_Gfw.txt\u0026#34; -O /overlay/data/adguard_upstream_dns_file.txt sed -i \u0026#39;s/d-o-h.you-cf-domain.com/你的doh域名部分/g\u0026#39; /overlay/data/adguard_upstream_dns_file.txt sed -i \u0026#39;s/your-suffix/你的doh后缀部分/g\u0026#39; /overlay/data/adguard_upstream_dns_file.txt /etc/init.d/adguardhome restart 如果你没有自己的私有githubPoryx和doh\nGithubProxy https://你的githubProxy代理站地址/ 修改为 https://goppx.com/。也可以把wget的完整地址更换为 https://joyanhui.github.io/adguardhome-rules/ADG_chinaDirect_WinUpdate_Gfw.txt https://gcore.jsdelivr.net/gh/joyanhui/adguardhome-rules@release_file/ADG_chinaDirect_WinUpdate_Gfw.txt https://testingcf.jsdelivr.net/gh/joyanhui/adguardhome-rules@release_file/ADG_chinaDirect_WinUpdate_Gfw.txt https://cdn.jsdmirror.com/gh/joyanhui/adguardhome-rules@release_file/ADG_chinaDirect_WinUpdate_Gfw.txt 无污染的dns,udp/tcp无可用的，tls不稳定，目前只有cloudflare的多数时间和地区可用。强烈建议自建 你的doh域名部分 可以修改为 dns.cloudflare.com 你的doh后缀部分 修改为dns-query [joyanhui/adguardhome-rules/tree/release_file] 分支中有多个每日自动更新的规则文件，选择其中一个适合你的\n你需要根据你的情况修改一下 里面两个地址 以及文件路径。如果不是openwrt还需要修改对应的重启adgurd的命令\n运行一次 sh /overlay/data/adguard_upstream_dns_file_update.sh,然后自己检查获取到的adguard_upstream_dns_file.txt这个文件是否正常。\n如果你中间运行出错了，导致dns全部失效 可以执行下面命令恢复dns基本的运行\n1 2 3 echo \u0026#39;114.114.114.114 223.6.6.6 \u0026#39;\u0026gt;/overlay/data/adguard_upstream_dns_file.txt 添加到计划任务 1 chmod +x /overlay/data/adguard_upstream_dns_file_update.sh 然后在openwrt的web管理里面：系统\u0026gt;计划任务 增加一行 本机时间每天早上8点15运行\n1 15 8 * * * /overlay/data/adguard_upstream_dns_file_update.sh 配置adguard home 的上游dns为规则文件模式 找到你的adguardhome的yaml配置文件。上面按照的是在/etc/adguardhome.yaml,如果你不确定可以搜索一下 find / -name \u0026quot;*uard*ome.yaml\u0026quot;\n编辑这个文件 找到这行 upstream_dns_file 修改为\n1 upstream_dns_file: /overlay/data/adguard_upstream_dns_file.txt 在修改upstream_dns_file并重启adguardhome后upstream_dns 部分的配置会失效，adguardhome的网页端也可以看到\n在修改upstream_dns_file 之前可以先ping一个gfw的域名。例如 ping google.com,修改完成后 重启adguardhome ，然后再ping一下看看能否获取正确的ip\n进阶 adguardhome 搭建自己的doh 本地的adguardhome也可以对外提供 doh。有两种方式 一种是自签证书[在线生成]或者购买一个长期证书。另外一种方式就是配合证书管理和反向代理工具，下面用 lucky来做简单说明。\nadguardhome 启用doh 在 adguardhome 的设置 加密设置里面 启用加密 HTTPS 端口 配置为一个可用的端口，例如 30443 不要打开https重定向，无意义\nDNS-over-TLS 端口 和 DNS-over-QUIC 端口 因为牵扯到证书续签的问题，这里就干脆设置为0,不使用了。\n然后 证书内容 粘贴一下随便一个目前可用的域名证书（暂时可用的就ok） 可以从lucky的ssl管理的 映射路径 里面 crt 和key文件里面获取到。\n然后保存修改\nlucky接管 adguardhome的https lucky web服务正常可用的情况下，添加一个子规则：\n前端地址 你的域名 后端地址 adguardhome 的https地址 例如 https://192.168.1.1:30443 忽略后端TLS证书验证 一定要勾选 这样我们就不用关心adguardhome的证书是否可用。 doh 测试命令 大全 1 2 3 4 5 6 dnslookup x.com https://你的doh域名/你的doh后缀 doggo x.com A AAAA MX --time @https://你的doh域名/你的doh后缀 doggo x.com @https://你的doh域名/你的doh后缀 doggo x.com @https://cloudflare-dns.com/dns-query adguard 广告过滤规则 收集 adguard home广告过滤\n1 2 3 4 5 6 7 8 9 # easylist国际网页 https://easylist-downloads.adblockplus.org/easylist.txt # easylist国内网页 https://easylist-downloads.adblockplus.org/easylistchina.txt # easylist-cookis 阻止Cookie标语，GDPR覆盖窗口和其他与隐私相关的通知 https://easylist-downloads.adblockplus.org/easylist-cookie.txt # anti-AD中文区命中率最高 的广告过滤列表 电视盒子 日志收集、大数据统计 https://gh.leiyanhui.com/https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-easylist.txt 感谢 [Loyalsoldier] ","date":"2025-06-11T08:30:20+08:00","permalink":"https://dev.leiyanhui.com/c/adguardhome-rules/","title":"adguard home单实例自动更新分流规则"},{"content":"zed编辑器 已经到了完全可用的阶段（linux/macos）\n目前发现的的几个问题\n不支持flutter 虽然支持dart 但是对flutter的支持接近没有。 官方貌似不打算支持，只能等第三方。 没有debug模式，更无法打断点。 貌似官方明确短时间不会支持 ai功能 目前比较孱弱 虽然有不少功能模仿了cursor/windsurf 但是很简陋 ","date":"2025-03-11T08:30:20+08:00","permalink":"https://dev.leiyanhui.com/c/zed-editor/","title":"关于zed editor的几个评价"},{"content":"windsurf 是一个和cursor齐名的 ai代码编辑器 or IDE ,基于 vscode开源版.\n最近cursor白嫖困难, 付费合租或者加商业版也都不太稳定.所以尝试使用windsurf 替代cursor\n但是截至2025年2月6日,nixpkgs尚未收录windsurf 所以自己打包一个,基于 homemanager\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 { pkgs, ... }: let # https://windsurf-stable.codeiumdata.com/linux-x64/stable/d08b8ea13d580d24be204c76e5dd1651d7234cd2/Windsurf-linux-x64-1.2.6.tar.gz version = \u0026#34;1.2.6\u0026#34;; # \u0026#34;windsurfVersion\u0026#34; urlHash = \u0026#34;d08b8ea13d580d24be204c76e5dd1651d7234cd2\u0026#34;; # \u0026#34;version\u0026#34; hash = \u0026#34;sha256-rXHrArkwLUzxQTwKg3Y/Rf5FXlvnTunhR3vqLoWgLKo=\u0026#34;; windsurf = pkgs.callPackage (pkgs.path + \u0026#34;/pkgs/applications/editors/vscode/generic.nix\u0026#34;) { pname = \u0026#34;windsurf\u0026#34;; executableName = \u0026#34;windsurf\u0026#34;; longName = \u0026#34;Windsurf\u0026#34;; shortName = \u0026#34;windsurf\u0026#34;; version = version; src = pkgs.fetchurl { inherit hash; url = \u0026#34;https://windsurf-stable.codeiumdata.com/linux-x64/stable/${urlHash}/Windsurf-linux-x64-${version}.tar.gz\u0026#34;; }; sourceRoot = \u0026#34;Windsurf\u0026#34;; commandLineArgs = \u0026#34;\u0026#34;; meta = { description = \u0026#34;The first agentic IDE, and then some\u0026#34;; }; updateScript = \u0026#34;\u0026#34;; }; in { home.packages = with pkgs; [ windsurf ]; } 参考: https://github.com/KenMacD/etc-nixos/blob/main/pkgs/windsurf.nix\n","date":"2025-02-07T17:24:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/windsurf-in-nixos/","title":"nixos下使用windsurf 编辑器"},{"content":"cosmic 已经到了 Alpha 5版，在nixos下暂时只能编译安装。nixpkg仓库里面的版比较老。 简单体验了一会 只能说未来可期，暂时无法使用。\n目前的bug 桌面背景无法设置图片，具体表现为 选择图片的对话框打不开。直接闪掉 同样 多数应用的选择文件的对话框也如此 屏幕 dpi 设置有效，但是会直接卡掉桌面 需要重启桌面 fcitx5 会卡掉整个桌面 堆叠窗口模式下 大部分app的窗口外壳 外面套了一个cosmic的默认窗口样式。导致部分应用带了两个标题栏。好像i3w hyprland之类的浮动模式也有这个问题，不过cosmic暂时不知道怎隐藏指定应用的窗口外框title 动画效果是0 ，几乎没有任何窗口切换效果 alt tab 功能缺失，好像别人的没问题。 cosmic-file 没有收藏/书签 功能， 所以目前cosmic 还无法正常使用\n亮点，未来可期 默认主题不太难看，样式较为统一 平铺模式和堆叠模式 都支持，而且支持的不错。 cosmic 自带的应用 终端 文本编辑器 文件管理器 设置 等 完成度不错。 风格接近gnome但是占用比gnome少太多了 比gnome可定制性强，比kde简洁。 非常非常期待 cosmic, 受够了kde的繁琐 和gnoome的丑\n","date":"2025-01-12T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/cosmic-desktop-alpha5/","title":"cosmic desktop Alpha 5 初体验"},{"content":"平时写的东西比较杂， go rust python flutter c pythone mircopython uniapp vue react。 使用几个ai后基本的纯感觉。\n不同于网上的那些对比比较，这几个有限的\n每个功能按照10分计算\n基本体验 copilot: 代码提示准确率6分 速度4分 修错能力2分 通义灵码 : 代码提示准确率5分 速度4分 修错能力1分 （评价：免费的 加上马马虎虎的准确率） cursor: 代码提示准确率8分 速度5分 修错能力6分 （整体不错，就是贵） fitten : 代码提示准确率2分 速度10分 修错能力1分 （这个目前感觉，用他以后效率反而下滑） JetBrains AI Assistant ：只试用过5天左右，到期后没有继续试用，整体感觉和通义灵码差距不大 优势不明显。然而通义灵码免费 Codeium （插件）：代码提示准确率5.5分 速度4分 修错能力2分 因为用的时间较少 加上windsurf的nixos包需要自己写，所以不做更多评价 kimi ： 只用过他的对话模式，不知道时不时使用姿势有问题，感觉他的编程能力接近0 准确率之类的无从谈起 项目重构能力 这时主要是说的项目结构的变更，包括部分操作单独拆到函数，以及整个项目的结构的重新组织。\ncopilot: 只有文件内的或者函数级的重构 重构后的逻辑和算法 比一般的程序员写的要好也更加标准，但是也会语法错误或者自己乱造的东西。打4分 通义灵码 : 和copilot差不多 4分 cursor: 可以直接帮你新创建文件，要替换的文件也会给你创建一个范例出来。当然文件内和函数级的也没问题，但是也有会语法错误和乱造。6分。其中2分是给目录结构优化的。 fitten : 只有文件内的或者函数内的重构 胡编乱造的多，但是偶有不错的地方。 冷门语言和需求的体验 mircopython 因为ai经常会按照python的方法来写mircopython\ncopilot: 代码提示准确率3分 修错能力0分 通义灵码 : 代码提示准确率2分 修错能力0分 cursor: 代码提示准确率4分 修错能力2分 fitten : 不曾浪费时间使用 结合硬件的项目，单片机/uos等 copilot: 代码提示准确率3分 修错能力0分 通义灵码 : 代码提示准确率2分 修错能力0分 cursor: 代码提示准确率5分 修错能力4分 fitten : 不曾浪费时间使用 cursor 此时在告知了硬件情况后，还是有很大的概率可以修复语法和逻辑错误的\nnix文件 在2024年10月份左右 各大ai,包chatgpt 对 nix语言的支持基本都是0,但是12月份 准确都不错了\ncopilot: 代码提示准确率4分 修错能力0分 通义灵码 : 代码提示准确率2分 修错能力0分 cursor: 代码提示准确率6分 修错能力5分 fitten : 因为经常更新自己的nixos-config 所以依旧是体验了下，准确接近0 修错能力更是接近0 ","date":"2024-12-27T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/c/code-ai/","title":"目前较为好用的ai 代码助手长时间使用亲身体会 "},{"content":"一般情况下 flake.nix中我们这样写home-manager\n1 2 3 4 5 6 7 8 9 10 11 12 13 { inputs = { nixpkgs.url = \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/nixos-24.05/nixexprs.tar.xz\u0026#34;; home-manager = { url = \u0026#34;github:nix-community/home-manager/release-24.05\u0026#34;; inputs.nixpkgs.follows = \u0026#34;nixpkgs\u0026#34;; }; }; outputs = inputs@{ nixpkgs, home-manager, ... }: { nixosConfigurations={ ..... }; } 先在无梯子环境下 nixos-rebuild 大概率会卡在 获取github上的一个文件的地方。记住这个url https://github.com/nix-community/home-manager/archive/2f23fa308a7c067e52dfcc30a0758f47043ec176.tar.gz\n第一个方案 是使用国内支持github同步的git景象，镜像一下 https://github.com/nix-community/home-manager 这个仓库。\n第二个方案 是使用github下载代理网站，例如 https://ghp.ci/ 此类网站稳定性都很差，因为用的人太多，域名经常被封，建议自建。https://github.com/joyanhui/gh-proxy\n然后 url = \u0026quot;github:nix-community/home-manager/release-24.05\u0026quot;;\n这行修改为\nurl=\u0026quot;https://github代理地址/https://github.com/nix-community/home-manager/archive/2f23fa308a7c067e52dfcc30a0758f47043ec176.tar.gz\u0026quot;;\n例如\n1 url=\u0026#34;https://ghp.ci/https://github.com/nix-community/home-manager/archive/2f23fa308a7c067e52dfcc30a0758f47043ec176.tar.gz\u0026#34;; 理论上过一段时间，你可能需要重新复原 到github,然后关闭代理后获得这个url后更新。 或者直接去 https://github.com/nix-community/home-manager/对应的tree/release-24.05里面查询\n","date":"2024-11-03T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/home-manager-china/","title":"nixos home manager国内使用小技巧"},{"content":"小坑 nixos 用 /dev/by-lable/** 挂载硬盘，在挂载 /根目录的时候 大概率是有问题的。\nautofs 的配置和常规发行版的不太一样，默认如下文注释说明。\nautofs-service.nix 实例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 {pkgs, ...}: { environment.systemPackages = [ pkgs.dosfstools pkgs.exfat pkgs.nfs-utils pkgs.btrfs-progs pkgs.btrfs-snap ]; # 自动挂载到 /autofs/子目录 services.autofs = { enable = true; autoMaster = let mapConf = pkgs.writeText \u0026#34;autofs.mnt\u0026#34; \u0026#39;\u0026#39; 128g -fstype=exfat :/dev/disk/by-label/128G ntfs -fstype=ntfs :/dev/disk/by-label/NTFS \u0026#39;\u0026#39;; in \u0026#39;\u0026#39; /autofs ${mapConf} --timeout 20 \u0026#39;\u0026#39;; }; } ","date":"2024-11-03T00:15:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/disk-mount/","title":"nixos硬盘挂载方案和小坑，hardware-configuration.nix autofs"},{"content":"nixos安装教程之前写过，但是怎么直接复现安装呢？\n其实很简单 处理好挂载后。直接用nixos-install 带fake参数指定配置文件和hostname即可\n1 2 cd /mnt nixos-install --show-trace --option substituters https://mirror.sjtu.edu.cn/nix-channels/store --flake /mnt/home/username/workspace/nixos-config-v3#thinkbook 以上命令在官方24.05 gnome live安装盘通过，自定义的iso镜像或许需要先开启flake\n1 nix.settings.experimental-features = [ \u0026#34;nix-command\u0026#34; \u0026#34;flakes\u0026#34; ]; ","date":"2024-11-02T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/os-by-flake-install/","title":"nixos复现安装，带flake模式"},{"content":"更新说明 旧版文档地址:https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui-old/ 本文内容未覆盖到信息请参考旧版文档。\n项目说明 ikuai-bypass 是一个自动维护爱快分流规则的小工具，基于golang开发。 项目地址 https://github.com/joyanhui/ikuai-bypass/\n爱快分流原理 爱快分流方式不同与传统的旁路由方案，更加直观，速度也更加好。\n下述文档中 以爱快+openwrt为例，（实际上 openwrt可以用其他linux甚至win/macos替代，只要能运行你想要的对应的工具即可。可以在docker/lxc/kvm/vmware/virtuabox/物理设备）中运行openwrt.\n分流方式主要有两种： 1、isp分流和域名分流配合： 基于爱快的自定义isp的ip功能，实现针对wan口的分流，把非国内ip和部分域名分流到wan2口由openwrt处理后 回流到wan1，国内ip和国内大站直接分流到wan1。\n2、ip分组+端口分流和下一跳网关： 基于爱快的ip分组功能和端口分流功能，把国内ip直接走wan1,其他ip或者指定的ip用下一跳网关的方式到达openwrt再回流到wan1。\n爱快分流的优点 比单openwrt方案更加直观容易维护 比旁路由方案更加稳定 速度也好很多。 和自建dns配合更简单。 openwrt的安装方式 以下均为有效的方式 ，这里的openwrt泛指可以运行你喜欢的那些工具的系统。\n爱快内的docker 其他设备的docker 或者lxc运行的openwrt或者其他配置好的系统。 爱快内的kvm 或者其他的 kvm vmware virtualbox 和hyper-v 等虚拟机系统。 双网口设备 / 单网口设备。 测试过的系统 openwrt 老毛子 alpine macos11-15 win8-11 debian pve opensuse nixos \u0026hellip;.. 支持的深度学习工具软件：暂时未发现无法支持的工具。 常规使用方式 isp分流和域名分流配合 较为复杂，但是高可用性网络自愈性比较好。\n简单说明 建议在pve/esxi/unraid/群晖/docker/lxc/podman中运行爱快+openwrt，当然也可以物理设备。 单网卡 pve测试没问题，其他环境同样不会有问题。 爱快3个或者3个以上网卡/虚拟网卡 作为主路由\nopenwrt/其他linux 双网卡/虚拟网卡，作为下级路由（非旁路由）\npve下推荐配置 推荐 2G内存安装ikuai 32位版，硬盘1G即可，然后修改为 512M内存\nopenwrt 官方版，或者自编译版本 内存 256-512M（开clash要300M，v2系256M就可以） 硬盘512M即可，或者看你img的分区。或lxc运行\niKuai Bypass 运行在 openwrt mosdns 也可以运行在 openwrt mosdns all in one方案 modns配adg方案 64位 爱快，kvm/docker 运行 openwrt 和 iKuai Bypass 以及 mosdns 也可以，但是不推荐。\n物理网络/虚拟网卡配置 举例 爱快 lan1 绑定到 eth0 开DHCP dhcp范围 10.1.1.5-10.1.1.254\n爱快 wan1 绑定到 eth1 pppoe拨号 wan1先设置为默认线路 爱快 wan2 绑定到 eth2 静态ip指定 10.0.0.2 网关10.0.0.1\nopenwrt wan 绑定到eth0 DHCP客户端，连接到爱快lan1 从爱快静态ip绑定为10.1.1.3 openwrt lan 绑定套eth1 关闭DHCP服务，ip地址配置 10.0.0.1 即为爱快wan2的上游网关\nopenwrt的两个网口绑定到那个eth不影响使用,用默认的就好。\n可以参考top图github\n下文说配置都以上述为例\n避免死循环 在爱快内手动添加一个分流规则 流控分流 \u0026gt; 分流设置 \u0026gt; 端口分流\n分流方式：外网线路 线路：wan1 源地址 ip/mac分组 添加一个 10.1.1.3 点加入 保存\n此时 openwrt出来的流量 走wan1 不会再到wan2回到openwrt 导致死循环。\n此时openwrt 可以正常访问外部网络。\n注意：备注不建议包含字符：IKUAI_BYPASS ，否则有概率会被ikuai_bypass工具清理掉。\n配置 wan2 为默认线路 此时所有对外网访问 都会 经过wan2 到openwrt,然后根据你的深度学习软件的分流情况决定是否加密，再回到爱快的lan1 再流向外网。\n此时你的上网速度和传统的旁路由模式完全一样，略慢。\n配置国内域名强制走wan1直连 流控分流 \u0026gt; 分流设置 \u0026gt; 域名分流，选择wan1 ，输入几个域名，输入客户端ip,建议 10.1.1.5-10.1.1.254 ，此时10.1.1.5-10.1.1.254 的设备访问这个域名会直接走wan1 , 不经过openwrt，速度飞快。\n当然你自己输入太麻烦了。ikuai-bypass 可以自动帮你维护这个域名列表，通过ikuai-bypass可以自己托管一个域名列表并保证规则的id是最大。\n配置某些域名强制走wan2 交给openwrt处理 目的是啥，你肯定知道。配置和上面一样，同样 ikuai-bypass 可以自动帮你维护这个域名列表。\n配置国内ip强制走wan1 因为域名清单里面的域名不能覆盖所有网站，还有一些是没有域名直接ip连接情况。所以需要维护一个根据ip分流的规则。\n流控分流 \u0026gt; 分流设置 \u0026gt; 多线负载 自定义运营商 添加运营商 名称：国内ip地址 目的地址：输入几个国内的ip,备注：自定义\n返回 流控分流 \u0026gt; 分流设置 \u0026gt; 多线负载 点右侧添加 运营商：选择你刚刚添加的名称，点wan1 后面的启用，保存。\n此时 你访问这个ip上的网站或者其他东西，会强制走wan1 不经过openwrt，速度飞快。 同样 ikuai-bypass 可以自动帮你维护这个IP地址列表。\n配置默认线路 确保网络100%可用性 把wan2 配置为默认线路，网络设置 \u0026gt; 内外网设置 wan2 同时打开\n默认网关：设此条线路为默认网关 自动切换：掉线自动切换 线路检测：HTTP www.google.com 此时，访问不在国内域名清单的域名，并且ip不再自定义运营商的国内ip地址的服务器，会默认走wan2。如果openwrt死机或者google连不上，会自动临时禁用wan2 默认走wan1。\n使用ikuai-bypass 自动维护ip和域名规则。 较为简单\n部署ikuai-bypass ikuai-bypass 只要部署在可以访问到 爱快路由器的地方即可。一般建议以服务模式直接部署到openwrt内。\n服务模式 openwrt/alpine/rc/systemd 以openwrt为例 请参考 github\n下载最新版 https://github.com/joyanhui/ikuai-bypass/releases\n配置文件 需要自定义一个配置文件 config.yml 格式如下。\n然后运行 ./ikuai-bypass -c /路径/config.yml 即可在启动时候 自动更新一次规则文件，并在 cron指定的时间内定时运行。\n下面的配置文件 会执行一下操作\n自动登陆到 网址是 http://10.1.1.1 的爱快 使用用户名admin 密码 admin888登陆，如果登陆成功。 运营商/IP分流规则 他会帮你添加 一个 国内IP列表 的运营商，你需要去爱快 流控分流 \u0026gt; 分流设置 \u0026gt; 多线负载 添加规则，选择 国内IP列表 启用wan1\n也会添加几个 telegram google 等ip地址，你可以删掉那几行，也可以添加规则 启用wan2 另外会添加4个域名分流规则 分别强制走wan1 和wan2 你可以在下面配置文件清晰看到。需要注意的是 china-list 和 gfw两个清单 都很长，添加/更新的时候会很慢。你可以根据你的需求决定是否要保留，添加后会增加你访问网址的速度，但是会增加ikuai的性能消耗（大概增加30-120M内存消耗，cpu负载也会增加一点），如果你的ikuai配置很烂，可以去掉其他规则 只使用 国内IP列表 的IP分流即可 。 文件内容参考 https://github.com/joyanhui/ikuai-bypass/blob/main/config.yml\n运行命令参考 1 ./ikuai-bypass -r cron -m ispdomain -c /opt/ikuai-bypass/config.yml 另外一种使用方式 ip分组+端口分流和下一跳网关 这种方式较为简单，并且不需要openwrt设备有2个网口。爱快也只需要2个网口。\n网络结构 爱快配置好wan1 和lan1 以及pppoe等 正常上网。\n配置好一个openwrt 这里的openwrt依旧是泛指可以运行你想要的工具软件的系统，作为爱快的下级普通设备。 可以使用单臂路由，手动指定ip为 10.1.1.3 或者有ikuai的dhcp分配均可\n避免死循环 参考上文\n下一跳网关和ip分组 由ikuai-bypass来维护，从ikuai-bypass的配置文件中修改即可。\n使用ikuai-bypass 自动维护ip分组、端口分流和下一跳网关 部署ikuai-bypass 参考上文\n配置文件 参考上文\n运行命令参考 1 ./ikuai-bypass -r cron -m ipgroup -c /opt/ikuai-bypass/config.yml docker 我没有打包docker镜像，因为完全没必要，你可以自己用下面的命令启动一个docker 请参考 ： github\n以及 github的readme中的docker部分 常用参数 最新的参数说明请参考github的文档桌面，这里更新可能存在滞后。\n-c : 配置文件路径 默认为当前目录下config.yml 可用相对路径或者绝对路径 -m : 是否启用ip分组和下一跳网关模式（端口分流）v2.0以后版本有效 ispdomain : 使用isp和域名分流功能(默认，为了兼容v1.x版本) ipgroup : 使用ip分组和下一跳网关模式（端口分流) ii : 同时使用 上面两种模式 -r : 运行模式 默认为cron cron : 先运行一次 而后等待计划任务触发 nocron 或 once或 1: 忽略配置文件的cron定时配置配置 运行一次然后就直接退出结束，适合调试使用或者使用系统自带的计划任务或serverless/函数计算等方式触发。 cronAft : 先不运行等计划任务触发 clean : 清理模式 默认可选附加参数为 -tag cleanAll exportDomainSteamToTxt : 导出域名分流规则到txt文件模式 方便手动从爱快导入 默认可选附加参数为 -exportPath /tmp 暂时只支持域名分流功能导出， -tag : 备注信息 clean清理模式下的附加参数 默认为cleanAll(即清理所有备注中包含IKUAI_BYPASS字符的规则) 单独指定备注的关键词 可以不添写IKUAI_BYPASS_前缀 例如-r clean -tag ipcn 或 -r clean -tag IKUAI_BYPASS_ipcn -exportPath : 导出域名分流规则的路径 -login : ikuai登陆地址和账户密码，优先级比配置文件的优先级更高。格式: http://10.1.1.1,admin,password 为空则使用配置文件内登陆信息 -delOldRule : 删除旧规则顺序，默认为 after after : 先更新规则成功后再删除旧规则 before : 先删除旧规则再更新新规则，如果更新失败会丢失规则 其他补充 本文有一定滞后性，内容以 https://github.com/joyanhui/ikuai-bypass/ 的最新说明为准。\n自定义规则和ikuai-bypass的规则 ikuai-bypass 自动维护的规则 都会添加备注 IKUAI_BYPASS ，只要你添加的自定义的规则备注不包含这个字符即可。\n关于实例配置文件 实例配置文件使用了 https://mirror.ghproxy.com 作为github的代理方便可以在无科学环境更新规则，但是ghproxy有被gfw污染的先例，请自行更新更稳定的或者自建的github代理。\n配置文件中有一些额外的选项和注释，可以自行酌情删除。\n是否可以替代原版ikuai-bypass 原版是基于docker的，所以也可以直接替代，参考上面的docker配置\n","date":"2024-10-03T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui/","title":"爱快无感分流 自动更新规则 ikuai-bypass 修改版"},{"content":"autofs 是fstab的一个替代和补充。适合数据目录等自动挂载。建于nixos的可复现特性，在多设备的复用同一套nix配置情况下 非常适合使用autofs来挂载分区。\n下面是一个本地硬盘的挂载实例，建议尽可能使用by-label来挂载。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 {pkgs, ...}: { environment.systemPackages = [ pkgs.dosfstools pkgs.exfat pkgs.nfs-utils pkgs.btrfs-progs pkgs.btrfs-snap ]; # 自动挂载到 /autofs/子目录 services.autofs = { enable = true; autoMaster = let mapConf = pkgs.writeText \u0026#34;autofs.mnt\u0026#34; \u0026#39;\u0026#39; 128g -fstype=exfat :/dev/disk/by-label/128G ntfs -fstype=ntfs :/dev/disk/by-label/NTFS \u0026#39;\u0026#39;; in \u0026#39;\u0026#39; /autofs ${mapConf} --timeout 20 \u0026#39;\u0026#39;; }; } 本文停止更新\n其他挂载问题 建议参考： https://dev.leiyanhui.com/nixos/disk-mount\n","date":"2024-08-06T21:24:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/autofs/","title":"nixos使用autofs自动按需挂载分区"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 { config, lib, pkgs, ... }: { # \u0026lt;https://github.com/kholia/OSX-KVM\u0026gt; # Required by AMD boxes for OSX-KVM boot.extraModprobeConfig = \u0026#39;\u0026#39; options kvm_amd nested=1 options bt_coex_active=0 swcrypto=1 11n_disable=8 options kvm ignore_msrs=1 report_ignored_msrs=0 \u0026#39;\u0026#39;; # For Intel: /* options kvm_intel nested=1 options kvm_intel emulate_invalid_guest_state=0 options kvm ignore_msrs=1 */ virtualisation.libvirtd = { enable = true; qemu = { package = pkgs.qemu_kvm; runAsRoot = true; swtpm.enable = true; ovmf = { enable = true; #packages = [(pkgs.unstable.OVMF.override { packages = [(pkgs.OVMF.override { secureBoot = true; tpmSupport = true; }).fd]; }; }; }; environment.systemPackages = with pkgs; [ virt-manager ]; } 其他一些参考配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 boot.initrd.availableKernelModules = [ \u0026#34;ata_piix\u0026#34; \u0026#34;uhci_hcd\u0026#34; \u0026#34;ehci_pci\u0026#34; \u0026#34;ahci\u0026#34; \u0026#34;nvme\u0026#34; \u0026#34;sr_mod\u0026#34; ]; boot.kernelParams = [ \u0026#34;radeon.cik_support=0\u0026#34; \u0026#34;amdgpu.cik_support=1\u0026#34; \u0026#34;amd_iommu=on\u0026#34; ]; boot.initrd.kernelModules = [ \u0026#34;amdgpu\u0026#34; ]; boot.kernelModules = [ \u0026#34;iwlwifi\u0026#34; \u0026#34;iwlmvm \u0026#34; \u0026#34;kvm-amd\u0026#34; \u0026#34;vfio\u0026#34; \u0026#34;vfio_iommu_type1\u0026#34; \u0026#34;vfio_pci\u0026#34; \u0026#34;vfio_virqfd\u0026#34;]; boot.extraModprobeConfig = \u0026#39;\u0026#39; options bt_coex_active=0 swcrypto=1 11n_disable=8 \u0026#39;\u0026#39;; #boot.extraModulePackages = [config.boot.kernelPackages.rtw89]; boot.kernelPackages = pkgs.unstable.linuxPackages_latest; # Use latest kernel. boot.supportedFilesystems = [ \u0026#34;ext4\u0026#34; \u0026#34;btrfs\u0026#34; \u0026#34;xfs\u0026#34; #\u0026#34;zfs\u0026#34; \u0026#34;ntfs\u0026#34; \u0026#34;fat\u0026#34; \u0026#34;vfat\u0026#34; \u0026#34;exfat\u0026#34; ]; hardware.enableAllFirmware = true; boot.loader.systemd-boot.enable = true; # Enable systemd-boot. boot.loader.efi.canTouchEfiVariables = true; # Enable EFI variables. services.xserver.videoDrivers = [ \u0026#34;amdgpu\u0026#34; ]; #services.xserver.videoDrivers = [ \u0026#34;amdgpu\u0026#34; \u0026#34;nvidia\u0026#34;]; # ================= graphics # https://nixos.wiki/wiki/AMD_GPU nixpkgs.config.packageOverrides = pkgs: { # intel-vaapi-driver = pkgs.intel-vaapi-driver.override { enableHybridCodec = true; }; }; hardware.graphics = { enable = true; #driSupport = true; enable32Bit = true; extraPackages = with pkgs; [ rocmPackages.clr.icd ]; }; hardware.nvidia = { modesetting.enable = true; powerManagement.enable = false; powerManagement.finegrained = false; open = false; nvidiaSettings = true; package = config.boot.kernelPackages.nvidiaPackages.stable; }; environment.sessionVariables = { LIBVA_DRIVER_NAME = \u0026#34;iHD\u0026#34;; #NIXOS_OZONE_WL = \u0026#34;1\u0026#34;; chrome ele }; #services.thermald.enable = true; #防止intel cpu过热 # ================= auto-cpufreq power-profiles-daemon tlp 三选 services.power-profiles-daemon.enable = false; #gnome自帶的 關閉 # tlp services.tlp = { enable = true; settings = { CPU_SCALING_GOVERNOR_ON_AC = \u0026#34;performance\u0026#34;; CPU_SCALING_GOVERNOR_ON_BAT = \u0026#34;powersave\u0026#34;; CPU_ENERGY_PERF_POLICY_ON_BAT = \u0026#34;power\u0026#34;; CPU_ENERGY_PERF_POLICY_ON_AC = \u0026#34;performance\u0026#34;; CPU_MIN_PERF_ON_AC = 0; CPU_MAX_PERF_ON_AC = 100; CPU_MIN_PERF_ON_BAT = 0; CPU_MAX_PERF_ON_BAT = 20; #Optional helps save long term battery health START_CHARGE_THRESH_BAT0 = 40; # 40 and bellow it starts to charge STOP_CHARGE_THRESH_BAT0 = 80; # 80 and above it stops charging }; }; ","date":"2024-08-06T21:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/kvm-qemu/","title":"nixos下使用kvm和显卡直通等 简要配置"},{"content":"虽然nix可以在一定程度上替代docker,但是难免还有需要用docker的时候。\n1 2 3 4 5 6 { config, lib, pkgs, ... }: { # https://nixos.wiki/wiki/Docker #需要在用户配置的地方添加 users.users.\u0026lt;myuser\u0026gt;.extraGroups = [ \u0026#34;docker\u0026#34; ]; virtualisation.docker.enable = true; } ","date":"2024-08-06T18:10:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/docker/","title":"nixos下使用docker"},{"content":"nixos 不能直接运行appimage,需要封装以下 使用 appimageTools 来运行 以hiddify和balenaEtcher为例\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 { pkgs, ... }: # ./hiddify: error while loading shared libraries: libepoxy.so.0: cannot open shared object file: No such file or directory { config, pkgs,nur, ... }: let hiddify_pkg = with pkgs; appimageTools.wrapType2 ({ # or wrapType1 wrapType2 : file -k XXXXX.AppImage name = \u0026#34;hiddify\u0026#34;; src = fetchurl { sha256 = \u0026#34;sha256-T4BWxhJ7q13KE1rvvFsnXhs2XVEmNkFTJbJ4e8PCg+0=\u0026#34;; url = \u0026#34;https://mirror.ghproxy.com/https://github.com/hiddify/hiddify-next/releases/download/v1.1.1/Hiddify-Linux-x64.AppImage\u0026#34;; }; extraPkgs = pkgs: with pkgs; [ libepoxy ]; }); icons=../../staticFile/icons/hiddify.png; in { home.packages = with pkgs; [ hiddify_pkg ]; home.file = { \u0026#34;.local/share/applications/Hiddify-next.desktop\u0026#34;.text = \u0026#39;\u0026#39; [Desktop Entry] Version=1.1.1 Type=Application Name=Hiddify Exec=hiddify Icon=${icons} StartupWMClass=hiddify StartupNotify=true \u0026#39;\u0026#39;; }; } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # https://discourse.nixos.org/t/how-ro-run-a-appimage-with-electron/41756?u=joyanhui { config, pkgs, nur, ... }: let balenaEtcher_pkg = with pkgs; appimageTools.wrapType2 ({ name = \u0026#34;balenaEtcher\u0026#34;; src = fetchurl { sha256 = \u0026#34;sha256-+Hu70UOcmLX4dPOYEBA2adBdX/C8Ryp/17bvi+jUfVA=\u0026#34;; url = \u0026#34;https://mirror.ghproxy.com/https://github.com/balena-io/etcher/releases/download/v1.18.11/balenaEtcher-1.18.11-x64.AppImage\u0026#34;; }; extraPkgs = pkgs: with pkgs; [ ]; }); icons = ../../staticFile/icons/balenaEtcher.png; in { home.packages = with pkgs; [ balenaEtcher_pkg ]; # --in-process-gpu to fix it. --no-sandbox disable every sandbox security # https://www.reddit.com/r/archlinux/comments/xf5pkt/comment/j3wf4gq/ home.file = { \u0026#34;.local/share/applications/balenaEtcher.desktop\u0026#34;.text = \u0026#39;\u0026#39; [Desktop Entry] Version=1.18.11 Type=Application Name=balenaEtcher Exec=balenaEtcher --in-process-gpu Icon=${icons} StartupWMClass=AppRun \u0026#39;\u0026#39;; }; } ","date":"2024-08-05T03:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/appimage/","title":"nixos下使用appimage软件包"},{"content":"vmware安装macos虽然不能完全加速显示，但是比其他未直通显卡的虚拟机速度要明显好一些。\n在重构的时候注意错误，貌似是vmware官方服务器的问题，对梯子要求较高。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { pkgs, ... }: { boot.blacklistedKernelModules = [ \u0026#34;kvm\u0026#34; \u0026#34;kvm_amd\u0026#34; \u0026#34;kvm_intel\u0026#34; ]; virtualisation.vmware.host = { enable = true; package = pkgs.vmware-workstation.override { enableMacOSGuests = true; }; extraPackages = with pkgs; [ ntfs3g exfat ]; }; } ","date":"2024-08-05T02:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/vmware-macos/","title":"nixos下使用vmware并解锁macos"},{"content":"环境 gnome+wayland\n因为未知的问题，没时间排查，所以我的fctix5没使用homemanager管理。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 { config, lib, pkgs, ... }: let fcitx5-pinyin-moegirl = pkgs.callPackage ../../pkgs/fcitx5-pinyin-moegirl { }; fcitx5-pinyin-zhwiki = pkgs.callPackage ../../pkgs/fcitx5-pinyin-zhwiki { }; in { i18n = { defaultLocale = \u0026#34;en_US.UTF-8\u0026#34;; supportedLocales = [ \u0026#34;en_US.UTF-8/UTF-8\u0026#34; \u0026#34;zh_CN.UTF-8/UTF-8\u0026#34; ]; inputMethod = { #enabled = \u0026#34;fcitx5\u0026#34;; type = \u0026#34;fcitx5\u0026#34;; enable = true; fcitx5 = { # waylandFrontend = true; # # plasma6Support = true; #不用kde6 貌似不用启用 addons = with pkgs; [ fcitx5-chinese-addons fcitx5-mozc fcitx5-gtk # Fcitx5 gtk im module and glib based dbus client library fcitx5-material-color fcitx5-pinyin-moegirl fcitx5-pinyin-zhwiki ]; #ignoreUserConfig = true; #启用不光个人设置无效，个人词库也会无法保存 settings = { addons = { classicui.globalSection.Theme = \u0026#34;Material-Color-deepPurple\u0026#34;; classicui.globalSection.DarkTheme = \u0026#34;Material-Color-deepPurple\u0026#34;; pinyin.globalSection = { PageSize = 9; CloudPinyinEnabled = \u0026#34;True\u0026#34;; CloudPinyinIndex = 2; }; cloudpinyin.globalSection = { Backend = \u0026#34;Baidu\u0026#34;; }; }; #globalOptions = { \u0026#34;Hotkey/TriggerKeys\u0026#34; = { \u0026#34;0\u0026#34; = \u0026#34;Alt+space\u0026#34;; }; }; inputMethod = { \u0026#34;Groups/0\u0026#34; = { Name = \u0026#34;Default\u0026#34;; \u0026#34;Default Layout\u0026#34; = \u0026#34;us\u0026#34;; DefaultIM = \u0026#34;keyboard-us\u0026#34;; }; \u0026#34;Groups/0/Items/0\u0026#34;.Name = \u0026#34;keyboard-us\u0026#34;; \u0026#34;Groups/0/Items/1\u0026#34;.Name = \u0026#34;pinyin\u0026#34;; GroupOrder.\u0026#34;0\u0026#34; = \u0026#34;Default\u0026#34;; }; }; }; }; }; } ../../pkgs/fcitx5-pinyin-moegirl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { lib , stdenvNoCC , fetchurl }: stdenvNoCC.mkDerivation { pname = \u0026#34;fcitx5-pinyin-moegirl\u0026#34;; version = \u0026#34;20240309\u0026#34;; src = fetchurl { url = \u0026#34;https://github.com/outloudvi/mw2fcitx/releases/download/20240309/moegirl.dict\u0026#34;; hash = \u0026#34;sha256-ir9WQA2cz8VLL46/GaLTFAnL/H5vKWq3sbywHTcAKb8=\u0026#34;; }; dontUnpack = true; installPhase = \u0026#39;\u0026#39; install -Dm644 $src $out/share/fcitx5/pinyin/dictionaries/fcitx5-pinyin-moegirl.dict \u0026#39;\u0026#39;; meta = with lib; { description = \u0026#34; Fcitx 5 pinyin dictionary generator for MediaWiki instances. Releases for dict of zh.moegirl.org.cn. (auto update)\u0026#34;; homepage = \u0026#34;https://github.com/outloudvi/mw2fcitx\u0026#34;; license = licenses.unlicense; }; } ../../pkgs/fcitx5-pinyin-zhwiki\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { lib , stdenvNoCC , fetchurl }: stdenvNoCC.mkDerivation { pname = \u0026#34;fcitx5-pinyin-zhwiki\u0026#34;; version = \u0026#34;20231205\u0026#34;; src = fetchurl { url = \u0026#34;https://github.com/felixonmars/fcitx5-pinyin-zhwiki/releases/download/0.2.4/zhwiki-20231205.dict\u0026#34;; hash = \u0026#34;sha256-crMmSqQ7QgmjgEG8QpvBgQYfvttCUsKYo8gHZGXIZmc=\u0026#34;; }; dontUnpack = true; installPhase = \u0026#39;\u0026#39; install -Dm644 $src $out/share/fcitx5/pinyin/dictionaries/fcitx5-pinyin-zhwiki.dict \u0026#39;\u0026#39;; meta = with lib; { description = \u0026#34;Fcitx 5 Pinyin Dictionary from zh.wikipedia.org (auto update)\u0026#34;; homepage = \u0026#34;https://github.com/felixonmars/fcitx5-pinyin-zhwiki\u0026#34;; license = licenses.unlicense; }; } ","date":"2024-08-05T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/fcitx5/","title":"nixos下fcitx5输入法配置 和常用字库"},{"content":"nixos 下开发环境可以独立配置，较为简单的开发环境类似 golang nodejs等较为简单。而flutter将对来说较为复杂。 先看nixos 下开发环境可以独立配置。 在现有的flutter项目目录下，或者打算储存flutter项目的目录里面创建一个flake.nix 文件内容如下。\nflake.nix nix develop --impure --show-trace 命令进入flutter环境\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 # 注意dl.google.com 有可能会被域名分流掉代理，实际只要解析没问题国内可以直连 # idea 打开项目后提示没有dart sdk 不用管，直接配置flutter的sdk 这里是 /nix/store/wkaqj97xj7glb0a0za3iplwcj95jm6mj-flutter-wrapped-3.19.0-sdk-links # flutter pub get { description = \u0026#34;Flutter 3.19.x\u0026#34;; inputs = { # nixpkgs.url = \u0026#34;github:NixOS/nixpkgs/23.11\u0026#34;; # https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable/nixexprs.tar.xz?narHash=sha256-LuNFBL0P7GGtv6dNmLbD5MeyGlor0uV2482QhZRwbI8%3D\u0026#39; (2024-04-04) nixpkgs.url = \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable/nixexprs.tar.xz\u0026#34;; flake-utils.url = \u0026#34;github:numtide/flake-utils\u0026#34;; }; # build-tools-30-0-3 platforms-android-33 outputs = { self, nixpkgs, flake-utils }: flake-utils.lib.eachDefaultSystem (system: let pkgs = import nixpkgs { inherit system; config = { android_sdk.accept_license = true; #貌似无效但是不影响使用 allowUnfree = true; }; }; # platforms;android-33 Android SDK Platform 33 buildToolsVersion = \u0026#34;34.0.0\u0026#34;; androidComposition = pkgs.androidenv.composeAndroidPackages { buildToolsVersions = [ buildToolsVersion \u0026#34;30.0.3\u0026#34; ]; platformVersions = [ \u0026#34;34\u0026#34; \u0026#34;33\u0026#34; \u0026#34;29\u0026#34; \u0026#34;28\u0026#34; ]; #具体需要用那个版本 还是要看代码里面 以及真机/模拟器的版本 abiVersions = [ \u0026#34;armeabi-v7a\u0026#34; \u0026#34;arm64-v8a\u0026#34; ]; }; androidSdk = androidComposition.androidsdk; in { devShell = with pkgs; mkShell rec { #真机调试需要配GRADLE_OPTS GRADLE_OPTS = \u0026#34;-Dorg.gradle.project.android.aapt2FromMavenOverride=${androidSdk}/libexec/android-sdk/build-tools/34.0.0/aapt2\u0026#34;; # 30.0.3 34.0.0 ANDROID_SDK_ROOT = \u0026#34;${androidSdk}/libexec/android-sdk\u0026#34;; #ANDROID_HOME = \u0026#34;${androidSdk}/libexec/android-sdk\u0026#34;; JAVA_HOME = \u0026#34;${pkgs.jdk17.home}\u0026#34;; CHROME_EXECUTABLE = \u0026#34;${pkgs.chromium}/bin/chromium\u0026#34;; buildInputs = [ flutter319 # flutter316 flutter313 flutter=3.19 androidSdk # The customized SDK that we\u0026#39;ve made above gradle #Gradle=8.6 gradle_7 gradle_6 jdk17 # 最好指定版本，不然可能需要处理gradle和jdk版本的兼容 jdk=\u0026#34;21\u0026#34; #ninja cmake glibc # linux下调试桌面应用用 需要自行装到 home.packages 装这里可能有问题，c和rust也需要所以不写这里 fish chromium #jetbrains.idea-ultimate ]; shellHook = \u0026#39;\u0026#39; echo \u0026#34; 你可能需要运行下面的命令 \u0026#34; echo \u0026#34; rm -rf ~/.pub-cache \u0026#34; echo \u0026#34; rm -rf ~/.gradle \u0026#34; echo \u0026#34; rm -rf ~/.dart \u0026#34; echo \u0026#34; rm -rf ~/.dartServer \u0026#34; echo \u0026#34; flutter pub get \u0026#34; exec fish \u0026#39;\u0026#39;; }; }); } 使用注意 这里没有用nix管理idea的插件，需要手动在idea安装 flutter和 android插件。\ndar sdk idea打开对应的项目的时候 会提示配置dart sdk 这是因为他没有识别的到这是flutter项目。不用例会，直接去配置flutter 的sdk即可。如果有多个版本和环境，可以cd到对应环境的/nix/store/xxx 检查版本，注意选择。\n真机/模拟器调试 无法adb 当前用户组需要在 adbusers 组里，需要在configuration.nix 里配置\n1 2 3 4 5 6 7 programs.adb.enable = true; users.users.你的用户名 = { # ...其他配置项 extraGroups = [ # ... 其他用户组 \u0026#34;adbusers\u0026#34; ] 其他错误 1、网络问题，注意科学上网环境和分流规则。需要东github和google下载一些文件。\n2、版本匹配文件，检查项目里面的安卓配置相关的情况\n","date":"2024-04-15T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/flutter/","title":"nixos下flutter开发环境"},{"content":"nixos 下开发环境可以独立配置，golang的环境相对来说比较简单。 在现有的go项目目录下，或者打算储存go项目的目录里面创建一个flake.nix 文件内容如下。\nrust和flutter nodejs等开发环境 本站也有，请自行检索\n本文已经更新 详情看文末\nnix develop 环境 （推荐） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 { description = \u0026#34;golang \u0026#34;; inputs = { #nixpkgs.url = \u0026#34;github:NixOS/nixpkgs/23.11\u0026#34;; nixpkgs.url = \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable/nixexprs.tar.xz\u0026#34;; flake-utils.url = \u0026#34;github:numtide/flake-utils\u0026#34;; }; outputs = { self, nixpkgs, flake-utils }: flake-utils.lib.eachDefaultSystem (system: { devShell = with pkgs; mkShell rec { GOPROXY = \u0026#34;https://goproxy.cn,direct\u0026#34;; buildInputs = [ go_1_22 gopls gcc upx jetbrains.goland fish #ninja cmake glibc # 如果需要用最好自行装到 home.packages 装这里可能有问题 ]; }; }); } homemanager 环境（不建议） 1 2 3 4 5 6 7 8 9 { config, lib, pkgs, ... }: { home.packages = with pkgs;[ go_1_22 gopls gcc upx ]; } nix run方式（2024-11-4更新） 1 nix run .#dev --show-trace 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 { { description = \u0026#34;A Nix-flake-based golang development environment\u0026#34;; inputs = { #nixpkgs.url = \u0026#34;github:NixOS/nixpkgs/23.11\u0026#34;; #nixpkgs.url = \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable/nixexprs.tar.xz\u0026#34;; nixpkgs.url = \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/nixos-24.05/nixexprs.tar.xz\u0026#34;; }; outputs = { self , nixpkgs ,... }: let # system should match the system you are running on system = \u0026#34;x86_64-linux\u0026#34;; # system = \u0026#34;x86_64-darwin\u0026#34;; in { packages.\u0026#34;${system}\u0026#34;.dev = let pkgs = import nixpkgs { inherit system; config.allowUnfree = true; }; packages = with pkgs; [ go_1_23 gopls gcc upx jetbrains.goland # allowUnfree nushell ]; in pkgs.runCommand \u0026#34;dev-shell\u0026#34; { # Dependencies that should exist in the runtime environment buildInputs = packages; # Dependencies that should only exist in the build environment nativeBuildInputs = [ pkgs.makeWrapper ]; } \u0026#39;\u0026#39; mkdir -p $out/bin/ ln -s ${pkgs.nushell}/bin/nu $out/bin/dev-shell wrapProgram $out/bin/dev-shell --set GOPROXY https://goproxy.cn,direct wrapProgram $out/bin/dev-shell --prefix PATH : ${pkgs.lib.makeBinPath packages} \u0026#39;\u0026#39;; }; } ","date":"2024-04-01T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/golang/","title":"nixos下golang+goland开发环境"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 { pkgs, ... }: { programs.zsh = { enable = true; history = { size = 10000; path = \u0026#34;$HOME/.zsh_history\u0026#34;; }; enableCompletion = true; autosuggestion.enable = true; syntaxHighlighting.enable = true; shellAliases = { ping = \u0026#34;ping -O\u0026#34;; killall = \u0026#34;killall -v\u0026#34;; umount = \u0026#34;umount -v\u0026#34;; lsblk = \u0026#34;lsblk -a --output \u0026#39;NAME,LABEL,FSTYPE,SIZE,FSUSE%,RO,TYPE,MOUNTPOINTS\u0026#39;\u0026#34;; chmod = \u0026#34;chmod -v\u0026#34;; chown = \u0026#34;chown -v\u0026#34;; chattr = \u0026#34;chattr -v\u0026#34;; ln = \u0026#34;ln -v\u0026#34;; cp = \u0026#34;cp -v\u0026#34;; mv = \u0026#34;mv -v\u0026#34;; rm = \u0026#34;rm -v\u0026#34;; mkdir = \u0026#34;mkdir -pv\u0026#34;; rmdir = \u0026#34;rmdir -v\u0026#34;; myupdateVM1 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#vm-nixos\u0026#39; --option substituters https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34;; myupdateVM2 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#vm-nixos\u0026#39; --option substituters https://mirrors.cernet.edu.cn/nix-channels/store\u0026#34;; myupdateB150m1 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#b150m\u0026#39; --option substituters https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34;; myupdateB150m2 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#b150m\u0026#39; --option substituters https://mirrors.cernet.edu.cn/nix-channels/store\u0026#34;; myupdateThinkBook1 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#thinkbook\u0026#39; --option substituters https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34;; myupdateThinkBook2 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#thinkbook\u0026#39; --option substituters https://mirrors.cernet.edu.cn/nix-channels/store\u0026#34;; myupdateX240-1 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#x240\u0026#39; --option substituters https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34;; myupdateX240-2 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#x240\u0026#39; --option substituters https://mirrors.cernet.edu.cn/nix-channels/store\u0026#34;; myupdateBaseDesktop1 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#baseDesktop\u0026#39; --option substituters https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34;; myupdateBaseDesktop2 = \u0026#34;sudo nixos-rebuild switch --show-trace --flake \u0026#39;/home/yh/workspace/nixos-config#baseDesktop\u0026#39; --option substituters https://mirrors.cernet.edu.cn/nix-channels/store\u0026#34;; proxySet = \u0026#34;export http_proxy=http://127.0.0.1:2334\u0026amp;\u0026amp;export https_proxy=http://127.0.0.1:2334\u0026#34;; proxyUnSet = \u0026#34;unset http_proxy\u0026amp;\u0026amp;unset https_proxy\u0026#34;; scpToX240 = \u0026#34;scp -r /home/yh/workspace/nixos-config/* yh@x240:/home/yh/workspace/nixos-config/\u0026#34;; #nix-store --optimise myclean1 = \u0026#34;sudo nix-env --profile /nix/var/nix/profiles/system --list-generations \\ sudo nix-env --profile /nix/var/nix/profiles/system --delete-generations +1 \\ sudo nix-env --profile /nix/var/nix/profiles/per-user/root/channels --delete-generations +1 \\ sudo nix-env --profile /nix/var/nix/profiles/per-user/yh/channels --delete-generations +1 \\ sudo nix-env --profile /nix/var/nix/profiles/per-user/yh/profile --delete-generations +1 \\ sudo nix-env --profile /nix/var/nix/profiles/per-user/yh/home-manager --delete-generations +1 \\ nix-collect-garbage echo \u0026#39;is need to run: nix-collect-garbage -d or nix-store --gc --print-roots or nix-store --optimise\u0026#39; \u0026#34;; # # for waybar restart waybarRestart = \u0026#34;pkill waybar \u0026amp; sleep 0.5 \u0026amp;\u0026amp; waybar\u0026#34;; }; initExtra = \u0026#39;\u0026#39; #ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=\u0026#34;fg=#ff00ff,bg=cyan,bold,underline\u0026#34; ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=\u0026#39;fg=8\u0026#39; ZSH_AUTOSUGGEST_STRATEGY=(history completion) ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=20 setopt extendedglob setopt globstarshort setopt autopushd # make cd keep a dir stack # 启用大小写自动修正 setopt correct compinit # 设置补全系统对大小写不敏感 zstyle \u0026#39;:completion:*\u0026#39; matcher-list \u0026#39;m:{a-zA-Z}={A-Za-z}\u0026#39; # 彩色 ls if [ -x /usr/bin/dircolors ]; then test -r ~/.dircolors \u0026amp;\u0026amp; eval \u0026#34;$(dircolors -b ~/.dircolors)\u0026#34; || eval \u0026#34;$(dircolors -b)\u0026#34; alias ls=\u0026#39;ls --color=auto\u0026#39; fi # 允许 ctrl 左右按照单词移动光标 bindkey \u0026#39;^[[1;5C\u0026#39; forward-word # Ctrl+ right bindkey \u0026#39;^[[1;5D\u0026#39; backward-word # Ctrl+left # ctrl a e 跳转 bindkey \u0026#34;^A\u0026#34; beginning-of-line bindkey \u0026#34;^E\u0026#34; end-of-line # 提示符格式 export PROMPT=\u0026#34;%F{green}%n@%F{90}%m\u0026gt; %F{96}%B%F{green}%~ %(?.%F{green}\u0026gt;.%F{red} ?%? \u0026gt;)%f%F{46}%f%b \u0026#34; # 一些需要单独配置等 # for golang # export GOPROXY=https://goproxy.cn,direct # for flutter and edge export PUB_HOSTED_URL=\u0026#34;https://pub.flutter-io.cn\u0026#34; export FLUTTER_STORAGE_BASE_URL=\u0026#34;https://storage.flutter-io.cn\u0026#34; # for rust export RUSTUP_DIST_SERVER=\u0026#34;https://rsproxy.cn\u0026#34; export RUSTUP_UPDATE_ROOT=\u0026#34;https://rsproxy.cn/rustup\u0026#34; \u0026#39;\u0026#39;; envExtra = \u0026#39;\u0026#39; # set colors for exa, see https://github.com/ogham/exa/blob/master/man/exa_colors.5.md export EXA_COLORS=\u0026#34;di=33;1:su=1;4:sf=1:4\u0026#34; \u0026#39;\u0026#39;; #oh-my-zsh = { # enable = true; # plugins = [ \u0026#34;git\u0026#34; \u0026#34;autosuggestions\u0026#34; \u0026#34;syntax-highlighting\u0026#34; ]; # theme = \u0026#34;dst\u0026#34;; #}; }; } ","date":"2024-04-01T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/zsh/","title":"nixos下zsh手工配置"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 { pkgs, ... }: { programs.firefox = { enable = true; policies = { DisablePocket = true; DisplayBookmarksToolbar = true; DontCheckDefaultBrowser = true; OfferToSaveLogins = false; NoDefaultBookmarks = true; PasswordManagerEnable = false; #DNSOverHTTPS = { # Enabled = true; #}; }; profiles.yh = { id = 0; isDefault = true; name = \u0026#34;yh\u0026#34;; settings = { \u0026#34;browser.search.separatePrivateDefault\u0026#34; = false; \u0026#34;browser.search.separatePrivateDefault.ui.enabled\u0026#34; = true; #\u0026#34;browser.startup.homepage\u0026#34; = \u0026#34;http://dashboard.internal.flake.sh/\u0026#34;; \u0026#34;network.trr.mode\u0026#34; = 5; \u0026#34;dom.security.https_first\u0026#34; = true; #\u0026#34;dom.security.https_only_mode\u0026#34; = true; #\u0026#34;dom.security.https_only_mode_ever_enabled\u0026#34; = true; }; #extraConfig = builtins.readFile ./user.js/betterfox.js; search = { default = \u0026#34;cnbing\u0026#34;; force = true; engines = { \u0026#34;cnbing\u0026#34; = { urls = [ { template = \u0026#34;https://cn.bing.com\u0026#34;; params = [ { name = \u0026#34;q\u0026#34;; value = \u0026#34;{searchTerms}\u0026#34;; } ]; } ]; definedAliases = [ \u0026#34;@g\u0026#34; ]; }; \u0026#34;SearXNG\u0026#34; = { urls = [ { template = \u0026#34;http://100.108.113.89:8100\u0026#34;; params = [ { name = \u0026#34;q\u0026#34;; value = \u0026#34;{searchTerms}\u0026#34;; } ]; } ]; definedAliases = [ \u0026#34;@sx\u0026#34; ]; }; \u0026#34;Nix Packages\u0026#34; = { urls = [ { template = \u0026#34;https://search.nixos.org/packages\u0026#34;; params = [ { name = \u0026#34;type\u0026#34;; value = \u0026#34;packages\u0026#34;; } { name = \u0026#34;query\u0026#34;; value = \u0026#34;{searchTerms}\u0026#34;; } ]; } ]; icon = \u0026#34;\u0026#39;\u0026#39;${pkgs.nixos-icons}/share/icons/hicolor/scalable/apps/nix-snowflake.svg\u0026#34;; definedAliases = [ \u0026#34;@np\u0026#34; ]; }; \u0026#34;Bing\u0026#34;.metaData.hidden = true; \u0026#34;Google\u0026#34;.metaData.hidden = true; \u0026#34;Amazon.com\u0026#34;.metaData.hidden = true; \u0026#34;eBay\u0026#34;.metaData.hidden = true; \u0026#34;DuckDuckGo\u0026#34;.metaData.hidden = false; }; }; extensions = with pkgs.nur.repos.rycee.firefox-addons; [ # https://nur.nix-community.org/repos/rycee/ # security bitwarden #ublock-origin #canvasblocker floccus gesturefy #leisure #darkreader #mal-sync #stylus firefox-color #utility #new-tab-override #libredirect #sponsorblock #return-youtube-dislikes #misc ]; }; }; /* xdg.mimeApps = { enable = true; defaultApplications = { \u0026#34;x-scheme-handler/discord-409416265891971072\u0026#34; = [\u0026#34;discord-409416265891971072.desktop\u0026#34;]; \u0026#34;x-scheme-handler/discord-402572971681644545\u0026#34; = [\u0026#34;discord-402572971681644545.desktop\u0026#34;]; \u0026#34;x-scheme-handler/discord-696343075731144724\u0026#34; = [\u0026#34;discord-696343075731144724.desktop\u0026#34;]; \u0026#34;x-scheme-handler/http\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;x-scheme-handler/https\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;x-scheme-handler/chrome\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;text/html\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;application/x-extension-htm\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;application/x-extension-html\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;application/x-extension-shtml\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;application/xhtml+xml\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;application/x-extension-xhtml\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; \u0026#34;application/x-extension-xht\u0026#34; = [\u0026#34;firefox.desktop\u0026#34;]; }; }; */ } ","date":"2024-04-01T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/firefox/","title":"nixos下可复现的火狐浏览器配置实例"},{"content":"梦中情os nixos的几个特色 滚不死的系统 弄不坏，非常强壮稳定。且回滚和更新都更加方便。 应用可以多版本共存 一个套配置文件从多机上包括别的发行版随时复现 Nix包数量非常多，并不仅限官方的8万包 并不比arch的aur，各有千秋 nix包管理同时支持macos wsl和 非nixos的linux发行版本 开发环境可以多版本 多平台 多项目 相互独立和隔离 flake.nix 可以提供高度一致的环境/系统 复现能力 nix home manager 可以集中化管理多数软件（几乎是全部）的配置文件/配置项,并提供非常高的可复现能力 nix-shell 可以沙箱临时测试一个软件，随后自动或手动gc掉 远程部署工具 deploy-rs NixOps 等 轻松在别的发行版上原地偷家切换到nixos 别的发行版可以引入nix包管理，复用nixos的配置文件 支持的cpu架构很多，包括 arm aarch risc mips 等 纯净，你可以把/挂载到内存 只持久化 /nix /home /var 等个别目录 nixos是不可变系统，优点不用展开说了。目前来看，这很大可能是操作系统以后的趋势 由此 可以延申很多场景 比如 我想体验一下刚刚发布的 kde plasma 6 ，发现目前版本插件兼容很差 并不值得我升级，所以体验了一会儿后 马上回到 我干干净净的 kde plasma 5。\n比如 我想 neofetch 截个图装个x， 但是我平时根本不需要它 nix-shell -p neofetch 截图完毕 关掉窗口 neofetch 就无了。同样我想临时装一个浏览器测试一下web网页兼容性，或者测试一个网站无cookies新浏览器指纹的效果 我平时使用edge，那么我现在只需要安装一个firefox就好了。\n比如 我平时使用zsh的自定义配置，那么我可以写到nix中，那么在任意一台机器上 安装后 zsh就按照我习惯部署好了。\n比如 我有多台云主机，我可以在我本机编译配置好环境，然后云主机全部从初始系统切换到nixos，而且我本地直接推送到云主机二进制上去。这和k8s docker 并不冲突，只是多了个运维选择。\n为什么不选择nixos nixos也有很多缺点\n入门较难： linux新手基本搞不定，小白想都别想。 nix语言虽然简单，但是nixos的文档和wiki较为分散且混乱，chatgpt给你的答案大概率都是错的。你可能非常需要社区和电报群的帮助！ nixos 有 传统configuration.nix flakes.nix home-manage.nix 还有类似apt yum包管理 以及临时使用一个软件的方式，还有 nix develop/profile切换/devShell/mkShell等等功能，非常容易迷糊。 因为nixos的配置/包管理/环境管理 方式太多，导致你直接复制别人的nix代码大概率是无法直接使用的，你需要学nix语法。 虽然nixos包数量不少，但是覆盖面不高，很多软件都不提供nixos下的托管安装，一些小众软件 需要自己写nix构建。部分软件需要较为复杂的配置，比如绕过发行版检测，有版权问题的，强依赖fhs文件系统的 某些软件的打包会比较复杂，比如todesk,他的控制端也需要启动一个systemd。某些小地方处理起来比较麻烦，比如nautilus默认右键打开shell 是gnome-terminal，如果我们要替换为其他终端，常规操作系统下直接替换掉/usr/bin/下的文件即可，但是nixos不可以这样操作。 对外网的依赖度比较高，国内网络环境大家都懂的，如果你没有梯子即便是勉强安装上一个基础系统，后面使用nixos会非常不爽。另外国内的镜像源 目前(20240312)清华的是崩的状态 ustc目前包不全，好像也经常限速。 sjtu目前是限速并经常断掉的状态,还有一些包是写死的被墙掉的url,这些地址在国内往往无法访问或者速度非常慢。 硬盘占用，nixos会比常规发行版需要的空间更多一些，基本的nixos系统包含gnome和日用的基础软件，基本上需要8-15G左右的磁盘空间（btrfs 压缩等级5）。 不过一般/ 或者/nix 预留30-60G 也足够了。 对nixos的误区 nixos可以运行古董软件，是可以，但是新手别想，如果没有别人写好的nix配置，你需要手撸nix。 nixos不支持依赖fhs文件结构的软件，并不是。nixos可以虚拟一个fhs环境给这些软件用，注意不是容器。除非某些软件恶意不兼容这种方式，否则都是可以正常运行的。 nixos可以100%复现，错误。nixos只是相对来说更容易100%复现，实际上需要一些额外的手段才能保证100%。 nixos很难，也没那么难。它的安装和基本使用还是很简单的。难的是彻底弄明白。 docker可以搞定的为什么要nix，虽然他们有一些地方很接近，但是完全不是一回事，各有所长。比如nix和docker都可以复现运行环境，但是nix并不是完全隔离的，可以访问到外部资源，另外运行ui软件包括访问硬件资源（包括显卡加速）也更方便。nix也可以管理docker可以替代dockerfile,但是docker擅长的领域就不是nix的能搞定的。 为什么说nixos是梦中情os 这句话仅仅针对对linux有一些基础，并且有时间精力和兴趣去学习一个除了nix/nixos 没啥别的卵用的nix语言，并愿意折腾nixos的人。\n那么nixos的缺点，你都可以假装不存在。只看它的优点的话，真香！\n日志记录 基本安装 使用 configuration.nix 安装一个带ssh和常用工具的 nixos [基本安装 configuration](https://dev.leiyanhui.com/nixos/1base-install]\n启用 flake 基本安装 configuration flake\n启用 Home Manager 基本安装 configuration flake\n目录结构 和最终配置文件 基础 目录结构 和最终配置文件\nkde桌面 kde桌面简单体验\ngnome桌面 gnome桌面简单体验\n清理磁盘 清理磁盘\n关于nix unstable 启用了flake和 Home Manager的情况下切换到unstable\n清理磁盘命令 清理磁盘命令\nflutter开发环境 flutter+idea开发环境\ngolang开发环境 golang+goland开发环境\n","date":"2024-04-01T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/start/","title":"nixos 从0实现全集  梦中情os"},{"content":"旁路由/网关在维护的时候导致断网或其他一些地方肯定不是够稳定，所以需要一个更加智能无感的自动切换方案。 传统dhcp切换网关的方式相应速度慢，掉线时间长。爱快分流方案虽然可以无感切换但是需要一个x86设备运行不开源有过黑历史的爱快。\n于是想到想到了一个新的方案，我姑且称之为 主路由自动切换ip接位网关方案\n旧的旁路由自动方案 目前主要有两种\n传统的旁网关形式，内外设备单独配置一个网关设备。在这个网关设备失效的后，通过自动脚本配合dhcp等方式实现切换，需要下游设备断开重连，或重启主路由切换时间较长。这是效果最差的一种启动切换方案。 主路由用爱快根据ip和域名通过运营商配置绑定wan2的分流方案，也就是 ikuai-bypass，使用体验上要比上一种方式好非常多，不存在短时断网，堪称完美，但是需要x86做主路由并刷闭源的爱快。切换时间最少1分钟，但是切换期间不会导致断网。如果您用 ikuai-bypass 方案，也期待能给我点一个star。 思路 新方案使用主路由和旁路由 ip轮替的方式，原理： 旁路由用桥接/别名或虚拟网卡的方式配置两个ip 第一个ip我们暂且称之为工作ip，第二个ip姑且叫辅助ip。\n主路由不断ping旁路由的第二个ip，如果ping不通，那么主路由把自己的ip修改为旁路有工作ip接替旁路由的工作。旁路路由正常再把自己改回去。这样就实现免重连切换。\n新方案优点 原理简单维护也简单。切换速度快（3-10秒以内），不需要内网设备断网后重联，主路由不需要是x86设备，不需要闭源的爱快。\n各方面体验远高于dhcp切换方案，缺点是不如ikuai-bypass的完全无缝切换，切换期间会有3-10秒断网。\n切换和配置 我们为了便于理解和管理方式，干脆给两个设备规划4个ip，分别为：\n主路由 默认IP(10.1.1.1) 主路由辅助ip(10.1.1.11，用来登录主路由的web管理界面)\n旁路由 工作IP(10.1.1.2) 旁路路由辅助ip(10.1.1.22，用来检测是否旁路由在线)\n主路由负责dhcp服务，旁路由关闭dhcp。dhcp指定下游设备的网关均为旁路由工作IP(10.1.1.2)。\n下文以openwrt为例（文末有Padavan/梅林的兼容实现），内核为5.15.148 版本git-25.050.75038-257d60d 使用 openwrt.ai 的在线编译固件 感谢 supes\n主路由为一个4口ramips硬路由 旁路有为vm内的x86路由 已经配置好低调上网插件以及dns分流 广告屏蔽等。\n双ip的实现 openwrt网络-接口面板，新建一个接口 和lan口一样 桥接 br-lan 然后静态ip配置为另外一个ip即可。参考/etc/config/network 中lan部分如下\n主路由 正常工作状态 （主路由是一个四口硬路由） 用桥接方式配置了两个ip\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 config device option name \u0026#39;br-lan\u0026#39; option type \u0026#39;bridge\u0026#39; list ports \u0026#39;lan1\u0026#39; list ports \u0026#39;lan2\u0026#39; list ports \u0026#39;lan3\u0026#39; list ports \u0026#39;lan4\u0026#39; option promisc \u0026#39;1\u0026#39; config interface \u0026#39;lan\u0026#39; option device \u0026#39;br-lan\u0026#39; option proto \u0026#39;static\u0026#39; option ipaddr \u0026#39;10.1.1.1\u0026#39; option netmask \u0026#39;255.255.255.0\u0026#39; option ip6assign \u0026#39;60\u0026#39; option dns \u0026#39;223.5.5.5 114.114.114.114\u0026#39; config interface \u0026#39;lanManager\u0026#39; option proto \u0026#39;static\u0026#39; option device \u0026#39;br-lan\u0026#39; option ipaddr \u0026#39;10.1.1.11\u0026#39; option netmask \u0026#39;255.255.255.0\u0026#39; 旁路由正常工作状态 旁路由是一个单口虚拟机的openwrt 用桥接方式配置了两个ip\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 config device option name \u0026#39;br-lan\u0026#39; option type \u0026#39;bridge\u0026#39; list ports \u0026#39;eth0\u0026#39; option promisc \u0026#39;1\u0026#39; config interface \u0026#39;lan\u0026#39; option device \u0026#39;br-lan\u0026#39; option proto \u0026#39;static\u0026#39; option ipaddr \u0026#39;10.1.1.2\u0026#39; option ipaddr \u0026#39;10.1.1.1\u0026#39; option netmask \u0026#39;255.255.255.0\u0026#39; option ip6assign \u0026#39;60\u0026#39; list dns \u0026#39;223.5.5.5\u0026#39; config interface \u0026#39;lanCheck\u0026#39; option proto \u0026#39;static\u0026#39; option device \u0026#39;br-lan\u0026#39; option ipaddr \u0026#39;10.1.1.22\u0026#39; option netmask \u0026#39;255.255.255.0\u0026#39; 两个路由器的lan口的配置截图 请参考 我的恩山帖子 https://www.right.com.cn/forum/thread-8355919-1-1.html\nopenwrt 配置dhcp网关 主路由openwrt 配置dhcp服务分配给下游设备的网关为10.1.1.2 ssh登录到主路由后 运行下面两行命令 。\n1 2 uci add_list dhcp.lan.dhcp_option=\u0026#34;3,10.1.1.2\u0026#34; uci commit dhcp 完成后重启dhcp 并重连下游设备，或干脆重启一下路由器。\ndhcp_option的含义以及指定的下游设备通过dhcp分组或按照mac给下游设备分别配置不同网关功能，本文不扩展\n检查状态 此时 下游设备dhcp分配的网关应该是10.1.1.2 在旁路由正常的情况下，下游被分配到10.1.1.2网关的设备应该都可以正常低调上网。\n此时和传统旁路方案完全一致。旁路由断开后，下游设备无法上网，需要通过dhcp重新分配网关ip，下游设备断开重连或手动修改下游设备网关 才可以恢复网络。说不上完美，只能说凑合而已。\n下面实现在旁路由下线后，主路由自动接替旁路由工作，并在旁路由上线后让位给旁路由。\n自动切换程序 openwrt 主路由 这个脚本运行在主路由上。 以openwrt为例。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 mkdir /opt vi /opt/ReplaceBypass.sh ================================ #!/bin/sh check_ip_available(){ ping -c 3 $1 | grep packets | awk \u0026#39;{print $4}\u0026#39; } while true do echo \u0026#34;ping 10.1.1.22 ...\u0026#34; res=`check_ip_available 10.1.1.22` current_ip=`uci get network.lan.ipaddr` echo \u0026#34;current_ip $current_ip\u0026#34; if [ $(($res)) -eq 0 ]; then echo \u0026#34;bypass is offline\u0026#34; if [ \u0026#34;$current_ip\u0026#34; != \u0026#34;10.1.1.2\u0026#34; ]; then echo \u0026#34;change to 10.1.1.2\u0026#34; sed -i \u0026#34;s/10.1.1.1\u0026#39;/10.1.1.2\u0026#39;/\u0026#34; /etc/config/network ifdown lan \u0026amp;\u0026amp; ifup lan fi else echo \u0026#34;bypass is online\u0026#34; if [ \u0026#34;$current_ip\u0026#34; != \u0026#34;10.1.1.1\u0026#34; ]; then echo \u0026#34;change to 10.1.1.1\u0026#34; sed -i \u0026#34;s/10.1.1.2\u0026#39;/10.1.1.1\u0026#39;/\u0026#34; /etc/config/network ifdown lan \u0026amp;\u0026amp; ifup lan fi fi sleep 2 #时间可以修改为1-5秒 done 这是一个循环shell脚本程序，间隔5秒用ping命令检测一次旁路由的辅助ip然后如果路由在线那么切换自己到10.1.1.1这个ip，否则切换到10.1.1.2替代路由工作。\n先手动执行sh /opt/ReplaceBypass.sh，期间反复断开和联通旁路由观察 主路由ip切换情况。期间可以用 10.1.1.11 这个ip登录到主路由web管理界面检查。\n测试正常后，我们在主路由创建一个服务来运行这个脚本，并并让openwrt的开机自启这个服务。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 vi /etc/init.d/ReplaceBypass =========================================== #!/bin/sh /etc/rc.common START=99 start(){ echo \u0026#34;ReplaceBypass service is staring\u0026#34; sh /opt/ReplaceBypass.sh \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp; } stop(){ PID=$(ps | grep \u0026#34;sh /opt/ReplaceBypass.sh\u0026#34; | grep -v grep | awk \u0026#39;{print $1}\u0026#39;) kill $PID echo \u0026#34;ReplaceBypass service is stoped\u0026#34; } 编辑完成后 启用这个服务\n1 2 3 4 chmod +x /etc/init.d/ReplaceBypass # 必须执行 service ReplaceBypass enable # 开启自启 service ReplaceBypass start # 手动执行 ps |grep ReplaceBypass # 检查进程是否存在 Padavan主路由 补充一个Padavan作为主路由的检测脚本，写完未测试 理论可行， 供参考。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 cat \u0026gt; /etc/storage/change_ip.sh \u0026lt;\u0026lt; \\EOF #!/bin/bash MainDefaultIp=\u0026#39;10.1.1.1\u0026#39; BypassWorkIp=\u0026#39;10.1.1.2\u0026#39; BypassCheckIp=\u0026#39;10.1.1.22\u0026#39; check_ip_available(){ ping -c 3 $1 | grep packets | awk \u0026#39;{print $4}\u0026#39; } res=`check_ip_available $BypassCheckIp` #检测旁路由是否存在 current_ip=`nvram get lan_ipaddr` #主路由当前ip 更多命令 nvram show change_ip(){ nvram set lan_ipaddr=$1 #设置ip nvram set lan_gateway=$1 nvram commit #提交修改 sleep 3 reboot # 需要重启设备 老毛子单独重启lan口貌似无效 } if [ $(($res)) -eq 0 ]; #即旁路由不存在，主路由应该把自己修改旁路路由的工作ip then if [ \u0026#34;$current_ip\u0026#34; != \u0026#34;$BypassWorkIp\u0026#34; ]; then #如果当前ip不是工作ip echo \u0026#34;change ip to $BypassWorkIp \u0026#34; `change_ip $BypassWorkIp` fi exit 1 fi if [ $(($res)) -ne 0 ]; # 即旁路由存在，主路由应该把自己改为默认ip then if [ \u0026#34;$current_ip\u0026#34; != \u0026#34;$MainDefaultIp\u0026#34; ]; then #如果当前ip不是默认ip echo \u0026#34;change ip to $MainDefaultIp \u0026#34; `change_ip $MainDefaultIp` fi exit 1 fi EOF chmod +x /etc/storage/change_ip.sh #设置脚本运行权限 /sbin/mtd_storage.sh save #保存脚本，防止重启丢失 # 自动定时运行脚本（每一分钟检测一次）： # 在老毛子的 `系统管理 - 服务 ` 调度任务 (Crontab) 加入 `*/1 * * * * /etc/storage/change_ip.sh` 如果您在使用ikuai-bypass 方案，希望能给点个star\n","date":"2024-03-19T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/replacebypass/","title":"旁路由-主路由自动替代旁路由的自动切换方案"},{"content":"nixos 一个很大的缺点就是 这玩意狂吃磁盘\n1 2 3 4 5 6 7 8 9 10 sudo nix-env --profile /nix/var/nix/profiles/system --list-generations sudo nix-env --profile /nix/var/nix/profiles/system --delete-generations +1 sudo nix-env --profile /nix/var/nix/profiles/per-user/root/channels --delete-generations +1 sudo nix-env --profile /nix/var/nix/profiles/per-user/yh/channels --delete-generations +1 sudo nix-env --profile /nix/var/nix/profiles/per-user/yh/profile --delete-generations +1 sudo nix-env --profile /nix/var/nix/profiles/per-user/yh/home-manager --delete-generations +1 nix-collect-garbage nix-collect-garbage -d nix-store --gc --print-roots nix-store --optimise +$1 是你想保留的快照次数\n","date":"2024-03-13T00:15:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/7nix-clean-disk/","title":"(入门安装 7 使用 nix清理磁盘)nixos 从0实现全集  梦中情os"},{"content":"nixos 因为除非恶意，理论上永远不会滚挂，所以一般的都会使用ustable版本\n在启用 flakes和home manage的情况下 只需要修改 flake.nix 即可 一个参考\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 cat /etc/nixos/flake.nix { description = \u0026#34;NixOS configuration\u0026#34;; inputs = { #nixpkgs.url = \u0026#34;github:nixos/nixpkgs/nixos-23.11\u0026#34;; nixpkgs.url = \u0026#34;github:nixos/nixpkgs/nixos-unstable\u0026#34;; home-manager = { url = \u0026#34;github:nix-community/home-manager/release-23.11\u0026#34;; inputs.nixpkgs.follows = \u0026#34;nixpkgs\u0026#34;; }; }; outputs = inputs@{ nixpkgs, home-manager, ... }: { nixosConfigurations = { # 这里的 vm-nixos 替换成你的主机名称 vm-nixos = nixpkgs.lib.nixosSystem { system = \u0026#34;x86_64-linux\u0026#34;; modules = [ ./configuration.nix home-manager.nixosModules.home-manager { home-manager.useGlobalPkgs = true; home-manager.useUserPackages = true; home-manager.users.yh = import ./home.nix; } ]; }; }; }; } ","date":"2024-03-13T00:15:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/8-os-to-unstable/","title":"(入门安装 8 启用unstable)nixos 从0实现全集  梦中情os"},{"content":"输入法 添加到 configuration.nix\n1 2 3 4 5 6 7 i18n.inputMethod = { enabled = \u0026#34;fcitx5\u0026#34;; fcitx5.addons = with pkgs; [ fcitx5-chinese-addons fcitx5-gtk ]; }; 启用桌面 添加到 configuration.nix\n1 2 3 services.xserver.enable = true; services.xserver.displayManager.gdm.enable = true; services.xserver.desktopManager.gnome.enable = true; 去掉一些不需要的包 这些包都会被排除\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 environment.gnome.excludePackages = (with pkgs; [ gnome-photos gnome-tour yelp ]) ++ (with pkgs.gnome; [ gnome-maps gnome-contacts gnome-calendar cheese # webcam tool gnome-music gnome-terminal gedit # text editor epiphany # web browser geary # email reader evince # document viewer gnome-characters totem # video player tali # poker game iagno # go game hitori # sudoku game atomix # puzzle game ]); 一些可能的错 如果你使用了unstable 一些的包和配置名称可能会变化，比如 gnome-text-editor gedit=\u0026gt; pkgs.gedit\n构建 plasma6 目前还在unstable阶段，并且确实很多插件都有问题，建议先用plasma5\n1 sudo nixos-rebuild switch --option substituters https://mirror.sjtu.edu.cn/nix-channels/store 但是 国内源很多有有问题，所以最好还是科学上网 如果构建中出问题需要更换源码，可以运行下面的命令清理后重新运行\n1 sudo nix-collect-garbage -d 进阶 flake + home-manager 管理gnome\ngnome-flake.nix 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 { options, config, lib, pkgs, ... }: with lib; with lib.plusultra; let in { services.xserver.enable = true; services.xserver.displayManager.gdm = { enable = true; autoSuspend = false; wayland = true; }; services.xserver.desktopManager.gnome = { enable = true; extraGSettingsOverridePackages = [pkgs.gnome.gnome-settings-daemon]; }; # gsettings set org.gnome.desktop.wm.preferences resize-with-right-button true services.udev.packages = with pkgs; [ gnome.gnome-settings-daemon ]; # 可以和 kde-connect 协议连接的 gnome 软件 programs.kdeconnect = { enable = true; package = pkgs.gnomeExtensions.gsconnect; }; # 需要屏蔽的gnome 软件 environment.gnome.excludePackages = (with pkgs; [ gnome-photos gnome-tour yelp gnome-text-editor snapshot #摄像头Camera xterm ]) ++ (with pkgs.gnome; [ simple-scan gnome-maps gnome-contacts gnome-calendar cheese # webcam tool gnome-music gnome-terminal #gedit # text editor pkgs.gedit epiphany # web browser geary # email reader evince # document viewer gnome-characters totem # video player tali # poker game iagno # go game hitori # sudoku game atomix # puzzle game ]); } gnome-home-manager.nix 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 { config, pkgs, ... }: let wallpaper = \u0026#34;${../../../pkgs/wallpaper-hm/pics/butterfly_surface_wooden_116623_3840x2160.jpg}\u0026#34;; avatar = \u0026#34;${../../../staticFile/avatar.jpg}\u0026#34;; in { imports = [ # ../../../pkgs/wallpaper-hm ]; home.file.\u0026#34;.face\u0026#34;.source = avatar; #头像 home.packages = with pkgs;[ gnome.gnome-tweaks gnome.gnome-themes-extra wl-clipboard gnome.adwaita-icon-theme pkgs.whitesur-gtk-theme gnome.dconf-editor gnomeExtensions.appindicator #gnomeExtensions.dash-to-dock gnomeExtensions.clipboard-history #gnomeExtensions.kimpanel #输入法样式，注释掉 使用 fcitx5.pkgs的配置 gnomeExtensions.blur-my-shell #gnomeExtensions.paperwm #不太好用 alt+tab 还可以 #gnomeExtensions.material-shell 不兼容最新版 gnomeExtensions.bing-wallpaper-changer ]; gtk = { enable = true; font = { package = pkgs.cantarell-fonts; name = \u0026#34;Cantarell 11\u0026#34;; }; #theme = { # name = \u0026#34;vimix-dark-ruby\u0026#34;; # package = pkgs.vimix-gtk-themes.override { # themeVariants = [\u0026#34;beryl\u0026#34;];#[doder|beryl|ruby|amethyst|jade|grey|all] # colorVariants = [\u0026#34;dark\u0026#34;]; # tweaks = [\u0026#34;flat\u0026#34; \u0026#34;grey\u0026#34;]; # }; # }; #Adwaita-dark #theme.name = \u0026#34;Adwaita-dark\u0026#34;; theme = { name = \u0026#34;Adwaita-dark\u0026#34;; package = pkgs.gnome3.gnome-themes-extra; }; #cursorTheme = { # name = \u0026#34;Vanilla-DMZ\u0026#34;; # package = pkgs.vanilla-dmz; #}; #iconTheme = { # name = \u0026#34;Vanilla-DMZ\u0026#34;; # package = pkgs.vanilla-dmz; # gnome3.adwaita-icon-theme; #}; iconTheme = { package = pkgs.papirus-icon-theme; name = \u0026#34;Papirus-Dark\u0026#34;; }; gtk3.extraConfig = { #gtk-decoration-layout = \u0026#34;appmenu:\u0026#34;; #gtk-decoration-layout = \u0026#34;appmenu:minimize,close\u0026#34;; #去掉最大化按钮 没啥卵用 }; }; dconf = { enable = true; settings = { \u0026#34;org/gnome/shell\u0026#34; = { disable-user-extensions = false; enabled-extensions = [ \u0026#34;appindicatorsupport@rgcjonas.gmail.com\u0026#34; #系统托盘 #\u0026#34;dash-to-dock@micxgx.gmail.com\u0026#34; \u0026#34;clipboard-history@alexsaveau.dev\u0026#34; # 剪切板 #\u0026#34;kimpanel@kde.org\u0026#34; \u0026#34;blur-my-shell@aunetx\u0026#34; #毛玻璃 \u0026#34;BingWallpaper@ineffable-gmail.com\u0026#34; \u0026#34;apps-menu@gnome-shell-extensions.gcampax.github.com\u0026#34; #\u0026#34;auto-move-windows@gnome-shell-extensions.gcampax.github.corm\u0026#34; #\u0026#34;drive-menu@gnome-shell-extensions.gcampax.github.com\u0026#34; #\u0026#34;launch-new-instance@gnome-shell-extensions.gcampax.github.com\u0026#34; #\u0026#34;light-style@gnome-shell-extensions.gcampax.github.com\u0026#34; #\u0026#34;native-window-placement@gnome-shell-extensions.gcampax.github.com\u0026#34; #\u0026#34;places-menu@gnome-shell-extensions.gcampax.github.com\u0026#34; \u0026#34;screenshot-window-sizer@gnome-shell-extensions.gcampax.github.com\u0026#34; \u0026#34;user-theme@gnome-shell-extensions.gcampax.github.com\u0026#34; \u0026#34;window-list@gnome-shell-extensions.gcampax.github.com\u0026#34; \u0026#34;windowsNavigator@gnome-shell-extensions.gcampax.github.com\u0026#34; #\u0026#34;workspace-indicator@gnome-shell-extensions.gcampax.github.com\u0026#34; #\u0026#34;paperwm@paperwm.github.com\u0026#34; #\u0026#34;material-shell@papyelgringo\u0026#34; ]; favorite-apps = [ \u0026#34;firefox.desktop\u0026#34; \u0026#34;chromium-browser.desktop\u0026#34; \u0026#34;microsoft-edge.desktop\u0026#34; \u0026#34;brave-browser.desktop\u0026#34; \u0026#34;com.vivaldi.Vivaldi.desktop\u0026#34; \u0026#34;terminator.desktop\u0026#34; \u0026#34;org.gnome.Terminal.desktop\u0026#34; \u0026#34;org.gnome.Nautilus.desktop\u0026#34; \u0026#34;code.desktop\u0026#34; \u0026#34;sublime_text.desktop\u0026#34; \u0026#34;nixos-manual.desktop\u0026#34; \u0026#34;gparted.desktop\u0026#34; \u0026#34;idea-ultimate.desktop\u0026#34; \u0026#34;rust-rover.desktop\u0026#34; \u0026#34;goland.desktop\u0026#34; \u0026#34;pycharm-professional.desktop\u0026#34; \u0026#34;goland.desktop\u0026#34; \u0026#34;jetbrains-toolbox.desktop\u0026#34; \u0026#34;AnotherRedisDesktopManager.desktop\u0026#34; \u0026#34;Hiddify-next.desktop\u0026#34; \u0026#34;virtualbox.desktop\u0026#34; ]; }; \u0026#34;org/gnome/desktop/background\u0026#34; = { # 壁纸 picture-uri = wallpaper; picture-uri-dark = wallpaper; }; \u0026#34;org/gnome/mutter\u0026#34; = { # 新窗口在屏幕中心打开 center-new-windows = true; }; \u0026#34;org/gnome/desktop/interface\u0026#34; = { # gtk-theme=\u0026#34;Adwaita-dark\u0026#34;; clock-show-date = true; clock-show-weekday = true; color-scheme = \u0026#34;prefer-dark\u0026#34;; }; #电源和做锁屏 =============== \u0026#34;org/gnome/desktop/screensaver\u0026#34; = { lock-delay = 0; lock-enabled = true; }; \u0026#34;org/gnome/desktop/session\u0026#34; = { idle-delay = 0; }; #gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-ac-type \u0026#39;nothing\u0026#39; #gsettings set org.gnome.settings-daemon.plugins.power sleep-inactive-battery-type \u0026#39;nothing\u0026#39; \u0026#34;org.gnome.settings-daemon.plugins.power\u0026#34; = { sleep-inactive-ac-type = \u0026#34;nothing\u0026#34;; sleep-inactive-battery-type = \u0026#34;nothing\u0026#34;; }; \u0026#34;org/gnome/settings-daemon/plugins/power\u0026#34; = { idle-dim = false; power-button-action = \u0026#34;suspend\u0026#34;; sleep-inactive-ac-type = \u0026#34;nothing\u0026#34;; sleep-inactive-battery-timeout = 1800; sleep-inactive-battery-type = \u0026#34;hibernate\u0026#34;; }; #电源和做锁屏 =============== \u0026#34;org/gnome/desktop/wm/preferences\u0026#34; = { resize-with-right-button = true; #win+右键 修改窗口大小 button-layout = \u0026#34;appmenu:minimize,close\u0026#34;; #去掉最大化按钮 没啥卵用 focus-mode = \u0026#34;sloppy\u0026#34;; }; \u0026#34;org/gnome/desktop/wm/keybindings\u0026#34; = { close = [ \u0026#34;\u0026lt;Alt\u0026gt;F4\u0026#34; \u0026#34;\u0026lt;Super\u0026gt;\u0026lt;Shift\u0026gt;q\u0026#34; ]; # 关闭窗口 show-desktop = [ \u0026#34;\u0026lt;Super\u0026gt;d\u0026#34; ]; # win+d 显示桌面壁纸 }; \u0026#34;org/gnome/settings-daemon/plugins/media-keys\u0026#34; = { custom-keybindings = [ \u0026#34;/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/\u0026#34; \u0026#34;/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/\u0026#34; \u0026#34;/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/\u0026#34; \u0026#34;/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/\u0026#34; \u0026#34;/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom4/\u0026#34; ]; home = [ \u0026#34;\u0026lt;Super\u0026gt;e\u0026#34; ]; # 打开文件home 使用默认文件管理器 }; \u0026#34;org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0\u0026#34; = { binding = \u0026#34;\u0026lt;Super\u0026gt;Return\u0026#34;; command = \u0026#34;terminator\u0026#34;; name = \u0026#34;Open terminator\u0026#34;; }; \u0026#34;org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1\u0026#34; = { binding = \u0026#34;\u0026lt;Super\u0026gt;p\u0026#34;; command = \u0026#34;flameshot gui\u0026#34;; name = \u0026#34;Open flameshot gui\u0026#34;; }; \u0026#34;org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2\u0026#34; = { binding = \u0026#34;\u0026lt;Shift\u0026gt;\u0026lt;Ctrl\u0026gt;Escape\u0026#34;; command = \u0026#34;gnome-system-monitor\u0026#34;; name = \u0026#34;gnome-system-monitor\u0026#34;; }; # 毛玻璃效果 ============================================================ start \u0026#34;org/gnome/shell/extensions/blur-my-shell\u0026#34; = { hacks-level = 3; }; \u0026#34;org/gnome/shell/extensions/blur-my-shell/applications\u0026#34; = { whitelist = [ \u0026#34;terminator\u0026#34; \u0026#34;kitty\u0026#34; \u0026#34;emacs\u0026#34; ]; blur-on-overview = true; sigma = 44; opacity = 241; }; \u0026#34;org/gnome/shell/extensions/blur-my-shell/appfolder\u0026#34; = { blur = true; dialog-opacity = 1; }; # 毛玻璃效果 ============================================================ end \u0026#34;org/gnome/desktop/notifications/application/com-tencent-wechat\u0026#34; = { force-expanded = true; show-banners = true; }; }; }; } ","date":"2024-03-12T21:16:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/6dektop-gnome/","title":"(6 gnome 桌面)nixos 从0实现全集  梦中情os"},{"content":"输入法 添加到 configuration.nix\n1 2 3 4 5 6 7 i18n.inputMethod = { enabled = \u0026#34;fcitx5\u0026#34;; fcitx5.addons = with pkgs; [ fcitx5-chinese-addons fcitx5-gtk ]; }; 启用桌面 添加到 configuration.nix\n1 2 3 services.xserver.enable = true; services.xserver.displayManager.sddm.enable = true; services.xserver.desktopManager.plasma5.enable = true; 构建 plasma6 目前还在unstable阶段，并且确实很多插件都有问题，建议先用plasma5\n1 sudo nixos-rebuild switch --option substituters https://mirror.sjtu.edu.cn/nix-channels/store 但是 国内源很多有有问题，所以最好还是科学上网 如果构建中出问题需要更换源码，可以运行下面的命令清理后重新运行\n1 sudo nix-collect-garbage -d 一个单独configuration.nix 带plasma6 但是 没有带flakes的实例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 { config, lib, pkgs, ... }: { imports = [ ./hardware-configuration.nix ]; boot.loader.systemd-boot.enable = true; boot.loader.efi.canTouchEfiVariables = true; nix.settings.substituters = [ \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/store\u0026#34; ]; nixpkgs.config.allowUnfree = true; networking.hostName = \u0026#34;nixos\u0026#34;; # Define your hostname. time.timeZone = \u0026#34;Asia/Shanghai\u0026#34;; virtualisation.vmware.guest.enable = true; i18n.inputMethod = { enabled = \u0026#34;fcitx5\u0026#34;; fcitx5.addons = with pkgs; [ fcitx5-chinese-addons fcitx5-gtk ]; }; services.xserver.enable = true; services.xserver.displayManager.sddm.enable = true; services.xserver.desktopManager.plasma6.enable = true; sound.enable = true; users.mutableUsers = false; # 禁止useradd添加用户 #security.sudo.wheelNeedsPassword = false; users.users.yh= { #用户名是yh isNormalUser = true; hashedPassword = \u0026#34;$y$j9T$I9BXOYYJGTV/Yx5hM7YmJ/$0Mhrve6QTJW4qZtBHRqUG7dJnXWRmdjwkFkNMM0ARA3\u0026#34;; extraGroups = [ \u0026#34;wheel\u0026#34; \u0026#34;users\u0026#34; ]; }; environment.systemPackages = with pkgs; [ wget curl unzip zsh ntfs3g wqy_zenhei kitty microsoft-edge ]; services.openssh.enable = true; users.users.root.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa XXXXX joyanhui@qq.com\u0026#34; ]; users.users.yh.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa XXXXX joyanhui@qq.com\u0026#34; ]; programs.wayfire = { enable = true; plugins = with pkgs.wayfirePlugins; [ wcm wf-shell wayfire-plugins-extra ]; }; users.defaultUserShell = pkgs.zsh; programs.zsh = { enable = true; enableCompletion = true; autosuggestions.enable = true; syntaxHighlighting.enable = true; shellAliases = { }; #history.size = 10000; #history.path = \u0026#34;${config.xdg.dataHome}/zsh/history\u0026#34;; }; system.stateVersion = \u0026#34;23.11\u0026#34;; } 构建\n1 2 3 nix-channel --add https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable nixos nix-channel --update sudo nixos-rebuild switch --option substituters https://mirrors.ustc.edu.cn/nix-channels/store ","date":"2024-03-12T20:16:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/5dektop-kde/","title":"(5 kde Plasma 桌面)nixos 从0实现全集  梦中情os"},{"content":"目录结构 1 2 3 4 5 6 7 ls -lh /etc/nixos/ total 20K -rw-r--r-- 1 root root 2.3K Mar 12 19:45 configuration.nix -rw-r--r-- 1 root root 1.2K Mar 12 20:21 flake.lock -rw-r--r-- 1 root root 1.3K Mar 12 20:21 flake.nix -rw-r--r-- 1 root root 1.3K Mar 12 16:31 hardware-configuration.nix -rw-r--r-- 1 root root 669 Mar 12 20:20 home.nix configuration.nix 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 { config, lib, pkgs, ... }: { imports = [ ./hardware-configuration.nix ]; boot.loader.systemd-boot.enable = true; boot.loader.efi.canTouchEfiVariables = true; nix.settings.substituters = [ \u0026#34;https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34; ]; nixpkgs.config.allowUnfree = true; networking.hostName = \u0026#34;vm-nixos\u0026#34;; # Define your hostname. nix.settings.experimental-features = [ \u0026#34;nix-command\u0026#34; \u0026#34;flakes\u0026#34; ]; time.timeZone = \u0026#34;Asia/Shanghai\u0026#34;; virtualisation.vmware.guest.enable = true; sound.enable = true; users.mutableUsers = false; # 禁止useradd添加用户 #security.sudo.wheelNeedsPassword = false; users.users.yh= { #用户名是yh isNormalUser = true; hashedPassword = \u0026#34;XXXXXXXXXXXXXXXX\u0026#34;; extraGroups = [ \u0026#34;wheel\u0026#34; \u0026#34;users\u0026#34; ]; }; environment.systemPackages = with pkgs; [ wget curl unzip fish ]; services.openssh.enable = true; users.users.root.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa XXXX joyanhui@qq.com\u0026#34; ]; users.users.yh.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa XXXX joyanhui@qq.com\u0026#34; ]; system.stateVersion = \u0026#34;23.11\u0026#34;; } flake.nix 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 { description = \u0026#34;NixOS configuration\u0026#34;; inputs = { nixpkgs.url = \u0026#34;github:nixos/nixpkgs/nixos-23.11\u0026#34;; home-manager = { url = \u0026#34;github:nix-community/home-manager/release-23.11\u0026#34;; inputs.nixpkgs.follows = \u0026#34;nixpkgs\u0026#34;; }; }; outputs = inputs@{ nixpkgs, home-manager, ... }: { nixosConfigurations = { # 这里的 vm-nixos 替换成你的主机名称 vm-nixos = nixpkgs.lib.nixosSystem { system = \u0026#34;x86_64-linux\u0026#34;; modules = [ ./configuration.nix # 将 home-manager 配置为 nixos 的一个 module # 这样在 nixos-rebuild switch 时，home-manager 配置也会被自动部署 home-manager.nixosModules.home-manager { home-manager.useGlobalPkgs = true; home-manager.useUserPackages = true; # 这里的 ryan 也得替换成你的用户名 # 这里的 import 函数在前面 Nix 语法中介绍过了，不再赘述 home-manager.users.yh = import ./home.nix; # 取消注释下面这一行，就可以在 home.nix 中使用 flake 的所有 inputs 参数了 # home-manager.extraSpecialArgs = inputs; } ]; }; }; }; } home.nix 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 { config, pkgs, ... }: { # 注意修改这里的用户名与用户目录 home.username = \u0026#34;yh\u0026#34;; home.homeDirectory = \u0026#34;/home/yh\u0026#34;; # 也可以在这里ln文件到用户目录，或者直接text写文件到用户目录 # 通过 home.packages 安装一些常用的软件 # 这些软件将仅在当前用户下可用，不会影响系统级别的配置 # 建议将所有 GUI 软件，以及与 OS 关系不大的 CLI 软件，都通过 home.packages 安装 这里就安装了一个 neofetch home.packages = with pkgs;[ neofetch ]; home.stateVersion = \u0026#34;23.11\u0026#34;; # Let Home Manager install and manage itself. programs.home-manager.enable = true; } hardware-configuration.nix 一般不用管，你可以修改成by-lable\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 { config, lib, pkgs, modulesPath, ... }: { imports = [ ]; boot.initrd.availableKernelModules = [ \u0026#34;ata_piix\u0026#34; \u0026#34;uhci_hcd\u0026#34; \u0026#34;ehci_pci\u0026#34; \u0026#34;ahci\u0026#34; \u0026#34;nvme\u0026#34; \u0026#34;sr_mod\u0026#34; ]; boot.initrd.kernelModules = [ ]; boot.kernelModules = [ ]; boot.extraModulePackages = [ ]; fileSystems.\u0026#34;/\u0026#34; = { device = \u0026#34;/dev/disk/by-uuid/e762404a-c507-44c8-914d-936a37170a89\u0026#34;; fsType = \u0026#34;btrfs\u0026#34;; }; fileSystems.\u0026#34;/boot\u0026#34; = { device = \u0026#34;/dev/disk/by-uuid/2C95-235F\u0026#34;; fsType = \u0026#34;vfat\u0026#34;; }; swapDevices = [ { device = \u0026#34;/dev/disk/by-uuid/374a6b36-390c-45f0-8e00-22ef4389dd1c\u0026#34;; } ]; # Enables DHCP on each ethernet and wireless interface. In case of scripted networking # (the default) this is the recommended approach. When using systemd-networkd it\u0026#39;s # still possible to use this option, but it\u0026#39;s recommended to use it in conjunction # with explicit per-interface declarations with `networking.interfaces.\u0026lt;interface\u0026gt;.useDHCP`. networking.useDHCP = lib.mkDefault true; # networking.interfaces.ens160.useDHCP = lib.mkDefault true; nixpkgs.hostPlatform = lib.mkDefault \u0026#34;x86_64-linux\u0026#34;; } flake.lock 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 { \u0026#34;nodes\u0026#34;: { \u0026#34;home-manager\u0026#34;: { \u0026#34;inputs\u0026#34;: { \u0026#34;nixpkgs\u0026#34;: [ \u0026#34;nixpkgs\u0026#34; ] }, \u0026#34;locked\u0026#34;: { \u0026#34;lastModified\u0026#34;: 1706981411, \u0026#34;narHash\u0026#34;: \u0026#34;sha256-cLbLPTL1CDmETVh4p0nQtvoF+FSEjsnJTFpTxhXywhQ=\u0026#34;, \u0026#34;owner\u0026#34;: \u0026#34;nix-community\u0026#34;, \u0026#34;repo\u0026#34;: \u0026#34;home-manager\u0026#34;, \u0026#34;rev\u0026#34;: \u0026#34;652fda4ca6dafeb090943422c34ae9145787af37\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;github\u0026#34; }, \u0026#34;original\u0026#34;: { \u0026#34;owner\u0026#34;: \u0026#34;nix-community\u0026#34;, \u0026#34;ref\u0026#34;: \u0026#34;release-23.11\u0026#34;, \u0026#34;repo\u0026#34;: \u0026#34;home-manager\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;github\u0026#34; } }, \u0026#34;nixpkgs\u0026#34;: { \u0026#34;locked\u0026#34;: { \u0026#34;lastModified\u0026#34;: 1710162809, \u0026#34;narHash\u0026#34;: \u0026#34;sha256-i2R2bcnQp+85de67yjgZVvJhd6rRnJbSYNpGmB6Leb8=\u0026#34;, \u0026#34;owner\u0026#34;: \u0026#34;nixos\u0026#34;, \u0026#34;repo\u0026#34;: \u0026#34;nixpkgs\u0026#34;, \u0026#34;rev\u0026#34;: \u0026#34;ddcd7598b2184008c97e6c9c6a21c5f37590b8d2\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;github\u0026#34; }, \u0026#34;original\u0026#34;: { \u0026#34;owner\u0026#34;: \u0026#34;nixos\u0026#34;, \u0026#34;ref\u0026#34;: \u0026#34;nixos-23.11\u0026#34;, \u0026#34;repo\u0026#34;: \u0026#34;nixpkgs\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;github\u0026#34; } }, \u0026#34;root\u0026#34;: { \u0026#34;inputs\u0026#34;: { \u0026#34;home-manager\u0026#34;: \u0026#34;home-manager\u0026#34;, \u0026#34;nixpkgs\u0026#34;: \u0026#34;nixpkgs\u0026#34; } } }, \u0026#34;root\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;version\u0026#34;: 7 } ","date":"2024-03-12T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/4base-cnf/","title":"(基础安装的目录结构 和最终配置文件 )nixos 从0实现全集  梦中情os"},{"content":"本文记录全新安装，以VMware + efi 为例 ，模拟真实物理机的安装。\n准备 安装镜像 这里用 Minimal ISO image https://nixos.org/download.html#nix-more 找到 Minimal ISO image 下载 比如我这里是 nixos-minimal-23.11.5213.b94a96839afc-x86_64-linux.iso\n准备VMware VMware创建虚拟机 选择自定义 安装程序光盘映像选择 上面下载的 nixos-mino 操作系统 选择 linux 发行版 选择 Fedora 64 位（可以开efi），cpu和内存自己看着弄，磁盘类型这里选择nvme，创建新虚拟磁盘，4G以上哦，我这选20G。\n配置虚拟机 完成后不需要启动虚拟机，配置虚拟机 在显卡的地方 可以选择打开3D加速，但是显存调整一下，给512M-768M 就够了。\n虚拟的选项 高级里面 有固件类型 选为efi。\n启动minimal安装映像 因为这里是虚拟机环境，一般不需要配置网络，所以直接装就可以。如果你需要配置网络 参考 https://nixos.org/manual/nixos/stable/#sec-installation\n为了方便 ，还是本地物理机ssh进去操作。光盘环境 默认是密码都是空的，所以执行 sudu passwd 给root设置一个密码 ip a查看一下ip\n然后本机 ssh root@192.168.xx.xx 进去。\n分区配置 我这里分三个区 分别 efi / 和 swap\n1 2 3 4 5 6 7 8 9 parted /dev/nvme0n1 -- mklabel gpt parted /dev/nvme0n1 -- mkpart ESP fat32 1MB 512MB parted /dev/nvme0n1 -- mkpart primary 512MB -2GB parted /dev/nvme0n1 -- mkpart swap linux-swap -2GB 100% parted /dev/nvme0n1 -- set 1 esp on mkfs.fat -F 32 -n boot /dev/nvme0n1p1 mkfs.btrfs -L NIXOS /dev/nvme0n1p2 mkswap -L swap /dev/nvme0n1p3 查看分区情况\n1 2 3 4 5 6 7 8 lsblk -o NAME,SIZE,TYPE,MOUNTPOINT,LABEL NAME SIZE TYPE MOUNTPOINT LABEL loop0 918.2M loop /nix/.ro-store sr0 964M rom /iso nixos-minimal-23.11-x86_64 nvme0n1 20G disk ├─nvme0n1p1 487M part boot ├─nvme0n1p2 17.7G part NIXOS └─nvme0n1p3 1.9G part swap 挂载 1 2 3 4 mount /dev/disk/by-label/NIXOS /mnt mkdir -p /mnt/boot mount /dev/disk/by-label/boot /mnt/boot swapon /dev/nvme0n1p3 更新livecd 这一步非必须的，nix的国内源都不稳定 使用之前最好问一下哪个源在当前时间下比较靠谱。\n1 2 3 4 5 6 7 8 9 10 11 12 sudo -i nix-channel --add https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable nixpkgs # 订阅镜像仓库频道 nix-channel --add https://mirrors.ustc.edu.cn/nix-channels/nixos-23.11 nixos # 请注意系统版本 nix-channel --list ---------------------------- #nixos https://mirrors.ustc.edu.cn/nix-channels/nixos-23.11 #nixpkgs https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable ---------------------------- nix-channel --update # 更新并解包频道 # nixos-rebuild --option substituters https://mirrors.ustc.edu.cn/nix-channels/store switch --upgrade # 临时切换二进制缓存源，并更新生成 nixos-rebuild --option substituters https://mirror.sjtu.edu.cn/nix-channels/store switch --upgrade # 临时切换二进制缓存源，并更新生成 创建和编辑 nix配置 生成一个基础的 1 nixos-generate-config --root /mnt 简单修改一下 /mnt/etc/nixos 下默认有两个文件 configuration.nix 和 hardware-configuration.nix 。configuration 是nixos目前的唯一配置文件，hardware-configuration是硬件相关的，里面默认只有nixos-generate-config帮你生成的硬盘挂载信息。\n目前我们并没有 启用 flakes 所以 没有flakes相关的。 新文章会包含flakes的相关内容\n1 2 cd /mnt/etc/nixos nano configuration.nix 下文中几个特别说明\nvirtualisation.vmware.guest.enable = true; 启用 vmtools nixpkgs.config.allowUnfree = true; 是否使用非开源自由软件，按需要开启 users.mutableUsers = false; 禁止使用useradd 之类的指令添加新用户 按需要 users.users.yh= 自动创建一个用户 用户名为 yh 你可以删掉整段 里面的 hashedPassword 是这个用户的密码hash sound.enable 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 { config, lib, pkgs, ... }: { imports = [ ./hardware-configuration.nix ]; boot.loader.systemd-boot.enable = true; boot.loader.efi.canTouchEfiVariables = true; nix.settings.substituters = [ \u0026#34;https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34; ]; nixpkgs.config.allowUnfree = true; networking.hostName = \u0026#34;nixos\u0026#34;; # Define your hostname. time.timeZone = \u0026#34;Asia/Shanghai\u0026#34;; virtualisation.vmware.guest.enable = true; sound.enable = true; users.mutableUsers = false; # 禁止useradd添加用户 #security.sudo.wheelNeedsPassword = false; users.users.yh= { #用户名是yh isNormalUser = true; hashedPassword = \u0026#34;*************\u0026#34;; extraGroups = [ \u0026#34;wheel\u0026#34; \u0026#34;users\u0026#34; ]; }; environment.systemPackages = with pkgs; [ wget curl unzip ]; services.openssh.enable = true; users.users.root.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa *** joyanhui@qq.com\u0026#34; ]; users.users.yh.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa *** joyanhui@qq.com\u0026#34; ]; system.stateVersion = \u0026#34;23.11\u0026#34;; } 安装 1 2 cd /mnt nixos-install --show-trace --option substituters https://mirror.sjtu.edu.cn/nix-channels/store 安装完成后 安装最后会让你输入root密码，但是偶尔会无效，所以需要单独切换到新系统里面 配置root密码\n1 2 nixos-enter # 进入部署好的系统，类似 arch 的 chroot passwd root # 重置 root 密码 如果你需要手动添加用户\n1 2 useradd -m -G wheel username1 # 添加普通用户，并加入 wheel 组 passwd username1 # 设置普通账户密码 切换到flakes 基础安装参考\n","date":"2024-03-12T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/1base-install/","title":"入门安装（nixos 从0实现全集  梦中情os ）"},{"content":"基本安装 在想使用flakes之前你最好对nixos有初步的了解，知道 configuration.nix 的基本配置 基础安装参考。 flake参考。\n使用 Home Manager 必须有良好的网络环境，意味着你需要解决科学上网的问题。\n/etc/nixos/home.nix 创建/etc/nixos/home.nix\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 { config, pkgs, ... }: { # 注意修改这里的用户名与用户目录 home.username = \u0026#34;yh\u0026#34;; home.homeDirectory = \u0026#34;/home/yh\u0026#34;; # 也可以在这里ln文件到用户目录，或者直接text写文件到用户目录 # 通过 home.packages 安装一些常用的软件 # 这些软件将仅在当前用户下可用，不会影响系统级别的配置 # 建议将所有 GUI 软件，以及与 OS 关系不大的 CLI 软件，都通过 home.packages 安装 这里就安装了一个 neofetch home.packages = with pkgs;[ neofetch ]; home.stateVersion = \u0026#34;23.11\u0026#34;; # Let Home Manager install and manage itself. programs.home-manager.enable = true; } 修改/etc/nixos/flake.nix 原始内容\n1 2 3 4 5 6 7 8 9 { outputs = { self, nixpkgs }: { # replace \u0026#39;vm-nixo\u0026#39; with your hostname here. nixosConfigurations.vm-nixos = nixpkgs.lib.nixosSystem { system = \u0026#34;x86_64-linux\u0026#34;; modules = [ ./configuration.nix ]; }; }; } 修改为\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 { description = \u0026#34;NixOS configuration\u0026#34;; inputs = { nixpkgs.url = \u0026#34;github:nixos/nixpkgs/nixos-23.11\u0026#34;; home-manager = { url = \u0026#34;github:nix-community/home-manager/release-23.11\u0026#34;; inputs.nixpkgs.follows = \u0026#34;nixpkgs\u0026#34;; }; }; outputs = inputs@{ nixpkgs, home-manager, ... }: { nixosConfigurations = { # 这里的 vm-nixos 替换成你的主机名称 vm-nixos = nixpkgs.lib.nixosSystem { system = \u0026#34;x86_64-linux\u0026#34;; modules = [ ./configuration.nix # 将 home-manager 配置为 nixos 的一个 module # 这样在 nixos-rebuild switch 时，home-manager 配置也会被自动部署 home-manager.nixosModules.home-manager { home-manager.useGlobalPkgs = true; home-manager.useUserPackages = true; # 这里的 ryan 也得替换成你的用户名 # 这里的 import 函数在前面 Nix 语法中介绍过了，不再赘述 home-manager.users.yh = import ./home.nix; # 取消注释下面这一行，就可以在 home.nix 中使用 flake 的所有 inputs 参数了 # home-manager.extraSpecialArgs = inputs; } ]; }; }; }; } 构建 1 2 3 sudo nixos-rebuild switch --flake \u0026#39;/etc/nixos#vm-nixos\u0026#39; # 如果主机名一样，可以忽略flake参数 sudo nixos-rebuild switch 这样构建完成后 用户yh 就可以使用 neofetch\n进阶 flake.nix 和 Home Manager ","date":"2024-03-12T00:16:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/3base-install-home/","title":"(入门安装 3 使用 Home Manager )nixos 从0实现全集  梦中情os"},{"content":"基本按照 在想使用flakes之前你最好对nixos有初步的了解，知道 configuration.nix 的基本配置 基础安装参考。\n这里只需要修改 configuration.nix 添加一行 nix.settings.experimental-features = [ \u0026quot;nix-command\u0026quot; \u0026quot;flakes\u0026quot; ]; 另外编辑一下或者记录一下 hostname networking.hostName = \u0026quot;vm-nixos\u0026quot;; 因为 flakes可以根据不同的hostname做不同的配置\n基本的 flake.nix 创建一个 flake.nix 如果你是按照前文新安装的 那么 路径应该是 /mnt/etc/nixos/flake.nix 否则是 /etc/nixos/flake.nix\n1 2 3 4 5 6 7 8 9 { outputs = { self, nixpkgs }: { # replace \u0026#39;vm-nixo\u0026#39; with your hostname here. nixosConfigurations.vm-nixos = nixpkgs.lib.nixosSystem { system = \u0026#34;x86_64-linux\u0026#34;; modules = [ ./configuration.nix ]; }; }; } 这里大概的意思 是 再跳转回去 configuration.nix 这样就可以 继续使用原来的 配置。\n修改后的configuration.nix 参考\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 cat /etc/nixos/configuration.nix { config, lib, pkgs, ... }: { imports = [ ./hardware-configuration.nix ]; boot.loader.systemd-boot.enable = true; boot.loader.efi.canTouchEfiVariables = true; nix.settings.substituters = [ \u0026#34;https://mirror.sjtu.edu.cn/nix-channels/store\u0026#34; ]; nixpkgs.config.allowUnfree = true; networking.hostName = \u0026#34;vm-nixos\u0026#34;; # Define your hostname. nix.settings.experimental-features = [ \u0026#34;nix-command\u0026#34; \u0026#34;flakes\u0026#34; ]; time.timeZone = \u0026#34;Asia/Shanghai\u0026#34;; virtualisation.vmware.guest.enable = true; sound.enable = true; users.mutableUsers = false; # 禁止useradd添加用户 #security.sudo.wheelNeedsPassword = false; users.users.yh= { #用户名是yh isNormalUser = true; hashedPassword = \u0026#34;XXXXX\u0026#34;; extraGroups = [ \u0026#34;wheel\u0026#34; \u0026#34;users\u0026#34; ]; }; environment.systemPackages = with pkgs; [ wget curl unzip fish ]; services.openssh.enable = true; users.users.root.openssh.authorizedKeys.keys = [ \u0026#34;XXXXX joyanhui@qq.com\u0026#34; ]; users.users.yh.openssh.authorizedKeys.keys = [ \u0026#34;XXXXX joyanhui@qq.com\u0026#34; ]; system.stateVersion = \u0026#34;23.11\u0026#34;; } 构建 1 sudo nixos-rebuild switch --option substituters https://mirror.sjtu.edu.cn/nix-channels/store 也可以 # 后面是hostname\n1 sudo nixos-rebuild switch --flake \u0026#39;/etc/nixos#vm-nixos\u0026#39; --option substituters https://mirror.sjtu.edu.cn/nix-channels/store 如果是新安装的 要直接启用flake 一般必须使用 \u0026ndash;flake 因为livecd的hostname和你配置文件的不一样的哦\n1 nixos-install --show-trace --flake \u0026#39;/mnt/etc/nixos#vm-nixos\u0026#39; --option substituters https://mirror.sjtu.edu.cn/nix-channels/store 进阶 flake.nix 和 Home Manager Home Manager。\n","date":"2024-03-12T00:15:20+08:00","permalink":"https://dev.leiyanhui.com/nixos/2base-install-flakes/","title":"(入门安装 2 使用 flakes)nixos 从0实现全集  梦中情os"},{"content":"本文不再更新，建议查看 https://dev.leiyanhui.com/nixos/start/\n硬盘 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 echo -e \u0026#34;mklabel gpt \\nmkpart ESP fat32 1MiB 512MiB \\nset 1 esp on \\nmkpart primary 512MiB 100% \\nquit\u0026#34; | parted /dev/nvme0n1 mkfs.fat -F 32 /dev/nvme0n1p1 #dosfslabel /dev/nvme0n1p1 EFI mkfs.btrfs -L NIXOS /dev/nvme0n1p2 mount /dev/nvme0n1p2 /mnt # 将根分区挂载到 /mnt 下 btrfs subvolume create /mnt/root # 创建 root 子卷 btrfs subvolume create /mnt/home # 创建 home 子卷 btrfs subvolume create /mnt/nix # 创建 nix 子卷 umount /mnt # 取消挂载 mount -o compress=zstd,subvol=root /dev/nvme0n1p2 /mnt # 启用透明压缩参数挂载 root 子卷 mkdir /mnt/{home,nix,boot} # 创建 home，nix，boot 目录 mount -o compress=zstd,subvol=home /dev/nvme0n1p2 /mnt/home # 启用透明压缩参数挂载 home 子卷 mount -o compress=zstd,noatime,subvol=nix /dev/nvme0n1p2 /mnt/nix # 启用透明压缩并不记录时间戳参数挂载 nix 子卷 mount /dev/nvme0n1p1 /mnt/boot # 挂载 boot nixos-generate-config --root /mnt cd /mnt/etc/nixos/ sed -i \u0026#39;s/ \\[ \u0026#34;subvol=root\u0026#34; \\]/ \\[ \u0026#34;subvol=nix\u0026#34; \u0026#34;compress=zstd\u0026#34; \\]/g\u0026#39; hardware-configuration.nix sed -i \u0026#39;s/ \\[ \u0026#34;subvol=home\u0026#34; \\]/ \\[ \u0026#34;subvol=nix\u0026#34; \u0026#34;compress=zstd\u0026#34; \\]/g\u0026#39; hardware-configuration.nix sed -i \u0026#39;s/ \\[ \u0026#34;subvol=nix\u0026#34; \\]/ \\[ \u0026#34;subvol=nix\u0026#34; \u0026#34;compress=zstd\u0026#34; \u0026#34;noatime\u0026#34; \\]/g\u0026#39; hardware-configuration.nix configuration.nix base with zsh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 { config, lib, pkgs, ... }: { imports = [ ./hardware-configuration.nix ]; boot.loader.systemd-boot.enable = true; boot.loader.efi.canTouchEfiVariables = true; nix.settings.substituters = [ \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/store\u0026#34; ]; nixpkgs.config.allowUnfree = true; networking.hostName = \u0026#34;nixos\u0026#34;; # Define your hostname. time.timeZone = \u0026#34;Asia/Shanghai\u0026#34;; virtualisation.vmware.guest.enable = true; sound.enable = true; users.mutableUsers = false; # 禁止useradd添加用户 #security.sudo.wheelNeedsPassword = false; users.users.yh= { #用户名是yh isNormalUser = true; hashedPassword = \u0026#34;$y$j9T$I9BXOYYJGTV/Yx5hM7YmJ/$0Mhrve6QTJW4qZtBHRqUG7dJnXWRmdjwkFkNMM0ARA3\u0026#34;; extraGroups = [ \u0026#34;wheel\u0026#34; \u0026#34;users\u0026#34; ]; }; environment.systemPackages = with pkgs; [ wget curl unzip zsh wqy_zenhei ]; services.openssh.enable = true; users.users.root.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDwkV1nzSvgoklrfinn8BzxveOPd0UPY1sYwwMMMQrjoAih1PZldT8LcA6zqUsERLXGHf2qy1gSdMFomAAejDEo1aU0PmaGGX4+LWgvlH2xvr3MlbItWLwbXYQdhsfqKu93Qnt7aODJ1Ts2kzp7CP1yR1O4BFUemfnPMVyj07Vj70yg1nDPIXxCPzcMEsJ1OGUduCaDqNA8Ag+TmSSCM+E9rEgMEAcRqpziQYeUEU/RASRYPDeDj5kE81qcDDhseknTFGGa99yZU1R+zuVh4IQEZnr0rZbty0noRFU4AFgMxKaMXwrusjOoX62pEQ0KKU7+pJoKgzVNSFDwt7j50PgOXCue3cqi3Rf4zMpVPkrJP2V+ELR44i/PNHP0GflaNU0RumX8jwScqxMT/NOAdsPs5fRIiUocDXASypjM/2dpJ9wlmmU+ngVFba316Q1kff1LQ0NH5kmKs5DDmL+vbC8wcWuwVuZty2FPJwpdxXK1Oax8GEw4WIM6QjJJ4jqh//k= joyanhui@qq.com\u0026#34; ]; users.users.yh.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDwkV1nzSvgoklrfinn8BzxveOPd0UPY1sYwwMMMQrjoAih1PZldT8LcA6zqUsERLXGHf2qy1gSdMFomAAejDEo1aU0PmaGGX4+LWgvlH2xvr3MlbItWLwbXYQdhsfqKu93Qnt7aODJ1Ts2kzp7CP1yR1O4BFUemfnPMVyj07Vj70yg1nDPIXxCPzcMEsJ1OGUduCaDqNA8Ag+TmSSCM+E9rEgMEAcRqpziQYeUEU/RASRYPDeDj5kE81qcDDhseknTFGGa99yZU1R+zuVh4IQEZnr0rZbty0noRFU4AFgMxKaMXwrusjOoX62pEQ0KKU7+pJoKgzVNSFDwt7j50PgOXCue3cqi3Rf4zMpVPkrJP2V+ELR44i/PNHP0GflaNU0RumX8jwScqxMT/NOAdsPs5fRIiUocDXASypjM/2dpJ9wlmmU+ngVFba316Q1kff1LQ0NH5kmKs5DDmL+vbC8wcWuwVuZty2FPJwpdxXK1Oax8GEw4WIM6QjJJ4jqh//k= joyanhui@qq.com\u0026#34; ]; users.defaultUserShell = pkgs.zsh; programs.zsh = { enable = true; enableCompletion = true; autosuggestions.enable = true; syntaxHighlighting.enable = true; shellAliases = { }; #history.size = 10000; #history.path = \u0026#34;${config.xdg.dataHome}/zsh/history\u0026#34;; }; system.stateVersion = \u0026#34;23.11\u0026#34;; } configuration.nix with kde6 and wayfire 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 { config, lib, pkgs, ... }: { imports = [ ./hardware-configuration.nix ]; boot.loader.systemd-boot.enable = true; boot.loader.efi.canTouchEfiVariables = true; nix.settings.substituters = [ \u0026#34;https://mirrors.ustc.edu.cn/nix-channels/store\u0026#34; ]; nixpkgs.config.allowUnfree = true; networking.hostName = \u0026#34;nixos\u0026#34;; # Define your hostname. time.timeZone = \u0026#34;Asia/Shanghai\u0026#34;; virtualisation.vmware.guest.enable = true; i18n.inputMethod = { enabled = \u0026#34;fcitx5\u0026#34;; fcitx5.addons = with pkgs; [ fcitx5-chinese-addons fcitx5-gtk ]; }; services.xserver.enable = true; services.xserver.displayManager.sddm.enable = true; services.xserver.desktopManager.plasma6.enable = true; sound.enable = true; users.mutableUsers = false; # 禁止useradd添加用户 #security.sudo.wheelNeedsPassword = false; users.users.yh= { #用户名是yh isNormalUser = true; hashedPassword = \u0026#34;$y$j9T$I9BXOYYJGTV/Yx5hM7YmJ/$0Mhrve6QTJW4qZtBHRqUG7dJnXWRmdjwkFkNMM0ARA3\u0026#34;; extraGroups = [ \u0026#34;wheel\u0026#34; \u0026#34;users\u0026#34; ]; }; environment.systemPackages = with pkgs; [ wget curl unzip zsh ntfs3g wqy_zenhei kitty microsoft-edge ]; services.openssh.enable = true; users.users.root.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDwkV1nzSvgoklrfinn8BzxveOPd0UPY1sYwwMMMQrjoAih1PZldT8LcA6zqUsERLXGHf2qy1gSdMFomAAejDEo1aU0PmaGGX4+LWgvlH2xvr3MlbItWLwbXYQdhsfqKu93Qnt7aODJ1Ts2kzp7CP1yR1O4BFUemfnPMVyj07Vj70yg1nDPIXxCPzcMEsJ1OGUduCaDqNA8Ag+TmSSCM+E9rEgMEAcRqpziQYeUEU/RASRYPDeDj5kE81qcDDhseknTFGGa99yZU1R+zuVh4IQEZnr0rZbty0noRFU4AFgMxKaMXwrusjOoX62pEQ0KKU7+pJoKgzVNSFDwt7j50PgOXCue3cqi3Rf4zMpVPkrJP2V+ELR44i/PNHP0GflaNU0RumX8jwScqxMT/NOAdsPs5fRIiUocDXASypjM/2dpJ9wlmmU+ngVFba316Q1kff1LQ0NH5kmKs5DDmL+vbC8wcWuwVuZty2FPJwpdxXK1Oax8GEw4WIM6QjJJ4jqh//k= joyanhui@qq.com\u0026#34; ]; users.users.yh.openssh.authorizedKeys.keys = [ \u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDwkV1nzSvgoklrfinn8BzxveOPd0UPY1sYwwMMMQrjoAih1PZldT8LcA6zqUsERLXGHf2qy1gSdMFomAAejDEo1aU0PmaGGX4+LWgvlH2xvr3MlbItWLwbXYQdhsfqKu93Qnt7aODJ1Ts2kzp7CP1yR1O4BFUemfnPMVyj07Vj70yg1nDPIXxCPzcMEsJ1OGUduCaDqNA8Ag+TmSSCM+E9rEgMEAcRqpziQYeUEU/RASRYPDeDj5kE81qcDDhseknTFGGa99yZU1R+zuVh4IQEZnr0rZbty0noRFU4AFgMxKaMXwrusjOoX62pEQ0KKU7+pJoKgzVNSFDwt7j50PgOXCue3cqi3Rf4zMpVPkrJP2V+ELR44i/PNHP0GflaNU0RumX8jwScqxMT/NOAdsPs5fRIiUocDXASypjM/2dpJ9wlmmU+ngVFba316Q1kff1LQ0NH5kmKs5DDmL+vbC8wcWuwVuZty2FPJwpdxXK1Oax8GEw4WIM6QjJJ4jqh//k= joyanhui@qq.com\u0026#34; ]; programs.wayfire = { enable = true; plugins = with pkgs.wayfirePlugins; [ wcm wf-shell wayfire-plugins-extra ]; }; users.defaultUserShell = pkgs.zsh; programs.zsh = { enable = true; enableCompletion = true; autosuggestions.enable = true; syntaxHighlighting.enable = true; shellAliases = { }; #history.size = 10000; #history.path = \u0026#34;${config.xdg.dataHome}/zsh/history\u0026#34;; }; system.stateVersion = \u0026#34;23.11\u0026#34;; } 命令 1 2 3 4 5 ix-channel --add https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable nixos nix-channel --update sudo nixos-rebuild switch --option substituters https://mirrors.ustc.edu.cn/nix-channels/store cd /mnt nixos-install --show-trace --option substituters https://mirrors.ustc.edu.cn/nix-channels/store ","date":"2024-03-12T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/nixos-install/","title":"nixos基础安装 和带桌面安装"},{"content":"惊闻微信出linux版，一开始以为是uos的那个web微信升级了。后来知道是原生测试版本。 当然只支持银河麒麟和统信，不过有解决颁发。\n新版微信 debian12 可以直接安装\n1 2 3 https://www.52pojie.cn/thread-1896902-1-1.html # 下载地址 https://cloud.cnxclm.com/s/XOxIb?path=%2F%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95 不一定需要\n1 mkdir /usr/lib/license/ \u0026amp;\u0026amp; cp ./libuosdevicea.so /usr/lib/license/ 卸载和安装 1 2 3 4 5 6 sudo apt install dpkg-dev # 非必须 sudo apt install ./store.spark-app.wechat-linux-spark_2.2-real-1.0.0.145_amd64.deb killall wechat sudo apt purge store.spark-app.wechat-linux-spark 体验 比win的微信差了不是一点半点，比web微信强了也不是一点半点 。\n内存 有一个weicha进程80-150M内存 有几个 wechatAPPex进程 每个 8-80M不等 总共 400M内存左右。 xwayland和xorg 下fcitx5 都不需要单独处理 直接可用。\n托盘图标有，但是右键没反应 killall wechat 就行了。 有时候需要点击两次才可以唤起微信窗口 gnome dash图标空白的蓝色齿轮图 消息提醒不显示消息内容 只有 \u0026ldquo;wechat is ready\u0026rdquo; wayland下截图不可用 黑屏，xorg下正常。alt+x 截图快捷键正常 没有群消息折叠 群太多的话依旧蛋疼 维持和 某一个好友的对话框的情况下，收到好友消息后，手机也会提醒。(web微信不可以，非常容易漏消息) 没有暗黑模式适配，白晃晃的亮瞎眼睛 聊天记录没有清理功能。可以删除消息但是只能一条一条的。 被加好友 没有任何提醒 没有朋友圈功能，有小程序 看一看 视频号 群聊内无法点击好友头像转私聊 查看图片功能 esc无效要 alt+f4 貌似是qt开发的，发送文件的选择文件对话框 整个上古风，不过可以输入路径前缀定位文件。 消息不能撤回！！！ 据说在麒麟和uos下托盘和消息提醒功能适配的不错，但是debian下 只能凑合用\n其他参考 https://www.52pojie.cn/thread-1896902-1-1.html\n","date":"2024-03-07T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/wecha-new-debian/","title":"debian12安装微信原生版 非web 非electron 非wine"},{"content":"前后尝试了一圈笔记软件 最后停留在思源，但是因为除了思源的黑历史的膈应和最近的同步收费问题。思源本身也有一些问题。所以尝试了一下outline。\n迁移过程说明 思源逐个导出md.zip 逐个解压到同一个文件夹。然后压缩成zip 导入到outline。 如果文档笔记多，可以现在思源把多个文档合并到3-5个文档的子文档里面再导出md。\n::: 丢失部分内联变成纯文本了。 部分图片地址有误。\n体验不好的地方 没有多文件编辑 需要用收藏功能或者浏览器的多标签替代多标签切换， 两个连续的区块（代码库 提示 引用之类的）中间无法插入新内容，需要删除后面的内容加空行后重新粘贴（或者是我不会） 在上一个区块的末行空行回车即可 需要pgsql redis 还有强制s3储存 第三方登陆等 部署麻烦一丢丢，用了vicalloy/outline-docker-compose 直接搞也还好 貌似没有ai支持 试了试Codeium的浏览器插件好像识别不了，暂时没有找到解决办法先忍一下。 也没有纯md代码编辑模式 爽点 多人协作 评论功能 url分享 历史记录 模板功能直观易用，可以在outline直接写hugo hexo vuepress的草稿 整个工作区导出为md 复制md到剪切板（思源的需要单独的主题插件才支持，貌似那个主题也被下架了） 和思源一样支持web部署，移动版多平台可以直接webapp，更是支持多用户 安装过程 clone vicalloy的脚本 1 2 3 4 5 mkdir -p /myfile/outline \u0026amp;\u0026amp; cd /myfile/outline echo \u0026#34;https://github.com/vicalloy/outline-docker-compose.git\u0026#34;\u0026gt;/myfile/outline/README_outline-docker-compose.md git clone https://github.com/vicalloy/outline-docker-compose.git cd outline-docker-compose cp scripts/config.sh.sample scripts/config.sh 简单修改 修改点\n语言 DEFAULT_LANGUAGE 时区 TIME_ZONE nginx端口和ip HTTP_PORT_IP HTTP_IP outline版本 OUTLINE_VERSION nas上统一的管理的https域名和端口 URL 这个和这里的nginx无关，是外部访问用的，我这里是caddy+dnspods 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 # update config file: vim scripts/config.sh cat \u0026gt; /myfile/outline/outline-docker-compose/scripts/config.sh \u0026lt;\u0026lt;\\EOF # Outline Wiki 0.72.0-1 supports local file storage. # Specify what storage system to use. Possible value is one of \u0026#34;s3\u0026#34; or \u0026#34;local\u0026#34;. # For \u0026#34;local\u0026#34;, the avatar images and document attachments will be saved on local disk. FILE_STORAGE=local # The url used to vist this web site. URL=https://XXXXXXX.leiyanhui.com:XXX # The default interface language. See translate.getoutline.com for a list of # available language codes and their rough percentage translated. DEFAULT_LANGUAGE=zh_CN # https://docs.djangoproject.com/en/2.2/ref/settings/#language-code LANGUAGE_CODE=en-us # https://en.wikipedia.org/wiki/List_of_tz_database_time_zones TIME_ZONE=Asia/Shanghai FORCE_HTTPS=false # The domain in you email. # Comma separated list of domains to be allowed (optional). # If not set, the first user\u0026#39;s domain is allowed by default. ALLOWED_DOMAINS= # Docker image version OUTLINE_VERSION=0.75.2 POSTGRES_VERSION=15.2-alpine3.17 MINIO_VERSION=RELEASE.2022-11-17T23-20-09Z MINIO_MC_VERSION=RELEASE.2022-11-17T21-20-39Z # Nginx # The nginx bind ip and port. # If you use ip address to access outline, this ip and port should be same as the URL. # If this server behind a proxy(nginx), you can bind to `127.0.0.1`. HTTP_IP=0.0.0.0 HTTP_PORT_IP=8081 # Docker # If you server behind a proxy(nginx), and the proxy created by docker. You can use the proxy\u0026#39;s network. Set the `NETWORKS` to proxy\u0026#39;s network name, and set `NETWORKS_EXTERNAL` to `true` . # The sample config for host nginx can be find in `config/sample/nginx_outline.conf`. NETWORKS=outlinewiki NETWORKS_EXTERNAL=false # Secret keys, update by script. # You shouldn\u0026#39;t edit it. MINIO_ACCESS_KEY= MINIO_SECRET_KEY= OIDC_CLIENT_SECRET= OUTLINE_SECRET_KEY= OUTLINE_UTILS_SECRET= DJANGO_SECRET_KEY= EOF 常用命令 1 2 3 4 5 make install make start #start outline make stop #stop outline 也会删除容器 make clean #remove all config file generated by script. make clean-data # You will lose all your data 数据备份 /myfile/outline/outline-docker-compose/data 目录 或者 outline内直接导出\n","date":"2024-03-06T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/siyuan-to-outline/","title":"私有化笔记软件从思源迁移到outline"},{"content":"先说结论，指针传参 性能要远远高于直接传递值。并不会因为指针导致内存逃逸到堆上。\n原因很简单：函数内的变量创建和销毁需要大量的性能开支。\n无论是否用协程 无论参数类型，无论数据在函数内怎么处理。\nreq,err=func(xxx) 的性能 也低于 func(\u0026amp;xxx,\u0026amp;req,\u0026amp;err)\n用指针需要注意的是 1、函数内部修改值的时候数据的安全 2、如果有内存逃逸的情况会增加gc负担 会导致性能会下滑\n测试代码 ，字符串拼接的因为牵扯到内存的重新分配所以性能差距更大。 不拼接只检查字符串长度，可以增加mianLoop采样次数 此时指针依旧是更快的。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 package main import ( \u0026#34;log\u0026#34; \u0026#34;time\u0026#34; ) func main() { var strLong string = \u0026#34;Sr5sLSyfjqUR8LBp0DHM6HfnYDLR09vmxwLNlM_fn7fa6Psm-4vWjEvooi6OsT5b8a_k7w-wOuGB2PHPUPMse2zj9YxYOyEDQejFDf_ESqe3ESDa_evh8rnZWF7j3jsYjB-BsCF1jWS41M2UI7UjDX_3QZGZ9EScMmMOZykAkWN8AJUbjsEbc_gofOmxjAabmSvKcHh1zhK3IQcomP3s5oBj2T32oV098jR3IqZsPkaAOcvr-LHSETaTmwKmjd-Qb00haPiuuTWxVqm0gPJ3nz-JzWTh8_9H8Jv9IMWbH0mh2T-KuzcHFGevPGqNM-5GdGo4iISCkx10Sekj1TDb1YHyS6G1A6MZCWHcjml5iQ0Ull-Wynp1EOqZHInbOl0h4JDEyFEk4UAGGr705_FwB_6R6WRJd1Ma6UFfP2HtbU0BsMoHLcTlhdsuURRdHY33KAJCD4pdduuGKeCqtRVLFa4furAjbsqnvivg44FIVyxDmxFSKf9SkgMJ3OiwpVn9bWTiuKlJu1ezb5L68JkNGcOEf94hC34XKCBI6uTA0pKZg6bTAru5ZknCa3-PeSmJAP7mznL3lLPinMIEhuoF0y09qGTVIIleM9wCsmZHa5Gdw8YndeVzlHKA9BBO5GMMuUFMBH4bbCj0onuiJ7vlYxO7PMQF-pEIk0TcZyjL__XqhAA07xg-L-xF4tfvHI-MBgJNrfjCPayIfYsjxtQ23V5uXhfoAeluzZNxPjr3f857VPxagTU4VgAUlZYC7qH0LqoKHsngAnEV38QIOFC4H3T3KOykT-Vf-z8xbZQ2u-0h2GAb4h1blmg9li9zmRXhoE88q9_H8PUP3d1CklPtP6Mqi0b2f3GPM9YqSAvEF-IfZ4nepn9dRmKg18Wnz8IC0_7gaOXX_C-OcSuR60Qk9WwRw0pyjig75VwY6ZFQ0MyuGM_1T8nIeIt84Ks272LWFHpIPt7s9uFcM0AtGbeg_SK4NkjRg6F1DrXKLqtFXZfszK19_WWvG2bEpsByvmjcuu_4Sye6OxBgpkyS1yxMsBQKCwoa4kaPtdXCxFHBLT6wLw4uS11Ym_Z5d36X035j6v5W9l9dst5hzsnUq1C2ZOLAuptiKkRTt-O-jzZTPGaJc-K79xtT8dyUn0CuRylRCbl1XFCSu2ZgEeebpJ8s-zEiNA3wZq9ZsEMQsNmD_433XUY4FAdQTFRAD-iQvFcUuKb2yhJ4zu1diw_pIstvrOZy04CNdxLtKswNYFN3CaiGVU-egu_r-Ao-SIUXgFi-G7ARsnNBpUKeL3NXjcStEa_b-ldZrzSZc2fTca_kH7CykR47q-x-pAVj9CxCMMZK10i1rCeHyMWqfWRFmKmztb9kW8xI0x7aUZwLosHs52ljg8dvwHyZQGEU2rYNehGvbvaz1M-Y1qaRZIym9w9M-qlmQc7ymnIjr3TKBDpq8UcoNT6wQj12l5TdcrtmzOWX\u0026#34; //strLong = \u0026#34;1234567890abcdefghijklmnopqrstuvwxyz\u0026#34; var strLong2 = strLong log.Println(\u0026#34;。。。\u0026#34;, len(strLong2)) log.Println(\u0026#34;字符长度\u0026#34;, len(strLong)) var NumberOfprocesses = 100 var count int64 = 0 for mianLoop := 0; mianLoop \u0026lt; 1000; mianLoop++ { //var wg sync.WaitGroup startTime := time.Now().UnixNano() for i := 0; i \u0026lt; NumberOfprocesses; i++ { //wg.Add(1) //go func(varStr string) { func(varStr string) { //defer wg.Done() //varStr = varStr + strLong2 if len(varStr) \u0026gt; i { return } }(strLong) } //wg.Wait() endTime := time.Now().UnixNano() timeDiff1 := endTime - startTime //log.Println(\u0026#34;耗时\u0026#34;, timeDiff1, \u0026#34;纳秒\u0026#34;) startTime = time.Now().UnixNano() for i2 := 0; i2 \u0026lt; NumberOfprocesses; i2++ { //wg.Add(1) //go func(varStr *string) { func(varStr *string) { //defer wg.Done() //*varStr = strLong2 + strLong2 if len(*varStr) \u0026gt; i2 { return } }(\u0026amp;strLong) } //wg.Wait() endTime = time.Now().UnixNano() timeDiff2 := endTime - startTime //log.Println(\u0026#34;耗时\u0026#34;, timeDiff2, \u0026#34;纳秒\u0026#34;) //log.Println(\u0026#34;差值\u0026#34;, timeDiff1-timeDiff2, \u0026#34;纳秒\u0026#34;) count = count + (timeDiff1 - timeDiff2) } log.Println(\u0026#34;差值\u0026#34;, count, \u0026#34;纳秒\u0026#34;) } 检查内存\n1 go build -gcflags \u0026#39;-m\u0026#39; ./ ","date":"2024-02-17T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/funpointerparameter/","title":"golang 指针传参和直接传的性能简单对比"},{"content":"需要自行编译固件 下面代码基于micropython-1.22.1 和 esp-idf-v5.0.4\nesp-idf 从4.x到5.x有一些变化 记录一下新版本的使用方法\n添加一个C模块 需要4个文件 cd micropython-1.22.1/ports/esp32/\n1 2 3 4 #ls cmodules/ micropython.cmake sensorcoretemper ls cmodules/sensorcoretemper micropython.cmake micropython.mk sensorcoretemper.c sensorcoretemper.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 #include \u0026#34;py/obj.h\u0026#34; #include \u0026#34;py/runtime.h\u0026#34; #include \u0026#34;esp_log.h\u0026#34; #include \u0026#34;driver/temperature_sensor.h\u0026#34; // 定义一个全局变量来保存句柄 static temperature_sensor_handle_t tsens = NULL; static const char *TAG = \u0026#34;sensorcoretemper\u0026#34;; // 函数 初始化 并启动 STATIC mp_obj_t sensorcoretemper_init(void) { ESP_LOGI(TAG, \u0026#34;Install temperature sensor, expected temp ranger range: 10~50 ℃\u0026#34;); temperature_sensor_config_t temp_sensor = TEMPERATURE_SENSOR_CONFIG_DEFAULT(10, 50); //ESP_ERROR_CHECK(temperature_sensor_install(\u0026amp;temp_sensor)); ESP_ERROR_CHECK(temperature_sensor_install(\u0026amp;temp_sensor, \u0026amp;tsens)); // 注意这里的改动 ESP_LOGI(TAG, \u0026#34;Enable temperature sensor\u0026#34;); //ESP_ERROR_CHECK(temperature_sensor_enable()); ESP_ERROR_CHECK(temperature_sensor_enable(tsens)); // 注意这里的改动 return mp_const_none; } STATIC MP_DEFINE_CONST_FUN_OBJ_0(sensorcoretemper_init_obj, sensorcoretemper_init); // 函数 获取 STATIC mp_obj_t sensorcoretemper_getT(void) { ESP_LOGI(TAG, \u0026#34;Read temperature\u0026#34;); float tsens_value; //ESP_ERROR_CHECK(temperature_sensor_get_celsius(\u0026amp;tsens_value)); ESP_ERROR_CHECK(temperature_sensor_get_celsius(tsens, \u0026amp;tsens_value)); ESP_LOGI(TAG, \u0026#34;Temperature value %.02f ℃\u0026#34;, tsens_value); return mp_obj_new_float(tsens_value); } STATIC MP_DEFINE_CONST_FUN_OBJ_0(sensorcoretemper_getT_obj, sensorcoretemper_getT); // 函数 停止 STATIC mp_obj_t sensorcoretemper_stop(void) { //ESP_ERROR_CHECK(temperature_sensor_disable()); ESP_ERROR_CHECK(temperature_sensor_disable(tsens)); // 注意这里的改动 return mp_const_none; } STATIC MP_DEFINE_CONST_FUN_OBJ_0(sensorcoretemper_stop_obj, sensorcoretemper_stop); STATIC const mp_rom_map_elem_t sensorcoretemper_module_globals_table[] = { { MP_ROM_QSTR(MP_QSTR___name__), MP_ROM_QSTR(MP_QSTR_sensorcoretemper) }, { MP_ROM_QSTR(MP_QSTR_getT), MP_ROM_PTR(\u0026amp;sensorcoretemper_getT_obj) }, { MP_ROM_QSTR(MP_QSTR_init), MP_ROM_PTR(\u0026amp;sensorcoretemper_init_obj) }, { MP_ROM_QSTR(MP_QSTR_stop), MP_ROM_PTR(\u0026amp;sensorcoretemper_stop_obj) }, }; STATIC MP_DEFINE_CONST_DICT(sensorcoretemper_module_globals, sensorcoretemper_module_globals_table); const mp_obj_module_t sensorcoretemper_user_cmodule = { .base = { \u0026amp;mp_type_module }, .globals = (mp_obj_dict_t *)\u0026amp;sensorcoretemper_module_globals, }; //MP_REGISTER_MODULE(MP_QSTR_sensorcoretemper, sensorcoretemper_user_cmodule, MODULE_sensorcoretemper_ENABLED); MP_REGISTER_MODULE(MP_QSTR_sensorcoretemper, sensorcoretemper_user_cmodule); 其他三个文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 cd ~/mpy-bin/micropython-1.22.1/ports/esp32 mkdir -p cmodules/sensorcoretemper # 文件 ===\u0026gt; micropython.cmake cat \u0026gt; cmodules/micropython.cmake\u0026lt;\u0026lt; \\EOF # Add sensorcoretemper. include(${CMAKE_CURRENT_LIST_DIR}/sensorcoretemper/micropython.cmake) EOF # 文件 ===\u0026gt; micropython.cmake cat \u0026gt; cmodules/sensorcoretemper/micropython.cmake \u0026lt;\u0026lt; \\EOF # Create an INTERFACE library for our C module. add_library(usermod_sensorcoretemper INTERFACE) # Add our source files to the lib target_sources(usermod_sensorcoretemper INTERFACE ${CMAKE_CURRENT_LIST_DIR}/sensorcoretemper.c ) # Link our INTERFACE library to the usermod target. target_link_libraries(usermod INTERFACE usermod_sensorcoretemper) EOF # 文件 ===\u0026gt; micropython.mk cat \u0026gt; cmodules/sensorcoretemper/micropython.mk\u0026lt;\u0026lt; \\EOF sensorcoretemper_MOD_DIR := $(USERMOD_DIR) # Add all C files to SRC_USERMOD. SRC_USERMOD_C += $(sensorcoretemper_MOD_DIR)/sensorcoretemper.c EOF 编译 1 2 3 make clean BOARD=LOLIN_S2_MINI USER_C_MODULES=../cmodules/micropython.cmake #esp32-s2 make submodules make BOARD=LOLIN_S2_MINI USER_C_MODULES=../cmodules/micropython.cmake 使用方法 1 2 3 4 5 6 7 8 import sensorcoretemper import time sensorcoretemper.init() for _ in range(10): print(sensorcoretemper.getT()) time.sleep(1) sensorcoretemper.stop() 技巧 内置传感器温度 通常比环境温度高1-3摄氏度不等，在稳定的环境中 可以简单校准一下作为参考温度\n","date":"2024-01-22T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/mcu/esp32-s2-coretemp/","title":"esp32 s2 C3 在micropython下使用内置温度传感器"},{"content":"截止2024年1月15日 有效\n需要的工具 1：深蓝词库转换 https://github.com/studyzy/imewlconverter\n2：rose https://github.com/nopdan/rose\n细胞词库 fctix5 pinyin输入法 可以直接导入搜狗细胞词库 不用额外处理。如果要导出rime支持的格式 可以用深蓝词库工具转\n个人词库 fcitx5 fcitx5 的个人词库 在 ~/.local/share/fcitx5/pinyin/user.dict 这个文件 使用命令 ： libime_pinyindict -d \u0026quot;user.dict\u0026quot; \u0026quot;user.dict.txt\u0026quot; 可以导出为txt 格式为 没满 mei'man 0 即 汉字 拼音 词频 三者用空格分割 拼音用\u0026rsquo;分割\n1 2 3 cd ~/.local/share/fcitx5/pinyin libime_pinyindict -d \u0026#34;user.dict\u0026#34; \u0026#34;user.dict.txt\u0026#34; #dict 到 txt libime_pinyindict \u0026#34;词库文件.txt\u0026#34; \u0026#34;词库文件.dict\u0026#34; # txt到dict 搜狗 搜狗的个人词库导出后是加密的bin格式，目前深蓝不能识别rose 可以识别到\n转换 搜狗 到 fcitx5 pinyin 使用 rose 转换搜狗导出的个人词库文件到 随便一种格式，可以使用百度拼音txt的格式 和 user.dict.txt的格式一样 也可以用就用sogou txt格式，然后用深蓝转换工具自定义格式转换user.dict.txt 的格式，最后运行上面的libime_pinyindict命令替换 \u0026ldquo;user.dict\u0026rdquo; 。\n如果不需要编辑，windows下sogou输入法导出再次导入一次个人词库，会在 C:\\Users\\XXXX\\AppData\\LocalLow\\SogouPY.users\\XXXX\\scd\\tmp 下找到对应的细胞词库\n搜狗 到 fcitx5 rime 到rime的和 pinyin的一样\nfcitx5 pinyin 到 sogou pc版 目前搜狗输入法直接导入txt 是无法合并到用户词库的，但是可以被导入到细胞词库。 使用 rose 转换 \u0026ldquo;user.dict.txt\u0026rdquo; 到 纯词组，或者用深蓝转换为只有词库 也可以。然后在windows下搜狗输入法里面导入txt即可。同时 会在 C:\\Users\\XXXX\\AppData\\LocalLow\\SogouPY.users\\XXXX\\scd\\tmp 下找到词库文件\n手机版暂时没有办法直接导入，只能使用一段时间后词库自动同步到手机上。\n","date":"2024-01-15T22:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/fctix5-sogou/","title":"fctix5和搜狗输入法的个人词库转换"},{"content":"jwt是优秀的无状态服务的身份验证方法。但是jwt有一个小缺点就是字符串太长，在物联网设备中占用宝贵的储存空间。\n所以有一些场景下不适合。 这里分享一种 类似jwt的轻量token实现方法。\n几个元素 1、身份标识：一般是物联网设备的串号、mac地址 或者其他的唯一id。下文中以mac地址为例 2、过期时间: 明文用时间戳即可，考虑到时间戳 1703981684 前面的17最近几年不会变化。也可以直接用 03981684。或者干脆为 202312311023 这种格式，然后去掉前面的20，即2312311023 代23年12约32日10点23分过期 3、长短token： 一般jwt中应用存在两个token 一个token同于频繁的通讯有效期通常是几分钟到几十分钟 称之为 accessToken ，另外一个token为长期token 用于更新token,有效期通常为几十天，称之为 refreshToken 4、盐值：因为我们简化了jwt 改为直接通过MAC地址的md5值来检查，所以需要引入一个salt来保证协议的安全性。每一个设备具有唯一的一个salt值。\n逻辑 因为物联网设备 不会要求用户去登陆注册，所以两个token的更新都是无感进行的。\n设备首次联网，使用设备MAC地址向 jwt-lite 服务器请求，jwt-lite检索数据库，确定mac地址在白名单中，那么发放两个token,格式为均为 过期时间+md5(过期时间+MAC+salt)，其中 refreshToken 可以写入到设备的flash中，而accessToken 就暂存到ram 掉电即丢弃。\n设备重新通电后，检查 refreshToken 是否将要过期或者是否存在，然后根据需要使用mac地址重新请求accessToken 和 refreshToken。随后改为定时检查\n设备运行过程中，定时检查/或者每次要和服务器交互之前先检查 accessToken （和 refreshToken） 。 如果 accessToken 将要过期，但是 refreshToken 没问题，那么使用refreshToken重新请求accessToken。 refreshToken 则另外的定时逻辑处理。\n加密 因为物联网设备 出厂的时候，每个设备我们可以预设一个加密key。所以上面的 过期时间+md5(过期时间+MAC+salt) 我们可以使用对称加密算法例如AES 加密一下 预防恶意第三方。当然实际意义不大。如果不考虑服务器端压力，私有协议 over tls或https 更为合理。\n物联网设备端 物联网设备端，因为都是基本可信客户端，可以去掉refreshToken，只使用accessToken 并适当延长 accessToken的有效期 一般为几十分钟。\napp端/web端 可以用同样的方法\n安全防护 降低服务器校验开支 无状态服务器 通过redis或者内存map 维护一个 已经验证过的token list 和对应过期时间，避免每次都校验token。\n这个list要定时维护清理，避免占用过多资源。\n黑名单token回收已签发的token 同时维护一个黑名单token,手动或者自动，加入黑名单。\n避免被反射攻击 和协议本身以及upd/tcp无关，需要在isp或者iptable处理。\nSYN Flood、ACK Flood、TCP反射、UDP Flood、UDP反射 是常见的被攻击的方式。当然这和你用什么协议无关，只要是基于tcp/udp 就要面对这些。首先要想办法避免自己成为反射角色，其次要预防常见的反射攻击。 现在 主要的的反射源有 : DNS、NTP、SSDP、QOTD、SNMP、CHARGEN、LDAP、MEMCACHE、WS-DISCOVERY、DVR、CLDAP、RPC 等 主要反射源端口，基本都是上述协议的默认端口。 一般在入口流量的地方 通过白名单ip+端口 以及 指纹分析 和 带宽弹性部署 以及 eip切换 来应对\n避免被自己放大攻击 在token未校验通过/不符合格式 的返回的错误消息体尽可能简短，或者直接不返回。\n配合黑名单制度，即使把请求异常的token加入到黑名单\n","date":"2023-12-31T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/lot/jwt-lite/","title":"私有协议的轻量jwt-token的实现，物联网设备"},{"content":"2024-03-7 已经有原生版微信，虽然目前之支持uos和麒麟等系统，实际上其他系统也可以用。\n2022年12月07日 腾讯已经发布新版linux qq linux使用微信 只有wine 和 仿uos web微信 两种。\nwine方式的微信功能更全一些，比如支持多数小程序支持朋友圈。但是也比较卡，而且需要wine。\n我的几个微信号，都登陆过web微信，但是都是后期无法使用。而且我微信主要是工作文字交流和小文件手法。web微信足够使用。所以寻找web微信的登陆方式。\n通过逆向uos版本微信，可以得知： 微信给uos那边适配web微信使用了简单区分的方式，就是在header里面添加了两个字段 。 这两个字段都是是静态的，而且都放到了同一个so文件里面，只做了字符串混淆，混淆还是最简单的 xor。或许这是适配uos的程序员的良心。 最后整理得到两个header内容如下\n1 2 3 client-version = 2.0.0 extspam = Go8FCIkFEokFCggwMDAwMDAwMRAGGvAESySibk50w5Wb3uTl2c2h64jVVrV7gNs06GFlWplHQbY/5FfiO++1yH4ykCyNPWKXmco+wfQzK5R98D3so7rJ5LmGFvBLjGceleySrc3SOf2Pc1gVehzJgODeS0lDL3/I/0S2SSE98YgKleq6Uqx6ndTy9yaL9qFxJL7eiA/R3SEfTaW1SBoSITIu+EEkXff+Pv8NHOk7N57rcGk1w0ZzRrQDkXTOXFN2iHYIzAAZPIOY45Lsh+A4slpgnDiaOvRtlQYCt97nmPLuTipOJ8Qc5pM7ZsOsAPPrCQL7nK0I7aPrFDF0q4ziUUKettzW8MrAaiVfmbD1/VkmLNVqqZVvBCtRblXb5FHmtS8FxnqCzYP4WFvz3T0TcrOqwLX1M/DQvcHaGGw0B0y4bZMs7lVScGBFxMj3vbFi2SRKbKhaitxHfYHAOAa0X7/MSS0RNAjdwoyGHeOepXOKY+h3iHeqCvgOH6LOifdHf/1aaZNwSkGotYnYScW8Yx63LnSwba7+hESrtPa/huRmB9KWvMCKbDThL/nne14hnL277EDCSocPu3rOSYjuB9gKSOdVmWsj9Dxb/iZIe+S6AiG29Esm+/eUacSba0k8wn5HhHg9d4tIcixrxveflc8vi2/wNQGVFNsGO6tB5WF0xf/plngOvQ1/ivGV/C1Qpdhzznh0ExAVJ6dwzNg7qIEBaw+BzTJTUuRcPk92Sn6QDn2Pu3mpONaEumacjW4w6ipPnPw+g2TfywJjeEcpSZaP4Q3YV5HG8D6UjWA4GSkBKculWpdCMadx0usMomsSS/74QgpYqcPkmamB4nVv1JxczYITIqItIKjD35IGKAUwAA== 另外一点就是登陆地址要用 https://wx.qq.com/?\u0026amp;lang=zh_CN\u0026amp;target=t 多一个\u0026amp;target=t\n找一个支持浏览器header修改的扩展，适配wx.qq.com这个域名 添加上面两个字段即可。 web微信只有登陆的时候会校验这个字段，后面使用的时候不会再检查，所以只需匹配url:https://wx.qq.com/cgi-bin/mmwebwx-bin/webwxnewloginpage\n有可能需要登陆一次微信网页文件传输助手后才可以https://filehelper.weixin.qq.com/ 登陆一次即可，以后推出也不影响。 如果依旧不行，可以虚拟机装一个uos 先去uos下试试是否可以。\n也可以用现成的扩展： https://github.com/lqzhgood/wechat-need-web/releases\n下载chrom.zip 解压，然后打开（chrome/edge）浏览器插件管理,勾选开发者模式，选择加载已经解压的扩展目录。 不用任何配置即可使用。\nlinux下edge升级 有可能自己删掉这种自己手动加载的扩展，需要自己重新再安装一次扩展。\n同样的扩展有：https://github.com/adamyi/wechrome\nMonkey脚本版本：https://greasyfork.org/en/scripts/456545-wechromium-%E5%BE%AE%E4%BF%A1%E7%BD%91%E9%A1%B5%E7%89%88-%E7%BD%91%E9%A1%B5%E7%89%88%E5%BE%AE%E4%BF%A1-linux%E5%BE%AE%E4%BF%A1/\nelectron 版本： 另外有一个类似方式实现的已经打包好的 xchat https://github.com/xYx-c/xchat （基于electron+react 不是很建议，功能比web微信有缺失，偶尔卡顿丢消息）\n另外 基于 wechaty-puppet-wechat 的也很多\n注意 使用上面的方式，很有可能在数天/数周后被疼逊警告使用了第三方工具。也有人反馈说会被封号。\n另外绑定境外手机号的微信无法使用web微信，在转到wechat的时候有条款提醒的哦。\n","date":"2023-12-26T22:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/wechat-web/","title":"linux下使用web微信的奇技淫巧"},{"content":"业务发展到一定规模后，mqtt/coap协议无法满足需求，所有私有协议势在必行。\n现有私有协议 兼通 udp tcp 以及 http websocker\n协议中有一部分，需要兼顾可读性和降低带宽占用。所以简单使用特殊字符串分割的方式来表达。 例如： usename|password\n但是在url传输中分割符号需要考虑一下应该如何选择。\nurl参数中可字符串有\n1 2 3 4 5 6 7 8 # 特殊含义的字符 这些不能放到参数值内 ; / ? : @ \u0026amp; = + $ , 「10个」 # 非保留字符集 部分位置不允许出现，但是参数内部可用 - _ . ! ~ * \u0026#39; ( ) 「9个」 # 避免使用的 因为网路中部分网关会使用所以需要转义 { } | \\ ^ [ ] 「8个」 # 其他由ASCII控制字符 \u0026lt; \u0026gt; # % \u0026#34; 空格 encodeURI 方法不会对ASCII字母、数字、!@#$\u0026amp;*()=:/,;?+\u0026rsquo; 编码。 encodeURIComponent 方法不会对ASCII字母、数字、!*()\u0026rsquo; 编码。\n另外需要考虑的因素\n1、redis中keyname的分隔符我们常用「:」冒号来处理 2、base64url中 会使用 _ - 所以分隔符的选择就只剩下 . ! ~ * ' ( ) 按照兼容性考虑可选字符顺序：\n为了能在协议中传输带小数的数据，所以 「.」 也不能用 又剩下 ! ~ * ' ( ) 而 「\u0026rsquo;」在部分安全防护产品中会认为sql注入符，所以最好也不用 又剩下 ! ~ * ( ) 「~」在部分编程语言中会被编码成 %7e 又剩下 ! * ( ) 「*」在部分系统里面会被认作保留字符 又剩下 ! ( ) 「()」本身可以做为包裹数据使用 所以只剩下 ! 所以通常来说 ，所以选择用!来做非协议字段分隔符 *做为:的替代符(实践中选择key不会存在的字符串替代，例如：AA / O0O)\n","date":"2023-12-26T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/lot/privateprotocoldelimiter/","title":"私有协议分隔符，即url参数可用的分隔符"},{"content":"在跨云异地多活部署遇到的最大的两个问题 1 是复杂度 2是成本。 一个项目想达到99.9%的高可用性，并且不依赖云厂商还是非常困难。 异地多活有很多实现方法，下面分享一种 较为简单并尽可能的降低成本的方案。以阿里云 腾讯云 华为云，分别 上海 广州 北京 三城。以阿里（上海）和腾讯（广州）为主，华为为辅。\n下文中所有的redis所指均为keydb6.x。\n主要内容 负载均衡 路由层 业务层 缓存层 数据层 定时备份\n负载均衡和路由层 因为非传统web项目，有客户端，这部分内容集成到客户端。由客户端根据预置规则选择 请求到某一个机房。\n业务层 要全部改造为无状态服务， 部分业务需要完全兼容华为/阿里/腾讯的函数计算，并在对应的云厂商和自己的机器上都有部署。 部分业务有读写冲突的情况，虽然多活部署，但是使用消息中间件确保只有一个实例处在运行状态，其他实例等待抢占上位。\n缓存层和数据层 应用层对数据库的读写 都在redis中，少数在pgsql。pgsql的数据只作为分析和统计使用。 其他需要储存的数据采用云厂商的对象储存。（要优化一下）\nredis 使用多个集群 核心集群跨云跨机房 读多写少全局写入集群 储存核心数据 至少3主三从分散部署到 三云三城市。\n核心数据主要用于储存一些增长缓慢但是读取频繁的数据。例如 用户信息 物联网设备配置信息等。\n为了防止频繁跨云读取，应用层需要针对性的做一些改造，针对读写非常频繁的数据，本地机房应该开一个redis实例来缓存核心集群的数据降低核心集群压力。\n1、应用层在启动的时候从redis按需要读取数据到本地全局map，并在每次处理请求的时候或者用定时器/消息订阅等方式来判断是否需要重新从redis读取数据。\n2、对读取非常频繁的数据，需要在本机机房搭建一个redis实例用来作为核心集群的从库，核心集群的部分数据，降低核心集群压力，并降低核心集群公网通讯开支。\n3、应用层在写入数据的是，需要按需判断本地redis同步库是否已经同步成功。\n机房内部缓存 读缓存 上文已经提到，机房内应该增加至少一个redis实例或者集群，用来作为核心集群的从库，作为本地部分数据的读取使用。以降低核心集群的公网通讯开支。\n一致性要求非常高的数据，依旧是从核心集群读取。\n写缓存的实现 一致性要求不高的数据，写入到本地的redis集群，并安需定时同步到核心集群。例如：设备的在线状态和传感器数据（容许1-2秒延迟，故障时容许10-15秒延迟）\n需要落地持久化的数据，并容许短时间丢失的数据（设备传感器的历史数据容许丢失3-5分钟的）先写入到本地的keydb 开启flash持久化，并定时同步flash文件和rdb aof文件到 本云的对象储存（因为数据庞大，后文针对此方案做了进一步优化降低开支）。 一致性要求高的数据，直接写入到核心集群。\nredis同步 除了redis cluster之外使用阿里的RedisShake来做单向同步。\npgsql 时序数据/kv持久化储存 实现 项目以写为主，读取较少，所以这里直接使用keydb替代redis。同时部署多个集群来作为纯redis 和kv硬盘储存使用。\n没有引入时序数据库，是因为数量没有那么庞大，keddb的flash方案可以满足。\n容灾和数据合并 数据合并 因为此项目的这部分数据都是基于设备或用户的，所以同一个设备和同一个数据的历史数据可以合并到同一个key里面 以减少RocksDB（keydb的flash功能基于RocksDB）的小文件数量降低对象储存成本。\n通过k8s/swarm 在阿里云和腾讯云分别 分别部署一个实例。两个实例先查询本地要处理的数据量，并协商以数据量较多的为主实例。两个实例分别合并前一天的历史数据到数组/map ，主实例在处理的时候询问从实例是否有同一个设备/用户的数据，如果有数据交付给主实例处理。如果没有从实例自己处理。 阿里云走内网数据持久到oss 腾讯云云走内网数据持久化到cos。另外一台不限制带宽的服务器同步合并两家对象储存数据保持一致。\n查询的时候，当日数据从keydb查询，前一日数据从对象储存查询。\n负载均衡和历史数据的处理 设备和app的负载均衡 设备实时数据 接受的应用层 分别部署到阿里云和腾讯云的多台机器上，由客户端先询问服务上的入口应用程序自己应该请求那台服务，并在一定周期内（未断电重启）持续请求这台服务。如果对应的机器负载较大，会通知客户端更换一个别的地址，或者地址连不同的时候客户端也会更换一个地址。（用户的app同样的规则）\n数据的储存 实时数据 因为容许部分数据丢失，所以实时数据由对应的devConn服务直接储存到map，而不写入redis。用户端app在查询的时候，会先根据核心redis的从库中的对应设备的记录获取对应设备的服务器地址，直接查询map.\n历史数据 实时数据需要及时落盘，容许丢失一小部分，但是不能产生大量碎文件，不然会导致后续储存费用太高。\n为了降低io,由devConn自己处理储存问题。储存后如何同步到云储存参考上文。\n其他 推荐阅读 http://kaito-kidd.com/2021/10/15/what-is-the-multi-site-high-availability-design/\n","date":"2023-12-20T18:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/mcloud/","title":"低成本高可用性异地多活跨云部署方案"},{"content":"redis的Cluster集群去中心化，以及高可用和高弹性部署的优势，成为3节点以上redis必选的集群方案。 keydb兼容redis6.x,并提供比redis性能更好多核优化。另外keydb支持flash储存模式和热数据内存储存，也成为大容量kv数据库的一个优先考虑方案。\n最近几年云厂商频繁故障，也促使大家开始只使用云厂商的基础服务（主机）而更多的开始选择跨云跨地区部署。\n而redis的Gossip协议此时会占用大量金贵的公网带宽\nGossip消息有多大会占用多大带宽 Redis 实例发送的 PING 消息的消息体是由 clusterMsgDataGossip 结构体组成的。\n1 2 3 4 5 6 7 8 9 10 typedef struct { char nodename[CLUSTER_NAMELEN]; //40字节 uint32_t ping_sent; //4字节 uint32_t pong_received; //4字节 char ip[NET_IP_STR_LEN]; //46字节 uint16_t port; //2字节 uint16_t cport; //2字节 uint16_t flags; //2字节 uint32_t notused1; //4字节 } clusterMsgDataGossip; 一个 Gossip 消息的大小了，即 104 字节。 每个实例在发送一个 Gossip 消息时，除了会传递自身的状态信息，默认还会传递集群十分之一实例的状态信息。 所以，对于一个包含了 1000 个实例的集群来说，每个实例发送一个 PING 消息时，会包含 100 个实例的状态信息，总的数据量是 10400 字节，再加上发送实例自身的信息，一个 Gossip 消息大约是 10KB。 此外，为了让 Slot 映射表能够在不同实例间传播，PING 消息中还带有一个长度为 16,384 bit 的 Bitmap，这个 Bitmap 的每一位对应了一个 Slot，如果某一位为 1，就表示这个 Slot 属于当前实例。这个 Bitmap 大小换算成字节后，是 2KB。我们把实例状态信息和 Slot 分配信息相加，就可以得到一个 PING 消息的大小了，大约是 12KB。 PONG 消息和 PING 消息的内容一样，所以，它的大小大约是 12KB。每个实例发送了 PING 消息后，还会收到返回的 PONG 消息，两个消息加起来有 24KB。 如果实例正常处理的单个请求只有几 KB 的话，那么，实例为了维护集群状态一致传输的 PING/PONG 消息，就要比单个业务请求大了。而且，每个实例都会给其它实例发送 PING/PONG 消息。随着集群规模增加，这些心跳消息的数量也会越多，会占据一部分集群的网络通信带宽，进而会降低集群服务正常客户端请求的吞吐量。\n通讯频率 Redis Cluster 的实例启动后，默认会每秒从本地的实例列表中随机选出 5 个实例，再从这 5 个实例中找出一个最久没有通信的实例，把 PING 消息发送给该实例。这是实例周期性发送 PING 消息的基本做法。 这有可能会出现，有些实例一直没有被发送 PING 消息，导致它们维护的集群状态已经过期了。 为了避免这种情况，Redis Cluster 的实例会按照每 100ms 一次的频率，扫描本地的实例列表，如果发现有实例最近一次接收 PONG 消息的时间，已经大于配置项 cluster-node-timeout 的一半了（cluster-node-timeout/2），就会立刻给该实例发送 PING 消息，更新这个实例上的集群状态信息。 我们来总结下单实例每秒会发送的 PING 消息数量，如下所示：\nPING 消息发送数量 = 1 + 10 * 实例数（最近一次接收 PONG 消息的时间超出 cluster-node-timeout/2）\n假设单个实例检测发现，每 100 毫秒有 10 个实例的 PONG 消息接收超时，那么，这个实例每秒就会发送 101 个 PING 消息，约占 1.2MB/s 带宽。如果集群中有 30 个实例按照这种频率发送消息，就会占用 36MB/s 带宽，这就会挤占集群中用于服务正常请求的带宽。\n如何降低实例间的通信开销 我们现在知道，实例间发送消息的频率有两个。\n每个实例每 1 秒发送一条 PING 消息。 这个频率不算高，如果再降低该频率的话，集群中各实例的状态可能就没办法及时传播了。\n每个实例每 100 毫秒会做一次检测，给 PONG 消息接收超过 cluster-node-timeout/2 的节点发送 PING 消息。\n实例按照每 100 毫秒进行检测的频率，是 Redis 实例默认的周期性检查任务的统一频率，我们一般不需要修改它。\n配置项 cluster-node-timeout 定义了集群实例被判断为故障的心跳超时时间，默认是 15 秒。如果 cluster-node-timeout 值比较小，那么，在大规模集群中，就会比较频繁地出现 PONG 消息接收超时的情况。 为了避免过多的心跳消息挤占集群带宽，我们可以调大 cluster-node-timeout 值，比如说调大到 20 秒或 25 秒。这样一来， PONG 消息接收超时的情况就会有所缓解，单实例也不用频繁地每秒执行 10 次心跳发送操作了。 如何验证 为了验证调整 cluster-node-timeout 值后，是否能减少心跳消息占用的集群网络带宽，我给你提个小建议：你可以在调整 cluster-node-timeout 值的前后，使用 tcpdump 命令抓取实例发送心跳信息网络包的情况。 执行下面的命令后，我们可以抓取到 192.168.10.3 机器上的实例从 16379 端口发送的心跳网络包，并把网络包的内容保存到 r1.cap 文件中： bash复制代码tcpdump host 192.168.10.3 port 16379 -i 网卡名 -w /tmp/r1.cap\n通过分析网络包的数量和大小，就可以判断调整 cluster-node-timeout 值前后，心跳消息占用的带宽情况了。\n关于Codis Codis采取单独管理Slot的 以及作为redis的一个前端代理的方式可以不使用Gossip协议，所以没有这部带宽占用。但是codis已经很久不维护，并且引入了中间件以后会降低整体性能。 所以最好的方法 还是 1、控制集群实例的数量 2、调大cluster-node-timeout 值并做好集群故障/脑裂的自愈\n","date":"2023-12-19T18:14:20+08:00","permalink":"https://dev.leiyanhui.com/redis/gossipoptimization/","title":"redis集群Gossip协议占用带宽过大的优化"},{"content":"添加界面，告知工单申请，工单申请后告知 您好。非常抱歉。ipv6回源目前已不支持。不过您通过EO（边缘安全加速平台）接入\n真的佩服昂！\n没有任何提前通知，直接给关掉了！\n","date":"2023-12-05T18:14:20+08:00","permalink":"https://dev.leiyanhui.com/c/tencent-cdn/","title":"腾讯cdn在无任何通知的情况下直接关闭了ipv6回源"},{"content":"选型 业务类型 允许短时间（数秒内）部分业务中断，不允许超过1分钟以上的故障。 现有服务 多为无状态服务，一部分为半无状态，另外有redis和pgsql 。 服务器 目前共有 12台 目前10台在线 2台冗余热备。主要是阿里云和腾讯云，另有两台异地pve。\n首先说，服务器有一些本身是云厂商的活动价格购入的，配置2H2G那种。k8s肯定是不适合，太重。k3s只能说是空服务的是内存占用可以（本身512M左右内存），开启服务后和k8s并没有明显有时。\n除去性能的占用，k8s/k3s集群公网通讯开支较大。容器数量只有几十个，机器不到10台，所以无论如何Kubernetes都不适合目前的场景。\n其次考虑到 mesos,无奈了解太少，加上过于非主流了，所以没有去尝试。\n然后目光就投到了 docker swarm。\ndocker swarm 优势 硬件资源占用很低，cpu和内存占用可以忽略不计 节点之间公网通讯带宽占用在10-几十K，可以忽略不计。 原docker/podman容器迁移成本时间成本极低，毕竟docker自家的，docker compose yml略微修改就可以。 partainer 够轻量，够直观，也足够docker swarm的图形化管理（毕竟有时候还是需要直观的查看的服务的分布情况） docker swarm 的缺点 只针对目前项目的情况的一些看法\n日后迁移云k8s需要二次折腾，目前主流云厂商都放弃了docker swarm 可能B格不够 有人为阻力 服务的处理 半无状态服务（弱持久化储存依赖的） 无状态服务没啥可说的，但是有一些半无状态的服务，需要存取数据。在从手动管理docker升到swarm的时候需要简单处理一下。\n尽可能 使用constraint参数 把服务分布指定的某台或某组机器上。 使用云储存，在云主机上使用内网读写对应的数据。 有状态服务redis/mysql 项目里面存在3个redis集群 一个pgsql主从。\n原则上 尽可能的使用云厂商的，不自建。非要自建的情况参考下文 使用constraint参数 把服务分布指定的某台或某组机器上。 读写不频繁的文件，例如redis的 rdb/aof 直接到云储存上。 读写频繁但是可用性要求不高的文件，直接落地到机器的硬盘上，然后定时同步到云储存。 读写频繁并且可用性要求高的文件，直接落地云储存或者直接用云厂商的服务。比如pgsql 实践 配置项目 尽可能使用环境变量，直接到swarm的服务里面。 配置项目 只能使用配置文件的，配置文件到云储存。使用 docker rclone插件，直接绑定到docker卷。 嵌入式kv，写频繁但是允许短时间丢失的，落地硬盘，并定时同步到的云储存。 redis持久化文件 使用 docker rclone插件，直接绑定到docker卷。 ","date":"2023-12-03T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/multcloud/","title":"跨云集群管理 k8s/k3s/docker swarm /apache mesos 选型和总结"},{"content":"使用 ForEachMaster 即可，如果从Slave获取有可能会有重复的需要另外去重。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func GetKeysWithPrefixForCluster(rdb redis.ClusterClient, ctx context.Context, prefix string) (keys []string, err error) { // 从所有主节点中依次获取 err = rdb.ForEachMaster(ctx, func(ctx context.Context, shard *redis.Client) (err error) { thisKeys, err := shard.Keys(ctx, prefix+\u0026#34;*\u0026#34;).Result() if err != nil { return err } keys = append(keys, thisKeys...) return nil }) if err != nil { log.Println(\u0026#34;GetKeysWithPrefixForCluster err:\u0026#34;, err) return keys, nil } //keys=unique(keys) return keys, nil } 去重复\n1 2 3 4 5 6 7 8 9 10 11 func unique(slice []string) []string { keysMap := make(map[string]bool) var uniqueKeys []string for _, entry := range slice { if _, value := keysMap[entry]; !value { keysMap[entry] = true uniqueKeys = append(uniqueKeys, entry) } } return uniqueKeys } ","date":"2023-11-30T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/getkeyswithprefixforcluster/","title":"golang 从redis cluster获取所有keys"},{"content":"先测试触发器 https://api.aliyun.com/api/FC/2023-03-30/GetTrigger?useCommon=true\n得到\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 { \u0026#34;triggerName\u0026#34;: \u0026#34;h t t p\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;openapi控制\u0026#34;, \u0026#34;triggerId\u0026#34;: \u0026#34;XXXXXX\u0026#34;, \u0026#34;sourceArn\u0026#34;: null, \u0026#34;triggerType\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;invocationRole\u0026#34;: null, \u0026#34;qualifier\u0026#34;: \u0026#34;LATEST\u0026#34;, \u0026#34;triggerConfig\u0026#34;: \u0026#34;{\\\u0026#34;methods\\\u0026#34;:[\\\u0026#34;GET\\\u0026#34;,\\\u0026#34;POST\\\u0026#34;,\\\u0026#34;PUT\\\u0026#34;,\\\u0026#34;DELETE\\\u0026#34;],\\\u0026#34;authType\\\u0026#34;:\\\u0026#34;anonymous\\\u0026#34;,\\\u0026#34;disableURLInternet\\\u0026#34;:false}\u0026#34;, \u0026#34;createdTime\u0026#34;: \u0026#34;2023-11-28T23:16:27Z\u0026#34;, \u0026#34;lastModifiedTime\u0026#34;: \u0026#34;2023-11-28T23:22:11Z\u0026#34;, \u0026#34;status\u0026#34;: null, \u0026#34;targetArn\u0026#34;: null, \u0026#34;httpTrigger\u0026#34;: { \u0026#34;urlInternet\u0026#34;: \u0026#34;https://X\u0026#34;, \u0026#34;urlIntranet\u0026#34;: \u0026#34;https://\u0026#34; } } 主要是 triggerConfig\n1 {\u0026#34;methods\u0026#34;:[\u0026#34;GET\u0026#34;,\u0026#34;POST\u0026#34;,\u0026#34;PUT\u0026#34;,\u0026#34;DELETE\u0026#34;],\u0026#34;authType\u0026#34;:\u0026#34;anonymous\u0026#34;,\u0026#34;disableURLInternet\u0026#34;:false} 获得golang 阿里云的这个地方 泛化调用方案（Common模式） 有bug 只能用 特化调用代码\n1 2 3 4 go get github.com/alibabacloud-go/fc-20230330/v3/client go get github.com/alibabacloud-go/darabonba-openapi/v2/client go get github.com/alibabacloud-go/tea-utils/v2/service go get github.com/alibabacloud-go/tea/tea 然后修改下面代码中的 TriggerConfig ，比如禁止公网访问 等\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 package main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; fc20230330 \u0026#34;github.com/alibabacloud-go/fc-20230330/v3/client\u0026#34; openapi \u0026#34;github.com/alibabacloud-go/darabonba-openapi/v2/client\u0026#34; util \u0026#34;github.com/alibabacloud-go/tea-utils/v2/service\u0026#34; \u0026#34;github.com/alibabacloud-go/tea/tea\u0026#34; ) /** * 使用AK\u0026amp;SK初始化账号Client * @param accessKeyId * @param accessKeySecret * @return Client * @throws Exception */ func CreateClient (accessKeyId *string, accessKeySecret *string) (_result *fc20230330.Client, _err error) { config := \u0026amp;openapi.Config{ // 必填，您的 AccessKey ID AccessKeyId: accessKeyId, // 必填，您的 AccessKey Secret AccessKeySecret: accessKeySecret, } // Endpoint 请参考 https://api.aliyun.com/product/FC config.Endpoint = tea.String(\u0026#34;X X X X X X X.cn-shanghai.fc.aliyuncs.com\u0026#34;) _result = \u0026amp;fc20230330.Client{} _result, _err = fc20230330.NewClient(config) return _result, _err } func _main (args []*string) (_err error) { // 请确保代码运行环境设置了环境变量 ALIBABA_CLOUD_ACCESS_KEY_ID 和 ALIBABA_CLOUD_ACCESS_KEY_SECRET。 // 工程代码泄露可能会导致 AccessKey 泄露，并威胁账号下所有资源的安全性。以下代码示例使用环境变量获取 AccessKey 的方式进行调用，仅供参考，建议使用更安全的 STS 方式，更多鉴权访问方式请参见：https://help.aliyun.com/document_detail/378661.html client, _err := CreateClient(tea.String(os.Getenv(\u0026#34;ALIBABA_CLOUD_ACCESS_KEY_ID\u0026#34;)), tea.String(os.Getenv(\u0026#34;ALIBABA_CLOUD_ACCESS_KEY_SECRET\u0026#34;))) if _err != nil { return _err } updateTriggerInput := \u0026amp;fc20230330.UpdateTriggerInput{ TriggerConfig: tea.String(\u0026#34;{\\\u0026#34;methods\\\u0026#34;:[\\\u0026#34;GET\\\u0026#34;,\\\u0026#34;POST\\\u0026#34;,\\\u0026#34;PUT\\\u0026#34;,\\\u0026#34;DELETE\\\u0026#34;],\\\u0026#34;authType\\\u0026#34;:\\\u0026#34;anonymous\\\u0026#34;,\\\u0026#34;disableURLInternet\\\u0026#34;:false}\u0026#34;), } updateTriggerRequest := \u0026amp;fc20230330.UpdateTriggerRequest{ Body: updateTriggerInput, } runtime := \u0026amp;util.RuntimeOptions{} headers := make(map[string]*string) tryErr := func()(_e error) { defer func() { if r := tea.Recover(recover()); r != nil { _e = r } }() // 复制代码运行请自行打印 API 的返回值 _, _err = client.UpdateTriggerWithOptions(tea.String(\u0026#34;FCNAME\u0026#34;), tea.String(\u0026#34;httpX X X X\u0026#34;), updateTriggerRequest, headers, runtime) if _err != nil { return _err } return nil }() if tryErr != nil { var error = \u0026amp;tea.SDKError{} if _t, ok := tryErr.(*tea.SDKError); ok { error = _t } else { error.Message = tea.String(tryErr.Error()) } // 错误 message fmt.Println(tea.StringValue(error.Message)) // 诊断地址 var data interface{} d := json.NewDecoder(strings.NewReader(tea.StringValue(error.Data))) d.Decode(\u0026amp;data) if m, ok := data.(map[string]interface{}); ok { recommend, _ := m[\u0026#34;Recommend\u0026#34;] fmt.Println(recommend) } _, _err = util.AssertAsString(error.Message) if _err != nil { return _err } } return _err } func main() { err := _main(tea.StringSlice(os.Args[1:])) if err != nil { panic(err) } } ","date":"2023-11-28T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/fc/ali-http-trigger/","title":"阿里云函数计算http触发器 操作接口实例"},{"content":"不支持跨站\n1 2 3 4 5 6 7 8 9 10 11 12 13 package main import webview \u0026#34;github.com/webview/webview_go\u0026#34; func main() { w := webview.New(false) defer w.Destroy() w.SetTitle(\u0026#34;Basic Example\u0026#34;) w.SetSize(480, 320, webview.HintNone) w.Navigate(\u0026#34;http://www.ip33.com/browser.html\u0026#34;) w.Run() } 编译\n1 go build -o \u0026#34;$(basename \u0026#34;$(pwd)\u0026#34;)_exe\u0026#34; *.go\u0026amp;\u0026amp; ls -lh *exe 跨平台编译貌似有问题\n","date":"2023-11-28T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/webview/","title":"golang 比较靠谱的 webview"},{"content":"在平铺桌面下 一般常用的 快捷调整窗口大小的快捷键，除了键盘调整之外，最常用的 win+鼠标右键\n但是gnome下 默认是 win+ 鼠标中键 刚刚切换到gnome后很不适应 调整起来比较吃力。\n两个解决方法\n1 gsettings set org.gnome.desktop.wm.preferences resize-with-right-button true 或者用 gnome-tweaks 选择 窗口 启用 副键调整窗口大小\n","date":"2023-11-27T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/gnome-resize-win/","title":"gnome调整窗口大小快捷修改 win+中键 改为 右键"},{"content":"分流说明 使用爱快分流规则 + 一个二级路由的方式 实现比旁路由模式更稳定 速度更快的 深度学习网络。\niKuai Bypass修改版 说明 项目地址 https://github.com/joyanhui/ikuai-bypass/\nfork 自 https://github.com/ztc1997/ikuai-bypass/\niKuai Bypass 功能 ip分流规则和域名分流规则添加到爱快的自定义运营商和域名分流，并自动更新规则文件。\n更新 并发处理 运营商/IP分流 和 域名分流 更新成功后再删除旧规则 支持无docker运行 支持单次运行参数-r nocron忽略配置文件的cron配置 支持单独清理模式-r clean 清理本工具添加的备注为IKUAI_BYPASS的分流规则 支持cron运行参数-r cron -r cronAft 命令 1 ikuai-bypass -c 配置文件路径 -r 运行模式 配置文件路径：默认为当前目录下的 config.yml 运行模式 cron 默认，会先执行一次然后使用配置文件的cron定时重复执行，如果cron为空那么执行依次后直接退出 cronAft 不马上执行,等到cron定时任务触发后再执行 nocron为单次执行 运行完成后自动推出 clean 清理本工具添加的备注为IKUAI_BYPASS的分流规则 通常使用方法 简单说明 建议在pve/esxi/unraid/群晖/docker/lxc/podman中运行爱快+openwrt，当然也可以物理设备。 单网卡 pve测试没问题，其他环境同样不会有问题。 爱快3个或者3个以上网卡/虚拟网卡 作为主路由\nopenwrt/其他linux 双网卡/虚拟网卡，作为下级路由（非旁路由）\npve下推荐配置 推荐 2G内存安装ikuai 32位版，硬盘1G即可，然后修改为 512M内存\nopenwrt 官方版，或者自编译版本 内存 256-512M（开clash要300M，v2系256M就可以） 硬盘512M即可，或者看你img的分区。或lxc运行\niKuai Bypass 运行在 openwrt mosdns 也可以运行在 openwrt mosdns all in one方案 modns配adg方案 64位 爱快，kvm/docker 运行 openwrt 和 iKuai Bypass 以及 mosdns 也可以，但是不推荐。\n物理网络/虚拟网卡配置 举例 爱快 lan1 绑定到 eth0 开DHCP dhcp范围 10.1.1.5-10.1.1.254\n爱快 wan1 绑定到 eth1 pppoe拨号 wan1先设置为默认线路 爱快 wan2 绑定到 eth2 静态ip指定 10.0.0.2 网关10.0.0.1\nopenwrt wan 绑定到eth1 DHCP客户端，连接到爱快lan1 从爱快静态ip绑定为10.1.1.3 openwrt lan 绑定套eth0 关闭DHCP服务，ip地址配置 10.1.1.1\n下文说配置都以上述为例\n避免死循环 爱快添加一个分流规则 流控分流 \u0026gt; 分流设置 \u0026gt; 端口分流\n分流方式：外网线路 线路：wan1 源地址 ip/mac分组 添加一个 10.1.1.3 点加入 保存\n此时 openwrt出来的流量 走wan1 不会再到wan2回到openwrt 导致死循环。\n此时openwrt 可以正常访问外部网络。\n配置 wan2 为默认线路 此时所有对外网访问 都会 经过wan2 到openwrt,然后根据你的深度学习软件的分流情况决定是否加密，再回到爱快的lan1 再流向外网。\n此时你的上网速度和传统的旁路由模式完全一样，略慢。\n配置国内域名强制走wan1直连 流控分流 \u0026gt; 分流设置 \u0026gt; 域名分流，选择wan1 ，输入几个域名，输入客户端ip,建议 10.1.1.5-10.1.1.254 ，此时10.1.1.5-10.1.1.254 的设备访问这个域名会直接走wan1 , 不经过openwrt，速度飞快。\n当然你自己输入太麻烦了。ikuai-bypass 可以自动帮你维护这个域名列表。\n配置某些域名强制走wan2 交给openwrt处理 目的是啥，你肯定知道。配置和上面一样，同样 ikuai-bypass 可以自动帮你维护这个域名列表。\n配置国内ip强制走wan1 因为域名清单里面的域名不能覆盖所有网站，还有一些是没有域名直接ip连接情况。所以需要维护一个根据ip分流的规则。\n流控分流 \u0026gt; 分流设置 \u0026gt; 多线负载 自定义运营商 添加运营商 名称：国内ip地址 目的地址：输入几个国内的ip,备注：自定义\n返回 流控分流 \u0026gt; 分流设置 \u0026gt; 多线负载 点右侧添加 运营商：选择你刚刚添加的名称，点wan1 后面的启用，保存。\n此时 你访问这个ip上的网站或者其他东西，会强制走wan1 不经过openwrt，速度飞快。 同样 ikuai-bypass 可以自动帮你维护这个IP地址列表。\n配置默认线路 确保网络100%可用性 把wan2 配置为默认线路，网络设置 \u0026gt; 内外网设置 wan2 同时打开\n默认网关：设此条线路为默认网关 自动切换：掉线自动切换 线路检测：HTTP www.google.com 此时，访问不在国内域名清单的域名，并且ip不再自定义运营商的国内ip地址的服务器，会默认走wan2。如果openwrt死机或者google连不上，会自动临时禁用wan2 默认走wan1。\n使用ikuai-bypass 自动维护ip和域名规则。 配置文件 需要自定义一个配置文件 config.yml 格式如下。\n然后运行 ./ikuai-bypass -c /路径/config.yml 即可在启动时候 自动更新一次规则文件，并在 cron指定的时间内定时运行。\n下面的配置文件 会执行一下操作\n自动登陆到 网址是 http://10.1.1.1 的爱快 使用用户名admin 密码 admin888登陆，如果登陆成功。 运营商/IP分流规则 他会帮你添加 一个 国内IP列表 的运营商，你需要去爱快 流控分流 \u0026gt; 分流设置 \u0026gt; 多线负载 添加规则，选择 国内IP列表 启用wan1\n也会添加几个 telegram google 等ip地址，你可以删掉那几行，也可以添加规则 启用wan2 另外会添加4个域名分流规则 分别强制走wan1 和wan2 你可以在下面配置文件清晰看到。需要注意的是 china-list 和 gfw两个清单 都很长，添加/更新的时候会很慢。你可以根据你的需求决定是否要保留，添加后会增加你访问网址的速度，但是会增加ikuai的性能消耗（大概增加30-120M内存消耗，cpu负载也会增加一点），如果你的ikuai配置很烂，可以去掉其他规则 只使用 国内IP列表 的IP分流即可 。 文件内容参考 https://github.com/joyanhui/ikuai-bypass/blob/main/config_example.yml\n部署ikuai-bypass ikuai-bypass 只要部署在可以访问到 爱快路由器的地方即可。\n下载最新版 https://github.com/joyanhui/ikuai-bypass/releases\n直接运行 1 ./ikuai-bypass_linux_amd64 -c /opt/ikuai-bypass/config_example.yml 服务模式 openwrt/alpine/rc/systemd 以openwrt为例\n1 2 3 4 5 6 7 8 cd /root wget https://github.com/joyanhui/ikuai-bypass/releases/download/v版本号/ikuai-bypass_v版本号_linux_amd64.tar.gz tar -zxvf ikuai-bypass*linux_amd64.tar.gz rm ikuai-bypass*linux_amd64.tar.gz # 默认配置文件 自己可以根据需求编辑一下 wget -c https://github.com/joyanhui/ikuai-bypass/raw/main/config_example.yml -O kuai-bypass.yml # 测试 /root/ikuai-bypass -c /root/kuai-bypass.yml 添加服务\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 cat \u0026gt;/etc/init.d/ikuai-bypass\u0026lt;\u0026lt; \\EOF #!/bin/sh /etc/rc.common #service startup sequence START=99 start() { #start your process with parameters in background /root/ikuai-bypass -c /root/kuai-bypass.yml \u0026amp; } stop() { killall ikuai-bypass } EOF chmod +x /etc/init.d/ikuai-bypass # 开机启动 service ikuai-bypass enable # 现在启动 service ikuai-bypass start #或者 /etc/init.d/ikuai-bypass start 重启 openwrt,然后shell运行 ps |grep ikuai-bypass 验证一下是否开机自动启动。\n如果不能自动启动，在系统 启动项 本地启动脚本 添加一行 放到 exit 0 前面\n1 sh -c \u0026#39;sleep 30 \u0026amp;\u0026amp; /etc/init.d/ikuai-bypass start \u0026#39; \u0026amp; docker 我没有打包docker镜像，因为完全没必要，你可以自己用下面的命令启动一个docker\n1 2 3 4 5 6 7 8 mkdir ~/ikuai-bypass/ \u0026amp;\u0026amp; cd ～/ikuai-bypass_exe wget -c https://github.com/joyanhui/ikuai-bypass/raw/main/ikuai-bypass_linux_amd64 chmod +x ./ikuai-bypass_linux_amd64 wget -c https://github.com/joyanhui/ikuai-bypass/raw/main/config_example.yml docker run -itd --name ikuai-bypass --privileged=true --restart=always \\ -v ~/ikuai-bypass/:/opt/ikuai-bypass/ \\ alpine:3.18.4 /opt/ikuai-bypass/ikuai-bypass_linux_amd64 -c /opt/ikuai-bypass/config_example.yml 如果你想部署到爱快内的docker里面 下载 alpine镜像，上传两个文件，然后入口 命令修改为 类似下面的命令即可\n1 chmod +x /opt/ikuai-bypass/ikuai-bypass_linux_amd64 \u0026amp;\u0026amp; /opt/ikuai-bypass/ikuai-bypass_linux_amd64 -c /opt/ikuai-bypass/config_example.yml 其他补充 自定义规则和ikuai-bypass的规则 ikuai-bypass 自动维护的规则 都会添加备注 IKUAI_BYPASS ，只要你添加的自定义的规则备注不是这个即可。\n关于实例配置文件 实例配置文件使用了 https://mirror.ghproxy.com 作为github的代理方便可以在无科学环境更新规则，但是ghproxy有被gfw污染的先例，请自行更新更稳定的或者自建的github代理。\n是否可以替代原版ikuai-bypass 可以直接替代，参考上面的docker配置\n","date":"2023-11-26T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/route/ikuai-bypass-joyanhui-old/","title":"爱快无感分流 自动更新规则 ikuai-bypass 修改版"},{"content":"atomic 某写操作在大并发的环境下 有一些差异。下文中 tttt1和 tttt3 是绝对安全的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 package main import ( \u0026#34;log\u0026#34; \u0026#34;runtime\u0026#34; \u0026#34;sync/atomic\u0026#34; \u0026#34;time\u0026#34; ) var ( NowtimeATO atomic.Int64 LastUpdateCfgATO atomic.Int64 UpdateCfgLock atomic.Int32 ) func main() { log.SetFlags(log.Lmicroseconds) NowtimeATO.Store(time.Now().Unix()) LastUpdateCfgATO.Store(NowtimeATO.Load()) var count int64 = 0 for { count++ for i := 0; i \u0026lt; 3000000; i++ { go tttt3(count) } time.Sleep(1 * time.Second) } } func tttt1(x int64) { NowtimeATO.Store(time.Now().Unix()) if NowtimeATO.Load()-LastUpdateCfgATO.Load() \u0026gt; 0 { //超过N秒 if UpdateCfgLock.CompareAndSwap(0, 1) { //如果是0 那么修改为1 如是0 否则不执行 LastUpdateCfgATO.Store(NowtimeATO.Load()) UpdateCfg(x) UpdateCfgLock.Store(0) } } time.Sleep(3 * time.Second) } func tttt2(x int64) { NowtimeATO.Store(time.Now().Unix()) if NowtimeATO.Load()-LastUpdateCfgATO.Load() \u0026gt; 0 { //超过N秒 LastUpdateCfgATO.Store(NowtimeATO.Load()) UpdateCfg(x) } time.Sleep(3 * time.Second) } func tttt3(x int64) { if time.Now().Unix()-LastUpdateCfgATO.Load() \u0026gt; 0 { //超过N秒 if UpdateCfgLock.CompareAndSwap(0, 1) { //如果是0 那么修改为1 如是0 否则不执行 LastUpdateCfgATO.Store(time.Now().Unix()) //极小概率和前面的不一致 UpdateCfg(x) UpdateCfgLock.Store(0) } } //time.Sleep(2000 * time.Microsecond) time.Sleep(3 * time.Second) } func UpdateCfg(x int64) { //log.Println(\u0026#34;val:\u0026#34;, UpdateCfgLock.Load(), \u0026#34;times:\u0026#34;, x) log.Println(\u0026#34;times:\u0026#34;, x, \u0026#34;NumGoroutine\u0026#34;, runtime.NumGoroutine()) } ","date":"2023-11-26T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/atomic-lastupdate/","title":"golang atomic和定时任务的思考"},{"content":"golang的base64url 有一个小坑。\nbase64.URLEncoding.EncodeToString 和 base64.URLEncoding.DecodeString 末尾会带 = 符号，和其他语言的定义不一样\n换成 base64.RawURLEncoding.EncodeToString 和 base64.RawURLEncoding.DecodeString 即可\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import \u0026#34;encoding/base64\u0026#34; func main() { var strToBase64UrlTest = \u0026#34;161\u0026amp;q=aes+发生的\u0026amp;cvid=对付对方\u0026amp;gs\u0026#34; base64urlStr := base64.URLEncoding.EncodeToString([]byte(strToBase64UrlTest)) println(base64urlStr) getStr, err := base64.URLEncoding.DecodeString(base64urlStr) if err != nil { panic(err) } println(string(getStr)) } 应该修改为\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import \u0026#34;encoding/base64\u0026#34; func main() { var strToBase64UrlTest = \u0026#34;161\u0026amp;q=aes+发生的\u0026amp;cvid=对付对方\u0026amp;gs\u0026#34; base64urlStr := base64.RawURLEncoding.EncodeToString([]byte(strToBase64UrlTest)) println(base64urlStr) getStr, err := base64.RawURLEncoding.DecodeString(base64urlStr) if err != nil { panic(err) } println(string(getStr)) } ","date":"2023-11-26T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/base64url/","title":"golang bas64url的小坑"},{"content":"redis公网集群指定了域名，但是在同局域网的客户端程序中，应该直接用内网ip连接。\n华为云那边可以直接在vpc的内网域名配置redis域名的ip,阿里云这边需要自建dns，本着服务之间尽量不耦合的原则，加上阿里云这边的函数计算实际是独立的hosts文件可以直接修改。\n下面算法，先用环境变量判断是否修改hosts文件（华为云fc没有修改权限），然后从redis中根据环境得到要修改的hosts内容。而后复制备份/etc/hosts 文件，创建一个新的hosts 然后合并两个文件。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 package lib_hosts import ( \u0026#34;bufio\u0026#34; \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;os\u0026#34; \u0026#34;regexp\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/buger/jsonparser\u0026#34; \u0026#34;github.com/redis/go-redis/v9\u0026#34; ) func UpdateHostsFileFormRedisAndLookupIP(rdb redis.ClusterClient, ctx context.Context) { EnvHostsTag := os.Getenv(\u0026#34;EnvHostsTag\u0026#34;) if EnvHostsTag == \u0026#34;\u0026#34; { log.Println(\u0026#34;== 不需要检查和修改 域名解析\u0026#34;) return } //是否更新 hosts文件，华为云那边不能修改，需要通过vpc的内网域名的A记录来控制 enableUpdataHostsFile := os.Getenv(\u0026#34;EnvHostsEndEnableUpdateFile\u0026#34;) == \u0026#34;1\u0026#34; //执行完成后是否ping一下 EnablePing := os.Getenv(\u0026#34;EnvHostsEndEnablePing\u0026#34;) == \u0026#34;1\u0026#34; val, err := rdb.Get(ctx, \u0026#34;f501:Config:/etc/hosts\u0026#34;).Result() if err != nil { log.Println(\u0026#34;UpdateHostsFileFormRedis f501:Config:/etc/hosts 错误！！！\u0026#34;, err) return } else { linesString, err := jsonparser.GetString([]byte(val), EnvHostsTag, \u0026#34;Lines\u0026#34;) if err != nil { log.Println(\u0026#34;UpdateHostsFileFormRedis 没找到相关信息 \u0026#34;, err) return } if enableUpdataHostsFile { UpdateHostsFile(linesString) //更新hosts文件 华为那边zip部署的fc不支持需要手动配置修改vpc } else { log.Println(\u0026#34;部分环境不启用/etc/hosts更新,如果要启动请 到redis修改...\u0026#34;) log.Println(\u0026#34;跳过/etc/hosts配置,你可能需要手动配置dns或vpc组网的内网域名的A记录 ...\u0026#34;) } if EnablePing { //执行ping命令 log.Println(\u0026#34;所有域名分别LookupIP ...\u0026#34;) time.Sleep(200 * time.Microsecond) re := regexp.MustCompile(`\\s+`) linesString = re.ReplaceAllString(linesString, \u0026#34; \u0026#34;) lines := strings.Split(linesString, \u0026#34;,\u0026#34;) for _, line := range lines { linesArr := strings.Split(line, \u0026#34; \u0026#34;) if len(linesArr) \u0026gt; 1 { ipAddresses, err := net.LookupIP(linesArr[1]) if err != nil { log.Println(\u0026#34;net.LookupIP Error:\u0026#34;, err) return } for _, ip := range ipAddresses { log.Println(\u0026#34;net.LookupIP :\u0026#34;, linesArr[1], ip) } } else { log.Println(\u0026#34;UpdateHostsFileFormRedis 长度不符\u0026#34;, linesArr) } } } } } // 修改hosts文件 func UpdateHostsFile(linesString string) { log.Println(\u0026#34;更新hosts 文件...\u0026#34;) lines := strings.Split(linesString, \u0026#34;,\u0026#34;) exists := FileExists(\u0026#34;/etc/hosts-fish-source\u0026#34;) if !exists { err := CopyFile(\u0026#34;/etc/hosts\u0026#34;, \u0026#34;/etc/hosts-fish-source\u0026#34;) if err != nil { log.Println(err) return } else { //log.Println(\u0026#34;复制hosts文件 到 /etc/hosts-fish-source\u0026#34;) } } fileAppend, err := os.Create(\u0026#34;/etc/hosts-fish-append\u0026#34;) if err != nil { log.Println(\u0026#34;无法创建目标文件: \u0026#34;, err) return } defer fileAppend.Close() writer := bufio.NewWriter(fileAppend) defer writer.Flush() for _, line := range lines { _, err := writer.WriteString(line + \u0026#34;\\n\u0026#34;) if err != nil { log.Println(\u0026#34;写入文件失败:\u0026#34;, err) return } } writer.Flush() /*\tbuf2, err := os.ReadFile(\u0026#34;/etc/hosts-fish-append\u0026#34;) if err != nil { log.Println(\u0026#34;文件读取失败\u0026#34;, \u0026#34;append\u0026#34;, err) return } log.Println(\u0026#34;###---###内容 wjx append\u0026#34;, string(buf2)) // 将内容转换为字符串并打印 */ //log.Println(\u0026#34;新建文件 到 /etc/hosts-fish-append 准备合并\u0026#34;) err = MergeFiles(\u0026#34;/etc/hosts-fish-source\u0026#34;, \u0026#34;/etc/hosts-fish-append\u0026#34;, \u0026#34;/etc/hosts\u0026#34;) if err != nil { log.Println(\u0026#34;文件合并成功错误\u0026#34;, err) } else { //log.Println(\u0026#34;文件合并成功\u0026#34;) } } func FileExists(filename string) bool { _, err := os.Stat(filename) if err == nil { return true // 文件存在 } if os.IsNotExist(err) { return false // 文件不存在 } return false // 其他错误，无法确定文件是否存在 } func MergeFiles(file1, file2, outputFile string) error { err := ClearFile(outputFile) if err != nil { log.Println(\u0026#34;文件清空失败\u0026#34;, err) return err } /*\tcontent, err := os.ReadFile(outputFile) // 读取文件内容 if err != nil { log.Println(\u0026#34;文件清空后重新读取失败\u0026#34;, outputFile, err) return err } log.Println(\u0026#34;###---###内容\u0026#34;, outputFile, string(content)) // 将内容转换为字符串并打印 */ buf1, err := os.ReadFile(file1) if err != nil { log.Println(\u0026#34;文件读取失败\u0026#34;, file1, err) return err } //log.Println(\u0026#34;###---###内容\u0026#34;, file1, string(buf1)) // 将内容转换为字符串并打印 buf2, err := os.ReadFile(file2) if err != nil { log.Println(\u0026#34;文件读取失败\u0026#34;, file2, err) return err } //log.Println(\u0026#34;###---###内容\u0026#34;, file2, string(buf2)) // 将内容转换为字符串并打印 file, err := os.OpenFile(outputFile, os.O_CREATE|os.O_RDWR|os.O_APPEND, 0666) if err != nil { log.Println(\u0026#34;文件打开失败\u0026#34;, outputFile, err) return err } defer file.Close() writer := bufio.NewWriter(file) writer.Write(buf1) writer.Write(buf2) writer.Flush() return nil } func ClearFile(filename string) error { // 打开文件并截断内容 file, err := os.OpenFile(filename, os.O_RDWR|os.O_TRUNC, 0666) if err != nil { return err } defer file.Close() // 清空文件内容 err = file.Truncate(0) if err != nil { return err } //log.Printf(\u0026#34;文件 %s 已成功清空\u0026#34;, filename) return nil } func CopyFile(sourceFile string, destinationFile string) error { src, err := os.Open(sourceFile) if err != nil { return fmt.Errorf(\u0026#34;无法打开源文件 %s: %s\u0026#34;, sourceFile, err) } defer src.Close() dst, err := os.Create(destinationFile) if err != nil { return fmt.Errorf(\u0026#34;无法创建目标文件 %s: %s\u0026#34;, destinationFile, err) } defer dst.Close() _, err = io.Copy(dst, src) if err != nil { return fmt.Errorf(\u0026#34;复制文件时出错: %s\u0026#34;, err) } return nil } ","date":"2023-11-24T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/go-manage-hosts/","title":"golang 维护 hosts,兼容阿里云函数计算"},{"content":"AdGuardHome 的主要优点是可视化，有去广告规则可用。 但是AdGuardHome自己的分流规则配置较为复杂，有第三方提供分流规则，但是实际测试因为无法使用adg的并发查询以及adg自身的性能局限所以效果并不好。所以一般都是和msdns配合使用，例如 mosdns代理两个adg分别负责国内和国外dns,或者adg作为前端后端使用modns。\n但是如果你对可视化管理和dns统计没啥需求的话，完全没必要，单独mosdns即可完成。\n下文以pve lxc alpine为例 openwrt或其他linux发行版同样操作\n安装 直接下载 mosdns 下载unzip解压到 /opt/mosdns运行 ./mosdns service install 即可。\n准备几个规则文件 主要是 国内ip清单 国内名站域名清单 国外名站域名清单 一个空白的hosts.txt 如果你有自选cf ip需求还需要准备 cf ip自动列表\n1 2 3 4 5 6 7 8 9 cd /opt/mosdns/ wget https://raw.githubusercontent.com/IceCodeNew/4Share/master/geoip_china/china_ip_list.txt -O geoip_cn.txt wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt -O geosite_category-ads-all.txt wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt -O geosite_geolocation-!cn.txt wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt -O geosite_cn.txt echo \u0026#34;localhost 127.0.0.1\u0026#34;\u0026gt; /opt/mosdns/hosts.txt #注意格式和系统的hosts文件不一样 wget https://www.cloudflare.com/ips-v4 -O cf4.txt #cf ip地址 wget https://www.cloudflare.com/ips-v6 -O cf6.txt cat cf4.txt \u0026lt;(echo) cf6.txt \u0026gt;geoip_cloudflare.txt #合并 可选的自建doh 目的是在深度学习环境不用的情况下依旧可以正确返回域名实际ip. https://dev.leiyanhui.com/route/safe-dns 查看 cfwork自建doh\nconfig.yaml 基本逻辑，国内域名geosite_cn.txt使用国内dns（dot）并发解析，国外域名geosite_geolocation-!cn.txt使用 国外dns和自建doh解析\n如果非清单内的域名，并且国内dns查询的一个域名返回的是一个非国内ip，那么使用国外 国外dns和自建doh解析 重新解析一次解决被污染问题 因为去广告geosite_category-ads-all.txt 会导致一些问题，并且我这里没这个需求，所以没有添加去广告规则。你可以自己添加上\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 cat \u0026gt; /opt/mosdns/config.yaml \u0026lt;\u0026lt; \\EOF log: level: error #日志级别。可选 \u0026#34;debug\u0026#34; \u0026#34;info\u0026#34; \u0026#34;warn\u0026#34; \u0026#34;error\u0026#34;。默认 \u0026#34;info\u0026#34; file: \u0026#34;/opt/mosdns/log.log\u0026#34; # API 入口设置 api: http: \u0026#34;0.0.0.0:9091\u0026#34; include: [] plugins: # 自定义hosts 注意格式和系统hosts不同 支持泛域名domain和fulldomain - tag: mosdns_hosts type: hosts args: files: - \u0026#34;/opt/mosdns/hosts.txt\u0026#34; # 测试pipeline ./mosdns probe pipeline tls://101.226.4.6 # 阿里和360的不支持 # 转发至本地服务器 国内解析 - tag: forward_local type: forward args: concurrent: 3 #mosdns限制最大3并发 upstreams: #因为最大3并发所以三个就够了自己选速度好的 - addr: \u0026#34;tls://223.5.5.5\u0026#34; #阿里 enable_pipeline: false - addr: \u0026#34;tls://1.12.12.12\u0026#34; #腾讯 dnspod enable_pipeline: true - addr: \u0026#34;tls://101.226.4.6\u0026#34; #360电信 enable_pipeline: false # 转发至远程服务器 境外解析上游 - tag: forward_remote type: forward args: concurrent: 3 #最大3并发 upstreams: - addr: tls://8.8.8.8 enable_pipeline: true - addr: tls://1.1.1.1 enable_pipeline: true - addr: https://你的自建doh地址 bootstrap: 223.5.5.5 #bootstrap地址负责解析doh域名 只能udp bootstrap_version: 4 #解析的doh域名返回ipv4还是v6 enable_pipeline: false enable_http3: false #http3 udp不稳 还是强制走http2 # 国内域名 - tag: geosite_cn type: domain_set args: files: - \u0026#34;/opt/mosdns/geosite_cn.txt\u0026#34; # 国内 IP - tag: geoip_cn type: ip_set args: files: - \u0026#34;/opt/mosdns/geoip_cn.txt\u0026#34; # 国外域名 - tag: geosite_no_cn type: domain_set args: files: - \u0026#34;/opt/mosdns/geosite_geolocation-!cn.txt\u0026#34; # 缓存 - tag: lazy_cache type: cache args: size: 20000 lazy_cache_ttl: 86400 #dump_file: \u0026#34;/opt/mosdns/cache.dump\u0026#34; #dump_interval: 600 # 国内解析 - tag: local_sequence type: sequence args: - exec: $forward_local # 国外解析 - tag: remote_sequence type: sequence args: - exec: prefer_ipv4 - exec: $forward_remote # 有响应终止返回 - tag: has_resp_sequence type: sequence args: - matches: has_resp exec: accept # fallback 用本地服务器 sequence # 返回非国内 ip 则 drop_resp - tag: query_is_local_ip type: sequence args: - exec: $local_sequence - matches: \u0026#34;!resp_ip $geoip_cn\u0026#34; exec: drop_resp # fallback 用远程服务器 sequence - tag: query_is_remote type: sequence args: - exec: $remote_sequence # fallback 用远程服务器 sequence - tag: fallback type: fallback args: primary: query_is_local_ip secondary: query_is_remote threshold: 500 always_standby: true # 查询国内域名 - tag: query_is_local_domain type: sequence args: - matches: qname $geosite_cn exec: $local_sequence # 查询国外域名 - tag: query_is_no_local_domain type: sequence args: - matches: qname $geosite_no_cn exec: $remote_sequence # 主要的运行逻辑插件 # sequence 插件中调用的插件 tag 必须在 sequence 前定义， # 否则 sequence 找不到对应插件。 - tag: main_sequence type: sequence args: - exec: $mosdns_hosts - exec: query_summary entry - exec: $lazy_cache - exec: $query_is_local_domain - exec: jump has_resp_sequence - exec: $query_is_no_local_domain - exec: jump has_resp_sequence - exec: $fallback #### 最后配置 server........略 - tag: server type: udp_server # 目前有 udp/tcp/http_server args: entry: main_sequence listen: 0.0.0.0:53 - tag: server_tcp type: tcp_server args: entry: main_sequence listen: 0.0.0.0:53 - tag: \u0026#34;server_http\u0026#34; type: \u0026#34;http_server\u0026#34; args: entries: # []extry - path: /dns-query # 本路径执行 exec: main_sequence # 可执行插件的 tag。 src_ip_header: \u0026#34;X-Forwarded-For\u0026#34; # 从 HTTP 头获取用户 IP。 listen: 0.0.0.0:80 # 监听地址。 cert: \u0026#34;\u0026#34; # 留空 cert 和 key 后会禁用 TLS。 这里没有配置证书，外网使用另外有acme和nginx处理https key: \u0026#34;\u0026#34; idle_timeout: 10 # 空连接超时。单位秒。默认 30。 EOF /etc/init.d/mosdns restart 部署 路由器和内网机器 因为我这里是独立部署在 pve lxc里面，ip是 10.1.1.104。\n在openwrt 或者 ikuai中配置上游dns为 10.1.1.104即可，内网内其他机器的dns可以用路由器ip作为dns或者mosdns的10.1.1.104均可\nclash clash 删除其他dns NameServer FallBack Default-NameServer 全部设置为 10.1.1.104\n外网部署 因为家宽是没有53端口的，你可以从路由器用端口映射修改一下udp tcp的端口，或者外网直接用server_http 走doh\n存在的问题 主要是自定义域名解析：\nhttps://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v5/ru-he-pei-zhi-mosdns/yu-ming-pi-pei-gui-ze mosdns 的hosts方法，支持domain 和 full keyword 和 正则。 可以解决多数自定义域名解析的问题。\n但是修改hosts文件后 需要重启才能生效 这就搞的很烦。\n","date":"2023-11-21T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/route/mosdns-all-in-one/","title":"mosdns all in one 分流加自定义解析，不依赖 AdGuardHome"},{"content":"升级目的 受阿里云(2023-11-12)故障事件影响，虽然项目一开始都跨云跨地区部署，但是我们的部分业务依旧受到牵连，遭遇重挫。所以此次升级主要是跨云大量零碎小数据储存，更换为网络kv储存（之前是定时合并文件后同步到阿里云oss）。 彻底解决业务对阿里云oss的依赖。阿里云oss和腾讯cos都改为数据备份专用，不再和业务有关联。\n本月逐步使用podman 替代docker 使用keydb替代redis。 因为打算上keydb,所以原有redis集群也替换为keydb。 并新建一个集群用于储存海量碎数据。\n关于podman podman的好处对我们目前的物联网项目来说主要是可以免root用户部署维护。\n在试运行一段时间后，从几台服务器线上使用后没问题到全部服务器都开始替换docker，历时两个月没出现任何问题。\nkeydb 而keydb经过一周的反复测试，在实际应用场景下 keydb6.3.x 性能远远超过redis6.2.13和redis7.2.3。因为跨云公网集群，所以tls是必须的，而keydb的tls性能经过测试要比redis7.2.3的qps高出6-10倍。tcp性能高出40%-2倍。\nkeydb完全兼容redis6.2.x 一周的线上部分节点测试中没发现问题。\n遇到的几个坑 华为云和debian11 腾讯云和阿里云都很顺利，主要是华为云那边。华为云没有提供debian12的镜像，在手动升级到debian12后 容器无法启动。因为时间紧张没有去检查是华为云镜像里面内置的华为组件导致的还是别的的问题。 以下记录 基于debian12 华为云部分基于debian11\nlxc主机下的podman 和docker不太一样，非特权lxc也要解决cgroup2\nsu切换用户的丢失XDG_RUNTIME_DIR 1 2 export XDG_RUNTIME_DIR=/run/user/$(id -u) echo $XDG_RUNTIME_DIR keydb集群维护和redis7不一样的地方 keydb 6.2.3 应该是基于redis6.x的，在集群创建和添加节点的，不支持用域名和hostname的方式，需要手动指定ip,否则集群无法通讯。\n阿里云的域名问题 因为为了隔离实体，这次升级，我们新使用了一个和我个人以及公司不相关的域名（未在阿里云备案）组建redis集群。结果在阿里云那边 tls频繁被重置。 集群也经常卡掉。 反复检查后，并和阿里云技术沟通几次后发现确实是备案的问题。（非web业务域名也要备案）\n后更换一个在阿里云备案过的域名 没有再出问题。\n我朝这些政策真的是。。。\nACL keydb6.3.4 依旧不支持Redis 7.X ACL，部分业务代码需要调整。之前说2023年中支持，好像跳票了。但是目前最新代码中已经有acl相关的内容 unstable 版本未测试\n其他可选的kv储存 一开始是打算先在部分需要储存的业务上替换目前的s3储存，新方案需要去中心化跨云的集群，加上我们对go-reids sdk针对性的优化过，所以优先考察了几个兼容redis协议的 以及minio集群。\n主要是 minio kvrocks tendis redrock Pika\nminio集群 去中心化，但是扩展需要指数扩展，另外etcd联邦方案过于复杂。我们实际情况是大量小数据段，写入多但是读取也不少，在实际测试后minio集群方式带来的费用可能比直接使用云厂商的对象储存反还要高。 tendis 未尝试，因为不支持tls不跨云部署。 redrock 个人开发者，作者在知乎，github不活跃，代码已经许久没维护，文档不全。简单测试后性能和redis差不多，低于keydb。 kvrocks 花费大量时间测试和权衡后得到的结论：他的集群的管理以及故障转移方式虽然没有gossip开支，需要一个外部节点来自动进行故障转移，另外就是他的热数据是基于rocks的cache来管理在qps比较高的时候的表现一般，在测试过几轮后和redis6/7的差距较大（不知道为什么所有kv数据去vs redis的时候都去和单线程的redis比较\u0026hellip;）。 pika 看起来不是完全去中心化的，和我们实际需求不相符。\n主要是我们还需要热数据查询速度好一些，虽然另外有一个redis集群，但是本着尽可能独立的原则。剩下也就keydb 和 kvrocks可选了。\n因为线下模拟测试和线上实际情况有出入，而kvrocks和keydb都是兼容redis cluster，我们目前情况是qps较高而节点数量并不多，gossip协议对我们影响不大，所以我们最终决定先逐步在线上用keydb替代redis和kv储存。日后再调研kvrocks keydb的硬盘存储功能，也就是flash功能，目前还是测试版。但是这是从keydb专业版合并到开源版本的功能，所以简单的 get set 经过一周测试稳定性和性能都没有问题。\n部署过程 系统环境准备 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 wget https://github代理站/https://github.com/rclone/rclone/releases/download/v1.64.2/rclone-v1.64.2-linux-amd64.deb apt install ./rclone-v1.64.2-linux-amd64.deb rm ./rclone-v1.64.2-linux-amd64.deb #apt install docker-compose apt-get -y install podman crun slirp4netns fuse-overlayfs systemctl enable --now podman # debian11 需要 # 别名 alpine的写到 /etc/profile cp /etc/containers/registries.conf /etc/containers/registries.conf-bak cat \u0026gt; /etc/containers/registries.conf\u0026lt;\u0026lt; EOF unqualified-search-registries = [\u0026#39;registry.redhat.io\u0026#39;, \u0026#39;docker.io\u0026#39;] [[registry]] prefix = \u0026#34;docker.io\u0026#34; location = \u0026#34;docker.io\u0026#34; [[registry.mirror]] location = \u0026#34;docker.nju.edu.cn\u0026#34; [[registry.mirror]] location = \u0026#34;docker.mirrors.sjtug.sjtu.edu.cn\u0026#34; [[registry.mirror]] location = \u0026#34;阿里云容器镜像加速地址.mirror.aliyuncs.com\u0026#34; EOF mkdir -p ~/.config/rclone/ cat \u0026gt; ~/.config/rclone/rclone.conf \u0026lt;\u0026lt; EOF [oss-hz] type = s3 provider = Alibaba access_key_id = XXXXX secret_access_key = XXXX endpoint = oss-cn-shanghai.aliyuncs.com acl = private storage_class = STANDARD bucket_acl = private EOF 独立用户 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 adduser --shell /bin/bash keydb loginctl enable-linger keydb # 允许用户常驻 ##需要给 检查sudo权限，否则容器的一些目录他没有权限删除， usermod -aG sudo keydb #部署完成后 移除sudo sudo -l -U keydb # 部分云主机（腾讯云）改动过sudoer文件 需要手动添加 sudo用户组 echo \u0026#34;%sudo\tALL=(ALL:ALL) ALL\u0026#34; \u0026gt; /etc/sudoers.d/sudogrup # 配置证书 su keydb mkdir -p ~/.ssh/ cat \u0026gt; ~/.ssh/authorized_keys \u0026lt;\u0026lt; \\EOF ssh-rsa AAAXXXXXXXX EOF chmod -R 600 ~/.ssh/authorized_keys 推出ssh,重新用 keydb用户登陆到服务器，后面操作都是基于keydb\ntls证书 用rclone 从oss获取\n1 2 rclone copyto oss-hz:/XXXX/redis_tls ~/redis_tls rm -rf ~/.config/rclone/rclone.conf # 用完删掉配置文件 keydb模板 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 cat \u0026gt; ~/etc/keydb_tpl_all.conf \u0026lt;\u0026lt; \\EOF # flash版本 # 主要设置 maxmemory128mb maxmemory {MaxMem} # allkeys-lfu allkeys-lru maxmemory-policy allkeys-lfu maxmemory-samples 5 # storage-provider flash /path/to/flash/db storage-provider flash /data/flash # === 持久化 appendonly yes appendfilename \u0026#34;appendonly.aof\u0026#34; appendfsync everysec rdbcompression yes rdbchecksum yes dbfilename dump.rdb rdb-del-sync-files no dir /data hz 10 dynamic-hz yes aof-rewrite-incremental-fsync yes rdb-save-incremental-fsync yes no-appendfsync-on-rewrite no auto-aof-rewrite-percentage 100 auto-aof-rewrite-min-size 64mb aof-load-truncated yes aof-use-rdb-preamble yes # ======= 密码 requirepass \u0026#34;{password}\u0026#34; masterauth \u0026#34;{password}\u0026#34; # ======== tls tls-port {tlsPort} tls-cert-file {tlsCert}/redis.crt tls-key-file {tlsCert}/redis.key tls-client-cert-file {tlsCert}/client.crt tls-client-key-file {tlsCert}/client.key tls-client-key-file-pass {tlsCert}/secret tls-dh-params-file {tlsCert}/redis.dh tls-ca-cert-file {tlsCert}/ca.crt tls-ca-cert-dir {tlsCert} tls-auth-clients no tls-auth-clients optional tls-replication yes tls-cluster yes tls-protocols \u0026#34;TLSv1.2 TLSv1.3\u0026#34; tls-ciphers DEFAULT:!MEDIUM tls-ciphersuites TLS_CHACHA20_POLY1305_SHA256 tls-prefer-server-ciphers yes tls-session-caching no tls-session-cache-size 5000 tls-session-cache-timeout 60 #=== 集群 cluster-enabled yes cluster-config-file \u0026#34;nodes.conf\u0026#34; cluster-node-timeout 5000 cluster-announce-ip {domian} cluster-announce-bus-port {PORT_BUS} # ======= 其他 protected-mode no bind * -::* port {port} tcp-backlog 511 timeout 0 tcp-keepalive 300 supervised no pidfile /var/run/keydb.pid #loglevel notice warning loglevel notice databases 16 always-show-logo no set-proc-title yes proc-title-template \u0026#34;{title} {listen-addr} {server-mode}\u0026#34; save 900 1 save 300 10 save 60 10000 stop-writes-on-bgsave-error yes replica-serve-stale-data yes replica-read-only yes repl-diskless-sync no repl-diskless-sync-delay 5 repl-diskless-load disabled repl-disable-tcp-nodelay no replica-priority 100 acllog-max-len 128 lazyfree-lazy-eviction no lazyfree-lazy-expire no lazyfree-lazy-server-del no replica-lazy-flush no lazyfree-lazy-user-del no lazyfree-lazy-user-flush no oom-score-adj no oom-score-adj-values 0 200 800 disable-thp yes lua-time-limit 5000 slowlog-log-slower-than 10000 slowlog-max-len 128 latency-monitor-threshold 0 notify-keyspace-events \u0026#34;\u0026#34; hash-max-ziplist-entries 512 hash-max-ziplist-value 64 list-max-ziplist-size -2 list-compress-depth 0 set-max-intset-entries 512 zset-max-ziplist-entries 128 zset-max-ziplist-value 64 hll-sparse-max-bytes 3000 stream-node-max-bytes 4096 stream-node-max-entries 100 activerehashing yes client-output-buffer-limit normal 0 0 0 client-output-buffer-limit replica 256mb 64mb 60 client-output-buffer-limit pubsub 32mb 8mb 60 jemalloc-bg-thread yes server-threads 2 replica-weighting-factor 2 active-client-balancing yes EOF 通过模板创建N个keydb配置文件 下面创建了 5+5 10个，每个实例需要3个端口\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 get_keydb_conf() { mkdir -p ~/etc \u0026amp;\u0026amp; cd ~/etc rm -rf ./keydb$PORT_TCP.conf cp ./keydb_tpl_all.conf ./$PORT_TCP.conf # 模板 sed -i \u0026#34;s/{port}/$PORT_TCP/g\u0026#34; ./$PORT_TCP.conf #tcp 端口 sed -i \u0026#34;s/{tlsPort}/$PORT_TLS/g\u0026#34; ./$PORT_TCP.conf #tls 端口 sed -i \u0026#34;s/{PORT_BUS}/$PORT_BUS/g\u0026#34; ./$PORT_TCP.conf #BUS 端口 sed -i \u0026#34;s/{domian}/$KEYDB_DOMAIN/g\u0026#34; ./$PORT_TCP.conf #域名 sed -i \u0026#34;s/{tlsCert}/\\/redis_tls/g\u0026#34; ./$PORT_TCP.conf #证书 sed -i \u0026#34;s/{password}/$KEYDB_PSW/g\u0026#34; ./$PORT_TCP.conf #密码 sed -i \u0026#34;s/{MaxMem}/$MaxMem/g\u0026#34; ./$PORT_TCP.conf #最大内存 if [[ $(uname -m) == arm* || $(uname -m) == aarch* ]]; then echo \u0026#34;当前是 ARM 架构 需要添加一行 ARM64-COW-BUG \u0026#34; echo \u0026#34;ignore-warnings ARM64-COW-BUG\u0026#34;\u0026gt;\u0026gt; ./$PORT_TCP.conf # arm需要这个 fi } KEYDB_PSW=mypasswd MaxMem=\u0026#34;512mb\u0026#34; KEYDB_DOMAIN=\u0026#34;serv-ali-1.leiyanhui.com\u0026#34; for i in {1..5}; do PORT_TCP=$((4000 + i)) PORT_TLS=$((4100 + i)) PORT_BUS=$((14100 + i)) get_keydb_conf done MaxMem=\u0026#34;1024mb\u0026#34; for i in {1..5}; do PORT_TCP=$((5000 + i)) PORT_TLS=$((5100 + i)) PORT_BUS=$((15100 + i)) get_keydb_conf done nano 6001.conf 创建容器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 get_podman() { podman stop keydb$PORT_TCP\u0026amp;\u0026amp;podman rm keydb$PORT_TCP sudo rm -rf ~/storage$PORT_TCP \u0026amp;\u0026amp; mkdir ~/storage$PORT_TCP # 先sudo 删除储存目录 podman run -itd --name keydb$PORT_TCP --hostname keydb$PORT_TCP --network host \\ -v ~/etc:/keydb_etc \\ -v ~/redis_tls:/redis_tls \\ -v ~/storage$PORT_TCP:/data \\ -e TZ=Asia/Shanghai \\ --restart=always \\ --shm-size 128M \\ -d $DOCKEIMAGE keydb-server /keydb_etc/$PORT_TCP.conf # 处理用户服务 mkdir -p ~/.config/systemd/user \u0026amp;\u0026amp; cd ~/.config/systemd/user rm -rf ./container-keydb$PORT_TCP.service podman generate systemd --name keydb$PORT_TCP --files --new systemctl --user daemon-reload systemctl --user enable container-keydb$PORT_TCP.service } export DOCKEIMAGE=docker.io/eqalpha/keydb:alpine_x86_64_v6.3.4 for i in {1..5}; do PORT_TCP=$((4000 + i)) get_podman done for i in {1..5}; do PORT_TCP=$((5000 + i)) get_podman done ls podman ps -a 开放端口 去各家云主机控制面板 防火墙 开放端口\n4101-4105,14101-14105, 5101-5105,15101-15105\n主集群连接 keydb必须使用ip连接\n1 2 3 4 5 6 7 8 9 podman exec -it keydb6001 keydb-cli --tls \\ --cacert /redis_tls/ca.crt \\ -a 密码 \\ --cluster create 18.18.18.18:4101 18.18.18.18:4102 18.18.18.18:4103 18.18.18.18:4104 18.18.18.18:4105 podman exec -it keydb6001 keydb-cli --tls \\ --cacert /redis_tls/ca.crt \\ -a 密码 \\ --cluster create 18.18.18.18:5101 18.18.18.18:5102 18.18.18.18:5103 18.18.18.18:5104 18.18.18.18:5105 添加从节点 也必须用ip方式\n1 2 3 4 5 podman exec -it keydb6001 keydb-cli --tls \\ --cacert /redis_tls/ca.crt \\ -a 密码 \\ --cluster add-node 新节点:4105 现有任意一个旧节点ip:4101 \\ --cluster-slave --cluster-master-id \u0026lt;本节点的主节点id\u0026gt; 手动调整主节点 逐个连接到要提为主节点上执行，这里可以用域名了哈\n1 2 3 4 5 podman exec -it keydb6001 keydb-cli --tls \\ --cacert /redis_tls/ca.crt \\ -a 密码 \\ -h 要提为主节点的从节点的ip或者域名 -p 4104 \\ CLUSTER FAILOVER TAKEOVER 导入历史数据 方法1 、 https://github.com/joyanhui/redis-back\n方法2、 aof 和 rdb文件直接恢复\n实际3、 集群未停机，主节点都在线，所以直接接入\n防止主节点过于集中 某些极端情况下，多数主节点会被集群迁移到其中一台机器上（目前是4台机器，每个集群5个主节点）。如果有3个主节点被集群自动迁移到一台机器上，刚好这台机器宕机。那么整个集群会无法自愈。\n需要另外运行一个脚本定时执行CLUSTER NODES检查节点部分情况。\n我们是部署在云函数上的golang+shell脚本实现 定时器事件触发，具体实现略\n防止主从同步带宽占用过大 每个集群是 1主2从 1从和它的主放在同一个云上，修改hosts为内网ip，另外一从跨云。\n这样尽可能的降低主从同步的带宽占用。在经济性和高可用性之间找平衡。\n对redis的一些看法 其实无论是keydb还是dragonfly实际运行环境中，性能都已经远远超过redis，连接数比较多的时候cpu和内存的开支也都比redis小很多。 甚至kvrocks在ramdis或者傲腾下，性能都超过redis 所以如果和我一样是自建的话，尽早切换吧。 redis的设计逻辑有一些固执，或许这也是redis一开始成功的原因。\n","date":"2023-11-20T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/container/podman-keydb/","title":"podman跨云部署keydb集群替代docker+redis的过程和几个坑"},{"content":"场景 之前服务都是基于 rust和golang 所以一直使用公用镜像。但是在使用对象储存的时候发现缺少ssl支持。\n不得不\n准备文件 sources.list （服务器上 没科学工具） zsh 配置文件（偶尔需要在容器内部操作所以还是加上） sourece.list 1 2 3 4 5 6 7 8 9 10 11 deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware # deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware # deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware # deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware # deb-src http://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware zsh 配置文件 https://github.com/joyanhui/oh-my-zsh\n1 2 3 4 5 rm -rf .oh-my-zsh yhZsh.zip .zshrc curl -L -e \u0026#39;; auto\u0026#39; -o yhZsh.zip https://mirror.ghproxy.com/https://github.com/joyanhui/oh-my-zsh/archive/refs/heads/main.zip unzip yhZsh.zip mv oh-my-zsh-main/.oh-my-zsh . \u0026amp;\u0026amp; cp oh-my-zsh-main/.zshrc . rm -rf yhZsh.zip oh-my-zsh-main 适当删除一些没用的插件和主题\nDockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 FROM debian:stable-20231120-slim MAINTAINER author \u0026#34;leiyanhui@gmail.com\u0026#34; ADD sources.list /etc/apt/ ADD .zshrc /root/ COPY .oh-my-zsh /root/.oh-my-zsh #ADD rclone /usr/bin/ RUN rm -rf /etc/apt/sources.list.d/debian.sources \u0026amp;\u0026amp; \\ apt-get update \u0026amp;\u0026amp; apt-get install -y apt-transport-https ca-certificates gnupg lsb-release \u0026amp;\u0026amp; \\ apt-get install -y psmisc wget curl unzip zip fuse zsh ntp iftop openssh-server \u0026amp;\u0026amp; \\ apt autoremove \u0026amp;\u0026amp; apt-get clean \u0026amp;\u0026amp; apt-get autoclean \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \\ WORKDIR /root EXPOSE 22 CMD [\u0026#34;/usr/sbin/sshd\u0026#34;,\u0026#34;-D\u0026#34;] 容器服务 因为更新较少，所以使用阿里云的\n1 2 3 4 5 6 7 8 9 10 11 sudo docker login --username=\u0026lt;用户名\u0026gt; registry.cn-shanghai.aliyuncs.com nowTime=$(date \u0026#34;+%Y%m%d%H%M%S\u0026#34;) sudo docker build -t registry.cn-shanghai.aliyuncs.com/fish/debian:base-\u0026#34;${nowTime}\u0026#34; . sudo docker tag registry.cn-shanghai.aliyuncs.com/fish/debian:base-\u0026#34;${nowTime}\u0026#34; registry.cn-shanghai.aliyuncs.com/fish/debian:base-latest sudo docker push registry.cn-shanghai.aliyuncs.com/fish/debian:base-\u0026#34;${nowTime}\u0026#34; sudo docker push registry.cn-shanghai.aliyuncs.com/fish/debian:base-latest swarm集群部署 在集群上分别登陆 然后\n1 docker pull registry.cn-shanghai.aliyuncs.com/fish/debian:latest ","date":"2023-11-19T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/debian-fishbase/","title":"docker swarm 集群debian基础镜像"},{"content":"之前一直在用gnet，但是gnet有两个痛点：1、不支持tls/https 2、http和websocket的功能不完整。\n因为主要是做api使用，所以第二点对我困扰并不大，但是第一点带来很多麻烦。\n于是偶尔在v2ex看到 nbio的作者的自吹贴，详细看了他的测试结果，看了一部分源码后，觉得新的服务应该去尝试一下。\n同时在tcp/tls基础上实现简易的http（单纯非必要不用完整http）\n1 go get github.com/lesismal/nbio@v1.3.19 tcp ：https://github.com/lesismal/nbio-examples/blob/master/echo/server/server.go\n简易http server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/lesismal/nbio\u0026#34; ) func main() { engine := nbio.NewEngine(nbio.Config{ Network: \u0026#34;tcp\u0026#34;, Addrs: []string{\u0026#34;:8888\u0026#34;}, MaxWriteBufferSize: 6 * 1024 * 1024, }) engine.OnData(func(c *nbio.Conn, data []byte) { //封装http start joinLengthBytes := []byte(strings.Join([]string{strconv.Itoa(len(data)), \u0026#34;\\r\\n\\r\\n\u0026#34;}, \u0026#34;\u0026#34;)) htmlList := [][]byte{ []byte(\u0026#34;HTTP/1.1 200\\r\\nServer:fish-v5\\r\\nContent-Type:text/plain\\r\\nContent-Length:\u0026#34;), joinLengthBytes, data, } http_response := bytes.Join(htmlList, nil) c.Write(http_response) //封装http end //c.Write(append([]byte{}, data...)) }) err := engine.Start() if err != nil { fmt.Printf(\u0026#34;nbio.Start failed: %v\\n\u0026#34;, err) return } defer engine.Stop() \u0026lt;-make(chan int) } 简易 https server rsaCertPEM 和 rsaKeyPEM 可以用nginx格式的 .cer（至少需要第一段）和key,当然也支持 acme申请的证书\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;log\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/lesismal/llib/std/crypto/tls\u0026#34; \u0026#34;github.com/lesismal/nbio\u0026#34; ntls \u0026#34;github.com/lesismal/nbio/extension/tls\u0026#34; ) func main() { cert, err := tls.X509KeyPair(rsaCertPEM, rsaKeyPEM) if err != nil { log.Fatalf(\u0026#34;tls.X509KeyPair failed: %v\u0026#34;, err) } tlsConfig := \u0026amp;tls.Config{ Certificates: []tls.Certificate{cert}, InsecureSkipVerify: true, } g := nbio.NewGopher(nbio.Config{ Network: \u0026#34;tcp\u0026#34;, Addrs: []string{\u0026#34;:8888\u0026#34;}, }) isClient := false g.OnOpen(ntls.WrapOpen(tlsConfig, isClient, func(c *nbio.Conn, tlsConn *tls.Conn) { log.Println(\u0026#34;OnOpen:\u0026#34;, c.RemoteAddr().String()) })) g.OnClose(ntls.WrapClose(func(c *nbio.Conn, tlsConn *tls.Conn, err error) { log.Println(\u0026#34;OnClose:\u0026#34;, c.RemoteAddr().String()) })) g.OnData(ntls.WrapData(func(c *nbio.Conn, tlsConn *tls.Conn, data []byte) { log.Println(\u0026#34;OnData:\u0026#34;, c.RemoteAddr().String(), string(data)) joinLengthBytes := []byte(strings.Join([]string{strconv.Itoa(len(data)), \u0026#34;\\r\\n\\r\\n\u0026#34;}, \u0026#34;\u0026#34;)) htmlList := [][]byte{ []byte(\u0026#34;HTTP/1.1 200\\r\\nServer:fish-v5\\r\\nContent-Type:text/plain\\r\\nContent-Length:\u0026#34;), joinLengthBytes, data, } http_response := bytes.Join(htmlList, nil) //c.Write(http_response) tlsConn.Write(http_response) })) err = g.Start() if err != nil { log.Fatalf(\u0026#34;nbio.Start failed: %v\\n\u0026#34;, err) return } defer g.Stop() g.Wait() } var rsaCertPEM = []byte(`-----BEGIN CERTIFICATE----- MIIDazCCAlOgAwIBAgIUJeohtgk8nnt8ofratXJg7kUJsI4wDQYJKoZIhvcNAQEL BQAwRTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoM GEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDAeFw0yMDEyMDcwODIyNThaFw0zMDEy MDUwODIyNThaMEUxCzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEw HwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQwggEiMA0GCSqGSIb3DQEB AQUAA4IBDwAwggEKAoIBAQCy+ZrIvwwiZv4bPmvKx/637ltZLwfgh3ouiEaTchGu IQltthkqINHxFBqqJg44TUGHWthlrq6moQuKnWNjIsEc6wSD1df43NWBLgdxbPP0 x4tAH9pIJU7TQqbznjDBhzRbUjVXBIcn7bNknY2+5t784pPF9H1v7h8GqTWpNH9l cz/v+snoqm9HC+qlsFLa4A3X9l5v05F1uoBfUALlP6bWyjHAfctpiJkoB9Yw1TJa gpq7E50kfttwfKNkkAZIbib10HugkMoQJAs2EsGkje98druIl8IXmuvBIF6nZHuM lt3UIZjS9RwPPLXhRHt1P0mR7BoBcOjiHgtSEs7Wk+j7AgMBAAGjUzBRMB0GA1Ud DgQWBBQdheJv73XSOhgMQtkwdYPnfO02+TAfBgNVHSMEGDAWgBQdheJv73XSOhgM QtkwdYPnfO02+TAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQBf SKVNMdmBpD9m53kCrguo9iKQqmhnI0WLkpdWszc/vBgtpOE5ENOfHGAufHZve871 2fzTXrgR0TF6UZWsQOqCm5Oh3URsCdXWewVMKgJ3DCii6QJ0MnhSFt6+xZE9C6Hi WhcywgdR8t/JXKDam6miohW8Rum/IZo5HK9Jz/R9icKDGumcqoaPj/ONvY4EUwgB irKKB7YgFogBmCtgi30beLVkXgk0GEcAf19lHHtX2Pv/lh3m34li1C9eBm1ca3kk M2tcQtm1G89NROEjcG92cg+GX3GiWIjbI0jD1wnVy2LCOXMgOVbKfGfVKISFt0b1 DNn00G8C6ttLoGU2snyk -----END CERTIFICATE----- `) var rsaKeyPEM = []byte(`-----BEGIN RSA PRIVATE KEY----- MIIEogIBAAKCAQEAsvmayL8MImb+Gz5rysf+t+5bWS8H4Id6LohGk3IRriEJbbYZ KiDR8RQaqiYOOE1Bh1rYZa6upqELip1jYyLBHOsEg9XX+NzVgS4HcWzz9MeLQB/a SCVO00Km854wwYc0W1I1VwSHJ+2zZJ2Nvube/OKTxfR9b+4fBqk1qTR/ZXM/7/rJ 6KpvRwvqpbBS2uAN1/Zeb9ORdbqAX1AC5T+m1soxwH3LaYiZKAfWMNUyWoKauxOd JH7bcHyjZJAGSG4m9dB7oJDKECQLNhLBpI3vfHa7iJfCF5rrwSBep2R7jJbd1CGY 0vUcDzy14UR7dT9JkewaAXDo4h4LUhLO1pPo+wIDAQABAoIBAF6yWwekrlL1k7Xu jTI6J7hCUesaS1yt0iQUzuLtFBXCPS7jjuUPgIXCUWl9wUBhAC8SDjWe+6IGzAiH xjKKDQuz/iuTVjbDAeTb6exF7b6yZieDswdBVjfJqHR2Wu3LEBTRpo9oQesKhkTS aFF97rZ3XCD9f/FdWOU5Wr8wm8edFK0zGsZ2N6r57yf1N6ocKlGBLBZ0v1Sc5ShV 1PVAxeephQvwL5DrOgkArnuAzwRXwJQG78L0aldWY2q6xABQZQb5+ml7H/kyytef i+uGo3jHKepVALHmdpCGr9Yv+yCElup+ekv6cPy8qcmMBqGMISL1i1FEONxLcKWp GEJi6QECgYEA3ZPGMdUm3f2spdHn3C+/+xskQpz6efiPYpnqFys2TZD7j5OOnpcP ftNokA5oEgETg9ExJQ8aOCykseDc/abHerYyGw6SQxmDbyBLmkZmp9O3iMv2N8Pb Nrn9kQKSr6LXZ3gXzlrDvvRoYUlfWuLSxF4b4PYifkA5AfsdiKkj+5sCgYEAzseF XDTRKHHJnzxZDDdHQcwA0G9agsNj64BGUEjsAGmDiDyqOZnIjDLRt0O2X3oiIE5S TXySSEiIkxjfErVJMumLaIwqVvlS4pYKdQo1dkM7Jbt8wKRQdleRXOPPN7msoEUk Ta9ZsftHVUknPqblz9Uthb5h+sRaxIaE1llqDiECgYATS4oHzuL6k9uT+Qpyzymt qThoIJljQ7TgxjxvVhD9gjGV2CikQM1Vov1JBigj4Toc0XuxGXaUC7cv0kAMSpi2 Y+VLG+K6ux8J70sGHTlVRgeGfxRq2MBfLKUbGplBeDG/zeJs0tSW7VullSkblgL6 nKNa3LQ2QEt2k7KHswryHwKBgENDxk8bY1q7wTHKiNEffk+aFD25q4DUHMH0JWti fVsY98+upFU+gG2S7oOmREJE0aser0lDl7Zp2fu34IEOdfRY4p+s0O0gB+Vrl5VB L+j7r9bzaX6lNQN6MvA7ryHahZxRQaD/xLbQHgFRXbHUyvdTyo4yQ1821qwNclLk HUrhAoGAUtjR3nPFR4TEHlpTSQQovS8QtGTnOi7s7EzzdPWmjHPATrdLhMA0ezPj Mr+u5TRncZBIzAZtButlh1AHnpN/qO3P0c0Rbdep3XBc/82JWO8qdb5QvAkxga3X BpA7MNLxiqss+rCbwf3NbWxEMiDQ2zRwVoafVFys7tjmv6t2Xck= -----END RSA PRIVATE KEY----- `) ","date":"2023-11-15T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/nbio/","title":"golang 高性能网络io框架 nbio"},{"content":"阿里云在这次（2023年11月12日）大规模故障时间中，可以说给所有人迎头一击。\n得益处这些年遇到的太多灾难，我们在业务开展初期就考虑到了跨地区跨机房跨云跨域名跨dns跨主体,但是依旧有部分业务被影响。\n各种跨的必要性和方案 跨云厂商 必要性这个不用说了，这次事情都知道了。\n一般情况下，核心业务最好一律跨厂商多活部署。\n尤其是是核心数据 在隐藏好ip的情况下（能上ipv6一定上ipv6）,公网加密主从同步自动切换是必须的。\n对于redis数据库来说来Cluster是一开始就要准备的\n跨地区和机房 在同一家云厂商，尽量跨地区/机房部署多活部署。\n跨域名跨dns 数年前的dnspod时间不知道还有人记得吗？\n域名被暂停解析不知道有多少人遇到过，数年前更有人遇到域名过户/转移等奇葩事件。\n所以 除非是网站的网址，其他地方一定有多个域名\n另外域名的dns不要只使用一家的\n跨主体 因为国内目前的政策因素，即便是你合法合规的运营，能100%确定自己不会遇到备案吊销域名暂停解析。单一主体依旧存在风险。\n因为备案制度，任何人都可以查到你公司或者个人名下的所有域名，进一步拿到你部分api地址，更是可以直接看到你域名dns地址（dns一锅端也是可以的）。\n关于无状态服务 微服务在规划的时候，注意能无状态服务的就用无状态的。\n和域名相关的 用谁的域名 如果不会产生额外的费用，并且接口地址你可以随时更换的的情况下，尽量用云厂商送的域名（例如阿里云函数计算的http触发器域名）。\n因为云厂商的域名dns防护程度都比较高，免费的在某些时候比你花钱的更好。\n当然如果你没有办法随时切换接口的地址，那么还是用自己有控制权的域名。\n泛域名 对于可以捆绑域名的http类业务，泛域名解析虽然不能避免解析记录泄露，但是可以避免通过域名dns历史解析记录拿到接口绑定的hostname。而且这个操作并不麻烦。\n例如你 一个 接口 为 http://usercenter-aliyun.leiyanhui.com ，原来cname或者A记录 usercenter-aliyun，之需要修改为 *.usercenter-aliyun 同时在业务上绑定的域名修改为 http://run1.usercenter-aliyun.leiyanhui.com（不要绑定泛域名） 如果发生针对这个地址的一些攻击，去业务那边修改为 http://run2.usercenter-aliyun.leiyanhui.com 即可临时规避一下\n关于entrypoint 这里定义的项目的entrypoint 主要是面向客户端的（app/物联网设备/html内的api）。即客户端需要先连接entrypoint查询后端api接口，再连接api处理后续工作。\nentrypoint应该跨云跨域名跨主体部署 。 相关业务在运行中或如果和其他业务通信故障，去这些地址里面查询可用的节点。\n比较经典的例子，比如一般情况 app的后端api地址为 http://api.app.com ，一般可能还会预留一个 http://api2.app.com 作为备用地址。\n修改后的方案为\napp应该 http://entrypoint1.url.com http://entrypoint.url2.com http://entrypoint.url3.com http://entrypoint.urlNNN.com 等多个地址并发查询 a 通过上面的entrypoint返回的 api地址，再继续操作。\nentrypoint 虽然多地跨云跨域名甚至跨主体部署，但是因为只是一个简单的json静态文件服务器，甚至可以部署到cdn，以及servless 所以维护成本很低。\n另外 entrypoint的地址，最好其中有预留1-3个云厂商/大厂的域名，例如 阿里云的 函数计算 的url， 以及 各个云厂商的对象储存的文件访问地址，因为他们的域名都做好了dns防护，可用性要比我们的dns高很多。 为了节省开支放置servless和对象储存被刷，平时禁止访问即可，在需要的时候开启允许公网访问即可。\n不过华为云函数计算就算了，他给的域名公网访问次数限制1000次/天\n困扰 跨云部署最大的困扰 就是 成本，带宽占用 服务器闲置 管理成本。\n尤其是大量数据 在 公网上加密同步。。。\n","date":"2023-11-15T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/clouds-migrate/","title":"关于跨云部署的一些思路和困扰"},{"content":"项目逐步切换到golang后 部分项目想逐步迁移到serverless。但是第一次折腾 遇到一些问题，而文档很乱看的云里雾里。慢慢解决后，这里简单记录一下。\n下文主要是以aliyun为例\n传统迁移serverless的几个注意点 关于脱离对云厂商的依赖 之前以为必须要引入厂商的sdk才可以，后来发现 多数云厂商已经不需要。\n关于冻结 在处理完成一个事件后（http请求、定时器、消息等），整个进程都会被冻结。直到下次事件执行。\n这也是所谓的无状态服务，也会同时导致，你没有完成的协程被冻结！\n关于http类程序 可以直接用http事件触发，大概就是函数计算 算是一个nginx,转发客户请求到到你的后端程序(http://:9000)。 这里需要注意的是，函数计算会附加一些header信息大概有1.5k的数据过来，除了前置网关没有办法关闭这些信息。\n如果你和我一样私有协议并严格限制了信息长度， 这里是一个小坑。\n关于非http类程序 比如 定时器触发的一个功能。我之前理解以为 定时器事件触发 我们的程序，然后执行完成程序推出，资源回收/冻结。\n期间遇到 code 0的坑，也出现程序一直被多次反复不按照预期的执行。 在阿里云售后群和发工单后依旧没有头绪。\n最后才弄明白，针对这类应用，阿里云有两种处理方式：任务处理函数 和 服务\u0026gt;函数。而我主要用的区域是阿里云的华北1青岛，不支持任务处理函数，也没注意到这点。所以我看的文档是任务处理函数，但是却在服务\u0026gt;函数里面 调试的\u0026hellip;.\n任务处理函数 https://fcnext.console.aliyun.com/cn-区域/tasks\n如果采用docker部署，我们的程序在正常执行完成后 进程 exit 0 即可。\n阿里云官网提示: 在使用非 Web Server 模式时，成功处理完请求后，您需要主动退出进程，并且 ExitCode 需要为 0。此外，请求的“事件参数”会以环境变量 FC_CUSTOM_CONTAINER_EVENT 的形式传递给函数。\n而任务处理函数，又分为 运行时和docker两种方案。这里特指docker方案。运行时方案我没有尝试，但是看起来和服务函数的差距不大。\n服务函数 https://fcnext.console.aliyun.com/cn-区域/services 这里依旧是 需要开httpserver响应/invoke 路径的post\n1 2 3 4 5 6 7 func main() { http.HandleFunc(\u0026#34;/invoke\u0026#34;, func(w http.ResponseWriter, r *http.Request) { //这里处理 业务功能 fmt.Fprintf(w, \u0026#34;Hello 定时器\u0026#34;) }) http.ListenAndServe(\u0026#34;:9000\u0026#34;, nil) } 两者的区别 个人体验后看法，如果不想改动代码，你原来的程序就是执行完成后自动推出的。那么就用 任务处理函数。 如果你方便修改代码 而且 你程序在初始化的时候 需要进行一些消耗性能的操作，那么尽量迁移到服务模式。\n另外一点 ：服务模式的函数，如果你请求频繁，比如 定时器事件 1分钟 执行一次，那么，你的实例基本不会被释放。虽然闲置cpu不计费，但是你还需要为内存买单。在咨询阿里云技术后得知，你需要为整个实例的内存（最小128m）买单。\n这是和任务处理函数 的一个很大的区别。\n关于消息订阅 基本上是没法用了。暂时不知道怎么处理。\n一些简单实时性要求不高的数据更新，可以在每次响应http的时候 检查上次执行时间然后再从数据库/oss/nas复查的方式。\n关于异步的协程 暂时只能由http唤起，然后等协程执行完成后再fmt.Fprintf(w,\u0026quot;\u0026quot;) 回去\n关于阿里云的fc 3.0 3.0去掉了服务的概念，只剩下 应用和函数 两个概念。应用 没研究，应该是需要绑定云厂商。 函数 对应之前的 服务函数，概念变为： 事件函数 web函数 docker镜像（青岛地区不支持，其他地区不清楚）。 我目前只测试成功了他的web函数方式，我自己上传zip包的方法。docker方式，因为我们的docker目前都在青岛地区，所以无从测试。关于3.0的事件函数 因为我没有打算引入阿里云的sdk,按照http server /invoke 的方式没测试成功。\n然后在2.0 里面的 自定义运行时的任务函数概念 好像取消了。\n同时他的web函数方式，兼容 httpserver 的 /invoke 模式。不过他会自动创建一个http触发器，自己去关闭即可。\n但\n关于3.0带来的好处 关于3.0 目前感觉最大的好处就是 可以用 其他事件 + http的方式触发 。例如：\n定时器1小时运行一次 /invoke ，然后我们需要强制运行的时候，可以外部访问 http://url//invoke?token=jwt的方式来主动触发。 可以单独为一个函数关闭日志。阿里云的日志服务是要钱的 关于其他厂商 aws 那边没有弄明白，腾讯这个和阿里云相差不大，但是腾讯那边有月租费，但是不打算花时间和精力去测试。\nAzure 那边支持有状态服务，没有仔细去看。\n而华为云这边，貌似事件/触发器函数 必须要引入华为的sdk,http类的 强制入口文件 是bootstrap 貌似是一个类似shell的脚本。 虽然如此，不过可以用内置的nodejs py等方式配置事件函数，然后在时间函数中去curl（带token） 另外一个http的函数来实现不引用sdk的方式实现事件函数. 同时 阿里云那边支持 jwt认证，而华为这边是 Appkey\u0026amp;Appsecret 认证。\n另外华为云这边事件函数的 需要\n响应 curl -sS -LD \u0026ldquo;$HEADERS\u0026rdquo; -X GET \u0026ldquo;http://$RUNTIME_API_ADDR/v1/runtime/invocation/request\n返回 curl -X POST \u0026ldquo;http://$RUNTIME_API_ADDR/v1/runtime/invocation/response/$REQUEST_ID\u0026rdquo; -d \u0026ldquo;$RESPONSE\u0026rdquo; 华为有给出实例 https://support.huaweicloud.com/usermanual-functiongraph/functiongraph_01_0406.html#section4 最方便的无痛迁移方式，就是直接用华为给的实例代码 一次性运行 ,不然就要在原始代码中二次修改\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 cat \u0026gt;bootstrap\u0026lt;\u0026lt; \\EOF #!/bin/sh set -o pipefail while true do HEADERS=\u0026#34;$(mktemp)\u0026#34; EVENT_DATA=$(curl -sS -LD \u0026#34;$HEADERS\u0026#34; -X GET \u0026#34;http://$RUNTIME_API_ADDR/v1/runtime/invocation/request\u0026#34;) REQUEST_ID=$(grep -Fi x-cff-request-id \u0026#34;$HEADERS\u0026#34; | tr -d \u0026#39;[:space:]\u0026#39; | cut -d: -f2) if [ -z \u0026#34;$REQUEST_ID\u0026#34; ]; then continue fi $RUNTIME_CODE_ROOT/你的golang编译后的可执行文件 RESPONSE=\u0026#34;Echoing request: \u0026#39;$EVENT_DATA\u0026#39;\u0026#34; curl -sS -X POST \u0026#34;http://$RUNTIME_API_ADDR/v1/runtime/invocation/response/$REQUEST_ID\u0026#34; -d \u0026#34;$RESPONSE\u0026#34; done EOF 关于接口被刷的问题 弹性伸缩限制规则 可以设置上限，并通过报警规则处理。\n被ddos cc 短期jwt 最简单，jwt失败的好像不会计费。 但是负责分发的jwt的服务依旧存在风险。\n什么业务适合上serverless 一句话主要是 边缘微服务 其次一些比较特殊的。可以达到省钱 省精力 高可用性目的情况下才适合切换\n一定是一些非核心的业务并且不把sevless作为主服务：云也大面积宕机 一些会不定期占用大量资源的业务，免得影响主业务 代码迭代不是很频繁的业务：函数计算调试困难，日志分析功能非常依赖云厂商 某些对实时性要求不高的异步业务： 常见的比如邮件发送、数据库整理 等 核心业务主服务器的备用节点： 主服务器全部宕机的情况下可以临时顶上，这算是最大的诱惑了。毕竟平时不用维护 监控类业务：比如定时监控各个服务的状态，自动处理或者报警 其他一些特殊的，平时没访问量的：例如，企业网站的cdn回源端 线上临时使用的GPU业务 其他一些需要临时线上执行但是可能会影响自己的服务器资源占用或者会导致管理混乱的 不想暴露自己的域名和ip等信息的业务，可以用函数计算的http触发器的域名和证书 我目前适合迁移的 入口文件自动部署： 自动检索所有api节点，创建json文件分发到cdn 供物联网设备端和app搜索可以用节点 物联网设备上线离线检测功能：这个请求数和并发都不低，可用性要求极高，但是带宽占用非常低，serverless这边做备用节点。 物联网设备的历史数据上报功能：并发不高，可用性要求不高，但是带宽占用有一些，serverless这边依旧是 备用节点。 app段的接口： 并发和带宽都不高，可用性要求高，servless这边依旧是备用节点。 完全不适合迁移servless 平台管理类：这个只能内网访问，部署到servless没太大意义 消息队列服务：不适合，但是部分实时性要求不高的可以简单修改一下逻辑用servless处理。 部署方式 nodejs python 之类的都是可以在线编辑在线部署的，go java rust之类的就只能上传二进制或者docker。\n当然 go 因为编译速度飞快 非生产部署 也可以 用 go run 。\n亚马逊那边 貌似不支持 zip和文件夹上传的方式部署，只能在线编辑和docker部署。\n一些有趣的想法 gitea 等 web为主的应用 之前看到有人在serverless 部署gitea,数据持久化问题好解决，但是gitea实际上是有很多后台任务需要执行的。\n注意到 弹性伸缩限制规则 里面可以配置某一个时段保活一个实例，好像就可以解决一部分情况了。\n不过 数据每次传输量不能超过32M\n对象储存转webdav 同上\n私有化 bitwarden 同上\n对云厂商以及serverless的一些看法 跨云部署 在我调试期间 再次遇到 阿里云大面积宕机事件（2023-12-12），控制面板无法登出(2023-11-14) 腾讯云那边也不是一次两次出问题，所以跨云部署已经是必不可少的方案。\nserverless和云厂商的绑定 而传统的servless 对云厂商深度绑定，只是近几年开始有一些内卷，已经可以二进制或docker 不修改任何代码直接部署，所以如果可以尽量不绑定云厂商的sdk以及相关业务的的情况下，可以跨云部署一些函数上去。\n","date":"2023-11-13T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/up-serverless/","title":"传统项目上serverless 函数计算的 初步说明"},{"content":"firefox的新版本目前已经不支持自定义任意搜索引擎，即 自定义 https://url?keyword={关键词} 这种格式。 而 chrome和edge都可以灵活自定义。\nfirefox 旧版本是支持的，但是知道什么时候 更新后就不支持了。只能用插件方式安装，但是插件是支持的搜索引擎就那么几个也不是我们常用需要自定义的。\n找到一个曲线解决方法。 利用firefox的地址栏可以搜索书签 以及 书签可以定义关键词的功能。\n以bing 换到cn.bing.com为例，firefox默认是调用 www.bing.com 在某些环境中很卡。\n网址如下： https://cn.bing.com/search?q=111\n把这个地址添加到书签，名称随意，地址修改为 https://cn.bing.com/search?q=%s 关键词输入 cnbing（和其他的不冲突即可）\n然后地址栏输入 cnbing+空格+关键词 即可调用cn.bing.com 搜索对应关键词\n同样可以添加 github 个人博客 等等 所有支持get方式的搜索\n这个方案的缺点是 没法省略前面的关键词和空格 作为默认搜索引擎使用。\n吐槽： firefox 真的能砍，砍掉了渐变app（webapp）又砍自定义搜索引擎，如果不是因为他在linux下支持硬解，真的够够的的。\nedge的linux版本的垂直标签功能已经非常完善，不经常在线看视频的话，早点离开吧。\n附：\n跨浏览器 跨设备同步书签和密码插件推荐：\nfloccus（需要一个webdav同步 可以用nas或者坚果云） bitwarden （可以自建服务端，全平台可用 ios端为数不多的体验不错的密码管理器） ","date":"2023-11-10T20:40:20+08:00","permalink":"https://dev.leiyanhui.com/web/firefox-search-diy/","title":"firefox自定义搜索引擎"},{"content":"k2p 刷 Padavan 中继模式，在主路由维护或者更换后，k2p无法自动连接上，并给接入的设备分配ip。\n所以添加一个脚本来实现 1分钟检测一次和主路由的连接情况，如果连接正常，那么什么也不做，如果连接异常，那么30秒后重启。\nssh 登陆路由 添加一个脚本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cat \u0026gt; /etc/storage/auto_reboot.sh \u0026lt;\u0026lt; \\EOF #!/bin/bash default_gateway=\u0026#39;10.1.1.1\u0026#39; # 10.1.1.1 or 223.5.5.5 check_ip_available(){ ping -c 3 $1 | grep packets | awk \u0026#39;{print $4}\u0026#39; } sleep 30 res=`check_ip_available $default_gateway` if [ $(($res)) -eq 0 ]; then echo \u0026#34;rebooting...\u0026#34; /sbin/reboot fi echo \u0026#34;nothing need todo\u0026#34; EOF chmod +x /etc/storage/auto_reboot.sh /sbin/mtd_storage.sh save 自动定时运行脚本（每一分钟检测一次）：\n系统管理 - 服务 调度任务 (Crontab) 加入 */1 * * * * /etc/storage/auto_reboot.sh\n同样也可以修改为 检测ping 一个国内稳定的公网ip .\n旁路由方案自动切换网关 https://dev.leiyanhui.com/openwrt/auto-change-gatway/\n","date":"2023-11-10T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/route/k2p-ap-reboot/","title":"k2p Padavan 离线自动重启，中继模式检测主路由不在自动重启方案"},{"content":"简介 利用cfwork搭建 一个反向代理，相信很多人都会玩。同样我们可以在cfwork搭建一个vless节点。来实现自建一个稳定的准私有节点。\n本文记录相关操作以及如何导入到现有的clash订阅和v2rayN中。\n准备 cloudflare账号 在cloudflare中添加一个你自己的域名（非必需） 创建 创建一个cfwork 添加 一个，脚本用 https://github.com/zizifn/edgetunnel/blob/main/src/worker-vless.js 这位大佬的\n也有一些别人复制的 https://github.com/Misaka-blog/cf-wkrs-pages-vless/blob/main/_worker.js\n推荐使用Misaka的，他在原版基础上加了站点伪装和初始的proxyIP 需要修改两个地方 userID 和 proxyIP 。\nuserID可以理解为 为了隐藏我们的节点，也防止被人白嫖。 可以随便填写，也可以用在线工具生成 https://www.uuidgenerator.net proxyIP 这个是访问某一些本身部署在 cf cdn上的网站要用的，可以自己去筛选，也可以用别人已经筛选好的。 这里直接选别人的\n1 2 3 4 5 cdn-all.xn--b6gac.eu.org cdn.xn--b6gac.eu.org cdn-b100.xn--b6gac.eu.org edgetunnel.anycast.eu.org cdn.anycast.eu.org 获取节点地址 打开 https://cf分给你的域名.workers.dev/xxxx-d424-4583-b36e-524ab1f0afa4 后面是你的userid\n替换域名 workers.dev 默认是被墙的状态，需要替换成你的自己的域名，在触发器的地方添加自定义域，然后输入一个你托管在cf的域名即可。\n然后打开 https://你自己的域名v/xxxx-d424-4583-b36e-524ab1f0afa4\n注意 域名会被墙识别到，所以你最好用一个看起来正常的域名 ，当然也可以伪装。\n客户端优选ip 在线方式 这个方式凑合能用\nhttps://vfarid.github.io/cf-ip-scanner/?max=30\n本地测试方式 略微复杂一些，本地运行工具逐个测试。\n网上很多相关教程不再赘述，推荐 https://github.com/XIU2/CloudflareSpeedTest\n白嫖方式 这个方式 ，就通过你用在线或者本地优选的方式 获取到的感觉速度尚可ip 去ip反查网站，看有没有别的大佬做好的域名。然后逐个去在线ping网站ping他域名。\nhttps://ipchaxun.com/ 这里，下面选择一个低成本后缀的域名，或者域名里面在cf或者ip,或yx之类的意思的，大概率就是别人配置好的。\n这里提供几个热门ip 140.238.12.33 140.238.12.33 47.245.37.41 然后去 itdog chinaz之类的网站在线ping确认一下。\n这里直接贴几个查到的域名 443.cf.bestl.de 80.cf.bestl.de cdn.chigua.tk yx.piaosir.link cf.yumy.gay yx.pztvdiao.link yx.s2.gay yx.skyvps.link ip.zijingshan.link cdn-ip.tgbird.top yxip.tgood.eu.org cf.gzgrd.com\n同样的道理，你也可以用这种方式来搞定msdos对cf的优选ip的重写。\n最后的地址处理 无论那方式，你获取到的ip 最终都要替换到上面你的cfwork提示的vless地址的里面 vless://XXXXX-d424-4583-b36e-524ab1f0afa4@这里选择优选ip优选域名:443?encryption=none\u0026amp;security=tls\u0026amp;sni=XXXX\u0026amp;fp=randomized\u0026amp;type=ws\u0026amp;host=XXXX\u0026amp;path=%2F%3Fed%3D2048#XXXX\n附加到现有clash订阅 一般我们使用第三方转换的网站 添加上，然后再用转换网站提供的地址即可。 否则只能添加到本地的yaml文件里面\n","date":"2023-11-09T18:40:20+08:00","permalink":"https://dev.leiyanhui.com/cloudflare/vless/","title":"利用cfwokr免费搭建自己的节点"},{"content":"因为 clash for windows 作者自我开盒（不小心泄露车牌号码）随后删库导致的连锁反应，clash和clash meta 等相继把仓库设置为归档并暂时停止更新。 其实clash for windows 只是clash一个在windows的ui配置工具 ui部分基于Electron,后端还是 clash和clash meta。但是因为他比较直观并且很美观，所以使用者众多。\n目前暂时看 clash和clash meta ，应该不会一直停止更新。所以可以继续使用。\n重点：clash 和clash-mete clash-tun 依旧可以正常使用！！！\nclash meta的优点 有很多，主要分流规则完善且灵活，并且支持的协议多，基本上覆盖所有协议。但其实有两个问题。 1、在低配硬件上跑不满带宽，甚至只有带宽的10-20%\n2、配置较为繁琐，对新手不友好，甚至不少大神也对clash的配置很懵\n主流的替代软件客户端内核 比如 v2ray xray sing-box Hysteria,只是其他软件的分流和协议支持度或者易用性都没有clash好。\n这些可以不操心，其他非基于clash的客户端有：\nV2rayN (Win端)https://github.com/2dust/v2rayN/wiki/List-of-supported-cores\nv2rayA( linux + win + macos)\nv2flyNG(android) V2rayNG (android) Nekoray (win+linux) https://github.com/MatsuriDayo/nekoray\nNekobox (android)\nSurge (收费 macos ios) sing-box（全平台） IOS端：sing-box Shadowrocket QuantumultX Surge等\n上面支持linux的在openwrt上都可以用，但是另外有一些带luci界面： PassWall Bypass SSR-Plus PassWall2 VSSR (Hello World)，\n最后： 较为看好sing-box,已经有部分机场开始支持（也有一些clash转换sing-box的转换工具）ios客户端是免费的。\n","date":"2023-11-08T20:40:20+08:00","permalink":"https://dev.leiyanhui.com/route/clash-new/","title":"clash删库事件发生后的替代方案"},{"content":"局域网内非集群pve 迁移\n迁移 ct/lxc 从10.1.1.5 迁移到10.1.1.6\n我这里直接用 直接用scp迁移，我这里还是手动逐个迁移。先确定两边的储存路径\n1 2 3 4 5 pveid=3000 ssh root@10.1.1.5 \u0026#34;pct stop ${pveid}\u0026#34; scp -r root@10.1.1.5:/var/lib/vz/images/${pveid} /autofs_my/btrfs/images/${pveid} scp root@10.1.1.5:/etc/pve/lxc/${pveid}.conf /etc/pve/lxc/${pveid}.conf sed -i \u0026#34;s@rootfs: local:@rootfs: nvme_btrfs:@g\u0026#34; /etc/pve/lxc/${pveid}.conf 如果没有配置key登陆，可以用sshpass 避免每次输入密码\n1 2 3 4 5 6 7 8 9 10 apt install sshpass rootpsw=xxxx你的root密码 pveid=101 sshpass -p \u0026#34;${rootpsw}\u0026#34; ssh root@10.1.1.5 \u0026#34;pct stop ${pveid}\u0026#34; sshpass -p \u0026#34;${rootpsw}\u0026#34; scp -r root@10.1.1.5:/var/lib/vz/images/${pveid} /autofs_my/btrfs/images/${pveid} sshpass -p \u0026#34;${rootpsw}\u0026#34; scp root@10.1.1.5:/etc/pve/lxc/${pveid}.conf /etc/pve/lxc/${pveid}.conf sed -i \u0026#34;s@rootfs: local:@rootfs: nvme_btrfs:@g\u0026#34; /etc/pve/lxc/${pveid}.conf /usr/sbin/pct start ${pveid} 上面是迁移容器，因为容器的虚拟磁盘文件我们一般都按需分配的，体积一般不会太大。但是vm的话 最好先用 qm-img 转换一下 qcow2 kvm的配置文件目录修改为：/etc/pve/qemu-server/${pveid}.conf\n","date":"2023-10-31T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/move/","title":"pve 在线迁移lxc和kvm"},{"content":"lxc或者docker内直接运行tailscale up会提示\nfailed to connect to local tailscaled (which appears to be running as tailscaled, pid 4722). Got error: 503 Service Unavailable: no backend\n或者\nfailed to connect to local tailscaled (which appears to be running as tailscaled, pid 2695). Got error: Failed to connect to local Tailscale daemon for /localapi/v0/status; systemd tailscaled.service not running. Error: dial unix /var/run/tailscaled.socket: connect: no such file or directory\n即便是已经启动了 tailscaled服务也是如此，最后发现是tun的问题。\nlxc配置文件添加 两行\n1 2 lxc.cgroup2.devices.allow: c 10:200 rwm lxc.mount.entry: /dev/net dev/net none bind,create=dir 如果lxc同时运行docker,注意 上面两行要加到lxc套docker的粮行配置后面。参考配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 arch: amd64 cores: 12 features: fuse=1,mknod=1,mount=nfs;cifs,nesting=1 hostname: derper memory: 512 net0: name=eth0,bridge=vmbr0,firewall=1,gw=10.1.1.1,hwaddr=76:1A:21:0B:26:78,ip=10.1.1.211/24,ip6=dhcp,type=veth ostype: alpine rootfs: nvme_btrfs:211/vm-211-disk-0.raw,size=1G searchdomain: 10.1.1.1 swap: 0 lxc.cgroup.devices.allow: a lxc.cap.drop: lxc.cgroup2.devices.allow: c 10:200 rwm lxc.mount.entry: /dev/net dev/net none bind,create=dir 关闭ct容器 重新启动即可\ndocker下运行的花，同样需要映射 /dev/net/tun 到容器内\n","date":"2023-10-29T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/vpn/tailscale-lxc/","title":"pve lxc下使用tailscale"},{"content":"用nginx 套ssl\n1 2 3 4 5 6 7 8 docker run -itd --name derper --hostname derper \\ --restart always \\ -p 81:12345 -p 3478:3478/udp \\ -e DERP_ADDR=:12345 \\ -e DERP_DOMAIN=你的域名 \\ -e DERP_VERIFY_CLIENTS=true \\ -d ghcr.io/yangchuansheng/derper:latest # https://icloudnative.io/posts/custom-derp-servers/ curl 测试 http://10.1.1.211:81 nginx 反带 http://10.1.1.211:81 防火墙 打开 3478端口udp协议\n打开https://login.tailscale.com/admin/acls/file 在顶层添加\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u0026#34;derpMap\u0026#34;: { \u0026#34;OmitDefaultRegions\u0026#34;: false, \u0026#34;Regions\u0026#34;: {\u0026#34;900\u0026#34;: { \u0026#34;RegionID\u0026#34;: 900, \u0026#34;RegionCode\u0026#34;: \u0026#34;名字1\u0026#34;, \u0026#34;RegionName\u0026#34;: \u0026#34;名字2\u0026#34;, \u0026#34;Nodes\u0026#34;: [{ \u0026#34;Name\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;RegionID\u0026#34;: 900, \u0026#34;HostName\u0026#34;: \u0026#34;你的域名\u0026#34;, \u0026#34;DERPPort\u0026#34;: nginx的https端口, }], },\u0026#34;901\u0026#34;: { \u0026#34;RegionID\u0026#34;: 901, \u0026#34;RegionCode\u0026#34;: \u0026#34;名字1\u0026#34;, \u0026#34;RegionName\u0026#34;: \u0026#34;名字2\u0026#34;, \u0026#34;Nodes\u0026#34;: [{ \u0026#34;Name\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;RegionID\u0026#34;: 901, \u0026#34;HostName\u0026#34;: \u0026#34;你的域名\u0026#34;, \u0026#34;DERPPort\u0026#34;: nginx的https端口, }], }}, }, OmitDefaultRegions 设置是true只用自己的节点， 上的RegionID 最小数字是900 小于900为官方保留\n客户端 查看节点情况和速度\n1 tailscale netcheck ","date":"2023-10-29T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/vpn/tailscale-derper/","title":"tailscale多个Derper配置"},{"content":"dns 为什么会被泄露 因为默认情况下家庭网络的dns都是走 明文 udp的53端口。但是即便是配置了走doh/dot也会泄露。\ndns 泄露后有什么不好的 如果 你对运营商或者国内dns 发起了一个 查询某一个域名dns的请求，随后你又加密连接到了一个境外ip并传输了大流量数据。 你在干什么 就非常显而易见了。 在这个红色恐怖充斥的2023年，这是一个非常作死的事情。\n什么是dns污染 阻断和劫持 简单的说，就是 你请求了某一个公共dns,但返回的数据是错误的，或者半路被篡改掉了。\n返回错误数据 是因为国内政策要求，所以公共dns服务器对某一些域名进行了阻断，一般会返回一个本地局域网i或者随意一个国外ip。所以需要使用国外公共dns来处理一些域名的解析。 数据被篡改，只有你在明文进行dns请求的时候，返回数据被运营商或者某部门或者恶意第四方篡改掉，这种情况仅限明文dns请求的情况下。所以有了doh和dot的加密dns请求。\n什么是doh和dot dns over tls 和 dns over https 就是用用tcp tls 或者 https 加密你的 dns请求。\n一般浏览器和操作系统 都支持。\ndoh和dot可以避免污染 阻断 劫持和 泄露吗 并不能完全避免。 doh和dot是可以避免dns解析记录被中间人篡改和窥探的，但是使用国内公共dns无法解决政策原因导致的污染。\n如果你 doh/dot到 国内的 doh/dot的dns服务，那么只是你上游网络（宽带运营商）无法得知你的dns请求了而已。但是对应的国内dns服务商依旧可以得知。\n你直接使用国外加密dns,理论去是可以的避免所有问题，但是国外加密dns有三个问题：\n国内直接访问速度太慢 严重影响使用 国外加密dns都已经被干扰并且不定期阻断和重定向 无法正常稳定使用 有一些国内网站基于dns做了分地区或者一些优化，例如你访问某一个网站用的国外的dns可能会被重定向到对方的国际站点。 怎么完美解决 三句话：\n使用clash代理国外主流doh/dot的dns服务，一般情况下所有的第三方clash转换规则包括机场自带的规则 以及常见的路由器分流配置 都可以识别到这部分流量 都会帮你代理出去。 国内域名到 国内的doh/dot的dns服务商，gfw清单中的域名到国外主流doh/dot的dns服务商 如果非gfw清单中域名，但是返回了国外ip,那么到国外主流doh/dot上再次查询一次 这样就完美规避了上述所有问题。 怎么实现 mosdns分流搞定一切。如果有特殊需求，加辅助dns的上游,例如AdGuardHome和自建doh。\n怎么优雅实现 原理 使用mosdns，mosdns 判断是gfw域名直接请求 google和cf或者你的自建doh。否则请求国内doh/dot 如果请求了国内dns但是返回了一个国外ip,那么再次请求 google和cf或者你的自建doh 确认修正一次。 国内doh/dot 我们也可以作为AdGuardHome的上游，顺带去广告或者处理一下别的情况。\n最佳方案（新手推荐） mosdns 作为网内的主dns,或者路由器的上游主dns。 两个 AdGuardHome 分别处理 境外网站和国内网站，这两个AdGuardHome作为mosdns的上游dns. 这样的好处是 AdGuardHome有较为直观的webui管理界面，并顺带处理广告问题。 另外一个猴版方案 是 AdGuardHome作为主dns, mosdns作为 AdGuardHome 的上游，一样可以实现。这样省一个AdGuardHome，但是有特殊要求的情况下不适用。\n单mosdns方案（老手推荐） 也是我目前使用的方案，优点是更加灵活性能也比较好。 https://dev.leiyanhui.com/route/mosdns-all-in-one\n为什么不直接用clash自带的dns劫持 主要是自带的clash dns规则较为复杂，一不消息就会泄露dns。\n这么复杂不会拖累速度吗 不会，因为mosdns速度非常快，而且自己有良好的缓存机制。 我们使用运营商的dns他也会逐级请求上层dns,只是不需要我们配置而已。\n准备： 1、mosdns和对应的geoip.dat，geosite.dat 2、（可选）cfwork自建一个doh 3、（可选）AdGuardHome顺带去广告\nmosdns 建议docker安装 推荐 https://hub.docker.com/r/601096721/mosdns\ncfwork自建doh 因为cf和google包括其他知名国外的dns,无论是否doh/dot都被干扰了，非常不稳定甚至某些时候无法使用。 而有时候我们需要直连查询。 推荐index.js https://github.com/tina-hello/doh-cf-workers 记得绑定一个自己的域名，因为cfwork默认分配的域名本身是被墙的状态，那么你自己搭建的反向代理也就无意义了。 cfwork每个账户每天有免费10万次查询额度，自己用足够了。上面的代码中没有包含路由功能，你可以自己配置一下，防止被盗用。\n这个方式自建doh 速度肯定是不好的，因为我们一般会在clash或者软路由的分流规则直连这个地址，本身速度就不快，而且我们的自建doh实际是反向代理了一次cf的doh,所以速度方面就不用想会多快了。这只是在我们无法使用代理，并且需要正确dns的时候最后的手段。\n因为cfwork只支持http/https请求，所以不能搭建dot只能doh,理论上doh因为基于http协议需要携带http头部信息，数据包大一些，速度会慢一点，实际上两者使用体验上并无差别 上面的脚本可以适当的修改后缀，或者在cf面板中添加规则防止被别人白嫖。js语法很简单，自己看注释修改一下即可。\nAdGuardHome 为什么要AdGuardHome ？ 除了去广告之外 AdGuardHome的并发dns查询可以加快访问速度。另外ddns的域名，我们可以直接指向内网ip,这样在我们ip变化后但是ddns因为受到ttl的限制不能马上刷新的情况下不会影响内网使用。 AdGuardHome的配置较为简单 就不用多说了。dns里面加一堆国内的dot运营商即可,参考下面的上游 DNS 服务器 分别配置的阿里云 360和腾讯dnspod的dot\n1 2 3 4 5 6 tls://223.5.5.5 tls://223.6.6.6 tls://101.226.4.6 tls://123.125.81.6 tls://1.12.12.12 tls://120.53.53.53 建议全部直接用ip走dot或doh 而不是用域名 ,这样可以避免Bootstrap dns配置错误导致的问题。 你可以先用https://ip地址 访问对应的dns如果没有提示证书错误 那么他就是支持ip直连doh，那也可以ip走dot。也可以查询对应dns服务器的文档。\n在爱快和ros openwrt下如何配置 建议 mosdns和AdGuardHome都不要劫持本地的dns.而在 路由器设置吧mosdns的内网ip或者dockerip作为路由的首选dns。\n爱快3.7.7 体验版本已经支持 dns的第三方代理模式 配置主dns（mosdns）和三个备用dns（国内公共dns），虽然目前测试存在问题，但是后续版本应该会修复。\nopenclash里面怎么配置 直接吧clash的dns 所有dns全部替换为mosdns\nmosdns配置文件 mosdns 相当于是我们的核心dns了。我目前的配置如下。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 # 日志 log: level: error #日志级别。可选 \u0026#34;debug\u0026#34; \u0026#34;info\u0026#34; \u0026#34;warn\u0026#34; \u0026#34;error\u0026#34;。默认 \u0026#34;info\u0026#34; file: \u0026#34;\u0026#34; production: false # api: # http: 127.0.0.1:8888 # include: [] plugins: # forward 可以将所有的 upstream 写一起，sequence 里按需调用 \u0026#34;$插件tag 上游tag...\u0026#34;。看下一条注释。 - tag: cache type: cache args: size: 1024 lazy_cache_ttl: 0 # 自定义Hosts - tag: hosts type: hosts args: files: - \u0026#34;./hosts\u0026#34; - tag: upstreams type: forward args: upstreams: - tag: adguardhome addr: udp://10.10.1.3 #上游是境内dns enable_pipeline: true idle_timeout: 30 insecure_skip_verify: true - tag: adguardhome2 #上游是境外dns addr: udp://10.10.1.5 enable_pipeline: true idle_timeout: 30 insecure_skip_verify: true # 后面的作为备用暂时不使用,这里直接使用两个adg作为上游 - tag: cf_worker addr: https://xxxxx #自己在cfwork搭建的doh enable_pipeline: true idle_timeout: 50 insecure_skip_verify: true - tag: cloudflare_tls addr: tls://1.0.0.1 enable_pipeline: true idle_timeout: 50 insecure_skip_verify: true - tag: google_tls addr: tls://8.8.8.8 enable_pipeline: true idle_timeout: 50 insecure_skip_verify: true - tag: dnspod addr: tls://1.12.12.12 enable_pipeline: true idle_timeout: 30 insecure_skip_verify: true - tag: aliyun addr: tls://dns.alidns.com bootstrap: 223.5.5.5 enable_pipeline: true idle_timeout: 30 insecure_skip_verify: true # cn域名的规则 - tag: geosite_cn_seq type: sequence args: - exec: $upstreams adguardhome # 替换 cloudflare 的 IP 成自己的最优 IP 的规则 # 没找到txt，不用这条 # - tag: fastest_cf # type: sequence # args: # - matches: resp_ip \u0026amp;./geoip_cloudflare.txt # 是不是 cloudflare 的 IP # exec: black_hole 1.1.1.1 ::1 # 用 black_hole 强制换成这些 IP 的应答。注意，这里的 IP 只是示例不是 cloudflare 的。 # 远程域名的规则 - tag: remote_seq type: sequence args: - exec: prefer_ipv4 # 希望 remote 优先 ipv4. #- exec: $upstreams adguardhome2 cf_worker cloudflare_tls google_tls - exec: $upstreams adguardhome2 # - exec: jump fastest_cf # jump 相对于把 fastest_cf 的规则链插到此处。 # 这个 sequence 转发请求到本地，返回只包含 cn IP 的应答。(过滤掉非 cn 的应答) - tag: local_must_has_cn type: sequence args: #- exec: $upstreams adguardhome dnspod aliyun - exec: $upstreams adguardhome - matches: \u0026#34;!resp_ip \u0026amp;./geoip_cn.txt\u0026#34; exec: drop_resp # 如果应答里没有 cn IP，丢掉。 # 利用 fallback 机制按 IP 分流。如果 local 服务器返回了 cn 的应答就接受，非 cn 的应答会被丢弃，使用 remote 服务器的应答。 - tag: fallback_ip type: fallback args: primary: local_must_has_cn # 空应答(本地服务器返回了非cn IP然后应答被丢弃了)触发 fallback。 secondary: remote_seq # fallback 后就会使用 remote 的应答。 always_standby: true ############################## # 配置主 sequence 规则，作为服务器的入口。 - tag: main type: sequence args: - exec: $hosts - exec: query_summary entry #- matches: # - qname \u0026amp;./geosite_category-ads-all.txt #自带的广告过滤 # exec: reject 0 - exec: $cache - {matches: has_resp, exec: accept} # cache/hosts 等插件不再“命中记录自动跳过后续插件”，需用户自行判断是否有应答。 # 方便需要 ipset/nftables 用户定制流程。 # yaml 支持这种简写。 - matches: - qname \u0026amp;./geosite_cn.txt # cn 域名 exec: goto geosite_cn_seq # goto 到 local 规则，不在执行后续规则。 - matches: - qname \u0026amp;./geosite_geolocation-!cn.txt # 非 cn 域名 exec: goto remote_seq # goto 到 remote 规则。 - exec: $fallback_ip # 剩余域名用 ip 分流。 #### 动态路由 + cache。 # 新版的cache只会将命中的应答放在请求，不再自动终止后续规则。所以需要动态路由时，可以将 # sequence 的转发操作用 !has_resp 短路。做到每次请求都能刷新路由表。 # - tag: s1 # type: sequence # args: # - exec: $cache # - matches: # - \u0026#34;!has_resp\u0026#34; # 上一步cache命中缓存有应答了就不转发了。 # exec: $forward_remote # - exec: ipset ...... # ipset 每次请求都能执行。 ##### ####### mark 使用示例 # mark 在 exec 内是打标。在 matches 内是匹配。 # mark 当作开关的示例。 # - tag: s1 # type: sequence # args: # - exec: mark 1 2 # 先打标。 # - matches: # - mark 1 # exec: $cache # 有 mark 1 缓存会生效 # - matches: # - mark 2 # exec: ecs 1.2.3.4 # 有 mark 2 请求会被附加 ecs # ... # - matches: # - mark 3 # exec: jump fastest_cf # 没 mark 3 不会替换 cloudflare ip。 #### 最后配置 server........略 - tag: server type: udp_server # 目前有 udp/tcp/http_server args: entry: main listen: 0.0.0.0:53 - tag: server_tcp type: tcp_server args: entry: main listen: 0.0.0.0:53 - tag: \u0026#34;server_http\u0026#34; type: \u0026#34;http_server\u0026#34; args: entries: # []extry - path: /dns-query # 本路径执行 exec: main # 可执行插件的 tag。 src_ip_header: \u0026#34;X-Forwarded-For\u0026#34; # 从 HTTP 头获取用户 IP。 listen: 0.0.0.0:80 # 监听地址。 cert: \u0026#34;\u0026#34; # 留空 cert 和 key 后会禁用 TLS。 这里没有配置证书，外网使用我这里另外有acme和nginx处理https key: \u0026#34;\u0026#34; idle_timeout: 10 # 空连接超时。单位秒。默认 30。 ####### 手动更新mosdns的分流数据 601096721/mosdns的docker镜像没有添加计划任务，只有在更新镜像的时候 才会更新。 可以在容器内部执行下面的命令更新数据库文件，也可以在容器内部安装crond 定时更新。\n1 2 3 4 5 6 7 8 wget https://raw.githubusercontent.com/IceCodeNew/4Share/master/geoip_china/china_ip_list.txt -O /geoip_cn.txt wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/reject-list.txt -O /geosite_category-ads-all.txt wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/proxy-list.txt -O /geosite_geolocation-!cn.txt wget https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt -O /geosite_cn.txt cp -u /geoip_cn.txt /etc/mosdns/geoip_cn.txt cp -u /geosite_category-ads-all.txt /etc/mosdns/geosite_category-ads-all.txt cp -u /geosite_geolocation-!cn.txt /etc/mosdns/geosite_geolocation-!cn.txt cp -u /geosite_cn.txt /etc/mosdns/geosite_cn.txt 补充 adguardhome 本身可以利用规则的方式实现分流协议。有第三方作者的规则，实际测试效果不好，主要是速度不理想。\nadguardhome 搭建自己的私有doh需要强制证书，略微不方便。而mosdns 性能更好，且可以不使用证书搭建 dns over http（非https），而后用nginx+acme.sh统一反代到https。 但是mosdns没有简单方便的webui管理工具，去广告功能也没有adguardhome那么方便。所以如果不是内存特别紧张的情况下，mosdns+adguardhome依旧是新手的最佳方案。\nadguardhome 本身大概需要 40-80M内存，我在使用mosdns+双adguardhome的时候，大概需要消耗150-180M内存。\n如果对可视化管理没有需求，建议用单mosdns方案 https://dev.leiyanhui.com/route/mosdns-all-in-one\n","date":"2023-10-28T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/route/safe-dns/","title":"关于dns泄露的那些事情 路由器 mosdns分流 clash"},{"content":"前 基于 ztc1997/ikuai-bypass/ 二开的 ikuai-bypass 已经 测试完成，请阅读本文：\nhttps://dev.leiyanhui.com/route/ikuai-bypass-joyanhui/\n优点 可以接受 OpenWrt 死机/故障。完全无感 深造炸了不会有任何影响 OpenWrt关闭也不影响正常上网。 丝毫不影响ipv6,无视fake-ip模式带来的一系列问题。 爱快下内网设备同一个网络内，没有跨三层问题。 依旧可以在爱快上设置某个或者某些设备走 OpenWrt ，或者不深造。 内网流量和国内流量仅经过一个网关，没有网关损耗问题。 可以无感覆盖ipsec拨入的外网设备。 国内网站秒开，国外网站速度也不比clash差。 op和clash有问题的情况下，国外未墙网站可以正常访问。 不用操心clash自定义规则，可以用爱快完成全部分流。 不用给设备分配独立网关，所有设备都用爱快作为网关即可。 缺点 家里是多线宽带的情况，会略微复杂一些，单线的话非常简单明了。\n情况 物理机，单网卡主机。安装pve 10.1.1.5\n光猫 开桥接\npve物理机和、光猫、ap 以及其他设备都接入交换机器 pve 创建虚拟机安装爱快 10.1.1.1 lxc 或者 docker 或者 vm 运行 openwrt+openclash或者linux+clash或者v2ray等均可 top图 点击这里查看 或者恩山帖子\n原理 openwrt作为爱快的下级路由器，但是作为爱快的wan2的上级路由器，端口分流规则避免环回问题。 利用爱快的流控分流功能和自动wan检测功能，根据ip或者域名分流到openwrt再回到pppoe. 爱快默认的分流优先级顺序为：静态路由\u0026gt;域名分流\u0026gt;端口分流\u0026gt;协议分流\u0026gt;多线负载\u0026gt;默认网关。 我们要用的是 多线负载分流 和 默认网关分流。文末也有提供域名分流方法。 利用pve esxi等虚拟网卡和内部交换机功能 不增加物理设备的情况下 高效连接爱快和OpenWrt. 原理图 没想到很多人看不明白，也有朋友来询问，所以简单说明如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #爱快网口 爱快lan1[10.1.1.1] 爱快wan2[192.168.10.2] ==\u0026gt; [lan 192.168.10.1] openwrt/clash [wan 10.1.1.3] ==\u0026gt;爱快==\u0026gt;爱快wan1 爱快wan1 ==\u0026gt; pppoe/宽带运营商 #分流规则 ==\u0026gt; gfw域名 =\u0026gt; 固定走爱快wan2 [==\u0026gt;openwrt] 访问请求 ==\u0026gt; 国内ip =\u0026gt; 固定走爱快wan1 ==\u0026gt; 其他情况且wan2可用 =\u0026gt; 爱快wan2 [==\u0026gt;openwrt] ==\u0026gt; 其他情况且wan2不可用 =\u0026gt; 爱快wan1 ==\u0026gt; 来自openwrt的流量 ==\u0026gt;爱快wan1 #避免回到wan2死循环 ==\u0026gt; 其他自定义规则 =\u0026gt; 爱快wan1或者wan2自由配置 #dns DNS请求 ==\u0026gt; 爱快DNS加速==\u0026gt;第三方代理模式==\u0026gt;mosdns可用 ==\u0026gt;mosdns/adg ==\u0026gt;mosdns不可用 ==\u0026gt; 备用dns（爱快3.7.7,需要20秒左右才能切换） 网口设置 爱快 三个虚拟网口\n1 2 3 4 5 6 7 8 lan1 10.1.1.1 wan1 pppoe wan2 IP：192.168.10.2 网关：192.168.10.1 掩码：255.255.255.0 默认网关： √ 设此条线路为默认网关 自动切换： √ 掉线自动切换 线路检测：HTTP www.google.com 或者 ping 192.168.10.1 openwrt 两个虚拟网口\n1 2 3 4 5 6 7 8 br-lan lan 静态ip IPv4 地址：192.168.10.1 IPv4 掩码：255.255.255.0 IPv4 网关 留空 IPv4 广播地址 留空 DHCP服务器 √ 忽略此接口 wan eth1 DHCP客户端 （去爱快的静态dhcp里面给配置为 10.1.1.3） wan6 不用管，你开启ipv6 和wan配置为DHCP客户端的情况下，wan6会自动获取ipv6地址 此时，相当于 openwrt作为爱快的下级路由器，但是作为爱快的wan2的上级路由器。下面会添加一个端口分流规则避免环回问题。\n爱快分流规则 1 2 3 4 5 6 访问请求 ==\u0026gt; 爱快判断请求中的域名或者ip 如果请求是gfw的域名 ==\u0026gt; wan2 (流控分流\u0026gt;分流设置\u0026gt;域名分流) 如果请求的ip是国内ip ==\u0026gt; wan1直连 (流控分流\u0026gt;分流设置\u0026gt;多线负载) (自定义运营商添加国内所有ip地址) 其他情况且wan2可用 ==\u0026gt; wan2 （因为上文中吧wan2设置为默认了） 其他情况且wan2不可用 ==\u0026gt; wan1直连 如果流量是来自openwrt ==\u0026gt; wan1 (流控分流\u0026gt;分流设置\u0026gt;端口分流)把10.1.1.3(openwrt)定向到wan1避免环回 辅助工具和其他说明 ztc1997/ikuai-bypass 可以自动给爱快添加gwf域名列表和国内ip地址列表，并可以自动更新。\n后文中的openwrt可以运行在kvm docker lxc 都可以无影响，爱快内的docker和kvm也可以。 这个方案适合pve esxi unraid 。 如果是kvm 这个方案中所有的网口都要用 virtio 性能是最好的，可以最低的资源占用跑满。\nopenwrt 可以用lxc/docker/kvm运行的普通linux+clash替代，开ipv4和ipv6转发就好 。\n准备工作 后面是原始记录\n爱快设备 我这里是pve 用vm运行的设备。先添加两个虚拟网卡，一个做wan一个做lan, 配置wan1到 eth1 pppoe 配置lan1 到 eth0 ip配置为10.1.1.1 配置dhcp 为 10.1.1.X段 dns为10.1.1.1 ，配置dns 输入两个国内正常的dns,先配置DNS加速模式 为代理模式 doh https://doh.pub/dns-query 这样接入爱快的设备 均可正常上网，只是不能深造学习。 再添加一个虚拟网卡 并从pve关闭爱快后重新打开,爱快中可以看到多了一个 eth2 备用\n深造设备 可以用lxc docker 或者 vm 都可以 看自己。 也可以物理设备 n1 之类的。 我这里因为是pve,所以 lxc 运行了一个 openwrt+openclash. openwrt 需要注意的是这里的openwrt不是旁路由模式，所以需要添加两个虚拟网卡 用于lan(192.168.10.1)和wan(10.1.1.3 也可以从爱快dhcp) 正常lxc或者vm安装openwrt。配置好深造。 然后找一个电脑或者vm/lxc ip设置为 和lan同一个网段的ip 网关和dns都配置为192.168.10.1. wan 口也可以配置为dhcp,然后在爱快里给他静态分配一个也可以。\n手动ip v4 配置方法 先确保关闭爱快和\n国内ip v4地址列表 先看手动添加方法，文末有自动维护方法。 https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt 如果没有深造，可以用https://ghproxy.com/https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt 这个地址打开 因为爱快一次只能输入5000个ip,但是国内的ip地址有6000多条，我们需要前5000条和后面1000多条分两次插入。 所以把上面的地址复制到一个支持行数显示的文本编辑器里面。备用。\n爱快内配置国内ipv4 爱快 流控分流\u0026gt;多线负载\u0026gt;自定义运营商. 添加运营商 名称叫做 国内 ip地址粘贴前5000条 备注国内1 同样后面的1000多条 也粘贴进来 名称也是叫做国内 备注 国内2\n分流 爱快 流控分流\u0026gt;多线负载，点添加 负载模式：源IP+目的IP+目的端口 运营商 选择国内 负载比例：wan1 1 点操作后面的开启。然后保存\nwan2 然后返回 网络设置 \u0026gt; 内外网设置 创建一个接口 wan2 ，绑定到 eth2。使用静态ip 192.168.10.2 ，网关为192.168.10.1（openwrt的地址）\n下面 勾选 设此条线路为默认网关 和 掉线自动切换 可以设置为:线路检测 HTTP 检测地址 google.com 这样当 OpenWrt 不能正常访问国外网，流量会切换到 wan1 也可以 线路检测：ping 检测地址 192.168.10.1 ,这个地址是 OpenWrt 的 lan 地址，检查它的存在与否，用来确定是不是要将流量切换到 wan1 。\n设置openwrt出口强制为wan1 不然 外网ip会分流到op又再次分流会wan2到openwrt 死循环。 爱快 流控分流 \u0026gt; 分流设置 \u0026gt; 端口分流 添加一条规则 分流方式：外网 线路 wan1 IP/分组： 添加openwrt的wan地址 10.1.1.3\n打开ipv6 测试没有问题的时候，爱快 网络设置 \u0026gt; IPv6 \u0026gt; IPv6设置 wan1 DHCPv6客户端(动态获取) 启用 openwrt 系统 设置向导 启用 ipv6 （没有这个选项的固件可能需要 另外配置）\n关闭openwrt的dhcp 因为我这里 都是虚拟网卡 理论上都会接入唯一的主交换机，所以爱快和op都开dhcp的话，有可能会有冲突。所以关掉openwrt的dchp. 网络 接口 lan 关闭 dhcp\n进阶 ipv4 地址列表 https://github.com/17mon/china_ip_list https://github.com/Loyalsoldier/geoip/tree/release/text https://ispip.clang.cn/all_cn.txt\nipv6 地址列表 https://ispip.clang.cn/all_cn_ipv6.txt\n基于域名的 https://github.com/Loyalsoldier/v2ray-rules-dat/tree/release\ndocker自动更新规则 https://github.com/ztc1997/ikuai-bypass ztc1997大佬的docker支持自动更新ip列表和gfw域名列表。支持爱快内docker运行或者其他能访问爱快面板的地方运行。支持定时任务。 配制文件优化如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 ## 本文件/data/ikuai-bypass/config.yml ## /data/ikuai-bypass/ 映射到 /etc/ikuai-bypass ## 爱快管理页面的 URL，结尾不要加 \u0026#34;/\u0026#34;， ## 如不填写，则使用第一个接口的网关地址作为爱快地址， ikuai-url: http://10.1.1.1 #爱快地址 username: admin # 爱快用户名 password: ****** # 爱快密码 cron: 0 4 * * * # 执行更新的周期 crontab custom-isp: # 自定义运营商 - name: 国内 # 自定义运营商名称cnip就直接走wan1 非cnip走在默认可用的情况下走默认即wan2 ## 自定义运营商 cidr 列表网址，每行一个，超过5000行会自动分为多个，ipv6 地址会被删除 url: https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/cn.txt ## 下面的ip 可以分别添加到到wan2的 多线负载 规则 - name: telegram url: https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/telegram.txt - name: google url: https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/google.txt - name: twitter url: https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/twitter.txt - name: facebook url: https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/geoip/release/text/facebook.txt stream-domain: # 域名分流 被墙的域名 无脑走wan2 - interface: wan2 # 分流线路 src-addr: 10.1.1.5-10.1.1.250 # 分流的源地址 我这边10.1.1.1是爱快 2/4是AP 3是openwrt ## 域名列表网址，每行一个，超过1000行会自动分为多个 url: https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/gfw.txt - interface: wan2 src-addr: 10.1.1.5-10.1.1.250 url: https://ghproxy.com/https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/greatfire.txt 这个容器在更新的时候只会删除 备注名称为IKUAI_BYPASS的规则，自己添加的规则不会有影响。\n去广告和dns加速 adguardhome 配制 爱快的dns加速即可。 adg 分流 https://github.com/mouyase/ChinaListForAdGuardHome/\n也可以不单独分流，直接一股脑把dns全部写入 也可以.\n另外最好用 爱快 3.7.7 版本，目前是体验版 ikuai9.com:555/1/main/iKuai_x86_beta 直接后台直接上传升级。3.7.7 的第三方代理加速模式支持设置备用dns.可以在adguardhome关闭或者宕机保证正常。\n关于ipv6 上面ipv4 正常后，op和爱快这边都可以打开ipv6 可以正常支持。\n部分配置截图 默认上传到imgur 请挂深度学习工具查看，也可能失效\n爱快 网络设置 \u0026gt; 内外网设置 点击查看imgur\n爱快 wan2 设置 点击查看imgur\n爱快 基于ip的分流设置 点击查看imgur\n爱快 基于ip的自定义运营商的设置，红框部分由ztc1997/ikuai-bypass自动管理 点击查看imgur 爱快 基于域名的设置 红框部分由ztc1997/ikuai-bypass自动管理 点击查看imgur 爱快 强制openwrt的出口流量走wan1的设置 10.1.1.3是爱快通过dhcp给openwrt分配的域名 点击查看imgur 爱快内kvm运行的openwrt的配置 pve/lxc/docker运行都是一样，关键是需要两个虚拟网口 点击查看imgur openwrt 两个网口的设置 点击查看imgur\n附lxc的openwrt配置文件 cat /etc/pve/lxc/103.conf\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 arch: amd64 cores: 12 hostname: op memory: 512 net0: name=eth0,bridge=vmbr0,hwaddr=1A:C2:8D:8D:56:70,type=veth net1: name=eth1,bridge=vmbr0,hwaddr=EA:49:A6:98:4D:59,type=veth ostype: unmanaged rootfs: nvme_btrfs:103/vm-103-disk-0.raw,size=512M swap: 0 lxc.include: /usr/share/lxc/config/openwrt.common.conf lxc.cgroup2.devices.allow: c 108:0 rwm lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file lxc.mount.entry: /dev/net dev/net none bind,create=dir lxc.cap.drop: lxc.cgroup2 适合pve7-8版本 旧版是 lxc.cgroup\n/dev/ppp 因为这里op不需要拨号所以非必需 /dev/net 是 clash-tun要用的\n附ikuai的kvm配置文件 cat /etc/pve/qemu-server/101.conf\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 agent: 1 boot: order=scsi0;ide2;net0 cores: 12 cpu: host ide2: nvme_btrfs:iso/iKuai8_x64_3.7.6_Build202309081651.iso,media=cdrom,size=52604K machine: q35 memory: 4096 meta: creation-qemu=8.0.2,ctime=1698058265 name: ikuai net0: virtio=F6:9E:AC:C8:3B:64,bridge=vmbr0,firewall=1 net1: virtio=0A:58:E2:6F:14:21,bridge=vmbr0,firewall=1 net2: virtio=DA:36:A5:E6:93:9B,bridge=vmbr0,firewall=1 numa: 0 onboot: 1 ostype: l26 scsi0: nvme_btrfs:101/vm-101-disk-0.qcow2,cache=unsafe,iothread=1,size=4G scsihw: virtio-scsi-single smbios1: uuid=cd6edce3-e6d4-44e2-abd7-f6907dcaf34c sockets: 1 vmgenid: 42a99cea-820b-48fe-9ef5-2989a97e9758 可以用3.7.6安装后升级到3.7.7\n三个虚拟网口\n本文另外发布到恩山帖 https://www.right.com.cn/forum/thread-8310402-1-1.html\n本文参考 https://www.right.com.cn/forum/thread-8252571-1-1.html\n","date":"2023-10-23T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/route/ikuai-bypass-gfw/","title":"爱快无感分流"},{"content":"monit 基本命令 1 2 3 4 monit # 默认文件启动 /etc/monit/monitrc monit -c /XXX/_config/monit/monitrc # 以指定配置文件启动 monit reload -c /XXX/_config/monit/monitrc #重载 monit procmatch \u0026#34;/usr/bin/ddns-go\u0026#34; #测试正则表达式 适合 没有pid的进程 monit 基本配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 set daemon 5 # 多久检测一次 # with start delay 240 # 第一次检查 延迟 多久，默认启动后就检查 #set log /var/log/monit.log set log /XXX/log/monit.log # set pidfile /var/run/monit.pid # 没太大必要 set pidfile /XXX/pid/monit.pid # set idfile /var/.monit.id 设置Monit实例的id文件路径。id文件记录了Monit实例的唯一ID（标识），id在第一次Monit启动时生成并存储。默# 认情况下，文件放置在$HOME/.monit.id #set idfile /var/lib/monit/id #set idfile /monit/id set idfile /XXX/pid/monit.idfile # set statefile /var/.monit.state #保存监视状态的Monit状态文件的位置 #set statefile /var/lib/monit/state set statefile /XXX/pid/monit.state set eventqueue basedir /XXX/pid/monit.events # 设置存储事件的基本目录 slots 100 # 可选择限制队列大小 set httpd port 8022 and #这里允许公网访问 不绑定ip with ssl { pemfile:/XXX/my_ssl/domain_aio.pem # 二合一证书文件 selfsigned: allow #允许自签名 } allow 用户名:密码 include /XXX/_config/monit/include/*.conf #包含文件 常用配置 几个注意点 守护进程 优先使用pid，其次再选择 matching 进程名称 启动和关闭进程优先使用/etc/init.d/ monitrc 文件 权限必须是700 include的文件权限无所谓 控制sshd 1 2 3 4 5 6 7 check process sshd with pidfile /run/sshd.pid start program = \u0026#34;/etc/init.d/ssh start\u0026#34; with timeout 120 seconds stop program = \u0026#34;/usr/bin/killall sshd\u0026#34; with timeout 120 seconds ---- 或者 mkdir -p /run/sshd 后- --------- check process sshd with matching \u0026#34;/usr/sbin/sshd\u0026#34; if does not exist then exec \u0026#34;/usr/sbin/sshd\u0026#34; stop program = \u0026#34;/usr/bin/killall sshd\u0026#34; with timeout 120 seconds 注意 /etc/init.d/ssh stop 无法彻底关闭sshd\n控制crontab 1 2 3 check process crontab with pidfile /var/run/crond.pid start program = \u0026#34;/etc/init.d/cron start\u0026#34; with timeout 120 seconds stop program = \u0026#34;/etc/init.d/cron stop\u0026#34; with timeout 120 seconds 注意crontabl是使用 /usr/sbin/cron 而不是 /usr/bin/crontab\n控制ddns-go 等没有pid的 1 2 3 check process ddns-go with matching \u0026#34;ddns-go\u0026#34; if does not exist then exec \u0026#34;/usr/bin/ddns-go\u0026#34; stop program = \u0026#34;/usr/bin/killall ddns-go\u0026#34; with timeout 120 seconds 指定用户运行redis 1 2 3 4 5 check process redis6001 with pidfile /XXX/pid/redis6001.pid start program = \u0026#34;/bin/su - userRedis -c \u0026#39;/usr/bin/redis-server /XXX/_config/redis/redis6001.conf \u0026amp;\u0026#39; \u0026#34; with timeout 120 seconds stop program = \u0026#34;/bin/su - userRedis -c \u0026#39;/usr/bin/redis-cli -p 6001 -a 密码 -h localhost SHUTDOWN \u0026amp; /usr/bin/sleep 5 \u0026amp;\u0026amp;/usr/bin/kill -9 $( lsof -t -i:6001)\u0026#39;\u0026#34; with timeout 120 seconds 控制rclone挂载 1 2 3 4 5 CHECK FILESYSTEM rclone_dev_log PATH /localPath start program = \u0026#34;/usr/bin/rclone mount --allow-other --daemon oss-qd:xxx/ /localPath/ --config /XXX/_config/rclone.conf\u0026#34; with timeout 120 seconds stop program = \u0026#34;/usr/bin/fusermount -u /localPath \u0026#34; with timeout 120 seconds 多用户环境这里 注意 \u0026ndash;allow-other 参数 不然其他用户无法访问\n","date":"2023-10-21T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/monit-exp/","title":"monit常用例子和坑"},{"content":"xfce xfce4 比较稳，开箱即用，该有的功能都有。 美化比较简单，如果不是非要用wayland的 很不错。 xfce4默认给你创建的面板2实际是一个启动器而不是dock，需要自己另外处理一下。\nkde 和gnome kde和gnome 自定义功能复杂，而且很多无法实现。 gnome多数自定义功能需要插件来，但是随着版本更新很多插件会失效。即便如此gnome的个性化和自定义功能还是非常有限，而且部分功能实现起来非常复杂。 kde自定义功能要比gnome多很多，但是很多都是面板配置，直接修改配置文件需要熟悉他的配置项，太多太复杂，没有必要浪费精神。\ndwm 和 i3 这两个我长期使用的桌面，dwm入坑，随后几个月后就转入i3 并长期使用。 dwm除了修改配置需要重新编译之外，也就只有基础的一些功能。相对来说i3的功能更加完善。 这两个桌面 性能都非常好，在低配机器上相应速度也非常流畅，在xrdp远程环境下工作也良好。\nwayfire 目前还是初级阶段，折腾并使用过一段时间，很多常规窗口管理的热键尚不支持。而且遇到几次整个桌面闪掉回退到tty的情况。 平铺模式下 很多常用热键不支持，也无法自行配置。 不过waybar确实不错。 多屏幕管理有一点问题。\nopenbox 堆叠桌面的轻量选择，需要自己简单配置一下热键和右键菜单。并配合 tin2 或者plank使用。 作为堆叠桌面，够用。作为平铺桌面使用的话非常不方便。\nawesome 目前使用的。 awesome 还是比较推荐的，他有以下几个优点\n优点 开箱即用 并且同时支持平铺和堆叠 默认配置文件和官方文档提供了丰富的实例，只要有编程基础不需要会lua语言就可以轻松个性化。 因为基于lua的配置下所以进阶使用功能比i3丰富很多 堪称牛逼。 和i3 、dwm 一样的稳定性兼容性 在低配电脑上工作良好 在xrdp和vnc模式下 同样反应速度很快 可以单独某一个屏幕使用浮动窗口 罗列几个lua配置可以实现的一些i3和其他轻量级桌面无法很优雅实现的功能。 可以用 popup 和 tasklist 两个组件 实现 alt+tab 的功能 ，而i3下一般是使用rofi来实现。自己实现的会更加灵活。 窗口的rules 控制规则可以更精细，甚至可以精确到某一个应用的某一个对话框、设置框。当然i3 支持 应用默认在固定的桌面/显示器 都是支持的。 因为lua本身就是一个强大的语言，所以可以实现一个不依赖python 获取其他语言的 纯lua实现的一些小插件到awesome 同样组件组合的功能，可以实现比polybar更加丰富和美观的bar 多个菜单的组合 会更加灵活 整个桌面功能，可以只需要一个配置文件（rc.lua）不需要其他任何依赖。 缺点 基于lua的配置文件，很多平铺桌面党多数是选的i3 中文资料较少 会劝退很多人。 x11转发到本地的窗口在平铺模式下 修改窗口大小 会有一点拖影。 我的awesome配置 可能有一定的滞后性，最新的可以查看 https://github.com/joyanhui/desktop-cfg/tree/main/.config/awesome\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683 684 685 686 687 688 689 690 691 692 693 694 695 696 697 698 699 700 701 702 703 704 705 706 707 708 709 710 711 712 713 714 715 716 717 718 719 720 721 722 723 724 725 726 727 728 729 730 731 732 733 734 735 736 737 738 739 740 741 742 743 744 745 746 747 748 749 750 751 752 753 754 755 756 757 758 759 760 761 762 763 764 765 766 767 768 769 770 771 772 773 774 775 776 777 778 779 780 781 782 783 784 785 786 787 788 789 790 791 792 793 794 795 796 797 798 799 800 801 802 803 804 805 806 807 808 809 810 811 812 813 814 815 816 817 818 819 820 821 822 823 824 825 826 827 828 829 830 831 832 833 834 835 836 837 838 839 840 841 842 843 844 845 846 847 848 849 850 851 852 853 854 855 856 857 858 859 860 861 862 863 864 865 866 867 868 869 870 871 872 873 874 875 876 877 878 879 880 881 882 883 884 -- If LuaRocks is installed, make sure that packages installed through it are -- found (e.g. lgi). If LuaRocks is not installed, do nothing. pcall(require, \u0026#34;luarocks.loader\u0026#34;) -- Standard awesome library local gears = require(\u0026#34;gears\u0026#34;) local awful = require(\u0026#34;awful\u0026#34;) require(\u0026#34;awful.autofocus\u0026#34;) -- Widget and layout library local wibox = require(\u0026#34;wibox\u0026#34;) -- Theme handling library local beautiful = require(\u0026#34;beautiful\u0026#34;) -- Notification library local naughty = require(\u0026#34;naughty\u0026#34;) local menubar = require(\u0026#34;menubar\u0026#34;) local hotkeys_popup = require(\u0026#34;awful.hotkeys_popup\u0026#34;) -- Enable hotkeys help widget for VIM and other apps -- when client with a matching name is opened: require(\u0026#34;awful.hotkeys_popup.keys\u0026#34;) -- Load Debian menu entries local debian = require(\u0026#34;debian.menu\u0026#34;) local has_fdo, freedesktop = pcall(require, \u0026#34;freedesktop\u0026#34;) -- 跟随启动 local function run_once(cmd_arr) for _, cmd in ipairs(cmd_arr) do awful.spawn.with_shell(string.format(\u0026#34;pgrep -u $USER -fx \u0026#39;%s\u0026#39; \u0026gt; /dev/null || (%s)\u0026#34;, cmd, cmd)) end end -- 部分 透明 run_once({\u0026#34;compton\u0026#34;}) -- 网络 run_once({\u0026#34;nm-tray\u0026#34;}) -- plank 如果在左右侧面 会遮挡 bar部分区域导致无法点击，cairo-dock也有这个问题 --run_once({ \u0026#34;plank\u0026#34; }) -- tint2 没意义，不如配置一下 awful.widget.tasklist --run_once({\u0026#34;tint2\u0026#34;}) -- 随机壁纸 run_once({\u0026#34;/usr/bin/feh --randomize --bg-fill ~/bg/* \u0026#34;}) --awful.spawn.with_shell(\u0026#34;\u0026#34;) --awful.spawn.with_shell(\u0026#34;sh .config/polybar/polybar_run.sh\u0026#34;) -- {{{ Error handling -- Check if awesome encountered an error during startup and fell back to -- another config (This code will only ever execute for the fallback config) if awesome.startup_errors then naughty.notify({preset = naughty.config.presets.critical, title = \u0026#34;Oops, there were errors during startup!\u0026#34;, text = awesome.startup_errors}) end -- Handle runtime errors after startup do local in_error = false awesome.connect_signal(\u0026#34;debug::error\u0026#34;, function (err) -- Make sure we don\u0026#39;t go into an endless error loop if in_error then return end in_error = true naughty.notify({preset = naughty.config.presets.critical, title = \u0026#34;Oops, an error happened!\u0026#34;, text = tostring(err)}) in_error = false end) end -- }}} -- {{{ Variable definitions -- Themes define colours, icons, font and wallpapers. 壁纸 和主题等 -- ls /usr/share/awesome/themes default gtk sky xresources zenburn -- beautiful.init(gears.filesystem.get_themes_dir() .. \u0026#34;default/theme.lua\u0026#34;) beautiful.init(string.format(\u0026#34;%s/.config/awesome/themes/my-zenburn/theme.lua\u0026#34;, os.getenv(\u0026#34;HOME\u0026#34;))) -- This is used later as the default terminal and editor to run. terminal = \u0026#34;x-terminal-emulator\u0026#34; editor = os.getenv(\u0026#34;EDITOR\u0026#34;) or \u0026#34;editor\u0026#34; editor_cmd = terminal .. \u0026#34; -e \u0026#34; .. editor -- Default modkey. -- Usually, Mod4 is the key with a logo between Control and Alt. -- If you do not like this or do not have such a key, -- I suggest you to remap Mod4 to another key using xmodmap or other tools. -- However, you can use another modifier like Mod1, but it may interact with others. modkey = \u0026#34;Mod4\u0026#34; -- 可用布局 awful.layout.layouts = { awful.layout.suit.tile, -- 布局类似： 左右 口三 awful.layout.suit.floating, --浮动 awful.layout.suit.corner.nw, -- 主窗 的 右侧和下部 环绕小窗 awful.layout.suit.magnifier, -- 主窗口 固定在屏幕中央 其他窗口 横向平铺到背景 --[[ awful.layout.suit.tile.left, -- 左右 三口 awful.layout.suit.spiral,-- 复杂布局 左侧大 右上 1/4 右下 N口 awful.layout.suit.spiral.dwindle, -- 复杂布局 左侧大 右上 1/4 右下 口N awful.layout.suit.tile.bottom, -- 上下 口 三 awful.layout.suit.tile.top, -- 上下 三口 awful.layout.suit.fair, -- 左右 三二 布局 awful.layout.suit.fair.horizontal, --上下 三二 布局 awful.layout.suit.max, awful.layout.suit.max.fullscreen, -- 活动窗口全屏 awful.layout.suit.corner.ne, - 主窗 的 左侧侧和下部 环绕小窗 awful.layout.suit.corner.sw, -- 主窗 的 右侧和顶部 环绕小窗 awful.layout.suit.corner.se, - 主窗 的 左侧侧和上部 环绕小窗 --]] } -- }}} -- {{{ Menu -- Create a launcher widget and a main menu myawesomemenu = { {\u0026#34;查看热键\u0026#34;, function() hotkeys_popup.show_help(nil, awful.screen.focused()) end}, {\u0026#34;查看手册\u0026#34;, terminal .. \u0026#34; -e man awesome\u0026#34;}, -- { \u0026#34;随即壁纸\u0026#34;, awful.spawn.with_shell(\u0026#34;/usr/bin/feh --randomize --bg-fill ~/bg/\u0026#34;)}, {\u0026#34;随机壁纸\u0026#34;, function() awful.spawn.with_shell(\u0026#34;/usr/bin/feh --randomize --bg-fill ~/bg/*\u0026#34;) end}, {\u0026#34;编辑配置\u0026#34;, editor_cmd .. \u0026#34; \u0026#34; .. awesome.conffile}, {\u0026#34;重启as\u0026#34;, awesome.restart}, {\u0026#34;退出桌面\u0026#34;, function() awesome.quit() end}, } local menu_awesome = {\u0026#34;awesome\u0026#34;, myawesomemenu, beautiful.awesome_icon} local menu_terminal = {\u0026#34;open terminal\u0026#34;, terminal} local menu_alacritty = {\u0026#34;打开 alacritty\u0026#34;, \u0026#34;alacritty\u0026#34;} local menu_exitmenu = {\u0026#34;exit menu(Esc)\u0026#34;, \u0026#34;\u0026#34;} if has_fdo then mymainmenu = freedesktop.menu.build({ before = {menu_awesome}, after = {menu_terminal, menu_alacritty, menu_exitmenu}}) else mymainmenu = awful.menu({ items = { menu_awesome, {\u0026#34;Debian\u0026#34;, debian.menu.Debian_menu.Debian}, menu_terminal, menu_alacritty, menu_exitmenu }}) end mylauncher = awful.widget.launcher({image = beautiful.awesome_icon, menu = mymainmenu}) -- Menubar configuration menubar.utils.terminal = terminal -- Set the terminal for applications that require it -- }}} -- Keyboard map indicator and switcher mykeyboardlayout = awful.widget.keyboardlayout() -- {{{ Wibar -- Create a textclock widget --mytextclock = wibox.widget.textclock() mytextclock = wibox.widget.textclock(\u0026#39;%H:%M\u0026#39;) -- 只要时间 不要日期 -- Create a wibox for each screen and add it local taglist_buttons = gears.table.join( awful.button({}, 1, function(t) t:view_only() end), awful.button({modkey}, 1, function(t) if client.focus then client.focus:move_to_tag(t) end end), awful.button({}, 3, awful.tag.viewtoggle), awful.button({modkey}, 3, function(t) if client.focus then client.focus:toggle_tag(t) end end), awful.button({}, 4, function(t) awful.tag.viewnext(t.screen) end), awful.button({}, 5, function(t) awful.tag.viewprev(t.screen) end)) local function set_wallpaper(s) -- Wallpaper if beautiful.wallpaper then local wallpaper = beautiful.wallpaper -- If wallpaper is a function, call it with the screen if type(wallpaper) == \u0026#34;function\u0026#34; then wallpaper = wallpaper(s) end gears.wallpaper.maximized(wallpaper, s, true) end end -- Re-set wallpaper when a screen\u0026#39;s geometry changes (e.g. different resolution) screen.connect_signal(\u0026#34;property::geometry\u0026#34;, set_wallpaper) awful.screen.connect_for_each_screen(function(s) -- Wallpaper set_wallpaper(s) -- Each screen has its own tag table. awful.tag({\u0026#34;1\u0026#34;, \u0026#34;2\u0026#34;, \u0026#34;3\u0026#34;, \u0026#34;4\u0026#34;, \u0026#34;5\u0026#34;, \u0026#34;6\u0026#34;, \u0026#34;7\u0026#34;, \u0026#34;8\u0026#34;, \u0026#34;9\u0026#34;}, s, awful.layout.layouts[1]) -- Create a promptbox for each screen s.mypromptbox = awful.widget.prompt() -- Create an imagebox widget which will contain an icon indicating which layout we\u0026#39;re using. -- We need one layoutbox per screen. s.mylayoutbox = awful.widget.layoutbox(s) s.mylayoutbox:buttons(gears.table.join( awful.button({}, 1, function () awful.layout.inc(1) end), awful.button({}, 3, function () awful.layout.inc(-1) end), awful.button({}, 4, function () awful.layout.inc(1) end), awful.button({}, 5, function () awful.layout.inc(-1) end))) s.mylayoutbox.forced_height = 18 s.mylayoutbox.forced_width = 18 s.mylayoutbox.opacity = 0.5 local mylayoutbox = wibox.container.margin(s.mylayoutbox, 0, 0, 2, 0) -- 设置容器的边距 -- Create a taglist widget s.mytaglist = awful.widget.taglist { screen = s, filter = awful.widget.taglist.filter.all, buttons = taglist_buttons } --[[ local tasklist_buttons = gears.table.join( awful.button({}, 1, function (c) -- 左键 默认是 如果是焦点那么最小化 否则切换为焦点 --if c == client.focus then -- 如果是焦点那么最小化 -- c.minimized = true --else -- c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;tasklist\u0026#34;, {raise = true}) -- 否则切换为焦点 --end -- 左键修改为 就替换到对应tag 因为主要用平铺 c.minimized = false -- 取消最小化 awful.tag.viewonly(c.first_tag) --切换到窗口所在屏幕 -- 取消其他窗口的 activate {{ local current_screen = awful.screen.focused() for _, cl in ipairs(current_screen.clients) do if cl ~= c and not cl.minimized then cl:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;tasklist\u0026#34;, {raise = false}) end end c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;tasklist\u0026#34;, {raise = true}) -- 重新绘制任务栏 s.mytasklist:emit_signal(\u0026#34;widget::redraw_needed\u0026#34;) -- 将鼠标移动到激活的窗口的中心位置 client.focus = c c:raise() local geo = c:geometry() local x = geo.x + geo.width / 2 local y = geo.y + geo.height / 2 mouse.coords({x = x, y = y}, true) end), awful.button({}, 3, function() awful.menu.client_list({theme = {width = 250}}) end), -- 右键 显示所有窗口 awful.button({}, 4, function () awful.client.focus.byidx(1) end), --滚轮切换窗口 焦点 awful.button({}, 5, function () awful.client.focus.byidx(-1) end) --滚轮切换窗口 ) -- Create a tasklist widget 任务栏 默认显示图标和文字 s.mytasklist = awful.widget.tasklist { screen = s, filter = awful.widget.tasklist.filter.currenttags, -- 显示当前标签页中的任务 filter = awful.widget.tasklist.filter.alltags, -- 显示所有标签页中的任务 buttons = tasklist_buttons -- 任务栏按键点击行为 } -- ]] -- 定义点击任务栏的行为 local tasklist_buttons = gears.table.join( awful.button({}, 1, function (c) -- 左键修改为 就切换到对应tag 因为主要用平铺 c.minimized = false -- 取消最小化 awful.tag.viewonly(c.first_tag) --切换到窗口所在屏幕 c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;tasklist\u0026#34;, {raise = true}) -- 激活窗口 end), awful.button({}, 3, function() awful.menu.client_list({theme = {width = 250}}) end), -- 右键 显示所有窗口 awful.button({}, 4, function () awful.client.focus.byidx(1) end), --滚轮切换窗口 焦点 awful.button({}, 5, function () awful.client.focus.byidx(-1) end) --滚轮切换窗口 ) -- 任务栏的配置 s.mytasklist = awful.widget.tasklist { screen = s, filter = awful.widget.tasklist.filter.allscreen, -- awful.widget.tasklist.filter.focused buttons = tasklist_buttons, -- 按钮行为控制函数 只是鼠标的控制就好 style = { shape_border_width = 1, shape_border_color = \u0026#39;#555\u0026#39;, shape = gears.shape.rounded_bar, }, layout = { spacing = 5, --间隔 layout = wibox.layout.flex.horizontal -- 横向排列 }, widget_template = { { { { -- 任务栏图标 { id = \u0026#39;icon_role\u0026#39;, widget = wibox.widget.imagebox, }, margins = 3, --用边距控制图标大小 widget = wibox.container.margin, }, { -- 任务栏文字 id = \u0026#39;text_role\u0026#39;, widget = wibox.widget.textbox, }, layout = wibox.layout.fixed.horizontal, }, left = 2, right = 2, widget = wibox.container.margin }, --forced_width = 10000, id = \u0026#39;background_role\u0026#39;, widget = wibox.container.background, }, } -- Create the wibox 状态栏 -- s.mywibox = awful.wibar({ position = \u0026#34;bottom\u0026#34;, screen = s }) s.mywibox = awful.wibar({position = \u0026#34;top\u0026#34;, screen = s}) s.mywibox.opacity = 0.8 --状态栏整体透明度 shell_pot = awful.widget.watch(\u0026#39;echo 🔸\u0026#39;, 3600000) -- 一个分隔符 shell_space = awful.widget.watch(\u0026#39;echo -e \u0026#34;　\u0026#34; \u0026#39;, 3600000) --中文全角空格 shell_weather = awful.widget.watch(\u0026#39;bash -c \u0026#34;python3 ~/.config/topbar_plus/weather-plugin.py\u0026#34;\u0026#39;, 1800) --天气预报 shell_weather:buttons(gears.table.join( awful.button({}, 1, function() awful.spawn(\u0026#34;xdg-open http://www.weather.com.cn/weather15d/101120802.shtml\u0026#34;) end), -- 左键 awful.button({}, 3, function() awful.spawn(\u0026#34;xdg-open http://www.weather.com.cn/weather15d/101120802.shtml\u0026#34;) end)--右键 )) shell_lunarDate = awful.widget.watch(\u0026#39;bash -c \u0026#34;$HOME/.env/lunarDate_plugin/bin/python ~/.config/topbar_plus/lunarDate-plugin.py\u0026#34;\u0026#39;, 1) -- 农历阳历周 shell_lunarDate:buttons(gears.table.join( awful.button({}, 1, function() awful.spawn(\u0026#34;xdg-open https://wannianli.tianqi.com/\u0026#34;) end), -- 左键 awful.button({}, 3, function() awful.spawn(\u0026#34;xdg-open https://wannianli.tianqi.com/\u0026#34;) end)--右键 )) local vicious = require(\u0026#34;vicious\u0026#34;) -- 监测 CPU 使用情况 cpuwidget = wibox.widget.textbox() vicious.cache(vicious.widgets.cpu) vicious.register(cpuwidget, vicious.widgets.cpu, \u0026#34;CPU: \u0026lt;span foreground=\u0026#39;#20B2AA\u0026#39;\u0026gt; $1% \u0026lt;/span\u0026gt;\u0026#34;, 13) memwidget = wibox.widget.textbox() vicious.cache(vicious.widgets.mem) vicious.register(memwidget, vicious.widgets.mem, \u0026#34;内存: \u0026lt;span foreground=\u0026#39;#20B2AA\u0026#39;\u0026gt; $1% \u0026lt;/span\u0026gt;\u0026#34;, 13) -- 托盘 mysystray = wibox.widget.systray() --mysystray.forced_width =50 --mysystray.forced_height=10 -- 直接用 forced_width 会导致图标多的时候图标太小，forced_height貌似无效，所以下面把托盘放到容器里面，控制容器边距变相修改托盘大小 local mysystray_container = wibox.container.margin(mysystray, 0, 0, 4, 5) -- 设置容器的边距 [, left[, right[, top[, bottom[, color[, draw_empty]]]]]] -- 音量 volume_widget = wibox.widget.textbox() --awful.widget.watch(\u0026#39;bash -c \u0026#34;LANG=en_US.utf8 \u0026amp;\u0026amp; pactl list sinks | grep \\\u0026#39;front-left\\\u0026#39; \u0026amp;\u0026amp; pactl list sinks | grep \\\u0026#39;Mute:\\\u0026#39; \u0026#34;\u0026#39;, 1, function(widget, stdout) awful.widget.watch(\u0026#39;bash -c \u0026#34;LANG=en_US.utf8 \u0026amp;\u0026amp; pactl list sinks | grep -E \\\u0026#39;front-left|Mute:\\\u0026#39;\u0026#34; \u0026#39;, 1, function(widget, stdout) -- 从输出中获取音量信息 local volume = string.match(stdout, \u0026#34;(%d+)%%\u0026#34;) -- 从输出中获取静音状态信息 local mute = string.match(stdout, \u0026#34;Mute: (%a+)\u0026#34;) -- 更新文本框内容 local text = \u0026#39; 🔈\u0026lt;span foreground=\u0026#34;#20B2AA\u0026#34;\u0026gt;\u0026#39; .. volume .. \u0026#39;\u0026lt;/span\u0026gt; %\u0026#39; if mute == \u0026#34;yes\u0026#34; then text = \u0026#39; 🔇\u0026lt;span foreground=\u0026#34;#ce2605\u0026#34;\u0026gt;\u0026#39; .. volume .. \u0026#39;\u0026lt;/span\u0026gt; %\u0026#39; end widget:set_markup(text) -- widget:set_text(text) end, volume_widget) -- 音量 按键操作 volume_widget:buttons(gears.table.join( awful.button({}, 1, function() awful.spawn(\u0026#34;pactl set-sink-mute @DEFAULT_SINK@ toggle\u0026#34;) end), -- 左键静音 awful.button({}, 3, function() awful.spawn(\u0026#34;pavucontrol\u0026#34;) end), --右键打开 面板 awful.button({}, 4, function() awful.spawn(\u0026#34;pactl set-sink-volume @DEFAULT_SINK@ +1%\u0026#34;) end), -- 向上滚动增大音量 另外绑定键盘的 音量键在 音量控制 那边 awful.button({}, 5, function() awful.spawn(\u0026#34;pactl set-sink-volume @DEFAULT_SINK@ -1%\u0026#34;) end)-- 向下滚动减小音量 )) -- 滚轮事件处理 volume_widget:connect_signal(\u0026#34;button::scroll_up\u0026#34;, function() awful.spawn(\u0026#34;pactl set-sink-volume @DEFAULT_SINK@ +5%\u0026#34;) end) volume_widget:connect_signal(\u0026#34;button::scroll_down\u0026#34;, function() awful.spawn(\u0026#34;pactl set-sink-volume @DEFAULT_SINK@ -5%\u0026#34;) end) -- Add widgets to the wibox 状态栏布局 排序 全局标题栏 s.mywibox:setup { layout = wibox.layout.align.horizontal, {-- Left widgets layout = wibox.layout.fixed.horizontal, mylauncher, s.mytaglist, s.mypromptbox, }, s.mytasklist, -- Middle widget {-- Right widgets layout = wibox.layout.fixed.horizontal, cpuwidget, memwidget, shell_pot, shell_weather, shell_pot, shell_lunarDate, shell_space, mytextclock, shell_pot, volume_widget, shell_space, --mykeyboardlayout, -- wibox.widget.systray(), mysystray_container, shell_space, mylayoutbox, }, } end) -- }}} -- {{{ Mouse bindings 这里是屏幕空白地方的鼠标操作 root.buttons(gears.table.join( awful.button({}, 3, function () mymainmenu:toggle() end), --右键打开主菜单 awful.button({}, 4, awful.tag.viewnext), -- 滚轮切换标签 不是窗口 awful.button({}, 5, awful.tag.viewprev))) -- 滚轮切换标签 -- }}} -- {{{ Key bindings 按键绑定 globalkeys = gears.table.join( awful.key({modkey, }, \u0026#34;s\u0026#34;, hotkeys_popup.show_help, {description = \u0026#34;show help 显示快捷键\u0026#34;, group = \u0026#34;awesome\u0026#34;}), awful.key({modkey, }, \u0026#34;Left\u0026#34;, awful.tag.viewprev, --切换标签 {description = \u0026#34;view previous 切换标签\u0026#34;, group = \u0026#34;tag\u0026#34;}), awful.key({modkey, }, \u0026#34;Right\u0026#34;, awful.tag.viewnext, {description = \u0026#34;view next 切换标签\u0026#34;, group = \u0026#34;tag\u0026#34;}), --切换标签 awful.key({modkey, }, \u0026#34;Escape\u0026#34;, awful.tag.history.restore, --返回标签 {description = \u0026#34;go back 返回标签\u0026#34;, group = \u0026#34;tag\u0026#34;}), awful.key({modkey, }, \u0026#34;j\u0026#34;, -- 切换 窗口焦点 function () awful.client.focus.byidx(1) end, {description = \u0026#34;focus next by index 切换 窗口焦点\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, }, \u0026#34;k\u0026#34;, -- 切换 窗口焦点 function () awful.client.focus.byidx(-1) end, {description = \u0026#34;focus previous by index 切换 窗口焦点\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, }, \u0026#34;w\u0026#34;, function () mymainmenu:show() end, -- 显示主菜单 {description = \u0026#34;show main menu 显示主菜单\u0026#34;, group = \u0026#34;awesome\u0026#34;}), -- Layout manipulation awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;j\u0026#34;, function () awful.client.swap.byidx(1) end, -- 移动窗口位置 {description = \u0026#34;swap with next client by index\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;k\u0026#34;, function () awful.client.swap.byidx(-1) end, -- 移动窗口位置 {description = \u0026#34;swap with previous client by index\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;j\u0026#34;, function () awful.screen.focus_relative(1) end, {description = \u0026#34;focus the next screen\u0026#34;, group = \u0026#34;screen\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;k\u0026#34;, function () awful.screen.focus_relative(-1) end, {description = \u0026#34;focus the previous screen\u0026#34;, group = \u0026#34;screen\u0026#34;}), awful.key({modkey, }, \u0026#34;u\u0026#34;, awful.client.urgent.jumpto, {description = \u0026#34;jump to urgent client\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, }, \u0026#34;Tab\u0026#34;, function () awful.client.focus.history.previous() if client.focus then client.focus:raise() end end, {description = \u0026#34;go back\u0026#34;, group = \u0026#34;client\u0026#34;}), -- Standard program --awful.key({ modkey, }, \u0026#34;Return\u0026#34;, function () awful.spawn(terminal) end, awful.key({modkey, }, \u0026#34;Return\u0026#34;, function () awful.spawn(\u0026#34;alacritty\u0026#34;) end, {description = \u0026#34;open a terminal 打开终端\u0026#34;, group = \u0026#34;launcher\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;r\u0026#34;, awesome.restart, --保留awesome的 win ctrl+r 配置出错的时候 只能用这个快捷键重载 {description = \u0026#34;reload awesome 重载aw\u0026#34;, group = \u0026#34;awesome\u0026#34;}), awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;s\u0026#34;, awesome.restart, --和i3一致方便过度 {description = \u0026#34;reload awesome 重载aw\u0026#34;, group = \u0026#34;awesome\u0026#34;}), --awful.key({ modkey, \u0026#34;Shift\u0026#34; }, \u0026#34;q\u0026#34;, awesome.quit, --- {description = \u0026#34;推出 awesome \u0026#34;, group = \u0026#34;awesome\u0026#34;}), -- 推出 awesome awful.prompt -- awful.key({ modkey, \u0026#34;Shift\u0026#34; }, \u0026#34;e\u0026#34;, function() -- awful.prompt.run { -- prompt = \u0026#34;确定要退出 Awesome WM 吗？ (y/n): \u0026#34;, -- textbox = awful.screen.focused().mypromptbox.widget, -- exe_callback = function(answer) -- if answer == \u0026#34;y\u0026#34; then -- awesome.quit() -- end -- end -- } -- end, { description = \u0026#34;退出 Awesome WM\u0026#34;, group = \u0026#34;awesome\u0026#34; }) -- 推出 awesome ，用naughty.notify --awful.key({ modkey, \u0026#34;Shift\u0026#34; }, \u0026#34;e\u0026#34;, function() -- naughty.notify({ -- text = \u0026#34;　确定要退出 Awesome WM 吗？　\\n　如果要推出输入y,不推出按下esc正常操作　\u0026#34;, -- timeout = 3, -- position = \u0026#34;bottom_right\u0026#34;, -- bg = \u0026#34;#FF0000\u0026#34;, -- fg = \u0026#34;#FFFFFF\u0026#34;, -- font = \u0026#34;sans 25\u0026#34; -- }) -- awful.prompt.run { -- prompt = \u0026#34;\u0026#34;, -- textbox = awful.screen.focused().mypromptbox.widget, -- exe_callback = function(answer) -- if answer == \u0026#34;y\u0026#34; then -- awesome.quit() -- end -- end -- } --end, { description = \u0026#34;确定退出 Awesome WM\u0026#34;, group = \u0026#34;awesome\u0026#34; }), -- 和i3 一致 推出 awesome -- 依赖 zenity awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;e\u0026#34;, function() local command = \u0026#34;zenity --question --text \u0026#39;确定要退出 Awesome WM 吗？\u0026#39; --no-wrap --title \u0026#39;亲爱哒\u0026#39;\u0026#34; awful.spawn.easy_async_with_shell(command, function(_, _, _, exit_code) if exit_code == 0 then awesome.quit() end end) end, {description = \u0026#34;确定退出 Awesome WM\u0026#34;, group = \u0026#34;awesome\u0026#34;}), awful.key({modkey, }, \u0026#34;l\u0026#34;, function () awful.tag.incmwfact(0.05) end, {description = \u0026#34;increase master width factor + 主宽度\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, }, \u0026#34;h\u0026#34;, function () awful.tag.incmwfact(-0.05) end, {description = \u0026#34;decrease master width factor - 主宽度\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;h\u0026#34;, function () awful.tag.incnmaster(1, nil, true) end, {description = \u0026#34;增加主区域的窗口数量\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;l\u0026#34;, function () awful.tag.incnmaster(-1, nil, true) end, {description = \u0026#34;减少主区域的窗口数量\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;h\u0026#34;, function () awful.tag.incncol(1, nil, true) end, {description = \u0026#34;增加列的数量\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;l\u0026#34;, function () awful.tag.incncol(-1, nil, true) end, {description = \u0026#34;减少列的数量\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, }, \u0026#34;space\u0026#34;, function () awful.layout.inc(1) end, {description = \u0026#34;select next 布局模式\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;space\u0026#34;, function () awful.layout.inc(-1) end, {description = \u0026#34;select previous 布局模式\u0026#34;, group = \u0026#34;layout\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;n\u0026#34;, function () local c = awful.client.restore() -- Focus restored client if c then c:emit_signal( \u0026#34;request::activate\u0026#34;, \u0026#34;key.unminimize\u0026#34;, {raise = true}) end end, {description = \u0026#34;restore minimized 恢复最小化的\u0026#34;, group = \u0026#34;client\u0026#34;}), -- Prompt awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;Return\u0026#34;, function () awful.spawn(\u0026#34;rofi -show drun\u0026#34;) end, {description = \u0026#34;rofi -show drun 启动器\u0026#34;, group = \u0026#34;launcher\u0026#34;}), awful.key({modkey}, \u0026#34;Tab\u0026#34;, function () awful.spawn(\u0026#34;rofi -show window\u0026#34;) end, {description = \u0026#34;rofi -show window 窗口切换\u0026#34;, group = \u0026#34;launcher\u0026#34;}), awful.key({modkey}, \u0026#34;p\u0026#34;, function () awful.spawn(\u0026#34;/usr/bin/flameshot gui \u0026#34;) end, {description = \u0026#34;flameshot gui 截图 \u0026#34;, group = \u0026#34;launcher\u0026#34;}), awful.key({modkey}, \u0026#34;e\u0026#34;, function () awful.spawn(\u0026#34;pcmanfm \u0026#34;) end, {description = \u0026#34;pcmanfm 文件管理器 \u0026#34;, group = \u0026#34;launcher\u0026#34;}), -- 运行命令 这个用rofi替代掉 -- awful.key({ modkey ,\u0026#34;Shift\u0026#34;,\u0026#34;Alt\u0026#34;}, \u0026#34;r\u0026#34;, function () awful.screen.focused().mypromptbox:run() end, -- {description = \u0026#34;run prompt此功能关闭\u0026#34;, group = \u0026#34;launcher\u0026#34;}), -- 运行lua代码 不需要 -- awful.key({ modkey ,\u0026#34;Shift\u0026#34; ,\u0026#34;Alt\u0026#34; }, \u0026#34;x\u0026#34;, -- function () -- awful.prompt.run { -- prompt = \u0026#34;Run Lua code: \u0026#34;, -- textbox = awful.screen.focused().mypromptbox.widget, -- exe_callback = awful.util.eval, -- history_path = awful.util.get_cache_dir() .. \u0026#34;/history_eval\u0026#34; -- } -- end, -- {description = \u0026#34;lua execute prompt此功能关闭\u0026#34;, group = \u0026#34;awesome\u0026#34;}), -- 音量控制 awful.key({}, \u0026#34;XF86AudioRaiseVolume\u0026#34;, function() os.execute(\u0026#34;pactl set-sink-volume @DEFAULT_SINK@ +5%\u0026#34;) end, {description = \u0026#34;volume up\u0026#34;, group = \u0026#34;hotkeys\u0026#34;}), awful.key({}, \u0026#34;XF86AudioLowerVolume\u0026#34;, function() os.execute(\u0026#34;pactl set-sink-volume @DEFAULT_SINK@ -5%\u0026#34;) end, {description = \u0026#34;volume down\u0026#34;, group = \u0026#34;hotkeys\u0026#34;}), awful.key({}, \u0026#34;XF86AudioMute\u0026#34;, function() os.execute(\u0026#34;pactl set-sink-mute @DEFAULT_SINK@ toggle\u0026#34;) end, {description = \u0026#34;toggle mute\u0026#34;, group = \u0026#34;hotkeys\u0026#34;}) -- Menubar 应用程序菜单 不需要，rifo 以及右键菜单以及右上角 mylauncher = awful.widget.launcher 都可以搞定 --awful.key({ modkey ,\u0026#34;Shift\u0026#34;}, \u0026#34;p\u0026#34;, function() menubar.show() end, -- {description = \u0026#34;show the menubar 应用程序菜单\u0026#34;, group = \u0026#34;launcher\u0026#34;}) ) clientkeys = gears.table.join( awful.key({modkey, }, \u0026#34;f\u0026#34;, function (c) c.fullscreen = not c.fullscreen c:raise() end, {description = \u0026#34;toggle fullscreen全屏\u0026#34;, group = \u0026#34;client\u0026#34;}), --[[ awful.key({ modkey, \u0026#34;Shift\u0026#34; }, \u0026#34;c\u0026#34;, function (c) c:kill() end, awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;q\u0026#34;, function (c) c:kill() end, {description = \u0026#34;close关闭窗口\u0026#34;, group = \u0026#34;client\u0026#34;}), local window_title = focused_client.name or \u0026#34;\u0026#34; -- 构建 Zenity 命令 local command = string.format(\u0026#34;zenity --question --text \u0026#39;%s\u0026#39; --no-wrap --title \u0026#39;亲爱哒\u0026#39;\u0026#34;, window_title) --]] awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;q\u0026#34;, function(c) local window_title = c.name or \u0026#34;\u0026#34; --窗口标题 local command = string.format(\u0026#34;zenity --question --text \u0026#39;确定要关闭 %s 吗？\u0026#39; --no-wrap --title \u0026#39;亲爱哒\u0026#39;\u0026#34;, window_title) awful.spawn.easy_async_with_shell(command, function(_, _, _, exit_code) if exit_code == 0 then c:kill() end end) end, {description = \u0026#34;确定退出 窗口\u0026#34;, group = \u0026#34;awesome\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;space\u0026#34;, awful.client.floating.toggle, {description = \u0026#34;toggle floating浮动\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;Return\u0026#34;, function (c) c:swap(awful.client.getmaster()) end, {description = \u0026#34;move to master主区域\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, }, \u0026#34;o\u0026#34;, function (c) c:move_to_screen() end, {description = \u0026#34;move to screen\u0026#34;, group = \u0026#34;client\u0026#34;}), awful.key({modkey, }, \u0026#34;t\u0026#34;, function (c) c.ontop = not c.ontop end, {description = \u0026#34;toggle keep on top\u0026#34;, group = \u0026#34;client\u0026#34;}), -- 隐藏和显示标题栏 awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;b\u0026#34;, function (c) awful.titlebar.toggle(c) end, {description = \u0026#34;Show/Hide Titlebars隐藏和显示标题栏\u0026#34;, group = \u0026#34;client\u0026#34;}), -- 最小化 awful.key({modkey, }, \u0026#34;n\u0026#34;, function (c) -- The client currently has the input focus, so it cannot be -- minimized, since minimized clients can\u0026#39;t have the focus. c.minimized = true end, {description = \u0026#34;minimize 最小化\u0026#34;, group = \u0026#34;client\u0026#34;}), -- 最大化 awful.key({modkey, }, \u0026#34;m\u0026#34;, function (c) c.maximized = not c.maximized c:raise() end, {description = \u0026#34;(un)maximize 最大化\u0026#34;, group = \u0026#34;client\u0026#34;}), -- 垂直最大化 awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;m\u0026#34;, function (c) c.maximized_vertical = not c.maximized_vertical c:raise() end, {description = \u0026#34;(un)maximize vertically 垂直最大化\u0026#34;, group = \u0026#34;client\u0026#34;}), -- 水平最大化 awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;m\u0026#34;, function (c) c.maximized_horizontal = not c.maximized_horizontal c:raise() end, {description = \u0026#34;(un)maximize horizontally 水平最大化\u0026#34;, group = \u0026#34;client\u0026#34;})) -- Bind all key numbers to tags. -- Be careful: we use keycodes to make it work on any keyboard layout. -- This should map on the top row of your keyboard, usually 1 to 9. for i = 1, 9 do globalkeys = gears.table.join(globalkeys, -- View tag only 切换桌面 awful.key({modkey}, \u0026#34;#\u0026#34; .. i + 9, function () local screen = awful.screen.focused() local tag = screen.tags[i] if tag then tag:view_only() end end, {description = \u0026#34;view tag #\u0026#34;..i, group = \u0026#34;tag\u0026#34;}), -- Toggle tag display.合并两个桌面的窗口 awful.key({modkey, \u0026#34;Control\u0026#34;}, \u0026#34;#\u0026#34; .. i + 9, function () local screen = awful.screen.focused() local tag = screen.tags[i] if tag then awful.tag.viewtoggle(tag) end end, {description = \u0026#34;toggle tag #\u0026#34; .. i, group = \u0026#34;tag\u0026#34;}), -- Move client to tag. 移动窗口到桌面x awful.key({modkey, \u0026#34;Shift\u0026#34;}, \u0026#34;#\u0026#34; .. i + 9, function () if client.focus then local tag = client.focus.screen.tags[i] if tag then client.focus:move_to_tag(tag) end end end, {description = \u0026#34;move focused client to tag #\u0026#34;..i, group = \u0026#34;tag\u0026#34;}), -- Toggle tag on focused client. 窗口同时显示到桌面x awful.key({modkey, \u0026#34;Control\u0026#34;, \u0026#34;Shift\u0026#34;}, \u0026#34;#\u0026#34; .. i + 9, function () if client.focus then local tag = client.focus.screen.tags[i] if tag then client.focus:toggle_tag(tag) end end end, {description = \u0026#34;toggle focused client on tag #\u0026#34; .. i, group = \u0026#34;tag\u0026#34;})) end -- 窗口的点击事件 clientbuttons = gears.table.join( awful.button({}, 1, function (c) c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;mouse_click\u0026#34;, {raise = true}) --鼠标左键单击：激活该窗口（如果没有激活），并将其置于顶层。 end), awful.button({modkey}, 1, function (c) c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;mouse_click\u0026#34;, {raise = true}) -- Mod 键 + 鼠标左键单击：激活该窗口，并开始移动窗口位置。 awful.mouse.client.move(c) end), awful.button({modkey}, 3, function (c) c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;mouse_click\u0026#34;, {raise = true}) -- Mod 键 + 鼠标右键单击：激活该窗口，并开始改变窗口大小。 awful.mouse.client.resize(c) end)) -- Set keys root.keys(globalkeys) -- }}} -- {{{ Rules -- Rules to apply to new clients (through the \u0026#34;manage\u0026#34; signal). -- 规则 awful.rules.rules = { -- All clients will match this rule. {rule = {}, properties = {border_width = beautiful.border_width, border_color = beautiful.border_normal, focus = awful.client.focus.filter, raise = true, keys = clientkeys, buttons = clientbuttons, -- 窗口点击事件 screen = awful.screen.preferred, placement = awful.placement.no_overlap + awful.placement.no_offscreen }}, -- Floating clients. 内置的自动浮动规则 {rule_any = { instance = { \u0026#34;DTA\u0026#34;, -- Firefox addon DownThemAll. \u0026#34;copyq\u0026#34;, -- Includes session name in class. \u0026#34;pinentry\u0026#34;, }, class = { \u0026#34;Arandr\u0026#34;, \u0026#34;Blueman-manager\u0026#34;, \u0026#34;Gpick\u0026#34;, \u0026#34;Kruler\u0026#34;, \u0026#34;MessageWin\u0026#34;, -- kalarm. \u0026#34;Sxiv\u0026#34;, \u0026#34;Tor Browser\u0026#34;, -- Needs a fixed window size to avoid fingerprinting by screen size. \u0026#34;Wpa_gui\u0026#34;, \u0026#34;veromix\u0026#34;, \u0026#34;xtightvncviewer\u0026#34;}, -- Note that the name property shown in xprop might be set slightly after creation of the client -- and the name shown there might not match defined rules here. name = { \u0026#34;Event Tester\u0026#34;, -- xev. }, role = { \u0026#34;AlarmWindow\u0026#34;, -- Thunderbird\u0026#39;s calendar. \u0026#34;ConfigManager\u0026#34;, -- Thunderbird\u0026#39;s about:config. \u0026#34;pop-up\u0026#34;, -- e.g. Google Chrome\u0026#39;s (detached) Developer Tools. }}, properties = {floating = true}}, -- Add titlebars to normal clients and dialogs 标题栏 {rule_any = {type = {\u0026#34;normal\u0026#34;, \u0026#34;dialog\u0026#34;}}, properties = {titlebars_enabled = true}}, -- xprop|grep CLASS 自动隐藏标题栏的软件 无标题栏 {rule_any = { class = { \u0026#34;Sublime_text\u0026#34;, \u0026#34;Geany\u0026#34;, \u0026#34;Code\u0026#34;, \u0026#34;Plank\u0026#34;, \u0026#34;QQ\u0026#34;, \u0026#34;TelegramDesktop\u0026#34;, \u0026#34;Chromium\u0026#34;, \u0026#34;Google-chrome\u0026#34;, \u0026#34;Firefox-esr\u0026#34;, \u0026#34;Microsoft-edge\u0026#34;, \u0026#34;org.remmina.Remmina\u0026#34;, \u0026#34;another-redis-desktop-manager\u0026#34;, \u0026#34;Thonny\u0026#34;, \u0026#34;Thunar\u0026#34;}, }, properties = {titlebars_enabled = false}}, -- xprop|grep CLASS 强制默认平铺 {rule_any = { class = { \u0026#34;Microsoft-edge\u0026#34;, }, }, properties = {floating = false}}, -- xprop|grep CLASS 自动浮动的软件 但不控制窗口位置 {rule_any = { class = { \u0026#34;Plank\u0026#34;, \u0026#34;tint2\u0026#34;, \u0026#34;Tint2\u0026#34; }, }, properties = {floating = true}}, -- xprop|grep CLASS 自动浮动的软件 并居中显示 {rule_any = { name={\u0026#34;图片查看器\u0026#34;}, class = { \u0026#34;Pavucontrol\u0026#34;, \u0026#34;fcitx5-config-qt\u0026#34;, \u0026#34;Tint2conf\u0026#34;,\u0026#34;vlc\u0026#34; }, }, properties = {floating = true, placement = awful.placement.centered} }, } -- }}} -- {{{ Signals -- Signal function to execute when a new client appears. client.connect_signal(\u0026#34;manage\u0026#34;, function (c) -- Set the windows at the slave, -- i.e. put it at the end of others instead of setting it master. -- if not awesome.startup then awful.client.setslave(c) end if awesome.startup and not c.size_hints.user_position and not c.size_hints.program_position then -- Prevent clients from being unreachable after screen count changes. awful.placement.no_offscreen(c) end end) -- Add a titlebar if titlebars_enabled is set to true in the rules. client.connect_signal(\u0026#34;request::titlebars\u0026#34;, function(c) -- buttons for the titlebar local buttons = gears.table.join( awful.button({}, 1, function() c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;titlebar\u0026#34;, {raise = true}) awful.mouse.client.move(c) end), awful.button({}, 3, function() c:emit_signal(\u0026#34;request::aRctivate\u0026#34;, \u0026#34;titlebar\u0026#34;, {raise = true}) awful.mouse.client.resize(c) end)) -- 窗口的标题栏配置 awful.titlebar(c) : setup { {-- Left awful.titlebar.widget.iconwidget(c), buttons = buttons, layout = wibox.layout.fixed.horizontal }, {-- Middle {-- Title align = \u0026#34;center\u0026#34;, widget = awful.titlebar.widget.titlewidget(c)}, buttons = buttons, layout = wibox.layout.flex.horizontal }, {-- Right 标题右侧 awful.titlebar.widget.floatingbutton (c), awful.titlebar.widget.maximizedbutton(c), awful.titlebar.widget.stickybutton (c), awful.titlebar.widget.ontopbutton (c), awful.titlebar.widget.closebutton (c), layout = wibox.layout.fixed.horizontal()}, layout = wibox.layout.align.horizontal, -- 默认隐藏标题栏 此代码会覆盖掉前面rule中的配置 --awful.titlebar.hide(c) } end) -- Enable sloppy focus, so that focus follows mouse. client.connect_signal(\u0026#34;mouse::enter\u0026#34;, function(c) c:emit_signal(\u0026#34;request::activate\u0026#34;, \u0026#34;mouse_enter\u0026#34;, {raise = false}) end) client.connect_signal(\u0026#34;focus\u0026#34;, function(c) c.border_color = beautiful.border_focus end) client.connect_signal(\u0026#34;unfocus\u0026#34;, function(c) c.border_color = beautiful.border_normal end) -- }}} ","date":"2023-10-18T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/light-desktop/","title":"linux下轻量级桌面对比和选择"},{"content":"场景 远程机器（可以是 docker lxc） ，没有装图形桌面，但是装了edge浏览器。 本地使用x11 转发打开edge后 播放视频没声音。 远程机器 是 lxc debian12 本地是 pve 装了桌面\n简明 1 2 apt install pipwaire pulseaudio-module-zeroconf # 两边都装 apt install avahi-daemon # 本地安装 本地 1 2 3 sudo systemctl status avahi-daemon.service # 确定一下状态 默认安装后会自动启动，如果没有手动启动一下这个服务 pactl load-module module-native-protocol-tcp listen=10.1.1.6 # listen=10.1.1.6 可以不输入，但是不能有错误 pactl load-module module-zeroconf-publish avahi-daemon 需要使用5353 端口，注意防火墙\n远程 1 pactl load-module module-zeroconf-discover 然后远程打开一个有声音输入的软件 就可以了 例如远程机器上 cat ~/start.sh\n1 2 3 4 5 6 7 8 9 10 11 12 export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=@im=fcitx export SDL_IM_MODULE=fcitx export GLFW_IM_MODULE=ibus killall fcitx5 -9 fcitx5 \u0026amp; pactl load-module module-zeroconf-discover #firefox \u0026amp; microsoft-edge-stable \u0026amp; 本地\n1 2 3 4 5 pactl load-module module-native-protocol-tcp pactl load-module module-zeroconf-publish ssh -X yanhui@10.1.1.231 #----- sh ~/start.sh 走的的坑 pactl load-module module-native-protocol-tcp 这个命令在第二次运行的时候 会提示 未知错误，实际上有效的。\n其他一些工具 paprefs 貌似不适合 pipewire qpwgraph 可用，可以用两边检查连接状态 ，或者局域网内有多个avahi的情况下手动调整。正常运行的时候 远程段的qpwgraph 是可以看到本地的音频设备。 正常是播放声音的app 连接到 目标机器的 内置数字立体声的play_back 就好了。\n","date":"2023-10-17T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/pipwire-remote/","title":"debian下x11和pipewire网络播放声音的方法 "},{"content":"i3用了很久难免有一丢丢腻歪，尤其是丑陋的标题栏哈。 wayfire 启动 平铺桌面，也就是simple-tile\n启动平铺和屏幕的配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 [core] plugins = \\ #.....其他插件 simple-tile #.....其他配置 # 平铺窗口的配置 [simple-tile] # 移动窗口 button_move=\u0026lt;super\u0026gt; # 平铺窗口大小 button_resize=\u0026lt;super\u0026gt; # 指定更改焦点时是否保持全屏状态。如果为true，则下一个聚焦窗口也将变为全屏。如果为false，则退出全屏。默认值为true。 keep_fullscreen_on_adjacent=true # 切换焦点 key_focus_above =\u0026lt;super\u0026gt; KEY_UP key_focus_below =\u0026lt;super\u0026gt; KEY_DOWN key_focus_left =\u0026lt;super\u0026gt; KEY_LEFT key_focus_right =\u0026lt;super\u0026gt; KEY_RIGHT # 切换平铺 key_toggle = \u0026lt;super\u0026gt; \u0026lt;shift\u0026gt; KEY_C # 为符合指定条件的窗口启用平铺。默认值为all,这里 tile_by_default = (floating is false) # 设置平铺窗口间隔 inner_gap_size = 0 # 窗口之间间距 outer_vert_gap_size = 0 #屏幕上下间距 outer_horiz_gap_size= 0 #屏幕左右间距 目前遇到的几个问题 在热重载配置文件的时候，平铺的窗口大概率会变成浮动 。但是窗口最小化再恢复后可以转换为平铺。 窗口的浮动和平铺 状态不太容易 直观的区分，当你要对他进行对应的操作的时候，发现y的不是浮动/屏幕的 有焦点移动热键，没有办法用热键移动窗口的平铺位置 同样也没有热键修改平铺窗口大小的功能。 平铺模式 拖动窗口大小，会有闪烁挺难受。 看wiki的说明，平铺是用的白名单制，和i3的刚好相反。没有去看源码不知道是否可以黑名单，或者浮动白名单。 有几个键名称不知道怎么写，有一些在默认配置文件里面但是无效，貌似也不支持键码 手动用key_toggle切换为浮动的窗口 最小化后，再恢复又会变成平铺。但是貌似不是每个软件都会如此。 窗口浮动后，再次平铺，不会回到原位置（这\u0026hellip; 真的蛋疼！！！！） 部分软件在平铺模式下缩小的过小，会直接缩放窗口内容当然大概率也会变形模糊看不清。目前遇到sublimeText和remmina debian系统源里的waybar在wayfire下 workapce/桌面 暂时是无法在waybar显示编号和标注当前窗口的（需要自己编译启动warbar的实验选项） 部分软件的对话框 都不会被自动浮动，然后给你平铺到同屏幕上。自然也是变形模糊不清。即便是配置了tile_by_default = (floating is false) 也有概率出现。 waybar 的wlr/taskbar 有概率会导致窗口从别的桌面跑到当前桌面。解决八法就是\u0026quot;wlr/taskbar\u0026quot;里面不使用 minimize 只使用 activate 和 close wayfire尚不支持ext_workspace_unstable_v1 无法在waybar和polybar中显示工作区。 ","date":"2023-10-13T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/wayland/wayfire-i3/","title":"wayfire平铺桌面的配置"},{"content":" 1 apt install swaylock 测试\n1 2 3 swaylock --color 015000 swaylock --image ./bg/zifa.jpg swaylock --image ./bg/zifa.jpg --color 015000 --show-keyboard-layout 修改wayfire配置文件\n1 2 3 4 5 6 7 [autostart] #空闲锁屏 idle = swayidle before-sleep swaylock --image ./bg/zifa.jpg --color 015000 --show-keyboard-layout [command] #热键锁定 binding_Lock =\u0026lt;super\u0026gt; KEY_L command_Lock= swaylock --image ./bg/zifa.jpg --color 015000 --show-keyboard-layout ","date":"2023-10-13T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/wayland/wayfire-lock/","title":"wayfire锁屏的简单配置"},{"content":"wayfire下不小心转动窗口后不知道如何恢复窗口。 可以关闭的窗口可以关掉重新打开。但是能关闭的就麻烦了。 经过检查后\nwayfire 默认有一个配置\n1 2 [wrot] activate = \u0026lt;super\u0026gt; \u0026lt;ctrl\u0026gt; BTN_RIGHT 这个是水平转动的，但是还有隐藏的win + shfit + 鼠标右键的立体方向的转动。\n如果要关闭这个两个功能，，可以直接去掉 wrot 即可。 如果还想保留。我目前找到的解决方案 就是 利用wayfire的热重载配置文件功能 修改 wayfire 的配置文件关掉wrot，然后再恢复wrot。\n也就是\n1 2 3 [core] plugins = \\ wrot \\ 替换之后 然后再恢复 shell如下\n1 2 sed -i \u0026#39;s/wrot \\\\/#wrot \\\\/g\u0026#39; $HOME/.config/wayfire.ini sed -i \u0026#39;s/#wrot \\\\/wrot \\\\/g\u0026#39; $HOME/.config/wayfire.ini 可以直接绑定一个热键，去command 里面增加一个\n1 2 3 4 [command] # 恢复所有旋转的窗口 binding_recoverWrot = \u0026lt;super\u0026gt; \u0026lt;ctrl\u0026gt; KEY_R command_recoverWrot = sed -i \u0026#39;s/wrot \\\\/#wrot \\\\/g\u0026#39; $HOME/.config/wayfire.ini \u0026amp;\u0026amp; sed -i \u0026#39;s/#wrot \\\\/wrot \\\\/g\u0026#39; $HOME/.config/wayfire.ini ","date":"2023-10-13T00:15:20+08:00","permalink":"https://dev.leiyanhui.com/wayland/wf-wrot/","title":"wayfire 不小心转动窗口后如何恢复窗口显示"},{"content":"全文基于debian12 默认源。\n基本安装 1 2 3 4 apt install wayfire waybar seatd swaylock swayidle wlogout kanshi mako-notifier wlsunset wofi swaybg brightnessctl apt install xdg-desktop-portal xdg-desktop-portal-gtk xdg-desktop-portal-wlr apt install xwayland apt install fonts-font-awesome # 字体 waybar 非必须，可以用 polybar 替代 wlsunset 暖色配置工具 非必需 wofi 可以用 rofi替代 配置文件 默认的\n1 2 3 4 5 cp /usr/share/doc/wayfire/examples/wayfire.ini ~/.config/wayfire.ini mkdir -p ~/.config/waybar/ cp /etc/xdg/waybar/config ~/.config/waybar/ cp /etc/xdg/waybar/style.css ~/.config/waybar/ mkdir -p ~/.config/kanshi \u0026amp;\u0026amp; touch ~/.config/kanshi/config 更多配置文件这里不在说，wayfire的配置较为简单\nwarbar 跟随wayfire 启动 添加或者编辑 ~/.config/wayfire.ini\n1 2 [autostart] bar = waybar waybar 的配置和polybar非常接近，只是多了一个css文件，更加灵活漂亮。这里也不多说，网上有很多现成的可以参考一下。\n截图方案 目前最新版本 flameshot 12.1.0 在 wayfire 没办法正常使用。 需要自己处理搞定截图部分。分三步 1、选区(slurp) 2、 截图(grim) 3编辑(swappy ksnip photoflare GIMP)。\n1 apt install slurp grim ksnip 写一个bash文件，然后在 wayfire.ini 绑定快捷键即可\n1 2 3 4 #!/bin/sh NOW=$(date +\u0026#34;%Y-%m-%d-%H%M%S\u0026#34;) grim -g \u0026#34;$(slurp )\u0026#34; -t png $HOME/Pictures/grim-$NOW.png ksnip $HOME/Pictures/grim-$NOW.png 上面代码ksnip ，实际测试 在ksnip内复制到剪切板的时候会丢失突破的下半部分 并且无法粘贴到linuxqq。photoflare kolourpaint 也存在这个问题。 swappy 目前没有deb的包，需要自己编译,我没有测试。 如果可以接受GIMP的启动速度 和繁琐不方便的，可以用GIMP来替代上面的 ksnip。但是因为gimp启动实在太慢了，如果要频繁截图就不要关闭gimp了。\n解决粘贴板 因为上面的方案在粘贴到qq的时候会丢失内容并且无法发送，粘贴到别处也会丢内容。所以有了下面的方案\n1 apt install wl-clipboard 然后 修改ksnip 配置项 1、关闭 单势力 2、关闭 关闭和最小化的系统托盘。 工作拆解\n1 2 3 4 5 SAVEPATH=$HOME/Pictures/screenshot \u0026amp;\u0026amp; mkdir -p $SAVEPATH # 截图临时储存目录 NOW=$(date +\u0026#34;%Y-%m-%d-%H%M%S\u0026#34;) \u0026amp;\u0026amp; grim -g \u0026#34;$(slurp )\u0026#34; -t png $SAVEPATH/grim-$NOW.png # 截图选区到临时目录 ksnip $SAVEPATH/grim-$NOW.png #编辑 wl-copy \u0026lt; $SAVEPATH/grim-$NOW.png #复制到剪切板 find \u0026#34;$SAVEPATH\u0026#34; -type f -mtime +3 -exec rm {} + #删除3天前的文件 ~/.config/wayfire.ini\n1 2 3 [command] binding_screenshot = \u0026lt;super\u0026gt; KEY_P command_screenshot = SAVEPATH=$HOME/Pictures/screenshot \u0026amp;\u0026amp; mkdir -p $SAVEPATH \u0026amp;\u0026amp; NOW=$(date +\u0026#34;%Y-%m-%d-%H%M%S\u0026#34;) \u0026amp;\u0026amp; grim -g \u0026#34;$(slurp )\u0026#34; -t png $SAVEPATH/grim-$NOW.png \u0026amp;\u0026amp; ksnip $SAVEPATH/grim-$NOW.png \u0026amp;\u0026amp; wl-copy \u0026lt; $SAVEPATH/grim-$NOW.png \u0026amp;\u0026amp; find \u0026#34;$SAVEPATH\u0026#34; -type f -mtime +3 -exec rm {} + 使用方法 按下 win+p 或者你自己修改的热键。 选区 截图 会自动打开 ksnip ，标注 保存（ctrl+s），然后关闭 ksnip （alt+f4 | win+q | win+ shift+q） 或者直接关闭 ，或者关闭提示保存修改的时候回车。\n进阶思路 自动上传到图床 上面的shell很简单了，也可以用rclone或者curl上传到图床并返回md代码到剪切板。ksnip也自带这个功能。 这里就不啰嗦了。\n不保存临时文件 路径放到 /tmp 或者 /dev/shm 就好了。或者自定义ctrl+v 并删除临时文件也行。\n录屏方案 目前 wayfire 只能 全屏录制，好像没有别的办法。\n1 apt install obs-studio 因为我几乎用不到，所以没有去寻找其他方案。但是简单想一下，应该是可以用wayvnc功能 在x11下录制的 哈哈。\n","date":"2023-10-13T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/wayland/wayfire/","title":"debian下wayfire截图的解决方案 接近完美"},{"content":"/usr/share/applications/qq.desktop\n1 2 3 4 5 6 7 8 9 [Desktop Entry] Type=Application Encoding=UTF-8 Name=qq Comment=qq Exec=/opt/startup_appimage.sh /opt/qq.AppImage Icon= Terminal=false Categories=System; /opt/startup_appimage.sh\n1 2 3 4 5 6 7 8 9 #!/bin/bash if [ \u0026#34;$(id -u)\u0026#34; -eq 0 ]; then echo \u0026#34;当前用户是root\u0026#34; $1 --no-sandbox else echo \u0026#34;当前用户不是root\u0026#34; $1 fi ","date":"2023-10-08T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/startup_appimage/","title":"linux启动appimage 快捷方式和脚本"},{"content":"本文内容是 https://dev.leiyanhui.com/pve/pve-uhd-hook-win-11-all 的后续。 主要是为了实现： pve 宿主机器安装桌面作为日用机使用（lightdm+i3w）此步骤略。 win11-1 （1101）开机后不直通任何设备不影响pve宿主桌面，只能通过rdp远程访问。 win11-2 （1102）开机后接管核显 和usb键鼠等，关机后硬件退还给宿主机。 win11-3 （1103）和 win11-2 一样，不同的是win11-3支持pve网页控制台的vnc屏幕，也就是双屏可以在另外一个设备上简单的实现分屏功能。但是没有开机启动画面会短暂黑屏无信号，一直到win登陆界面才可以点亮核显。 三个vm 磁盘和系统内容完全一样，共享虚拟磁盘文件 但是只能有一个开机处于开机状态。\n本文内容参考zhing 和 ledIsBeat 两位大神，并进一步优化和精简。 其他内容例如 bios配置和csm等参考 前文 。\npve和bios配置 简单的说，就是 不要黑名单，不要vfio配置。grub只intel_iommu=on 。\nbios配置参考前文\ngrub 1 2 nano /etc/default/grub # 修改下面内容，这里不要别的内容 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on\u0026#34; 其他 /etc/modules 需要添加 四行 vfio vfio_iommu_type1 vfio_pci vfio_virqfd（有的设备不需要） /etc/modprobe.d/pve-blacklist.conf 删除 blacklist i915 、 blacklist snd_hda_intel 、blacklist snd_hda_codec_hdmi 不需要屏蔽，不然宿主机核显没显示了。如果你需要屏蔽才能直通。本文不适合你。 /etc/modprobe.d/vfio.conf 如果你之前做了vfio ，直接删掉这个文件，不需要。 ls /etc/modprobe.d/ 检查有没有多于的文件 应该只有一个 pve-blacklist.conf 文件才可以 如果你没有独显pve-blacklist.conf也可以删掉。\n1 2 update-grub update-initramfs -u -k all # 可能需要更新gurb后重启后再运行这行 准备文件 win11 安装镜像： https://www.microsoft.com/zh-cn/software-download/windows11 win virio驱动iso ：https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/ 钩子脚本 ： https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-igpu-hooks 技嘉 B150M-PIO-SI R3 主板虚拟bios文件：https://github.com/joyanhui/file.leiyanhui.com/blob/main/pve-igpu-hooks/b150m.bin （大大帅大佬给修改的）\n安装win11-1（1101） 有很多种模式可以实现，我这里用q35+ovmf+tpm 正常在pve 网页控制台 安装标准版win11 22H2 。这里就不说了，直接贴配置文件/etc/pve/qemu-server/1101.conf\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 agent: 1 bios: ovmf boot: order=virtio0;ide2 cores: 12 cpu: host efidisk0: local:1101/vm-1101-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K ide0: local:iso/virtio-win-0.1.240.iso,media=cdrom,size=612812K ide2: local:iso/Win11_22H2_Chinese_Simplified_x64v2.iso,media=cdrom,size=5723780K machine: pc-q35-8.0 memory: 10240 meta: creation-qemu=8.0.2,ctime=1695966414 name: win11-1 net0: virtio=72:57:35:2C:58:36,bridge=vmbr0,firewall=1 numa: 0 ostype: win11 scsihw: virtio-scsi-single smbios1: uuid=9263edd9-30d2-43e7-8907-46bc55fbe996 sockets: 1 tpmstate0: local:1101/vm-1101-disk-1.raw,size=4M,version=v2.0 virtio0: local:1101/vm-1101-disk-2.qcow2,cache=unsafe,iothread=1,size=12G vmgenid: 9a7d17fc-bc6b-4b76-87d2-f523834aee4a 找不到硬盘驱动的时候，点击浏览，选择cdrom（virtio）中的 amd64目录下的win11，其他驱动进桌面后再装 联网界面，在pve的网页控制台界面 点一下左侧悬浮的 小箭头，然后依次点 A \u0026gt; ctrl(可能需要点两下) 再点一下键盘的 Shift+F10(Fn+F10)。然后在弹出的cmd命令输入 oobe\\bypassnro 回车 重启，然后重新选国家键盘等就可以选择不联网。 进入桌面后就可以安装光驱里面的驱动了。然后联网，关闭休眠，关闭C页面文件，修改计算机名称或者ip配置，打开远程桌面，本地账号设置密码，测试远程桌面是否可以正常连接。顺带装个dism++ 可以简单清理一下。\n配置win11-2 以及直通 钩子脚本准备 上面下载的钩子脚本 复制到 /opt/pve-igpu-hooks 要cd进去加执行权限 chmod a+x *.sh *.pl 而后复制文件或者ln\n1 2 3 mkdir -p /var/lib/vz/snippets rm -rf /var/lib/vz/snippets/hooks-igpupt.pl ln -sf /opt/pve-igpu-hooks/hooks-igpupt.pl /var/lib/vz/snippets/hooks-igpupt.pl#cp hooks-igpupt.pl /var/lib/vz/snippets/hooks-igpupt.pl win11-1 小调整 然后上面创建的硬盘只有12G大小再小装不机。可以备份一下sudo cp /var/lib/vz/images/1101/vm-1101-disk-2.qcow2 /home/yanhui/pve-files/w11-q35-12G.qcow2 。然后返回pve网页控制台选中这个虚拟磁盘文件磁盘操作调整大小，增加88G容量。而后可以返回win的磁盘管理里面 扩容磁盘（开机状态下 virio可以扩容）\n另外额外挂载一个磁盘，并去掉多余的光驱。\n复制出win11-2 并配置 cp /etc/pve/qemu-server/1101.conf /etc/pve/qemu-server/1102.conf 这样1102 和1101 共享磁盘文件。\n编辑win11-2（1102） 显示 None ，机型i440fx，添加usb设备和核显 板载声卡。然后编辑1102.conf 添加args 修改 核显的配置 以及添加hookscript，另外bios设置为默认seaf最终配置文件如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 agent: 1 args: -bios /opt/pve-igpu-hooks/b150m.bin -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=2 -set device.hostpci0.x-igd-opregion=on -smbios type=2 -global nec-usb-xhci.msi=off -global ICH9-LPC.acpi-pci-hotplug-with-bridge-support=off -cpu host,vendor=GenuineIntel,+invtsc,+hypervisor,kvm=on,vmware-cpuid-freq=on boot: order=virtio0 cores: 12 cpu: host efidisk0: local:1101/vm-1101-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K hookscript: local:snippets/hooks-igpupt.pl hostpci0: 0000:00:02.0,legacy-igd=1 machine: pc-i440fx-8.0 memory: 10240 meta: creation-qemu=8.0.2,ctime=1695966414 name: win11-1 net0: virtio=72:57:35:2C:58:36,bridge=vmbr0,firewall=1 numa: 0 ostype: win11 scsihw: virtio-scsi-single smbios1: uuid=9263edd9-30d2-43e7-8907-46bc55fbe996 sockets: 1 tpmstate0: local:1101/vm-1101-disk-1.raw,size=4M,version=v2.0 usb0: host=1ea7:0064,usb3=1 usb1: host=260d:0013,usb3=1 vga: none virtio0: local:1101/vm-1101-disk-2.qcow2,cache=unsafe,iothread=1,size=100G virtio1: local:1101/vm-1101-disk-3.qcow2,cache=unsafe,iothread=1,size=120G vmgenid: 9a7d17fc-bc6b-4b76-87d2-f523834aee4a 主板vbios文件-bios /opt/pve-igpu-hooks/b150m.bin 仅适合我的主板，不是所有平台都需要这个文件，你可以删掉args里面的这段内容先看看能不能启动。也可以从/usr/share/kvm/ 手动指定一个。args后面的内容 是一些显卡的配置还有防止被检测虚拟机等。\n开机后，usb设备和核显正常时可以点亮的。扩容C盘，用系统更新功能安装显卡驱动（win11-3 因为是q35模式需要先有驱动才能点核显）。\nwin11-3（1103） cp /etc/pve/qemu-server/1101.conf /etc/pve/qemu-server/1103.conf 这样1103 也 和1101 共享磁盘文件。只添加args和钩子 然后添加usb设备即可，最终配置文件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 agent: 1 args: -device vfio-pci,host=00:02.0,addr=0x02,x-igd-opregion=on,romfile=vbios_gvt_uefi.rom bios: ovmf boot: order=virtio0 cores: 12 cpu: host efidisk0: local:1101/vm-1101-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K hookscript: local:snippets/hooks-igpupt.pl machine: pc-q35-8.0 memory: 10240 meta: creation-qemu=8.0.2,ctime=1695966414 name: win11-q35-x2 net0: virtio=72:57:35:2C:58:36,bridge=vmbr0,firewall=1 numa: 0 ostype: win11 scsihw: virtio-scsi-single smbios1: uuid=9263edd9-30d2-43e7-8907-46bc55fbe996 sockets: 1 tpmstate0: local:1101/vm-1101-disk-1.raw,size=4M,version=v2.0 usb0: host=1ea7:0064,usb3=1 usb1: host=260d:0013,usb3=1 virtio0: local:1101/vm-1101-disk-2.qcow2,cache=unsafe,iothread=1,size=100G virtio1: local:1101/vm-1101-disk-3.qcow2,cache=unsafe,iothread=1,size=120G vmgenid: 9a7d17fc-bc6b-4b76-87d2-f523834aee4a q35 模式 可以双屏幕，启动的时候会提示一个 IGD不支持legacy的警告信息，不用理会。\n如果提示vfio/xx/0 不存在的错误 重启再启动一下就可以，可以用手机 ssh过来 qm start 1103 这样启动\n更多可以参考 ：\nhttps://dev.leiyanhui.com/pve/win-gpu/\nhttps://dev.leiyanhui.com/pve/pve-uhd-hook-win-11-all\nhttps://zhing.fun/pve_igpupt/\n","date":"2023-09-27T22:14:22+08:00","permalink":"https://dev.leiyanhui.com/pve/pve-uhd-hook-win-11-1/","title":"pve 直通钩子 - pve桌面环境日用，win11 三机器钩子脚本自动占用核显 快速实现"},{"content":" 本文部分内容过期，请查看新版\nhttps://dev.leiyanhui.com/pve/pve-uhd-hook-win-11-1\n另外文中没有直通声卡进去，所以虚拟机HDMI也没有声音。 请另外加进去即可\n目标 pve 桌面环境日用win和macos 偶尔使用。\nwin1 开机 ，不直通 usb 和 显卡，使用rdp远程桌面操作。\nwin2 开机 独占显卡 声卡和usb键鼠 以及其他usb设备。 win2关机后 直通的硬件 返给pve.\nmacos 也是一样（本文目前只有win部分的内容，macos的稍后整理）。\n注意 部分cpu/主板 暂时是不能完全支持的。我这里可以正常挂载和自动退还给宿主。但是实际使用存在一下几个问题：\n开机画面，Q35模式下没搞定i440fx下可用，但是需要挂载定制主板bios文件，可以和macos直通核显需要的bios文件通用。这个不是大问题。 vm开机后，显卡会直通给vm 宿主机桌面的软件都会退出，这个挺不爽的哈。这个后期可以修改ledisbest大佬的脚本来实现，可以考虑把桌面下的所有软件丢到vnc,而后vm模式下可以用vnc继续操作，vm关机后再返给宿主的桌面。暂时留一个坑。 1 2 3 4 5 6 7 \u0026gt; 我的硬件配置 : - qnct i7 8850h - 技嘉 B150M-PIO-SI R3 - OS: Proxmox VE 8.0.3 x86_64 - Kernel: 6.2.16-3-pve pve版本8.0.3 - 核显 uhd630 - 桌面是i3w 桌面管理器本来是用的 xinit,但是发现zhing和ledisbest大佬的脚本不支持，所以干脆先换了lightdm 硬件QNCT 实际测试有几种方案（均不限制win版本和驱动版本）\n1、i440fx seaf 实际测试 效果不好，操作有卡顿感，系统更新的时候重启黑屏无法环境 可以有开机画面，winpe之类无驱动模式 可用\n2、i440fx ovmf 性能可以 操作流畅 可以有开机画面，winpe之类无驱动模式 可用\n3、q35 ovmf 性能可以 操作流畅 暂时没研究明白怎么添加开机画面，pve控制台屏幕可用，winpe之类驱动模式 无法使用。win要安装驱动后才可以点亮直通核显。\n关于tpm，可以用win下用bat脚本处理iso文件然后就脱离tpm安装。也可以 q35 ovmf+tpm 安装成功后修改为 i440fx。\n后面内容有一部分使用了显卡的rom文件，但是实际测试在我的设备上不需要\nbios的配置 只需要开启 vt-d 即可，gms无要求，可以uefi也可以传统模式启动pve.\npve安装一个windows VM ID 是 811 用uefi q35机型,驱动用的 虚拟化驱动用的 virtio-win-0.1.215.iso。参考配置如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 agent: 1 bios: ovmf boot: order=virtio0 cores: 12 cpu: host efidisk0: local:811/vm-811-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K ide0: local:iso/virtio-win-0.1.240.iso,media=cdrom,size=612812K ide2: local:iso/Win11_22H2_Chinese_Simplified_x64v2.iso,media=cdrom,size=5723780K machine: pc-q35-8.0 memory: 10240 meta: creation-qemu=8.0.2,ctime=1695825773 net0: virtio=0E:01:BC:9D:02:51,bridge=vmbr0,firewall=1 numa: 1 ostype: win11 scsihw: virtio-scsi-single smbios1: uuid=37977c80-49d4-49f8-8cda-cc03b4ca2fc6 sockets: 1 tpmstate0: local:811/vm-811-disk-1.raw,size=4M,version=v2.0 virtio0: local:811/vm-811-disk-2.qcow2,cache=unsafe,iothread=1,size=30G virtio1: local:811/vm-811-disk-3.qcow2,iothread=1,size=64G vmgenid: 6328352c-225d-4a86-b7ee-643a781aafe0 正常安装，找不到硬盘的时候 加载一下驱动，提示联网的时候，正常跳过: fn + shift + f10 然后终端输入 oobe\\bypassnro.cmd 回车重启\n装完后 安装驱动 关闭休眠（必须关闭）安装完成后，固定win11的ip(也可以修改计算机名或者路由器里面查看),并打开远程桌面（要先测试确定没问题） 关闭休眠等。\n复制一个虚拟机 这样可以在不影响811单独启动的情况下 创建一个新的911虚拟机，两个虚拟机磁盘一样 所以不能同时启动。\n1 sudo cp /etc/pve/qemu-server/811.conf /etc/pve/qemu-server/911.conf 编辑这个文件 添加三行 args设置 核显直通（vbios_gvt_uefi.rom是非必须的，如果需要可以放到/usr/share/kvm/）和 钩子脚本（后文获取）\n1 2 3 args: -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=1 -set device.hostpci0.x-igd-opregion=on hostpci0: 0000:00:02.0,legacy-igd=1,romfile=vbios_gvt_uefi.rom hookscript: local:snippets/hooks-igpupt.pl 然后返回pve 网页控制台给911 添加一个usb设备。并设置显示none,机型修改为i440fx。\n启动911后 pve 会黑屏。 用另外一个设备比如iphone iSH 连接到pve,运行 qm start 911​ 手动启动并看下能否启动，而后用 远程桌面app 连接到win（可以用win计算机名或者路由器查看ip）\n最终参考如下 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 agent: 1 args: -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=1 -set device.hostpci0.x-igd-opregion=on bios: ovmf boot: order=virtio0 cores: 12 cpu: host efidisk0: local:811/vm-811-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K hookscript: local:snippets/hooks-igpupt.pl hostpci0: 0000:00:02.0,legacy-igd=1 hostpci1: 0000:00:1f.3 ide0: local:iso/virtio-win-0.1.240.iso,media=cdrom,size=612812K ide2: local:iso/Win11_22H2_Chinese_Simplified_x64v2.iso,media=cdrom,size=5723780K machine: pc-i440fx-8.0 memory: 10240 meta: creation-qemu=8.0.2,ctime=1695825773 net0: virtio=0E:01:BC:9D:02:51,bridge=vmbr0,firewall=1 numa: 1 ostype: win11 scsihw: virtio-scsi-single smbios1: uuid=37977c80-49d4-49f8-8cda-cc03b4ca2fc6 sockets: 1 tpmstate0: local:811/vm-811-disk-1.raw,size=4M,version=v2.0 usb0: host=4037:2804,usb3=1 usb1: host=1ea7:0064,usb3=1 usb2: host=260d:0013,usb3=1 vga: none virtio0: local:811/vm-811-disk-2.qcow2,cache=unsafe,iothread=1,size=30G virtio1: local:811/vm-811-disk-3.qcow2,iothread=1,size=64G vmgenid: 6328352c-225d-4a86-b7ee-643a781aafe0 不出以外的话，在驱动安装完成后，屏幕可以被点亮。\n进阶 上面的操作911 这个虚拟机有三个问题\n没有开机画面 会直接关掉当前宿主机器的所有软件 开机画面不显示这个问题在q35机型上 好像是无法避免的。在i440fx有的机器可以直接显示,有的需要特殊方法。\n开机画面 主板vbios方案 - 有开机画面 尝试继续处理 这次创建一个新的711 的虚拟机 这次先解决开机画面问题，我这次引用了一个修改后的主板bios文件。如果你没有，可以不加args里面的bios的配置，或从ls -lh /usr/share/kvm/*.bin 里自带的逐个试试，我这里不引用修改后的bios的话，可以显示kvm的bios界面但是最终，会卡到 boot form disk 的命令界面。\n最终配置文件参考如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 args: -bios /opt/pve-igpu-hooks/b150m.bin -set device.hostpci0.addr=02.0 -set device.hostpci0.x-igd-gms=2 -set device.hostpci0.x-igd-opregion=on -smbios type=2 -global nec-usb-xhci.msi=off -global ICH9-LPC.acpi-pci-hotplug-with-bridge-support=off -cpu host,vendor=GenuineIntel,+invtsc,+hypervisor,kvm=on,vmware-cpuid-freq=on boot: order=virtio0 cores: 12 cpu: host hostpci0: 0000:00:02.0,legacy-igd=1 hostpci1: 0000:02:00.0 memory: 10241 meta: creation-qemu=8.0.2,ctime=1695825773 name: w11-test net0: virtio=0E:01:BC:9D:02:51,bridge=vmbr0,firewall=1 numa: 1 ostype: other scsihw: virtio-scsi-single smbios1: uuid=0c5111fb-3e27-41eb-80f7-c097ad453e7b sockets: 1 usb0: host=4037:2804,usb3=1 usb1: host=1ea7:0064,usb3=1 usb2: host=260d:0013,usb3=1 vga: none tpmstate0: local:811/vm-811-disk-1.raw,size=4M,version=v2.0 efidisk0: local:811/vm-811-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K virtio0: local:811/vm-811-disk-2.qcow2,cache=unsafe,iothread=1,size=30G virtio1: local:811/vm-811-disk-3.qcow2,iothread=1,size=64G vmgenid: 6328352c-225d-4a86-b7ee-643a781aafe0 hookscript: local:snippets/hooks-igpupt.pl 继续研究 q35方案 - 无开机画面 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 agent: 1 args: -device vfio-pci,host=00:02.0,addr=0x02,x-igd-opregion=on,romfile=igd.rom bios: ovmf boot: order=virtio0 cores: 12 cpu: host efidisk0: local:811/vm-811-disk-0.qcow2,efitype=4m,pre-enrolled-keys=1,size=528K hookscript: local:snippets/hooks-igpupt.pl ide0: local:iso/virtio-win-0.1.240.iso,media=cdrom,size=612812K ide2: local:iso/Win11_22H2_Chinese_Simplified_x64v2.iso,media=cdrom,size=5723780K machine: pc-q35-8.0 memory: 10240 meta: creation-qemu=8.0.2,ctime=1695825773 net0: virtio=0E:01:BC:9D:02:51,bridge=vmbr0,firewall=1 numa: 1 ostype: win11 scsihw: virtio-scsi-single smbios1: uuid=37977c80-49d4-49f8-8cda-cc03b4ca2fc6 sockets: 1 tpmstate0: local:811/vm-811-disk-1.raw,size=4M,version=v2.0 usb0: host=4037:2804,usb3=1 usb1: host=1ea7:0064,usb3=1 usb2: host=260d:0013,usb3=1 vga: none virtio0: local:811/vm-811-disk-2.qcow2,cache=unsafe,iothread=1,size=30G virtio1: local:811/vm-811-disk-3.qcow2,iothread=1,size=64G vmgenid: 6328352c-225d-4a86-b7ee-643a781aafe0 可以启动，但是 卡开机画面\n尝试黑名单 /etc/modprobe.d/pve-blacklist.conf 修改完成后 sudo update-initramfs -u -k all\n1 2 3 4 5 6 7 8 9 # This file contains a list of modules which are not supported by Proxmox VE # nvidiafb see bugreport https://bugzilla.proxmox.com/show_bug.cgi?id=701 blacklist nvidiafb blacklist i915 blacklist snd_hda_intel blacklist snd_hda_codec_hdmi 实际测试 在pve8下，这个黑名单在直通核显的时候，屏蔽后除了会导致pve没有显示之外并没有别的任何作用。\n‍\n获取钩子 我这里所有操作都放到 /opt/pve-uhd630-hooks/ 这个目录\n1 2 3 4 5 6 7 8 sudo mkdir -p /opt/pve-igpu-hooks/ \u0026amp;\u0026amp; cd /opt/pve-igpu-hooks/ sudo wget https://github.com/HelloZhing/pvevm-hooks/archive/refs/heads/main.zip sudo unzip main.zip # apt install unzip sudo chown -R yanhui:yanhui /opt/pve-igpu-hooks/ # 临时修改为当前用户yanhui所有方便后面直接在pve桌面下修改编辑 mv /opt/pve-igpu-hooks/pvevm-hooks-main/*.sh /opt/pve-igpu-hooks/ mv /opt/pve-igpu-hooks/pvevm-hooks-main/hooks-igpupt.pl /opt/pve-igpu-hooks/hooks-igpupt.pl rm main.zip \u0026amp;\u0026amp; rm -r pvevm-hooks-main # 删掉无用文件 chmod a+x *.sh *.pl # 运行权限 需要几个地方修改\nhooks-igpupt.pl 里面的 路径 /root/pvevm-hooks​ 全部替换为 /opt/pve-igpu-hooks​\nvm-start.sh 里面的 #$(dirname0)/vfio-startup.sh​ 这行注射下面 添加一行 /opt/pve-igpu-hooks/vfio-startup.sh​ 同理把 vm-stop.sh中 有 vfio-teardown.sh​ 那行注射下面添加一行 /opt/pve-igpu-hooks/vfio-teardown.sh​\n钩子函数复制到\n1 2 sudo rm /var/lib/vz/snippets/hooks-igpupt.pl sudo cp /opt/pve-igpu-hooks/hooks-igpupt.pl /var/lib/vz/snippets/hooks-igpupt.pl 新虚拟配置 返回到pve平台，编辑多出来的911的虚拟机，添加直通设备，我这里暂时只直通usb键鼠标\n然后编辑/etc/pve/qemu-server/911.conf​\n顶部添加一行 ​ args: -devive vfio-pci,host=00:02.0,addr=0x02,x-idg-gms=1,x-ide-opregion-on ​​ 然后在pve 运行命令 添加 hooks\n1 sudo qm set 911 --hookscript local:snippets/hooks-igpupt.pl # 会多出一行 hookscript: local:snippets/hooks-igpupt.pl 准备另外一台设备 可能需要另外一个设备操作pve 和 win11的远程桌面。\n我这里用iphone + ish+RD Client上面 win11 我固定了ip是 10.1.1.11 所以 在启动911 后，在手机 ish 一直ping 这个ip 就好\n‍\n‍\n本文参考，并做了一些小修改：https://zhing.fun/pve_igpupt/\n‍\n","date":"2023-09-27T22:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/pve-uhd-hook-win-11-all/","title":"pve 核显直通钩子 实现 vm开机直通关机换给pve- 初步尝试"},{"content":"fake-ip和 redir-host两者区别，哪个好？\n在redir-host模式下，Clash先将域名进行解析，再将具体的IP地址响应给客户端，并且记录其对应关系。\n而在fake-ip模式下则不进行DNS解析，而是直接生成一个“假IP”并响应给客户端，再记录对应关系。\n这可以有如下两个好处： 1、fake-ip的响应会更快(因为会马上给你一个假IP)，如果最后判定为代理，则有可能节省一次本地的DNS请求.在访问国内网站的时候，速度会提升0.1-0.3m 2、不需要担心DNS污染（因为配置文件中的DNS仅用作规则判定）\n坏处 就是，你ping任何域名 获得的ip的都是假的。哪怕不存在的域名。ping的超时时间也肯定是错误的。\n日常使用不会有太大的影响，但是你在内网访问ddns的域名时候，默认请求到你的公网ip然后路由器直接环回到内网。因为这个ip是假的 就导致 无法 完成后面的操作。\n在不配置 smartdns的情况下，使用fake-ip 也不用其它的dns插件。不代理udp（游戏），代理ipv6 。 整体使用感受会很舒适。\n解决方法也很简单，在openclash中 开启fake-ip 后切换到 覆写设置 dns设置 Fake-IP-Filter 里面配置你要绕过 fake-ip 直接访问的域名。\n例如\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 #LAN *.lan *.localdomain *.example *.invalid *.localhost *.test *.local *.home.arpa #放行NTP服务 time.*.com time.*.gov time.*.edu.cn time.*.apple.com time-ios.apple.com time1.*.com time2.*.com time3.*.com time4.*.com time5.*.com time6.*.com time7.*.com ntp.*.com ntp1.*.com ntp2.*.com ntp3.*.com ntp4.*.com ntp5.*.com ntp6.*.com ntp7.*.com *.time.edu.cn *.ntp.org.cn +.pool.ntp.org time1.cloud.tencent.com #放行网易云音乐 music.163.com *.music.163.com *.126.net #百度音乐 musicapi.taihe.com music.taihe.com #酷狗音乐 songsearch.kugou.com trackercdn.kugou.com #酷我音乐 *.kuwo.cn #JOOX音乐 api-jooxtt.sanook.com api.joox.com joox.com #QQ音乐 y.qq.com *.y.qq.com streamoc.music.tc.qq.com mobileoc.music.tc.qq.com isure.stream.qqmusic.qq.com dl.stream.qqmusic.qq.com aqqmusic.tc.qq.com amobile.music.tc.qq.com #虾米音乐 *.xiami.com #咪咕音乐 *.music.migu.cn music.migu.cn #win10本地连接检测 +.msftconnecttest.com +.msftncsi.com #QQ登录 localhost.ptlogin2.qq.com localhost.sec.qq.com +.qq.com +.tencent.com #Game #Nintendo Switch +.srv.nintendo.net *.n.n.srv.nintendo.net #Sony PlayStation +.stun.playstation.net #Microsoft Xbox xbox.*.*.microsoft.com *.*.xboxlive.com xbox.*.microsoft.com xnotify.xboxlive.com #Wotgame +.battlenet.com.cn +.wotgame.cn +.wggames.cn +.wowsgame.cn +.wargaming.net #Golang proxy.golang.org #STUN stun.*.* stun.*.*.* +.stun.*.* +.stun.*.*.* +.stun.*.*.*.* +.stun.*.*.*.*.* #Linksys Router heartbeat.belkin.com *.linksys.com *.linksyssmartwifi.com #ASUS Router *.router.asus.com #Apple Software Update Service mesu.apple.com swscan.apple.com swquery.apple.com swdownload.apple.com swcdn.apple.com swdist.apple.com #Google lens.l.google.com stun.l.google.com na.b.g-tun.com #Netflix +.nflxvideo.net #FinalFantasy XIV Worldwide Server \u0026amp; CN Server *.square-enix.com *.finalfantasyxiv.com *.ffxiv.com *.ff14.sdo.com ff.dorado.sdo.com #Bilibili *.mcdn.bilivideo.cn #Disney Plus +.media.dssott.com #shark007 Codecs shark007.net #Mijia Mijia Cloud #招商银行 +.cmbchina.com +.cmbimg.com #AdGuard local.adguard.org #迅雷 +.sandai.net +.n0808.com #自己 +.leiyanhui.com ","date":"2023-09-19T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/oc-fakeip/","title":"fake-ip代理的问题  ddns失效 等"},{"content":"安装配置 smartdns opkg install luci-app-smartdns\n然后配置上游dns 即可\n需要配置多个 上游dns ， 最好 几个国内的 几个境外\nopenclash 配置 openclash 使用redir-host 模式即可，然后追加上游dns 为本地 127.0.0.1:smartdns端口\n注意 smartdns 并发请求 上游dns，也就是默认情况下，你访问某一个网站，多个dns 都会收到查询请求。\n所以需要进一步调整 配置 域名列表\n一般建议 通常来说 非必要情况下 不建议 smartdns 和 openclash 一起使用，广告过滤可以 openclash规则处理掉 ，国内域名的dns加速，可以 fake-ip 处理掉。\nmosdns 也是一个不错的选择！\nmosdns 白名单：加入的域名始终允许使用 “本地 DNS” 进行解析，且优先级最高（每个域名一行，支持域名匹配规则） 黑名单：加入的域名将屏蔽 DNS 解析（每个域名一行，支持域名匹配规则） 灰名单：加入的域名始终使用 “远程 DNS” 进行解析（每个域名一行，支持域名匹配规则） DDNS 域名：加入的域名始终使用 “本地 DNS” 进行解析，并且强制 TTL 5 秒，解析结果不会进入缓存（每个域名一行，支持域名匹配规则） Hosts：自定义 Hosts 重写，如：baidu.com 10.0.0.1（每个规则一行） 重定向：重定向请求的域名。请求域名 A，但返回域名 B 的记录，如：baidu.com qq.com（每个规则一行） PTR 黑名单：加入的域名将阻止 PTR 请求（每个域名一行，支持域名匹配规则）\n","date":"2023-09-19T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/smartdns-openclash/","title":"smartdns和openclash的配合"},{"content":"devpts 是一个虚拟文件系统，用于在 Linux 系统中为伪终端（pseudo terminal）提供设备文件。\n伪终端是一种特殊的设备，它提供了一个类似于真实终端（如终端窗口）的接口，用于与系统进行交互和执行命令。伪终端常用于远程登录、SSH 链接、终端模拟器等场景。\ndevpts 文件系统通过 /dev/pts 目录中的设备文件来管理伪终端。每个伪终端都会在 /dev/pts 目录下创建一个相应的设备文件，例如 /dev/pts/0、/dev/pts/1 等。当你打开一个伪终端时，实际上是打开了一个对应的设备文件。\ndevpts 文件系统的挂载点通常是 /dev/pts，可以使用 mount 命令将其挂载到该目录。挂载 devpts 文件系统后，系统就能正常使用伪终端，并在 /dev/pts 目录下创建对应的设备文件。\n总而言之，devpts 是用于管理伪终端设备文件的虚拟文件系统，它在 Linux 系统中起到了关键的作用。\n1 mount -t devpts devpts /dev/pts 另外 一些进程管理类的程序需要用 proc\n1 mount -t proc proc /proc ","date":"2023-09-16T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/container/chroot-devpts/","title":"chroot 进去后的系统 devpts错误"},{"content":"有两种情况，1是宿主的dev 没有挂进来 2是dns错误\nip a 和 ping ip地址 先排查是1 还是2\n1、宿主机的dev挂载到 宿主机执行\n1 2 3 4 5 6 sudo mount -v --bind /dev ./debian12v5/dev #sys proc tmp run sudo mount --bind /sys ./debian12v5/sys sudo mount --bind /proc ./debian12v5/proc sudo mount --bind /tmp ./debian12v5/tmp sudo mount --bind /run ./debian12v5/run 然后 ip a 和ping命令应该就正常了。\n2、dns 容器内执行\n1 2 3 4 rm -rf /etc/resolv.conf # 在dns无法用的时候，这里肯定一个错误连接，要删掉 echo \u0026#34;search lan\u0026#34; \u0026gt;/etc/resolv.conf echo \u0026#34;nameserver 114.114.114.114\u0026#34; \u0026gt;\u0026gt;/etc/resolv.conf cat /etc/resolv.conf 也可把宿主机的ln -s 过来\n","date":"2023-09-16T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/container/chroot-dns/","title":"chroot 进去后的系统无网络或者dns错误"},{"content":"chroot后的容器内 使用普通用户 执行sudu 会提示\nsudo: /usr/bin/sudo 必须属于用户 ID 0(的用户)并且设置 setuid 位\nsudo: /usr/bin/sudo must be owned by uid 0 and have the setuid bit set\n在网上搜索很久，多数是让chmod 处理/usr/bin/sudo权限，但是那个方法只适合你把权限搞乱的情况下 不适合chroot。\n解决方法 其实也很简单，就是rootfs目录的所有权 需要是root用户的。而不能是普通用户所有，只要是root所有再sudo chroot 进去就没有这个问题。\nimg方法 这个方法适合需要独立管理的情况 文件放到img后先挂载到目录后 重新 sudo mount -o remount,suid \u0026lt;patch\u0026gt;\n1 2 3 4 5 6 7 8 dd if=/dev/zero of=test.img bs=1G count=1 mkfs.ext4 test.img mkdir /tmp/test sudo mount -o loop test.img /tmp/test sudo mount --bind /tmp/test /tmp/test sudo mount -o remount,suid /tmp/test sudo tar -xf bookworm.tar.xz -C /tmp/test/bookworm 当然不用img也是一样，目录挂载重新remount,suid也是可以。\n直接目录 另外一个常见的处理方法 就是\n1 2 mkdir debian12v5 tat -xvJf bookworm.tar.xz -C ./debian12v5 这时候 你直接chroot到目录里面，普通用户是无法执行sudo的。但是只要是把rootfs改为root所有 就没有这个问题了。\n1 2 sudo mkdir debian12v5 sudo tat -xvJf bookworm.tar.xz -C ./debian12v5 本文参考：https://www.cnblogs.com/ztguang/p/12644320.html\n","date":"2023-09-16T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/container/chroot-sudo/","title":"chroot的sudo setuid错误的处理"},{"content":"注册cf账号，开通 zero trust 过程略过 记住的你的 \u0026lt;你的warp组织名\u0026gt; 也就是 https://\u0026lt;你的warp组织名\u0026gt; .cloudflareaccess.com 前面这部分。\n配置可信任邮箱后缀 在zero trust 面板 依次点击my team \u0026gt; devices 即可。\n最好用自己的域名邮箱，你用公用邮箱地址的话，任何人都可以登陆进来。\n允许代理模式 默认可能不允许客户端切换代理模式 会提示 Error: Operation not authorized in this context.\n在zero trust 面板 依次点击 Settings \u0026gt; WARP Client 找到 默认配置文件 Default ，然后点击 Configure 配置 ：\nLock WARP switch 关闭\nMode switch 打开 这个选项就是允许客户端切换模式了。 客户下 幸运\n本地登陆 linux下无桌面\n1 2 warp-cli delete #删除旧的 warp-cli teams-enroll \u0026lt;你的warp组织名\u0026gt; 会提示让你登陆网页 从任何一个浏览器打开 https://\u0026lt;你的warp组织名\u0026gt; .cloudflareaccess.com/warp 登陆查看源码。按钮附近源码 找到一段\n1 com.cloudflare.warp://\u0026lt;你的warp组织名\u0026gt; .cloudflareaccess.com/auth?token=\u0026lt;token\u0026gt; 复制出来，然后配置token\n1 warp-cli teams-enroll-token com.cloudflare.warp://\u0026lt;你的warp组织名\u0026gt; .cloudflareaccess.com/auth?token=\u0026lt;token\u0026gt; 成功后没有任何提示。。\n然后切换到代理模式,并启动\n1 2 3 warp-cli is-mode-switch-allowed # 查看是否允许切换 warp-cli set-mode proxy warp-cli connect ip a 查看 应该不会多出来cfwarp的网卡\n常见问题 Error: Operation not authorized in this cloudflare 网页控制台 要打开 允许客户端切换模式，参考前面的。 Error: Invalid setting for this account type.\n要登陆到teams成功后才可以，token不能有错误\nwarp-cli teams-enroll-token 报错\n应该是token失效，重新打开一个浏览器隐私窗口重新弄一次即可。\n第三方客户端 https://github.com/ViRb3/wgcf 可以直接生成clash配置文件\n","date":"2023-09-16T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/cloudflare/zero-trust/","title":"cloudflare zero trust 组网 "},{"content":"本文全程基于openwrt ，简单来说 clash 支持wireguard协议 warp也是基于wireguard的。 我们用第三方工具获取wireguard的公钥和私钥即可。\n值得注意的是 team模式 不支持代理模式。 用warp/warp+ 才可以\n获取 warp+的wireguard 模式key 这里使用第三方的一个cli客户端用来获取key\n1 2 3 4 5 6 7 8 9 10 11 wget https://github.com/ViRb3/wgcf/releases/download/v2.2.19/wgcf_2.2.19_linux_amd64 mv wgcf_2.2.19_linux_amd64 cf \u0026amp;\u0026amp; chmod +x cf ./cf register #注册 ./cf generate #生成配置文件 nano wgcf-account.toml #license_key 修改成你的warp+的收费/推广license_key #更新 ./cf update ./cf generate ./cf status 查看wgcf-profile.conf 文件里面的 PublicKey 和 PrivateKey 以及Interface 第一个ipv4地址默认是172.16.0.2 后面就到了一个比较麻烦地方，需要手撸一个clash配置文件{后面提供了一键脚本}。基本格式如下\n1 2 proxies: - {name: cloudflare代理,type: wireguard,server: \u0026lt;你选的cf的ip\u0026gt;,port: 2408,ip: 172.16.0.2,public-key: \u0026lt;你的public-key\u0026gt;,private-key: \u0026lt;你的private-key\u0026gt;,mtu: 1280,udp: true} 给出一个例子\n1 2 proxies: - {name: cf节点1,type: wireguard,server: 162.159.192.20,port: 2408,ip: 172.16.0.2,public-key: XXXXXXXXXXXX=,private-key: XXXXX=,mtu: 1280,udp: true} 一键部署 我这里写了好了一个脚本可以直接创建出clash配置文件\n1 2 3 mkdir -p /opt/clash-warp-yxip \u0026amp;\u0026amp; cd /opt/clash-warp-yxip #任意目录均可 wget -N https://ghproxy.com/https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/main/warp-yxip-clash/clash-warp-yxip.sh bash clash-warp-yxip.sh v4 {public-key} {private-key} 注意 路由器要有bash环境,opkg install bash clash 要使用 Clash.Meta 内核 也可以加到计划任务定时更新 1 0 7 * * * cd /opt/clash-warp-yxip \u0026amp;\u0026amp; bash clash-warp-yxip.sh v4 XXXXXXXX= XXXXXXXXX= \u0026amp;\u0026amp; rm -f /etc/openclash/config/clash-warp.yaml \u0026amp;\u0026amp; cp clash-warp.yaml /etc/openclash/config/clash-warp.yaml \u0026amp;\u0026amp; service openclash restart 更多说明： https://github.com/joyanhui/file.leiyanhui.com/blob/main/warp-yxip-clash/README.md\nwarp-cli 基本使用\n1 2 3 4 5 6 7 8 9 10 11 12 13 warp-cli delete #删除旧配置 warp-cli register # 如果你有warp+的邀请流量key warp-cli set-license XXX-XXX-XXX warp-cli set-mode proxy #切换到代理模式 默认端口40000 warp-cli disconnect \u0026amp;\u0026amp; warp-cli connect #重连 #测试ip 应该返回你的真实ip curl https://myip4.ipip.net #当前会话临时代理 export ALL_PROXY=socks5://127.0.0.1:40000 # 再次测试ip 应该会返回cf的ip,但是有ipip可能会识别成国内ip curl https://myip4.ipip.net ","date":"2023-09-16T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/cloudflare/warp-openclash/","title":"cloudflare zero trust/warp 代理模式配合 openclash分流 以及在容器中使用warp "},{"content":"在pve上运行openwrt作为主路由使用。无论单个网卡或者多个网卡其实操作都操作。\nlxc运行的openwrt 对虚拟机方式运行的性能更好，资源占用更低。\n我目前是有两台pve 均为单网卡。 一台 x240主板 15-20w i3-4030U 8G 128G+1T。 上面lxc 运行 openwrt做主路由，同时在lxc里面运行了几个开源软件做核心数据的nas. 另外虚拟机运行了一个win 和一个备用mac（x240内存8G跑太多不够玩）\n一台 qnct组装机 20-60w 6核32G nvme 500G+12T pve装了桌面系统做日用机。并且挂了4块硬盘 也开了nas,虚拟运行win直通显卡打游戏 macos直通核显偶尔签app用。\n场景 pve单网卡 pve 单个网卡 接入交换机 光猫 桥接 接入交换机 其他设备 包括ap等同样接入交换机。 光猫通常插到交换机的第一个口上，不过家用交换机一般都是傻瓜式的，随便插都可以。 这是最常用的方案,top图大概如下 ，就是所有设备都接到交换机就ok\n1 2 3 4 5 交换机 \u0026lt;====\u0026gt; 光猫 这里光猫是桥接 交换机 \u0026lt;====\u0026gt; 其他设备 交换机 \u0026lt;====\u0026gt; 其他设备 交换机 \u0026lt;====\u0026gt; 其他设备 交换机 \u0026lt;====\u0026gt; pve物理网卡===\u0026gt; pve vmbr0 ===\u0026gt; lxc和kvm vmbr0 你可以视作一个虚拟万兆交换机就好理解了。pve默认用你在/etc/network/interfaces配置的ip,lxc和kvm内用你指定或者网内任意一个 使用虚拟机的情况下 pve内 就是 vmbr0 映射一个虚拟网卡到 到虚拟机。然后虚拟内部配置静态ip的和pve以及交换机上的其他设备在同一个网段就可以完成互相访问了。 那么到lxc的话也是一样。但是到openwrt的因为需要一个lan一个wan,所以我们这里直接映射两个虚拟网卡给openwrt就好了。\n1 2 vmbr0 ===\u0026gt; net0 === lxc openwrt eth0做lan vmbr0 ===\u0026gt; net1 === lxc openwrt eth1做wan 反应到lxc的配置文件里面就是\n1 2 net0: name=eth0,bridge=vmbr0,hwaddr=随便填写个MAC地址,type=veth net1: name=eth1,bridge=vmbr0,hwaddr=随便再来个MAC地址,type=veth 当然你也可以去openewrt内部做网桥来弄，但是完全没有必要。\npve多网卡 pve 多个网卡，直接直通网卡给openwrt即可。 下面的例子是pve双网卡 板载接入交换机 usb网卡接入光猫。 pve 为单板载网卡enp0s25，但是有一个usb3千兆网卡enx0023545ca007。为例，多网卡一样操作。\n在pve中 左侧 点数据中心下的pve ，然后点 中间的 系统下面的网络 ，查看这两个网口的名称。\n板载网卡做为pve管理口 插入交换机 局域网其他设备也插入普通交换机。 usb网卡作为链接外网的网卡 插入光猫。 记住这usb3网口的名字即可。下文统一以 enx0023545ca007 代替。\n步骤 获取 openwrt rootfs包 可以从IMG.GZ/SQUASHFS.IMG.GZ 提取，或者直接下载 ROOTFS.TAR.GZ 包。 从IMG.GZ/SQUASHFS.IMG.GZ 提取 提取的思路：解压gz 挂载img/SQUASHFS ，打包挂载后的文件到 ROOTFS.TAR.GZ 建议直接用 ROOTFS.TAR.GZ 即可。 我这里用 https://openwrt.ai/ supe提供的 ROOTFS.TAR.GZ\nrootfs包上传到 pve pve 后台找到 CT模板 点上传。我这里是手动下载到pve的 /var/lib/vz/template/cache/ 都是一样的\n创建一个CT/lxc pve目前依旧无法直接创建op的lxc，这里还是用命令行。\n1 pct create 100 local:vztmpl/openwrt-09.26.2023-x86-64-generic-rootfs.tar.gz --rootfs local:1 --ostype unmanaged --hostname OP --arch amd64 --cores 2 --memory 1024 --swap 0 -net0 bridge=vmbr0,name=eth0 解释 pct create 100 是pve里面CT或者VM的id值，你可以修改成你的 local:vztmpl/openwrt-09.26.2023-x86-64-generic-rootfs.tar.gz 是上面你上传到rootfs的包名 rootfs local:1 是本lxc储存位置和硬盘占用大小限制1G 如果用其他地方储存 rootfs local-lvm:1 rootfs local-brtfs:0.5 ostype unmanaged 操作系统类型 hostname OP 节点名称 arch amd64 cpu平台 cores 2 可占用的cpu核心数 memory 1024 swap 0 内存和交换内存，建议关闭交换内存 也就是0 net0 bridge=vmbr0,name=eth0 把pve的管理网桥给op用，也就是op把他作为 lan 手动修改配置 2-N网卡直通一个进去 cat /etc/pve/nodes/pve/lxc/100.conf 添加下面几行\n1 2 3 4 5 6 7 8 9 lxc.include: /usr/share/lxc/config/openwrt.common.conf lxc.net.1.type: phys lxc.net.1.link: enx0023545ca007 lxc.net.1.flags: up lxc.net.1.name: eth1 lxc.cgroup2.devices.allow: c 108:0 rwm lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file lxc.cap.drop: 完整配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 arch: amd64 cores: 2 hostname: OP memory: 1024 net0: name=eth0,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A4,type=veth onboot: 0 ostype: unmanaged rootfs: local:100/vm-100-disk-1.raw,size=1G startup: up=2 swap: 0 lxc.include: /usr/share/lxc/config/openwrt.common.conf lxc.net.1.type: phys lxc.net.1.link: enx0023545ca007 lxc.net.1.flags: up lxc.net.1.name: eth1 lxc.cgroup2.devices.allow: c 108:0 rwm lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file lxc.mount.entry: /dev/net dev/net none bind,create=dir lxc.cap.drop: 解释 lxc.include 包含pve自带的op配置模板 lxc.net.1 直通网卡enx0023545ca007进去作为 eth1 lxc.cgroup2 的配置，这是lxc运行一些服务类的系统必须的 lxc.mount.entry 挂载ppoe和tun到lxc内 lxc.cap.drop: 取消 openwrt.common.conf 里面 对 cap的限制，不然openclash无法使用 单网卡 完整配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 arch: amd64 cores: 2 hostname: OP memory: 1024 net0: name=eth0,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A4,type=veth net1: name=eth1,bridge=vmbr0,hwaddr=8A:8C:94:9B:ED:A3,type=veth onboot: 1 ostype: unmanaged rootfs: local:100/vm-100-disk-1.raw,size=1G startup: up=2 swap: 0 lxc.include: /usr/share/lxc/config/openwrt.common.conf lxc.cgroup2.devices.allow: c 108:0 rwm lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file lxc.mount.entry: /dev/net dev/net none bind,create=dir lxc.cap.drop: 解释 两个虚拟网卡直接映射进去就可以了e .\n启动 pct start 100\n目前发现的问题 NAT 环回 无效 简单的说，就是内网使用ddns的域名访问内网的服务器，无法访问。 目前尚不知道如何解决。貌似和openwrt的版本有关系，在使用git-24.286.72457-5518424编译 并且未在openwrt内部使用docker的情况下此问题正常。 但是在更新的版本中又再次出现。 临时解决方法有两种\n别名主机 别名主机可以在 openwrt 网络 -\u0026gt; dncp -\u0026gt; 主机名映射的地方 添加域名到对应的内网机器ip上。然后清理本地dns缓存后即可访问。也可以在openwrt里面运行\n1 2 3 4 5 uci add dhcp domain uci set dhcp.@domain[-1].name=\u0026#39;nas.leiyanhui.com\u0026#39; uci add_list dhcp.@domain[-1].ip=\u0026#39;10.1.1.50\u0026#39; uci commit dhcp /etc/init.d/dnsmasq restart 自定域名解析 如果你有使用adguardHome 之类的自建dns,可以在dns内添加对应的域名解析记录到内网ip。或者修改需要访问的的电脑的hosts文件。\nopenclash tun无法使用 暂时不知道如何解决。\n部分情况下 udp无法转发 需要PVE系统加载 xt_TPROXY 模块。在PVE系统下执行改命令后重启。\n1 echo \u0026#39;xt_TPROXY\u0026#39; \u0026gt; /etc/modules-load.d/tproxy.conf 偶尔发生pve外机器无法上网 后续发现是ap的原因，重启ap后解决。 如果你的ap刷过系统，可以在ap内检测主路由状态，如果ping不到lxc的主路由，那么重启即可。\nopenclash配置参考 /etc/config/openclash 注意下文中的 testingcf.jsdelivr.net 地址在部分地区可能已经干扰，请\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 config openclash \u0026#39;config\u0026#39; option proxy_port \u0026#39;7892\u0026#39; option tproxy_port \u0026#39;7895\u0026#39; option mixed_port \u0026#39;7893\u0026#39; option socks_port \u0026#39;7891\u0026#39; option http_port \u0026#39;7890\u0026#39; option dns_port \u0026#39;7874\u0026#39; option enable \u0026#39;1\u0026#39; option update \u0026#39;0\u0026#39; option en_mode \u0026#39;redir-host\u0026#39; option auto_update \u0026#39;1\u0026#39; option cn_port \u0026#39;9090\u0026#39; option dashboard_password \u0026#39;123456\u0026#39; option dashboard_forward_ssl \u0026#39;0\u0026#39; option rule_source \u0026#39;0\u0026#39; option enable_custom_dns \u0026#39;1\u0026#39; option ipv6_enable \u0026#39;1\u0026#39; option ipv6_dns \u0026#39;1\u0026#39; option enable_custom_clash_rules \u0026#39;0\u0026#39; option other_rule_auto_update \u0026#39;0\u0026#39; option core_version \u0026#39;linux-amd64\u0026#39; option enable_redirect_dns \u0026#39;1\u0026#39; option servers_if_update \u0026#39;0\u0026#39; option disable_masq_cache \u0026#39;1\u0026#39; option servers_update \u0026#39;0\u0026#39; option log_level \u0026#39;0\u0026#39; option proxy_mode \u0026#39;rule\u0026#39; option intranet_allowed \u0026#39;1\u0026#39; option disable_udp_quic \u0026#39;1\u0026#39; option lan_ac_mode \u0026#39;0\u0026#39; option operation_mode \u0026#39;redir-host\u0026#39; option enable_rule_proxy \u0026#39;0\u0026#39; option redirect_dns \u0026#39;1\u0026#39; option cachesize_dns \u0026#39;1\u0026#39; option filter_aaaa_dns \u0026#39;1\u0026#39; option small_flash_memory \u0026#39;0\u0026#39; option interface_name \u0026#39;0\u0026#39; option common_ports \u0026#39;21 22 23 53 80 123 143 194 443 465 587 853 993 995 998 2052 2053 2082 2083 2086 2095 2096 5222 5228 5229 5230 8080 8443 8880 8888 8889\u0026#39; option log_size \u0026#39;1024\u0026#39; option tolerance \u0026#39;0\u0026#39; option store_fakeip \u0026#39;0\u0026#39; option custom_fallback_filter \u0026#39;0\u0026#39; option custom_fakeip_filter \u0026#39;0\u0026#39; option custom_host \u0026#39;0\u0026#39; option custom_name_policy \u0026#39;0\u0026#39; option append_wan_dns \u0026#39;1\u0026#39; option stream_domains_prefetch \u0026#39;0\u0026#39; option stream_auto_select \u0026#39;0\u0026#39; option bypass_gateway_compatible \u0026#39;0\u0026#39; option github_address_mod \u0026#39;自定义的github代理地址\u0026#39; option urltest_address_mod \u0026#39;0\u0026#39; option urltest_interval_mod \u0026#39;0\u0026#39; option delay_start \u0026#39;15\u0026#39; option router_self_proxy \u0026#39;1\u0026#39; option release_branch \u0026#39;master\u0026#39; option enable_meta_core \u0026#39;1\u0026#39; option dashboard_type \u0026#39;Official\u0026#39; option yacd_type \u0026#39;Official\u0026#39; option append_default_dns \u0026#39;0\u0026#39; option geo_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb\u0026#39; option chnr_custom_url \u0026#39;https://ispip.clang.cn/all_cn.txt\u0026#39; option chnr6_custom_url \u0026#39;https://ispip.clang.cn/all_cn_ipv6.txt\u0026#39; option cndomain_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/felixonmars/dnsmasq-china-list@master/accelerated-domains.china.conf\u0026#39; option default_resolvfile \u0026#39;/tmp/resolv.conf.d/resolv.conf.auto\u0026#39; option find_process_mode \u0026#39;0\u0026#39; option global_client_fingerprint \u0026#39;0\u0026#39; option geodata_loader \u0026#39;0\u0026#39; option enable_geoip_dat \u0026#39;0\u0026#39; option enable_meta_sniffer \u0026#39;1\u0026#39; option enable_meta_sniffer_pure_ip \u0026#39;1\u0026#39; option enable_meta_sniffer_custom \u0026#39;0\u0026#39; option config_reload \u0026#39;1\u0026#39; option config_auto_update_mode \u0026#39;1\u0026#39; option config_update_interval \u0026#39;45\u0026#39; option config_path \u0026#39;/etc/openclash/config/skyvpn.yaml\u0026#39; option restricted_mode \u0026#39;0\u0026#39; option dnsmasq_resolvfile \u0026#39;/tmp/resolv.conf.d/resolv.conf.auto\u0026#39; option enable_custom_domain_dns_server \u0026#39;0\u0026#39; option china_ip_route \u0026#39;1\u0026#39; option geo_auto_update \u0026#39;1\u0026#39; option geo_update_week_time \u0026#39;*\u0026#39; option geo_update_day_time \u0026#39;6\u0026#39; option geoip_auto_update \u0026#39;1\u0026#39; option geosite_auto_update \u0026#39;1\u0026#39; option chnr_auto_update \u0026#39;1\u0026#39; option chnr_update_week_time \u0026#39;*\u0026#39; option chnr_update_day_time \u0026#39;3\u0026#39; option auto_restart \u0026#39;1\u0026#39; option auto_restart_week_time \u0026#39;*\u0026#39; option auto_restart_day_time \u0026#39;13\u0026#39; option core_type \u0026#39;Meta\u0026#39; option enable_udp_proxy \u0026#39;1\u0026#39; option geoip_update_week_time \u0026#39;*\u0026#39; option geoip_update_day_time \u0026#39;7\u0026#39; option geoip_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat\u0026#39; option geosite_update_week_time \u0026#39;*\u0026#39; option geosite_update_day_time \u0026#39;8\u0026#39; option geosite_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat\u0026#39; option dnsmasq_noresolv \u0026#39;0\u0026#39; option ipv6_mode \u0026#39;1\u0026#39; option enable_v6_udp_proxy \u0026#39;1\u0026#39; option china_ip6_route \u0026#39;0\u0026#39; option dnsmasq_cachesize \u0026#39;10000\u0026#39; option dnsmasq_filter_aaaa \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;nameserver\u0026#39; option type \u0026#39;udp\u0026#39; option ip \u0026#39;114.114.114.114\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;nameserver\u0026#39; option type \u0026#39;udp\u0026#39; option ip \u0026#39;119.29.29.29\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;nameserver\u0026#39; option type \u0026#39;udp\u0026#39; option ip \u0026#39;119.28.28.28\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;nameserver\u0026#39; option type \u0026#39;udp\u0026#39; option ip \u0026#39;223.5.5.5\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option type \u0026#39;https\u0026#39; option ip \u0026#39;doh.pub/dns-query\u0026#39; option group \u0026#39;nameserver\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option type \u0026#39;https\u0026#39; option ip \u0026#39;dns.alidns.com/dns-query\u0026#39; option group \u0026#39;nameserver\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option type \u0026#39;https\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.cloudflare.com/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.google\u0026#39; option port \u0026#39;853\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;1.1.1.1/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;1.1.1.1\u0026#39; option port \u0026#39;853\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;8.8.8.8\u0026#39; option port \u0026#39;853\u0026#39; option type \u0026#39;tls\u0026#39; config dns_servers option type \u0026#39;udp\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;2001:4860:4860::8888\u0026#39; option port \u0026#39;53\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option type \u0026#39;udp\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;2001:4860:4860::8844\u0026#39; option port \u0026#39;53\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option type \u0026#39;udp\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;2001:da8::666\u0026#39; option port \u0026#39;53\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;public.dns.iij.jp/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;jp.tiar.app/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;jp.tiarap.org/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;jp.tiar.app\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dot.tiar.app\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;doh.dnslify.com/dns-query\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.twnic.tw/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.oszx.co/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;doh.applied-privacy.net/query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dnsforge.de/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;doh.ffmuc.net/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;doh.mullvad.net/dns-query\u0026#39; config authentication option enabled \u0026#39;1\u0026#39; option username \u0026#39;Clash\u0026#39; option password \u0026#39;socket合同http（s）代理密码\u0026#39; config dns_servers option enabled \u0026#39;1\u0026#39; option group \u0026#39;nameserver\u0026#39; option type \u0026#39;udp\u0026#39; option ip \u0026#39;10.1.1.104\u0026#39; option interface \u0026#39;Disable\u0026#39; option node_resolve \u0026#39;0\u0026#39; option specific_group \u0026#39;Disable\u0026#39; config dns_servers option enabled \u0026#39;1\u0026#39; option group \u0026#39;fallback\u0026#39; option type \u0026#39;udp\u0026#39; option ip \u0026#39;10.1.1.104\u0026#39; option interface \u0026#39;Disable\u0026#39; option node_resolve \u0026#39;0\u0026#39; option specific_group \u0026#39;Disable\u0026#39; config dns_servers option enabled \u0026#39;1\u0026#39; option group \u0026#39;default\u0026#39; option type \u0026#39;udp\u0026#39; option ip \u0026#39;10.1.1.104\u0026#39; option interface \u0026#39;Disable\u0026#39; option node_resolve \u0026#39;0\u0026#39; config config_subscribe option enabled \u0026#39;1\u0026#39; option name \u0026#39;skyvpn\u0026#39; option address \u0026#39;你的订阅地址\u0026#39; option sub_convert \u0026#39;1\u0026#39; option convert_address \u0026#39;https://api.dler.io/sub\u0026#39; option template \u0026#39;ACL4SSR 规则 Online Full\u0026#39; option emoji \u0026#39;false\u0026#39; option udp \u0026#39;false\u0026#39; option skip_cert_verify \u0026#39;false\u0026#39; option sort \u0026#39;false\u0026#39; option node_type \u0026#39;false\u0026#39; option rule_provider \u0026#39;false\u0026#39; ","date":"2023-09-16T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/lxc-mian-op/","title":"双网卡 pve8.0.3 lxc 运行 openwrt作为主路由 最靠谱简单教程"},{"content":"某些情况下，docker和lxc不适合使用。例如内核不支持、或者docker会引入iptable的复杂化。这时候需要容器化的是可选的就只有systemd-nspawn 和chroot。但是systemd-nspawn仅在支持systemd的发行版有效。强用又会引入更复杂的状况。\n这时候 chroot 又成为了唯一的选择。 但是chroot也有一些问题，例如：过于低级 使用 复杂。\nchroot chroot 是 Linux 内置的命令，所以不需要额外安装任何软件包或工具即可使用。它是一种常见且有用的工具，被广泛应用于隔离、测试和恢复操作系统环境。\ncreate chroot 需要一个目录 或者一个 raw文件 里面应该是一个完整的rootfs. 常见的发行版可以去 https://mirrors.tuna.tsinghua.edu.cn/lxc-images/images/ 这里下载。\n1 2 3 4 mkdir ~/container-chroot \u0026amp;\u0026amp; cd ~/container-chroot # 两个典型的发行版 wget https://mirrors.tuna.tsinghua.edu.cn/lxc-images/images/debian/bookworm/amd64/default/20230830_05%3A24/rootfs.tar.xz -O bookworm.tar.xz wget https://mirrors.tuna.tsinghua.edu.cn/lxc-images/images/alpine/3.18/amd64/default/20230830_13%3A00/rootfs.tar.xz -O alpine.tar.xz 使用 我 使用chroot 运行一个 redis\n配置目录 debian\n1 2 mkdir bw-redis tar -xf bookworm.tar.xz -C ./bw-redis alpine\n1 2 mkdir alpine tar -xf alpine.tar.xz -C alpine 基础目录 镜像里面已经有 一般不需要\n1 2 mkdir ./alpine/{dev,proc,sys,run} mkdir ./bw-redis/{dev,proc,sys,run} 挂载 主要是挂载/dev进去\n1 2 mount -v --bind /dev ./bw-redis/dev mount -v --bind /dev ./alpine/dev 看情况，可能你还需要挂载 /tmp 等目录\n进入容器 1 2 sudo chroot bw-redis #debian sudo chroot alpine /bin/busybox sh # alpine 默认没有bash 配置网络 网络和宿主机是一样的，但是没有dns\n1 2 3 4 5 rm -rf /etc/resolv.conf # 默认是一个空符号连接，要删掉 echo \u0026#34;search lan\u0026#34; \u0026gt;/etc/resolv.conf echo \u0026#34;nameserver 114.114.114.114\u0026#34; \u0026gt;\u0026gt;/etc/resolv.conf cat /etc/resolv.conf ping baidu.com 其他一些目录权限和需要挂载的目录 需要处理一下\n1 2 3 4 5 chown -R root:root /etc/sudo.conf /etc/sudoers # sudo 命令 chown -R root:root /etc/sudoers.d #根据发行版不同 需要调整一下配置文件 chmod -R 777 /tmp #会影响某一些文件写入，另外tmp最好挂载到宿主系统由宿主系统决定是否ramfs mount -t devpts devpts /dev/pts #挂载 devpts mount -t proc proc /proc #挂载proc ， ps 以及其他进程管理类的工具 要用 安装redis debian\n1 2 3 4 5 6 7 8 9 10 11 12 apt update apt install apt-transport-https ca-certificates # https://mirror.tuna.tsinghua.edu.cn/help/debian/ 修改国内源 apt install lsb-release curl gpg curl -fsSL https://packages.redis.io/gpg | gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg echo \u0026#34;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main\u0026#34; | tee /etc/apt/sources.list.d/redis.list apt update apt install redis-tools=6:7.2.1-1rl1~bookworm1 apt install redis-server=6:7.2.1-1rl1~bookworm1 alpine\n1 2 apk update apk add redis redis 没有提供alpine的源，如果要安装指定版本的redis,可以自己编译，或者去docker 里面扣出来。\n启动 1 redis-server 一些其他的处理 redis 配置文件要处理一下。\n另外 local配置也可能会影响redis启动\ndebian 下需要运行下面的命令，alpine下对容器进行的很多优化，不需要搞这些可以启动。\n1 2 3 export TERM=xterm apt install locales dpkg-reconfigure locales ","date":"2023-09-15T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/container/chroot/","title":"chroot的使用方法 替代docker/lxc/lxd"},{"content":"安全性 简中很多文章说自签名证书不安全，这要看你怎么用。\n如果你是搭建面向公众的服务，例如网站 那么肯定不够安全的。 这是因为 普通用户无法通过简单并安全的方法验证你的证书是否真的是你的。因为没有权威ca存在了。\n而如果是面向内部使用的，我们可以通过权威ca 或者 其他加密途径分发证书。或者通过证书指纹验证的方法来确保安全。\n当然指纹验证严格说 也不够安全，虽然指纹被伪造的可能性也几乎没有。\n我们只要 保证 证书分发的过程是安全的，那么自签名证书的安全性 甚至可以超过 可信ca颁发的证书（参考我朝某衙）。\n碎碎念 ca机构运营是有成本的，所有权威证书需要付费无可厚非。但是自签证书并非不安全，资本的文章看看就好，多读书。\n同样类似 ssh协议，默认情况下，和自签名证书的过程其实并无差距。那么ssh不安全吗？\n自签名证书的优点 和商业收费证书同样安全性，某些方便甚至超过收费证书 可以灵活控制有效期，例如在某些特殊情况下，需要超长的有效期 自主可控 可以省略OCSP服务，速度会更快 OCSP 主要是方便检查证书是否有效的情况，也就是可以吊销掉已经签发出去的证书。但是OCSP会多了一个网络验证的操作，这也是某些在国内没有OCSP服务器的一些商业证书速度很慢的 原因。\n自签名ca和域名/ip证书的过程 下面一个简单说一下，自己用openssl实现 自己的ca 并签发证书的过程\nca CA私钥\n1 openssl genpkey -algorithm RSA -out ca_private.key CA请求文件\n1 openssl req -new -key ca_private.key -out ca_request.csr CA证书\n1 openssl x509 -req -in ca_request.csr -signkey ca_private.key -out ca_certificate.crt -days 3650 用ca签发证书 生成域名 私钥和 证书请求文件： openssl genpkey -algorithm RSA -out domain_private.key openssl req -new -key domain_private.key -out domain_request.csr\n从ca证书 签发证书 简单创建 一个 10年的\n1 openssl x509 -req -in domain_request.csr -CA ca_certificate.crt -CAkey ca_private.key -CAcreateserial -out domain_certificate.crt -days 3650 但是这个证书里面没有域名，客户端依旧会伪造，创建一个包含域名的\n1 openssl x509 -req -in domain_request.csr -CA ca_certificate.crt -CAkey ca_private.key -CAcreateserial -out domain_certificate.crt -days 3650 -extfile \u0026lt;(printf \u0026#34;subjectAltName=DNS:*.leiyanhui.com,DNS:leiyanhui.com,DNS:*.baidu.com,DNS:baidu.com\u0026#34;) 创建一个包含域名和ip范围的 1 2 IP_LIST=$(for i in {1..254}; do echo -n \u0026#34;IP:10.1.1.$i,\u0026#34;; done | sed \u0026#39;s/,$//\u0026#39;) # ip 10.1.1.1-10.1.1.254 openssl x509 -req -in domain_request.csr -CA ca_certificate.crt -CAkey ca_private.key -CAcreateserial -out domain_certificate.crt -days 3650 -extfile \u0026lt;(printf \u0026#34;subjectAltName=DNS:*.leiyanhui.com,DNS:*.shiyuxin.work,$IP_LIST\u0026#34;) 域名私钥和证书合并到一个 .pem 有部分软件是使用的 all in one的 pem格式，例如monit\n1 cat domain_private.key domain_certificate.crt \u0026gt; domain_aio.pem 客户端应该如何信任 上面命令中的 ca_certificate.crt 和 domain_certificate.crt 都是包含公钥的证书文件，服务器会自动分发给客户端。但是这个过程是无法保证安全的。\n那么 这个两个文件，可以通过其他可信的途径分发给客户端。 例如： 可信ca的 https webdav email 甚至vpn 线下 内网 等方式\n一般情况下，建议客户端信任 ca_certificate.crt 即可。那么所有使用 ca_certificate.crt 签发的证书，只要ip/域名 能对应 客户端就会认为是安全的。\n如果只是信任 domain_certificate.crt 的话，那么自己的ca证书签发的别的证书就无法可信了。这个很好理解。\n那些文件是可以公开的 只有 ca_certificate.crt 和 domain_certificate.crt 这两个文件 可以公开的。其他文件务必妥善保管。 尤其是 ca_private.key 这个文件，如果泄漏 就等于 天朝某衙门作恶了。\n","date":"2023-09-12T08:30:20+08:00","permalink":"https://dev.leiyanhui.com/web/ssl/","title":"自签名证书的使用，以及辟谣：自签名证书其实非常安全，但是需要你处理好客户端信任的问题"},{"content":"为了方便重新刷机后快速手动恢复，记录一下。\nopenssh替代dropbear x86下 建议编译的时候就去掉dropbear 用openssh 用ttyd或者 启动脚本执行 下面命令 写入证书\n1 2 3 4 5 6 mkdir -p /root/.ssh/ cat \u0026gt; /root/.ssh/authorized_keys \u0026lt;\u0026lt; \\EOF ssh-rsa XXXXXX EOF chmod -R 600 ~/.ssh/authorized_keys /etc/init.d/sshd restart 或者允许root密码登陆\n1 2 3 4 /bin/cp -n /etc/ssh/sshd_config /etc/ssh/sshd_config-bak sed -i \u0026#39;s/#PermitRootLogin without-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config /etc/init.d/sshd restart 防火墙 允许内网设备ip6v对外服务 1 2 3 4 5 6 7 8 9 10 ################################ 允许内网ipv6 ################################ uci add firewall rule uci set firewall.@rule[-1].name=\u0026#39;MY_Allow_IPv6_Services\u0026#39; uci set firewall.@rule[-1].src=\u0026#39;wan\u0026#39; uci set firewall.@rule[-1].dest=\u0026#39;*\u0026#39; uci set firewall.@rule[-1].proto=\u0026#39;tcp udp\u0026#39; uci set firewall.@rule[-1].family=\u0026#39;ipv6\u0026#39; uci set firewall.@rule[-1].target=\u0026#39;ACCEPT\u0026#39; uci commit firewall 端口映射 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 ################################ nginx ################################ uci add firewall redirect uci set firewall.@redirect[-1].name=\u0026#39;nginx\u0026#39; uci set firewall.@redirect[-1].family=\u0026#39;ipv4\u0026#39; uci set firewall.@redirect[-1].src=\u0026#39;wan\u0026#39; uci set firewall.@redirect[-1].dest=\u0026#39;lan\u0026#39; uci set firewall.@redirect[-1].target=\u0026#39;DNAT\u0026#39; uci set firewall.@redirect[-1].dest_ip=\u0026#39;10.1.1.50\u0026#39; uci set firewall.@redirect[-1].dest_port=\u0026#39;50400-50443\u0026#39; uci set firewall.@redirect[-1].src_dport=\u0026#39;50400-50443\u0026#39; uci commit firewall ################################ redis_tcp ################################ # 省略 ################################ ipsec4500 ################################ uci add firewall redirect uci set firewall.@redirect[-1].name=\u0026#39;ipsec4500\u0026#39; uci set firewall.@redirect[-1].family=\u0026#39;ipv4\u0026#39; uci set firewall.@redirect[-1].src=\u0026#39;wan\u0026#39; uci set firewall.@redirect[-1].dest=\u0026#39;lan\u0026#39; uci set firewall.@redirect[-1].target=\u0026#39;DNAT\u0026#39; uci set firewall.@redirect[-1].dest_ip=\u0026#39;10.1.1.45\u0026#39; uci set firewall.@redirect[-1].dest_port=\u0026#39;4500\u0026#39; uci set firewall.@redirect[-1].src_dport=\u0026#39;4500\u0026#39; uci commit firewall uci add firewall redirect uci set firewall.@redirect[-1].name=\u0026#39;ipsec500\u0026#39; uci set firewall.@redirect[-1].family=\u0026#39;ipv4\u0026#39; uci set firewall.@redirect[-1].src=\u0026#39;wan\u0026#39; uci set firewall.@redirect[-1].dest=\u0026#39;lan\u0026#39; uci set firewall.@redirect[-1].target=\u0026#39;DNAT\u0026#39; uci set firewall.@redirect[-1].dest_ip=\u0026#39;10.1.1.45\u0026#39; uci set firewall.@redirect[-1].dest_port=\u0026#39;500\u0026#39; uci set firewall.@redirect[-1].src_dport=\u0026#39;500\u0026#39; uci commit firewall ################################ RustDesk ################################ uci add firewall redirect uci set firewall.@redirect[-1].name=\u0026#39;RustDesk\u0026#39; uci set firewall.@redirect[-1].family=\u0026#39;ipv4\u0026#39; uci set firewall.@redirect[-1].src=\u0026#39;wan\u0026#39; uci set firewall.@redirect[-1].dest=\u0026#39;lan\u0026#39; uci set firewall.@redirect[-1].target=\u0026#39;DNAT\u0026#39; uci set firewall.@redirect[-1].dest_ip=\u0026#39;10.1.1.15\u0026#39; uci set firewall.@redirect[-1].dest_port=\u0026#39;21115-21119\u0026#39; uci set firewall.@redirect[-1].src_dport=\u0026#39;21115-21119\u0026#39; uci commit firewall ################################ npc ################################ # # 省略 #更多... /etc/init.d/firewall restart dhcp静态绑定 1 2 3 4 5 6 7 8 9 10 11 12 13 uci commit dhcp uci add dhcp host uci set dhcp.@host[-1].name=\u0026#39;usbWifi\u0026#39; # 客户端名称 uci set dhcp.@host[-1].mac=\u0026#39;xx:xx:xx:xx:xx:xx\u0026#39; # 客户端的MAC地址 uci set dhcp.@host[-1].ip=\u0026#39;10.1.1.70\u0026#39; # 静态IP地址 uci commit dhcp uci add dhcp host uci set dhcp.@host[-1].name=\u0026#39;iphoneL\u0026#39; uci set dhcp.@host[-1].mac=\u0026#39;xx:xx:xx:xx:xx:xx\u0026#39; uci set dhcp.@host[-1].ip=\u0026#39;10.1.1.71\u0026#39; uci commit dhcp #更多... /etc/init.d/dnsmasq restart openclash 自定义规则 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 ##script: ##rules: - DOMAIN-SUFFIX,gitea.io,🚀 节点选择 - DOMAIN-SUFFIX,mypikpak.com,🚀 节点选择 - DOMAIN-SUFFIX,dwz.date,🚀 节点选择 - DOMAIN-SUFFIX,chaojijichang.com,🚀 节点选择 - DOMAIN-SUFFIX,acme.sh,🚀 节点选择 - DOMAIN-SUFFIX,github.com,🚀 节点选择 - DOMAIN-SUFFIX,netlify.app,🚀 节点选择 - DOMAIN-SUFFIX,geekdocs.de,🚀 节点选择 - DOMAIN-SUFFIX,dmdy12.cc,🚀 节点选择 - DOMAIN-SUFFIX,restic.net,🚀 节点选择 - DOMAIN-SUFFIX,codigoparallevar.com,🚀 节点选择 - DOMAIN-SUFFIX,mypikpak.com,🚀 节点选择 - DOMAIN-SUFFIX,go.dev,🚀 节点选择 - DOMAIN-SUFFIX,v2ex.com,🚀 节点选择 - DOMAIN-SUFFIX,virtualhere.com,DIRECT - DOMAIN-SUFFIX,shiftr.io,DIRECT - DOMAIN-SUFFIX,nuaa.cf,DIRECT - DOMAIN-SUFFIX,bitwarden.com,DIRECT ## linux - DOMAIN,dl-cdn.alpinelinux.org,🚀 节点选择 - DOMAIN,gitlab.archlinux.org,🚀 节点选择 - DOMAIN-SUFFIX,alpinelinux.org,DIRECT - DOMAIN-SUFFIX,archlinux.org,DIRECT - DOMAIN-SUFFIX,archlinuxcn.org,DIRECT - DOMAIN,deb.debian.org,🚀 节点选择 - DOMAIN,cn.archive.ubuntu.com,🚀 节点选择 ## 安卓 - DOMAIN-SUFFIX,coloros.com,DIRECT ## github - DOMAIN-SUFFIX,ghproxy.com,DIRECT - DOMAIN-SUFFIX,ghproxy.com,DIRECT ## docker - DOMAIN-SUFFIX,docker.io,🚀 节点选择 ## 淘宝 - DOMAIN-SUFFIX,taobao.com,DIRECT - DOMAIN-SUFFIX,tmall.com,DIRECT - DOMAIN-SUFFIX,taobao.com.cn,DIRECT - DOMAIN-SUFFIX,tmall.com.cn,DIRECT - DOMAIN-SUFFIX,alibaba.com,DIRECT - DOMAIN-SUFFIX,aliexpress.com,DIRECT - DOMAIN-SUFFIX,alipay.com,DIRECT - DOMAIN-SUFFIX,etao.com,DIRECT - DOMAIN-SUFFIX,juhuasuan.com,DIRECT - DOMAIN-SUFFIX,fliggy.com,DIRECT - DOMAIN-SUFFIX,alimama.com,DIRECT - DOMAIN-SUFFIX,alibaba-inc.com,DIRECT - DOMAIN-SUFFIX,alibabacloud.com,DIRECT - DOMAIN-SUFFIX,alicdn.com,DIRECT - DOMAIN-SUFFIX,alibaba.net,DIRECT - DOMAIN-SUFFIX,aliyuncs.com,DIRECT ## netdisk - DOMAIN-SUFFIX,r2.cloudflarestorage.com,DIRECT - DOMAIN-SUFFIX,koofr.net,DIRECT - DOMAIN-SUFFIX,pcloud.com,DIRECT ## 微软 补充规则 - DOMAIN-SUFFIX,bing.com,DIRECT - DOMAIN-SUFFIX,ecosia.org,DIRECT - DOMAIN-SUFFIX,microsoft.com,DIRECT #- DOMAIN-SUFFIX,packages.microsoft.com,🚀 节点选择 - DOMAIN-SUFFIX,live.com,DIRECT - DOMAIN-SUFFIX,microsoftonline.cn,DIRECT - DOMAIN-SUFFIX,sharepoint.cn,DIRECT # ipv6 用镜像站区分 - DOMAIN-SUFFIX,test-ipv6.com,🚀 节点选择 - DOMAIN-SUFFIX,ip.zxinc.org,DIRECT ## DDNS https://ip.skk.moe/ - DOMAIN-SUFFIX,checkip.dyndns.org,DIRECT - DOMAIN-SUFFIX,checkipv6.dyndns.org,DIRECT - DOMAIN-SUFFIX,checkip.synology.com,DIRECT - DOMAIN-SUFFIX,ifconfig.co,DIRECT - DOMAIN-SUFFIX,api.myip.com,DIRECT - DOMAIN-SUFFIX,ip-api.com,DIRECT - DOMAIN-SUFFIX,ipapi.co,DIRECT - DOMAIN-SUFFIX,ip6.seeip.org,DIRECT - DOMAIN-SUFFIX,members.3322.org,DIRECT ## eu.org - DOMAIN-SUFFIX,nic.eu.org,🚀 节点选择 - DOMAIN-SUFFIX,eu.org,DIRECT ## 天气相关 ## poltbar - DOMAIN-SUFFIX,openweathermap.org,DIRECT ## nextcloud - DOMAIN-SUFFIX,openstreetmap.org,DIRECT - DOMAIN-SUFFIX,opentopodata.org,DIRECT - DOMAIN-SUFFIX,met.no,DIRECT ## cloudflare ipv4 ipv6 ## https://www.cloudflare.com/ips-v4 - IP-CIDR,1.1.1.1/8,DIRECT - IP-CIDR,173.245.48.0/20,DIRECT - IP-CIDR,103.21.244.0/22,DIRECT - IP-CIDR,103.22.200.0/22,DIRECT - IP-CIDR,103.31.4.0/22,DIRECT - IP-CIDR,141.101.64.0/18,DIRECT - IP-CIDR,108.162.192.0/18,DIRECT - IP-CIDR,190.93.240.0/20,DIRECT - IP-CIDR,188.114.96.0/20,DIRECT - IP-CIDR,197.234.240.0/22,DIRECT - IP-CIDR,198.41.128.0/17,DIRECT - IP-CIDR,162.158.0.0/15,DIRECT - IP-CIDR,104.16.0.0/13,DIRECT - IP-CIDR,104.24.0.0/14,DIRECT - IP-CIDR,172.64.0.0/13,DIRECT - IP-CIDR,131.0.72.0/22,DIRECT ## https://www.cloudflare.com/ips-v6 - IP-CIDR6,2400:cb00::/32,DIRECT - IP-CIDR6,2606:4700::/32,DIRECT - IP-CIDR6,2803:f800::/32,DIRECT - IP-CIDR6,2405:b500::/32,DIRECT - IP-CIDR6,2405:8100::/32,DIRECT - IP-CIDR6,2a06:98c0::/29,DIRECT - IP-CIDR6,2c0f:f248::/32,DIRECT ## dash.cloudflare.com / - DOMAIN-SUFFIX,wwww.cloudflare.com,🚀 节点选择 - DOMAIN-SUFFIX,dash.cloudflare.com,🚀 节点选择 - DOMAIN-SUFFIX,static.dash.cloudflare.com,🚀 节点选择 ## vod - DOMAIN-SUFFIX,ffzy-play5.com,DIRECT - DOMAIN-SUFFIX,ffzypic.com,DIRECT ## 强制直连 密码插件 - DOMAIN-SUFFIX,bitwarden.net,DIRECT ## 屏蔽清单 ## 鼠标右键插件 - DOMAIN-SUFFIX,mousegesturesapi.com,REJECT ## 其他国内ip强制直连 - GEOIP,CN,DIRECT 基本配置文件 rm /etc/config/openclash \u0026amp;\u0026amp; nano /etc/config/openclash\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 config openclash \u0026#39;config\u0026#39; option proxy_port \u0026#39;7892\u0026#39; option tproxy_port \u0026#39;7895\u0026#39; option mixed_port \u0026#39;7893\u0026#39; option socks_port \u0026#39;7891\u0026#39; option http_port \u0026#39;7890\u0026#39; option dns_port \u0026#39;7874\u0026#39; option enable \u0026#39;1\u0026#39; option update \u0026#39;0\u0026#39; option en_mode \u0026#39;redir-host\u0026#39; option auto_update \u0026#39;1\u0026#39; option cn_port \u0026#39;9090\u0026#39; option dashboard_password \u0026#39;123456\u0026#39; option dashboard_forward_ssl \u0026#39;0\u0026#39; option rule_source \u0026#39;0\u0026#39; option enable_custom_dns \u0026#39;1\u0026#39; option ipv6_enable \u0026#39;0\u0026#39; option ipv6_dns \u0026#39;1\u0026#39; option enable_custom_clash_rules \u0026#39;0\u0026#39; option other_rule_auto_update \u0026#39;1\u0026#39; option core_version \u0026#39;linux-amd64\u0026#39; option enable_redirect_dns \u0026#39;1\u0026#39; option servers_if_update \u0026#39;0\u0026#39; option disable_masq_cache \u0026#39;1\u0026#39; option servers_update \u0026#39;0\u0026#39; option log_level \u0026#39;0\u0026#39; option proxy_mode \u0026#39;rule\u0026#39; option intranet_allowed \u0026#39;1\u0026#39; option enable_udp_proxy \u0026#39;1\u0026#39; option disable_udp_quic \u0026#39;1\u0026#39; option lan_ac_mode \u0026#39;0\u0026#39; option operation_mode \u0026#39;redir-host\u0026#39; option enable_rule_proxy \u0026#39;0\u0026#39; option redirect_dns \u0026#39;1\u0026#39; option cachesize_dns \u0026#39;1\u0026#39; option filter_aaaa_dns \u0026#39;1\u0026#39; option small_flash_memory \u0026#39;0\u0026#39; option interface_name \u0026#39;0\u0026#39; option common_ports \u0026#39;0\u0026#39; option log_size \u0026#39;1024\u0026#39; option tolerance \u0026#39;0\u0026#39; option store_fakeip \u0026#39;0\u0026#39; option custom_fallback_filter \u0026#39;0\u0026#39; option custom_fakeip_filter \u0026#39;0\u0026#39; option custom_host \u0026#39;0\u0026#39; option custom_name_policy \u0026#39;0\u0026#39; option append_wan_dns \u0026#39;0\u0026#39; option stream_domains_prefetch \u0026#39;0\u0026#39; option stream_auto_select \u0026#39;0\u0026#39; option bypass_gateway_compatible \u0026#39;0\u0026#39; option github_address_mod \u0026#39;https://ghproxy.com/\u0026#39; option urltest_address_mod \u0026#39;0\u0026#39; option urltest_interval_mod \u0026#39;0\u0026#39; option delay_start \u0026#39;0\u0026#39; option router_self_proxy \u0026#39;1\u0026#39; option release_branch \u0026#39;master\u0026#39; option enable_meta_core \u0026#39;0\u0026#39; option dashboard_type \u0026#39;Official\u0026#39; option yacd_type \u0026#39;Official\u0026#39; option append_default_dns \u0026#39;0\u0026#39; option geo_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb\u0026#39; option chnr_custom_url \u0026#39;https://ispip.clang.cn/all_cn.txt\u0026#39; option chnr6_custom_url \u0026#39;https://ispip.clang.cn/all_cn_ipv6.txt\u0026#39; option cndomain_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/felixonmars/dnsmasq-china-list@master/accelerated-domains.china.conf\u0026#39; option default_resolvfile \u0026#39;/tmp/resolv.conf.d/resolv.conf.auto\u0026#39; option config_auto_update_mode \u0026#39;1\u0026#39; option config_update_interval \u0026#39;45\u0026#39; option config_path \u0026#39;/etc/openclash/config/skyvpn.yaml\u0026#39; option restricted_mode \u0026#39;0\u0026#39; option config_reload \u0026#39;1\u0026#39; option dnsmasq_resolvfile \u0026#39;/tmp/resolv.conf.d/resolv.conf.auto\u0026#39; option enable_custom_domain_dns_server \u0026#39;0\u0026#39; option china_ip_route \u0026#39;0\u0026#39; option other_rule_update_week_time \u0026#39;*\u0026#39; option other_rule_update_day_time \u0026#39;22\u0026#39; option geo_auto_update \u0026#39;1\u0026#39; option geo_update_week_time \u0026#39;*\u0026#39; option geo_update_day_time \u0026#39;1\u0026#39; option geoip_auto_update \u0026#39;1\u0026#39; option geosite_auto_update \u0026#39;1\u0026#39; option chnr_auto_update \u0026#39;1\u0026#39; option chnr_update_week_time \u0026#39;*\u0026#39; option chnr_update_day_time \u0026#39;4\u0026#39; option auto_restart \u0026#39;0\u0026#39; option auto_restart_week_time \u0026#39;1\u0026#39; option auto_restart_day_time \u0026#39;0\u0026#39; option geoip_update_week_time \u0026#39;*\u0026#39; option geoip_update_day_time \u0026#39;2\u0026#39; option geoip_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat\u0026#39; option geosite_update_week_time \u0026#39;*\u0026#39; option geosite_update_day_time \u0026#39;3\u0026#39; option geosite_custom_url \u0026#39;https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat\u0026#39; option restart \u0026#39;0\u0026#39; option dnsmasq_noresolv \u0026#39;0\u0026#39; option find_process_mode \u0026#39;0\u0026#39; option global_client_fingerprint \u0026#39;0\u0026#39; option geodata_loader \u0026#39;0\u0026#39; option enable_geoip_dat \u0026#39;0\u0026#39; option enable_meta_sniffer \u0026#39;1\u0026#39; option enable_meta_sniffer_pure_ip \u0026#39;1\u0026#39; option enable_meta_sniffer_custom \u0026#39;0\u0026#39; option dnsmasq_cachesize \u0026#39;10000\u0026#39; config dns_servers option type \u0026#39;https\u0026#39; option ip \u0026#39;doh.pub/dns-query\u0026#39; option group \u0026#39;nameserver\u0026#39; option enabled \u0026#39;1\u0026#39; config dns_servers option type \u0026#39;https\u0026#39; option ip \u0026#39;dns.alidns.com/dns-query\u0026#39; option group \u0026#39;nameserver\u0026#39; option enabled \u0026#39;1\u0026#39; config dns_servers option type \u0026#39;https\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.cloudflare.com/dns-query\u0026#39; option enabled \u0026#39;1\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.google\u0026#39; option port \u0026#39;853\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;1\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;1.1.1.1/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;1.1.1.1\u0026#39; option port \u0026#39;853\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;1\u0026#39; config dns_servers option enabled \u0026#39;1\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;8.8.8.8\u0026#39; option port \u0026#39;853\u0026#39; option type \u0026#39;tls\u0026#39; config dns_servers option type \u0026#39;udp\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;2001:4860:4860::8888\u0026#39; option port \u0026#39;53\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option type \u0026#39;udp\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;2001:4860:4860::8844\u0026#39; option port \u0026#39;53\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option type \u0026#39;udp\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;2001:da8::666\u0026#39; option port \u0026#39;53\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;public.dns.iij.jp/dns-query\u0026#39; option enabled \u0026#39;1\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;jp.tiar.app/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;jp.tiarap.org/dns-query\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;jp.tiar.app\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dot.tiar.app\u0026#39; option type \u0026#39;tls\u0026#39; option enabled \u0026#39;0\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;doh.dnslify.com/dns-query\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.twnic.tw/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;1\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dns.oszx.co/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;doh.applied-privacy.net/query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;dnsforge.de/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option ip \u0026#39;doh.ffmuc.net/dns-query\u0026#39; option type \u0026#39;https\u0026#39; config dns_servers option enabled \u0026#39;0\u0026#39; option group \u0026#39;fallback\u0026#39; option type \u0026#39;https\u0026#39; option ip \u0026#39;doh.mullvad.net/dns-query\u0026#39; config authentication option enabled \u0026#39;1\u0026#39; option username \u0026#39;Clash\u0026#39; option password \u0026#39;PxWRaBiU\u0026#39; config config_subscribe option enabled \u0026#39;1\u0026#39; option name \u0026#39;skyvpn\u0026#39; option address \u0026#39;\u0026lt;订阅地址\u0026gt;\u0026#39; option sub_convert \u0026#39;1\u0026#39; option convert_address \u0026#39;https://api.dler.io/sub\u0026#39; option template \u0026#39;ACL4SSR 规则 Online Full\u0026#39; option emoji \u0026#39;false\u0026#39; option udp \u0026#39;false\u0026#39; option skip_cert_verify \u0026#39;false\u0026#39; option sort \u0026#39;false\u0026#39; option node_type \u0026#39;false\u0026#39; option rule_provider \u0026#39;false\u0026#39; config config_subscribe option enabled \u0026#39;1\u0026#39; option name \u0026#39;yiyuan\u0026#39; option address \u0026#39;\u0026lt;订阅地址\u0026gt;\u0026#39; option sub_convert \u0026#39;1\u0026#39; option convert_address \u0026#39;https://api.dler.io/sub\u0026#39; option template \u0026#39;ACL4SSR 规则 Online Full\u0026#39; option emoji \u0026#39;false\u0026#39; option udp \u0026#39;false\u0026#39; option skip_cert_verify \u0026#39;false\u0026#39; option sort \u0026#39;false\u0026#39; option node_type \u0026#39;false\u0026#39; option rule_provider \u0026#39;false\u0026#39; config config_subscribe option enabled \u0026#39;1\u0026#39; option name \u0026#39;feiniaoyun\u0026#39; option address \u0026#39;\u0026lt;订阅地址\u0026gt;\u0026#39; option sub_convert \u0026#39;1\u0026#39; option convert_address \u0026#39;https://api.dler.io/sub\u0026#39; option template \u0026#39;ACL4SSR 规则 Online Full\u0026#39; option emoji \u0026#39;false\u0026#39; option udp \u0026#39;false\u0026#39; option skip_cert_verify \u0026#39;false\u0026#39; option sort \u0026#39;false\u0026#39; option node_type \u0026#39;false\u0026#39; option rule_provider \u0026#39;false\u0026#39; ","date":"2023-09-12T00:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/uci/","title":"openwrt 常用命令记录"},{"content":"2025-03 更新： 建议使用zed-editor https://dev.leiyanhui.com/c/zed-editor\nvscode 因为要处理一些常规项目，还是需要一个轻量级的文本编辑器工具来作为副编辑器。 加上一直想找一个跨平台的vscode之外的开发工具。 这几年其实一直在用notepad++ 和 相关的替代软件尝试替代它。\n选择标准 我的需求不一定适合你，我需要的是记事本的替代工具。 1、免配置，可以代码高亮\n2、支持多标签的，不然无脑选 notepad2 notepad3了\n3、轻量 体积小 小文件启动快（大文件无所谓 还有vscode呢）\n4、最好免费开源\n5、最好跨平台 本文创建于2020年，后续虽有部分更新但是已经不全\n过程 notepad2 notepad3 notepad2 不错，但是不支持多标签 notepad3 也不支持。 最要命的这俩货都是win only\ngedit gnome 默认编辑器 。当然有win和mac版本，我感觉还不错。高级功能没怎么研究过 。gnome-builder 支持lsp但是不轻量，启动速度不适合作为复文本编辑器使用。\ngedit 有一些小插件，但是没折腾过lsp不确定是否支持\n1 2 sudo apt install gedit sudo apt install gedit-plugins 优点 启动速度尚可 有几个没啥太大卵用的小插件 有git最后提交高亮插件 这个不错 有可以自定义的自动保存 定位就是文本编辑器，虽然有代码片段，括号补全之类的，但是作为轻量级代码编辑器很多 小缺点 启动速度没那么舒服 没研究明白代码自定补全或者lsp的配置 i3w桌面下 右上角有最大化最小化按钮 去不掉 无法修改标题栏颜色 部分文件格式不能自动识别，常见的 conf文件 需手动选择一次 (小问题) win下有代码概括图。linux和macos下没有。也都没有大纲功能。 侧栏 只能一个 有插件可以开一个shell底部栏，但是有多于的大空白按钮占用屏幕空间 mousepad xfce默认编辑器，没有win和mac版本，linux版下无法实现代码中变量选中高亮。\nsublime text 收费的不开源，但是跨平台，不付费会显示为注册但是不太影响使用。win版的话很容易找到开心版。\nsublime启动速度快，软件包软体也小，内存占用也不高，其实非常不错！\nsublime的插件数量只比vsc逊色，但是插件质量都非常高，性能也很好。\n虽然是一个收费的软件，但是对一些后缀名比较特殊的文件（例如.conf）也无法自动识别格式，有插件可以配置为默认识别为某一种格式 比如 batch，略微麻烦。 补充一句，sublime非常强，并不比vsc差。但是他和vsc的插件数量没法比。\nkate Kate作为kde的默认编辑器 很熟悉了，也经常用。kate很强大。 只是kate真的不算轻量 启动也慢一拍。在非kde下ui也有一点小小的兼容问题\nnotepad next notepad \u0026ndash; 怎么说呢\u0026hellip; 比记事本好用一点点吧。问题很多，尝试就是浪费时间，小问题数不胜数，基本还处于玩具级\nnotepad next 略微好一些\nnotepad next 旧版本问题 非常多，基本上无法使用，新版 好一些 但是也不推荐使用\n发现的问题 对conf后缀的 文件识别有问题 https://github.com/dail8859/NotepadNext/issues/365 md 文件的 标题不加粗 看起来很别扭 目前最新版0.6.1 值得star一下，不值得作为副文本编辑器使用 linux下ctrl+o 打开一个win样式的文件管理器\u0026hellip;linuz的文件管理功能首字母搜索也完全不能用，和 fctix5 也有兼容性问题需要手动处理。 虽然是对标notepad++的，但是云泥之别 helix 跨平台，性能好，支持lsp,但是学习成本太高，我只有短时间尝试过，没有深入使用 。\n个人浅浅的观点是，在没有ui的环境下，简单的编辑不如直接用vim和nano。复杂的不如拖回来，或者用支持ssh远程编辑器。 helix和vim命令和快捷键不完全兼容 helix的热度很多是rust带来的, 但是helix确实很不错。\nLapce 这个算是bug未动，宣传稿先行？网上很多吹，ui漂亮，但是功能上有很多问题。\nwin下尚不能正常启动，或者是偶尔直接无反应 可能是依赖问题，但是没有具体提示 vs++运行库已经安装的情况下也无法正常 也懒得去检查\nlinux下会出现鼠标和焦点不对齐的情况「新版已经修复」 体积不小，启动速度还可以\n没长时间使用，未来可期 眼下不建议折腾 atom atom体积太大 ，而且已经停止更新\nlite-xl 这个做不到开箱使用,过于轻量了，没有长时间体验。 打开文件的窗口只能输入路径 双击 无法高亮同词。也没有对应的插件或者配置项\nZed 原atom作者用rust写的新编辑器，目前还在公测，仅有macos平台，其他平台还在计划中，未来可期 眼下算了\nSlickEdit SlickEdit ，没测试 收费的\nEverEdit EverEdit 试用了一下 还不错，有单独的文件关联工具，不过正版要158元 而且只有win版 有破解版 可以正常使用。有一些插件 下载速度也可以。 但是EverEdit 自带的文件关联工具，会导致reg文件关联失效，注意，不要选中 。 win only 不知道什么人会买\u0026hellip;不懂他们的世界\u0026hellip;\nVSCodium vscode 写代码，习惯性点他的图标了。。\nVSCodium 和 notepad3 写文本 是一个不错的选择\n但是和 vscode 一样 启动略慢，吃内存多，所谓一个副文本编辑器 不值得\nRJ TextEd 支持lsp，支持旧版本windows，启动略慢 也不小 不支持非win平台\nUltraEdit 老牌了，收费而且不便宜，本来是一个文本编辑器，但是他操着ide的心，新版本启动很慢，小问题贼多！破解版都不太想用。。 不支持非win平台\neditplus 陪伴我走过青春的一个软件 35刀 太贵了一点\n现在是2023年了，他依旧是功能单薄，该有的没有，甚至比不上很多人尬吹的notepad next\nBowPad 初遇 免费开源绿色单文件，启动快（配置一次后 同目录 会多出来几个配置文件） 不支持非win平台\n有一个小问题就是 默认 会给一堆代码 加上红色波浪线 （去掉 右上角的 Spell Checker 就好了） 默认英文，官网有中文语言包，需要你可以连接的上github ，在bowpad主面板点 other ，然后在 Languages other-language 等更新列表后 在选择中文，提示重启后重启一下就OK了。\nBowPad 作为一个文档编辑器来说 非常不错\n优点 免费 开源 体积小 程序5m 语言文件1.3m 启动快 秒开 支持大文件打开 但是打开速度没有UltraEdit好 支持暗黑主题 但是标题栏 other里面 下拉框还是白色的 支持简单自动完成，更复杂的没研究过 支持多数语言的代码高亮 缺点 标题栏 工具栏 有点占用屏幕空间 （2023-4发现 可以隐藏不显示 点最顶部的 倒三角 菜单） 不够强大吧，毕竟比不上vscode 哈哈 这么强大的编辑器，没有makedown预览 遗憾 只有win 没有其他平台 2023-04-11 发现 bowpad在打开 挂载的网络文件的时候 会经常发生假死 打开rcone挂载的文件暂时没有问题\ncudatext 也不错，秒开，支持代码大纲。\n中文 https://sourceforge.net/projects/cudatext/files/addons/translations/translation.zh_CN.zip/download 解压到 data\\lang ，重启软件，然后设置语言\n高亮选中的文本 没找到配置 开关 ，或许没有这个功能 发现的问题 右侧 代码大纲延迟比较大，有时候会有有2-4秒的延迟 win和linux下都有这个问题 双击的选中判断有一些和notepad++ 不太一样，无法区分中文标点符号 很怪的感觉 。 整体感受，漂亮，速度可以，使用感觉 各种别扭 尚不支持lsp，官网说在计划中 SciTE 这个只能算是一个内核引擎，配置极度复杂，没有过多深入使用。notepad++ 也是用的它\ntextadept 免费，体积并不小。 一开始使用打开中文文档乱码 没找配置项。而后发现新版没问题，尝试中.\n目前的使用感受 启动速度可以 内存占用很小 用右键菜单 多次打开同一个文件 会给你弄N个窗口出来，或许可以配置，还在研究 配置项是lua文件，需要自己搞定 支持lsp 这个软件 几乎可以说，你想要的功能 基本没有内置，但是可以扩充 官网 有一些常用的模块 https://github.com/orbitalquark/textadept/wiki 首选项是lua 需要自己写 linux下速度不错，但是ctrl+o 依旧不是linux原生，搜索文件不容易 AkelPad 体积小，启动快，没有中文语言包，可以多标签 单窗口 多窗口 等几个模式。 有cudatext的所有问题，并且不能自动识别文件代码高亮。需要手动配置，没找配置项。 替代系统自带记事本， 不合格。\nemacs 不得不说的软件，看你自己有没有时间折腾适应吧。\ngeany 很早之前有朋友推荐过，跨平台，体积100M左右，启动速度可以。 代码高亮 在yaml 和 md 文件中接近无。 没有选中高亮。（可用 shift+ctrl+m 手动）\n另外插件 Miscellanous Plugins for Geany（win下好像没有这个插件） 后来发现：auto-make 这个插件可以实现\n默认配色方案别扭，但是有内置 notepad++的方案，启动速度也非常好.\n发现的的问题 winrdp下 屏幕 取色器 吸管 会丢失光标 一直到退出 win下编辑 win资源管理器挂载的webdav的话 会无法保存，rclone挂载的没问题 编辑rclone挂载的文件，会一直 提示 磁盘文件比当前编辑的新，很烦，2023年弃用了 linux下 ctrl+c 有问题 hbuilder 虽然作为一个ide来说bug数量可以入选吉尼斯了（有一些不是hb的bug可能是uniapp或者vue的），但是作为一个单纯文本编辑器的话，还是可以使用，。尤其md编辑功能其实很用心了。 做ide就算了，这玩意真的太坑。 不装插件的话体积也不大 几十M，装了插件话 哈哈 几个G 几十万个文件 。。。另外win+mac 没有linux版本，wine后有很多问题。\nwin右键菜单 最后附上\n添加右键菜单 1 2 3 4 5 6 7 Windows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\*\\shell\\Edit with Geany] \u0026#34;Icon\u0026#34;=\u0026#34;D:\\\\soft\\\\geany\\\\bin\\\\geany.exe\u0026#34; [HKEY_CLASSES_ROOT\\*\\shell\\Edit with Geany\\Command] @=\u0026#34;D:\\\\soft\\\\geany\\\\bin\\\\geany.exe \\\u0026#34;%1\\\u0026#34;\u0026#34; 删除右键菜单 1 2 3 Windows Registry Editor Version 5.00 [-HKEY_CLASSES_ROOT\\*\\shell\\Edit with Geany] 我的选择过程 选择自己喜欢的吧，我试用一圈后感觉EverEdit 几乎可以无痛平替notepad++，158元 一年可以激活8次总不至于一天重装8次电脑。但是他有一些文件关联的小问题，所以不想付费。\n2020年继续用notepad++ 旧版本 不更新 ，折腾了一个寂寞 2020年后开始 换到 geany 和 bowpad 中间也在使用cudatext 发现 bowpad在打开 挂载的网络文件的时候 会发生假死\ngeany 发现编辑网络文件的时候，要么出错，要么一直让重载\n又开始尝试 notepad next\n2023-4-13 我依旧没有找到 真的符合自己要求的 副文本编辑器， VSCodium 优点很明显 和 vscode完全一样的配置和使用习惯，确定也很明显 就是启动慢内存占用大 使用过过一段时间 的 notepadnext gedit 和 sublime 。 随后还是选了 VSCodium ,其实 code-insiders 也是可以的。 或者 vscode + vscode-insiders 或者 vscodium + vscodium-insiders 的组合。在插件不多，不打开大项目文件的情况下，速度虽然比sublime差了一些，但是也勉强可以接受。\nvscode + vscode-insiders 可以同步两边设置，支持github copilot vscodium + vscodium-insiders 完全开源没有同步功能，也没有copilot插件\n直接编辑文件 命令\n1 2 3 4 code ~/.config/awesome/rc.lua code-insiders ~/.config/awesome/rc.lua codium ~/.config/awesome/rc.lua codium-insiders ~/.config/awesome/rc.lua ","date":"2023-09-11T08:30:20+08:00","permalink":"https://dev.leiyanhui.com/c/notepad-other/","title":"notepad++替代品  20几个 逐个试用过程 和最后的选择"},{"content":"openwrt默认是使用dropbear，虽然轻量，但是使用起来会带来一些麻烦。 你可以通过修改dropbear端口再安装openssh 或者 在编译固件的时候直接编译进去。\n但是你会发root登陆，不上。如果 dropbear 还可以登陆 或者有显示器，那么修改/etc/ssh/sshd_config 后重启ssh即可。\n如果只有网页可以登陆。 那么打开 启动脚本：http://10.1.1.1/cgi-bin/luci/admin/system/startup\n在exit 0 前面 输入 几行\n1 2 3 /bin/cp -n /etc/ssh/sshd_config /etc/ssh/sshd_config-bak sed -i \u0026#39;s/#PermitRootLogin without-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config 有的版本是 without-password 有的版本是 prohibit-password，所以添加两行。 然后重启路由器即可 用root密码登陆。\n或者 干脆直接写入key 也是在 exit 0 前面\n1 2 3 4 5 mkdir -p /root/.ssh/ cat \u0026gt; /root/.ssh/authorized_keys \u0026lt;\u0026lt; \\EOF ...你的key内容... EOF chmod -R 600 ~/.ssh/authorized_keys ","date":"2023-09-11T07:15:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/openssh/","title":"openwrt更换openssh后无法ssh登陆root的解决方法"},{"content":"默认情况下，直接在openwrt配置端口转发，会自动启用 NAT 环回。 但是在部分固件下，尤其是存在docker 和ipsec等服务的时候 就会失效。\n在帮多个网友排查处理的时候 总结出来的小经验：不讲复杂的原理，只说实现方法\n常见解决方法 修改 wan=\u0026gt; lan的防火墙配置 （ 旧版有效） 在对应的端口转发的位置 关闭重新打开启用 NAT 环回 （看脸） 修改/etc/sysctl.conf （部分固件有效） /etc/dnsmasq.hosts 即 dnsmasq 在科学软件劫持dns后概率失效 且仅限基于域名的业务 内网机器hosts大法 （肯定有效，但是仅限域名业务） 别名主机大法 （有效，但是仅限域名业务） 前面几种方法 网上都有对应的教材不用细说，在不同的源码固件下不太通用，在更新内核后也有可能失效。这里只说 最后一种方法。\n最通用的解决方法 别名主机\nluci 根据版本不同，入口位置不同 一般在 http:///cgi-bin/luci/admin/network/dhcp 别名主机 的位置\nuci 和luci一样，但是可以直接shell运行，更简单直观。\n1 2 3 4 5 uci add dhcp domain uci set dhcp.@domain[-1].name=\u0026#39;域名地址\u0026#39; uci add_list dhcp.@domain[-1].ip=\u0026#39;10.1.1.50\u0026#39; uci commit dhcp /etc/init.d/dnsmasq restart 注意 如论是别名主机 还是 hosts 都不支持泛域名,要支持泛域名只有dnsmasq。\n最后 月经bug openwrt 这个问题，在不同的版本，包括官方版都反复出现。 用的还算稳定的情况下，尽量不折腾。浪费青春。\n建议 不是太特殊的情况下，建议用别名主机的来处理。如果有特殊需求，建议弃用docker ，opkg的软件还是蛮多的，部分没有的可以用可以在其他机器上用 docker导出后 在openwrt chroot使用。\n","date":"2023-09-11T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/dnat/","title":"openwrt内网设备无法通过外网域名/ip访问的解决"},{"content":"数据的组成部分 物联网设备的核心数据主要包括：\n设备管理list 用户管理list 渠道list 权限管理 其他 整体还是较为简单，耦合度不高。\n其他数据可以用其他数据存储方法来搞定。 是否要上sql 因为核心数据结构较为简单，并且数据量很少，nosql数据库维护也不会太麻烦，所不打算上sql\n是否需要上redis 因为数据要多个模块都要使用，而且集群部署，本地map持久化 来实现的话 逻辑略微复杂。\n另外集群的各个模块 以及集群内都需要消息通讯，自己再用socket+map来弄 也是徒增很多工作量。 后期维护代价也比较大。\n所以 用redis 集群 来替代 sql和mq 还是一个不错的选择。\n值得注意的 因为并发太高，虽然用了redis,但是一些需要频繁查询的地方，还是要本地map处理，不要频繁查询redis\n","date":"2023-09-09T13:14:20+08:00","permalink":"https://dev.leiyanhui.com/lot/coredb-select/","title":"物联网设备的 核心数据的维护和使用 有没有必要上sql、redis"},{"content":"需要2个文件 一个 shell(redis_docker_start.sh) 一个 redis.conf 模板 (redis_docker_tpl.conf)\n如果需要配置tls 需要用redis自带的工具创建一下自签名证书，或者购买证书。\nredis自带的证书创建 ： https://github.com/redis/redis/blob/unstable/utils/gen-test-certs.sh 可以自己修改一下，最后会创建11个文件。\n因为在公网异地集群，我这里只记录tls的集群\n创建一个节点 1 bash redis_docker_start.sh 6078 6079 连接到节点 1 2 3 4 redis-cli --tls \\ --cacert /home/xxx/tls/ca.crt \\ -a XXXXX \\ -h 10.1.1.75 -p 6079 只需要指定ca.crt即可\nredis_docker_start.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 #!/bin/bash if [ -z \u0026#34;${BASH_VERSION}\u0026#34; ]; then echo \u0026#34;请使用 bash 命令执行该脚本\u0026#34; exit 1 fi ################################ 创建证书文件 函数 ################################# function creatTLS_file { cat \u0026gt; $redisFile/tls/ca.crt \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/ca.key \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/ca.txt \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/client.crt \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/client.key \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/openssl.cnf \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/redis.crt \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/redis.dh \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/redis.key \u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/server.crt\u0026lt;\u0026lt; EOF XXXXX EOF cat \u0026gt; $redisFile/tls/server.key\u0026lt;\u0026lt; EOF XXXXX EOF } ################################## 主程序 ################################### if [ -z \u0026#34;$1\u0026#34; ]; then echo \u0026#34;tcp端口参数 \\$1 不存在 无法继续\u0026#34; exit 1 fi if [ -z \u0026#34;$2\u0026#34; ]; then echo \u0026#34;tls端口参数 \\$2 不存在 无法继续\u0026#34; exit 1 fi echo \u0026#34;tcp端口:$1 tls端口:$2\u0026#34; ################################## 相关文件 配置################################### redisFile=$HOME/redis_docker echo “创建目录和日志文件到：$redisFile” mkdir -p $redisFile/$1/data $redisFile/$1/cnf $redisFile/tls $redisFile/$1/log rm -rf $redisFile/$1/log/redis.log \u0026amp;\u0026amp; touch $redisFile/$1/log/redis.log \u0026amp;\u0026amp; chmod -R 777 $redisFile/$1/log chmod -R 777 $redisFile/$1/data ################################## 创建 acl 这个不是必须的################################### echo “创建acl文件 $redisFile/$1/users.acl” echo \u0026#34;user default on #XXXXXX ~* \u0026amp;* +@all\u0026#34;\u0026gt;$redisFile/$1/cnf/users.acl ################################## 复制配置文件 ################################### echo “创建配置文件 $redisFile/$1/cnf/redis.conf” rm -rf $redisFile/$1/cnf/redis.conf cp redis_docker_tpl.conf $redisFile/$1/cnf/redis.conf ################################## 复制配置文件 ################################### # tcp 端口 sed -i \u0026#34;s/{port}/$1/g\u0026#34; $redisFile/$1/cnf/redis.conf # tls 端口 sed -i \u0026#34;s/{tlsPort}/$2/g\u0026#34; $redisFile/$1/cnf/redis.conf # 密码 sed -i \u0026#34;s/{password}/XXXXX/g\u0026#34; $redisFile/$1/cnf/redis.conf ################################## 创建证书文件 ################################### echo “创建证书文件到目录 $redisFile/tls“ creatTLS_file # 创建证书文件 ################################## 启动docker ################################### echo \u0026#34;删除旧容器 redis_$1 ....\u0026#34; sudo docker stop redis_$1 \u0026amp;\u0026amp;sudo docker rm redis_$1 echo \u0026#34;创建新容器 redis_$1 ....\u0026#34; sudo docker run -itd --name redis_$1 --hostname redis_$1 \\ --restart=always --net=host \\ -v $redisFile/$1/cnf:/cnf \\ -v $redisFile/$1/data:/var/lib/redis \\ -v $redisFile/$1/log:/var/log/redis \\ -v $redisFile/tls:/etc/ssl/certs \\ -d redis:7.2.1-alpine3.18 redis-server /cnf/redis.conf sudo docker ps -a sudo docker logs -f redis_$1 # tls 测试 # -d redis:7.2.1-alpine3.18 redis-server /volume/cnf/redis.conf # docker run --name test redis:7.2.1-alpine3.18 redis_docker_tpl.conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683 684 685 686 687 688 689 690 691 692 693 694 695 696 697 698 699 700 701 702 703 704 705 706 707 708 709 710 711 712 713 714 715 716 717 718 719 720 721 722 723 724 725 726 727 728 729 730 731 732 733 734 735 736 737 738 739 740 741 742 743 744 745 746 747 748 749 750 751 752 753 754 755 756 757 758 759 760 761 762 763 764 765 766 767 768 769 770 771 772 773 774 775 776 777 778 779 780 781 782 783 784 785 786 787 788 789 790 791 792 793 794 795 796 797 798 799 800 801 802 803 804 805 806 807 808 809 810 811 812 813 814 815 816 817 818 819 820 821 822 823 824 825 826 827 828 829 830 831 832 833 834 835 836 837 838 839 840 841 842 843 844 845 846 847 848 849 850 851 852 853 854 855 856 857 858 859 860 861 862 863 864 865 866 867 868 869 870 871 872 873 874 875 876 877 878 879 880 881 882 883 884 885 886 887 888 889 890 891 892 893 894 895 896 897 898 899 900 901 902 903 904 905 906 907 908 909 910 911 912 913 914 915 916 917 918 919 920 921 922 923 924 925 926 927 928 929 930 931 932 933 934 935 936 937 938 939 940 941 942 943 944 945 946 947 948 949 950 951 952 953 954 955 956 957 958 959 960 961 962 963 964 965 966 967 968 969 970 971 972 973 974 975 976 977 978 979 980 981 982 983 984 985 986 987 988 989 990 991 992 993 994 995 996 997 998 999 1000 1001 1002 1003 1004 1005 1006 1007 1008 1009 1010 1011 1012 1013 1014 1015 1016 1017 1018 1019 1020 1021 1022 1023 1024 1025 1026 1027 1028 1029 1030 1031 1032 1033 1034 1035 1036 1037 1038 1039 1040 1041 1042 1043 1044 1045 1046 1047 1048 1049 1050 1051 1052 1053 1054 1055 1056 1057 1058 1059 1060 1061 1062 1063 1064 1065 1066 1067 1068 1069 1070 1071 1072 1073 1074 1075 1076 1077 1078 1079 1080 1081 1082 1083 1084 1085 1086 1087 1088 1089 1090 1091 1092 1093 1094 1095 1096 1097 1098 1099 1100 1101 1102 1103 1104 1105 1106 1107 1108 1109 1110 1111 1112 1113 1114 1115 1116 1117 1118 1119 1120 1121 1122 1123 1124 1125 1126 1127 1128 1129 1130 1131 1132 1133 1134 1135 1136 1137 1138 1139 1140 1141 1142 1143 1144 1145 1146 1147 1148 1149 1150 1151 1152 1153 1154 1155 1156 1157 1158 1159 1160 1161 1162 1163 1164 1165 1166 1167 1168 1169 1170 1171 1172 1173 1174 1175 1176 1177 1178 1179 1180 1181 1182 1183 1184 1185 1186 1187 1188 1189 1190 1191 1192 1193 1194 1195 1196 1197 1198 1199 1200 1201 1202 1203 1204 1205 1206 1207 1208 1209 1210 1211 1212 1213 1214 1215 1216 1217 1218 1219 1220 1221 1222 1223 1224 1225 1226 1227 1228 1229 1230 1231 1232 1233 1234 1235 1236 1237 1238 1239 1240 1241 1242 1243 1244 1245 1246 1247 1248 1249 1250 1251 1252 1253 1254 1255 1256 1257 1258 1259 1260 1261 1262 1263 1264 1265 1266 1267 1268 1269 1270 1271 1272 1273 1274 1275 1276 1277 1278 1279 1280 1281 1282 1283 1284 1285 1286 1287 1288 1289 1290 1291 1292 1293 1294 1295 1296 1297 1298 1299 1300 1301 1302 1303 1304 1305 1306 1307 1308 1309 1310 1311 1312 1313 1314 1315 1316 1317 1318 1319 1320 1321 1322 1323 1324 1325 1326 1327 1328 1329 1330 1331 1332 1333 1334 1335 1336 1337 1338 1339 1340 1341 1342 1343 1344 1345 1346 1347 1348 1349 1350 1351 1352 1353 1354 1355 1356 1357 1358 1359 1360 1361 1362 1363 1364 1365 1366 1367 1368 1369 1370 1371 1372 1373 1374 1375 1376 1377 1378 1379 1380 1381 1382 1383 1384 1385 1386 1387 1388 1389 1390 1391 1392 1393 1394 1395 1396 1397 1398 1399 1400 1401 1402 1403 1404 1405 1406 1407 1408 1409 1410 1411 1412 1413 1414 1415 1416 1417 1418 1419 1420 1421 1422 1423 1424 1425 1426 1427 1428 1429 1430 1431 1432 1433 1434 1435 1436 1437 1438 1439 1440 1441 1442 1443 1444 1445 1446 1447 1448 1449 1450 1451 1452 1453 1454 1455 1456 1457 1458 1459 1460 1461 1462 1463 1464 1465 1466 1467 1468 1469 1470 1471 1472 1473 1474 1475 1476 1477 1478 1479 1480 1481 1482 1483 1484 1485 1486 1487 1488 1489 1490 1491 1492 1493 1494 1495 1496 1497 1498 1499 1500 1501 1502 1503 1504 1505 1506 1507 1508 1509 1510 1511 1512 1513 1514 1515 1516 1517 1518 1519 1520 1521 1522 1523 1524 1525 1526 1527 1528 1529 1530 1531 1532 1533 1534 1535 1536 1537 1538 1539 1540 1541 1542 1543 1544 1545 1546 1547 1548 1549 1550 1551 1552 1553 1554 1555 1556 1557 1558 1559 1560 1561 1562 1563 1564 1565 1566 1567 1568 1569 1570 1571 1572 1573 1574 1575 1576 1577 1578 1579 1580 1581 1582 1583 1584 1585 1586 1587 1588 1589 1590 1591 1592 1593 1594 1595 1596 1597 1598 1599 1600 1601 1602 1603 1604 1605 1606 1607 1608 1609 1610 1611 1612 1613 1614 1615 1616 1617 1618 1619 1620 1621 1622 1623 1624 1625 1626 1627 1628 1629 1630 1631 1632 1633 1634 1635 1636 1637 1638 1639 1640 1641 1642 1643 1644 1645 1646 1647 1648 1649 1650 1651 1652 1653 1654 1655 1656 1657 1658 1659 1660 1661 1662 1663 1664 1665 1666 1667 1668 1669 1670 1671 1672 1673 1674 1675 1676 1677 1678 1679 1680 1681 1682 1683 1684 1685 1686 1687 1688 1689 1690 1691 1692 1693 1694 1695 1696 1697 1698 1699 1700 1701 1702 1703 1704 1705 1706 1707 1708 1709 1710 1711 1712 1713 1714 1715 1716 1717 1718 1719 1720 1721 1722 1723 1724 1725 1726 1727 1728 1729 1730 1731 1732 1733 1734 1735 1736 1737 1738 1739 1740 1741 1742 1743 1744 1745 1746 1747 1748 1749 1750 1751 1752 1753 1754 1755 1756 1757 1758 1759 1760 1761 1762 1763 1764 1765 1766 1767 1768 1769 1770 1771 1772 1773 1774 1775 1776 1777 1778 1779 1780 1781 1782 1783 1784 1785 1786 1787 1788 1789 1790 1791 1792 1793 1794 1795 1796 1797 1798 1799 1800 1801 1802 1803 1804 1805 1806 1807 1808 1809 1810 1811 1812 1813 1814 1815 1816 1817 1818 1819 1820 1821 1822 1823 1824 1825 1826 1827 1828 1829 1830 1831 1832 1833 1834 1835 1836 1837 1838 1839 1840 1841 1842 1843 1844 1845 1846 1847 1848 1849 1850 1851 1852 1853 1854 1855 1856 1857 1858 1859 1860 1861 1862 1863 1864 1865 1866 1867 1868 1869 1870 1871 1872 1873 1874 1875 1876 1877 1878 1879 1880 1881 1882 1883 1884 1885 1886 1887 1888 1889 1890 1891 1892 1893 1894 1895 1896 1897 1898 1899 1900 1901 1902 1903 1904 1905 1906 1907 1908 1909 1910 1911 1912 1913 1914 1915 1916 1917 1918 1919 1920 1921 1922 1923 1924 1925 1926 1927 1928 1929 1930 1931 1932 1933 1934 1935 1936 1937 1938 1939 1940 1941 1942 1943 1944 1945 1946 1947 1948 1949 1950 1951 1952 1953 1954 1955 1956 1957 1958 1959 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 2023 2024 2025 2026 2027 2028 2029 2030 2031 2032 2033 2034 2035 2036 2037 2038 2039 2040 2041 2042 2043 2044 2045 2046 2047 2048 2049 2050 2051 2052 2053 2054 2055 2056 2057 2058 2059 2060 2061 2062 2063 2064 2065 2066 2067 2068 2069 2070 2071 2072 2073 2074 2075 2076 2077 2078 2079 2080 2081 2082 2083 2084 2085 2086 2087 2088 2089 2090 2091 2092 2093 2094 2095 2096 2097 2098 2099 2100 2101 2102 2103 2104 2105 2106 2107 2108 2109 2110 2111 2112 2113 2114 2115 2116 2117 2118 2119 2120 2121 2122 2123 2124 2125 2126 2127 2128 2129 2130 2131 2132 2133 2134 2135 2136 2137 2138 2139 2140 2141 2142 2143 2144 2145 2146 2147 2148 2149 2150 2151 2152 2153 2154 2155 2156 2157 2158 2159 2160 2161 2162 2163 2164 2165 2166 2167 2168 2169 2170 2171 2172 2173 2174 2175 2176 2177 2178 2179 2180 2181 2182 2183 2184 2185 2186 2187 2188 2189 2190 2191 2192 2193 2194 2195 2196 2197 2198 2199 2200 2201 2202 2203 2204 2205 2206 2207 2208 2209 2210 2211 2212 2213 2214 2215 2216 2217 2218 2219 2220 2221 2222 2223 2224 2225 2226 2227 2228 2229 2230 2231 2232 2233 2234 2235 2236 2237 2238 2239 2240 2241 2242 2243 2244 2245 2246 2247 2248 2249 2250 2251 2252 2253 2254 2255 2256 2257 2258 2259 2260 2261 2262 2263 2264 2265 2266 2267 2268 2269 2270 2271 2272 2273 2274 2275 2276 2277 2278 2279 2280 2281 2282 2283 2284 2285 2286 2287 2288 2289 2290 2291 2292 2293 2294 2295 2296 2297 2298 2299 2300 2301 2302 2303 2304 2305 2306 2307 2308 2309 2310 2311 2312 2313 2314 2315 2316 2317 2318 2319 2320 2321 2322 2323 2324 2325 2326 2327 2328 2329 2330 2331 2332 2333 2334 ################################# 不允许后台运行 docker 必须打开 ##################################### daemonize no ################################# 基础网络相关 ##################################### bind * -::* port {port} ################################# tls相关 ##################################### # 如果不启用注释掉下面即可 tls-port {tlsPort} tls-cert-file /etc/ssl/certs/redis.crt tls-key-file /etc/ssl/certs/redis.key tls-client-cert-file /etc/ssl/certs/client.crt tls-client-key-file /etc/ssl/certs/client.key tls-client-key-file-pass /etc/ssl/certs/secret tls-dh-params-file /etc/ssl/certs/redis.dh tls-ca-cert-file /etc/ssl/certs/ca.crt tls-ca-cert-dir /etc/ssl/certs tls-auth-clients no tls-auth-clients optional tls-replication yes tls-cluster yes tls-protocols \u0026#34;TLSv1.2 TLSv1.3\u0026#34; tls-ciphers DEFAULT:!MEDIUM tls-ciphersuites TLS_CHACHA20_POLY1305_SHA256 tls-prefer-server-ciphers yes tls-session-caching no tls-session-cache-size 5000 tls-session-cache-timeout 60 ################################## 安全认证相关 ################################### # 允许外网访问 no是允许 protected-mode no requirepass \u0026#34;{password}\u0026#34; # 同步密码 和管理员密码配置一样的，不然同步容易出问题 masterauth \u0026#34;{password}\u0026#34; ################################## 多线程 ################################### io-threads-do-reads yes io-threads 2 ################################## 持久化 ################################### # 开启aof 其他不用配置用默认即可 appendonly yes ################################## 集 群 ################################### # 开启集群 如果不用 注释掉即可 cluster-enabled yes # 节点配置 默认会在 data 目录 cluster-config-file \u0026#34;nodes.conf\u0026#34; #集群超时 cluster-node-timeout 5000 ################################## 可能需要的 ################################### # 限制内存 acl控制等 ################################## 后面是默认配置 ################################### # Redis configuration file example. # # Note that in order to read the configuration file, Redis must be # started with the file path as first argument: # # ./redis-server /path/to/redis.conf # Note on units: when memory size is needed, it is possible to specify # it in the usual form of 1k 5GB 4M and so forth: # # 1k =\u0026gt; 1000 bytes # 1kb =\u0026gt; 1024 bytes # 1m =\u0026gt; 1000000 bytes # 1mb =\u0026gt; 1024*1024 bytes # 1g =\u0026gt; 1000000000 bytes # 1gb =\u0026gt; 1024*1024*1024 bytes # # units are case insensitive so 1GB 1Gb 1gB are all the same. ################################## INCLUDES ################################### # Include one or more other config files here. This is useful if you # have a standard template that goes to all Redis servers but also need # to customize a few per-server settings. Include files can include # other files, so use this wisely. # # Note that option \u0026#34;include\u0026#34; won\u0026#39;t be rewritten by command \u0026#34;CONFIG REWRITE\u0026#34; # from admin or Redis Sentinel. Since Redis always uses the last processed # line as value of a configuration directive, you\u0026#39;d better put includes # at the beginning of this file to avoid overwriting config change at runtime. # # If instead you are interested in using includes to override configuration # options, it is better to use include as the last line. # # Included paths may contain wildcards. All files matching the wildcards will # be included in alphabetical order. # Note that if an include path contains a wildcards but no files match it when # the server is started, the include statement will be ignored and no error will # be emitted. It is safe, therefore, to include wildcard files from empty # directories. # # include /path/to/local.conf # include /path/to/other.conf # include /path/to/fragments/*.conf # ################################## MODULES ##################################### # Load modules at startup. If the server is not able to load modules # it will abort. It is possible to use multiple loadmodule directives. # # loadmodule /path/to/my_module.so # loadmodule /path/to/other_module.so ################################## NETWORK ##################################### # By default, if no \u0026#34;bind\u0026#34; configuration directive is specified, Redis listens # for connections from all available network interfaces on the host machine. # It is possible to listen to just one or multiple selected interfaces using # the \u0026#34;bind\u0026#34; configuration directive, followed by one or more IP addresses. # Each address can be prefixed by \u0026#34;-\u0026#34;, which means that redis will not fail to # start if the address is not available. Being not available only refers to # addresses that does not correspond to any network interface. Addresses that # are already in use will always fail, and unsupported protocols will always BE # silently skipped. # # Examples: # # bind 192.168.1.100 10.0.0.1 # listens on two specific IPv4 addresses # bind 127.0.0.1 ::1 # listens on loopback IPv4 and IPv6 # bind * -::* # like the default, all available interfaces # # ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the # internet, binding to all the interfaces is dangerous and will expose the # instance to everybody on the internet. So by default we uncomment the # following bind directive, that will force Redis to listen only on the # IPv4 and IPv6 (if available) loopback interface addresses (this means Redis # will only be able to accept client connections from the same host that it is # running on). # # IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES # COMMENT OUT THE FOLLOWING LINE. # # You will also need to set a password unless you explicitly disable protected # mode. # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #-bind 127.0.0.1 -::1 # By default, outgoing connections (from replica to master, from Sentinel to # instances, cluster bus, etc.) are not bound to a specific local address. In # most cases, this means the operating system will handle that based on routing # and the interface through which the connection goes out. # # Using bind-source-addr it is possible to configure a specific address to bind # to, which may also affect how the connection gets routed. # # Example: # # bind-source-addr 10.0.0.1 # Protected mode is a layer of security protection, in order to avoid that # Redis instances left open on the internet are accessed and exploited. # # When protected mode is on and the default user has no password, the server # only accepts local connections from the IPv4 address (127.0.0.1), IPv6 address # (::1) or Unix domain sockets. # # By default protected mode is enabled. You should disable it only if # you are sure you want clients from other hosts to connect to Redis # even if no authentication is configured. #-protected-mode yes # Redis uses default hardened security configuration directives to reduce the # attack surface on innocent users. Therefore, several sensitive configuration # directives are immutable, and some potentially-dangerous commands are blocked. # # Configuration directives that control files that Redis writes to (e.g., \u0026#39;dir\u0026#39; # and \u0026#39;dbfilename\u0026#39;) and that aren\u0026#39;t usually modified during runtime # are protected by making them immutable. # # Commands that can increase the attack surface of Redis and that aren\u0026#39;t usually # called by users are blocked by default. # # These can be exposed to either all connections or just local ones by setting # each of the configs listed below to either of these values: # # no - Block for any connection (remain immutable) # yes - Allow for any connection (no protection) # local - Allow only for local connections. Ones originating from the # IPv4 address (127.0.0.1), IPv6 address (::1) or Unix domain sockets. # # enable-protected-configs no # enable-debug-command no # enable-module-command no # Accept connections on the specified port, default is 6379 (IANA #815344). # If port 0 is specified Redis will not listen on a TCP socket. #-port 6379 # TCP listen() backlog. # # In high requests-per-second environments you need a high backlog in order # to avoid slow clients connection issues. Note that the Linux kernel # will silently truncate it to the value of /proc/sys/net/core/somaxconn so # make sure to raise both the value of somaxconn and tcp_max_syn_backlog # in order to get the desired effect. tcp-backlog 511 # Unix socket. # # Specify the path for the Unix socket that will be used to listen for # incoming connections. There is no default, so Redis will not listen # on a unix socket when not specified. # # unixsocket /run/redis/redis-server.sock # unixsocketperm 700 # Close the connection after a client is idle for N seconds (0 to disable) timeout 0 # TCP keepalive. # # If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence # of communication. This is useful for two reasons: # # 1) Detect dead peers. # 2) Force network equipment in the middle to consider the connection to be # alive. # # On Linux, the specified value (in seconds) is the period used to send ACKs. # Note that to close the connection the double of the time is needed. # On other kernels the period depends on the kernel configuration. # # A reasonable value for this option is 300 seconds, which is the new # Redis default starting with Redis 3.2.1. tcp-keepalive 300 # Apply OS-specific mechanism to mark the listening socket with the specified # ID, to support advanced routing and filtering capabilities. # # On Linux, the ID represents a connection mark. # On FreeBSD, the ID represents a socket cookie ID. # On OpenBSD, the ID represents a route table ID. # # The default value is 0, which implies no marking is required. # socket-mark-id 0 ################################# TLS/SSL ##################################### # By default, TLS/SSL is disabled. To enable it, the \u0026#34;tls-port\u0026#34; configuration # directive can be used to define TLS-listening ports. To enable TLS on the # default port, use: # # port 0 # tls-port 6379 # Configure a X.509 certificate and private key to use for authenticating the # server to connected clients, masters or cluster peers. These files should be # PEM formatted. # # tls-cert-file redis.crt # tls-key-file redis.key # # If the key file is encrypted using a passphrase, it can be included here # as well. # # tls-key-file-pass secret # Normally Redis uses the same certificate for both server functions (accepting # connections) and client functions (replicating from a master, establishing # cluster bus connections, etc.). # # Sometimes certificates are issued with attributes that designate them as # client-only or server-only certificates. In that case it may be desired to use # different certificates for incoming (server) and outgoing (client) # connections. To do that, use the following directives: # # tls-client-cert-file client.crt # tls-client-key-file client.key # # If the key file is encrypted using a passphrase, it can be included here # as well. # # tls-client-key-file-pass secret # Configure a DH parameters file to enable Diffie-Hellman (DH) key exchange, # required by older versions of OpenSSL (\u0026lt;3.0). Newer versions do not require # this configuration and recommend against it. # # tls-dh-params-file redis.dh # Configure a CA certificate(s) bundle or directory to authenticate TLS/SSL # clients and peers. Redis requires an explicit configuration of at least one # of these, and will not implicitly use the system wide configuration. # # tls-ca-cert-file ca.crt # tls-ca-cert-dir /etc/ssl/certs # By default, clients (including replica servers) on a TLS port are required # to authenticate using valid client side certificates. # # If \u0026#34;no\u0026#34; is specified, client certificates are not required and not accepted. # If \u0026#34;optional\u0026#34; is specified, client certificates are accepted and must be # valid if provided, but are not required. # # tls-auth-clients no # tls-auth-clients optional # By default, a Redis replica does not attempt to establish a TLS connection # with its master. # # Use the following directive to enable TLS on replication links. # # tls-replication yes # By default, the Redis Cluster bus uses a plain TCP connection. To enable # TLS for the bus protocol, use the following directive: # # tls-cluster yes # By default, only TLSv1.2 and TLSv1.3 are enabled and it is highly recommended # that older formally deprecated versions are kept disabled to reduce the attack surface. # You can explicitly specify TLS versions to support. # Allowed values are case insensitive and include \u0026#34;TLSv1\u0026#34;, \u0026#34;TLSv1.1\u0026#34;, \u0026#34;TLSv1.2\u0026#34;, # \u0026#34;TLSv1.3\u0026#34; (OpenSSL \u0026gt;= 1.1.1) or any combination. # To enable only TLSv1.2 and TLSv1.3, use: # # tls-protocols \u0026#34;TLSv1.2 TLSv1.3\u0026#34; # Configure allowed ciphers. See the ciphers(1ssl) manpage for more information # about the syntax of this string. # # Note: this configuration applies only to \u0026lt;= TLSv1.2. # # tls-ciphers DEFAULT:!MEDIUM # Configure allowed TLSv1.3 ciphersuites. See the ciphers(1ssl) manpage for more # information about the syntax of this string, and specifically for TLSv1.3 # ciphersuites. # # tls-ciphersuites TLS_CHACHA20_POLY1305_SHA256 # When choosing a cipher, use the server\u0026#39;s preference instead of the client # preference. By default, the server follows the client\u0026#39;s preference. # # tls-prefer-server-ciphers yes # By default, TLS session caching is enabled to allow faster and less expensive # reconnections by clients that support it. Use the following directive to disable # caching. # # tls-session-caching no # Change the default number of TLS sessions cached. A zero value sets the cache # to unlimited size. The default size is 20480. # # tls-session-cache-size 5000 # Change the default timeout of cached TLS sessions. The default timeout is 300 # seconds. # # tls-session-cache-timeout 60 ################################# GENERAL ##################################### # By default Redis does not run as a daemon. Use \u0026#39;yes\u0026#39; if you need it. # Note that Redis will write a pid file in /var/run/redis.pid when daemonized. # When Redis is supervised by upstart or systemd, this parameter has no impact. #-daemonize yes # If you run Redis from upstart or systemd, Redis can interact with your # supervision tree. Options: # supervised no - no supervision interaction # supervised upstart - signal upstart by putting Redis into SIGSTOP mode # requires \u0026#34;expect stop\u0026#34; in your upstart job config # supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET # on startup, and updating Redis status on a regular # basis. # supervised auto - detect upstart or systemd method based on # UPSTART_JOB or NOTIFY_SOCKET environment variables # Note: these supervision methods only signal \u0026#34;process is ready.\u0026#34; # They do not enable continuous pings back to your supervisor. # # The default is \u0026#34;no\u0026#34;. To run under upstart/systemd, you can simply uncomment # the line below: # # supervised auto # If a pid file is specified, Redis writes it where specified at startup # and removes it at exit. # # When the server runs non daemonized, no pid file is created if none is # specified in the configuration. When the server is daemonized, the pid file # is used even if not specified, defaulting to \u0026#34;/var/run/redis.pid\u0026#34;. # # Creating a pid file is best effort: if Redis is not able to create it # nothing bad happens, the server will start and run normally. # # Note that on modern Linux systems \u0026#34;/run/redis.pid\u0026#34; is more conforming # and should be used instead. pidfile /run/redis/redis-server.pid # Specify the server verbosity level. # This can be one of: # debug (a lot of information, useful for development/testing) # verbose (many rarely useful info, but not a mess like the debug level) # notice (moderately verbose, what you want in production probably) # warning (only very important / critical messages are logged) loglevel notice # Specify the log file name. Also the empty string can be used to force # Redis to log on the standard output. Note that if you use standard # output for logging but daemonize, logs will be sent to /dev/null logfile /var/log/redis/redis-server.log # To enable logging to the system logger, just set \u0026#39;syslog-enabled\u0026#39; to yes, # and optionally update the other syslog parameters to suit your needs. # syslog-enabled no # Specify the syslog identity. # syslog-ident redis # Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7. # syslog-facility local0 # To disable the built in crash log, which will possibly produce cleaner core # dumps when they are needed, uncomment the following: # # crash-log-enabled no # To disable the fast memory check that\u0026#39;s run as part of the crash log, which # will possibly let redis terminate sooner, uncomment the following: # # crash-memcheck-enabled no # Set the number of databases. The default database is DB 0, you can select # a different one on a per-connection basis using SELECT \u0026lt;dbid\u0026gt; where # dbid is a number between 0 and \u0026#39;databases\u0026#39;-1 databases 16 # By default Redis shows an ASCII art logo only when started to log to the # standard output and if the standard output is a TTY and syslog logging is # disabled. Basically this means that normally a logo is displayed only in # interactive sessions. # # However it is possible to force the pre-4.0 behavior and always show a # ASCII art logo in startup logs by setting the following option to yes. always-show-logo no # By default, Redis modifies the process title (as seen in \u0026#39;top\u0026#39; and \u0026#39;ps\u0026#39;) to # provide some runtime information. It is possible to disable this and leave # the process name as executed by setting the following to no. set-proc-title yes # When changing the process title, Redis uses the following template to construct # the modified title. # # Template variables are specified in curly brackets. The following variables are # supported: # # {title} Name of process as executed if parent, or type of child process. # {listen-addr} Bind address or \u0026#39;*\u0026#39; followed by TCP or TLS port listening on, or # Unix socket if only that\u0026#39;s available. # {server-mode} Special mode, i.e. \u0026#34;[sentinel]\u0026#34; or \u0026#34;[cluster]\u0026#34;. # {port} TCP port listening on, or 0. # {tls-port} TLS port listening on, or 0. # {unixsocket} Unix domain socket listening on, or \u0026#34;\u0026#34;. # {config-file} Name of configuration file used. # proc-title-template \u0026#34;{title} {listen-addr} {server-mode}\u0026#34; ################################ SNAPSHOTTING ################################ # Save the DB to disk. # # save \u0026lt;seconds\u0026gt; \u0026lt;changes\u0026gt; [\u0026lt;seconds\u0026gt; \u0026lt;changes\u0026gt; ...] # # Redis will save the DB if the given number of seconds elapsed and it # surpassed the given number of write operations against the DB. # # Snapshotting can be completely disabled with a single empty string argument # as in following example: # # save \u0026#34;\u0026#34; # # Unless specified otherwise, by default Redis will save the DB: # * After 3600 seconds (an hour) if at least 1 change was performed # * After 300 seconds (5 minutes) if at least 100 changes were performed # * After 60 seconds if at least 10000 changes were performed # # You can set these explicitly by uncommenting the following line. # # save 3600 1 300 100 60 10000 # By default Redis will stop accepting writes if RDB snapshots are enabled # (at least one save point) and the latest background save failed. # This will make the user aware (in a hard way) that data is not persisting # on disk properly, otherwise chances are that no one will notice and some # disaster will happen. # # If the background saving process will start working again Redis will # automatically allow writes again. # # However if you have setup your proper monitoring of the Redis server # and persistence, you may want to disable this feature so that Redis will # continue to work as usual even if there are problems with disk, # permissions, and so forth. stop-writes-on-bgsave-error yes # Compress string objects using LZF when dump .rdb databases? # By default compression is enabled as it\u0026#39;s almost always a win. # If you want to save some CPU in the saving child set it to \u0026#39;no\u0026#39; but # the dataset will likely be bigger if you have compressible values or keys. rdbcompression yes # Since version 5 of RDB a CRC64 checksum is placed at the end of the file. # This makes the format more resistant to corruption but there is a performance # hit to pay (around 10%) when saving and loading RDB files, so you can disable it # for maximum performances. # # RDB files created with checksum disabled have a checksum of zero that will # tell the loading code to skip the check. rdbchecksum yes # Enables or disables full sanitization checks for ziplist and listpack etc when # loading an RDB or RESTORE payload. This reduces the chances of a assertion or # crash later on while processing commands. # Options: # no - Never perform full sanitization # yes - Always perform full sanitization # clients - Perform full sanitization only for user connections. # Excludes: RDB files, RESTORE commands received from the master # connection, and client connections which have the # skip-sanitize-payload ACL flag. # The default should be \u0026#39;clients\u0026#39; but since it currently affects cluster # resharding via MIGRATE, it is temporarily set to \u0026#39;no\u0026#39; by default. # # sanitize-dump-payload no # The filename where to dump the DB dbfilename dump.rdb # Remove RDB files used by replication in instances without persistence # enabled. By default this option is disabled, however there are environments # where for regulations or other security concerns, RDB files persisted on # disk by masters in order to feed replicas, or stored on disk by replicas # in order to load them for the initial synchronization, should be deleted # ASAP. Note that this option ONLY WORKS in instances that have both AOF # and RDB persistence disabled, otherwise is completely ignored. # # An alternative (and sometimes better) way to obtain the same effect is # to use diskless replication on both master and replicas instances. However # in the case of replicas, diskless is not always an option. rdb-del-sync-files no # The working directory. # # The DB will be written inside this directory, with the filename specified # above using the \u0026#39;dbfilename\u0026#39; configuration directive. # # The Append Only File will also be created inside this directory. # # Note that you must specify a directory here, not a file name. dir /var/lib/redis ################################# REPLICATION ################################# # Master-Replica replication. Use replicaof to make a Redis instance a copy of # another Redis server. A few things to understand ASAP about Redis replication. # # +------------------+ +---------------+ # | Master | ---\u0026gt; | Replica | # | (receive writes) | | (exact copy) | # +------------------+ +---------------+ # # 1) Redis replication is asynchronous, but you can configure a master to # stop accepting writes if it appears to be not connected with at least # a given number of replicas. # 2) Redis replicas are able to perform a partial resynchronization with the # master if the replication link is lost for a relatively small amount of # time. You may want to configure the replication backlog size (see the next # sections of this file) with a sensible value depending on your needs. # 3) Replication is automatic and does not need user intervention. After a # network partition replicas automatically try to reconnect to masters # and resynchronize with them. # # replicaof \u0026lt;masterip\u0026gt; \u0026lt;masterport\u0026gt; # If the master is password protected (using the \u0026#34;requirepass\u0026#34; configuration # directive below) it is possible to tell the replica to authenticate before # starting the replication synchronization process, otherwise the master will # refuse the replica request. # # masterauth \u0026lt;master-password\u0026gt; # # However this is not enough if you are using Redis ACLs (for Redis version # 6 or greater), and the default user is not capable of running the PSYNC # command and/or other commands needed for replication. In this case it\u0026#39;s # better to configure a special user to use with replication, and specify the # masteruser configuration as such: # # masteruser \u0026lt;username\u0026gt; # # When masteruser is specified, the replica will authenticate against its # master using the new AUTH form: AUTH \u0026lt;username\u0026gt; \u0026lt;password\u0026gt;. # When a replica loses its connection with the master, or when the replication # is still in progress, the replica can act in two different ways: # # 1) if replica-serve-stale-data is set to \u0026#39;yes\u0026#39; (the default) the replica will # still reply to client requests, possibly with out of date data, or the # data set may just be empty if this is the first synchronization. # # 2) If replica-serve-stale-data is set to \u0026#39;no\u0026#39; the replica will reply with error # \u0026#34;MASTERDOWN Link with MASTER is down and replica-serve-stale-data is set to \u0026#39;no\u0026#39;\u0026#34; # to all data access commands, excluding commands such as: # INFO, REPLICAOF, AUTH, SHUTDOWN, REPLCONF, ROLE, CONFIG, SUBSCRIBE, # UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB, COMMAND, POST, # HOST and LATENCY. # replica-serve-stale-data yes # You can configure a replica instance to accept writes or not. Writing against # a replica instance may be useful to store some ephemeral data (because data # written on a replica will be easily deleted after resync with the master) but # may also cause problems if clients are writing to it because of a # misconfiguration. # # Since Redis 2.6 by default replicas are read-only. # # Note: read only replicas are not designed to be exposed to untrusted clients # on the internet. It\u0026#39;s just a protection layer against misuse of the instance. # Still a read only replica exports by default all the administrative commands # such as CONFIG, DEBUG, and so forth. To a limited extent you can improve # security of read only replicas using \u0026#39;rename-command\u0026#39; to shadow all the # administrative / dangerous commands. replica-read-only yes # Replication SYNC strategy: disk or socket. # # New replicas and reconnecting replicas that are not able to continue the # replication process just receiving differences, need to do what is called a # \u0026#34;full synchronization\u0026#34;. An RDB file is transmitted from the master to the # replicas. # # The transmission can happen in two different ways: # # 1) Disk-backed: The Redis master creates a new process that writes the RDB # file on disk. Later the file is transferred by the parent # process to the replicas incrementally. # 2) Diskless: The Redis master creates a new process that directly writes the # RDB file to replica sockets, without touching the disk at all. # # With disk-backed replication, while the RDB file is generated, more replicas # can be queued and served with the RDB file as soon as the current child # producing the RDB file finishes its work. With diskless replication instead # once the transfer starts, new replicas arriving will be queued and a new # transfer will start when the current one terminates. # # When diskless replication is used, the master waits a configurable amount of # time (in seconds) before starting the transfer in the hope that multiple # replicas will arrive and the transfer can be parallelized. # # With slow disks and fast (large bandwidth) networks, diskless replication # works better. repl-diskless-sync yes # When diskless replication is enabled, it is possible to configure the delay # the server waits in order to spawn the child that transfers the RDB via socket # to the replicas. # # This is important since once the transfer starts, it is not possible to serve # new replicas arriving, that will be queued for the next RDB transfer, so the # server waits a delay in order to let more replicas arrive. # # The delay is specified in seconds, and by default is 5 seconds. To disable # it entirely just set it to 0 seconds and the transfer will start ASAP. repl-diskless-sync-delay 5 # When diskless replication is enabled with a delay, it is possible to let # the replication start before the maximum delay is reached if the maximum # number of replicas expected have connected. Default of 0 means that the # maximum is not defined and Redis will wait the full delay. repl-diskless-sync-max-replicas 0 # ----------------------------------------------------------------------------- # WARNING: RDB diskless load is experimental. Since in this setup the replica # does not immediately store an RDB on disk, it may cause data loss during # failovers. RDB diskless load + Redis modules not handling I/O reads may also # cause Redis to abort in case of I/O errors during the initial synchronization # stage with the master. Use only if you know what you are doing. # ----------------------------------------------------------------------------- # # Replica can load the RDB it reads from the replication link directly from the # socket, or store the RDB to a file and read that file after it was completely # received from the master. # # In many cases the disk is slower than the network, and storing and loading # the RDB file may increase replication time (and even increase the master\u0026#39;s # Copy on Write memory and replica buffers). # However, parsing the RDB file directly from the socket may mean that we have # to flush the contents of the current database before the full rdb was # received. For this reason we have the following options: # # \u0026#34;disabled\u0026#34; - Don\u0026#39;t use diskless load (store the rdb file to the disk first) # \u0026#34;on-empty-db\u0026#34; - Use diskless load only when it is completely safe. # \u0026#34;swapdb\u0026#34; - Keep current db contents in RAM while parsing the data directly # from the socket. Replicas in this mode can keep serving current # data set while replication is in progress, except for cases where # they can\u0026#39;t recognize master as having a data set from same # replication history. # Note that this requires sufficient memory, if you don\u0026#39;t have it, # you risk an OOM kill. repl-diskless-load disabled # Master send PINGs to its replicas in a predefined interval. It\u0026#39;s possible to # change this interval with the repl_ping_replica_period option. The default # value is 10 seconds. # # repl-ping-replica-period 10 # The following option sets the replication timeout for: # # 1) Bulk transfer I/O during SYNC, from the point of view of replica. # 2) Master timeout from the point of view of replicas (data, pings). # 3) Replica timeout from the point of view of masters (REPLCONF ACK pings). # # It is important to make sure that this value is greater than the value # specified for repl-ping-replica-period otherwise a timeout will be detected # every time there is low traffic between the master and the replica. The default # value is 60 seconds. # # repl-timeout 60 # Disable TCP_NODELAY on the replica socket after SYNC? # # If you select \u0026#34;yes\u0026#34; Redis will use a smaller number of TCP packets and # less bandwidth to send data to replicas. But this can add a delay for # the data to appear on the replica side, up to 40 milliseconds with # Linux kernels using a default configuration. # # If you select \u0026#34;no\u0026#34; the delay for data to appear on the replica side will # be reduced but more bandwidth will be used for replication. # # By default we optimize for low latency, but in very high traffic conditions # or when the master and replicas are many hops away, turning this to \u0026#34;yes\u0026#34; may # be a good idea. repl-disable-tcp-nodelay no # Set the replication backlog size. The backlog is a buffer that accumulates # replica data when replicas are disconnected for some time, so that when a # replica wants to reconnect again, often a full resync is not needed, but a # partial resync is enough, just passing the portion of data the replica # missed while disconnected. # # The bigger the replication backlog, the longer the replica can endure the # disconnect and later be able to perform a partial resynchronization. # # The backlog is only allocated if there is at least one replica connected. # # repl-backlog-size 1mb # After a master has no connected replicas for some time, the backlog will be # freed. The following option configures the amount of seconds that need to # elapse, starting from the time the last replica disconnected, for the backlog # buffer to be freed. # # Note that replicas never free the backlog for timeout, since they may be # promoted to masters later, and should be able to correctly \u0026#34;partially # resynchronize\u0026#34; with other replicas: hence they should always accumulate backlog. # # A value of 0 means to never release the backlog. # # repl-backlog-ttl 3600 # The replica priority is an integer number published by Redis in the INFO # output. It is used by Redis Sentinel in order to select a replica to promote # into a master if the master is no longer working correctly. # # A replica with a low priority number is considered better for promotion, so # for instance if there are three replicas with priority 10, 100, 25 Sentinel # will pick the one with priority 10, that is the lowest. # # However a special priority of 0 marks the replica as not able to perform the # role of master, so a replica with priority of 0 will never be selected by # Redis Sentinel for promotion. # # By default the priority is 100. replica-priority 100 # The propagation error behavior controls how Redis will behave when it is # unable to handle a command being processed in the replication stream from a master # or processed while reading from an AOF file. Errors that occur during propagation # are unexpected, and can cause data inconsistency. However, there are edge cases # in earlier versions of Redis where it was possible for the server to replicate or persist # commands that would fail on future versions. For this reason the default behavior # is to ignore such errors and continue processing commands. # # If an application wants to ensure there is no data divergence, this configuration # should be set to \u0026#39;panic\u0026#39; instead. The value can also be set to \u0026#39;panic-on-replicas\u0026#39; # to only panic when a replica encounters an error on the replication stream. One of # these two panic values will become the default value in the future once there are # sufficient safety mechanisms in place to prevent false positive crashes. # # propagation-error-behavior ignore # Replica ignore disk write errors controls the behavior of a replica when it is # unable to persist a write command received from its master to disk. By default, # this configuration is set to \u0026#39;no\u0026#39; and will crash the replica in this condition. # It is not recommended to change this default, however in order to be compatible # with older versions of Redis this config can be toggled to \u0026#39;yes\u0026#39; which will just # log a warning and execute the write command it got from the master. # # replica-ignore-disk-write-errors no # ----------------------------------------------------------------------------- # By default, Redis Sentinel includes all replicas in its reports. A replica # can be excluded from Redis Sentinel\u0026#39;s announcements. An unannounced replica # will be ignored by the \u0026#39;sentinel replicas \u0026lt;master\u0026gt;\u0026#39; command and won\u0026#39;t be # exposed to Redis Sentinel\u0026#39;s clients. # # This option does not change the behavior of replica-priority. Even with # replica-announced set to \u0026#39;no\u0026#39;, the replica can be promoted to master. To # prevent this behavior, set replica-priority to 0. # # replica-announced yes # It is possible for a master to stop accepting writes if there are less than # N replicas connected, having a lag less or equal than M seconds. # # The N replicas need to be in \u0026#34;online\u0026#34; state. # # The lag in seconds, that must be \u0026lt;= the specified value, is calculated from # the last ping received from the replica, that is usually sent every second. # # This option does not GUARANTEE that N replicas will accept the write, but # will limit the window of exposure for lost writes in case not enough replicas # are available, to the specified number of seconds. # # For example to require at least 3 replicas with a lag \u0026lt;= 10 seconds use: # # min-replicas-to-write 3 # min-replicas-max-lag 10 # # Setting one or the other to 0 disables the feature. # # By default min-replicas-to-write is set to 0 (feature disabled) and # min-replicas-max-lag is set to 10. # A Redis master is able to list the address and port of the attached # replicas in different ways. For example the \u0026#34;INFO replication\u0026#34; section # offers this information, which is used, among other tools, by # Redis Sentinel in order to discover replica instances. # Another place where this info is available is in the output of the # \u0026#34;ROLE\u0026#34; command of a master. # # The listed IP address and port normally reported by a replica is # obtained in the following way: # # IP: The address is auto detected by checking the peer address # of the socket used by the replica to connect with the master. # # Port: The port is communicated by the replica during the replication # handshake, and is normally the port that the replica is using to # listen for connections. # # However when port forwarding or Network Address Translation (NAT) is # used, the replica may actually be reachable via different IP and port # pairs. The following two options can be used by a replica in order to # report to its master a specific set of IP and port, so that both INFO # and ROLE will report those values. # # There is no need to use both the options if you need to override just # the port or the IP address. # # replica-announce-ip 5.5.5.5 # replica-announce-port 1234 ############################### KEYS TRACKING ################################# # Redis implements server assisted support for client side caching of values. # This is implemented using an invalidation table that remembers, using # a radix key indexed by key name, what clients have which keys. In turn # this is used in order to send invalidation messages to clients. Please # check this page to understand more about the feature: # # https://redis.io/topics/client-side-caching # # When tracking is enabled for a client, all the read only queries are assumed # to be cached: this will force Redis to store information in the invalidation # table. When keys are modified, such information is flushed away, and # invalidation messages are sent to the clients. However if the workload is # heavily dominated by reads, Redis could use more and more memory in order # to track the keys fetched by many clients. # # For this reason it is possible to configure a maximum fill value for the # invalidation table. By default it is set to 1M of keys, and once this limit # is reached, Redis will start to evict keys in the invalidation table # even if they were not modified, just to reclaim memory: this will in turn # force the clients to invalidate the cached values. Basically the table # maximum size is a trade off between the memory you want to spend server # side to track information about who cached what, and the ability of clients # to retain cached objects in memory. # # If you set the value to 0, it means there are no limits, and Redis will # retain as many keys as needed in the invalidation table. # In the \u0026#34;stats\u0026#34; INFO section, you can find information about the number of # keys in the invalidation table at every given moment. # # Note: when key tracking is used in broadcasting mode, no memory is used # in the server side so this setting is useless. # # tracking-table-max-keys 1000000 ################################## SECURITY ################################### # Warning: since Redis is pretty fast, an outside user can try up to # 1 million passwords per second against a modern box. This means that you # should use very strong passwords, otherwise they will be very easy to break. # Note that because the password is really a shared secret between the client # and the server, and should not be memorized by any human, the password # can be easily a long string from /dev/urandom or whatever, so by using a # long and unguessable password no brute force attack will be possible. # Redis ACL users are defined in the following format: # # user \u0026lt;username\u0026gt; ... acl rules ... # # For example: # # user worker +@list +@connection ~jobs:* on \u0026gt;ffa9203c493aa99 # # The special username \u0026#34;default\u0026#34; is used for new connections. If this user # has the \u0026#34;nopass\u0026#34; rule, then new connections will be immediately authenticated # as the \u0026#34;default\u0026#34; user without the need of any password provided via the # AUTH command. Otherwise if the \u0026#34;default\u0026#34; user is not flagged with \u0026#34;nopass\u0026#34; # the connections will start in not authenticated state, and will require # AUTH (or the HELLO command AUTH option) in order to be authenticated and # start to work. # # The ACL rules that describe what a user can do are the following: # # on Enable the user: it is possible to authenticate as this user. # off Disable the user: it\u0026#39;s no longer possible to authenticate # with this user, however the already authenticated connections # will still work. # skip-sanitize-payload RESTORE dump-payload sanitization is skipped. # sanitize-payload RESTORE dump-payload is sanitized (default). # +\u0026lt;command\u0026gt; Allow the execution of that command. # May be used with `|` for allowing subcommands (e.g \u0026#34;+config|get\u0026#34;) # -\u0026lt;command\u0026gt; Disallow the execution of that command. # May be used with `|` for blocking subcommands (e.g \u0026#34;-config|set\u0026#34;) # +@\u0026lt;category\u0026gt; Allow the execution of all the commands in such category # with valid categories are like @admin, @set, @sortedset, ... # and so forth, see the full list in the server.c file where # the Redis command table is described and defined. # The special category @all means all the commands, but currently # present in the server, and that will be loaded in the future # via modules. # +\u0026lt;command\u0026gt;|first-arg Allow a specific first argument of an otherwise # disabled command. It is only supported on commands with # no sub-commands, and is not allowed as negative form # like -SELECT|1, only additive starting with \u0026#34;+\u0026#34;. This # feature is deprecated and may be removed in the future. # allcommands Alias for +@all. Note that it implies the ability to execute # all the future commands loaded via the modules system. # nocommands Alias for -@all. # ~\u0026lt;pattern\u0026gt; Add a pattern of keys that can be mentioned as part of # commands. For instance ~* allows all the keys. The pattern # is a glob-style pattern like the one of KEYS. # It is possible to specify multiple patterns. # %R~\u0026lt;pattern\u0026gt; Add key read pattern that specifies which keys can be read # from. # %W~\u0026lt;pattern\u0026gt; Add key write pattern that specifies which keys can be # written to. # allkeys Alias for ~* # resetkeys Flush the list of allowed keys patterns. # \u0026amp;\u0026lt;pattern\u0026gt; Add a glob-style pattern of Pub/Sub channels that can be # accessed by the user. It is possible to specify multiple channel # patterns. # allchannels Alias for \u0026amp;* # resetchannels Flush the list of allowed channel patterns. # \u0026gt;\u0026lt;password\u0026gt; Add this password to the list of valid password for the user. # For example \u0026gt;mypass will add \u0026#34;mypass\u0026#34; to the list. # This directive clears the \u0026#34;nopass\u0026#34; flag (see later). # \u0026lt;\u0026lt;password\u0026gt; Remove this password from the list of valid passwords. # nopass All the set passwords of the user are removed, and the user # is flagged as requiring no password: it means that every # password will work against this user. If this directive is # used for the default user, every new connection will be # immediately authenticated with the default user without # any explicit AUTH command required. Note that the \u0026#34;resetpass\u0026#34; # directive will clear this condition. # resetpass Flush the list of allowed passwords. Moreover removes the # \u0026#34;nopass\u0026#34; status. After \u0026#34;resetpass\u0026#34; the user has no associated # passwords and there is no way to authenticate without adding # some password (or setting it as \u0026#34;nopass\u0026#34; later). # reset Performs the following actions: resetpass, resetkeys, off, # -@all. The user returns to the same state it has immediately # after its creation. # (\u0026lt;options\u0026gt;) Create a new selector with the options specified within the # parentheses and attach it to the user. Each option should be # space separated. The first character must be ( and the last # character must be ). # clearselectors Remove all of the currently attached selectors. # Note this does not change the \u0026#34;root\u0026#34; user permissions, # which are the permissions directly applied onto the # user (outside the parentheses). # # ACL rules can be specified in any order: for instance you can start with # passwords, then flags, or key patterns. However note that the additive # and subtractive rules will CHANGE MEANING depending on the ordering. # For instance see the following example: # # user alice on +@all -DEBUG ~* \u0026gt;somepassword # # This will allow \u0026#34;alice\u0026#34; to use all the commands with the exception of the # DEBUG command, since +@all added all the commands to the set of the commands # alice can use, and later DEBUG was removed. However if we invert the order # of two ACL rules the result will be different: # # user alice on -DEBUG +@all ~* \u0026gt;somepassword # # Now DEBUG was removed when alice had yet no commands in the set of allowed # commands, later all the commands are added, so the user will be able to # execute everything. # # Basically ACL rules are processed left-to-right. # # The following is a list of command categories and their meanings: # * keyspace - Writing or reading from keys, databases, or their metadata # in a type agnostic way. Includes DEL, RESTORE, DUMP, RENAME, EXISTS, DBSIZE, # KEYS, EXPIRE, TTL, FLUSHALL, etc. Commands that may modify the keyspace, # key or metadata will also have `write` category. Commands that only read # the keyspace, key or metadata will have the `read` category. # * read - Reading from keys (values or metadata). Note that commands that don\u0026#39;t # interact with keys, will not have either `read` or `write`. # * write - Writing to keys (values or metadata) # * admin - Administrative commands. Normal applications will never need to use # these. Includes REPLICAOF, CONFIG, DEBUG, SAVE, MONITOR, ACL, SHUTDOWN, etc. # * dangerous - Potentially dangerous (each should be considered with care for # various reasons). This includes FLUSHALL, MIGRATE, RESTORE, SORT, KEYS, # CLIENT, DEBUG, INFO, CONFIG, SAVE, REPLICAOF, etc. # * connection - Commands affecting the connection or other connections. # This includes AUTH, SELECT, COMMAND, CLIENT, ECHO, PING, etc. # * blocking - Potentially blocking the connection until released by another # command. # * fast - Fast O(1) commands. May loop on the number of arguments, but not the # number of elements in the key. # * slow - All commands that are not Fast. # * pubsub - PUBLISH / SUBSCRIBE related # * transaction - WATCH / MULTI / EXEC related commands. # * scripting - Scripting related. # * set - Data type: sets related. # * sortedset - Data type: zsets related. # * list - Data type: lists related. # * hash - Data type: hashes related. # * string - Data type: strings related. # * bitmap - Data type: bitmaps related. # * hyperloglog - Data type: hyperloglog related. # * geo - Data type: geo related. # * stream - Data type: streams related. # # For more information about ACL configuration please refer to # the Redis web site at https://redis.io/topics/acl # ACL LOG # # The ACL Log tracks failed commands and authentication events associated # with ACLs. The ACL Log is useful to troubleshoot failed commands blocked # by ACLs. The ACL Log is stored in memory. You can reclaim memory with # ACL LOG RESET. Define the maximum entry length of the ACL Log below. acllog-max-len 128 # Using an external ACL file # # Instead of configuring users here in this file, it is possible to use # a stand-alone file just listing users. The two methods cannot be mixed: # if you configure users here and at the same time you activate the external # ACL file, the server will refuse to start. # # The format of the external ACL user file is exactly the same as the # format that is used inside redis.conf to describe users. # # aclfile /etc/redis/users.acl # IMPORTANT NOTE: starting with Redis 6 \u0026#34;requirepass\u0026#34; is just a compatibility # layer on top of the new ACL system. The option effect will be just setting # the password for the default user. Clients will still authenticate using # AUTH \u0026lt;password\u0026gt; as usually, or more explicitly with AUTH default \u0026lt;password\u0026gt; # if they follow the new protocol: both will work. # # The requirepass is not compatible with aclfile option and the ACL LOAD # command, these will cause requirepass to be ignored. # # requirepass foobared # New users are initialized with restrictive permissions by default, via the # equivalent of this ACL rule \u0026#39;off resetkeys -@all\u0026#39;. Starting with Redis 6.2, it # is possible to manage access to Pub/Sub channels with ACL rules as well. The # default Pub/Sub channels permission if new users is controlled by the # acl-pubsub-default configuration directive, which accepts one of these values: # # allchannels: grants access to all Pub/Sub channels # resetchannels: revokes access to all Pub/Sub channels # # From Redis 7.0, acl-pubsub-default defaults to \u0026#39;resetchannels\u0026#39; permission. # # acl-pubsub-default resetchannels # Command renaming (DEPRECATED). # # ------------------------------------------------------------------------ # WARNING: avoid using this option if possible. Instead use ACLs to remove # commands from the default user, and put them only in some admin user you # create for administrative purposes. # ------------------------------------------------------------------------ # # It is possible to change the name of dangerous commands in a shared # environment. For instance the CONFIG command may be renamed into something # hard to guess so that it will still be available for internal-use tools # but not available for general clients. # # Example: # # rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52 # # It is also possible to completely kill a command by renaming it into # an empty string: # # rename-command CONFIG \u0026#34;\u0026#34; # # Please note that changing the name of commands that are logged into the # AOF file or transmitted to replicas may cause problems. ################################### CLIENTS #################################### # Set the max number of connected clients at the same time. By default # this limit is set to 10000 clients, however if the Redis server is not # able to configure the process file limit to allow for the specified limit # the max number of allowed clients is set to the current file limit # minus 32 (as Redis reserves a few file descriptors for internal uses). # # Once the limit is reached Redis will close all the new connections sending # an error \u0026#39;max number of clients reached\u0026#39;. # # IMPORTANT: When Redis Cluster is used, the max number of connections is also # shared with the cluster bus: every node in the cluster will use two # connections, one incoming and another outgoing. It is important to size the # limit accordingly in case of very large clusters. # # maxclients 10000 ############################## MEMORY MANAGEMENT ################################ # Set a memory usage limit to the specified amount of bytes. # When the memory limit is reached Redis will try to remove keys # according to the eviction policy selected (see maxmemory-policy). # # If Redis can\u0026#39;t remove keys according to the policy, or if the policy is # set to \u0026#39;noeviction\u0026#39;, Redis will start to reply with errors to commands # that would use more memory, like SET, LPUSH, and so on, and will continue # to reply to read-only commands like GET. # # This option is usually useful when using Redis as an LRU or LFU cache, or to # set a hard memory limit for an instance (using the \u0026#39;noeviction\u0026#39; policy). # # WARNING: If you have replicas attached to an instance with maxmemory on, # the size of the output buffers needed to feed the replicas are subtracted # from the used memory count, so that network problems / resyncs will # not trigger a loop where keys are evicted, and in turn the output # buffer of replicas is full with DELs of keys evicted triggering the deletion # of more keys, and so forth until the database is completely emptied. # # In short... if you have replicas attached it is suggested that you set a lower # limit for maxmemory so that there is some free RAM on the system for replica # output buffers (but this is not needed if the policy is \u0026#39;noeviction\u0026#39;). # # maxmemory \u0026lt;bytes\u0026gt; # MAXMEMORY POLICY: how Redis will select what to remove when maxmemory # is reached. You can select one from the following behaviors: # # volatile-lru -\u0026gt; Evict using approximated LRU, only keys with an expire set. # allkeys-lru -\u0026gt; Evict any key using approximated LRU. # volatile-lfu -\u0026gt; Evict using approximated LFU, only keys with an expire set. # allkeys-lfu -\u0026gt; Evict any key using approximated LFU. # volatile-random -\u0026gt; Remove a random key having an expire set. # allkeys-random -\u0026gt; Remove a random key, any key. # volatile-ttl -\u0026gt; Remove the key with the nearest expire time (minor TTL) # noeviction -\u0026gt; Don\u0026#39;t evict anything, just return an error on write operations. # # LRU means Least Recently Used # LFU means Least Frequently Used # # Both LRU, LFU and volatile-ttl are implemented using approximated # randomized algorithms. # # Note: with any of the above policies, when there are no suitable keys for # eviction, Redis will return an error on write operations that require # more memory. These are usually commands that create new keys, add data or # modify existing keys. A few examples are: SET, INCR, HSET, LPUSH, SUNIONSTORE, # SORT (due to the STORE argument), and EXEC (if the transaction includes any # command that requires memory). # # The default is: # # maxmemory-policy noeviction # LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated # algorithms (in order to save memory), so you can tune it for speed or # accuracy. By default Redis will check five keys and pick the one that was # used least recently, you can change the sample size using the following # configuration directive. # # The default of 5 produces good enough results. 10 Approximates very closely # true LRU but costs more CPU. 3 is faster but not very accurate. # # maxmemory-samples 5 # Eviction processing is designed to function well with the default setting. # If there is an unusually large amount of write traffic, this value may need to # be increased. Decreasing this value may reduce latency at the risk of # eviction processing effectiveness # 0 = minimum latency, 10 = default, 100 = process without regard to latency # # maxmemory-eviction-tenacity 10 # Starting from Redis 5, by default a replica will ignore its maxmemory setting # (unless it is promoted to master after a failover or manually). It means # that the eviction of keys will be just handled by the master, sending the # DEL commands to the replica as keys evict in the master side. # # This behavior ensures that masters and replicas stay consistent, and is usually # what you want, however if your replica is writable, or you want the replica # to have a different memory setting, and you are sure all the writes performed # to the replica are idempotent, then you may change this default (but be sure # to understand what you are doing). # # Note that since the replica by default does not evict, it may end using more # memory than the one set via maxmemory (there are certain buffers that may # be larger on the replica, or data structures may sometimes take more memory # and so forth). So make sure you monitor your replicas and make sure they # have enough memory to never hit a real out-of-memory condition before the # master hits the configured maxmemory setting. # # replica-ignore-maxmemory yes # Redis reclaims expired keys in two ways: upon access when those keys are # found to be expired, and also in background, in what is called the # \u0026#34;active expire key\u0026#34;. The key space is slowly and interactively scanned # looking for expired keys to reclaim, so that it is possible to free memory # of keys that are expired and will never be accessed again in a short time. # # The default effort of the expire cycle will try to avoid having more than # ten percent of expired keys still in memory, and will try to avoid consuming # more than 25% of total memory and to add latency to the system. However # it is possible to increase the expire \u0026#34;effort\u0026#34; that is normally set to # \u0026#34;1\u0026#34;, to a greater value, up to the value \u0026#34;10\u0026#34;. At its maximum value the # system will use more CPU, longer cycles (and technically may introduce # more latency), and will tolerate less already expired keys still present # in the system. It\u0026#39;s a tradeoff between memory, CPU and latency. # # active-expire-effort 1 ############################# LAZY FREEING #################################### # Redis has two primitives to delete keys. One is called DEL and is a blocking # deletion of the object. It means that the server stops processing new commands # in order to reclaim all the memory associated with an object in a synchronous # way. If the key deleted is associated with a small object, the time needed # in order to execute the DEL command is very small and comparable to most other # O(1) or O(log_N) commands in Redis. However if the key is associated with an # aggregated value containing millions of elements, the server can block for # a long time (even seconds) in order to complete the operation. # # For the above reasons Redis also offers non blocking deletion primitives # such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and # FLUSHDB commands, in order to reclaim memory in background. Those commands # are executed in constant time. Another thread will incrementally free the # object in the background as fast as possible. # # DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled. # It\u0026#39;s up to the design of the application to understand when it is a good # idea to use one or the other. However the Redis server sometimes has to # delete keys or flush the whole database as a side effect of other operations. # Specifically Redis deletes objects independently of a user call in the # following scenarios: # # 1) On eviction, because of the maxmemory and maxmemory policy configurations, # in order to make room for new data, without going over the specified # memory limit. # 2) Because of expire: when a key with an associated time to live (see the # EXPIRE command) must be deleted from memory. # 3) Because of a side effect of a command that stores data on a key that may # already exist. For example the RENAME command may delete the old key # content when it is replaced with another one. Similarly SUNIONSTORE # or SORT with STORE option may delete existing keys. The SET command # itself removes any old content of the specified key in order to replace # it with the specified string. # 4) During replication, when a replica performs a full resynchronization with # its master, the content of the whole database is removed in order to # load the RDB file just transferred. # # In all the above cases the default is to delete objects in a blocking way, # like if DEL was called. However you can configure each case specifically # in order to instead release memory in a non-blocking way like if UNLINK # was called, using the following configuration directives. lazyfree-lazy-eviction no lazyfree-lazy-expire no lazyfree-lazy-server-del no replica-lazy-flush no # It is also possible, for the case when to replace the user code DEL calls # with UNLINK calls is not easy, to modify the default behavior of the DEL # command to act exactly like UNLINK, using the following configuration # directive: lazyfree-lazy-user-del no # FLUSHDB, FLUSHALL, SCRIPT FLUSH and FUNCTION FLUSH support both asynchronous and synchronous # deletion, which can be controlled by passing the [SYNC|ASYNC] flags into the # commands. When neither flag is passed, this directive will be used to determine # if the data should be deleted asynchronously. lazyfree-lazy-user-flush no ################################ THREADED I/O ################################# # Redis is mostly single threaded, however there are certain threaded # operations such as UNLINK, slow I/O accesses and other things that are # performed on side threads. # # Now it is also possible to handle Redis clients socket reads and writes # in different I/O threads. Since especially writing is so slow, normally # Redis users use pipelining in order to speed up the Redis performances per # core, and spawn multiple instances in order to scale more. Using I/O # threads it is possible to easily speedup two times Redis without resorting # to pipelining nor sharding of the instance. # # By default threading is disabled, we suggest enabling it only in machines # that have at least 4 or more cores, leaving at least one spare core. # Using more than 8 threads is unlikely to help much. We also recommend using # threaded I/O only if you actually have performance problems, with Redis # instances being able to use a quite big percentage of CPU time, otherwise # there is no point in using this feature. # # So for instance if you have a four cores boxes, try to use 2 or 3 I/O # threads, if you have a 8 cores, try to use 6 threads. In order to # enable I/O threads use the following configuration directive: # # io-threads 4 # # Setting io-threads to 1 will just use the main thread as usual. # When I/O threads are enabled, we only use threads for writes, that is # to thread the write(2) syscall and transfer the client buffers to the # socket. However it is also possible to enable threading of reads and # protocol parsing using the following configuration directive, by setting # it to yes: # # io-threads-do-reads no # # Usually threading reads doesn\u0026#39;t help much. # # NOTE 1: This configuration directive cannot be changed at runtime via # CONFIG SET. Also, this feature currently does not work when SSL is # enabled. # # NOTE 2: If you want to test the Redis speedup using redis-benchmark, make # sure you also run the benchmark itself in threaded mode, using the # --threads option to match the number of Redis threads, otherwise you\u0026#39;ll not # be able to notice the improvements. ############################ KERNEL OOM CONTROL ############################## # On Linux, it is possible to hint the kernel OOM killer on what processes # should be killed first when out of memory. # # Enabling this feature makes Redis actively control the oom_score_adj value # for all its processes, depending on their role. The default scores will # attempt to have background child processes killed before all others, and # replicas killed before masters. # # Redis supports these options: # # no: Don\u0026#39;t make changes to oom-score-adj (default). # yes: Alias to \u0026#34;relative\u0026#34; see below. # absolute: Values in oom-score-adj-values are written as is to the kernel. # relative: Values are used relative to the initial value of oom_score_adj when # the server starts and are then clamped to a range of -1000 to 1000. # Because typically the initial value is 0, they will often match the # absolute values. oom-score-adj no # When oom-score-adj is used, this directive controls the specific values used # for master, replica and background child processes. Values range -2000 to # 2000 (higher means more likely to be killed). # # Unprivileged processes (not root, and without CAP_SYS_RESOURCE capabilities) # can freely increase their value, but not decrease it below its initial # settings. This means that setting oom-score-adj to \u0026#34;relative\u0026#34; and setting the # oom-score-adj-values to positive values will always succeed. oom-score-adj-values 0 200 800 #################### KERNEL transparent hugepage CONTROL ###################### # Usually the kernel Transparent Huge Pages control is set to \u0026#34;madvise\u0026#34; or # or \u0026#34;never\u0026#34; by default (/sys/kernel/mm/transparent_hugepage/enabled), in which # case this config has no effect. On systems in which it is set to \u0026#34;always\u0026#34;, # redis will attempt to disable it specifically for the redis process in order # to avoid latency problems specifically with fork(2) and CoW. # If for some reason you prefer to keep it enabled, you can set this config to # \u0026#34;no\u0026#34; and the kernel global to \u0026#34;always\u0026#34;. disable-thp yes ############################## APPEND ONLY MODE ############################### # By default Redis asynchronously dumps the dataset on disk. This mode is # good enough in many applications, but an issue with the Redis process or # a power outage may result into a few minutes of writes lost (depending on # the configured save points). # # The Append Only File is an alternative persistence mode that provides # much better durability. For instance using the default data fsync policy # (see later in the config file) Redis can lose just one second of writes in a # dramatic event like a server power outage, or a single write if something # wrong with the Redis process itself happens, but the operating system is # still running correctly. # # AOF and RDB persistence can be enabled at the same time without problems. # If the AOF is enabled on startup Redis will load the AOF, that is the file # with the better durability guarantees. # # Please check https://redis.io/topics/persistence for more information. #-appendonly no # The base name of the append only file. # # Redis 7 and newer use a set of append-only files to persist the dataset # and changes applied to it. There are two basic types of files in use: # # - Base files, which are a snapshot representing the complete state of the # dataset at the time the file was created. Base files can be either in # the form of RDB (binary serialized) or AOF (textual commands). # - Incremental files, which contain additional commands that were applied # to the dataset following the previous file. # # In addition, manifest files are used to track the files and the order in # which they were created and should be applied. # # Append-only file names are created by Redis following a specific pattern. # The file name\u0026#39;s prefix is based on the \u0026#39;appendfilename\u0026#39; configuration # parameter, followed by additional information about the sequence and type. # # For example, if appendfilename is set to appendonly.aof, the following file # names could be derived: # # - appendonly.aof.1.base.rdb as a base file. # - appendonly.aof.1.incr.aof, appendonly.aof.2.incr.aof as incremental files. # - appendonly.aof.manifest as a manifest file. appendfilename \u0026#34;appendonly.aof\u0026#34; # For convenience, Redis stores all persistent append-only files in a dedicated # directory. The name of the directory is determined by the appenddirname # configuration parameter. appenddirname \u0026#34;appendonlydir\u0026#34; # The fsync() call tells the Operating System to actually write data on disk # instead of waiting for more data in the output buffer. Some OS will really flush # data on disk, some other OS will just try to do it ASAP. # # Redis supports three different modes: # # no: don\u0026#39;t fsync, just let the OS flush the data when it wants. Faster. # always: fsync after every write to the append only log. Slow, Safest. # everysec: fsync only one time every second. Compromise. # # The default is \u0026#34;everysec\u0026#34;, as that\u0026#39;s usually the right compromise between # speed and data safety. It\u0026#39;s up to you to understand if you can relax this to # \u0026#34;no\u0026#34; that will let the operating system flush the output buffer when # it wants, for better performances (but if you can live with the idea of # some data loss consider the default persistence mode that\u0026#39;s snapshotting), # or on the contrary, use \u0026#34;always\u0026#34; that\u0026#39;s very slow but a bit safer than # everysec. # # More details please check the following article: # http://antirez.com/post/redis-persistence-demystified.html # # If unsure, use \u0026#34;everysec\u0026#34;. # appendfsync always appendfsync everysec # appendfsync no # When the AOF fsync policy is set to always or everysec, and a background # saving process (a background save or AOF log background rewriting) is # performing a lot of I/O against the disk, in some Linux configurations # Redis may block too long on the fsync() call. Note that there is no fix for # this currently, as even performing fsync in a different thread will block # our synchronous write(2) call. # # In order to mitigate this problem it\u0026#39;s possible to use the following option # that will prevent fsync() from being called in the main process while a # BGSAVE or BGREWRITEAOF is in progress. # # This means that while another child is saving, the durability of Redis is # the same as \u0026#34;appendfsync no\u0026#34;. In practical terms, this means that it is # possible to lose up to 30 seconds of log in the worst scenario (with the # default Linux settings). # # If you have latency problems turn this to \u0026#34;yes\u0026#34;. Otherwise leave it as # \u0026#34;no\u0026#34; that is the safest pick from the point of view of durability. no-appendfsync-on-rewrite no # Automatic rewrite of the append only file. # Redis is able to automatically rewrite the log file implicitly calling # BGREWRITEAOF when the AOF log size grows by the specified percentage. # # This is how it works: Redis remembers the size of the AOF file after the # latest rewrite (if no rewrite has happened since the restart, the size of # the AOF at startup is used). # # This base size is compared to the current size. If the current size is # bigger than the specified percentage, the rewrite is triggered. Also # you need to specify a minimal size for the AOF file to be rewritten, this # is useful to avoid rewriting the AOF file even if the percentage increase # is reached but it is still pretty small. # # Specify a percentage of zero in order to disable the automatic AOF # rewrite feature. auto-aof-rewrite-percentage 100 auto-aof-rewrite-min-size 64mb # An AOF file may be found to be truncated at the end during the Redis # startup process, when the AOF data gets loaded back into memory. # This may happen when the system where Redis is running # crashes, especially when an ext4 filesystem is mounted without the # data=ordered option (however this can\u0026#39;t happen when Redis itself # crashes or aborts but the operating system still works correctly). # # Redis can either exit with an error when this happens, or load as much # data as possible (the default now) and start if the AOF file is found # to be truncated at the end. The following option controls this behavior. # # If aof-load-truncated is set to yes, a truncated AOF file is loaded and # the Redis server starts emitting a log to inform the user of the event. # Otherwise if the option is set to no, the server aborts with an error # and refuses to start. When the option is set to no, the user requires # to fix the AOF file using the \u0026#34;redis-check-aof\u0026#34; utility before to restart # the server. # # Note that if the AOF file will be found to be corrupted in the middle # the server will still exit with an error. This option only applies when # Redis will try to read more data from the AOF file but not enough bytes # will be found. aof-load-truncated yes # Redis can create append-only base files in either RDB or AOF formats. Using # the RDB format is always faster and more efficient, and disabling it is only # supported for backward compatibility purposes. aof-use-rdb-preamble yes # Redis supports recording timestamp annotations in the AOF to support restoring # the data from a specific point-in-time. However, using this capability changes # the AOF format in a way that may not be compatible with existing AOF parsers. aof-timestamp-enabled no ################################ SHUTDOWN ##################################### # Maximum time to wait for replicas when shutting down, in seconds. # # During shut down, a grace period allows any lagging replicas to catch up with # the latest replication offset before the master exists. This period can # prevent data loss, especially for deployments without configured disk backups. # # The \u0026#39;shutdown-timeout\u0026#39; value is the grace period\u0026#39;s duration in seconds. It is # only applicable when the instance has replicas. To disable the feature, set # the value to 0. # # shutdown-timeout 10 # When Redis receives a SIGINT or SIGTERM, shutdown is initiated and by default # an RDB snapshot is written to disk in a blocking operation if save points are configured. # The options used on signaled shutdown can include the following values: # default: Saves RDB snapshot only if save points are configured. # Waits for lagging replicas to catch up. # save: Forces a DB saving operation even if no save points are configured. # nosave: Prevents DB saving operation even if one or more save points are configured. # now: Skips waiting for lagging replicas. # force: Ignores any errors that would normally prevent the server from exiting. # # Any combination of values is allowed as long as \u0026#34;save\u0026#34; and \u0026#34;nosave\u0026#34; are not set simultaneously. # Example: \u0026#34;nosave force now\u0026#34; # # shutdown-on-sigint default # shutdown-on-sigterm default ################ NON-DETERMINISTIC LONG BLOCKING COMMANDS ##################### # Maximum time in milliseconds for EVAL scripts, functions and in some cases # modules\u0026#39; commands before Redis can start processing or rejecting other clients. # # If the maximum execution time is reached Redis will start to reply to most # commands with a BUSY error. # # In this state Redis will only allow a handful of commands to be executed. # For instance, SCRIPT KILL, FUNCTION KILL, SHUTDOWN NOSAVE and possibly some # module specific \u0026#39;allow-busy\u0026#39; commands. # # SCRIPT KILL and FUNCTION KILL will only be able to stop a script that did not # yet call any write commands, so SHUTDOWN NOSAVE may be the only way to stop # the server in the case a write command was already issued by the script when # the user doesn\u0026#39;t want to wait for the natural termination of the script. # # The default is 5 seconds. It is possible to set it to 0 or a negative value # to disable this mechanism (uninterrupted execution). Note that in the past # this config had a different name, which is now an alias, so both of these do # the same: # lua-time-limit 5000 # busy-reply-threshold 5000 ################################ REDIS CLUSTER ############################### # Normal Redis instances can\u0026#39;t be part of a Redis Cluster; only nodes that are # started as cluster nodes can. In order to start a Redis instance as a # cluster node enable the cluster support uncommenting the following: # # cluster-enabled yes # Every cluster node has a cluster configuration file. This file is not # intended to be edited by hand. It is created and updated by Redis nodes. # Every Redis Cluster node requires a different cluster configuration file. # Make sure that instances running in the same system do not have # overlapping cluster configuration file names. # # cluster-config-file nodes-6379.conf # Cluster node timeout is the amount of milliseconds a node must be unreachable # for it to be considered in failure state. # Most other internal time limits are a multiple of the node timeout. # # cluster-node-timeout 15000 # The cluster port is the port that the cluster bus will listen for inbound connections on. When set # to the default value, 0, it will be bound to the command port + 10000. Setting this value requires # you to specify the cluster bus port when executing cluster meet. # cluster-port 0 # A replica of a failing master will avoid to start a failover if its data # looks too old. # # There is no simple way for a replica to actually have an exact measure of # its \u0026#34;data age\u0026#34;, so the following two checks are performed: # # 1) If there are multiple replicas able to failover, they exchange messages # in order to try to give an advantage to the replica with the best # replication offset (more data from the master processed). # Replicas will try to get their rank by offset, and apply to the start # of the failover a delay proportional to their rank. # # 2) Every single replica computes the time of the last interaction with # its master. This can be the last ping or command received (if the master # is still in the \u0026#34;connected\u0026#34; state), or the time that elapsed since the # disconnection with the master (if the replication link is currently down). # If the last interaction is too old, the replica will not try to failover # at all. # # The point \u0026#34;2\u0026#34; can be tuned by user. Specifically a replica will not perform # the failover if, since the last interaction with the master, the time # elapsed is greater than: # # (node-timeout * cluster-replica-validity-factor) + repl-ping-replica-period # # So for example if node-timeout is 30 seconds, and the cluster-replica-validity-factor # is 10, and assuming a default repl-ping-replica-period of 10 seconds, the # replica will not try to failover if it was not able to talk with the master # for longer than 310 seconds. # # A large cluster-replica-validity-factor may allow replicas with too old data to failover # a master, while a too small value may prevent the cluster from being able to # elect a replica at all. # # For maximum availability, it is possible to set the cluster-replica-validity-factor # to a value of 0, which means, that replicas will always try to failover the # master regardless of the last time they interacted with the master. # (However they\u0026#39;ll always try to apply a delay proportional to their # offset rank). # # Zero is the only value able to guarantee that when all the partitions heal # the cluster will always be able to continue. # # cluster-replica-validity-factor 10 # Cluster replicas are able to migrate to orphaned masters, that are masters # that are left without working replicas. This improves the cluster ability # to resist to failures as otherwise an orphaned master can\u0026#39;t be failed over # in case of failure if it has no working replicas. # # Replicas migrate to orphaned masters only if there are still at least a # given number of other working replicas for their old master. This number # is the \u0026#34;migration barrier\u0026#34;. A migration barrier of 1 means that a replica # will migrate only if there is at least 1 other working replica for its master # and so forth. It usually reflects the number of replicas you want for every # master in your cluster. # # Default is 1 (replicas migrate only if their masters remain with at least # one replica). To disable migration just set it to a very large value or # set cluster-allow-replica-migration to \u0026#39;no\u0026#39;. # A value of 0 can be set but is useful only for debugging and dangerous # in production. # # cluster-migration-barrier 1 # Turning off this option allows to use less automatic cluster configuration. # It both disables migration to orphaned masters and migration from masters # that became empty. # # Default is \u0026#39;yes\u0026#39; (allow automatic migrations). # # cluster-allow-replica-migration yes # By default Redis Cluster nodes stop accepting queries if they detect there # is at least a hash slot uncovered (no available node is serving it). # This way if the cluster is partially down (for example a range of hash slots # are no longer covered) all the cluster becomes, eventually, unavailable. # It automatically returns available as soon as all the slots are covered again. # # However sometimes you want the subset of the cluster which is working, # to continue to accept queries for the part of the key space that is still # covered. In order to do so, just set the cluster-require-full-coverage # option to no. # # cluster-require-full-coverage yes # This option, when set to yes, prevents replicas from trying to failover its # master during master failures. However the replica can still perform a # manual failover, if forced to do so. # # This is useful in different scenarios, especially in the case of multiple # data center operations, where we want one side to never be promoted if not # in the case of a total DC failure. # # cluster-replica-no-failover no # This option, when set to yes, allows nodes to serve read traffic while the # cluster is in a down state, as long as it believes it owns the slots. # # This is useful for two cases. The first case is for when an application # doesn\u0026#39;t require consistency of data during node failures or network partitions. # One example of this is a cache, where as long as the node has the data it # should be able to serve it. # # The second use case is for configurations that don\u0026#39;t meet the recommended # three shards but want to enable cluster mode and scale later. A # master outage in a 1 or 2 shard configuration causes a read/write outage to the # entire cluster without this option set, with it set there is only a write outage. # Without a quorum of masters, slot ownership will not change automatically. # # cluster-allow-reads-when-down no # This option, when set to yes, allows nodes to serve pubsub shard traffic while # the cluster is in a down state, as long as it believes it owns the slots. # # This is useful if the application would like to use the pubsub feature even when # the cluster global stable state is not OK. If the application wants to make sure only # one shard is serving a given channel, this feature should be kept as yes. # # cluster-allow-pubsubshard-when-down yes # Cluster link send buffer limit is the limit on the memory usage of an individual # cluster bus link\u0026#39;s send buffer in bytes. Cluster links would be freed if they exceed # this limit. This is to primarily prevent send buffers from growing unbounded on links # toward slow peers (E.g. PubSub messages being piled up). # This limit is disabled by default. Enable this limit when \u0026#39;mem_cluster_links\u0026#39; INFO field # and/or \u0026#39;send-buffer-allocated\u0026#39; entries in the \u0026#39;CLUSTER LINKS` command output continuously increase. # Minimum limit of 1gb is recommended so that cluster link buffer can fit in at least a single # PubSub message by default. (client-query-buffer-limit default value is 1gb) # # cluster-link-sendbuf-limit 0 # Clusters can configure their announced hostname using this config. This is a common use case for # applications that need to use TLS Server Name Indication (SNI) or dealing with DNS based # routing. By default this value is only shown as additional metadata in the CLUSTER SLOTS # command, but can be changed using \u0026#39;cluster-preferred-endpoint-type\u0026#39; config. This value is # communicated along the clusterbus to all nodes, setting it to an empty string will remove # the hostname and also propagate the removal. # # cluster-announce-hostname \u0026#34;\u0026#34; # Clusters can advertise how clients should connect to them using either their IP address, # a user defined hostname, or by declaring they have no endpoint. Which endpoint is # shown as the preferred endpoint is set by using the cluster-preferred-endpoint-type # config with values \u0026#39;ip\u0026#39;, \u0026#39;hostname\u0026#39;, or \u0026#39;unknown-endpoint\u0026#39;. This value controls how # the endpoint returned for MOVED/ASKING requests as well as the first field of CLUSTER SLOTS. # If the preferred endpoint type is set to hostname, but no announced hostname is set, a \u0026#39;?\u0026#39; # will be returned instead. # # When a cluster advertises itself as having an unknown endpoint, it\u0026#39;s indicating that # the server doesn\u0026#39;t know how clients can reach the cluster. This can happen in certain # networking situations where there are multiple possible routes to the node, and the # server doesn\u0026#39;t know which one the client took. In this case, the server is expecting # the client to reach out on the same endpoint it used for making the last request, but use # the port provided in the response. # # cluster-preferred-endpoint-type ip # In order to setup your cluster make sure to read the documentation # available at https://redis.io web site. ########################## CLUSTER DOCKER/NAT support ######################## # In certain deployments, Redis Cluster nodes address discovery fails, because # addresses are NAT-ted or because ports are forwarded (the typical case is # Docker and other containers). # # In order to make Redis Cluster working in such environments, a static # configuration where each node knows its public address is needed. The # following four options are used for this scope, and are: # # * cluster-announce-ip # * cluster-announce-port # * cluster-announce-tls-port # * cluster-announce-bus-port # # Each instructs the node about its address, client ports (for connections # without and with TLS) and cluster message bus port. The information is then # published in the header of the bus packets so that other nodes will be able to # correctly map the address of the node publishing the information. # # If cluster-tls is set to yes and cluster-announce-tls-port is omitted or set # to zero, then cluster-announce-port refers to the TLS port. Note also that # cluster-announce-tls-port has no effect if cluster-tls is set to no. # # If the above options are not used, the normal Redis Cluster auto-detection # will be used instead. # # Note that when remapped, the bus port may not be at the fixed offset of # clients port + 10000, so you can specify any port and bus-port depending # on how they get remapped. If the bus-port is not set, a fixed offset of # 10000 will be used as usual. # # Example: # # cluster-announce-ip 10.1.1.5 # cluster-announce-tls-port 6379 # cluster-announce-port 0 # cluster-announce-bus-port 6380 ################################## SLOW LOG ################################### # The Redis Slow Log is a system to log queries that exceeded a specified # execution time. The execution time does not include the I/O operations # like talking with the client, sending the reply and so forth, # but just the time needed to actually execute the command (this is the only # stage of command execution where the thread is blocked and can not serve # other requests in the meantime). # # You can configure the slow log with two parameters: one tells Redis # what is the execution time, in microseconds, to exceed in order for the # command to get logged, and the other parameter is the length of the # slow log. When a new command is logged the oldest one is removed from the # queue of logged commands. # The following time is expressed in microseconds, so 1000000 is equivalent # to one second. Note that a negative number disables the slow log, while # a value of zero forces the logging of every command. slowlog-log-slower-than 10000 # There is no limit to this length. Just be aware that it will consume memory. # You can reclaim memory used by the slow log with SLOWLOG RESET. slowlog-max-len 128 ################################ LATENCY MONITOR ############################## # The Redis latency monitoring subsystem samples different operations # at runtime in order to collect data related to possible sources of # latency of a Redis instance. # # Via the LATENCY command this information is available to the user that can # print graphs and obtain reports. # # The system only logs operations that were performed in a time equal or # greater than the amount of milliseconds specified via the # latency-monitor-threshold configuration directive. When its value is set # to zero, the latency monitor is turned off. # # By default latency monitoring is disabled since it is mostly not needed # if you don\u0026#39;t have latency issues, and collecting data has a performance # impact, that while very small, can be measured under big load. Latency # monitoring can easily be enabled at runtime using the command # \u0026#34;CONFIG SET latency-monitor-threshold \u0026lt;milliseconds\u0026gt;\u0026#34; if needed. latency-monitor-threshold 0 ################################ LATENCY TRACKING ############################## # The Redis extended latency monitoring tracks the per command latencies and enables # exporting the percentile distribution via the INFO latencystats command, # and cumulative latency distributions (histograms) via the LATENCY command. # # By default, the extended latency monitoring is enabled since the overhead # of keeping track of the command latency is very small. # latency-tracking yes # By default the exported latency percentiles via the INFO latencystats command # are the p50, p99, and p999. # latency-tracking-info-percentiles 50 99 99.9 ############################# EVENT NOTIFICATION ############################## # Redis can notify Pub/Sub clients about events happening in the key space. # This feature is documented at https://redis.io/topics/notifications # # For instance if keyspace events notification is enabled, and a client # performs a DEL operation on key \u0026#34;foo\u0026#34; stored in the Database 0, two # messages will be published via Pub/Sub: # # PUBLISH __keyspace@0__:foo del # PUBLISH __keyevent@0__:del foo # # It is possible to select the events that Redis will notify among a set # of classes. Every class is identified by a single character: # # K Keyspace events, published with __keyspace@\u0026lt;db\u0026gt;__ prefix. # E Keyevent events, published with __keyevent@\u0026lt;db\u0026gt;__ prefix. # g Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ... # $ String commands # l List commands # s Set commands # h Hash commands # z Sorted set commands # x Expired events (events generated every time a key expires) # e Evicted events (events generated when a key is evicted for maxmemory) # n New key events (Note: not included in the \u0026#39;A\u0026#39; class) # t Stream commands # d Module key type events # m Key-miss events (Note: It is not included in the \u0026#39;A\u0026#39; class) # A Alias for g$lshzxetd, so that the \u0026#34;AKE\u0026#34; string means all the events # (Except key-miss events which are excluded from \u0026#39;A\u0026#39; due to their # unique nature). # # The \u0026#34;notify-keyspace-events\u0026#34; takes as argument a string that is composed # of zero or multiple characters. The empty string means that notifications # are disabled. # # Example: to enable list and generic events, from the point of view of the # event name, use: # # notify-keyspace-events Elg # # Example 2: to get the stream of the expired keys subscribing to channel # name __keyevent@0__:expired use: # # notify-keyspace-events Ex # # By default all notifications are disabled because most users don\u0026#39;t need # this feature and the feature has some overhead. Note that if you don\u0026#39;t # specify at least one of K or E, no events will be delivered. notify-keyspace-events \u0026#34;\u0026#34; ############################### ADVANCED CONFIG ############################### # Hashes are encoded using a memory efficient data structure when they have a # small number of entries, and the biggest entry does not exceed a given # threshold. These thresholds can be configured using the following directives. hash-max-listpack-entries 512 hash-max-listpack-value 64 # Lists are also encoded in a special way to save a lot of space. # The number of entries allowed per internal list node can be specified # as a fixed maximum size or a maximum number of elements. # For a fixed maximum size, use -5 through -1, meaning: # -5: max size: 64 Kb \u0026lt;-- not recommended for normal workloads # -4: max size: 32 Kb \u0026lt;-- not recommended # -3: max size: 16 Kb \u0026lt;-- probably not recommended # -2: max size: 8 Kb \u0026lt;-- good # -1: max size: 4 Kb \u0026lt;-- good # Positive numbers mean store up to _exactly_ that number of elements # per list node. # The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size), # but if your use case is unique, adjust the settings as necessary. list-max-listpack-size -2 # Lists may also be compressed. # Compress depth is the number of quicklist ziplist nodes from *each* side of # the list to *exclude* from compression. The head and tail of the list # are always uncompressed for fast push/pop operations. Settings are: # 0: disable all list compression # 1: depth 1 means \u0026#34;don\u0026#39;t start compressing until after 1 node into the list, # going from either the head or tail\u0026#34; # So: [head]-\u0026gt;node-\u0026gt;node-\u0026gt;...-\u0026gt;node-\u0026gt;[tail] # [head], [tail] will always be uncompressed; inner nodes will compress. # 2: [head]-\u0026gt;[next]-\u0026gt;node-\u0026gt;node-\u0026gt;...-\u0026gt;node-\u0026gt;[prev]-\u0026gt;[tail] # 2 here means: don\u0026#39;t compress head or head-\u0026gt;next or tail-\u0026gt;prev or tail, # but compress all nodes between them. # 3: [head]-\u0026gt;[next]-\u0026gt;[next]-\u0026gt;node-\u0026gt;node-\u0026gt;...-\u0026gt;node-\u0026gt;[prev]-\u0026gt;[prev]-\u0026gt;[tail] # etc. list-compress-depth 0 # Sets have a special encoding in just one case: when a set is composed # of just strings that happen to be integers in radix 10 in the range # of 64 bit signed integers. # The following configuration setting sets the limit in the size of the # set in order to use this special memory saving encoding. set-max-intset-entries 512 # Similarly to hashes and lists, sorted sets are also specially encoded in # order to save a lot of space. This encoding is only used when the length and # elements of a sorted set are below the following limits: zset-max-listpack-entries 128 zset-max-listpack-value 64 # HyperLogLog sparse representation bytes limit. The limit includes the # 16 bytes header. When an HyperLogLog using the sparse representation crosses # this limit, it is converted into the dense representation. # # A value greater than 16000 is totally useless, since at that point the # dense representation is more memory efficient. # # The suggested value is ~ 3000 in order to have the benefits of # the space efficient encoding without slowing down too much PFADD, # which is O(N) with the sparse encoding. The value can be raised to # ~ 10000 when CPU is not a concern, but space is, and the data set is # composed of many HyperLogLogs with cardinality in the 0 - 15000 range. hll-sparse-max-bytes 3000 # Streams macro node max size / items. The stream data structure is a radix # tree of big nodes that encode multiple items inside. Using this configuration # it is possible to configure how big a single node can be in bytes, and the # maximum number of items it may contain before switching to a new node when # appending new stream entries. If any of the following settings are set to # zero, the limit is ignored, so for instance it is possible to set just a # max entries limit by setting max-bytes to 0 and max-entries to the desired # value. stream-node-max-bytes 4096 stream-node-max-entries 100 # Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in # order to help rehashing the main Redis hash table (the one mapping top-level # keys to values). The hash table implementation Redis uses (see dict.c) # performs a lazy rehashing: the more operation you run into a hash table # that is rehashing, the more rehashing \u0026#34;steps\u0026#34; are performed, so if the # server is idle the rehashing is never complete and some more memory is used # by the hash table. # # The default is to use this millisecond 10 times every second in order to # actively rehash the main dictionaries, freeing memory when possible. # # If unsure: # use \u0026#34;activerehashing no\u0026#34; if you have hard latency requirements and it is # not a good thing in your environment that Redis can reply from time to time # to queries with 2 milliseconds delay. # # use \u0026#34;activerehashing yes\u0026#34; if you don\u0026#39;t have such hard requirements but # want to free memory asap when possible. activerehashing yes # The client output buffer limits can be used to force disconnection of clients # that are not reading data from the server fast enough for some reason (a # common reason is that a Pub/Sub client can\u0026#39;t consume messages as fast as the # publisher can produce them). # # The limit can be set differently for the three different classes of clients: # # normal -\u0026gt; normal clients including MONITOR clients # replica -\u0026gt; replica clients # pubsub -\u0026gt; clients subscribed to at least one pubsub channel or pattern # # The syntax of every client-output-buffer-limit directive is the following: # # client-output-buffer-limit \u0026lt;class\u0026gt; \u0026lt;hard limit\u0026gt; \u0026lt;soft limit\u0026gt; \u0026lt;soft seconds\u0026gt; # # A client is immediately disconnected once the hard limit is reached, or if # the soft limit is reached and remains reached for the specified number of # seconds (continuously). # So for instance if the hard limit is 32 megabytes and the soft limit is # 16 megabytes / 10 seconds, the client will get disconnected immediately # if the size of the output buffers reach 32 megabytes, but will also get # disconnected if the client reaches 16 megabytes and continuously overcomes # the limit for 10 seconds. # # By default normal clients are not limited because they don\u0026#39;t receive data # without asking (in a push way), but just after a request, so only # asynchronous clients may create a scenario where data is requested faster # than it can read. # # Instead there is a default limit for pubsub and replica clients, since # subscribers and replicas receive data in a push fashion. # # Note that it doesn\u0026#39;t make sense to set the replica clients output buffer # limit lower than the repl-backlog-size config (partial sync will succeed # and then replica will get disconnected). # Such a configuration is ignored (the size of repl-backlog-size will be used). # This doesn\u0026#39;t have memory consumption implications since the replica client # will share the backlog buffers memory. # # Both the hard or the soft limit can be disabled by setting them to zero. client-output-buffer-limit normal 0 0 0 client-output-buffer-limit replica 256mb 64mb 60 client-output-buffer-limit pubsub 32mb 8mb 60 # Client query buffers accumulate new commands. They are limited to a fixed # amount by default in order to avoid that a protocol desynchronization (for # instance due to a bug in the client) will lead to unbound memory usage in # the query buffer. However you can configure it here if you have very special # needs, such us huge multi/exec requests or alike. # # client-query-buffer-limit 1gb # In some scenarios client connections can hog up memory leading to OOM # errors or data eviction. To avoid this we can cap the accumulated memory # used by all client connections (all pubsub and normal clients). Once we # reach that limit connections will be dropped by the server freeing up # memory. The server will attempt to drop the connections using the most # memory first. We call this mechanism \u0026#34;client eviction\u0026#34;. # # Client eviction is configured using the maxmemory-clients setting as follows: # 0 - client eviction is disabled (default) # # A memory value can be used for the client eviction threshold, # for example: # maxmemory-clients 1g # # A percentage value (between 1% and 100%) means the client eviction threshold # is based on a percentage of the maxmemory setting. For example to set client # eviction at 5% of maxmemory: # maxmemory-clients 5% # In the Redis protocol, bulk requests, that are, elements representing single # strings, are normally limited to 512 mb. However you can change this limit # here, but must be 1mb or greater # # proto-max-bulk-len 512mb # Redis calls an internal function to perform many background tasks, like # closing connections of clients in timeout, purging expired keys that are # never requested, and so forth. # # Not all tasks are performed with the same frequency, but Redis checks for # tasks to perform according to the specified \u0026#34;hz\u0026#34; value. # # By default \u0026#34;hz\u0026#34; is set to 10. Raising the value will use more CPU when # Redis is idle, but at the same time will make Redis more responsive when # there are many keys expiring at the same time, and timeouts may be # handled with more precision. # # The range is between 1 and 500, however a value over 100 is usually not # a good idea. Most users should use the default of 10 and raise this up to # 100 only in environments where very low latency is required. hz 10 # Normally it is useful to have an HZ value which is proportional to the # number of clients connected. This is useful in order, for instance, to # avoid too many clients are processed for each background task invocation # in order to avoid latency spikes. # # Since the default HZ value by default is conservatively set to 10, Redis # offers, and enables by default, the ability to use an adaptive HZ value # which will temporarily raise when there are many connected clients. # # When dynamic HZ is enabled, the actual configured HZ will be used # as a baseline, but multiples of the configured HZ value will be actually # used as needed once more clients are connected. In this way an idle # instance will use very little CPU time while a busy instance will be # more responsive. dynamic-hz yes # When a child rewrites the AOF file, if the following option is enabled # the file will be fsync-ed every 4 MB of data generated. This is useful # in order to commit the file to the disk more incrementally and avoid # big latency spikes. aof-rewrite-incremental-fsync yes # When redis saves RDB file, if the following option is enabled # the file will be fsync-ed every 4 MB of data generated. This is useful # in order to commit the file to the disk more incrementally and avoid # big latency spikes. rdb-save-incremental-fsync yes # Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good # idea to start with the default settings and only change them after investigating # how to improve the performances and how the keys LFU change over time, which # is possible to inspect via the OBJECT FREQ command. # # There are two tunable parameters in the Redis LFU implementation: the # counter logarithm factor and the counter decay time. It is important to # understand what the two parameters mean before changing them. # # The LFU counter is just 8 bits per key, it\u0026#39;s maximum value is 255, so Redis # uses a probabilistic increment with logarithmic behavior. Given the value # of the old counter, when a key is accessed, the counter is incremented in # this way: # # 1. A random number R between 0 and 1 is extracted. # 2. A probability P is calculated as 1/(old_value*lfu_log_factor+1). # 3. The counter is incremented only if R \u0026lt; P. # # The default lfu-log-factor is 10. This is a table of how the frequency # counter changes with a different number of accesses with different # logarithmic factors: # # +--------+------------+------------+------------+------------+------------+ # | factor | 100 hits | 1000 hits | 100K hits | 1M hits | 10M hits | # +--------+------------+------------+------------+------------+------------+ # | 0 | 104 | 255 | 255 | 255 | 255 | # +--------+------------+------------+------------+------------+------------+ # | 1 | 18 | 49 | 255 | 255 | 255 | # +--------+------------+------------+------------+------------+------------+ # | 10 | 10 | 18 | 142 | 255 | 255 | # +--------+------------+------------+------------+------------+------------+ # | 100 | 8 | 11 | 49 | 143 | 255 | # +--------+------------+------------+------------+------------+------------+ # # NOTE: The above table was obtained by running the following commands: # # redis-benchmark -n 1000000 incr foo # redis-cli object freq foo # # NOTE 2: The counter initial value is 5 in order to give new objects a chance # to accumulate hits. # # The counter decay time is the time, in minutes, that must elapse in order # for the key counter to be divided by two (or decremented if it has a value # less \u0026lt;= 10). # # The default value for the lfu-decay-time is 1. A special value of 0 means to # decay the counter every time it happens to be scanned. # # lfu-log-factor 10 # lfu-decay-time 1 ########################### ACTIVE DEFRAGMENTATION ####################### # # What is active defragmentation? # ------------------------------- # # Active (online) defragmentation allows a Redis server to compact the # spaces left between small allocations and deallocations of data in memory, # thus allowing to reclaim back memory. # # Fragmentation is a natural process that happens with every allocator (but # less so with Jemalloc, fortunately) and certain workloads. Normally a server # restart is needed in order to lower the fragmentation, or at least to flush # away all the data and create it again. However thanks to this feature # implemented by Oran Agra for Redis 4.0 this process can happen at runtime # in a \u0026#34;hot\u0026#34; way, while the server is running. # # Basically when the fragmentation is over a certain level (see the # configuration options below) Redis will start to create new copies of the # values in contiguous memory regions by exploiting certain specific Jemalloc # features (in order to understand if an allocation is causing fragmentation # and to allocate it in a better place), and at the same time, will release the # old copies of the data. This process, repeated incrementally for all the keys # will cause the fragmentation to drop back to normal values. # # Important things to understand: # # 1. This feature is disabled by default, and only works if you compiled Redis # to use the copy of Jemalloc we ship with the source code of Redis. # This is the default with Linux builds. # # 2. You never need to enable this feature if you don\u0026#39;t have fragmentation # issues. # # 3. Once you experience fragmentation, you can enable this feature when # needed with the command \u0026#34;CONFIG SET activedefrag yes\u0026#34;. # # The configuration parameters are able to fine tune the behavior of the # defragmentation process. If you are not sure about what they mean it is # a good idea to leave the defaults untouched. # Active defragmentation is disabled by default # activedefrag no # Minimum amount of fragmentation waste to start active defrag # active-defrag-ignore-bytes 100mb # Minimum percentage of fragmentation to start active defrag # active-defrag-threshold-lower 10 # Maximum percentage of fragmentation at which we use maximum effort # active-defrag-threshold-upper 100 # Minimal effort for defrag in CPU percentage, to be used when the lower # threshold is reached # active-defrag-cycle-min 1 # Maximal effort for defrag in CPU percentage, to be used when the upper # threshold is reached # active-defrag-cycle-max 25 # Maximum number of set/hash/zset/list fields that will be processed from # the main dictionary scan # active-defrag-max-scan-fields 1000 # Jemalloc background thread for purging will be enabled by default jemalloc-bg-thread yes # It is possible to pin different threads and processes of Redis to specific # CPUs in your system, in order to maximize the performances of the server. # This is useful both in order to pin different Redis threads in different # CPUs, but also in order to make sure that multiple Redis instances running # in the same host will be pinned to different CPUs. # # Normally you can do this using the \u0026#34;taskset\u0026#34; command, however it is also # possible to this via Redis configuration directly, both in Linux and FreeBSD. # # You can pin the server/IO threads, bio threads, aof rewrite child process, and # the bgsave child process. The syntax to specify the cpu list is the same as # the taskset command: # # Set redis server/io threads to cpu affinity 0,2,4,6: # server_cpulist 0-7:2 # # Set bio threads to cpu affinity 1,3: # bio_cpulist 1,3 # # Set aof rewrite child process to cpu affinity 8,9,10,11: # aof_rewrite_cpulist 8-11 # # Set bgsave child process to cpu affinity 1,10,11 # bgsave_cpulist 1,10-11 # In some cases redis will emit warnings and even refuse to start if it detects # that the system is in bad state, it is possible to suppress these warnings # by setting the following config which takes a space delimited list of warnings # to suppress # # ignore-warnings ARM64-COW-BUG ","date":"2023-09-08T21:15:20+08:00","permalink":"https://dev.leiyanhui.com/docker/redis/","title":"docker 创建redis 集群 以及tls等"},{"content":"先说openwrt作为路由器 我们需要的功能，以及debian下的替代方案\n拨号 和 网络转发 dhcp 这是路由器的基本功能 不用多说 科学 太多选择了，v2raya 是一个不错的选择 都比较简单易用 ddns 有很多其他的选择 端口转发nat转发 iptable/nftable 都是通用的 UPnP miniupnpd ipv6 wide-dhcpv6-client 参考：\nhttps://blog.bling.moe/post/3/\n","date":"2023-09-07T01:15:20+08:00","permalink":"https://dev.leiyanhui.com/mq/debian-router/","title":"debian做路由器的思考"},{"content":"gnet 是一个高性能的golang 网络io,性能和xlang java c++ 的几个框架一起占在网络框架的天花板上。并多次位居榜首。\n但是gnet的文档不太全，有一些小坑需要一点时间排查。\n按照gnet的例子创建的http serv 在api调试工具 curl 浏览器 都没啥问题，但是在miropython的urequests库下却有问题。看了gnet部分，不想轻易去修改，因为性能在目前项目场景下真的太重要了。 看了一下urequests.py感觉不好直接修改，但是参考了一下自己实现一个客户端还是没问题的。miropython的代码嘛，在设备里面运行，只要没有bug能跑起来就可以，不用太操心性能问题，毕竟设备都卖给用户了，占用的性能也不是咱们的。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 import usocket # 目标服务器信息 #host = \u0026#34;10.1.1.75\u0026#34; #port = 8084 #url = \u0026#34;/devs/?cid=xxx\u0026#34; # timeout =1 def HttpGet(host,port,url,timeout): try: # 创建 socket 连接 s = usocket.socket(usocket.AF_INET, usocket.SOCK_STREAM) addr = usocket.getaddrinfo(host, port)[0][-1] s.connect(addr) # 构建 GET 请求 request = \u0026#34;GET {url} HTTP/1.1\\r\\nHost: {host}\\r\\nUser-Agent: myUrequests\\r\\n\\r\\n\u0026#34;.format(url=url, host=host) s.send(request) # 发送请求 response = b\u0026#34;\u0026#34; # 接收响应 s.settimeout(timeout) # 设置超时时间为x秒 while True: try: data = s.recv(4096) if not data: break response += data except OSError: break # 关闭 socket 连接 s.close() # 解析响应数据 headers, body = response.split(b\u0026#39;\\r\\n\\r\\n\u0026#39;, 1) content_length = 0 for header in headers.split(b\u0026#39;\\r\\n\u0026#39;): if header.startswith(b\u0026#39;Content-Length:\u0026#39;): content_length = int(header.split(b\u0026#39;:\u0026#39;)[1]) break return body[:content_length].decode() except: print(\u0026#34;http get错误\u0026#34;) return \u0026#34;\u0026#34; def HttpsGet(host, port, url, timeout): import ussl import select import time # 创建 socket 连接 s = usocket.socket(usocket.AF_INET, usocket.SOCK_STREAM) addr = usocket.getaddrinfo(host, port)[0][-1] s.connect(addr) # 使用 SSL 加密连接 s = ussl.wrap_socket(s, server_hostname=host) # 设置超时时间 s.setblocking(False) # 构建 GET 请求 request = \u0026#34;GET {url} HTTP/1.1\\r\\nHost: {host}\\r\\nUser-Agent: myUrequests\\r\\n\\r\\n\u0026#34;.format(url=url, host=host) s.write(request.encode()) # 发送请求 # 等待响应数据 response = b\u0026#34;\u0026#34; start_time = time.time() while True: ready = select.select([s], [], [], 0.1) # 每次等待 0.1 秒钟 if ready[0]: try: data = s.read(4096) if data: response += data else: break except OSError: break # 检查超时 elapsed_time = time.time() - start_time if elapsed_time \u0026gt;= timeout: break # 关闭 socket 连接 s.close() # 解析响应数据 headers, body = response.split(b\u0026#39;\\r\\n\\r\\n\u0026#39;, 1) content_length = 0 for header in headers.split(b\u0026#39;\\r\\n\u0026#39;): if header.startswith(b\u0026#39;Content-Length:\u0026#39;): content_length = int(header.split(b\u0026#39;:\u0026#39;)[1]) break return body[:content_length].decode() def AutoHttpGet(url, timeout): try: # 解析URL parts = url.split(\u0026#39;://\u0026#39;) scheme = parts[0] remaining = parts[1].split(\u0026#39;/\u0026#39;, 1) host_port = remaining[0].split(\u0026#39;:\u0026#39;) if len(host_port) == 1: #默认端口 host = host_port[0] port = 443 if scheme == \u0026#39;https\u0026#39; else 80 else:#自定义端口 host = host_port[0] port = int(host_port[1]) path = \u0026#39;/\u0026#39; + remaining[1] if len(remaining) \u0026gt; 1 else \u0026#39;/\u0026#39; query = \u0026#39;\u0026#39; if \u0026#39;?\u0026#39; in path: path, query = path.split(\u0026#39;?\u0026#39;, 1) query = \u0026#39;?\u0026#39; + query print(scheme,host, port, path + query) if scheme == \u0026#39;https\u0026#39;: return HttpsGet(host, port, path + query, timeout) else: return HttpGet(host, port, path + query, timeout) except: print(\u0026#34;自动http/s get错误\u0026#34;) return \u0026#34;\u0026#34; ","date":"2023-09-07T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/lot/mpy-get/","title":"miropython urequests和gnet的兼容性问题"},{"content":"大量物联网设备数据上报，可以选择 常用的 mqtt coAP等方法。 我这里采用自定义协议，设备在线状态检测用的tcp长连接，数据上报用用tcp短连接和长连接智能匹配的方案。\n至于为什么没用mqtt,还是从服务器带宽和运维成本考虑的。\n本文主要说数据储存的方案。\n传统的数据库 肯定无法满足如此庞大并发的写入量，所以目光先放到了时序数据库上。\n因为对golang更为喜欢，所以首先想到用InlfuxDB。 但是新版集群功能不开源且收费。 然后看到国产的lotDB 已经进入Apache 孵化项目，但是在测试的时候发现 lotDB 的原生接口，golang 和C++ 的均有问题。虽然lotDB在简中上口碑不错，并且到处都是和inlfuxDB做对比的文章。但是这个问题让我感觉到一丝的担忧。而没有找到那些吹lotDB的文章对mqtt和REST接口的性能测试。于是不再打算考虑lotDB。\n其实开发语言不是重点，因为我们几乎不太可能会对源码进行太多修改，主要还是性能和高可用性。\n在看了部分源码后，突然想到，是否应该自己做一个具有简单网络功能的支持集群的简单伪时序数据库.\n在考虑到多数c/s数据库均无法应对如此大量数据写入，目光放到sqlite。经过测试，在老项目上进行一些简单优化后单库的sqlite 可以轻松实现每秒200+万条的写入速度。这个速度感觉有搞头。\n那么剩下的问题，就是 集群部署的情况下 数据的同步 备份 等问题，以及网络写入和查询实现。\n最后测试 sqlite实现结果 因为每次上报的数据 只有1-几十条，无法有效的利用事务来插入数据。 导致实际使用体验非常糟糕。\n然后尝试了 几个 lsm-tree kv 的本地嵌入式数据库。在多键值的情况下 会导致文件数量非常恐怖。给异地部署的集群带来很多大的维护压力。\n中间过程不表，为了追求好的性能最低的成本，反复折腾很久。\n最后的简单方案 最后，选择了一种最为简单方便的方案。\n设备上报的日志，在经过简单的验证去重后，追加写入到本地文本文件。并在文件超过一定大小后自动按照时间戳切割文件。并将文件压缩同步到云储存。\n为了避免上云容易下云难这个蛋疼的情况，云储存采用rclone（支持s3和hdfs） 用压缩方式挂载到本地进程同步。\n这样20几行代码就搞定了这个功能需求。\n查询的时候，根据时间范围选择 云注册内不同时间戳的文件即可。\n因rclone负责后端云储存通讯和压缩。所以在我们的程序上，只需要实作本地已经解压的文件即可。由于文件采用的简单的追加方式，所以单个设备的多个时间范围的日志也可以进行简单的合并。\n为什么没用csv是因为感觉没啥必要了，直接用文本储存原始数据更简单一些。\n优点 天然支持高可用性伪集群（集群之间不需要通讯） 代码逻辑简单 性能可靠 临时文件可以放到ramfs ，可以精确控制内存大小 可以简单的合并文件 可以简单的粗略删除旧数据 不用去维护时序数据库 方案的缺点 压缩算法 因为压缩功能交给了rclone,那么就受到rclone的限制只能用gzip格式。但是好在 one设备one文件，单个文件体积不大，大并发情况多个利用率高，所以也解决gzip单线程压缩性能的问题。 压缩率 没有办法和 zstd比这个。\n集群部署单设备数据离散问题 需要锁定设备的对应的节点，比如在设备上报数据的节点，不能让他任意选择，否则在多个节点轮流上报数据。而节点上是通过文件大小来转储存数据的，这就导致有可能会有时序混乱。\n需要另外实现实时数据查询 因为这个方案只有数据超过一定量的后的储存功能，如果要查询实时数据需要另外的方案来来实现。\n","date":"2023-09-02T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/lot/tsdb-select/","title":"物联网设备上报数据储存方案  时序数据库的替代方案的折腾过程"},{"content":"可以打一个nat背后的端口出来。 单纯查询自己的公网ip,用stun意义不大。不如多个在线查询 轮流 get。\n纯记录\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/ccding/go-stun/stun\u0026#34; ) func main() { client := stun.NewClient() client.SetServerHost(\u0026#34;stun.syncthing.net\u0026#34;, 3478) nat, host, err := client.Discover() fmt.Println(\u0026#34;nat\u0026#34;, nat) if err != nil { fmt.Println(\u0026#34;无法获取公网IP:\u0026#34;, err) return } if host == nil { fmt.Println(\u0026#34;可能是无法连接到主机\u0026#34;) return } fmt.Println(\u0026#34;host\u0026#34;, host.IP()) fmt.Println(\u0026#34;host String\u0026#34;, host.String()) } 国内三个可用的：\nstun.qq.com\nstun.miwifi.com\nstun.syncthing.net\n","date":"2023-08-29T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/stun-pubip/","title":"golang 使用 stun获取自己的公网ip，以及临时可用的公网端口"},{"content":"最新 2022年的 排名： https://www.techempower.com/benchmarks/#section=data-r21\u0026test=plaintext\n可以看到 前30 之间性能差距都很小，选择一个适合自己的即可。\ngo语言的gnet 从第一掉到第九，但是也可看到 依旧在第一梯队和第一pico.v（v语言） 是pivo.v的99.8% 微乎其微\n但是不得不说 aspcore和 aspcore-mono\t都 真的很强 just-js 也很强 99.3% 排名\n长江后浪推前浪，Netty，Nginx等的老牌大牛排名都非常靠后。Netty排名64，Nginx排名109，分别只能达到排名第一的框架性能的57.2%和28.8%。\ngo语言的gin 的排名在 190多\u0026hellip;\n没想到v语言的这个新生语言，牛逼不是一直吹的。\n仔细看了一下，里面很多国人开发的框架\n因为云部署，所以我这里 依旧选择golang, 老项目依旧坚持 net 不动摇，需要重构的逐步切换到gnet。新项目无脑gnet了。\n至于框架和语言的选择，还是选择适合的。netty构建的老项目 也没必要去轻易换。\n","date":"2023-08-27T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/mq/io-select/","title":"网络IO框架 的选择"},{"content":"简单的实现，但是完成了 发布和订阅 ack 的操作\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 package main import ( \u0026#34;ac_file\u0026#34; \u0026#34;context\u0026#34; \u0026#34;do_redis\u0026#34; \u0026#34;do_time\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/redis/go-redis/v9\u0026#34; ) var ( cfgCommon []byte redisDb redis.UniversalClient ctx = context.Background() ) func init() { cfgCommon = ac_file.Get_serv_cfg_local_and_redis(cfgCommon) //从本机和redis按照策略更新和获取配置文件 redisDb = do_redis.GetRedisDb_Client(cfgCommon) } func main() { // 发布消息到指定 Stream _, err := redisDb.XAdd(ctx, \u0026amp;redis.XAddArgs{ Stream: \u0026#34;mystream\u0026#34;, // Stream 名称 Values: map[string]interface{}{ \u0026#34;key1\u0026#34;: \u0026#34;value1\u0026#34;, \u0026#34;key2\u0026#34;: \u0026#34;value2\u0026#34;, }, }).Result() if err != nil { fmt.Println(\u0026#34;Failed to publish message:\u0026#34;, err) return } // 创建消费者组 groupName := \u0026#34;mygroup\u0026#34; //\t_, err := redisDb.XGroupCreateMkStream(ctx, \u0026#34;mystream\u0026#34;, groupName, \u0026#34;$\u0026#34;).Result() //_, err = redisDb.XGroupCreate(ctx, \u0026#34;mystream\u0026#34;, groupName, \u0026#34;$\u0026#34;).Result() //$ 是从末尾开始接受 _, err = redisDb.XGroupCreate(ctx, \u0026#34;mystream\u0026#34;, groupName, \u0026#34;0\u0026#34;).Result() //0 是从头开始 if err != nil { fmt.Println(\u0026#34;Failed to create consumer group:\u0026#34;, err) } time.Sleep(2 * time.Second) // 创建一个新的消息处理协程 go sub_get() // 在主协程中等待退出信号 select {} } func sub_get() { for { pubsub := redisDb.XReadGroup(ctx, \u0026amp;redis.XReadGroupArgs{ Group: \u0026#34;mygroup\u0026#34;, Consumer: \u0026#34;test\u0026#34;, Streams: []string{\u0026#34;mystream\u0026#34;, \u0026#34;\u0026gt;\u0026#34;}, //Streams: []string{\u0026#34;mystream\u0026#34;, \u0026#34;0-0\u0026#34;}, Count: 2, Block: 0, }) messages, err := pubsub.Result() if err != nil { fmt.Println(\u0026#34;Failed to read from stream:\u0026#34;, err) continue } for _, msg := range messages[0].Messages { fmt.Printf(\u0026#34;Consumer %s received message from Stream %s with ID: %s, data: %v\\n\u0026#34;, \u0026#34;test\u0026#34;, messages[0].Stream, msg.ID, msg.Values) // 确认已处理消息 _, err := redisDb.XAck(ctx, \u0026#34;mystream\u0026#34;, \u0026#34;mygroup\u0026#34;, msg.ID).Result() if err != nil { fmt.Println(\u0026#34;Failed to acknowledge message:\u0026#34;, err) } /* else { // 从 messages 切片中移除已处理的消息 messages[0].Messages = messages[0].Messages[1:] } */ } } } ","date":"2023-08-19T05:14:20+08:00","permalink":"https://dev.leiyanhui.com/mq/redis-stream-mq/","title":"golang  stream 和redis之间实现订阅和发送的"},{"content":"实现 从redis单节点或者整个集群导出导入数据到json文件。\nredis-dump 也可以有同样的功能的，他已经5年多不更新了 而且 只支持有限的数据类型，更不支持 Cluster。\n没啥技术含量，花了30分钟写完。\n也可以导入到mysql,文末有参考（未测试，这部分代码由chatGPT完成）\n特性和基本算法： 支持集群和单节点 和主从模式，因为我一直没用过哨兵集群，所以未测试，理论上也支持。\n支持10种redis数据类型，详情看代码 因为主要是为了 cluster模式，从节点可能太多，所以数据直接从主节点导出。 如果是单机模式/主从/哨兵模式，会直接导出。如果是 cluster 模式，会先查询出主节点，然后依次连接主节点导出（不连接从节点 是因为从节点太多，再去每一个节点选一个从节点太复杂也没必要） 导出 : 先判断是不是集群，如果不是，直接扫描所有key 依次导出。如果是集群 找到主节点，依次扫描所有key 导出。\n导入：直接按照类型导入即可，集群会自己分片\n代码 一些代码里面没有的说明 do_redis 只是连接redis集群去了，GetRedisDb_Client 的 代码参考：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 redis_addr_arr := strings.Split(redis_addr, \u0026#34;,\u0026#34;)//redis_addr 是集群的每一个节点的ip:端口。如果是单节点 就一个即可 if len(redis_addr_arr) \u0026gt; 1 { //连接到集群 redisClient := redis.NewClusterClient(\u0026amp;redis.ClusterOptions{ Addrs: redis_addr_arr, Password: redis_psw, }) }else{ redisClient := redis.NewClient(\u0026amp;redis.Options{ //连接到单点 Addr: redis_addr, Password: redis_psw, DB: 0, }) } redis_Clusterpsw =\u0026#34;12332434\u0026#34; 完整代码 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 package main import ( \u0026#34;ac_file\u0026#34; \u0026#34;coder\u0026#34; \u0026#34;context\u0026#34; \u0026#34;do_redis\u0026#34; \u0026#34;do_time\u0026#34; \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/redis/go-redis/v9\u0026#34; ) var ( cfgCommon []byte redisDb redis.UniversalClient redisDb_back redis.UniversalClient ctx = context.Background() nowTimestamp int64 ) func init() { cfgCommon = ac_file.Get_serv_cfg_local_and_redis(cfgCommon) //从本机和redis按照策略更新和获取配置文件 redisDb = do_redis.GetRedisDb_Client(cfgCommon) redisDb_back = do_redis.GetRedisBackDb_Client(cfgCommon) go do_time.NowTimestamp(\u0026amp;nowTimestamp) //秒 时间戳定时器 避免程序多次调用 } func main() { Save_toJson(\u0026#34;redis_db_date.json\u0026#34;, redisDb) //load_from_json(\u0026#34;redis_db_date.json\u0026#34;, redisDb) load_from_json(\u0026#34;redis_db_date.json\u0026#34;, redisDb_back) //fmt.Println(\u0026#34;操作完成\u0026#34;) } func load_from_json(filename string, db redis.UniversalClient) { data, err := os.ReadFile(filename) if err != nil { fmt.Println(\u0026#34;Error reading file:\u0026#34;, err) return } restore_redis_db(data, db) } func Save_toJson(filename string, db redis.UniversalClient) { var redis_db_date []byte // 判断客户端是否连接到 Redis 集群 if _, ok := db.(*redis.ClusterClient); ok { // 获取集群节点信息 stateCmd := db.ClusterNodes(context.Background()) state, err := stateCmd.Result() if err != nil { log.Println(err) } redis_Clusterpsw := coder.JsonGetStr(cfgCommon, \u0026#34;redis\u0026#34;, \u0026#34;db\u0026#34;, \u0026#34;password\u0026#34;) //单独配置一下密码 // 解析主节点信息 lines := strings.Split(state, \u0026#34;\\n\u0026#34;) for _, line := range lines { fields := strings.Fields(line) if len(fields) \u0026gt; 2 \u0026amp;\u0026amp; (fields[2] == \u0026#34;master\u0026#34; || fields[2] == \u0026#34;myself,master\u0026#34;) { nodeAddr := fields[1] add := strings.Split(nodeAddr, \u0026#34;@\u0026#34;) masterClient := redis.NewClient(\u0026amp;redis.Options{ Addr: add[0], Password: redis_Clusterpsw, }) redis_db_dateThis := back_redis_db(masterClient) var m1 = make(map[string]interface{}) var m2 = make(map[string]interface{}) if len(redis_db_date) \u0026gt; 0 { err := json.Unmarshal(redis_db_date, \u0026amp;m1) if err != nil { log.Println(\u0026#34;redis_db_date\u0026#34;, err) } } if len(redis_db_dateThis) \u0026gt; 0 { err := json.Unmarshal(redis_db_dateThis, \u0026amp;m2) if err != nil { log.Println(\u0026#34;redis_db_dateThis\u0026#34;, add[0], err) } } if len(m2) \u0026gt; 0 { // 合并两个映射 for k, v := range m2 { m1[k] = v } } mergedData, err := json.Marshal(m1) // 将合并后的映射重新编码为 JSON 字符串 if err != nil { log.Println(\u0026#34;mergedData\u0026#34;, err) } else { redis_db_date = mergedData } masterClient.Close() } } } else { redis_db_date = back_redis_db(db) } var tmp_data interface{} // 创建一个空接口用于解析 JSON 数据 errJson := json.Unmarshal(redis_db_date, \u0026amp;tmp_data) if errJson != nil { fmt.Println(\u0026#34;redis_db_date 解析 JSON 失败:\u0026#34;, errJson) } else { formattedJSON, err := json.MarshalIndent(tmp_data, \u0026#34;\u0026#34;, \u0026#34; \u0026#34;) // 格式化 JSON 数据 if err != nil { fmt.Println(\u0026#34;redis_db_date 格式化 JSON 失败:\u0026#34;, err) } else { redis_db_date = formattedJSON } } err := os.WriteFile(filename, redis_db_date, 0644) if err != nil { fmt.Println(\u0026#34;Error writing file:\u0026#34;, err) return } } func restore_redis_db(jsonData []byte, db redis.UniversalClient) { // 解析导出的 JSON 数据 var importedData map[string]interface{} err := json.Unmarshal(jsonData, \u0026amp;importedData) if err != nil { fmt.Println(\u0026#34;Error unmarshalling JSON data:\u0026#34;, err) return } // 遍历导入的数据并根据类型将其存储到 Redis for key, value := range importedData { dataMap, ok := value.(map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid data format for key %s\\n\u0026#34;, key) continue } dataType, ok := dataMap[\u0026#34;type\u0026#34;].(string) if !ok { fmt.Printf(\u0026#34;Invalid data type for key %s\\n\u0026#34;, key) continue } dataValue, ok := dataMap[\u0026#34;value\u0026#34;] if !ok { fmt.Printf(\u0026#34;Invalid data value for key %s\\n\u0026#34;, key) continue } switch dataType { case \u0026#34;string\u0026#34;: err := db.Set(ctx, key, dataValue.(string), 0).Err() if err != nil { fmt.Printf(\u0026#34;Error setting value for key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;list\u0026#34;: err := db.RPush(ctx, key, dataValue.([]interface{})...).Err() if err != nil { fmt.Printf(\u0026#34;Error pushing values to list key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;hash\u0026#34;: hashValues, ok := dataValue.(map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid hash values for key %s\\n\u0026#34;, key) continue } err := db.HMSet(ctx, key, hashValues).Err() if err != nil { fmt.Printf(\u0026#34;Error setting hash values for key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;set\u0026#34;: err := db.SAdd(ctx, key, dataValue.([]interface{})...).Err() if err != nil { fmt.Printf(\u0026#34;Error adding values to set key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;zset\u0026#34;: zsetValues, ok := dataValue.([]map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid sorted set values for key %s\\n\u0026#34;, key) continue } var zsetEntries []redis.Z for _, zsetValue := range zsetValues { scoreStr, ok := zsetValue[\u0026#34;score\u0026#34;].(string) if !ok { fmt.Printf(\u0026#34;Invalid sorted set entry score for key %s\\n\u0026#34;, key) continue } score, err := strconv.ParseFloat(scoreStr, 64) if err != nil { fmt.Printf(\u0026#34;Error parsing score for key %s: %v\\n\u0026#34;, key, err) continue } member, ok := zsetValue[\u0026#34;value\u0026#34;].(string) if !ok { fmt.Printf(\u0026#34;Invalid sorted set entry member for key %s\\n\u0026#34;, key) continue } zsetEntries = append(zsetEntries, redis.Z{ Score: score, Member: member, }) } err := db.ZAdd(ctx, key, zsetEntries...).Err() if err != nil { fmt.Printf(\u0026#34;Error adding values to sorted set key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;bitmaps\u0026#34;: bitmapsValues, ok := dataValue.(int64) if !ok { fmt.Printf(\u0026#34;Invalid bitmaps values for key %s\\n\u0026#34;, key) continue } err := db.SetBit(ctx, key, 0, int(bitmapsValues)).Err() if err != nil { fmt.Printf(\u0026#34;Error setting bitmaps values for key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;hyperloglogs\u0026#34;: hyperloglogsValues, ok := dataValue.([]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid hyperloglogs values for key %s\\n\u0026#34;, key) continue } err := db.PFAdd(ctx, key, hyperloglogsValues...).Err() if err != nil { fmt.Printf(\u0026#34;Error setting hyperloglogs values for key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;geospatial\u0026#34;: geospatialValues, ok := dataValue.(map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid geospatial values for key %s\\n\u0026#34;, key) continue } var geoLocation []*redis.GeoLocation for member, coordinates := range geospatialValues { coordinateMap, ok := coordinates.(map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid geospatial coordinate for key %s\\n\u0026#34;, key) continue } longitudeStr, ok := coordinateMap[\u0026#34;longitude\u0026#34;].(string) if !ok { fmt.Printf(\u0026#34;Invalid geospatial longitude for key %s\\n\u0026#34;, key) continue } latitudeStr, ok := coordinateMap[\u0026#34;latitude\u0026#34;].(string) if !ok { fmt.Printf(\u0026#34;Invalid geospatial latitude for key %s\\n\u0026#34;, key) continue } longitude, err := strconv.ParseFloat(longitudeStr, 64) if err != nil { fmt.Printf(\u0026#34;Error parsing longitude for key %s: %v\\n\u0026#34;, key, err) continue } latitude, err := strconv.ParseFloat(latitudeStr, 64) if err != nil { fmt.Printf(\u0026#34;Error parsing latitude for key %s: %v\\n\u0026#34;, key, err) continue } geoLocation = append(geoLocation, \u0026amp;redis.GeoLocation{ Name: member, Longitude: longitude, Latitude: latitude, }) } err := db.GeoAdd(ctx, key, geoLocation...).Err() if err != nil { fmt.Printf(\u0026#34;Error adding values to geospatial key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;bitfield\u0026#34;: bitfieldValues, ok := dataValue.(string) if !ok { fmt.Printf(\u0026#34;Invalid bitfield values for key %s\\n\u0026#34;, key) continue } err := db.BitField(ctx, key, bitfieldValues).Err() if err != nil { fmt.Printf(\u0026#34;Error setting bitfield values for key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;stream\u0026#34;: streamEntries, ok := dataValue.([]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid stream entries for key %s\\n\u0026#34;, key) continue } db.Del(ctx, key) // 这里需要根据情况判断是否应该先删掉 对应的key 不然原来key内stream有更大的id大的数据的情况下无法写入更小id的数据 for _, entry := range streamEntries { entryMap, ok := entry.(map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid stream entry for key %s\\n\u0026#34;, key) continue } streamID, ok := entryMap[\u0026#34;ID\u0026#34;].(string) if !ok { fmt.Printf(\u0026#34;Invalid stream ID for key %s\\n\u0026#34;, key) continue } streamValues, ok := entryMap[\u0026#34;Values\u0026#34;].(map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid values for stream entry with ID %s\\n\u0026#34;, streamID) continue } err := db.XAdd(ctx, \u0026amp;redis.XAddArgs{ Stream: key, ID: streamID, Values: streamValues, }).Err() if err != nil { fmt.Printf(\u0026#34;Error adding entry to stream key %s: %v\\n\u0026#34;, key, err) } } default: fmt.Printf(\u0026#34;Unsupported data type for key %s\\n\u0026#34;, key) } } } func back_redis_db(db redis.UniversalClient) (jsonData []byte) { // 获取所有键 keys := db.Keys(ctx, \u0026#34;*\u0026#34;).Val() // 创建一个空的 map 用于存储结果 result := make(map[string]interface{}) // 遍历键并获取对应的值和类型 for _, key := range keys { dataType := db.Type(ctx, key).Val() // 根据不同的数据类型获取值 switch dataType { case \u0026#34;string\u0026#34;: value := db.Get(ctx, key).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: value, } case \u0026#34;list\u0026#34;: values := db.LRange(ctx, key, 0, -1).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: values, } case \u0026#34;hash\u0026#34;: values := db.HGetAll(ctx, key).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: values, } case \u0026#34;set\u0026#34;: values := db.SMembers(ctx, key).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: values, } case \u0026#34;zset\u0026#34;: values := db.ZRange(ctx, key, 0, -1).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: values, } case \u0026#34;bitmaps\u0026#34;: value := db.GetBit(ctx, key, 0).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: value, } case \u0026#34;hyperloglogs\u0026#34;: value := db.PFCount(ctx, key).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: value, } case \u0026#34;geospatial\u0026#34;: values := db.GeoRadius(ctx, key, 0, 0, \u0026amp;redis.GeoRadiusQuery{Unit: \u0026#34;km\u0026#34;}).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: values, } case \u0026#34;bitfield\u0026#34;: value := db.BitField(ctx, key, \u0026#34;GET\u0026#34;, \u0026#34;u4\u0026#34;, \u0026#34;0\u0026#34;).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: value, } case \u0026#34;stream\u0026#34;: streamValues := db.XRange(ctx, key, \u0026#34;-\u0026#34;, \u0026#34;+\u0026#34;).Val() result[key] = map[string]interface{}{ \u0026#34;type\u0026#34;: dataType, \u0026#34;value\u0026#34;: streamValues, } default: fmt.Printf(\u0026#34;Unsupported data type for key %s\\n\u0026#34;, key) } } // 将结果转换为 JSON 格式 jsonData, err := json.MarshalIndent(result, \u0026#34;\u0026#34;, \u0026#34; \u0026#34;) if err != nil { fmt.Println(\u0026#34;Error marshalling data to JSON:\u0026#34;, err) return } return } 导入导出到mysql 未经测试，也实在没必要\n数据库结构\n1 2 3 4 5 6 7 CREATE TABLE mytable ( id INT AUTO_INCREMENT PRIMARY KEY, `key` VARCHAR(255) NOT NULL, `type` VARCHAR(50) NOT NULL, value VARCHAR(255), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ); 代码部分\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 func back_redis_db() { // 查询MySQL中的数据 rows, err := mysqlDb.Query(\u0026#34;SELECT key, type, value FROM mytable\u0026#34;) if err != nil { fmt.Println(\u0026#34;Error querying MySQL:\u0026#34;, err) return } defer rows.Close() // 遍历查询结果并根据类型将数据存储到Redis for rows.Next() { var key, dataType string var value sql.NullString err := rows.Scan(\u0026amp;key, \u0026amp;dataType, \u0026amp;value) if err != nil { fmt.Println(\u0026#34;Error scanning MySQL rows:\u0026#34;, err) continue } if !value.Valid { fmt.Printf(\u0026#34;Invalid value for key %s\\n\u0026#34;, key) continue } switch dataType { case \u0026#34;string\u0026#34;: err := redisDb.Set(ctx, key, value.String, 0).Err() if err != nil { fmt.Printf(\u0026#34;Error setting value for key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;list\u0026#34;: // 查询MySQL中的列表值并将其存储到Redis listValues, err := mysqlDb.Query(\u0026#34;SELECT value FROM mytable WHERE key = ? AND type = ?\u0026#34;, key, dataType) if err != nil { fmt.Printf(\u0026#34;Error querying list values for key %s: %v\\n\u0026#34;, key, err) continue } defer listValues.Close() var values []interface{} for listValues.Next() { var v string err := listValues.Scan(\u0026amp;v) if err != nil { fmt.Printf(\u0026#34;Error scanning list values for key %s: %v\\n\u0026#34;, key, err) continue } values = append(values, v) } err = redisDb.RPush(ctx, key, values...).Err() if err != nil { fmt.Printf(\u0026#34;Error pushing values to list key %s: %v\\n\u0026#34;, key, err) } // 其他数据类型的处理类似... default: fmt.Printf(\u0026#34;Unsupported data type for key %s\\n\u0026#34;, key) } } err = rows.Err() if err != nil { fmt.Println(\u0026#34;Error iterating MySQL rows:\u0026#34;, err) } } func restore_mysql_db(jsonData []byte) { // 解析导出的 JSON 数据 var importedData map[string]interface{} err := json.Unmarshal(jsonData, \u0026amp;importedData) if err != nil { fmt.Println(\u0026#34;Error unmarshalling JSON data:\u0026#34;, err) return } // 遍历导入的数据并根据类型将其存储到MySQL for key, value := range importedData { dataMap, ok := value.(map[string]interface{}) if !ok { fmt.Printf(\u0026#34;Invalid data format for key %s\\n\u0026#34;, key) continue } dataType, ok := dataMap[\u0026#34;type\u0026#34;].(string) if !ok { fmt.Printf(\u0026#34;Invalid data type for key %s\\n\u0026#34;, key) continue } dataValue, ok := dataMap[\u0026#34;value\u0026#34;] if !ok { fmt.Printf(\u0026#34;Invalid data value for key %s\\n\u0026#34;, key) continue } switch dataType { case \u0026#34;string\u0026#34;: _, err = mysqlDb.Exec(\u0026#34;INSERT INTO mytable (key, type, value) VALUES (?, ?, ?)\u0026#34;, key, dataType, dataValue.(string)) if err != nil { fmt.Printf(\u0026#34;Error inserting value for key %s: %v\\n\u0026#34;, key, err) } case \u0026#34;list\u0026#34;: values := dataValue.([]interface{}) for _, v := range values { _, err = mysqlDb.Exec(\u0026#34;INSERT INTO mytable (key, type, value) VALUES (?, ?, ?)\u0026#34;, key, dataType, v.(string)) if err != nil { fmt.Printf(\u0026#34;Error inserting value for key %s: %v\\n\u0026#34;, key, err) } } // 其他数据类型的处理类似... default: fmt.Printf(\u0026#34;Unsupported data type for key %s\\n\u0026#34;, key) } } } ","date":"2023-08-18T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/mq/redis-json/","title":"redis集群一键导入到json以及 从json导出"},{"content":"本文只针对笔者自己的项目情况，不使用redis，而且使用更专业的消息队列服务器的存在有更充分的理由。\n选择的原因 性能天花板 从树莓派到志强，redis是所有mq服务器的天花板。\n自己手撸的简单hash map查询 业务添加一些 都比不过redis，而且在大量数据的情况下，查询和操作速度更是直线下滑。想做到极致的性能优化需要大量繁重工作，不如直接拿来就用\n简单灵活的高可用性集群 哨兵模式和主从模式也不是不能用。\ncluster 虽然必须要最少3主3从才能实现高可用性，但是很容易满足。3台云服务器即可 互为主从 并集群，可以在线扩容，在线收缩，简单灵活可靠。\n低流量消耗的轻量化协议 redis 是基于tcp的简单文本协议，没有协议头，没有校验码，没有封装，每一个字节都是有效必须的数据，大大节省服务器带宽资源\n活跃的老项目良好的向上兼容 redis至今依旧维持较为频繁的功能和性能更新\n免中间件 1、工作量小 服务器上不需要再运行太多程序，开发工作小很多（在大并发环境一个中间件 真的很需要时间调试优化）\n2、节省服务器开支\n性能下限高 团队里面的实习生，只要不让他碰redis扩展module的代码，再烂的代码也不会影响整体运行\n不用更专业的mq的原因 现有的主流mq服务， 性能都低于redis,在集群扩展上也都远远不如redis灵活和高效。\n部分mq自带的消息持久化储存 性能更是一般，外部储存方式 多了一层转换。很多mq可能已经很轻量，但是相对 redis 还是差了一些。 Kafka RocketMQ Apollo ZeroMQ ActiveMQ RabbitMQ emqx Mosquitto 情况差不多，不展开细说\n集群方面，要么死板复杂不能热扩容收缩，要么集群后单机性能会掉\n不使用 loTDB的原因 没有看到loTDB的压测数据，自己简单测试过后性能不理想\n不自己开发私有协议的原因 私有协议 可以灵活使用 tcp/udp 包括上层websocket。但是集群部署 还有大量map的操作 开发工作量比较大。\n另外 golang在 大并发情况下 资源占用要比C高很多，引入epoll可以降低一些，但是开发工作量还是不低。\n物联网设备通讯要求 基本 包括多数物联网设备的的要求 我手上的项目情况有以下要求：\n低成本、可快速扩展、高可用性集群 部分功能要求消息必须送达：例如 报警信息 部分消息 要求 只可以送达1次，不可重复送达：例如 提醒消息 部分数据允许少量丢失: 例如设备实时采集的数据 设备24小时开机，不停上报数据。对服务器处理和记录能力有一定要求（最主要是服务器成本要低） 设备离线通知和报警 设备和用户app可以直接进行通讯，当然 这里指的还是服务器转发消息 qps的严格限制，防止服务器被拉垮 部分功能需要 tls加密通讯 消息需要选择性的持久化和转存 tcp和udp 国内环境下 部分地区部分时段udp 丢包严重。另外udp每次都需要带一定字数的token信息 虽然减少了握手环节，但是对于 少量频繁的数据通讯 就会明显增加服务器流量开支\nws协议，有更好，没有可以接受，毕竟物联网设备直接tcp udp是没问题的。\n自定义协议和现有协议的选择 自定义协议tcp/udp 自然是更好，但是之前的项目开发经验让我明白 还是要权衡利弊一下。\n数据的序列化和反序列化 考虑到服务器资源的占用，json 肯定是最不可取的。msgpack反序列化性能还可以，但是比json并不能降低太多带宽。 所以开发阶段用json或者msgpack,后期还是要换成protobuf。\n用redis实现上面的功能的逐一说明 因为redis 本身不适合作为面向用户的消息队列服务，所以有一些问题需要额外处理。\n使用redis6.0 以后的tls 解决加密通讯 务必使用redis7.0以后版本的 acl 精确控制到key和指令 使用stream 处理 必到达的消息 和 之发送一次的消息 使用sub 处理一次性不需要储存 可以容许丢失的消息 redis开启数据持久化，但是后端需要定期把历史消息转储存到sql，防止redis内的历史消息占用内存多大 集群 cluster 解决高可用性和灵活扩展性 redis 集群客户端 在物联网设备 和 app端 socket 手撸。使用{key}标识符，把单一个物联网设备的数据固定到一个节点上即可，然后客户端自动从任意一个节点得到负责的节点地址。 设备离线通知： 后端程序 连到redis 定时扫描 客户端连接信息，找出应在线但是未连接的客户端 关于权限控制和防恶意用户 key访问权限和指令限制：使用redis7.0以后版本的 acl 限制 物联网客户端可用指令和可写key 后端程序 通过扫描redis客户端信息，拉黑频繁多次连接的用户 key 内容大小限制：简单的方案 依旧是后端程序定期扫描bigkey。我的方案，自己开发一个简单的redis 模块 来限制，比如 用 lyh.get 限制客户端请求太大的字符串 key lyh.set限制 写入太大的数据 客户端qps限制：1是后端定时扫描 hot key 找到异常用户 拉黑 2、自定义模块 创建全局hash map记录用户操作频率 进行限制 其他安全措施 毕竟redis 不是设计为了面向非可信用户的mq服务器。 一些防患措施还是是要做一下。\n配置 maxmemory-clients 并经常监控 tls和明文tcp 都使用，优先使用tls,在负载过大情况下，临时切换到明文，并紧急扩容集群。 为了避免可能的安全隐患，客户端应该预留一组redis服务器地址： 这组服务器 应该由可以过滤转发tcp指令的程序反代redis 在redis出现未知漏洞的情况下使用 关键性指令 重命名 或者禁用掉 redis 使用普通无ssh权限的用户运行 iptable，限制单ip连接频率和连接数 如果内容很重要，记得定时备份 redis的持久化文件 核心数据如果使用redis储存，需要和客户端可以访问的redis 做隔离。 优点 1、高性能\n2、高可用性\n3、高扩展性\n4、没有中间件，只有后台整理和维护件，后端工作量很少\n5、低服务器成本，cpu、内存、带宽占用都不会太高\n最后说一下缺点 在嵌入式设备上 因为没有支持redis集群的客户端（甚至部分环境也没有可用的redis客户端），需要自己实现 ，不过因为我们允许这部分客户端能使用指令很少，所以并不复杂。知道redis 就是 命令+换行 来通讯的就够了 需要redis自定义模块 进行高阶防护 不过真的不难，尤其是对熟悉C的嵌入式开发人员，当然其他语言也可以 云厂商的redis通常不可以导入自定义模块 redis目前不支持websocket 官方说后续有可能会支持，在确实需要的情况下可以起一个后端程序转发ws到redis\ngolang实现的：https://dev.leiyanhui.com/golang/ws-redis/\n官方进展关注: https://github.com/orgs/redis/projects/4/views/1?filterQuery=http\u0026pane=issue\u0026itemId=24785018 redis目前不支持auth验证次数限制 8年了还没添加的功能 ，8年后的今天我们依旧需要自己在防火墙限制过滤auth指令\n官方进展关注：https://github.com/redis/redis/pull/1241 redis目前不能避免单一用户多次连接，需要自己后端扫描，官方没有支持计划,暂时可以用iptable略微临时限制 和后台扫描。我已经自己修改完成redis的自动离线重复登陆的用户 目前运行良好。 redis目前不能尽快自动踢出 没有进行 auth 的空连接 ，暂时只能自己在iptable限制，不过根据我的使用 多数mq服务器 都不支持。 redis acl的持久化在rdb/aof文件中，目前是可以手动保持到acl文本文件的，不过这里有一个pull 是 等待批准 状态 https://github.com/redis/redis/pull/10369 redis auth 没有防止穷举的措施 目前暂时没有解决办法，客户端可以在一秒内发起几万次auth请求，拖垮redis，只能等待官方更新 https://github.com/redis/redis/pull/11554 权衡后 因为现有app和小程序端，依赖http/ws协议，不能直接连接redis 所以app端是无法直接引入，通过服务器端口搭建ws转发到redis又再次引入了中间件 auth 指令没有使用限制，以及 auth之前不能通过自定义模块的方式来替代auth,所以导致此问题 除了修改redis源码和等待官方更新之外，可以通过防火墙适当防止一下，然后暂时无解（云厂商的公网redis一般直接限制了最大连接数）\n","date":"2023-08-18T05:14:20+08:00","permalink":"https://dev.leiyanhui.com/mq/redis-mq/","title":"redis 替代 mqtt 和自定义协议 作为物联网设备通讯的 可行性"},{"content":"有时候 我们的集群可能只是为了高可用，数据并不是那么大，那么可以不用aof rdp 直接导出虽然慢一些但是json可能更直观\nredis-dump 不好用，所以为 自己写了一个 ： https://dev.leiyanhui.com/mq/redis-json/\n安装 基于debian12\n1 2 sudo apt install ruby ruby-dev gcc sudo gem install redis-dump 确定节点分别情况 1 CLUSTER NODES 暂停你redis的写入业务 或者你容许部分丢失的话，也无所谓\n分别导出每一个节点的数据 1 2 3 4 redis-dump -u:ut97WiD9SvUQtJ@127.0.0.1:6001 \u0026gt; /tmp/6001.json redis-dump -u:ut97WiD9SvUQtJ@127.0.0.1:6001 -d 0 \u0026gt; 6001.json redis-dump -u:ut97WiD9SvUQtJ@127.0.0.1:6002 -d 0 \u0026gt; 6002.json redis-dump -u:ut97WiD9SvUQtJ@127.0.0.1:6003 -d 0 \u0026gt; 6003.json 如果运行的时候出错，可能需要安装rvm和新版ruby。或者直接用docker版的\n所以 。。。可能直接 scp 回来更方便\n","date":"2023-08-16T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/redis-dump/","title":"redis 整个集群导出到json的方法"},{"content":"redis目前最新版本7.2 依旧不支持websocket.不过看核心团队已经准备开始支持。\nwebsocket 更容易部署到servless等场景，也更加容易通过cdn 防火墙之类的管理。\n用golang可以简单的反向代理过去。\n因为逻辑简单，所以性能还是很强的。只是增加了多于的网络的开支。在目前情况下 过渡使用是没有问题的。\n另外有一个国人写的 用go实现的redis： https://github.com/HDT3213/godis 可以简单的修改为ws\n不过目前还不支持 steam 。\n当然目前没有可用的 客户端，需要自己手撸。但是命令直接转发效果是一样的。\n下面是一个简单的实现，你也可以完成AUTH部分 方便使用acl。\n这样反代后 对 不支持 集群的客户端 也非常友好\n客户端测试\n1 2 3 4 \u0026gt; wscat -c ws://localhost:8080/websocket Connected (press CTRL+C to quit) \u0026gt; set wstest 123 \u0026lt; OK 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 package main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;github.com/gorilla/websocket\u0026#34; \u0026#34;github.com/redis/go-redis/v9\u0026#34; ) var redisClient *redis.ClusterClient func init() { // 初始化Redis集群客户端 redisClient = redis.NewClusterClient(\u0026amp;redis.ClusterOptions{ Addrs: []string{\u0026#34;localhost:6001\u0026#34;, \u0026#34;localhost:6002\u0026#34;, \u0026#34;localhost:6003\u0026#34;, \u0026#34;localhost:6004\u0026#34;, \u0026#34;localhost:6005\u0026#34;, \u0026#34;localhost:6006\u0026#34;}, // 替换为真实的Redis节点地址 Password: \u0026#34;ut97WiD9SvUQtJ\u0026#34;, // 替换为你的Redis密码 }) } func main() { http.HandleFunc(\u0026#34;/websocket\u0026#34;, handleWebSocket) log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil)) } func handleWebSocket(w http.ResponseWriter, r *http.Request) { // 升级HTTP连接为WebSocket连接 upgrader := websocket.Upgrader{} conn, err := upgrader.Upgrade(w, r, nil) if err != nil { log.Println(\u0026#34;WebSocket upgrade failed:\u0026#34;, err) return } defer conn.Close() for { // 读取WebSocket消息 _, msg, err := conn.ReadMessage() if err != nil { log.Println(\u0026#34;WebSocket read failed:\u0026#34;, err) break } // 转发请求到Redis集群 inputArgs := strings.Fields(string(msg)) args := make([]interface{}, len(inputArgs)) for i, v := range inputArgs { args[i] = v } res, err := redisClient.Do(context.Background(), args...).Result() if err != nil { log.Println(\u0026#34;Redis publish failed:\u0026#34;, err) conn.WriteMessage(websocket.TextMessage, []byte(err.Error())) break } fmt.Println(\u0026#34;res\u0026#34;, res) fmt.Printf(\u0026#34;Received message: %s\\n\u0026#34;, msg) // 发送响应给WebSocket客户端 err = conn.WriteMessage(websocket.TextMessage, []byte(res.(string))) if err != nil { log.Println(\u0026#34;WebSocket write failed:\u0026#34;, err) break } } } ","date":"2023-08-15T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/ws-redis/","title":"redis走websocket的方法"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 package main import ( \u0026#34;fmt\u0026#34; ) var isDebug string = \u0026#34;debug\u0026#34; func main() { fmt.Println(\u0026#34;isDebug \u0026#34;, isDebug) if isDebug == \u0026#34;debug\u0026#34; { fmt.Println(\u0026#34;Debug information\u0026#34;) } } 编译命令\n1 2 3 4 # 允许fmt.Println go build -ldflags=\u0026#34;-X main.isDebug=debug\u0026#34; main.go # 不允许fmt.Println go build -ldflags=\u0026#34;-X main.isDebug=其他字符\u0026#34; main.go -X 控制的必须是变量，常量不可， -X 控制的变量只能是 string ","date":"2023-07-28T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/build-fmt-print/","title":"golang编译后的可执行文件不打印fmt的方法/golang条件编译"},{"content":"makefile 参考\n1 2 3 4 5 .PHONY: buildandrun BIN_FILE := $(shell basename $(CURDIR)) buildandrun: go build -ldflags \u0026#39;-s -w -linkmode \u0026#34;external\u0026#34; -extldflags \u0026#34;-static\u0026#34;\u0026#39; -o \u0026#34;${BIN_FILE}\u0026#34; ${BIN_FILE}.go #./\u0026#34;${BIN_FILE}\u0026#34; 其他相关命令\n1 2 @CGO_ENABLED=1 go build -o \u0026#34;${BIN_FILE}\u0026#34; ${BIN_FILE}.go ldd --version # 查看 glibc 版本ldd (Debian GLIBC 2.36-9) 2.36 在静态编译的时候可能会提示 cgo_unix_cgo.cgo2.c:58: 警告：Using 'getaddrinfo' in statically linked applications requires at runtime the shared libraries from the glibc version used for linkin\n就是因为使用了 getaddrinfo函数。\n静态链接应用程序时，依赖于 glibc 的其他功能可能会导致类似的警告。确保在进行任何更改之前，仔细检查应用程序的所有依赖，并确保它们与系统中提供的 glibc 版本兼容。\n","date":"2023-07-24T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/build-glibc/","title":"golang静态编译 以及glibc相关"},{"content":"pulseaudio 1 2 sudo apt install pulseaudio sudo apt install pavucontrol 不用创建服务，可以直接跟随i3启动和重载,i3配置\n1 exec_always --no-startup-id killall pulseaudio \u0026amp;\u0026amp; pulseaudio pipewire 可以不用安装PulseAudio,直接使用安装 pipewire即可\n1 sudo apt install pipewire 包含：\nlibpipewire-0.3-0 libpipewire-0.3-common libpipewire-0.3-modules libspa-0.2-modules ibwireplumber-0.4-0 pipewire-bin pipewire-pulse rtkit wireplumber 可选：\nlibspa-0.2-bluetooth pulseaudio-utils wireplumber-doc\n可能需要：\n1 apt install wireplumber pipewire-media-session- 另外装一个面板工具\n1 sudo apt install pavucontrol 普通用户启动\n1 systemctl --user --now enable wireplumber.service 有问题的时候重启 1 2 sudo systemctl restart pipewire systemctl --user --now enable wireplumber.service 对比 日常使用没啥感觉，在部分硬件上 pulseaudio下存在颤音，pipewire同样存在。 并且pipewire在设备长时间待机的时候 会无声音，需要重启服务\n","date":"2023-07-22T00:00:20+08:00","permalink":"https://dev.leiyanhui.com/linux/pipewire-debian/","title":"debian12 pipewire  i3安装配置"},{"content":"以qq为例\n1 2 wget linuxqq官网地址 chmod +x linuxqq_*.AppImage 我这里选择直接安装到当前用户下 先确保 .bashrc 下有 export PATH=\u0026quot;$PATH:/home/用户名/.local/bin\u0026quot;\n1 mv linuxqq_*.AppImage ~/.local/bin/qq 这样就可以在rofi 或者shell之里面 直接输入qq启动 了，但是在rofi列表里面看不到。 创建一个快捷方式就好了，还是放到当前用户下\n1 2 3 4 5 6 7 8 9 10 11 cd ~/.local/share/applications cat qq.desktop ============================== [Desktop Entry] Name=qqnt Comment=linuxqq Exec=qq #Icon=qq Terminal=false Type=Application Categories=Developer 简单 不需要多说\n","date":"2023-07-21T00:00:20+08:00","permalink":"https://dev.leiyanhui.com/linux/appimages/","title":"rofi启动appimages 并显示在rofi的列表中"},{"content":"提供简单加密的mpy模块，可以放到固件内部，也可以手动上传到flash。\n在主程序或者boot.py调用后，会禁用repl 和 repl的文件管理功能,并在repl上提示输入密码。采用严格的密码放置爆破功能，哪怕6位数字都无法爆破。\n兼容webrepl\n特性 可以在 usb口的repl 上加上密码，同时webrepl也会增加密码 无密码的情况下，relp口只可以显示打印信息，无法执行python命令，更加无法查看flash内文件 输入密码后，不重启的情况下不需要再次输入密码 可以集成到固件内 可以随意选择在随意boot.py 或者 main.py加载 可以限制密码尝试间隔，并在N次后增加重试间隔时间，简单的密码也很难通过爆破来绕过 依赖：micropython time 和 _thread 三个库 获取和使用 下载 mpy 放到flash 内 或者固件内部均可。 下载地址：https://github.com/joyanhui/file.leiyanhui.com/raw/main/esp32/repl_psw.mpy 暂时不开源，需要源码的请联系 joyanhui@qq.com\n修改你的boot.py 或main.py 使得代码保护在开机后可以马上运行。下面是一个 boot.py的演示\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import _thread # 后台运行 main.py 的 run() 函数 def background_run(): import main main.run() _thread.start_new_thread(background_run, ()) import repl_psw # (input正确的密码,msg请输入密码,msg密码正确,msg密码错误,msg你想干啥,参数错误无法保护了哦,msg休息一下吧,time密码错误重试间隔时间,times重试几次后强制休息,tims强制休息时间间隔) # 后面三个参数都是int哦，时间都是秒为单位的哦 其他参数都是字符串并且不能为空哦 # 为了方便你调试，如果参数类型错误 就直接跳过 不保护了，所以务必保证参数类型都正确 # repl_psw模块大概需要占用1.2kb的内存 。 repl_psw.authenticate(\u0026#34;111\u0026#34;,\u0026#34;请输入密码：\u0026#34;,\u0026#34;ok密码正确\u0026#34;,\u0026#34;err密码错误，请重新输入。\u0026#34;,\u0026#34;你想干啥？\u0026#34;,\u0026#34;参数类型错误肯定就无法保护了哦\u0026#34;,\u0026#34;别试了休息一会吧\u0026#34;,1,3,15) main.py的代码应该是你的业务逻辑部分，简单的一个实例如下\n1 2 3 4 5 6 7 8 9 from machine import Pin import time led = Pin(15, Pin.OUT) def run(): while True: led.on() time.sleep(0.5) led.off() time.sleep(0.5) 其他建议 上面的演示代码只是提供了一个简单的例子，实际使用的时候，密码最好与设备的mac地址或token关联 或者从单独的授权服务器获取，做到一机一密 在esp8266 等内存较少的micropython设备上，使用 _thread 可能比较奢侈，请自己选择是否使用 repl_psw模块大概需要占用1.2kb的内存 。 repl 的加密，只能一定程度上保护代码，只是提供简单灵活的方式防止别人直接窥视你的代码。无法避免绕过repl直接从物理层面下手的 建议 核心代码还是用c来写，并不是非常核心的代码 编译成mpy放到固件内部。 如果代码安全性要求非常高，还是要用加密芯片的昂。\n","date":"2023-07-18T00:00:20+08:00","permalink":"https://dev.leiyanhui.com/mcu/mpy-repl-psw/","title":"micropython在usb和web的repl都添加密码，一定程度上保护密码"},{"content":"2024-03-7 已经有原生版微信，虽然目前之支持uos和麒麟等系统，实际上其他系统也可以用。\n2022年12月07日 腾讯已经发布新版linux qq 因为各个版本的 都存在封号情况，目前只有deepin wine版本 尚可\n1 2 3 4 wget -O- https://deepin-wine.i-m.dev/setup.sh | sh sudo apt install com.qq.weixin.deepin com.qq.im.deepin ## 如无法发送照片 sudo apt install libjpeg62:i386 启动命令\n1 /opt/apps/com.qq.weixin.deepin/files/run.sh 在i3 下有黑框影响观感，但是不影响使用。\n","date":"2023-07-11T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/debian-wechat/","title":"debian12 安装微信 "},{"content":"如果设备不多，可以接受只一个设备 的话，可以使用 virtualhere 这个的免费版本。但是免费版之能连接一个设备，收费版本价格不低。\n如果是双linux的话，可以用usbip直接处理。\n我设备在win电脑上，linux电脑来连接。 所以采取 virtualbox 运行一个 alpine,然后共享usb设备出来的方案。\nvirtualbox 添加usb设备进去 alpine安装 配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 apk add linux-tools-usbip # 注意要打开 community源 modprobe usbip-core usbip-host vhci-hcd # 内核要支持， 不能加载话 需要安装完整的alpine 不要用 virt的内核 # 写入到 /etc/modules 每次开机自启 # 查询模块加载情况 lsmod | grep usbip # 查看usb设备 usbip list -l usbipd -D \u0026amp; # 启动服务， # 把usb设备添加到usbip中去：可以添加多个 # 2-1就是上面的编号 $ usbip bind -b 2-1 # 解除绑定usb设备 usbip unbind -b 2-1 客户端 linux-debian # 如果是在容器中的，记得从宿主机器加载 并映射过来\n1 2 3 4 5 6 sudo modprobe usbip-core usbip-host vhci-hcd lsmod | grep usbip sudo apt install usbip lsusb # sudo apt install usbutils sudo usbip list -r 10.1.1.215 # 查看 sudo usbip attach -r 10.1.1.215 -b 2-1 ","date":"2023-07-07T11:02:20+08:00","permalink":"https://dev.leiyanhui.com/linux/usbip/","title":" usb 设备网络共享方案（免费） win=\u003e linux"},{"content":"debian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp\n没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。\n本文说明 joyanhui/debian-i3-xrdp-novnc 使用docker 和 lxc/lxd ，本文可能会滞后最新，更多问题问题请查看docker和lxd的使用手册。\n如果您没有使用过i3 openbox lxc等软件，务必仔细阅读本文，至少会让你熟悉了解相关操作。\n特性 轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。\n是一个完整的操作系统，systemd可正常使用，甚至可以再次安装docker\nvnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3 采用docker 运行lxd的方法 alpine3.18.2 =\u0026gt; lxd 集成软件：\ndebian 12 bookworm i3 openbox polybar rofi alacritty dunst zsh firefox-esr thunar gvfs gvfs-backends gvfs-fuse sshfs tigervnc novnc websockify ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji 微软雅黑 服务管理支持：systemd supervisor 更新记录和计划 公开的搭建过程 如果你使用的旧版请查看旧版说明\n安装 1 2 3 docker run -itd --restart=always --name dt --hostname dt --privileged=true \\ -p 3389:3389 -p 222:22 -p 2222:2222 -p 8080:8080 -p 5900-5905:5900-5905 -v /mnt:/mnt \\ joyanhui/debian-i3-xrdp-novnc sh /boot.sh 3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900 ，222 是alpine容器的ssh端口\n20230707 之前版本是纯docker实现，不包含浏览器和文件管理器，之后的版本是lxd lxc实现 并带firefox-esr 和thunar 网络挂载 并支持 systemd。\n默认账号 以及相关用户名和密码 总共有三个密码：\ndebian的系统用户 用户名：yanhui 密码：1 （只有一个数字1）\n这个用户名密码，同时对应debian的 ssh xrdp 的默认账号 对应默认端口：2222 和 3389 debian默认的root 没设置密码，禁止ssh登陆\n1 2 3 # 修改密码 docker exec -it dt lxc exec dt /bin/bash passwd yanhui debian的vnc的密码 vnc 密码：111111（六个数字1）\n此密码用于vnc 和novnc登陆 默认用户yanhui的桌面\n1 2 3 4 # 修改密码 docker exec -it dt lxc exec dt /bin/bash su yanhui vncpasswd alpine的root账户 用户名 root 密码:1（只有一个数字1）\n此密码同时左右 alpine的ssh登陆密码，对应默认端口：222\n1 2 3 # 修改密码 docker exec -it dt /bin/sh passwd 部署完毕后，务必第一时间修改密码！\n为什么选择debian 而不是arch nixos 因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。\narch和nixos一些其他缺点这里不多说。\n其实最主要的是 不折腾 稳如老狗，以及 个人喜好 以及和服务器端的环境一致性\n为什么用docker 套lxd 不直接用lxd 是因为部分环境不支持，另外docker的分层commit 更方便。 更可以推送到自己的私有regditer\n不直接用docker 是因为 docker 限制太多，不算是太完整的系统，lxc lxd 是一个完整的系统。\n所以20230707版本以后 改为 docker运行alpine 然后在alpine内用lxd运行 debian12\nalpine是一个只有3m大小的linux系统，在用lxd嵌套后，比旧方案多占用30-60M内存，80M硬盘，但是带来的是一个完整的linux体验，并且性能吊打虚拟机模式！\n为什么选择i3 和openbox 怎么换其他桌面 因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。 因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。\n而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面\n更换为其他桌面的方法 例如，要换成 xfce4首先安装sudo apt install xfce4 ,然后修改 ~/.vnc/xstartup 可以更换vnc和novnc的桌面。\n修改用户目录下的 ~/.xsession 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:sudo apt purge i3 or sudo apt purge openbox\nnovnc vnc为什么是黑屏 就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 也没有壁纸，右键 有惊喜！\n怎么启动shell 和常见快捷键 基本是i3 的默认快捷键\n点屏幕顶部的 Apps\u0026gt; 系统 \u0026gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）\n如果是rdp远程桌面下，按下键盘 ： win+回车 启动管理器（开始菜单） :win d\n程序切换 alt+tab 修改窗口大小：按住win 再按住 鼠标右键 来回拖动\n修改窗口位置：按住win 再按住 鼠标左键 来回拖动\n关闭软件：win shift q\n注销：win shift e\n更多使用方法 自己看一下i3 使用说明\n如何从宿主机器直接进去debian shell 两步\n1 2 3 4 5 6 # 进入docker alpine docker exec -it dt /bin/sh # 进入lxc lxc exec dt /bin/bash # 或者直接 docker exec -it dt lxc exec dt /bin/bash 第一个dt 是docker的容器名称，第二个 是lxc 的容器名称\n你也可以在登陆 vnc/xrdp后直接运行\n怎么装中文输入法 1 sudo apt install fcitx5 fcitx5-chinese-addons openbox 需要右键手动加载，其他现代的桌面系统，包括i3。安装完成后，注销重新登录一次桌面，会自动加载，拼音输入法可导入搜狗细胞词库，具体自己研究。\n默认中英文切换快捷键是 ctrl+空格 ，如果你在非全屏的xrdp 或novnc /vnc 下切换，注意和本地的输入法快捷键冲突问题。\n怎么新建用户怎么删除默认用户 新建用户 1 2 sudo adduser YouName sudo usermod -aG sudo YouName 新用户vnc密码 ssh 或者 xrdp 登陆新用户后，运行 vncpasswd\n更新 vnc服务 修改里面的用户名\n1 2 nano /etc/systemd/system/vncserver@0.service nano /etc/supervisor/conf.d/novnc.conf 删除默认用户 1 2 sudo deluser yanhui rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面 怎么修改密码 用户密码 命令：passwd\nvnc密码 命令：vncpasswd .vnc/passwd ，需要重启vnc服务，查看 systemctrl restart vncserver@0\nx11转发模式如何使用输入法 修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 fcitx5\u0026amp; 再执行对应的软件。\nx11 转发模式部分软件很卡 没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。\nnovnc默认地址 http://你的ip:8080/ 其中端口docker内部默认使用8080，外部端口是你自己映射的。\nnovnc如何走https 建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。\nvnc连不上 此问题只在 20230707之前版本存在\n1 rm /tmp/.X0-lock 把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器\n天气预报出错以及如何修改天气预报城市 ~/.config/polybar/weather-plugin.py 这个文件 天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。\n你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）\nhttps://api.openweathermap.org/data/2.5/weather?id=1793724\u0026amp;appid=440b47a5ffbc5421e4a9befcbc4d635b\u0026amp;units=Metric\u0026amp;lang=zh_cn\n你如果不想用，直接在 polybar的配置文件里面删掉即可。\n如何调音量 在i3配置文件里面修改\n调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。\n进阶用法，自己配置i3和polybar\nvnc 和xrdp 桌面不同步 是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。\nnoVNC 网页访问按键失灵乱跳 1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法\n2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。\nxrdp 登陆后桌面灰色无显示 长期无操作后，锁屏了而已。依次盲输入密码然后按下回车 验证成功后 即可登入桌面。\n如果你不需要锁屏功能，可以删掉 sudo apt purge i3lock\n没声音或者 顶部音量不显示 vnc 和x11 没声音 vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp\nxrdp的polybar 偶尔不显示音量 这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。\n临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar\n1 2 killall pulseaudio \u0026amp;\u0026amp; pulseaudio \u0026amp; sh .config/polybar/polybar_run.sh 20230707 以后的版本，可以在polybar顶部菜单用依次点击： APPS \u0026gt; polybar \u0026gt; 重启声音 APPS \u0026gt; polybar \u0026gt; 重载polybar\n如何修改分辨率 vnc novnc 1 /etc/systemd/system/vncserver@0.service # geometry 后面的参数是vnc的分辨率 xrdp xrdp的分辨率 由你的客户端 发起的时候配置\nopenbox的壁纸点好多次才换一张 壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。\n安装常用软件 点屏幕左上角 APPS \u0026gt; 系统 \u0026gt; 终端 输入 sudo apt install \u0026lt;包名\u0026gt;命令；启动软件 APPS \u0026gt; 系统 \u0026gt; rofi-run 选择软件或者输入软件名称\n或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 sudo apt install firefox-esr # 火狐 20230707以后版本自带 sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源 sudo apt install nemo nautilus # 文件管理器 任选一个 20230707以后版本自带 thunar # todesk 中文不显示 需要另外处理，这里不多说 wget https://newdl.todesk.com/linux/todesk-v4.3.1.0-amd64.deb sudo apt-get install ./todesk-v4.3.1.0-amd64.deb #sudo apt purge todesk # 远程其他电脑 sudo apt install freerdp2-x11 #xfreerdp sudo apt install remmina # 可选包 remmina-plugin-x2go # neofetch 命令行装b工具 sudo apt install neofetch # flameshot 截图工具 sudo apt install flameshot # linuxqq wget https://dldir1.qq.com/qqfile/qq/QQNT/ad5b5393/linuxqq_3.1.2-13107_amd64.deb sudo apt-get install ./linuxqq_3.1.2-13107_amd64.deb 如何访问文件 thunar 方式 20230707以后版本集成了thunar 和smb sshfs webdav访问组件。 打开 thunar ，地址栏输入：smb://10.1.1.100 或者dav://10.1.1.100 即可\n文件挂载 参考后文 目录映射 方法\n不喜欢默认用户的shell 默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可\npve lxc ct 或者docker宿主机 目录映射 端口 和显卡等 pve 硬盘到lxc 请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/\ndocker宿主机 目录映射 默认 映射 /mnt/sda1 到最终的debian12 如果要映射其他目录，先映射到docker内，确保早docker内可以访问的情况下在docker内如下命令映射到 lxc\n1 lxc config device add dt sda1 disk source=/mnt/sda1 path=/mnt/sda1 更多使用方法，以及权限问题，请参考lxd手册\n端口 先映射端口到docker,而后在docker内 用如下命令映射到lxc\n1 lxc config device add dt demoName proxy listen=tcp:0.0.0.0:8888 connect=tcp:127.0.0.1:8888 更多使用方法，请参考lxd手册\n如何使用显卡加速 以nvidia为例在创建docker的时候 把显卡挂进去即可\n1 2 3 4 5 docker run .... --device /dev/nvidia0:/dev/nvidia0 \\ --device /dev/nvidiactl:/dev/nvidiactl \\ --device /dev/nvidia-uvm:/dev/nvidia-uvm \\ .... pve 群晖 unraid esxi 下的安装方式 pve下，你可以用lxc/vm 运行docker的方式运行，也可以，从本镜像内提取lxc模板直接导入到 CT容器。 其他系统 建议直接docker运行\n目录和文件说明 /boot.sh 在docker内 其他文件在 debian内\n启动文件 boot.sh /boot.sh 在docker内 用于启动alpine的 ssh 和 lxd/lxc 的debian\nsystemd 和 supervisord systemd 和 supervisord 在 lxc的debian内\nnovnc使用supervisord启动:/etc/supervisor/conf.d/，vnc和其他服务使用systemd启动：/etc/systemd/system/\ni3 配置文件 /home/yanhui/.config/i3/config\nopenbox配置文件 /home/yanhui/.config/openbox/menu.xml #右键菜单 feh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本\n壁纸目录 i3配置文件调用feh随机选 /home/yanhui/.config/i3/bg/\npolybar /home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单 /home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本 /home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。 rofi /home/yanhui/.config/rofi/config.rasi\ndunst /home/yanhui/.config/dunst/dunstrc\nalacritty /home/yanhui/.config/alacritty/alacritty.yml\nzsh /home/yanhui/.zshrc /home/yanhui/.oh-my-zsh\n","date":"2023-07-07T11:02:20+08:00","permalink":"https://dev.leiyanhui.com/docker/debian-desktop/","title":"docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc"},{"content":"未使用Dockerfile 是因为搭建过程略微复杂，如果另外打包出来rootfs 也没有什么意义。所以干脆公开过程。\n本文可能存在滞后，未经过严格整理和核对,所有历史命令，你在 下述文件中均可以看到\n1 2 3 4 docker exec -it dt lxc exec dt cat /root/.bash_history docker exec -it dt lxc exec dt cat /home/yanhui/.bash_history docker exec -it dt lxc exec dt cat /home/yanhui/.zsh_history docker exec -it dt cat /root/.ash_history 宿主用alpine\n1 2 3 docker run -itd --restart=always --name test --hostname test --privileged=true \\ -p 333:3389 -p 2221:2222 -p 2222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt \\ alpine:3.18.2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 docker exec -it test /bin/sh sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata apk add openssh lxd lxd-client lxcfs dbus sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config echo \u0026#34;session optional pam_cgfs.so -c freezer,memory,name=systemd,unified\u0026#34; \u0026gt;\u0026gt; /etc/pam.d/system-login echo \u0026#34;lxc.idmap = u 0 100000 65536\u0026#34; \u0026gt;\u0026gt; /etc/lxc/default.conf echo \u0026#34;lxc.idmap = g 0 100000 65536\u0026#34; \u0026gt;\u0026gt; /etc/lxc/default.conf echo \u0026#34;root:100000:65536\u0026#34; \u0026gt;\u0026gt; /etc/subuid echo \u0026#34;root:100000:65536\u0026#34; \u0026gt;\u0026gt; /etc/subgid echo \u0026#34;systemd_container=yes\u0026#34;\u0026gt;\u0026gt; /etc/conf.d/lxc 1 2 3 4 5 6 7 8 # 处理 启动文件 echo \u0026#34;root:1\u0026#34; | chpasswd # alpine的root密码改为1 # lxc lxd lxcfs dbus echo \u0026#34;/usr/sbin/sshd -D\u0026#34; \u0026gt; /boot.sh echo \u0026#34;lxd \u0026amp;\u0026#34; \u0026gt;\u0026gt; /boot.sh echo \u0026#34;lxc start dt \u0026#34; \u0026gt;\u0026gt; /boot.sh echo \u0026#34;tail -f /dev/null\u0026#34; \u0026gt;\u0026gt; /boot.sh chmod +x /boot.sh 1 2 3 4 5 6 7 lxd \u0026amp; lxd init # 全部默认 除了自动更新那个 lxc launch images:debian/12 dt # 这个错误不影响 ERROR [2023-07-06T21:40:35+08:00] balance: Unable to set cpuset err=\u0026#34;setting cgroup item for the container failed\u0026#34; name=dt value=\u0026#34;0,1,10,11,2,3,4,5,6,7,8,9\u0026#34; lxc config set dt security.privileged true #特权 lxc config get dt security.privileged #检查 lxc info dt 1 2 3 4 5 6 7 8 # 处理端口映射 lxc config device add dt xrdp proxy listen=tcp:0.0.0.0:3389 connect=tcp:127.0.0.1:3389 lxc config device add dt sshd proxy listen=tcp:0.0.0.0:22 connect=tcp:127.0.0.1:2222 lxc config device add dt novnc proxy listen=tcp:0.0.0.0:8080 connect=tcp:127.0.0.1:8080 lxc config device add dt vnc0 proxy listen=tcp:0.0.0.0:5900 connect=tcp:127.0.0.1:5900 lxc config device add dt vnc1 proxy listen=tcp:0.0.0.0:5901 connect=tcp:127.0.0.1:5901 lxc config device add dt sshd proxy listen=tcp:0.0.0.0:2222 connect=tcp:127.0.0.1:22 # 删除 lxc config device remove dt sshd 1 2 # 挂载目录 lxc config device add dt sda1 disk source=/mnt/sda1 path=/mnt/sda1 # 挂载目录 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 # debian内处理 lxc exec dt /bin/bash sed -i \u0026#39;s/deb.debian.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apt/sources.list apt update\u0026amp;\u0026amp;apt upgrade # 基础 apt install -y wget curl nano openssh-server unzip sudo zsh ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # 桌面 apt install i3 openbox # 错误不影响 Failed to try-restart systemd-binfmt.service: Unit systemd-binfmt.service is masked. # 字体 apt install fonts-jetbrains-mono fonts-noto-color-emoji mkdir -p /usr/share/fonts/WindowsFonts \u0026amp;\u0026amp; cd /usr/share/fonts/WindowsFonts wget -c https://ghproxy.com/https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/windows_font/msyh.ttc fc-cache -f dpkg-reconfigure locales # zh_CN.UTF-8 # 常用组件 状态了 图片查看壁纸 终端 任务切换和运行 shell pythone的模块 apt install -y polybar feh dunst alacritty rofi zsh python3-requests # 浏览器和文件管理器 apt install -y firefox-esr thunar # 不需要可以自己删除 ，占用硬盘400多M # thunar网络访问 nas所需要组件 apt install -y gvfs gvfs-backends gvfs-fuse sshfs # 占用硬盘61M openbox下无法使用 # 中文输入法 #apt install -y fcitx5-chinese-addons # 740M # 远程 apt install -y xrdp tigervnc-standalone-server novnc python3-websockify supervisor # 194M # 编译 xrdp 声音 apt install -y pulseaudio apt install -y build-essential dpkg-dev libpulse-dev git autoconf libtool # 此部分组建谨慎删除 apt install -y lsb-release doxygen git clone https://github.com/neutrinolabs/pulseaudio-module-xrdp.git # 基于v0.7 cd pulseaudio-module-xrdp scripts/install_pulseaudio_sources_apt.sh # debian12 用这，另外一个是scripts/install_pulseaudio_sources_apt_wrapper.sh 不兼容debian12 ./bootstrap \u0026amp;\u0026amp; ./configure PULSE_DIR=~/pulseaudio.src make \u0026amp;\u0026amp; make install # 验证 ls $(pkg-config --variable=modlibexecdir libpulse) | grep xrdp # module-xrdp-sink.so 和 module-xrdp-source.so 就是成功了 # 用户名 useradd -ms /bin/bash yanhui echo \u0026#34;yanhui:1\u0026#34; | chpasswd usermod -G sudo yanhui #loginctl enable-linger yanhui # 允许此用户推出登陆后 他的用户服务依旧执行 # 服务处理 vnc 和 novnc # 处理用户 ======== start su yanhui \u0026amp;\u0026amp; cd ~ # vnc 密码 vncpasswd # 默认shell 从 bash转zsh echo \u0026#34;zsh\u0026#34; \u0026gt;\u0026gt; ~/.bashrc # xrdp 默认桌面 echo i3 \u0026gt;/home/yanhui/.xsession # 壁纸 2张 mkdir ~/bg \u0026amp;\u0026amp; cd ~/bg wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/green.jpg wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/bing-jurenzhilu.jpg # zsh cd ~ wget https://github.com/joyanhui/oh-my-zsh/archive/refs/heads/main.zip -O main.zip unzip main.zip \u0026amp;\u0026amp; mv oh-my-zsh-main/.oh-my-zsh . cp oh-my-zsh-main/.zshrc .\u0026amp;\u0026amp; rm main.zip \u0026amp;\u0026amp; rm -rf oh-my-zsh-main/ # i3 配置文件 参考：https://github.com/joyanhui/i3w # polybar 配置文件 参考：https://github.com/joyanhui/i3w # dunst 配置文件 参考：https://github.com/joyanhui/i3w # alacritty 配置文件 参考：https://github.com/joyanhui/i3w # rofi 配置文件 参考：https://github.com/joyanhui/i3w # openbox 配置文件 参考：https://github.com/joyanhui/i3w # user-dirs.dirs 配置文件 参考：https://github.com/joyanhui/i3w echo \u0026#34;openbox\u0026#34; \u0026gt; ~/.vnc/xstartup \u0026amp;\u0026amp; chmod +x ~/.vnc/xstartup # 配置vnc桌面为openbox # 处理用户 ======== end exit # 退回到root # 配置vnc # 参考 /lib/systemd/system/tigervncserver@.service cat \u0026gt; /etc/systemd/system/vncserver@0.service \u0026lt;\u0026lt; \\EOF [Unit] Description=Start TightVNC server at startup After=syslog.target network.target [Service] Type=forking User=yanhui Group=yanhui WorkingDirectory=/home/yanhui PIDFile=/home/yanhui/.vnc/%H:%i.pid ExecStartPre=-/usr/bin/vncserver -kill :%i \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ExecStart=/usr/bin/vncserver -geometry 1900x930 -localhost no :%i ExecStop=/usr/bin/vncserver -kill :%i [Install] WantedBy=multi-user.target EOF # novnc cat \u0026gt; /etc/supervisor/conf.d/novnc.conf \u0026lt;\u0026lt; \\EOF [program:novnc] command= /usr/bin/websockify -D --web=/usr/share/novnc/ 8080 localhost:5900 user=yanhui autorestart=true priority=999 EOF supervisorctl update ln -s /usr/share/novnc/vnc.html /usr/share/novnc/index.html # 首页 systemctl daemon-reload systemctl enable vncserver@0 # 清理 rm -rf /root/pulseaudio* # xrdp 历史文件 #rm /root/.bash_history #rm /home/yanhui/.bash_history #rm /home/yanhui/.zsh_history apt autoremove \u0026amp;\u0026amp; apt autoclean \u0026amp;\u0026amp; apt clean alpine 入口启动文件\n1 2 3 4 # 清理 rm -rf /var/cache/apk/* #rm -rf ~/.ash_history ‍\n备份 docker\n1 2 3 4 5 6 7 8 docker stop test2 docker export test2 \u0026gt; 3.tar docker import 1.tar test2 docker stop test2 \u0026amp;\u0026amp; docker rm test2 \u0026amp;\u0026amp; docker rmi test2 docker run -itd --restart=always --name test2 --hostname test2 --privileged=true \\ -p 333:3389 -p 222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt \\ test2 sh /boot.sh ‍\n推送到 hub.docker.com\n1 2 3 4 5 6 7 8 9 10 docker logout docker login # 推送到阿里云 容器镜像 # docker login --username=你的用户邮箱 registry.cn-地区.aliyuncs.com datename=$(date +%Y%m%d%H%M%S) docker tag test2 joyanhui/debian-i3-xrdp-novnc docker tag test2 joyanhui/debian-i3-xrdp-novnc:a-lxd-d-$(datename) docker push joyanhui/debian-i3-xrdp-novnc:a-lxd-d-${datename} docker push joyanhui/debian-i3-xrdp-novnc ","date":"2023-07-07T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/debian-desktop-exec/","title":"joyanhui/debian-i3-xrdp-novnc  公开的搭建过程"},{"content":"在使用树状标签后，屏幕顶部横向的标签就无用了，可以考虑隐藏掉。\n我使用了 tree-style-tab/：https://addons.mozilla.org/zh-CN/firefox/addon/tree-style-tab/\n但是和edge不一样的是，这个扩展并不能自动隐藏横向的标签。这就需要我们自己处理。\n火狐支持用css的方式来定义外观，所以我们这里先打开这个功能。\n启用 userChrome.css 在火狐地址栏输入about:config回车，跳过警告信息后，输入 toolkit.legacyUserProfileCustomizations.stylesheets 设置为 true\n创建userChrome.css 查看 点击 火狐浏览器 右侧的 三 点帮助，排除更多故障信息 ，找到 配置文件夹(Profile Folder) 打开目录。 或者地址栏输入about:support\n常规情况下 比如 ，我的目录是 ~/.mozilla/firefox/aiqooixw.default-esr\nWindows portable 这个目录在 XXXX\\FirefoxPortable\\Data\\profile\\\n在flatpak版本下 因为沙盒原理，这个路径可能不存在 可以通过查看这个地址后，然后搜索对应的目录的实际路径。比如我的是\n1 2 3 find /home/XXXX/ -name \u0026#34;8wxcq01f.default-release\u0026#34; /home/XXXX/.var/app/org.mozilla.firefox/cache/mozilla/firefox/8wxcq01f.default-release /home/XXXX/.var/app/org.mozilla.firefox/.mozilla/firefox/8wxcq01f.default-release /home/XXXX/.var/app/org.mozilla.firefox/.mozilla/firefox/8wxcq01f.default-release 这个路径就是了\n创建子目录和文件 再这个目录下 新建一个文件夹 名字叫做 chrome ,然后再 chrome目录里面 新建一个css文件名称为userChrome.css\nuserChrome.css 文件内容 注意，这部分内容要根据你的情况做适当的调整，主要是 /* leftTop drag area */ 这行 以及 #titlebar 的 margin-bottom 才可以\n经过测试，96-130版本均可以实现，我主力用的firefox-esr 115 ，桌面环境是 i3w 下面css内容是我测试正常的。\n在windows11 下只需要把titlebar的 margin-bottom: -0px !important;修改为 margin-bottom: -35px !important; 即可\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 #main-window:not([drawtitle=\u0026#34;true\u0026#34;]):not([inFullscreen=\u0026#34;true\u0026#34;]) #nav-bar { margin-left : 30px; /* leftTop drag area */ border-right: 140px solid var(--toolbar-bgcolor); } :root[sizemode=\u0026#34;maximized\u0026#34;] #nav-bar { margin-top: 20px !important; /* Top drag area */ margin-left : 0px !important; /* hidden leftTop drag area in Fullscreen mode*/ border-right: 140px solid var(--toolbar-bgcolor); } :root[privatebrowsingmode=\u0026#34;temporary\u0026#34;] #nav-bar { border-right: 180px solid var(--toolbar-bgcolor) !important; } /* 主要是修改这里的 margin-bottom 支持负数 例如 margin-bottom: -30px !important; */ #titlebar { margin-bottom: -0px !important; } /* move down 3 button on rightTop */ .titlebar-buttonbox-container { margin-bottom: -5px !important; } :root[sizemode=\u0026#34;maximized\u0026#34;] .titlebar-buttonbox-container { margin-bottom: -15px !important; } /* move down private icon */ .private-browsing-indicator { margin-bottom: -8px !important; } :root[sizemode=\u0026#34;maximized\u0026#34;] .private-browsing-indicator { margin-bottom: -18px !important; } /* hidden horizontal tabbar on top */ #tabbrowser-tabs[orient=\u0026#34;horizontal\u0026#34;] { visibility: collapse !important; } #sidebar-box[sidebarcommand=\u0026#34;_0ad88674-2b41-4cfb-99e3-e206c74a0076_-sidebar-action\u0026#34;] sidebarheader { visibility: collapse !important; } 其他 火狐默认快捷键 https://support.mozilla.org/zh-CN/kb/%E9%94%AE%E7%9B%98%E5%BF%AB%E6%8D%B7%E9%94%AE\nwindows下protable版设置默认浏览器 用PortableRegistrator 这个软件 https://github.com/SiL3NC3/PortableRegistrator\n","date":"2023-07-05T00:15:20+08:00","permalink":"https://dev.leiyanhui.com/web/firefox-hidden-top-tab/","title":"firefox火狐浏览器隐藏顶部标签/标题栏：windows/linux/flatpak"},{"content":"为什么不经常更新 因为定位是 xrdp+vnc+novnc+远程声音转发 可用的一个尽可能小巧的稳定linux, 这个基本功能是绝对稳定强壮可用的。\n除非 pulseaudio-module-xrdp 有大版本更新，不然joyanhui/debian-i3-xrdp-novnc 不会继续更新。\n安全更新 自己 apt upgrade 即可！\n建议和需求 mailto: am95YW5odWkoYXQpcXEuY29t （解码后联系）\n更新计划 不代表一定会添加上可能是还在权衡\n天气预报默认显示 提示修改key openbox 集成dock 或者 任务栏 默认壁纸等 默认用户 yanhui 免密码sudo 物理机可直接启动版 已经完成的 2023-0708 修复 vnc和 novnc 的自动启动 openbox 右键菜单增加 thunar 集成 inetutils-ping iproute2 方便使用ping , ip a 命令 old alacritty 字体修复【2023-0707】 i3 自动隐藏firefox-esr浏览器边框【2023-0707】 修复时区 错误 sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime【2023-0707】 用雅黑字体替换zhenhei 【2023-0707】 openbox 右键菜单 rofi的提示【2023-0707】 polybar 菜单增加 退出 和重启 polybar 【2023-0707】 polybar 兼容雅黑字体【2023-0707】 集成 thunar gvfs gvfs-backends gvfs-fuse 【2023-0707】 集成 compton 【已经完成】 天气预报 默认调用 firefox-esr 打开网址 【已经完成】 vnc 和xrdp重复调用pulseaudio 导致的冲突问题 【使用双桌面方案解决】 默认桌面尝试 兼容 xrdp 和 vnc多显示器 vnc 可能会采用openbox 【已经完成】 状态栏 多显示器 【因为双桌面系统 已经不需要，i3现有配置文件可以满足】 ","date":"2023-07-04T00:15:20+08:00","permalink":"https://dev.leiyanhui.com/docker/debian-desktop-next/","title":"docker joyanhui/debian-i3-xrdp-novnc 更新记录和更新计划"},{"content":"本文为旧版本文档，新版文档在 ： https://dev.leiyanhui.com/docker/debian-desktop/\ndebian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp\n没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。\n特性 轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。\nvnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3 集成软件：\ndebian 12 bookworm i3 openbox polybar rofi alacritty dunst zsh supervisord 服务器管理 及python3 tigervnc novnc websockify ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji\n更新记录和计划 安装 1 2 3 4 5 6 docker run -itd --restart=always \\ --name debian-i3 --hostname debian-i3 \\ -p 3389:3389 -p 2222:22 \\ -p 8080:8080 -p 5900-5905:5900-5905 \\ -v /mnt:/disk \\ -e TZ=Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh 3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900\n默认用户名和密码 xrdp x11 ssh 的默认用户名：yanhui 密码：1 （只有一个数字1） vnc 密码：111111（六个数字1）\n为什么选择debian 因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。 arch的 一些其他缺点这里不多说。\n而且debian12 2年更新 5年安全，以后也可以平滑升级到更新版本。\n为什么选择i3 和openbox 怎么换其他桌面 因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。 因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。\n而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面\n更换为其他桌面的方法 例如，要换成 xfce4首先安装sudo apt install xfce4 ,然后修改 /autoStart.sh 可以更换vnc和novnc的桌面。\n修改用户目录下的 ~/.xsession 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:sudo apt purge i3 or sudo apt purge openbox\nnovnc vnc为什么是黑屏 就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 右键 有惊喜！\n怎么启动shell 和常见快捷键 基本是i3 的默认快捷键\n点屏幕顶部的 Apps\u0026gt; 系统 \u0026gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）\n如果是rdp远程桌面下，按下键盘 ： win+回车 启动管理器（开始菜单） :win d\n程序切换 alt+tab 修改窗口大小：按住win 再按住 鼠标右键 来回拖动\n修改窗口位置：按住win 再按住 鼠标左键 来回拖动\n关闭软件：win shift q\n注销：win shift e\n更多使用方法 自己看一下i3 使用说明\n怎么装中文输入法 1 sudo apt install fcitx5 fcitx5-chinese-addons 安装完成后，注销重新登录一次桌面，会自动加载，然后在托盘位置配置添加输入法即可，拼音输入法可导入搜狗细胞词库，具体自己研究。\n怎么新建用户怎么删除默认用户 新建用户 1 2 sudo adduser YouName sudo usermod -aG sudo YouName 新用户vnc密码 ssh 或者 xrdp 登陆新用户后，运行 vncpasswd\n更新 vnc服务 修改里面的用户名\n1 nano /autoStart.sh 删除默认用户 1 2 sudo deluser yanhui rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面 怎么修改密码 用户密码 命令：passwd\nvnc密码 命令：vncpasswd .vnc/passwd ，需要重启vnc服务，命令查看 cat /autoStart.sh x11转发模式如何使用输入法 修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 fcitx5\u0026amp; 再执行对应的软件。\nx11 转发模式部分软件很卡 没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。\nnovnc默认地址 http://你的ip:8080/ 其中端口docker内部默认使用80，外部端口是你自己映射的。\nnovnc如何走https 建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。\n20230704版本vnc连不上 1 rm /tmp/.X0-lock 把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器\n如何关掉vnc 1 2 3 4 5 sudo rm /etc/supervisor/conf.d/novnc.conf sudo apt purge tigervnc-standalone-server novnc python3-websockify # 注释掉 /autoStart.sh 的启动命令 # su -c \u0026#34;/usr/bin/vncserver -xstartup /usr/bin/i3 -geometry 1900x930 -localhost no :0 \u0026#34; yanhui # sudo apt autoremove \u0026amp;\u0026amp; sudo apt autoclean \u0026amp;\u0026amp; sudo apt clean # 可选清理操作 然后卸载\n天气预报出错以及如何修改天气预报城市 ~/.config/polybar/weather-plugin.py 这个文件 天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。\n你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）\nhttps://api.openweathermap.org/data/2.5/weather?id=1793724\u0026amp;appid=440b47a5ffbc5421e4a9befcbc4d635b\u0026amp;units=Metric\u0026amp;lang=zh_cn\n你如果不想用，直接在 polybar的配置文件里面删掉即可。\n如何调音量 在i3配置文件里面修改\n调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。\n进阶用法，自己配置i3和polybar\nvnc 和xrdp 桌面不同步 是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。\nnoVNC 网页访问按键失灵乱跳 1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法\n2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。\n没声音或者 顶部音量不显示 vnc 和x11 没声音 vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp\nxrdp的polybar 偶尔不显示音量 这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。\n临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar\n1 2 killall pulseaudio \u0026amp;\u0026amp; pulseaudio \u0026amp; sh .config/polybar/polybar_run.sh 如何修改分辨率 vnc novnc 1 nano /autoStart.sh # geometry 后面的参数是vnc的分辨率 xrdp xrdp的分辨率 由你的客户端 发起的时候配置\nopenbox的壁纸点好多次才换一张 壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。\n自己添加开机启动项 三个方法\n跟随 i3桌面启动的软件，可以添加到i3 配置文件中。例如截图软件，蓝牙托盘等等 后台服务，可以添加到 /autoStart.sh 需要守护的后台服务 添加到 supervisor中目录： /etc/supervisor/conf.d/ 安装常用软件 点屏幕左上角 APPS \u0026gt; 系统 \u0026gt; 终端 输入 apt install 命令；启动软件 APPS \u0026gt; 系统 \u0026gt; rofi-run 选择软件或者输入软件名称\n或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d\n1 2 3 sudo apt install firefox-esr # 火狐 sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源 sudo apt install thunar nemo nautilus # 任选一个 dolphin有依赖冲突哈 ，参考后面 libpulse-mainloop-glib0 错误的说明 libpulse-mainloop-glib0 错误 libpulse-mainloop-glib0 : Depends: libpulse0 (= 16.1+dfsg1-2+b1) but 1:13.99.1-1ubuntu3.10 is to be installed 部分软件 例如 pavucontrol dolphin 需要新版 libpulse0，但是因为 考虑到pulseaudio-module-xrdp 稳定性，我用的旧版本。 你可以卸载掉，然后重新编译pulseaudio-module-xrdp。\n不喜欢默认用户的shell 默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可\npve lxc ct 或者docker宿主机 目录映射 和显卡等 pve 硬盘到lxc 请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/\ndocker宿主机 目录映射 docker 创建命令 里面的 -v /mnt:/disk 就是把上层宿主的 /mnt 穿透到容器内部的/disk。 注意权限问题哈，可以用uid映射方法，权限要求不严格 也可以直接 chmod -R 777 /mnt解决\n如何使用显卡加速 以nvidia为例在创建docker的时候 把显卡挂进去即可\n1 2 3 4 5 6 7 8 9 docker run -itd --restart=always \\ --name debian-i3 --hostname debian-i3 \\ -p 3389:3389 -p 2222:22 \\ -p 8080:8080 -p 5900-5905:5900-5905 \\ -v /mnt:/disk \\ --device /dev/nvidia0:/dev/nvidia0 \\ --device /dev/nvidiactl:/dev/nvidiactl \\ --device /dev/nvidia-uvm:/dev/nvidia-uvm \\ -e TZ=Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh 目录和文件说明 启动文件 启动文件分两个\n/autoStart.sh 启动vnc 并启动supervisord /etc/supervisor/conf.d/ supervisord 服务目录 i3 配置文件 /home/yanhui/.config/i3/config\nopenbox配置文件 /home/yanhui/.config/openbox/menu.xml #右键菜单\nfeh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本\n壁纸目录 i3配置文件调用feh随机选 /home/yanhui/.config/i3/bg/\npolybar /home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单 /home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本 /home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。 rofi /home/yanhui/.config/rofi/config.rasi\ndunst /home/yanhui/.config/dunst/dunstrc\nalacritty /home/yanhui/.config/alacritty/alacritty.yml\nzsh /home/yanhui/.zshrc /home/yanhui/.oh-my-zsh\n","date":"2023-07-04T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/","title":"docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc"},{"content":"中文输入法 是一个群魔乱舞的世界。\n因为我的个人自定义词库比较多。 但是又经常换工作环境，所以词库的同步备份对我来说很重要。 这里不讨论自带输入法的问题。 因为那么多自定义词库，各个平台的默认输入法导入非常麻烦。 这里是只说拼音输入法。\n各平台下的选择 linux下 linux下，没得选 只能ibus fctix5，fctix5-拼音 + 云 简单配置可以导入搜狗细胞词库，简单容易配置。另外一个选择就是fctix5-rime 考虑到已经在linux下了 没有必要用rime了，过于折腾。其他平台的rime词库在linux也很容易自动导入到 fctix5-拼音\nwin下 rime 是一个不错的选择，但是如果对隐私要求没那么高的话，旧的搜狗的去广告修改精简版是一个不错的选择。\n搜狗 某一个旧版本，虽然不能导出txt但是可以导出 深蓝 可以识别的加密bin ，而且这个版本目前还支持同步词库功能。\n我个人就是 从另外一台电脑上的 13.6版本 导入我词库后，在日用笔记上 跑了一个虚拟win，然后用这个版本的搜狗+深蓝导出来的 txt\nmacos下 可选的不多，自带的输入法萝卜青菜吧\nios下 同macos差不多情况，可选的不多。关于irime本站另外一个文章有说，不要浪费时间折腾它，垃圾而已。\n几个主流的输入法的大致情况 搜狗 搜狗确实是标杆，但因为安全和隐私是一个大问题（其实中文输入法基本存在这个情况）。加上搜狗越来越臃肿而且卡顿。\n截止2023年，一个仅仅包含基础词库的输入法，体积已经到130M！！！！这还不算在安装后再下载细胞词库和同步自己的词库！！！ 所以 如果要用搜狗，尽可能的用旧版本，找别人精简好的广告和那些无用组件的，关掉自动更新 那些东西也可以凑合用。 旧版本的搜狗 目前还有可以同步词库，并且深蓝可以识别的版本。\n百度输入法 百度输入法更新比较少，相对来说精简一些。但是经过我测试 5.5版本已经无法同步个人词库，5.6版本导出的词库只有加密bin目前没有现成的工具可以解开。 慎入\n虽然百度很作恶，但是曾经除了百度，其他输入法都被苹果商店下架。 而且在ios的早期非越狱版本，也只有百度输入法不怎么崩。\n讯飞 在N年前 用过很长一段时间，当时是最好的语音识别输入法。但是当时他的macos版本 不支持键盘输入，只能语音输入。于是就直接启用了。 讯飞不支持词库导出，他不是不支持txt导出，他压根不可以导出，你想换一个账号 都不可以！ 慎入\n另外细胞词库将对比较老。\nqq拼音 没啥说的，曾经很清新，停止更新3年多了。细胞词库还有人维护 ，没有ios版本。\n微信输入法 俗话说。反正你几根腋毛腾讯都知道，所以用微信输入法也无可厚非。\n安装包体积很大，但是界面清新，反应速度也还可以。但是目前版本还不支持账号登录（pc端） 也没有词库管理功能。\ngboard 只有移动平台，ios下无法管理词库 也没有同步，比原生输入法好用不了太多。\n拼音加加 xp时代的主力，虽然曾经流氓，但是当时确实不错，直到出现了搜狗。 和比较新的 部分软件冲突无法使用。没有同步功能，纯单机输入法。\n谷歌输入法 停更10多年了，部分版本的官方链接还在，官网已经不在了。 和比较新的 部分软件冲突无法使用。 另外账号同步功能已经无法使用（挂全局也无法使用，是后端早被谷歌关掉了。）\nRIME | 中州韻 | 小狼毫 | irime | 鼠鬚管 | 同文 号称可定性最好的输入法。 但是切莫被这句话骗了。 优点很多人都说过。我这只说其中几个缺点。\n配置略微复杂，但是这不是最重要的，如果真的好用，也会建议你花时间去研究一下配置。 继续看后面。 没有细胞词库的概念，你可以从搜狗 或者其他输入法导入，也可以用别人的。但是导入的是词库，不是细胞词库，会和你的个人词库合并到一起。 因为没后台，那么也就没有现成的同步功能，他自带的同步，就是把配置文件和所有的当前在用的词库 给你放到一个文件夹里面。 你可以自己备份到自己的网盘 nas之类的地方。然后在别的设备上合并导入。 这一切都是手动的！如果你想要自动搞定，那么就花时间自己写个小程序来处理。 输入效率非常非常一般。我们知道输入法效率除了 词库之外，还有一点就是 基本的一些辅助功能，比如智能纠错 网络热词权重 上下文预判等。但是这都是rime没有的，而且也不可能会做的。另外就是，词库要很大很全，才能满足正常的输入需求，然后在超过一定数量后会卡顿（我用过数年的时间，最后累计的词库的确实是10几万条）。 win版本叫做 小狼毫 问题很多很多，偶尔生僻字乱码，偶尔无法弹出。部分软件下 压根无法输入 等等 linux下 fcitx5-rime 没有小狼毫的问题 ，但是同样受制于词库的丰富程序。 如果词库丰富 那就没问题。但是 为什么不用 fcitx5-pinyin 呢！可以自己同步user.dict 也可以导入搜狗的细胞词库，甚至还有很多其他的词库，以及云输入。 macos版 没用过 安卓版本 差不多的问题，也是效率受制于词库 ios版本 叫做irime 这个目前是唯一一个，懒得说，垃圾软件一个。 完全依赖rime没有备用输入法 是不可的，因为太多小问题了。\n最后的建议 如果你只是win下和移动设备用，且没有那么在意隐私。搜狗输入法 旧版的精简版本 不错，自己网上找一下 就可以。\n如果你非常在意隐私，那么单机类的输入法比较合理 ，包括rime 可以选择。\n我的选择 我多平台 安卓 ios mac win linux都在用。我目前的方案 依旧是以搜狗为主。\n账号 密码类信息 从不使用输入法输入。 我目前用的 bitwarden 网址类 基本也都是 浏览器书签，我用的 floccus 搜狗账号，单独注册一个，和其他账号无关联。 win下 搜狗拼音旧版本 目前暂时可以联网同步 导出的词库深蓝3.0 可以解析，时间长了偶尔手动导出一次词库，并用深蓝转换成txt linux fcitx5-拼音 定时自动备份 user.dict 到nas ios 搜狗 + 原生 安卓 搜狗 + 同文 macos 搜狗 + 鼠鬚管 ","date":"2023-07-02T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/os/input.2023/","title":"2023年输入法的选择"},{"content":"win mac linux 和安卓端 的rime 都是免费开源的，花费一点时间配置一下以后 都可以完美工作。\n但是 唯独 ios版本 目前 仅有的一个版本 开发者： gu weixiong\n就非常搞笑\n1、九宫格 没有 候选拼音功能，切不能自行配置 2、全键盘 和 14键 依旧没有 候选拼音功能！ 3、输入法键盘，会丢，需要重新去添加一次键盘，在ios16上相对频繁一下 在ios15上好一些 4、占屏幕比例不可调，工具栏按钮大小 是给眼花的老年人用的，超级大，占屏幕空间，且不可修改！！！\n5、有提供webdav和web的文件管理，但是pc的输入方案，不能直接用，词库的话也需要手动修改 6、部分特殊汉字 显示方块 例如 𫚉鱼（这是pc的rime打出来的）这个irime 打不出来\n7、然后 除了安装收费，还有一个什么文件管理 另外收费一次 （已经卸载忘记名字） 8、也需要完全访问全新，不然布局切换不能用 9、设置界面 提示什么“xxx” 大概是你不是开发者不能使用xxx功能的意思 10、氛围，作者有提供微信交流群，基本上的就是几个大龄老爷子 在里面bb，你如果咨询上述问题之一会被群攻，甚至再出来几个老爷子秀鹤 形之类的。 作者经常性水群，但是人家就是不更新！\n11、没有最基本纠错功能，你按错了 嗯就是按错了 哈哈。\n结论：智商税！ 不值得下载，更不值得花时间折腾。\n补充：或许用双拼 五笔 郑码 或者全键盘0错的人 可以尝试一下。如果你是喜欢盲打 全拼 简拼的 还有九宫格的 想也别想，虽然rime很强，但是这个 irime 不是那回事\n","date":"2023-07-02T15:14:20+08:00","permalink":"https://dev.leiyanhui.com/os/irime/","title":"rime目前仅有的ios版本irime是一个搞笑的低劣软件"},{"content":"mpy-cross 可以压缩 python代码，也有一定的加密源码的作用（聊胜于无）。\n在本地没有python环境，但是有Thonny的话，可以这样安装 windows为例\n1 2 3 cd D:\\Portable\\GreenSoft\\Thonny\\Scripts pip install mpy-cross mpy-cross E:\\esp\\esp32s2-fish-demo\\test.py 也可以添加到环境变量\n另外 如果是自定义固件，调试稳定的py文件，最好放到固件里面。详情查看本站其他文章。\n经过测试，同名的模块执行优先级依次为：\nflash的.py =\u0026gt; flash的.mpy =\u0026gt; rom的.py =\u0026gt; rom的.c\npython 的代码几乎无法完全加密，基本上不可能加密。\n核心敏感内容，建议用c来写，micropython不适合做这个事情。 或者 c模块+ mpy的方式也凑合可以。\n无论从代码执行效率和mcu资源的利用率，还是代码的保护上 micropython 都是不是好选择。\n但是在初期产品阶段micropython 还是非常不错的，上线前 根据情况用c写一部分模块，或者干脆重写就好了。\n","date":"2023-06-21T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/mcu/mpy-cross/","title":"micropython代码压缩和简单加密 mpy-cross"},{"content":"两个软件 测试比较良好\nusb_network_gate 这个9.0 有破解版 virtualhere 一个设备 免费 多设备也不贵 软件 都是通过tcp端口转发出去，局域网内都可以自动识别到 外网需要额外出来\n我目前在用 virtualhere，端口占用的7575 ，路由器转发后，即可远程访问。\n这两个 软件 均支持 linux win macos （usb_network_gate仅支持寥寥几个linux发行版 virtualhere支持所有发行版） 其中 virtualhere 支持安卓服务端，但是不支持安卓客户端 usb_network_gate 好像都支持，但是我没有测试过。\n但是这两个软件 最新版本 在win11 下 客户端 都不能正常工作，驱动异常。（ 随后发现 是 和nomachine 冲突，卸载nomachine 后重启 就正常了）\n其中 usb_network_gate 9 的服务端 在win11 下 也无法使用\n强烈推荐 virtualhere ，它只只能同时连接一个设备，而非只能用一个。\n","date":"2023-06-18T14:14:20+08:00","permalink":"https://dev.leiyanhui.com/mcu/esp32or8266-over-net/","title":"esp32、esp8266 网络共享，。usb设备网络共享 com口网络共享"},{"content":"helix 有一些操作的和vim不太一样 简单记录一下\n光标 上下左右 或者 h,j,k,l\n退出 q w 保存 wq 保存退出 插入模式 进入插入模式\ni - 在选区的前面进入插入模式。 a - 在选区的后面进入插入模式(这里是扩展选区的意思)。 I - 在行的最前方进入插入模式。 A - 在行的最后方进入插入模式。 删除 d\n返回命令模式 esc\n选区 新行 i/a 进入插入模式后 回车 o 会在光标所在位置的下方新建一行，并进入插入模式。 O 会在光标所在位置的上方新建一行，并进入插入模式 撤销 u 可以撤销之前操作。 U 可以重做撤销的操作。 复制粘贴 y 来复制选区内容。 p 将复制的内容粘贴到光标位置的后面。 P 将复制的内容粘贴到光标位置的前面。 搜索查找 / 会从当前光标位置在当前文件中向前搜索，回车后确认搜索。 n 会移动到下一个匹配的搜索内容。 N 会移动到上一个匹配的搜索内容。 更多查看：https://erasin.wang/helix/tutor/\n","date":"2023-06-17T22:14:20+08:00","permalink":"https://dev.leiyanhui.com/helix/helix-start/","title":"helix基本使用"},{"content":"注意，必须root.没有root权限 无解。\n你需要会用\n准备工作 1 MT管理器 https://www.coolapk.com/apk/bin.mt.plus 2 下载 秋秋 静态编译的 lxc文件， 原下载地址 (下载后不用改名) 点这里 备用地址 (下载以后把后缀名.zip 删掉) 点这里\n解压lxc 用mt管理器把静态编译的lxc压缩包 lxcnew.tar.gz文件复制到/data/lxc\n打开mt管理器，点左上角 三条杠， 终端模拟器，如果是第一次使用， 等它初始化一下。 开始执行命令 解压 ,记得手机访问本网页，你可以直接复制代码\n1 2 3 su cd /data/lxc tar -xvf lxcnew.tar.gz 检测cgroup版本 分别执行以下命令\n1 2 mount | grep cgroup2 mount | grep cgroup1 如果第 1 条命令有输出信息，你就是cgroup2\n如果第 2 条命令有输出信息，你就是cgroup1\n如果你是cgroup2版本，执行\n1 echo \u0026#34;lxc.init.cmd = /sbin/init systemd.unified_cgroup_hierarchy\u0026#34; \u0026gt;\u0026gt;; /data/lxc/share/lxc/config/common.conf 如果你是cgroup2版本，执行\n1 echo \u0026#34;lxc.init.cmd = /sbin/init systemd.unified_cgroup_hierarchy=0\u0026#34; \u0026gt;\u0026gt; /data/lxc/share/lxc/config/common.conf 配置一下lxc的网络 1 sed -i \u0026#39;s/lxc\\.net\\.0\\.type = empty/lxc.net.0.type = none/g\u0026#39; /data/lxc/etc/lxc/default.conf 挂载cgroup 1 2 3 4 5 mount -t tmpfs -o mode=755 tmpfs /sys/fs/cgroup mkdir -p /sys/fs/cgroup/devices mount -t cgroup -o devices cgroup /sys/fs/cgroup/devices mkdir -p /sys/fs/cgroup/systemd mount -t cgroup cgroup -o none,name=systemd /sys/fs/cgroup/systemd 上面5行命令 每次启动都要执行，可以更换termux 处理，写入到.bashrc 的末尾\n1 2 sudo mount -t tmpfs -o mode=755 tmpfs /sys/fs/cgroup \u0026amp;\u0026amp; sudo mkdir -p /sys/fs/cgroup/devices \u0026amp;\u0026amp; sudo mount -t cgroup -o devices cgroup /sys/fs/cgroup/devices \u0026amp;\u0026amp; sudo mkdir -p /sys/fs/cgroup/systemd \u0026amp;\u0026amp; sudo mount -t cgroup cgroup -o none,name=systemd /sys/fs/cgroup/systemd sudo lxc-setup-cgroups 记得 termux 要安装 tsu pkg install tsu 否则没有sudo命令，同时要给termux root权限，不然sudo 也执行不了\n准备创建lxc 后面的命令都在termux里面执行，当然MT的终端 适当修改一下也可以\n下载镜像 我这里选择debian,不喜欢ubuntu\n1 sudo /data/lxc/bin/lxc-create -t download -n debian -- --server mirrors.tuna.tsinghua.edu.cn/lxc-images 依次输入 debian bookworm arm64\n启动 1 2 sudo /data/lxc/bin/lxc-start -n debian 如果提示 state \u0026ldquo;ABORTING\u0026rdquo; instead of \u0026ldquo;RUNNING\u0026rdquo;\n1 2 sudo /data/lxc/bin/lxc-start -n debian --logfile=tmp.log --logpriority=DEBUG sudo cat tmp.log 检查错误 1 sudo /data/lxc/bin/lxc-attach -n debian /bin/passwd root 本文转自： https://purpleleaf.top/posts/%E5%AE%89%E5%8D%93lxc%E7%8B%AC%E7%AB%8B%E8%BF%90%E8%A1%8C%E6%95%99%E7%A8%8Bv3/\n日期 2023年07月21日 时间 01:44\nby redblue(弗朗西斯科)\n【 一 】 前期准备 ( 1 ) mt管理器，进入手机目录/data， 新建 lxc 文件夹\n下载 秋秋 静态编译的 lxc文件， 原下载地址 (下载后不用改名) 点这里 备用地址 (下载以后把后缀名.zip 删掉) 点这里\n然后把 lxcnew.tar.gz文件复制到/data/lxc, 打开mt管理器，点左上角 三条杠， 终端模拟器，如果是第一次使用， 等它初始化一下。 开始执行命令\n$ su $ cd /data/lxc $ tar -xvf lxcnew.tar.gz ( 2 ) ——检测cgroup版本 分别执行以下命令\n$ mount | grep cgroup2 $ mount | grep cgroup1 如果第 1 条命令有输出信息，你就是cgroup2 如果第 2 条命令有输出信息，你就是cgroup1\n如果你是cgroup1版本，执行 (执行1次即可，以后每次启动 无需再次执行)\n$ echo \u0026ldquo;lxc.init.cmd = /sbin/init systemd.unified_cgroup_hierarchy\u0026rdquo; \u0026raquo;; /data/lxc/share/lxc/config/common.conf 如果你是cgroup2版本 执行 (执行1次即可，以后每次启动 无需再次执行)\n$ echo \u0026ldquo;lxc.init.cmd = /sbin/init systemd.unified_cgroup_hierarchy=0\u0026rdquo; \u0026raquo; /data/lxc/share/lxc/config/common.conf ( 3 ) 网络设置 ( cgroup1 和cgroup2都要执行 ) ( 共1条命令，只需要执行 1 次 )\n$ sed -i \u0026rsquo;s/lxc.net.0.type = empty/lxc.net.0.type = none/g\u0026rsquo; /data/lxc/etc/lxc/default.conf ( 4 ) 挂载cgroup ( 可能需要每次都执行,如果在termux里可以在每个命令前加sudo，放.bashrc里每次自动执行)\nmount -t tmpfs -o mode=755 tmpfs /sys/fs/cgroup \u0026amp;\u0026amp; mkdir -p /sys/fs/cgroup/devices \u0026amp;\u0026amp; mount -t cgroup -o devices cgroup /sys/fs/cgroup/devices \u0026amp;\u0026amp; mkdir -p /sys/fs/cgroup/systemd \u0026amp;\u0026amp; mount -t cgroup cgroup -o none,name=systemd /sys/fs/cgroup/systemd 或者 建议直接去termux里，执行\n$ pkg install root-repo $ pkg install tsu lxc $ sudo mount -t tmpfs -o mode=755 tmpfs /sys/fs/cgroup \u0026amp;\u0026amp; sudo mkdir -p /sys/fs/cgroup/devices \u0026amp;\u0026amp; sudo mount -t cgroup -o devices cgroup /sys/fs/cgroup/devices \u0026amp;\u0026amp; sudo mkdir -p /sys/fs/cgroup/systemd \u0026amp;\u0026amp; sudo mount -t cgroup cgroup -o none,name=systemd /sys/fs/cgroup/systemd $ sudo lxc-setup-cgroups\n【 二 】 创建和启动 lxc容器 接下来，你可以选择自己喜欢的app进行操作， 例如 mt管理器 juicessh termius termux 本地adb shell 远程adb\n( 1 ) 配置环境 以mt管理器 为例， 打开mt管理器，点左上角 三条杠， 终端模拟器，如果是第一次使用， 等它初始化一下。 开始执行命令\n$ su $ cd /data/lxc $ source env.sh ( 2 ) 创建和运行 lxc容器 创建lxc容器\n$ lxc-create -t download -n ubuntu \u0026ndash; \u0026ndash;server mirrors.tuna.tsinghua.edu.cn/lxc-images 以 ubuntu 23.04 为例,依次输入 ubuntu lunar arm64\n等它下载解压完\n启动容器\nlxc-start -n ubuntu 改密码\nlxc-attach -n ubuntu /bin/passwd root 然后输入密码 再次输入密码 密码改好了!\n停止容器\nlxc-stop -n ubuntu 启动并进入容器\nlxc-start -n ubuntu -F 输入用户名 root 输入密码 你改的密码\n执行\napt update 发现网络有问题，失败\n解决网络问题 ( 共3条命令 )\n$ groupadd -g 3003 aid_inet $ usermod -g aid_inet _apt $ echo \u0026ldquo;nameserver 8.8.8.8\u0026rdquo; \u0026gt; /etc/resolv.conf 执行\napt update 发现成功了\n【 三 】 ubuntu后续使用 ( 1 ) 更换为清华大学源 可选 备份原镜像源\n$ cp /etc/apt/sources.list /etc/apt/sources.list.bak ubuntu 23.04更换清华大学源 共4条命令\n$ echo \u0026ldquo;deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ lunar main restricted universe multiverse\u0026rdquo; \u0026gt; /etc/apt/sources.list\n$ echo \u0026ldquo;deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ lunar-updates main restricted universe multiverse\u0026rdquo; \u0026raquo; /etc/apt/sources.list\n$ echo \u0026ldquo;deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ lunar-backports main restricted universe multiverse\u0026rdquo; \u0026raquo; /etc/apt/sources.list\n$ echo \u0026ldquo;deb http://ports.ubuntu.com/ubuntu-ports/ lunar-security main restricted universe multiverse\u0026rdquo; \u0026raquo; /etc/apt/sources.list ( 2 ) ssh连接\n$ apt install openssh-server 修改ssh配置文件，允许root用户的ssh连接，\n$ apt install nano $ nano /etc/ssh/sshd_config 找到这行 #PermitRootLogin prohibit-password 在它的下面添加1行 PermitRootLogin yes\n保存并退出 Ctrl + o Enter Ctrl + x\n重启ssh服务\n$ systemctl restart ssh ( 3 ) 改时区 描述: 日期时间不对，需要改下时区\n执行\ndate 发现日期时间不对\n执行以下命令 ( 即设定时区 让它自动校正时间 )\nsudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 执行\ndate 发现时间自动校正了\n【 四 】 lxc里的docker 运行 参考 安卓Lxc教程V9 的以下章节 : 【 六 】lxc里运行docker\n【 五 】 常用命令 这里记录一些常用命令\n( 1 ) lxc容器后台运行\nlxc-start -n ubuntu -d 然后就可以ssh连接了\n( 2 ) 停止lxc容器\nlxc-stop -n ubuntu 也可以这样停止容器\n$ su $ /data/lxc/bin/lxc-stop -n ubuntu termux里 可以这样停止容器\nsudo /data/lxc/bin/lxc-stop -n ubuntu\n","date":"2023-06-17T22:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/android-linux/","title":"安卓运行lxc/docker方法（非虚拟机）"},{"content":"gitea 是非常轻量简洁，但是功能完整的一个git私有化工具。 爱不释手ing\n我这里同样是 pve+lxc+alpine 搭建 直接用的 alpine仓库的gitea 安装的。版本不是最新的，但是够用。\n之前的备份方案 是 把整个运行目录备份过去 然后利用nas配置好的kopia 进行快照管理\n1 rclone sync gitea-local:/var/lib/gitea/ /mnt/nas/git_note_other_run_date/gitea/run_bak/ -P #备份到nas 在刚开始的时候 没问题，但是随着仓库的增加 文件越来越多 带来一些别的的问题\n于是 利用gitea自带的备份方案 另外加dump 备份\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 cat \u0026gt; ~/nas_core/back/1_3_gitea_to_nas.sh\u0026lt;\u0026lt; \\EOF #!/bin/bash sh /root/nas_core/back/0_0_file_to_nas_patch.sh #这里是把nas挂载到 /mnt/nas 目录 方便后续更换nas核心的时候 脚本不需要额外维护 # gitea 同步备份 sshpass -p 密码 ssh root@10.1.1.30 \u0026#39;su -c \u0026#34;cd /var/lib/gitea/;rm -rf ./gitea-dump*.zip;\u0026#39; # 删除 dump备份 文件 rclone sync gitea-local:/var/lib/gitea/ /mnt/nas/git_note_other_run_date/gitea/run_bak/ -P #备份到nas # gitea dump 备份 sshpass -p 密码 ssh root@10.1.1.30 \u0026#39;su -c \u0026#34;cd /var/lib/gitea/;gitea dump;mv gitea-dump-*.zip gitea-dump.zip\u0026#34; gitea\u0026#39; # 备份到 gitea-dump.zip # 备份到nas 文件有100M+ 所以 版本管理 给 kopia处理 rclone copyto gitea-local:/var/lib/gitea/gitea-dump.zip /mnt/nas/git_note_other_run_date/gitea/gitea-dump.zip -P #备份到nas # 加说明 echo -e \u0026#39;# snapshot by kopia\\n- gitea-dump.zip gitea dump\\n- run_bak /var/lib/gitea/\u0026#39;\u0026gt; /mnt/nas/git_note_other_run_date/gitea/README.md EOF 最后添加计划任务\n1 2 3 crontab -l \u0026gt; conf echo \u0026#34;4 * * * * sh /root/nas_core/back/1_3_gitea_to_nas.sh\u0026#34; \u0026gt;\u0026gt; conf crontab conf \u0026amp;\u0026amp; rm -f conf \u0026amp;\u0026amp; crontab -l ","date":"2023-06-17T14:14:20+08:00","permalink":"https://dev.leiyanhui.com/nas/gitea-to-nas/","title":"gitea自动备份到nas"},{"content":"通过https://helix-editor.com/logo.svg 和在线svg转换ico工具获取一个ico图标 然后给 hx.exe 创建一个快捷方式，右键属性修改图标 浏览这个ico文件\n把这个快捷方式 拖动到win 任务栏即可\n","date":"2023-06-15T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/helix/helix-win-ico/","title":"helix Windows任务栏图标 "},{"content":"大佬一直推荐helix，并且大佬连vscode都不用。 因为最近在弄单片机，需要debian下编译固件于是尝试了一下。\n1 2 3 4 apt install software-properties-common add-apt-repository ppa:maveonair/helix-editor apt update apt install helix 另外需要配置 一个 环境变量 HELIX_RUNTIME\nHELIX_RUNTIME=/root/src/helix/runtime 或者 ln -s $PWD/runtime ~/.config/helix/runtime\n优点一：零配置开箱即用 优点二：有非常丰富的提示 安装 LSP server 也很简单，比如 Python 只需要 pip install python-lsp-server 即可。\nwindows 可以直接去github下载zip包解压\n右键菜单.reg\n1 2 3 4 5 6 7 Windows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\*\\shell\\Edit with helix] \u0026#34;Icon\u0026#34;=\u0026#34;D:\\\\Portable\\\\GreenSoft\\\\helix\\\\hx.ico\u0026#34; [HKEY_CLASSES_ROOT\\*\\shell\\Edit with helix\\Command] @=\u0026#34;D:\\\\Portable\\\\GreenSoft\\\\helix\\\\hx.exe \\\u0026#34;%1\\\u0026#34;\u0026#34; hx.ico 可以用官网的logo https://helix-editor.com/logo.svg 在线转换成ico, runtime 同目录 或者自己修改走 都可以。\n不过windows下，轻量编辑器，我依旧 保留了 notepadnext\n","date":"2023-06-14T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/helix/vi-vim-helix/","title":"替代vim nano的工具helix"},{"content":"micropython 不支持 esp32 s2 c3 s3 的内置温度传感器读取。我这里尝试添加一个模块，可以用py读取。\n首先你要先学会自定编译固件 添加基于python的模块请参考 arduino 先测试一下 因为有人说 esp32的后面的芯片内置的温度传感器不能用，所以先试试\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #include \u0026#34;driver/temp_sensor.h\u0026#34; void setup() { Serial.begin(115200); temp_sensor_config_t temp_sensor = { .dac_offset = TSENS_DAC_L2, .clk_div = 6, }; temp_sensor_set_config(temp_sensor); temp_sensor_start(); } void loop() { float tsens_out; temp_sensor_read_celsius(\u0026amp;tsens_out); Serial.printf(\u0026#34;%f\\r\\n\u0026#34;, tsens_out); delay(500); } 测试良好，精度 ±1℃ 凑合，比环境温度略微高一点。做好主要温度范围的多点校准后，可以凑合使用。\n添加到mpy固件 tempSensor.c 创建文件 /mpy-bin/micropython/ports/esp32/tempSensor.c\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 // import time // import tempSensor // tempSensor.init() // for _ in range(10): // print(tempSensor.getT()) // time.sleep(1) // tempSensor.stop() #include \u0026#34;py/obj.h\u0026#34; #include \u0026#34;py/runtime.h\u0026#34; // Include MicroPython API. #if CONFIG_IDF_TARGET_ESP32S2 || CONFIG_IDF_TARGET_ESP32C3 || CONFIG_IDF_TARGET_ESP32S3 #include \u0026#34;driver/temp_sensor.h\u0026#34; #endif // 函数 初始化 并启动 STATIC mp_obj_t tempSensor_init(void) { #if CONFIG_IDF_TARGET_ESP32S2 || CONFIG_IDF_TARGET_ESP32C3 || CONFIG_IDF_TARGET_ESP32S3 temp_sensor_config_t temp_sensor = TSENS_CONFIG_DEFAULT(); temp_sensor.dac_offset = TSENS_DAC_DEFAULT; // DEFAULT: range:-10℃ ~ 80℃, error \u0026lt; 1℃. temp_sensor_set_config(temp_sensor); temp_sensor_start(); #endif return mp_const_none; } // 定义参数 STATIC MP_DEFINE_CONST_FUN_OBJ_0(tempSensor_init_obj, tempSensor_init); // 函数 获取 STATIC mp_obj_t tempSensor_getT(void) { #if CONFIG_IDF_TARGET_ESP32S2 || CONFIG_IDF_TARGET_ESP32C3 || CONFIG_IDF_TARGET_ESP32S3 float tsens_out; temp_sensor_read_celsius(\u0026amp;tsens_out); //temp_sensor_stop(); return mp_obj_new_float(tsens_out); #endif return mp_const_none; } // 定义参数 STATIC MP_DEFINE_CONST_FUN_OBJ_0(tempSensor_getT_obj, tempSensor_getT); // 函数 停止 STATIC mp_obj_t tempSensor_stop(void) { #if CONFIG_IDF_TARGET_ESP32S2 || CONFIG_IDF_TARGET_ESP32C3 || CONFIG_IDF_TARGET_ESP32S3 temp_sensor_stop(); #endif return mp_const_none; } // 定义参数 STATIC MP_DEFINE_CONST_FUN_OBJ_0(tempSensor_stop_obj, tempSensor_stop); // 定义模块的所有属性。 // 表条目是属性名称（字符串）的键/值对 // 和 MicroPython 对象引用。 // 所有的标识符和字符串都写成 MP_QSTR_xxx 并且会被 // 由构建系统优化为字大小的整数（驻留字符串）. STATIC const mp_rom_map_elem_t tempSensor_module_globals_table[] = { { MP_ROM_QSTR(MP_QSTR___name__), MP_ROM_QSTR(MP_QSTR_tempSensor) }, { MP_ROM_QSTR(MP_QSTR_getT), MP_ROM_PTR(\u0026amp;tempSensor_getT_obj) }, { MP_ROM_QSTR(MP_QSTR_init), MP_ROM_PTR(\u0026amp;tempSensor_init_obj) }, { MP_ROM_QSTR(MP_QSTR_stop), MP_ROM_PTR(\u0026amp;tempSensor_stop_obj) }, }; STATIC MP_DEFINE_CONST_DICT(tempSensor_module_globals, tempSensor_module_globals_table); // 定义模块对象 const mp_obj_module_t tempSensor_user_cmodule = { .base = { \u0026amp;mp_type_module }, .globals = (mp_obj_dict_t *)\u0026amp;tempSensor_module_globals, }; // 注册模块以使其在 Python 中可用 这行 最好条件编译 MP_REGISTER_MODULE(MP_QSTR_tempSensor, tempSensor_user_cmodule); 添加到模块 ports/esp32/main/CMakeLists.txt 搜索 machine_sdcard.c 比这添加一行tempSensor.c\n编译，更多编译教程 查看本站其他文章\npy测试 1 2 3 4 5 6 7 import time import tempSensor tempSensor.init() for _ in range(10): print(tempSensor.getT()) time.sleep(1) tempSensor.stop() ","date":"2023-06-13T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/mcu/esp32-mpy-add-c-module/","title":"esp32 micropython添加C模块(esp32 s2 c3 s3 内置温度传感器读取)"},{"content":"添加自定义py文件到bin 有三个优点\n在编译固件的时候编译py文件到中间代码，可以节省大量内存\n中间代码在bin里面，比mpy文件更难泄露\n方便量产\n首先你要先学会自定编译固件\n添加基于C的模块请参考\nmodules 添加py文件的方法 然后知道 modules 目录 就是 我们需要添加自定义py文件的地方\n1 2 3 4 5 6 7 8 9 10 11 12 13 cd ~/mpy-bin/micropython/ports/esp32/modules nano test.py ----------------- import time def hello(): print(\u0026#34;hello world\u0026#34;) def hw(str): print(str) def cycle(str): while True: print(str) time.sleep(1) 重新编译，烧录新固件测试\n1 2 3 import test test.hw(\u0026#39;123\u0026#39;) test.cycle(\u0026#39;cycle me\u0026#39;) 这就完成了。\n同名的模块执行优先级依次为： flash的.py =\u0026gt; flash的.mpy =\u0026gt; rom的.py =\u0026gt; rom的.c\n固件 简单 自定义 boot.py 和 main.py 如果想自定义 开机启动启动的 boot.py 和 main.py 需要编辑 ~/mpy-bin/micropython/ports/esp32/modules 这个目录下的 inisetup.py 即可。 可以在boot.py 里面完成联网 和下载 main.py 功能完成自动更新\n其他代码的保护 micropython 官方提供了 mpy方法，可以把 py文件转成中间代码 ，有一点类似pythone的pyc文件。但是 因为在单片机这种场景下，会节省很多内存也会提升一些性能。只是代码保护功能 和 pyc差不多了，基本没啥用。 加密 本身不一定是单纯的保护代码，有时候是保护算法和api参数，增加搞事情的时间成本。\n较为靠谱的方法 核心内容用C来完成。 这样机器码转汇编工作量是最大的。\n再次 就是 核心的程序 写成类，放到固件modules里面\n其他功能 全部拆分到 mpy文件里面，然后main.py调用，同时 main.py 尽量少些逻辑了哦。 主要逻辑都放到 类里面去。\n另外就是咋测试成功后，最后的固件 禁用usb功能\n","date":"2023-06-12T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/mcu/esp32-mpy-code-to-bin/","title":"esp32自行编译micropython固件并添加基于python的模块"},{"content":"micropython 自己编译固件有几个好处\n只加入自己需要的模块降低硬件资源占用 .py文件可以修改中中间码，并烧录到固件内部， 可以方便量产 可一定程度保护代码 更加省略了编译过程节省内存 我这里 只记录 添加 smartconfig的方法，并以S2 mini为例，其他esp32 同理。\n简中网络上，几乎没有相关资料，有一些资料也是错的或无法使用。所以这里单独记录分享一下。 你可以直接下载 我编译好的\nhttps://github.com/joyanhui/file.leiyanhui.com/blob/main/esp32/\n准备 linux系统，我这里是pve lxc运行的ubuntu22.04 科学工具 因为需要拉github 基本的linux基础 环境配置 和 依赖 修改到国内源，这个自己处理\n1 2 3 4 5 6 7 8 9 apt install git wget curl make gcc cmake rsync # ppa安装pythone 3.11 Ubuntu自带的版本太低 apt install software-properties-common add-apt-repository ppa:deadsnakes/ppa apt install python3.11 python-is-python3 # pip3 curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py python get-pip.py --force-reinstall pip install mpy-cross-v6 克隆代码 1 mkdir mpy-bin \u0026amp;\u0026amp; cd mpy-bin esp-idf 注意 不同的esp32平台 micropython支持的esp-idf版本不同，详情参考 https://github.com/micropython/micropython/tree/master/ports/esp32#readme\nlinux小白 一步一步操作，注意里面的警告信息\n1 2 3 4 git clone -b v4.4.5 --recursive https://github.com/espressif/esp-idf.git esp-idf-v4.4.5 cd esp-idf-v4.4.5/ git checkout v4.4.5 git submodule update --init --recursive 处理环境变量\n1 2 ./install.sh source export.sh micropython 本文基于 1.20 版本，如果新版失效，请 直接去下载 https://github.com/micropython/micropython/releases/download/v1.20.0/micropython-1.20.0.zip 不要 git clone最新的\n1 2 3 4 5 cd .. git clone https://github.com/micropython/micropython.git cd micropython make -C mpy-cross cd ports/esp32 测试默认编译micropython固件 1 2 make submodules make # make BOARD=LOLIN_S2_MINI 直接make的话 是 esp32 ，我这里是 s2 ，并且是 esp32 s2 mini开发板 所以添加参数 BOARD=LOLIN_S2_MINI 这样就可以编译 了,编译后 会有提示 ./build-XXXX/ firmware.bin 这个文件是合并后的，可以直接烧到0x1000\n推送到 nas 我这里推送到nas里面，方便其他机器使用\n1 rsync -avzut --progress ./build-LOLIN_S2_MINI/firmware.bin root@10.1.1.200:/mnt/nas/temp/firmware-my.bin 烧录 在连接esp32的机器上从nas复制bin文件过来然后下入\n1 2 esptool --port COM3 erase_flash #擦除 esptool --port COM3 --baud 1000000 write_flash -z 0x1000 firmware-my.bin # 写入从nas 拷贝过来的 新固件 烧录完成后，重启板，thonny 链接上，输入 help(\u0026lsquo;modules\u0026rsquo;) 查看模块\n添加 smartconfig模块 1 cd ~/mpy-bin/micropython/ports/esp32 需要两个地方，1是 添加一个smarconfig.c文件，2 是修改还 ports/esp32/main/CMakeLists.txt 把 smarconfig.c 加进去\nCMakeLists.txt 查看 cat ~/mpy-bin/micropython/ports/esp32/main/CMakeLists.txt 目前版本1.20版本 需要修改的内容在 54-92行 格式如下\n1 2 3 4 5 6 set(MICROPY_SOURCE_PORT main.c .... machine_sdcard.c ... ) 我们需要在 machine_sdcard.c 后面添加一个 smarconfig.c，然后在 machine_sdcard.c的同目录下 创建一个 smarconfig.c (内容查看后文)\n修改后的 CMakeLists.txt 内容格式如下\n1 2 3 4 5 6 7 set(MICROPY_SOURCE_PORT main.c .... machine_sdcard.c smarconfig.c ... ) 同理，可以在这里删掉不用的模块\nsmarconfig.c 1 nano ~/mpy-bin/micropython/ports/esp32/machine_sdcard.c 内容参考后文。 找\n重新编译 1 2 make submodules make BOARD=LOLIN_S2_MINI 上级测试 新固件烧录后，烧录完成后，重启板，thonny 链接上，输入 help('modules') 查看模块 已经有 smarconfig 运行一个 main.py 测试，测试代码参考后文。 启动后，找一个支持smarconfig的手机app或者微信小程序 配网测试 我用的微信小程序#小程序://一键配网/047fob5XqOB14hk 复制发送到手机微信，聊天窗口点开即可。配网成功\n添加自定义py文件 优点：1 保护代码 2 方便量产 内容单独另起一一个文章 添加自定义py文件到固件\n内容 smarconfig.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 #include \u0026#34;py/obj.h\u0026#34; #include \u0026#34;py/runtime.h\u0026#34; #include \u0026lt;string.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026#34;freertos/FreeRTOS.h\u0026#34; #include \u0026#34;freertos/task.h\u0026#34; #include \u0026#34;freertos/event_groups.h\u0026#34; #include \u0026#34;esp_wifi.h\u0026#34; #include \u0026#34;esp_event.h\u0026#34; #include \u0026#34;esp_log.h\u0026#34; #include \u0026#34;esp_smartconfig.h\u0026#34; static EventGroupHandle_t s_wifi_event_group; static const int ESPTOUCH_DONE_BIT = BIT1; static const char *TAG = \u0026#34;smartconfig\u0026#34;; static int found_ssid_and_password = false; static uint8_t ssid[33] = {0}; static uint8_t password[65] = {0}; static uint8_t type = -1; static uint8_t token = 0; static void smartconfig_task(void * parm); static void event_handler(void* arg, esp_event_base_t event_base, int32_t event_id, void* event_data) { if (event_base == SC_EVENT \u0026amp;\u0026amp; event_id == SC_EVENT_SCAN_DONE) { ESP_LOGI(TAG, \u0026#34;Scan done\u0026#34;); } else if (event_base == SC_EVENT \u0026amp;\u0026amp; event_id == SC_EVENT_FOUND_CHANNEL) { ESP_LOGI(TAG, \u0026#34;Found channel\u0026#34;); } else if (event_base == SC_EVENT \u0026amp;\u0026amp; event_id == SC_EVENT_GOT_SSID_PSWD) { ESP_LOGI(TAG, \u0026#34;Got SSID and password\u0026#34;); smartconfig_event_got_ssid_pswd_t *evt = (smartconfig_event_got_ssid_pswd_t *)event_data; memcpy(ssid, evt-\u0026gt;ssid, sizeof(evt-\u0026gt;ssid)); memcpy(password, evt-\u0026gt;password, sizeof(evt-\u0026gt;password)); type = evt-\u0026gt;type; token = evt-\u0026gt;token; ESP_LOGI(TAG, \u0026#34;SSID:%s\u0026#34;, ssid); ESP_LOGI(TAG, \u0026#34;PASSWORD:%s\u0026#34;, password); ESP_LOGI(TAG, \u0026#34;TYPE:%d\u0026#34;, type); ESP_LOGI(TAG, \u0026#34;TOKEN:%d\u0026#34;, token); found_ssid_and_password = true; xEventGroupSetBits(s_wifi_event_group, ESPTOUCH_DONE_BIT); } } static void initialise_wifi(void) { s_wifi_event_group = xEventGroupCreate(); ESP_ERROR_CHECK(esp_event_loop_create_default()); ESP_ERROR_CHECK(esp_event_handler_register(SC_EVENT, ESP_EVENT_ANY_ID, \u0026amp;event_handler, NULL)); xTaskCreate(smartconfig_task, \u0026#34;smartconfig_task\u0026#34;, 4096, NULL, 3, NULL); } static void smartconfig_task(void * parm) { EventBits_t uxBits; ESP_ERROR_CHECK(esp_smartconfig_set_type(SC_TYPE_ESPTOUCH_AIRKISS)); smartconfig_start_config_t cfg = SMARTCONFIG_START_CONFIG_DEFAULT(); ESP_ERROR_CHECK(esp_smartconfig_start(\u0026amp;cfg)); while (1) { uxBits = xEventGroupWaitBits(s_wifi_event_group, ESPTOUCH_DONE_BIT, true, false, portMAX_DELAY); if(uxBits \u0026amp; ESPTOUCH_DONE_BIT) { ESP_LOGI(TAG, \u0026#34;smartconfig over\u0026#34;); ESP_ERROR_CHECK(esp_smartconfig_stop()); vTaskDelete(NULL); } } } STATIC mp_obj_t smartconfig_start(void) { initialise_wifi(); return mp_const_none; } STATIC MP_DEFINE_CONST_FUN_OBJ_0(smartconfig_start_obj, smartconfig_start); STATIC mp_obj_t smartconfig_success(void) { return mp_obj_new_bool(found_ssid_and_password); } STATIC MP_DEFINE_CONST_FUN_OBJ_0(smartconfig_success_obj, smartconfig_success); STATIC mp_obj_t smartconfig_info(void) { mp_obj_t info[] = { mp_obj_new_str((const char *)ssid, strlen((const char *)ssid)), mp_obj_new_str((const char *)password, strlen((const char *)password)), mp_obj_new_int(type), mp_obj_new_int(token) }; return mp_obj_new_tuple(4, info); } STATIC MP_DEFINE_CONST_FUN_OBJ_0(smartconfig_info_obj, smartconfig_info); STATIC const mp_rom_map_elem_t smartconfig_module_globals_table[] = { {MP_ROM_QSTR(MP_QSTR___name__), MP_ROM_QSTR(MP_QSTR_smartconfig)}, {MP_ROM_QSTR(MP_QSTR_start), MP_ROM_PTR(\u0026amp;smartconfig_start_obj)}, {MP_ROM_QSTR(MP_QSTR_success), MP_ROM_PTR(\u0026amp;smartconfig_success_obj)}, {MP_ROM_QSTR(MP_QSTR_info), MP_ROM_PTR(\u0026amp;smartconfig_info_obj)}, {MP_ROM_QSTR(MP_QSTR_TYPE_UNKNOWN), MP_ROM_INT(-1)}, {MP_ROM_QSTR(MP_QSTR_TYPE_ESPTOUCH), MP_ROM_INT(SC_TYPE_ESPTOUCH)}, {MP_ROM_QSTR(MP_QSTR_TYPE_AIRKISS), MP_ROM_INT(SC_TYPE_AIRKISS)}, }; STATIC MP_DEFINE_CONST_DICT(smartconfig_module_globals, smartconfig_module_globals_table); const mp_obj_module_t smartconfig_user_cmodule = { .base = {\u0026amp;mp_type_module}, .globals = (mp_obj_dict_t *)\u0026amp;smartconfig_module_globals, }; MP_REGISTER_MODULE(MP_QSTR_smartconfig, smartconfig_user_cmodule); main.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 import network import socket import smartconfig import time def inet_pton(ip_str:str): \u0026#39;\u0026#39;\u0026#39;convert ip address from string to bytes\u0026#39;\u0026#39;\u0026#39; ip_bytes = b\u0026#39;\u0026#39; ip_segs = ip_str.split(\u0026#39;.\u0026#39;) for seg in ip_segs: ip_bytes += int(seg).to_bytes(1, \u0026#39;little\u0026#39;) return ip_bytes def send_ack(local_ip, local_mac): \u0026#39;\u0026#39;\u0026#39;sent ack_done event to phone\u0026#39;\u0026#39;\u0026#39; udp = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) udp.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) data = smartconfig.info()[3].to_bytes(1, \u0026#39;little\u0026#39;) + local_mac port = 10000 # airkiss port if smartconfig.info()[2] == smartconfig.TYPE_ESPTOUCH: data += inet_pton(local_ip) port = 18266 # esptouch port print( f\u0026#34;\u0026#34;\u0026#34;- sending ack: type: {\u0026#39;esptouch\u0026#39; if smartconfig.info()[2] == smartconfig.TYPE_ESPTOUCH else \u0026#39;airkiss\u0026#39;} port: {port} data: {data} length: {len(data)} \u0026#34;\u0026#34;\u0026#34; ) for _ in range(20): time.sleep_ms(100) try: udp.sendto(data, (\u0026#39;255.255.255.255\u0026#39;, port)) except OSError: pass print(\u0026#39;- ack was sent\u0026#39;) station = network.WLAN(network.STA_IF) station.active(True) print(\u0026#39;- start smartconfig...\u0026#39;) smartconfig.start() print(\u0026#39;- waiting for success...\u0026#39;) while not smartconfig.success(): time.sleep_ms(500) print(\u0026#39;- got smartconfig info\u0026#39;) ssid, password, sc_type, token = smartconfig.info() print(smartconfig.info()) print(\u0026#39;- connecting to wifi...\u0026#39;) station.connect(ssid, password) while not station.isconnected(): time.sleep_ms(500) print(\u0026#39;- wifi connected\u0026#39;) while station.ifconfig()[0] == \u0026#39;0.0.0.0\u0026#39;: time.sleep_ms(500) print(\u0026#39;- got ip\u0026#39;) print(station.ifconfig()) send_ack(station.ifconfig()[0], station.config(\u0026#39;mac\u0026#39;)) ","date":"2023-06-12T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/mcu/esp32-s2-mpy-smartconfig/","title":"esp32自行编译micropython固件并支持smartconfig方法 以及代码保护"},{"content":"目标 创建一个可以在fat/exfat/ext4 以及U盘 光盘可以启动的自定义linux系统环境\n基于 debian11 ：http://mirror.lzu.edu.cn/debian-cd/11.7.0/amd64/iso-dvd/debian-11.7.0-amd64-DVD-1.iso\n其他linux系统差不多 脚本工具：http://linux-live.org/\n原理 基于自定义的initramfs挂载和启动到squashfs只读镜像启动默认的linux环境。\n在只读媒体上，修改点映射到内存。\n在linux原生磁盘分区上，修改内容映射到指定目录。 在fat exfat等磁盘分区上修改内容映射到data文件（限制12-16G）\n基本步骤实现 新机器安装一个干净的linux 并必须安装以下工具包squashfs-tools genisoimage 或者 mkisofs zip 另外 需要 xz rsync sshd sudo wget unzip nano 等\n打包 打包工具 用 linux-live.org 的\n1 2 3 4 mkdir /mklive \u0026amp; cd /mklive wget https://github.com/Tomas-M/linux-live/archive/refs/heads/master.zip unzip master.zip cd linux-live-master 配置 需要配置config 文件里面分别是\nLIVEKITNAME 目录 通常不需要修改 VMLINUZ 内核位置，非chroot情况可以不修改，chroot过来的花需要修改为实际的内核路径，并且需要修改引导的cfg KERNEL 内核版本 通常不需要修改 MKMOD 包含的目录，通常不需要修改，如果你有其他目录 单独加上 NETWORK 是否支持网络引导 通常不需要修改 LIVEKITDATA 最后打包的目标目录，其中包含 syslinux引导以及squashfs镜像和一些其他文件 BEXT squashfs文件后缀名称 通常不需要修改 LMK 内核ko模块目录，通常不需要修改 创建 1 ./build 会在LIVEKITDATA指定的目录创建sb文件 initramfs 和其他需要的文件 也会吧内核复制一份过去 如果是alpine的话需要注意base的处理，另外initramfs/initramfs_create 也需要执行权限。\n打包 最终的文件 是 在 /tmp/linux-data-XXX 目录 直接执行/tmp/gen_linux_zip.sh 就可以了打包成zip 了，解压到U盘 或者硬盘 linux 或许win 执行里面的 bootinst.sh/bat 即可在对应设备上创建好引导。默认是用的syslinux引导的。 如果打包iso的话，默认不支持EFI启动。\n启动背景 1 /tmp/linux-data-XXX/linux/boot/bootlogo.png 网上找了一个 https://raw.githubusercontent.com/xenlism/Grub-themes/main/xenlism-grub-1080p-Debian/Xenlism-Debian/background.png 不合适\n修改readme 1 2 3 4 cat \u0026gt; ./readme.txt \u0026lt;\u0026lt; \\EOF Default (SeaBIOS) use syslinux OVMF (UEFI) use grub EOF 打包iso\n1 /tmp/gen_linux_iso.sh 测试 pve 宿主机复制出来\n1 rsync yanhui@10.1.1.239:/tmp/linux-x86_64.iso /exfat/iso/ efi启动 硬盘efi+grub启动 自带一硬盘启动的sh和bat自动处理脚本，并支持 bios+syslinux 和 efi+syslinux 如果要修改为grub参考 https://github.com/beatfan/UEFI_grub2/\niso efi 启动支持 自创建的iso支持bios启动，如果efi参考 https://github.com/beatfan/USB_Boot_With_Grub_Grub2_ISOLINUX\n","date":"2023-06-03T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/linux/linux-live-diy/","title":"linux-live环境定制 可U盘硬盘或者iso启动"},{"content":"自己手写一个，你可以直接抄作业。\n获取天气预报api 首先需要自己注册一个api,我这里用的 openweathermap,注册账号后打开 https://home.openweathermap.org/api_keys,查看自己的 api_key\nopenweathermap 的api_key有延迟，界面显示可用的有时候好像需要半个多小时才可以使用，否则接口一直返回401错误\nopenweathermap 虽然有诸多不方便，比如英文，速度慢，但是天气预报很准确 而且接口稳定，并分钟级实时预报，天气云图，国内很多免费的接口不稳定。\n获取城市id openweathermap 支持城市名称搜索查询，我这里为了简化直接用城市id了。 打开openweathermap网站 输入你所在地城市的拼音/英文名搜索，查看天气，地址栏的例如 https://openweathermap.org/city/1793724 1793724就是城市id了\n手动测试api 访问地址： https://api.openweathermap.org/data/2.5/weather?id={城市ID}\u0026amp;appid={api_key}\u0026amp;units=Metric\u0026amp;lang=zh_cn 后面units是单位公制或者英制之类的 lang 就是语言了\n正常应该可以返回json数据，如果是401错误，那么就是api_key错误，或者没生效，或者请求太频繁（1分钟上限60次）\n本地准备 因为是polybar用，那么铁定是linux下日用，也肯定有pyhone了。我抄的别人的（原作者忘记）直接用了pyhone。\n需要先引用requests, 没有安装。提前安装一下\n1 2 3 sudo pacman -S python-pip pip3 install requests sudo pacman -Rns python-pip #是否卸载掉看你自己 创建脚本 把下面脚本的apt_key和城市id（1793724）换成你自己的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 # 需要requests # sudo pacman -S python-pip # pip3 install requests cat \u0026gt; ~/.config/polybar/weather-plugin.py\u0026lt;\u0026lt; \\EOF #!/bin/python # -*- coding: utf-8 -*- import requests REQ = requests.get(\u0026#34;https://api.openweathermap.org/data/2.5/weather?id=1793724\u0026amp;appid=XXXXXXXXXXXX\u0026amp;units=Metric\u0026amp;lang=zh_cn\u0026#34;) try: # HTTP CODE = OK if REQ.status_code == 200: ICON_ID = REQ.json()[\u0026#34;weather\u0026#34;][0][\u0026#34;icon\u0026#34;] # Set the weather icon if ICON_ID == \u0026#34;01d\u0026#34;: ICON = \u0026#34;☀\u0026#34; # 晴天 Clear Sky elif ICON_ID == \u0026#34;01n\u0026#34;: ICON = \u0026#34;⭐\u0026#34; # Night, Clear Sky elif ICON_ID == \u0026#34;02d\u0026#34;: ICON = \u0026#34;🌤\u0026#34; # Day,少云 Few Clouds elif ICON_ID == \u0026#34;02n\u0026#34;: ICON = \u0026#34;🌤\u0026#34; # Night, 少云 Few Clouds elif ICON_ID == \u0026#34;03d\u0026#34;: ICON = \u0026#34;🌤\u0026#34; # Day, 少云 Scattered Clouds elif ICON_ID == \u0026#34;03n\u0026#34;: ICON = \u0026#34;🌤\u0026#34; # Night, 少云 Scattered Clouds elif ICON_ID == \u0026#34;04d\u0026#34;: ICON = \u0026#34;多云\u0026#34; # Day, 多云 Broken Clouds elif ICON_ID == \u0026#34;04n\u0026#34;: ICON = \u0026#34;多云\u0026#34; # Night, 多云 Broken Clouds elif ICON_ID == \u0026#34;09d\u0026#34;: ICON = \u0026#34;🌧\u0026#34; # Day, 小雨 Shower Rain elif ICON_ID == \u0026#34;09n\u0026#34;: ICON = \u0026#34;🌧\u0026#34; # Night,小雨 Shower Rain elif ICON_ID == \u0026#34;10d\u0026#34;: ICON = \u0026#34;🌧\u0026#34; # Day, Rain elif ICON_ID == \u0026#34;10n\u0026#34;: ICON = \u0026#34;🌧\u0026#34; # Night, Rain elif ICON_ID == \u0026#34;11d\u0026#34;: ICON = \u0026#34;⛈\u0026#34; # Day, 雷雨 Thunderstorm elif ICON_ID == \u0026#34;11n\u0026#34;: ICON = \u0026#34;⛈\u0026#34; # Night, 雷雨 Thunderstorm elif ICON_ID == \u0026#34;13d\u0026#34;: ICON = \u0026#34;❄\u0026#34; # Day,雪 Snow elif ICON_ID == \u0026#34;13n\u0026#34;: ICON = \u0026#34;❄\u0026#34; # Night, 雪 Snow elif ICON_ID == \u0026#34;50d\u0026#34;: ICON = \u0026#34;🌫\u0026#34; # Day, 雾 Mist elif ICON_ID == \u0026#34;50n\u0026#34;: ICON = \u0026#34;🌫\u0026#34; # Night,雾 Mist else: ICON = \u0026#34;天气 \u0026#34; # 其他 Just Weather Icon CURRENT = REQ.json()[\u0026#34;weather\u0026#34;][0][\u0026#34;description\u0026#34;].capitalize() TEMP = int(float(REQ.json()[\u0026#34;main\u0026#34;][\u0026#34;temp\u0026#34;])) WIND = int(float(REQ.json()[\u0026#34;wind\u0026#34;][\u0026#34;speed\u0026#34;])) # 输出格式 print(\u0026#34;{} {}, {} °C 🌬 {}m/s\u0026#34;.format(ICON, CURRENT, TEMP, WIND)) else: print(\u0026#34;Error: BAD HTTP STATUS CODE \u0026#34; + str(REQ.status_code)) except (ValueError, IOError): print(\u0026#34;Error: Unable print the data\u0026#34;) EOF 测试一下，正常可以在终端输出天气\n1 python3 ~/.config/polybar/weather-plugin.py polybar引用 编辑配置文件 ~/.config/polybar/config.ini 添加一行\n1 2 3 4 5 6 7 ; ===天气预报 需要单独的pyhtone插件=== [module/weather] type = custom/script exec = python3 ~/.config/polybar/weather-plugin.py interval = 960 tail = true click-left= exec firefox https://openweathermap.org/city/1793724 完毕 ","date":"2023-05-13T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/polybar-weather-plugin/","title":"polybar天气预报插件"},{"content":"openwrt一般自带的ssh服务器 是dropbear ,而不是其他linux产用的openssh。dropbear 更加轻量化，更适合嵌入式设备。但是dropbear的文件传输只支持scp而不支持sftp。\n但是某些适合，scp协议无法替代sftp。所以还是要处理一下。\n一般情况下，直接安装 openssh-sftp-server 后 dropbear就可以支持sftp但是有时候不生效。\n为了节省时间去检查排错，有两个方案 1、使用rclone serve 或者sftpgo直接搞定sftp 2使用openssh替换掉dropbear\n2023 09 12 更新，硬盘不紧张的话 建议固件编译的时候就 使用openssh\n使用rclone 安装rclone opkg仓库安装\n1 opkg install rclone 或者手动安装，注意选择你的cpu架构\n1 2 3 rm -rf rclone* \u0026amp;\u0026amp; wget -c https://ghproxy.com/https://github.com/rclone/rclone/releases/download/v1.62.2/rclone-v1.62.2-linux-amd64.zip unzip rclone*.zip cp rclone-v1.62.2-linux-amd64/rclone /usr/bin/ \u0026amp;\u0026amp; chmod +x /usr/bin/rclone \u0026amp; rm -rf rclone* 配置本地储存节点 1 rclone config --config /etc/rclone/rclone.conf 添加一个本地储存 ，或者直接在rclone.conf文件添加\n1 2 [localhost] type = local 搭建服务 编辑 /etc/rc.local 在exit 0前面 添加一行，或者路由器界面中 系统\u0026gt; 启动项\u0026gt; 本地其中脚本中输入\n1 2 3 rclone serve sftp localhost:/ --addr :1022 --user 用户名 --pass 密码 --dir-cache-time 10s --config /etc/rclone/rclone.conf \u0026amp; rclone serve ftp localhost:/ --addr :1021 --user 用户名 --pass 密码 --dir-cache-time 10s --config /etc/rclone/rclone.conf \u0026amp; rclone serve webdav localhost:/ --addr :1023 --user 用户名 --pass 密码 --dir-cache-time 10s --config /etc/rclone/rclone.conf \u0026amp; 上面的命令，没一行对应一个服务协议，选择你需要的即可。一般局域网内没必要sftp，ftp性能更好 重启路由器即可，或者 手动运行一次 上面命令。\n使用openssh 首先给root一个设置密码 过程略 sd\n修改dropbear端口 1 2 3 uci set dropbear.@dropbear[0].Port=2222 uci commit dropbear /etc/init.d/dropbear restart 然后客户端重新连接 ssh root@10.1.1.1 -p 2222\n这样 dropbear 就在2222 临时提供 ssh和scp协议\n安装openssh 和sftp 1 2 3 4 rm /etc/ssh/sshd_config #如果有这个文件最好删掉 重新配置 opkg update opkg install openssh-server opkg install openssh-sftp-server 修改配置文件 1 nano /etc/ssh/sshd_config 需要修改和检查多数\n1 2 3 UsePAM yes PermitRootLogin yes Subsystem sftp /usr/lib/sftp-server 启动或者重启 1 2 /etc/init.d/sshd enable /etc/init.d/sshd restart 客户端连接 部分客户端 可能需要处理 .ssh/known_hosts 文件或者密钥\n最后禁用dropbear 非必需\n1 2 /etc/init.d/dropbear disable /etc/init.d/dropbear stop 路由器这个圈子，不忍直视。一个错误的恩山论坛回帖 能转载的整个简中网都是。\n","date":"2023-05-11T13:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/sftp/","title":"openwrt /Dropbear 开启sftp完整记录"},{"content":"nas和个人电脑最强备份工具kopia的一些记录和技巧以及避坑\nkopia和Restic 对比，功能差不太多。最大的区别是kopia自己支持压缩。restic的的压缩依赖文件系统（brtfs/ntfs）或者rclone后端压缩。 rclone的后端压缩目前1.6.1版本还是不稳定状态。\n另外kopia 有一个kopiaUI 图形界面，可以在X桌面下更直观的使用。也是他的一个优势。\nKopia的压缩和去重速度都要吊打一众备份软件，restic虽然可以去重，但是只能算第二。 最后kopia的github issues 社区很活跃，我在使用的时候，有几个问题都是从issues找到的答案，或者是别人在issues告知的。\n之前一直用的Duplicati 对比起来真的 是渣渣\nkopia，里面有几个概念 1 repository 储存库，可以理解为就是备份目的地，这个目的地 可以是本地硬盘，nas，以及kopia自己支持或者rclone支持的云端 2 repository create 就是储存库 首次使用的初始化，你可以自定义 加密 压缩 版本 目录 结构等 。 3 repository connect 就是去连接指定的储存库，一个初始化过的储存库，可以在 其他设备上用kopia去连接。 4 snapshot 快照，不用解释了吧。 5 source 备份源，必须是本地路径/nas。kopia是以路径来归类管理快照，所以最好ln一下要备份的东西，统一化路径风格，防止乱糟糟的 那么首次使用的时候，先去 初始化一个储存库，然后连接储存库，然后操作快照（备份/挂载/查看/删除/恢复/合并等）\n如果不是首次使用，就跳过初始化的步骤即可。\nkopia 的后端储存库[也就是储存库] 支持本地目录，nas,s3 webdav 等储存，另外几乎支持所有rclone支持的后端，也开始直接调用rclone来处理。 对webdav也有很好的支持！ 那么国内环境下，kopia 就可以利用 alist / rclone 对nas进行备份。 而且是加密+压缩备份，到阿里云盘 这种大容量且不怎么限速的网盘。\n这种自己可以控制 管理的方法，比群晖的那个网盘备份香多了。\n官网下载的：kopia 是命令行版本 kopia-ui 就是ui版了，两个功能都是完全一样的。\n几个坑 kopia v0.13.0 rc1包括rc1 之前的版本 ，和目前最新的rclone1.6.1 不太兼容，要rc2 或者 0.13.0正式版。鉴于kopia还很年轻，所以如果你当前版本能正常使用用，rclone和kopia谨慎升级。 kopia 通过webdav连接alist挂载的阿里云盘的时候，必须打开本地代理。感谢 ericma15 kopia常用命令记录 shell中免输入储存库密码 1 export KOPIA_PASSWORD=\u0026lt;密码\u0026gt; 连接到webdav 1 2 kopia repository create webdav --url=http://localhost:8080/kopai33 --webdav-username webdav --webdav-password 123 # 或者connect 连接到rclone 1 2 kopia repository create rclone --remote-path=\u0026#34;alist-local:/alipan/kopia-test/111\u0026#34; # 或者connect 创建快照 [即：备份一个目录到后端储存库] 要先connect\n1 kopia snapshot create /mnt/nas/doc_code 查看快照 要先connect\n1 kopia snapshot list /mnt/nas/doc_code 删除快照 只会删除这个快照独有的文件\n1 kopia snapshot delete \u0026lt;id\u0026gt; 从一个快照恢复 建议mount 挂载后用cp sync等，更加直观，而不是这里恢复。\n1 2 kopia snapshot restore \u0026lt;sources\u0026gt; restore kffbb7c28ea6c34d6cbe555d1cf80faa9/subdir1/subdir2 sd2 挂载 1 kopia mount [path] [mountPoint] 常用实例和常见问题 连接到alist中的阿里网盘 1 2 3 4 5 6 7 8 9 export KOPIA_PASSWORD=节点密码 #默认密码 export KOPIA_CHECK_FOR_UPDATES=false # 禁止kopia自动更新 mkdir -p /root/cache_kopia/alist /root/kopia repository connect webdav \\ --url=http://10.1.1.201:5244/dav/alipan/kopia \\ --webdav-username=alistUserName \\ --webdav-password=AlistPSW \\ --cache-directory=/root/cache_kopia/alist \\ --content-cache-size-limit-mb=50 2023-10-09补充：虽然kopia0.14.1和alist v3.28.0 之间可以直连，不需要rclone打通，但是长期使用是否存在问题尚不可知。\n暂时的建议 还是rclone中转一下\n连接到同济等无管理员无api的onedrive 较为稳妥办法是通过rclone 先用webdav连接到onedrive\n1 2 3 4 5 6 export KOPIA_PASSWORD=节点密码 #默认密码 export KOPIA_CHECK_FOR_UPDATES=false # 禁止kopia自动更新 mkdir -p /root/cache_kopia/tongji /root/kopia repository connect rclone --remote-path=tongji-webdav:/kopia \\ --cache-directory=/root/cache_kopia/tongji \\ --content-cache-size-limit-mb=50 实际测试 除了上传速度较慢以及内存占用多一些之外并没有其他问题\n连接到rclone 1 kopia repository connect rclone --remote-path=cloudflare:/mydisk/kopia2 rclone和kopia的兼容 主要是版本之间的兼容性有问题。 kopia \u0026lt; v0.13.0 does not work with any version of rclone \u0026gt; 1.61\nalist和kopia的兼容 注意，alist本身的webdav一直不太完善，初次之外网盘的挂载也不是很稳定。如果kopia连接到alist的时候有问题，请先确保对应的节点可以方法。另外alist 对kopia的支持一直有一些问题，可选的解决方案：\nalist更新到 v3.28.0 在这个版本中修复了 https://github.com/alist-org/alist/issues/5161 这个错误 alist 添加网盘的储存的时候 WebDAV 策略 要选 本地代理 中间使用rclone转发一次\n另外 在使用阿里云盘的时候，注意阿里云盘的接口的一些限制，也会导致kopia这边报错。 ","date":"2023-05-05T14:14:20+08:00","permalink":"https://dev.leiyanhui.com/nas/kopia/","title":"kopia cli中文快速入门指南 1分钟学会"},{"content":"对比和感受 2023-0519 补充：filerun免费版可以说是目前 最强大且最简单易用的 最流畅 细节做的最好 适合中小团和个人的网盘程序。\ncloudreve 界面起来漂亮，但是实际使用小问题很多，甚至视频播放都没有方便的返回键。webdav有严重问题，反馈很多次作者无视觉得自己很好。不支持硬盘文件扫描 seafile 这。。。蛋疼的玩意，丑且功能弱鸡，性能也拉跨 filebrower 小巧灵活，但是功能少太多了，只适合简单的场合使用 或者路由器等硬件受限的情况 alist 它的本地文件管理功能，只能说是凑合。毕竟它只是顺带做了一下，人家专业不在这里 nextcloud/owncloud 很强，php8以后性能也完全ok,但是webui 真的太卡了。 unraid 这个还是aio平台，他的所谓nas功能只是弱鸡，作为aio是pve的弟弟，作为nas核心功能和性能也被一众免费软件吊打 群晖 很优秀 ，但是也仅适合linux小白管理员，可以几乎无脑搭建一个功能完善的nas+网盘程序。灵活性不足，黑群晖不稳定。 filerun的比这些网盘程序优秀的地方： webui极度流畅舒适！成熟度高 硬件性能要求低，树莓派，N1 等都可流畅运行，一般x86的软路由器更不在话下 性能优化卓越，新版本基于php8.1 性能爆发式增长，在这种io密集应用上，性能已经和go的基本持平。firerun的旧版在早已经可以轻松跑慢千兆，万兆下也有8-900MB/s的速度 保持本地目录结构，可以方便的扩充磁盘 。以及和smb nfs sftp ftp协议的扩展。 手机客户端可以用免费的nextcloud/owncloud 的app 解决同步问题，当然也有很多支持webdav的程序 优秀的缩略图配置，包括视频的可以设置N秒的自动截图。其他图片和office 文本文件 默认配置就已经很优秀。nextcloud/owncloud 也有同样的功能和配置参数，但是相对复杂一些 简单易用并安全的在线office配置，同样的只有 nextcloud/owncloud 和 seafile 可以比肩。cloudreve最近才支持，但是对应的权限部分cloudreve并不支持。 而且cloudreve的webui连个返回按钮都没有。 自定义文件名文件名后缀的编辑器和预览，目前只有 nextcloud/owncloud 是同水平的。 其他要么没有，要么支持的格式或者编辑器预览工具太少 极度完善的几乎所有格式的文件的在线预览和编辑接口的支持，包括3d文件 ，ps文件等，参考上条。 极度舒适的视频在线播放 只有nextcloud/owncloud 是同水平的 优秀方便的音频播放器 只有nextcloud/owncloud 是同水平的 webui 个性化定制功能善，当然收费版本功能非常完善，免费版的简单一些，但是也够用 完善的webdav支持，很多号称支持webdav的网盘程序，实际上wevdav都有一些问题。 手机客户端的完善支持，filerun的api兼容nextcloud/owncloud 可以直接使用nextcloud/owncloud 的手机客户端app。当然其他支持webdav等协议的app更没问题。 文件同步功能完善，因为兼容nextcloud/owncloud 的api可以直接使用他们的客户端。另外因为filerun是为数不多的可以对webdav的完善支持的软件，所以也可以使用rclone kopia等优秀第三方软件 。另外因为文件储存接口是本地硬盘的结构 filerun相对的缺点：\n基于php 就决定了他的依赖复杂，整体磁盘占用要比go语言的的那些大一写，go的几M到几十M,pythone类的也就几百几十M就够了。 毕竟一个裸机linux+php相关依赖 已经到1.5G左右的磁盘占用了。在独立lxc运行的时候，这个磁盘占用就明显了。 在磁盘紧张的硬路由上不适合。 数据库只可以用mysql/mariadb，不支持文件类型数据库（比如sqlite），和pgsql等其他数据库。这就意味着，低性能的老式路由器 就别想了。但是树莓派之类的arm还是可以i的。 非开源软件 ，虽然成熟度很高，但是作为一个免费用户，你如果想去掉版权特征之类的还是略微有一点麻烦。 非国产软件，这算优点还是缺点呢？ 免费版默认5用户，注册后可以10用户，但是注册需要公网可访问，且更换域名需要重新注册。 用户配额管理以及一些高级功能是收费功能，除了nextcloud/owncloud 其他的网盘程序相关功能也基本都是收费的。 中文社区支持不好，需要你自己会一点linux docker的知识，后面有手把手的教程 可以完成中文汉化和office中文缩略图等。 基于磁盘的文件结构，在大量小文件的时候会性能下滑这是所有此类文件结构的网盘的通病。但是这里的大量是指的同目录下的万级 目前版本还是没有自带网络云储存的支持，甚至都不支持常见的S3协议，你需要另外用alist/rclone 挂载。 原文： 在ｎａｓ系统的这几年的折腾中，遇到很多问题，最终决定随大流，迁移到　nextcloud的怀抱，但是nextcloud webui卡顿很烦。所以决定先用filerun，慢慢研究nextcloud的优化。 filerun 基本上相当于nextcloud的 轻量优化版本。 最大的优势 就是使用简单 速度快。缺点 不开源 限制多 功能少很多。 我大概看了一下免费版filerun对开源版nextcloud 比较常用功能缺失的有：即时通讯聊天软件功能、日历功能、邮件中心、账户限额、最多10人的限制\n其实最大的不同 就是 10人限制 和 配额的问题。其实这个问题可以 用 sftpgo 或者rclone serve模式搞定，以后或许会写一个文章。\n另外filerun 不支持sqlite，只支持 mysql/mariadb，也就是说哪怕就你一个人用，你也要跑一个数据库服务（filerun也不支持postgreSql）。\n准备安装 我这里是pve平台，用lxc套娃docker方式。性能几乎没有损耗。要比虚拟机方式好很多。 硬盘直通：硬盘是 在pve上 /dev/sda1 机械硬盘\n新建CT容器 当然你用虚拟机或者直接docker 都可以。alpine3.17 2G 8G 特权容器 ，内存给多一点. CT id为 10083 分别IP 10.1.1.83/24 创建完成后不要启动\n解决特权容器嵌套docker的问题。 在这个容器的 选项功能里面 勾选上 嵌套，最好Fuse smb nfs也勾选上\n1 2 3 4 5 6 # pve执行 export lxcid=10083 #修改这个id echo \u0026#34;lxc.apparmor.profile: unconfined\u0026#34;\u0026gt;\u0026gt; /etc/pve/lxc/${lxcid}.conf echo \u0026#34;lxc.cgroup.devices.allow: a\u0026#34;\u0026gt;\u0026gt; /etc/pve/lxc/${lxcid}.conf echo \u0026#34;lxc.cap.drop:\u0026#34;\u0026gt;\u0026gt; /etc/pve/lxc/${lxcid}.conf cat /etc/pve/lxc/${lxcid}.conf 直通硬盘 1 2 3 # pve执行 export lxcid=10083 #修改这个id pct set ${lxcid} -mp0 /dev/sda1,mp=/mnt/sda1 # mp0 mp1 mp2 ··· mpN 可直通多个硬盘 alpine系统准备 其他系统一样自行替换命令,容器开机后 登录，在容器内执行\n源和时区 1 2 3 4 5 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata 开启ssh 1 2 3 4 apk add openssh rc-update add sshd boot sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config #允许root密码登陆 service sshd restart 安装docker 1 2 3 4 5 6 7 8 9 10 11 12 13 apk add docker docker-compose rc-update add docker boot mkdir /etc/docker/ cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt; EOF { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;http://hub-mirror.c.163.com\u0026#34;, \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34; ] } EOF service docker restart \u0026amp;\u0026amp; sleep 2s docker version 安装filerun 因为php写的依赖实在太多，我这里直接docker来跑。 如果你环境里已经有 mysql/mariadb 可以调整一下下面的文件。\n用官网推荐的 直接用官网的方式安装即可 https://docs.filerun.com/docker 其中全文搜索，我这边部署出错，不确定具体原因。加上我这里确实用不到,没有继续研究，就用了基础安装。 主意把里面的 路径修改为实际路径。另外就是 filerun的版本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 docker stop filerun_web_1 \u0026amp;\u0026amp; docker rm filerun_web_1 docker stop filerun_db_1 \u0026amp;\u0026amp; docker rm filerun_db_1 rm -rf ~/filerun \u0026amp;\u0026amp; mkdir -p ~/filerun/html \u0026amp;\u0026amp; mkdir -p ~/filerun/db cat \u0026gt; ~/filerun/docker-compose.yml\u0026lt;\u0026lt; \\EOF version: \u0026#39;2\u0026#39; services: db: image: mariadb:10.1 environment: TZ: \u0026#39;Asia/Shanghai\u0026#39; MYSQL_ROOT_PASSWORD: root_psw_T2Z6hpD9iJtppQ MYSQL_USER: fr_username MYSQL_PASSWORD: fr_db_psw_FKsAPdjaqUug48 MYSQL_DATABASE: filerun_db volumes: - ~/filerun/db:/var/lib/mysql web: image: filerun/filerun:8.1 environment: TZ: \u0026#39;Asia/Shanghai\u0026#39; FR_DB_HOST: db FR_DB_PORT: 3306 FR_DB_NAME: filerun_db FR_DB_USER: fr_username FR_DB_PASS: fr_db_psw_FKsAPdjaqUug48 APACHE_RUN_USER: www-data APACHE_RUN_USER_ID: 33 APACHE_RUN_GROUP: www-data APACHE_RUN_GROUP_ID: 33 depends_on: - db links: - db:db ports: - \u0026#34;80:80\u0026#34; volumes: - ~/filerun/html:/var/www/html - /mnt/sda1:/user-files EOF cd ~/filerun \u0026amp;\u0026amp; docker-compose up -d 2023 -05-22 filerun已经关闭免费用户，大概是作者可能感受到了一些免费用户的不太愉快的语言后，就直接关闭了。 2023.1版本免费版本的最后一个版本，并且 是不可用的状态。同时在作者发布公告之前，他删除了旧版的docker镜像！\n闭源个人软件 还是谨慎一些，不过好在支持本地目录储存。可以方便的平滑迁移到nextcloud\n2023-05-05补：filerun在创建的时候，Apache可以指定用户。解决和smb冲突的权限问题。 修改前面的 APACHE_RUN_USER 和APACHE_RUN_GROUP_ID\n另外 volumes根据你的实际情况自己修改一下\n启动filerun 1 docker-compose up -d # 要先cd到docker-compose.yml 所在目录 如果无法启动成功，查看一下\n1 2 docker logs -f filerun_web_1 # 可以看到少目录 mkdir -p ~/filerun/html/system/data/temp/ 配置 访问 http://10.1.1.83/ 一路下一步即可， 最后创建了 一个超级用户 superuser 记住密码 去 登录\n修改密码 点左下角 Control panel 进入后台面板，在点右上角 Admin user ，找到superuser 修改掉 用户名和密码 , 保存后 重新刷新页面，重新登录即可\n关于重启后无法启动的问题 上面的 docker-compose 命令的问题，修复一下\n1 2 docker ps -a -q # 查看 容器的id docker update --restart=always 容器的id 中文 filerun切换中文语言 获取语言包并上传方法\nonlyoffice 使用 filerun 内置了多种office的接口，一般情况下 启用 google 和 onlyoffice 就足够用了。\nonlyoffice 兼容性很好，而且支持私有化部署。google的话需要科学环境和申请api\nonlyoffice的部分 可以本站搜索\n这里提供一个 使用nginx过滤 onlyoffice wopi的来源的 一个配置文件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 upstream docservice { server 10.1.1.84:8080; } map $http_host $this_host { \u0026#34;\u0026#34; $host; default $http_host; } map $http_x_forwarded_proto $the_scheme { default $http_x_forwarded_proto; \u0026#34;\u0026#34; $scheme; } map $http_x_forwarded_host $the_host { default $http_x_forwarded_host; \u0026#34;\u0026#34; $this_host; } map $http_upgrade $proxy_connection { default upgrade; \u0026#34;\u0026#34; close; } proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $proxy_connection; proxy_set_header X-Forwarded-Host $the_host; proxy_set_header X-Forwarded-Proto $the_scheme; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #陷阱主机 server { listen 10011 ssl; server_name trap.jia.leiyanhui.com; include /etc/nginx/sites-enabled/ssl-jia.leiyanhui.com.conf.noAutoLoad; root /usr/share/nginx/html; } #真实主机 server { listen 10011 ssl; server_name office-XXXXXXXX.jia.leiyanhui.com; server_tokens off; include /etc/nginx/sites-enabled/ssl-jia.leiyanhui.com.conf.noAutoLoad; add_header Strict-Transport-Security \u0026#34;max-age=1209600; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff; location /hosting/wopi { if ( $args ~ wopisrc=https%3A%2F%2Fpan.jia.leiyanhui.com%3A ) { proxy_pass http://docservice; } proxy_http_version 1.1; } location / { valid_referers none blocked *.jia.leiyanhui.com; if ($invalid_referer) {return 403;} proxy_pass http://docservice ; proxy_http_version 1.1; } } nginx反代 并且加ssl nginx 反代 需要注意 文件大小 超时 等 参考我的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 server { server_name XXXX; listen 50443 ssl http2; ssl_certificate /root/ssl/XXX; ssl_certificate_key /root/ssl/XXX; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 50442; if ($scheme = http) { return 301 https://:50443; } error_page 497 https://$host:50443; location / { add_header Cache-Control no-cache; add_header Cache-Control private; expires -1s; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_connect_timeout 36000s; proxy_read_timeout 36000s; proxy_send_timeout 36000s; proxy_request_buffering off; send_timeout 36000s; proxy_redirect off; proxy_pass http://10.1.1.80:5212/; client_max_body_size 20000m; } } 从其他系统导入文件 直接移动到 /mnt/sda1/filerun_files 即可，但需要修改一下权限\n1 docker exec -it filerun-docker_web_1 chown -R www-data:www-data /user-files 预览和编辑部分 中文乱码 需要处理字体\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 docker exec -it filerun-docker_web_1 bash ---------------- apt update apt install wget unzip mkdir /usr/share/fonts/truetype/winfonts \u0026amp;\u0026amp; cd /usr/share/fonts/truetype/winfonts wget -c https://ghproxy.com/https://github.com/joyanhui/file.leiyanhui.com/archive/refs/heads/windows_font.zip unzip windows_font.zip mv file.leiyanhui.com-windows_font/* . rm -rf file.leiyanhui.com-windows_font rm -rf windows_font.zip fc-cache -f rm -rf /user-files/.filerun.* exit ---------- docker restart filerun-docker_web_1 # 重启docker 之后新上传的文档 就可以了显示中中文了。如果还有文件不可以 ，就要docker 里面 清理掉 和文档同一个目录的 .filerun.* 文件夹。或者\n1 2 3 4 docker exec -it filerun-docker_web_1 bash ---------------- cd /user-files/ find . -name \u0026#39;.filerun.*\u0026#39; -type d | xargs rm -rf # 注意安全！！！！ doc文件缩略图的方块 暂时不知道 怎么处理 ，留个坑\n1 apt install fonts-wqy-zenhei # 貌似搞定 时区修改 https://docs.filerun.com/time_zone\n定义样式 https://docs.filerun.com/custom_css\n备份 我这里是lxc运行的。只需要备份 lxc的 conf 以及 docker-compose.yml 就好了。\n因为 filerun 可以自动扫描硬盘的文件，加上 我们是免费用户，所以用户数也不会多，数据库 可以不备份。 只需要我们备份 filerun 的配置文件即可。\n也就是 XXXX:/var/www/html 目录 数据库存在mysql里面也可以导出备份\n也可以 整个lxc 备份到 压缩包\n","date":"2023-04-19T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/nas/filerun-install/","title":"filerun　搭建和使用　以及常见问题"},{"content":"filerun 免费版停止更新，最后的免费版2023.1 作者看起来情绪很大，不打算继续修复了。而且他在没决定取消免费之前就删掉了旧版的docker镜像，只保留了最新不可用的7.4 和8.1两个镜像。\n考虑到群晖之类的还是过于折腾，而寄予厚望的 cloudreve半死不活，功能弱鸡，bug一堆作者一直不修复。 所以迁移到nextcloud， 除了卡一点 一切都安逸。\n使用nextcloud 几个注意点，\nmysql要8.0 或者 MariaDB10.2 以后的版本 pgsql虽然理论性能更强，实际使用有一些小问题 如果内存有富裕，务必开redis sftp ftp webdav协议，建议走rclone server， nextcloud的webdav一般般 有小问题，rclone的很稳 需要gmp扩展，宝塔直接装可能装不不上，需要先 apt install libgmp3-dev 宝塔坑更多哈 nextcloud 很多坑很多坑，docker版本也有一些问题。php熟悉的建议手工搭建php环境，宝塔熟悉常见坑处理的也可以跑起来。 setup-nextcloud.php 自动拉下来的包里面 .htaccess 有问题的，需要自己修。我对apache是不是特别熟悉，更喜欢nginx,但是官网明确说 官网之支持apache2.x 其他的web服务器只有第三方文档支持，不过还好。nginx太容易搞定了。 命令行模式的那个php内存提醒，需要修改php.ini ，修改完成后，如果依旧提示，需要重启php-fpm 以及 nginx php-fpm.conf 需要添加一个参数 总的来说 nextcloud很强很强，但是 绝对不是开箱即用的方案，即便docker搭建完成后，后续也有很多小坑。php小白最好别碰。宝塔可以解决一部分环境问题\n需要的php扩展 宝塔下额外需要安装的，这几个最好都装上。 fileinfo opcache memcached/redis apcu imagemagick imap exif xsl gmp zstd mailparse\n安装 安装很简单，提前创建好mysql/mariadb数据库，环境ok的下载 setup-nextcloud.php 到 php运行目录，执行即可，如果超时 一个注意php执行时间 另外一个是它是从境外下载的，所以你需要处理加速的问题。\n启用软连接 可以方便直接指向原来的数据目录\n配置文件添加 1 2 \u0026#39;filesystem_check_changes\u0026#39; =\u0026gt; true, \u0026#39;localstorage.allowsymlinks\u0026#39; =\u0026gt; true, 这里有小坑，我之前一直扫描不到文件，后来重启nginx和php-fpm 后就好了。\n软连接创建 1 2 mv /www/wwwroot/nextcloud.com/data/XXXX/files /www/wwwroot/nextcloud.com/data/XXXX/files-bak ln -s /mnt/sda1/myfiles/ /www/wwwroot/nextcloud.com/XXXX/yanhui/files 注意权限，宝塔是 www:www 所有，或者干脆 777 也行\n扫描一次磁盘 1 2 cd /www/wwwroot/nextcloud.com sudo -u www php occ files:scan --all php-fpm.conf 的修改 添加这几行，不然后台会提示env空\n1 2 3 4 5 env[HOSTNAME] = $HOSTNAME env[PATH] = /usr/local/bin:/usr/bin:/bin env[TMP] = /tmp env[TMPDIR] = /tmp env[TEMP] = /tmp nginx 配置文件 解决了所有问题，但是没有开启https，因为我这里https 是单独由另外一个nginx管理的\nhttps://github.com/joyanhui/file.leiyanhui.com/blob/main/nextcloud/nginx-site.cnf\nnextcloud 配置文件 https://github.com/joyanhui/file.leiyanhui.com/blob/main/nextcloud/config.php\n注意也没开https nextcloud 后台设置会 复写 这个文件，所以里面不可以加其他语法，会被覆盖掉。\nnginx 反向代理 https://github.com/joyanhui/file.leiyanhui.com/blob/main/nextcloud/nginx-proxy.conf\n这里启用了ssl,需要另外修改config.php 里面的 'overwriteprotocol' =\u0026gt; 'http', 为 'overwriteprotocol' =\u0026gt; 'https', 另外此反向代理文件在 nextcloud 26.0.1 版本 后台 依旧会提示 webfinger 和 nodeinfo错误，但是不影响使用\n","date":"2023-04-19T00:01:20+08:00","permalink":"https://dev.leiyanhui.com/nas/nextcloud/","title":"nextcloud 安装和使用 以及配置文件 和避坑指南"},{"content":"openwrt其实是可以手动指定部分设备的网关的。可以实现局域网内部分设备用指定的网关自动自动dhcp\n场景 设备A 主路由 IP:10.1.1.1 设备B 旁路由/网关 IP:10.1.1.6\n自己的手机 IP:10.1.1.71 自己笔记本 IP:10.1.1.72\n家人设备 IP段： 10.1.1.200-254\n操作 主路由和旁路路由 谁开dhcp 都不影响 下面的操作。 本文内容是openwrt dhcp的指定网关，所以主路由和旁路路由 负责dchp的设备肯定是openwrt的系统。 登陆 这个负责dchp的设备的webui界面，在dhcp静态分配的地方先配置好静态ip。\n而后 ssh登陆这个设备，编辑文件 /etc/config/dhcp，如果你对linux不熟悉 可以用winscp 之类的软件下载到本机修改，并做好备份。 需要编辑两个地址，1是添加一个tag 2是修改需要用10.1.1.6作为网关的设备让他使用这个tag\n在文件的第一个 config host 段落前面添加一段，内容\n1 2 3 config tag \u0026#39;need_outernet\u0026#39; list dhcp_option \u0026#39;3,10.1.1.6\u0026#39; option force \u0026#39;1\u0026#39; 10.1.1.6 就是我们需要的网关地址 need_outernet 是tag的名称，可以用别的名字 找到 需要配置旁路网关的设备，添加上这个 tag 就是加一行 option tag 'need_outernet' 例如 iphoneL 和reamme 这两个都是我的手机，k2p是一个做AP用的硬路由，原来的格式如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ... ... config host option name \u0026#39;realme\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;D0:97:FE:DC:XX:XX\u0026#39; option ip \u0026#39;10.1.1.72\u0026#39; config host option name \u0026#39;k2p\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;74:7D:24:BE:XX:XX\u0026#39; option ip \u0026#39;10.1.1.2\u0026#39; config host option name \u0026#39;iphoneL\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;3A:9F:13:9D:XX:XX\u0026#39; option ip \u0026#39;10.1.1.71\u0026#39; ... ... ... 修改为后\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ... ... config host option name \u0026#39;realme\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;D0:97:FE:DC:XX:XX\u0026#39; option ip \u0026#39;10.1.1.72\u0026#39; option tag \u0026#39;need_outernet\u0026#39; config host option name \u0026#39;k2p\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;74:7D:24:BE:XX:XX\u0026#39; option ip \u0026#39;10.1.1.2\u0026#39; config host option name \u0026#39;iphoneL\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;3A:9F:13:9D:XX:XX\u0026#39; option ip \u0026#39;10.1.1.71\u0026#39; option tag \u0026#39;need_outernet\u0026#39; ... ... ... 修改完成后 保存推出。 vi/vim 是按下 esc，然后按下键盘上 :wq ,nano的话 ctrl+x ，然后 y确认回车 执行 dnsmasq --test 检查，应该会提示 dnsmasq: syntax check OK. 那就是可以了。 然后重启 dns 命令: /etc/init.d/dnsmasq restart。 而后 两个手机重新连接一下wifi 就好了。台式机话重新拔插网线或者禁用启用一下网卡。\n最后，一个完整的/etc/config/dhcp 参考如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 # 前面可能有 dnsmasq lan wan odhcpd srvhost # config tag 这段是我们添加的 config tag \u0026#39;need_outernet\u0026#39; list dhcp_option \u0026#39;3,10.1.1.6\u0026#39; option force \u0026#39;1\u0026#39; # config host 是对应静态地址分配的每一个设备 config host option name \u0026#39;kvm-win10\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;2A:95:2A:A1:37:9D\u0026#39; option ip \u0026#39;10.1.1.10\u0026#39; config host option name \u0026#39;realme\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;D0:97:FE:DC:XX:XX\u0026#39; option ip \u0026#39;10.1.1.72\u0026#39; option tag \u0026#39;need_outernet\u0026#39; config host option name \u0026#39;k2p\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;74:7D:24:BE:XX:XX\u0026#39; option ip \u0026#39;10.1.1.2\u0026#39; config host option name \u0026#39;iphoneL\u0026#39; option dns \u0026#39;1\u0026#39; option mac \u0026#39;3A:9F:13:9D:XX:XX\u0026#39; option ip \u0026#39;10.1.1.71\u0026#39; option tag \u0026#39;need_outernet\u0026#39; # 还有其他设备的 config host 段落 ","date":"2023-04-16T13:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/openwrt-other-netgay/","title":"openwrt dhcp指定不同网关的解决版本"},{"content":"ipad4 古董，多数app已经无法运行，很多网站浏览器也已经打不开。 infuse 旧版可以安装，但是不支持webdav，但是可以通过 smb的方式 访问alist的内容。 只是infuse 虽然足够简单易用，但是依旧不适合家中老人使用，操作还是有一点繁琐。 考虑到简单使用方案，一切皆home键解决。\n另外老人喜欢看电视剧多数为国语老电视剧，这些资源在网络上非常容易找到。但是有一些资源，ipad4并无法直接播放，需要转码，或者压缩。\n这样一来工作量就复杂了很多。\n经过测试以后，发现 阿里云盘网页版的播放器可以自己转码并兼容旧设备（但是ipad4 已经打不开阿里云盘的网页），而alist恰恰又内置了这个播放器。\n所以这个ipad上访问的视频直接从alist的阿里网盘来，而不通过nas\n反复几次花了几个小时尝试各种app和方案后，最后决定 alist webapp + 阿里云盘 来实现。并用javescript+css 修改alist web界面，在ipad上创建 webapp 快捷方式的方法来。\n搭建alist 并挂载 阿里云盘 过程 略。这里单独创建一个alist账号 ，用户名为 ipad，给ipad4 用。 另外因为近期阿里云盘的接口不稳定，我的大容量账号经常性超限，单独注册2个小账号。从我自己的账号里面用分享转存的方式把视频转存过去。 alist 内 ma 这个账号的 首页文件夹 指向对应的账号。\n排序注意 选择文件名 正序\nipad4 配置 Safari打开alist网页端，勾选记住用户名密码（必须勾选）登录，然后 点分享 创建桌面快捷方式\nalist后台配置 设置全局，自定义内容位置输入\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u0026lt;script\u0026gt; if (window.localStorage.getItem(\u0026#34;username\u0026#34;) == \u0026#34;ipad\u0026#34;){ //检查记住的用户名 window.localStorage.setItem(\u0026#34;layout\u0026#34;,\u0026#34;grid\u0026#34;); // 显示方式强制grid document.writeln(\u0026#34;\u0026lt;style\u0026gt;.footer{display:none;}\u0026#34;); //隐藏底部 document.writeln(\u0026#34;.header-right{ position: absolute; right: 20px; top: 45px;}\u0026#34;); //保留 右侧小按钮 document.writeln(\u0026#34;.header{margin-top: -45px;}\u0026#34;); //移走顶部logo document.writeln(\u0026#34;#video-player{height:600px}\u0026#34;); //播放器高度 document.writeln(\u0026#34;button.hope-select__trigger{display:none;}\u0026#34;); //播放器选择高度 document.writeln(\u0026#34;.left-toolbar-box{display:none;}\u0026#34;); //隐藏右下角小按钮防止遮挡全屏按钮 document.writeln(\u0026#34;.hope-ui-light {--hope-colors-background: #000}\u0026#34;); //全局背景色 document.writeln(\u0026#34;.nav-link {color: #CCC;}.nav-separator {color: #CCC;}\u0026#34;); //导航条字体颜色 document.writeln(\u0026#34;.obj-box{background-color: #757575;}\u0026#34;); //主要容器背景色 document.writeln(\u0026#34;\u0026lt;/style\u0026gt;\u0026#34;); var intervalID = window.setInterval(function() { var video=document.querySelector(\u0026#39;video\u0026#39;); if (video!=null){ video.removeAttribute(\u0026#39;playsinline\u0026#39;); //移除 嵌套播放 自动全屏 貌似没用 } },500) window.setTimeout(\u0026#39;window.clearInterval(intervalID)\u0026#39;,10000); } \u0026lt;/script\u0026gt; \u0026lt;center\u0026gt;\u0026lt;a href=\u0026#34;http://10.1.1.23:8824/\u0026#34;\u0026gt;切换账号\u0026lt;a\u0026gt;\u0026lt;/center\u0026gt; 基于alist v3.16.0 这部分代码比较简单 主要是去掉一些老人用不到的按钮，修改播放器大小等，不用多解释 。颜色改黑色 心理安慰防烧屏。老人不太明白 全屏按钮\nhttp://10.1.1.23:8824/ 是后端一个自己写的 golang 的webhook，用于 轮流启动和关闭两个挂载不同阿里云盘账号的alist ，因为阿里云盘的接口限制还是玄学状态，这部分代码还在测试\n最终效果 不上图了。操作虽然繁琐，但是逻辑简单 看完一集 按home键，然后桌面打开alist图标，点文件夹 第几个就可以。 alist支持阿里云盘的视频封面，老人很容易记住自己看的第几集\n误操作 直接按home ，重新来过。alist 可以记录播放时间，还是挺方便。\n存在的问题 没法自动播放下一集，这个还好 影响不大 阿里网盘可能会掉挂载，这个暂时没办法。\n","date":"2023-04-15T12:14:20+08:00","permalink":"https://dev.leiyanhui.com/nas/alist-mod-ipad4/","title":"使用alist 让旧平板变成老人可用的傻瓜式视频播放器  之 webapp"},{"content":"依旧是 alpine系统，其他系统 自己替换对应命令 和包名称\n1 2 3 4 apk add samba apk add wsdd rc-update add samba rc-update add wsdd 文件权限，采取简单暴力手段，在crontab中 添加命令 一分钟一次\n1 2 #crontabl -e * * * * * docker exec -it filerun-docker_web_1 chown -R www-data:www-data /user-files filerun-docker_web_1 是filerun的容器名称\n2023-05-05补：filerun在创建的时候，Apache可以指定用户。解决权限问题。\n需要至少两个用户，用户1 有完整全新 用户2 只能读取某一个目录\n1 2 3 4 adduser yanhui -G root # deluser yanhui smbpasswd -a yanhui smbpasswd -a guest mv /etc/samba/smb.conf /etc/samba/smb.conf-bak 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # vi /etc/samba/smb.conf 编辑完成后重启 service samba restart [sda1] path = /mnt/sda1 comment = FileRun browseable = no writable = yes write list = yanhui valid users =yanhui display charset = UTF-8 unix charset = UTF-8 dos charset = cp936 [vod_ma] path = /mnt/sda1/filerun_files/vod/ma_smb comment = vod_ma browseable = Yes read only = Yes guest ok = Yes valid users = guest yanhui read list = guest write list = yanhui ","date":"2023-04-14T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/nas/filerun-smb/","title":"filerun docker 安装 怎么开启smb"},{"content":"点左下角 Control panel 进入后台面板， 点左侧 interface，再点 Upload language file 后面的按钮 上传语言文件 chinese.php 。\n然后刷新页面，Default language: 选择 chinese 保存，再刷新即可。\nchinese.php 获取方法。\n把下面代码复制另存为一个文本文件，文件名 chinese.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552 553 554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683 684 685 686 687 688 689 690 691 692 693 694 695 696 697 698 699 700 701 702 703 704 705 706 707 708 709 710 711 712 713 714 715 716 717 718 719 720 721 722 723 724 725 726 727 728 729 730 731 732 733 734 735 736 737 738 739 740 741 742 743 744 745 746 747 748 749 750 751 752 753 754 755 756 757 758 759 760 761 762 763 764 765 766 767 768 769 770 771 772 773 774 775 776 777 778 779 780 781 782 783 784 785 786 787 788 789 790 791 792 793 794 795 796 797 798 799 800 801 802 803 804 805 806 807 808 809 810 811 812 813 814 815 816 817 818 819 820 821 822 823 824 825 826 827 828 829 830 831 832 833 834 835 836 837 838 839 840 841 842 843 844 845 846 847 848 849 850 851 852 853 854 855 856 857 858 859 860 861 862 863 864 865 866 867 868 869 870 871 872 873 874 875 876 877 878 879 880 881 882 883 884 885 886 887 888 889 890 891 892 893 894 895 896 897 898 899 900 901 902 903 904 905 906 907 908 909 910 911 912 913 914 915 916 917 918 919 920 921 922 923 924 925 926 927 928 929 930 931 932 933 934 935 936 937 938 939 940 941 942 943 944 945 946 947 948 949 950 951 952 953 954 955 956 957 958 959 960 961 962 963 964 965 966 967 968 969 970 971 972 973 974 975 976 977 978 979 980 981 982 983 984 985 986 987 988 989 990 991 992 993 994 995 996 997 998 999 1000 1001 1002 1003 1004 1005 1006 1007 1008 1009 1010 1011 1012 1013 1014 1015 1016 1017 1018 1019 1020 1021 1022 1023 1024 1025 1026 1027 1028 1029 1030 1031 1032 1033 1034 1035 1036 1037 1038 1039 1040 1041 1042 1043 1044 1045 1046 1047 1048 1049 1050 1051 1052 1053 1054 1055 1056 1057 1058 1059 1060 1061 1062 1063 1064 1065 1066 1067 1068 1069 1070 1071 1072 1073 1074 1075 1076 1077 1078 1079 1080 1081 1082 1083 1084 1085 1086 1087 1088 1089 1090 1091 1092 1093 1094 1095 1096 1097 1098 1099 1100 1101 1102 1103 1104 1105 1106 1107 1108 1109 1110 1111 1112 1113 1114 1115 1116 1117 1118 1119 1120 1121 1122 1123 1124 1125 1126 1127 1128 1129 1130 1131 1132 1133 1134 1135 1136 1137 1138 1139 1140 1141 1142 1143 1144 1145 1146 1147 1148 1149 1150 1151 1152 1153 1154 1155 1156 1157 1158 1159 1160 1161 1162 1163 1164 1165 1166 1167 1168 1169 1170 1171 1172 1173 1174 1175 1176 1177 1178 1179 1180 1181 1182 1183 1184 1185 1186 1187 1188 1189 1190 1191 1192 1193 1194 1195 1196 1197 1198 1199 1200 1201 1202 1203 1204 1205 1206 1207 1208 1209 1210 1211 1212 1213 1214 1215 1216 1217 1218 1219 1220 1221 1222 1223 1224 1225 1226 1227 1228 1229 1230 1231 1232 1233 1234 1235 1236 1237 1238 1239 1240 1241 1242 1243 1244 1245 1246 1247 1248 1249 1250 1251 1252 1253 1254 1255 1256 1257 1258 1259 1260 1261 1262 1263 1264 1265 1266 1267 1268 1269 1270 1271 1272 1273 1274 1275 1276 1277 1278 1279 1280 1281 1282 1283 1284 1285 1286 1287 1288 1289 1290 1291 1292 1293 1294 1295 1296 1297 1298 1299 1300 1301 1302 1303 1304 1305 1306 1307 1308 1309 1310 1311 1312 1313 1314 1315 1316 1317 1318 1319 1320 1321 1322 1323 1324 1325 1326 1327 1328 1329 1330 1331 1332 1333 1334 1335 1336 1337 1338 1339 1340 1341 1342 1343 1344 1345 1346 1347 1348 1349 1350 1351 1352 1353 1354 1355 1356 1357 1358 1359 1360 1361 1362 1363 1364 1365 1366 1367 1368 1369 1370 1371 1372 1373 1374 1375 1376 1377 1378 1379 1380 1381 1382 1383 1384 1385 1386 1387 1388 1389 1390 1391 1392 1393 1394 1395 1396 1397 1398 1399 1400 1401 1402 1403 1404 1405 1406 1407 1408 1409 1410 1411 1412 1413 1414 1415 1416 1417 1418 1419 1420 1421 1422 1423 1424 1425 1426 1427 1428 1429 1430 1431 1432 1433 1434 1435 1436 1437 1438 1439 1440 1441 1442 1443 1444 1445 1446 1447 1448 1449 1450 1451 1452 1453 1454 1455 1456 1457 1458 1459 1460 1461 1462 1463 1464 1465 1466 1467 1468 1469 1470 1471 1472 1473 1474 1475 1476 1477 1478 1479 1480 1481 1482 1483 1484 1485 1486 1487 1488 1489 1490 1491 1492 1493 1494 1495 1496 1497 1498 1499 1500 1501 1502 1503 1504 1505 1506 1507 1508 1509 1510 1511 1512 1513 1514 1515 1516 1517 1518 1519 1520 1521 1522 1523 1524 1525 1526 1527 1528 1529 1530 1531 1532 1533 1534 1535 1536 1537 1538 1539 1540 1541 1542 1543 1544 1545 1546 1547 1548 1549 1550 1551 1552 1553 1554 1555 1556 1557 1558 1559 1560 1561 1562 1563 1564 1565 1566 1567 1568 1569 1570 1571 1572 1573 1574 1575 1576 1577 1578 1579 1580 1581 1582 1583 1584 1585 1586 1587 1588 1589 1590 1591 1592 1593 1594 1595 1596 1597 1598 1599 1600 1601 1602 1603 1604 1605 1606 1607 1608 1609 1610 1611 1612 1613 1614 1615 1616 1617 1618 1619 1620 1621 1622 1623 1624 1625 1626 1627 1628 1629 1630 1631 1632 1633 1634 1635 1636 1637 1638 1639 1640 1641 1642 1643 1644 1645 1646 1647 1648 1649 1650 1651 1652 1653 1654 1655 1656 1657 1658 1659 1660 1661 1662 1663 1664 1665 1666 1667 1668 1669 1670 1671 1672 1673 1674 1675 1676 1677 1678 1679 1680 1681 1682 1683 1684 1685 1686 1687 1688 1689 1690 1691 1692 1693 1694 1695 1696 1697 1698 1699 1700 1701 1702 1703 1704 1705 1706 1707 1708 1709 1710 1711 1712 1713 1714 1715 1716 1717 1718 1719 1720 1721 1722 1723 1724 1725 1726 1727 1728 1729 1730 1731 1732 1733 1734 1735 1736 1737 1738 1739 1740 1741 1742 1743 1744 1745 1746 1747 1748 1749 1750 1751 1752 1753 1754 1755 1756 1757 1758 1759 1760 1761 1762 1763 1764 1765 1766 1767 1768 1769 1770 1771 1772 1773 1774 1775 1776 1777 1778 1779 1780 1781 1782 1783 1784 1785 1786 1787 1788 1789 1790 1791 1792 1793 1794 1795 1796 1797 1798 1799 1800 1801 1802 1803 1804 1805 1806 1807 1808 1809 1810 1811 1812 1813 1814 1815 1816 1817 1818 1819 1820 1821 1822 1823 1824 1825 1826 1827 1828 1829 1830 1831 1832 1833 1834 1835 1836 1837 1838 1839 1840 1841 1842 1843 1844 1845 1846 1847 1848 1849 1850 1851 1852 1853 1854 1855 1856 1857 1858 1859 1860 1861 1862 1863 1864 1865 1866 1867 1868 1869 1870 1871 1872 1873 1874 1875 1876 1877 1878 1879 1880 1881 1882 1883 1884 1885 1886 1887 1888 1889 1890 1891 1892 1893 1894 1895 1896 1897 1898 1899 1900 1901 1902 1903 1904 1905 1906 1907 1908 1909 1910 1911 1912 1913 1914 1915 1916 1917 1918 1919 1920 1921 1922 1923 1924 1925 1926 1927 1928 1929 1930 1931 1932 1933 1934 1935 1936 1937 1938 1939 1940 1941 1942 1943 1944 1945 1946 1947 1948 1949 1950 1951 1952 1953 1954 1955 1956 1957 1958 1959 1960 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021 2022 2023 2024 2025 2026 2027 2028 2029 2030 2031 2032 2033 2034 2035 2036 2037 2038 2039 2040 2041 2042 2043 2044 2045 2046 2047 2048 2049 2050 2051 2052 2053 2054 2055 2056 2057 2058 2059 2060 2061 2062 2063 2064 2065 2066 2067 2068 2069 2070 2071 2072 2073 2074 2075 2076 2077 2078 2079 2080 2081 2082 2083 2084 2085 2086 2087 2088 2089 2090 2091 2092 2093 2094 2095 2096 2097 2098 2099 2100 2101 2102 2103 2104 2105 2106 2107 2108 2109 2110 2111 2112 2113 2114 2115 2116 2117 2118 2119 2120 2121 2122 2123 2124 2125 2126 2127 2128 2129 2130 2131 2132 2133 2134 2135 2136 2137 2138 2139 2140 2141 2142 2143 2144 2145 2146 2147 2148 2149 2150 2151 2152 2153 2154 2155 2156 2157 2158 2159 2160 2161 2162 2163 2164 2165 2166 2167 2168 2169 2170 2171 2172 2173 2174 2175 2176 2177 2178 2179 2180 2181 2182 2183 2184 2185 2186 2187 2188 2189 2190 2191 2192 2193 2194 2195 2196 2197 2198 2199 2200 2201 2202 2203 2204 2205 2206 2207 2208 2209 2210 2211 2212 2213 2214 2215 2216 2217 2218 2219 2220 2221 2222 2223 2224 2225 2226 2227 2228 2229 2230 2231 2232 2233 2234 2235 2236 2237 2238 2239 2240 2241 2242 2243 2244 2245 2246 2247 2248 2249 2250 2251 2252 2253 2254 2255 2256 2257 2258 2259 2260 2261 2262 2263 2264 2265 2266 2267 2268 2269 2270 2271 2272 2273 2274 2275 2276 2277 2278 2279 2280 2281 2282 2283 2284 2285 2286 2287 2288 2289 2290 2291 2292 2293 2294 2295 2296 2297 2298 2299 2300 2301 2302 2303 2304 2305 2306 2307 2308 2309 2310 2311 2312 2313 2314 2315 2316 2317 2318 2319 2320 2321 2322 2323 2324 2325 2326 2327 2328 2329 2330 2331 2332 2333 2334 2335 2336 2337 2338 2339 2340 2341 2342 2343 2344 2345 2346 2347 2348 2349 2350 2351 2352 \u0026lt;?php return array ( \u0026#39;trans\u0026#39; =\u0026gt; array ( \u0026#39;Login Page\u0026#39; =\u0026gt; array ( \u0026#39;Username\u0026#39; =\u0026gt; \u0026#39;用户名\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;密码\u0026#39;, \u0026#39;Language\u0026#39; =\u0026gt; \u0026#39;语言\u0026#39;, \u0026#39;Sign in\u0026#39; =\u0026gt; \u0026#39;登录\u0026#39;, \u0026#39;Please login.\u0026#39; =\u0026gt; \u0026#39;请登录\u0026#39;, \u0026#39;Please type a username.\u0026#39; =\u0026gt; \u0026#39;请输入用户名\u0026#39;, \u0026#39;Invalid password.\u0026#39; =\u0026gt; \u0026#39;错误的密码\u0026#39;, \u0026#39;Invalid username.\u0026#39; =\u0026gt; \u0026#39;错误的用户名\u0026#39;, \u0026#39;Your account has been deactivated!\u0026#39; =\u0026gt; \u0026#39;你的账户已被停用\u0026#39;, \u0026#39;Create account\u0026#39; =\u0026gt; \u0026#39;注册\u0026#39;, \u0026#39;Forgot password?\u0026#39; =\u0026gt; \u0026#39;忘记密码？\u0026#39;, \u0026#39;Signing in...\u0026#39; =\u0026gt; \u0026#39;正在登录...\u0026#39;, \u0026#39;Your account access is limited to a particular IP address!\u0026#39; =\u0026gt; \u0026#39;您的账户仅被允许从特定IP地址访问！\u0026#39;, \u0026#39;2-step verification: add account\u0026#39; =\u0026gt; \u0026#39;两步验证：添加账户\u0026#39;, \u0026#39;Scan this barcode with the \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Google Authenticator\u0026lt;/a\u0026gt; app on your mobile device to add your account.\u0026#39; =\u0026gt; \u0026#39;通过你手机上的\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Google Authenticator\u0026lt;/a\u0026gt; APP 扫描这个二维码来添加你的账户\u0026#39;, \u0026#39;Done\u0026#39; =\u0026gt; \u0026#39;完成\u0026#39;, \u0026#39;Your account is configured for 2-step verification. You need to type in a verification code!\u0026#39; =\u0026gt; \u0026#39;你的账户已经设置了两步验证，你需要输入一个验证代码\u0026#39;, \u0026#39;The provided verification code is not valid!\u0026#39; =\u0026gt; \u0026#39;提供的验证代码不匹配\u0026#39;, \u0026#39;Your account is configured for 2-step verification. Click Ok to start the setup.\u0026#39; =\u0026gt; \u0026#39;你的账户已经设置了两步验证，点击“OK”以启动安装\u0026#39;, \u0026#39;Type the following key code into your authentication app:\u0026#39; =\u0026gt; \u0026#39;输入你的身份认证APP上显示的KEY代码：\u0026#39;, \u0026#39;Verification code\u0026#39; =\u0026gt; \u0026#39;验证码\u0026#39;, \u0026#39;Please type a password.\u0026#39; =\u0026gt; \u0026#39;请输入密码\u0026#39;, \u0026#39;Changing language...\u0026#39; =\u0026gt; \u0026#39;更改语言\u0026#39;, \u0026#39;Loading...\u0026#39; =\u0026gt; \u0026#39;正在加载...\u0026#39;, \u0026#39;There is an Android app that you can use to access your files more comfortably. Would you like to try that instead?\u0026#39; =\u0026gt; \u0026#39;我们提供了一个安卓 APP使你可以更好的访问你的文件，你希望试一试吗？\u0026#39;, \u0026#39;Add a new \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Google Authenticator\u0026lt;/a\u0026gt; account with the following key:\u0026#39; =\u0026gt; \u0026#39;使用以下密钥添加新的\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Google身份验证器\u0026lt;/a\u0026gt;帐户：\u0026#39;, \u0026#39;2-step: Add account\u0026#39; =\u0026gt; \u0026#39;两步：添加帐户\u0026#39;, \u0026#39;Authentication should be made with the remote system.\u0026#39; =\u0026gt; \u0026#39;应使用远程系统进行身份验证。\u0026#39;, ), \u0026#39;User Registration\u0026#39; =\u0026gt; array ( \u0026#39;User Registration\u0026#39; =\u0026gt; \u0026#39;用户注册\u0026#39;, \u0026#39;Username\u0026#39; =\u0026gt; \u0026#39;用户名\u0026#39;, \u0026#39;E-mail address\u0026#39; =\u0026gt; \u0026#39;电子邮箱地址\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;新密码\u0026#39;, \u0026#39;Retype password\u0026#39; =\u0026gt; \u0026#39;确认新密码\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;姓名\u0026#39;, \u0026#39;Company\u0026#39; =\u0026gt; \u0026#39;公司\u0026#39;, \u0026#39;Web site address\u0026#39; =\u0026gt; \u0026#39;网站地址\u0026#39;, \u0026#39;Comment\u0026#39; =\u0026gt; \u0026#39;评论\u0026#39;, \u0026#39;Submit\u0026#39; =\u0026gt; \u0026#39;提交\u0026#39;, \u0026#39;Please type a username!\u0026#39; =\u0026gt; \u0026#39;请输入用户名\u0026#39;, \u0026#39;Please avoid using special characters for the username!\u0026#39; =\u0026gt; \u0026#39;用户名不能为特殊字符\u0026#39;, \u0026#39;Username already in use. Please choose another one.\u0026#39; =\u0026gt; \u0026#39;用户名已存在，请选择其他用户名\u0026#39;, \u0026#39;Please type a password!\u0026#39; =\u0026gt; \u0026#39;请输入密码\u0026#39;, \u0026#39;Please retype the password correctly!\u0026#39; =\u0026gt; \u0026#39;请确认两次输入的密码相同\u0026#39;, \u0026#39;Please type your name!\u0026#39; =\u0026gt; \u0026#39;请输入您的姓名\u0026#39;, \u0026#39;Please type your email address!\u0026#39; =\u0026gt; \u0026#39;请输入电子邮箱地址\u0026#39;, \u0026#39;Please type the company name!\u0026#39; =\u0026gt; \u0026#39;请输入公司名称\u0026#39;, \u0026#39;Please type your website address!\u0026#39; =\u0026gt; \u0026#39;请输入网站地址\u0026#39;, \u0026#39;Please type the comment!\u0026#39; =\u0026gt; \u0026#39;请输入评论内容\u0026#39;, \u0026#39;Failed to create user account!\u0026#39; =\u0026gt; \u0026#39;用户创建失败\u0026#39;, \u0026#39;Your account has been successfully created.\u0026#39; =\u0026gt; \u0026#39;用户创建成功\u0026#39;, \u0026#39;Login\u0026#39; =\u0026gt; \u0026#39;登录\u0026#39;, \u0026#39;Your account information has been emailed to you!\u0026#39; =\u0026gt; \u0026#39;账户信息已发送至您的电子邮箱\u0026#39;, \u0026#39;An e-mail message has been sent at \u0026#34;%1\u0026#34; with details on how to complete the registration process.\u0026#39; =\u0026gt; \u0026#39;关于如何完成注册过程的详情，已发送至\u0026#34;%1\u0026#34;\u0026#39;, \u0026#39;E-mail address already registered. Please use the password recovery options if you forgot your password.\u0026#39; =\u0026gt; \u0026#39;该电子邮件地址已被注册. 如果您忘记密码请使用密码恢复功能\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Please make sure you are not a robot! :)\u0026#39; =\u0026gt; \u0026#39;请正确的输入这两个字符串\u0026#39;, \u0026#39;Please type your last name!\u0026#39; =\u0026gt; \u0026#39;请输入您的姓名\u0026#39;, \u0026#39;Loading...\u0026#39; =\u0026gt; \u0026#39;正在加载...\u0026#39;, \u0026#39;Phone\u0026#39; =\u0026gt; \u0026#39;电话\u0026#39;, \u0026#39;Please type the phone number\u0026#39; =\u0026gt; \u0026#39;请输入电话号码\u0026#39;, ), \u0026#39;Password Reset\u0026#39; =\u0026gt; array ( \u0026#39;The login information has been sent to your email address.\u0026#39; =\u0026gt; \u0026#39;登录信息已发送到您的电子邮箱\u0026#39;, \u0026#39;Password Reset\u0026#39; =\u0026gt; \u0026#39;密码重置\u0026#39;, \u0026#39;E-mail address\u0026#39; =\u0026gt; \u0026#39;电子邮箱地址\u0026#39;, \u0026#39;Submit\u0026#39; =\u0026gt; \u0026#39;提交\u0026#39;, \u0026#39;Please type the e-mail address.\u0026#39; =\u0026gt; \u0026#39;请输入电子邮箱地址\u0026#39;, \u0026#39;The e-mail address was not found in the database.\u0026#39; =\u0026gt; \u0026#39;未检索到该电子邮箱地址\u0026#39;, \u0026#39;Please check your inbox for information on how to reset your account\\\u0026#39;s password.\u0026#39; =\u0026gt; \u0026#39;关于如何找回密码,请检查您的收件箱\u0026#39;, \u0026#39;Please wait...\u0026#39; =\u0026gt; \u0026#39;请等待\u0026#39;, \u0026#39;Sign in\u0026#39; =\u0026gt; \u0026#39;登陆\u0026#39;, ), \u0026#39;Main Interface\u0026#39; =\u0026gt; array ( \u0026#39;The file is already in the download cart\u0026#39; =\u0026gt; \u0026#39;这个文件已经位于你的 等待下载 列表\u0026#39;, \u0026#39;Rating\u0026#39; =\u0026gt; \u0026#39;评分\u0026#39;, \u0026#39;Please check your network connection.\u0026#39; =\u0026gt; \u0026#39;请检查你的网络连接\u0026#39;, \u0026#39;\u0026lt;a href=\u0026#34;%1\u0026#34;\u0026gt;The data\u0026lt;/a\u0026gt; recevied from the server contains errors.\u0026#39; =\u0026gt; \u0026#39;\u0026lt;a href=\u0026#34;%1\u0026#34;\u0026gt;从收到的数据有错误\u0026lt;/a\u0026gt;\u0026#39;, \u0026#39;Loading...\u0026#39; =\u0026gt; \u0026#39;正在加载...\u0026#39;, \u0026#39;Sign out\u0026#39; =\u0026gt; \u0026#39;注销\u0026#39;, \u0026#39;Control Panel\u0026#39; =\u0026gt; \u0026#39;控制面板\u0026#39;, \u0026#39;Change password\u0026#39; =\u0026gt; \u0026#39;修改密码\u0026#39;, \u0026#39;Preview\u0026#39; =\u0026gt; \u0026#39;预览\u0026#39;, \u0026#39;No preview available for this type of files.\u0026#39; =\u0026gt; \u0026#39;此类文件无可用预览\u0026#39;, \u0026#39;Comments\u0026#39; =\u0026gt; \u0026#39;评论\u0026#39;, \u0026#39;Please select a file.\u0026#39; =\u0026gt; \u0026#39;请选择一个文件。\u0026#39;, \u0026#39;Folder contains no image file\u0026#39; =\u0026gt; \u0026#39;此目录内无图像文件\u0026#39;, \u0026#39;There are no files in this folder\u0026#39; =\u0026gt; \u0026#39;此目录内无任何文件\u0026#39;, \u0026#39;This item contains changes\u0026#39; =\u0026gt; \u0026#39;自您上次登陆，此文件被创建或修改\u0026#39;, \u0026#39;This file is locked by %1.\u0026#39; =\u0026gt; \u0026#39;此文件被 %1 锁定.\u0026#39;, \u0026#39;This file has %1 comment(s).\u0026#39; =\u0026gt; \u0026#39;此文件有 %1 条评论.\u0026#39;, \u0026#39;This file has a WebLink attached to it.\u0026#39; =\u0026gt; \u0026#39;此文件有一个Web链接\u0026#39;, \u0026#39;Loading Preview...\u0026#39; =\u0026gt; \u0026#39;正在加载预览...\u0026#39;, \u0026#39;Free space available:\u0026#39; =\u0026gt; \u0026#39;剩余空间:\u0026#39;, \u0026#39;Delete \u0026#34;%1\u0026#34;?\u0026#39; =\u0026gt; \u0026#39;删除 \u0026#34;%1\u0026#34;?\u0026#39;, \u0026#39;Internet Explorer is blocking the download?\u0026lt;br\u0026gt;Click \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;here\u0026lt;/a\u0026gt; to download the file without reloading this page.\u0026#39; =\u0026gt; \u0026#39;无法下载?\u0026lt;br\u0026gt;点击 \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;这里\u0026lt;/a\u0026gt; 下载文件\u0026#39;, \u0026#39;Upload\u0026#39; =\u0026gt; \u0026#39;上传\u0026#39;, \u0026#39;%1 used (%2%)\u0026#39; =\u0026gt; \u0026#39;%1 已使用 (%2%)\u0026#39;, \u0026#39;Please type a file name:\u0026#39; =\u0026gt; \u0026#39;请输入文件名\u0026#39;, \u0026#39;Creating blank file...\u0026#39; =\u0026gt; \u0026#39;正在创建空白文件...\u0026#39;, \u0026#39;Sort\u0026#39; =\u0026gt; \u0026#39;排序\u0026#39;, \u0026#39;Settings\u0026#39; =\u0026gt; \u0026#39;设置\u0026#39;, \u0026#39;Select All\u0026#39; =\u0026gt; \u0026#39;选择所有\u0026#39;, \u0026#39;View\u0026#39; =\u0026gt; \u0026#39;查看\u0026#39;, \u0026#39;Tools\u0026#39; =\u0026gt; \u0026#39;工具\u0026#39;, \u0026#39;List view\u0026#39; =\u0026gt; \u0026#39;详细视图\u0026#39;, \u0026#39;Refresh\u0026#39; =\u0026gt; \u0026#39;刷新\u0026#39;, \u0026#39;New File\u0026#39; =\u0026gt; \u0026#39;新建文件\u0026#39;, \u0026#39;New tab\u0026#39; =\u0026gt; \u0026#39;新标签\u0026#39;, \u0026#39;Space:\u0026#39; =\u0026gt; \u0026#39;容量:\u0026#39;, \u0026#39;Search\u0026#39; =\u0026gt; \u0026#39;搜索\u0026#39;, \u0026#39;File Search\u0026#39; =\u0026gt; \u0026#39;文件搜索\u0026#39;, \u0026#39;Share\u0026#39; =\u0026gt; \u0026#39;共享\u0026#39;, \u0026#39;Sharing\u0026#39; =\u0026gt; \u0026#39;正在共享\u0026#39;, \u0026#39;New sub-folder\u0026#39; =\u0026gt; \u0026#39;新建子目录\u0026#39;, \u0026#39;Rename\u0026#39; =\u0026gt; \u0026#39;重命名\u0026#39;, \u0026#39;Remove\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;Properties\u0026#39; =\u0026gt; \u0026#39;属性\u0026#39;, \u0026#39;Download\u0026#39; =\u0026gt; \u0026#39;下载\u0026#39;, \u0026#39;..in one zip file\u0026#39; =\u0026gt; \u0026#39;..到一个压缩文件\u0026#39;, \u0026#39;Open with..\u0026#39; =\u0026gt; \u0026#39;打开方式\u0026#39;, \u0026#39;E-mail Files\u0026#39; =\u0026gt; \u0026#39;E-mail 文件\u0026#39;, \u0026#39;Share with users\u0026#39; =\u0026gt; \u0026#39;与其他用户共享\u0026#39;, \u0026#39;Get link\u0026#39; =\u0026gt; \u0026#39;生成Web链接\u0026#39;, \u0026#39;Details and activity\u0026#39; =\u0026gt; \u0026#39;通知\u0026#39;, \u0026#39;Versioning\u0026#39; =\u0026gt; \u0026#39;版本\u0026#39;, \u0026#39;Previous Versions\u0026#39; =\u0026gt; \u0026#39;上一版本\u0026#39;, \u0026#39;Lock\u0026#39; =\u0026gt; \u0026#39;锁定\u0026#39;, \u0026#39;Unlock\u0026#39; =\u0026gt; \u0026#39;解锁\u0026#39;, \u0026#39;File Versions\u0026#39; =\u0026gt; \u0026#39;文件版本\u0026#39;, \u0026#39;Metadata\u0026#39; =\u0026gt; \u0026#39;元数据\u0026#39;, \u0026#39;Comment\u0026#39; =\u0026gt; \u0026#39;评论\u0026#39;, \u0026#39;Zip archive..\u0026#39; =\u0026gt; \u0026#39;添加到压缩文件\u0026#39;, \u0026#39;Extract archive..\u0026#39; =\u0026gt; \u0026#39;解压缩\u0026#39;, \u0026#39;Copy\u0026#39; =\u0026gt; \u0026#39;复制\u0026#39;, \u0026#39;Loading file list...\u0026#39; =\u0026gt; \u0026#39;加载文件列表...\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;名称\u0026#39;, \u0026#39;Size\u0026#39; =\u0026gt; \u0026#39;大小\u0026#39;, \u0026#39;Type\u0026#39; =\u0026gt; \u0026#39;类型\u0026#39;, \u0026#39;Meta Type\u0026#39; =\u0026gt; \u0026#39;Meta类型\u0026#39;, \u0026#39;Modified\u0026#39; =\u0026gt; \u0026#39;修改时间\u0026#39;, \u0026#39;Created\u0026#39; =\u0026gt; \u0026#39;创建时间\u0026#39;, \u0026#39;Comments count\u0026#39; =\u0026gt; \u0026#39;评论条数\u0026#39;, \u0026#39;Yes\u0026#39; =\u0026gt; \u0026#39;是\u0026#39;, \u0026#39;No\u0026#39; =\u0026gt; \u0026#39;否\u0026#39;, \u0026#39;Version\u0026#39; =\u0026gt; \u0026#39;版本\u0026#39;, \u0026#39;Is new\u0026#39; =\u0026gt; \u0026#39;新的\u0026#39;, \u0026#39;Locked by\u0026#39; =\u0026gt; \u0026#39;被谁锁定:\u0026#39;, \u0026#39;Sort Ascending\u0026#39; =\u0026gt; \u0026#39;升序排列\u0026#39;, \u0026#39;Sort Descending\u0026#39; =\u0026gt; \u0026#39;降序排列\u0026#39;, \u0026#39;Columns\u0026#39; =\u0026gt; \u0026#39;列\u0026#39;, \u0026#39;Reset Columns\u0026#39; =\u0026gt; \u0026#39;重置列\u0026#39;, \u0026#39;%1 items\u0026#39; =\u0026gt; \u0026#39;%1个项目\u0026#39;, \u0026#39;Opening popup window... \u0026lt;br\u0026gt;Click \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;here\u0026lt;/a\u0026gt; if the browser prevents it from opening.\u0026#39; =\u0026gt; \u0026#39;正在打开窗口... \u0026lt;br\u0026gt;如果打开窗口失败，请点击 \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;这里\u0026lt;/a\u0026gt;\u0026#39;, \u0026#39;Moving files...\u0026#39; =\u0026gt; \u0026#39;移动文件...\u0026#39;, \u0026#39;Moving folder...\u0026#39; =\u0026gt; \u0026#39;移动目录...\u0026#39;, \u0026#39;Renaming file...\u0026#39; =\u0026gt; \u0026#39;重命名文件...\u0026#39;, \u0026#39;Zipping files...\u0026#39; =\u0026gt; \u0026#39;压缩文件...\u0026#39;, \u0026#39;Extracting archive contents...\u0026#39; =\u0026gt; \u0026#39;解压缩文件...\u0026#39;, \u0026#39;Deleting...\u0026#39; =\u0026gt; \u0026#39;删除文件...\u0026#39;, \u0026#39;Restoring file(s)...\u0026#39; =\u0026gt; \u0026#39;恢复文件...\u0026#39;, \u0026#39;Locking file...\u0026#39; =\u0026gt; \u0026#39;锁定文件...\u0026#39;, \u0026#39;Unlocking file...\u0026#39; =\u0026gt; \u0026#39;解锁文件...\u0026#39;, \u0026#39;Renaming folder...\u0026#39; =\u0026gt; \u0026#39;重命名目录...\u0026#39;, \u0026#39;Please wait while the selected files are being zipped...\u0026#39; =\u0026gt; \u0026#39;正在所选文件，请稍候...\u0026#39;, \u0026#39;Please wait while the selected folder is being zipped...\u0026#39; =\u0026gt; \u0026#39;正在所选目录，请稍候...\u0026#39;, \u0026#39;Selected Files.zip\u0026#39; =\u0026gt; \u0026#39;所选文件.zip\u0026#39;, \u0026#39;Downloading zip file...\u0026#39; =\u0026gt; \u0026#39;下载压缩文件...\u0026#39;, \u0026#39;Are you sure you want to delete the selected file(s)?\u0026#39; =\u0026gt; \u0026#39;确定删除所选文件?\u0026#39;, \u0026#39;The selected folder and all its contents will be deleted.\u0026#39; =\u0026gt; \u0026#39;确定删除所选目录及目录下所有内容?\u0026#39;, \u0026#39;Permanent deletion\u0026#39; =\u0026gt; \u0026#39;永久删除\u0026#39;, \u0026#39;New Folder\u0026#39; =\u0026gt; \u0026#39;创建新目录\u0026#39;, \u0026#39;Creating new folder...\u0026#39; =\u0026gt; \u0026#39;创建新目录...\u0026#39;, \u0026#39;Please type a folder name for the archive contents:\u0026#39; =\u0026gt; \u0026#39;为压缩文件输入目录名:\u0026#39;, \u0026#39;Extracted Files\u0026#39; =\u0026gt; \u0026#39;解压缩文件\u0026#39;, \u0026#39;Deleted from\u0026#39; =\u0026gt; \u0026#39;从何处删除\u0026#39;, \u0026#39;Trash\u0026#39; =\u0026gt; \u0026#39;已删除文件\u0026#39;, \u0026#39;Restore\u0026#39; =\u0026gt; \u0026#39;还原\u0026#39;, \u0026#39;Recent\u0026#39; =\u0026gt; \u0026#39;最近\u0026#39;, \u0026#39;Shared by me\u0026#39; =\u0026gt; \u0026#39;由我共享\u0026#39;, \u0026#39;There are no shared files or folders\u0026#39; =\u0026gt; \u0026#39;没有共享的文件或文件夹\u0026#39;, \u0026#39;Files\u0026#39; =\u0026gt; \u0026#39;文件\u0026#39;, \u0026#39;There are no recently accessed files\u0026#39; =\u0026gt; \u0026#39;没有最近访问过的文件\u0026#39;, \u0026#39;Activity\u0026#39; =\u0026gt; \u0026#39;目录活动\u0026#39;, \u0026#39;Please type a name for the zip file:\u0026#39; =\u0026gt; \u0026#39;输入压缩文件名称:\u0026#39;, \u0026#39;New Archive.zip\u0026#39; =\u0026gt; \u0026#39;新建压缩文件Archive.zip\u0026#39;, \u0026#39;E-mail\u0026#39; =\u0026gt; \u0026#39;Email地址\u0026#39;, \u0026#39;Activity log\u0026#39; =\u0026gt; \u0026#39;活动日志\u0026#39;, \u0026#39;Loading the file\\\u0026#39;s activity log...\u0026#39; =\u0026gt; \u0026#39;正在加载文件的变更日志\u0026#39;, \u0026#39;External Window\u0026#39; =\u0026gt; \u0026#39;外部窗口\u0026#39;, \u0026#39;Folders\u0026#39; =\u0026gt; \u0026#39;文件夹\u0026#39;, \u0026#39;Zip and download\u0026#39; =\u0026gt; \u0026#39;压缩并下载\u0026#39;, \u0026#39;This type of archives is not supported by the current server configuration.\u0026#39; =\u0026gt; \u0026#39;服务器不支持此类压缩包\u0026#39;, \u0026#39;With users\u0026#39; =\u0026gt; \u0026#39;关联用户\u0026#39;, \u0026#39;One item\u0026#39; =\u0026gt; \u0026#39;一个项目\u0026#39;, \u0026#39;One item selected\u0026#39; =\u0026gt; \u0026#39;选中1个项目\u0026#39;, \u0026#39;More\u0026#39; =\u0026gt; \u0026#39;更多\u0026#39;, \u0026#39;Confirm\u0026#39; =\u0026gt; \u0026#39;确认\u0026#39;, \u0026#39;Details\u0026#39; =\u0026gt; \u0026#39;详情\u0026#39;, \u0026#39;My Files\u0026#39; =\u0026gt; \u0026#39;我的文件\u0026#39;, \u0026#39;Upload to \u0026#34;%1\u0026#34;\u0026#39; =\u0026gt; \u0026#39;上传至 \u0026#34;%1\u0026#34;\u0026#39;, \u0026#39;Folder upload\u0026#39; =\u0026gt; \u0026#39;上传目录\u0026#39;, \u0026#39;File upload\u0026#39; =\u0026gt; \u0026#39;上传文件\u0026#39;, \u0026#39;Create new\u0026#39; =\u0026gt; \u0026#39;创建新的\u0026#39;, \u0026#39;Add Files\u0026#39; =\u0026gt; \u0026#39;添加文件\u0026#39;, \u0026#39;Add Folder\u0026#39; =\u0026gt; \u0026#39;添加目录\u0026#39;, \u0026#39;Remove from queue\u0026#39; =\u0026gt; \u0026#39;从队列中删除\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Cancel all\u0026#39; =\u0026gt; \u0026#39;取消所有\u0026#39;, \u0026#39;Skip file\u0026#39; =\u0026gt; \u0026#39;跳过文件\u0026#39;, \u0026#39;Resume file\u0026#39; =\u0026gt; \u0026#39;恢复文件\u0026#39;, \u0026#39;Pause all\u0026#39; =\u0026gt; \u0026#39;暂停所有\u0026#39;, \u0026#39;File name\u0026#39; =\u0026gt; \u0026#39;文件名\u0026#39;, \u0026#39;Uploaded\u0026#39; =\u0026gt; \u0026#39;已上传\u0026#39;, \u0026#39;Progress\u0026#39; =\u0026gt; \u0026#39;进度\u0026#39;, \u0026#39;Speed\u0026#39; =\u0026gt; \u0026#39;速度\u0026#39;, \u0026#39;Time remaining\u0026#39; =\u0026gt; \u0026#39;剩余时间\u0026#39;, \u0026#39;%1 files left\u0026#39; =\u0026gt; \u0026#39;剩余 %1 个文件\u0026#39;, \u0026#39;%1 of %2\u0026#39; =\u0026gt; \u0026#39;%2 中的 %1 项\u0026#39;, \u0026#39;[Skipped]\u0026#39; =\u0026gt; \u0026#39;[已跳过]\u0026#39;, \u0026#39;Paused\u0026#39; =\u0026gt; \u0026#39;已暂停\u0026#39;, \u0026#39;Uploading (Retry #%1)...\u0026#39; =\u0026gt; \u0026#39;正在上传 (第 %1 次重试)\u0026#39;, \u0026#39;Paused (%1%)\u0026#39; =\u0026gt; \u0026#39;已暂停 (%1%)\u0026#39;, \u0026#39;Waiting (100%)\u0026#39; =\u0026gt; \u0026#39;等待完成 (100%)\u0026#39;, \u0026#39;Server error\u0026#39; =\u0026gt; \u0026#39;服务器错误\u0026#39;, \u0026#39;A problem has been encountered!\u0026#39; =\u0026gt; \u0026#39;出现了一些故障\u0026#39;, \u0026#39;Try again\u0026#39; =\u0026gt; \u0026#39;再试一次\u0026#39;, \u0026#39;%1 hours\u0026#39; =\u0026gt; \u0026#39;%1 小时\u0026#39;, \u0026#39;%1 minutes\u0026#39; =\u0026gt; \u0026#39;%1 分\u0026#39;, \u0026#39;%1 seconds\u0026#39; =\u0026gt; \u0026#39;%1 秒\u0026#39;, \u0026#39;You are not allowed to upload the file \u0026#34;%1\u0026#34;\u0026#39; =\u0026gt; \u0026#39;你无权上传该文件： \u0026#34;%1\u0026#34;\u0026#39;, \u0026#39;There are no comments for this item\u0026#39; =\u0026gt; \u0026#39;本项目暂无评论\u0026#39;, \u0026#39;Write a comment...\u0026#39; =\u0026gt; \u0026#39;写一个评论\u0026#39;, \u0026#39;Contents\u0026#39; =\u0026gt; \u0026#39;内容\u0026#39;, \u0026#39;Use the displayed header bar to sort by the desired field.\u0026#39; =\u0026gt; \u0026#39;使用显示的标题栏按照所需字段排序\u0026#39;, \u0026#39;Drop files here\u0026#39; =\u0026gt; \u0026#39;拖拽文件到这里上传\u0026#39;, \u0026#39;or use the \u0026#34;NEW\u0026#34; button\u0026#39; =\u0026gt; \u0026#39;或者使用“创建/上传”按钮\u0026#39;, \u0026#39;Queued\u0026#39; =\u0026gt; \u0026#39;已加入队列\u0026#39;, \u0026#39;Mute sound notifications\u0026#39; =\u0026gt; \u0026#39;关闭通知\u0026#39;, \u0026#39;Notifications\u0026#39; =\u0026gt; \u0026#39;通知\u0026#39;, \u0026#39;Add to cart\u0026#39; =\u0026gt; \u0026#39;添加到 等待下载 列表\u0026#39;, \u0026#39;Download cart\u0026#39; =\u0026gt; \u0026#39;批量下载\u0026#39;, \u0026#39;Label\u0026#39; =\u0026gt; \u0026#39;标签\u0026#39;, \u0026#39;No label\u0026#39; =\u0026gt; \u0026#39;无标签\u0026#39;, \u0026#39;Custom label\u0026#39; =\u0026gt; \u0026#39;自定义标签\u0026#39;, \u0026#39;New label\u0026#39; =\u0026gt; \u0026#39;新标签\u0026#39;, \u0026#39;Page\u0026#39; =\u0026gt; \u0026#39;页\u0026#39;, \u0026#39;of {0}\u0026#39; =\u0026gt; \u0026#39;第 {0}\u0026#39;, \u0026#39;First Page\u0026#39; =\u0026gt; \u0026#39;首页\u0026#39;, \u0026#39;Last Page\u0026#39; =\u0026gt; \u0026#39;尾页\u0026#39;, \u0026#39;Next Page\u0026#39; =\u0026gt; \u0026#39;下一页\u0026#39;, \u0026#39;Previous Page\u0026#39; =\u0026gt; \u0026#39;上一页\u0026#39;, \u0026#39;Uploading pasted image...\u0026#39; =\u0026gt; \u0026#39;正在上传粘贴的图像...\u0026#39;, \u0026#39;Pasted image\u0026#39; =\u0026gt; \u0026#39;粘贴的图像\u0026#39;, \u0026#39;Pasted image successfully uploaded\u0026#39; =\u0026gt; \u0026#39;图片粘贴上传成功\u0026#39;, \u0026#39;Are you sure you want to remove the comment?\u0026#39; =\u0026gt; \u0026#39;你确定要删除评论吗？\u0026#39;, \u0026#39;%1 of %2 results\u0026#39; =\u0026gt; \u0026#39;%1 of %2 结果\u0026#39;, \u0026#39;%1 results\u0026#39; =\u0026gt; \u0026#39;%1 个结果\u0026#39;, \u0026#39;Show more...\u0026#39; =\u0026gt; \u0026#39;显示更多...\u0026#39;, \u0026#39;Star\u0026#39; =\u0026gt; \u0026#39;收藏\u0026#39;, \u0026#39;Starred\u0026#39; =\u0026gt; \u0026#39;收藏夹\u0026#39;, \u0026#39;Remove star\u0026#39; =\u0026gt; \u0026#39;取消收藏\u0026#39;, \u0026#39;There are no starred files or folders\u0026#39; =\u0026gt; \u0026#39;没有已收藏的文件或文件夹\u0026#39;, \u0026#39;There are no shared links\u0026#39; =\u0026gt; \u0026#39;没有已创建的共享链接\u0026#39;, \u0026#39;Folder\u0026#39; =\u0026gt; \u0026#39;创建目录\u0026#39;, \u0026#39;File\u0026#39; =\u0026gt; \u0026#39;创建文件\u0026#39;, \u0026#39;More options\u0026#39; =\u0026gt; \u0026#39;更多选项\u0026#39;, \u0026#39;Location\u0026#39; =\u0026gt; \u0026#39;本地的\u0026#39;, \u0026#39;Please wait as loading the file might take a while...\u0026#39; =\u0026gt; \u0026#39;请耐心等待，载入此文件可能需要一些时间...\u0026#39;, \u0026#39;New\u0026#39; =\u0026gt; \u0026#39;创建/上传\u0026#39;, \u0026#39;Shared links\u0026#39; =\u0026gt; \u0026#39;共享链接\u0026#39;, \u0026#39;Locate\u0026#39; =\u0026gt; \u0026#39;定位\u0026#39;, \u0026#39;Next\u0026#39; =\u0026gt; \u0026#39;继续\u0026#39;, \u0026#39;Previous\u0026#39; =\u0026gt; \u0026#39;返回\u0026#39;, \u0026#39;Close\u0026#39; =\u0026gt; \u0026#39;关闭\u0026#39;, \u0026#39;Zoom\u0026#39; =\u0026gt; \u0026#39;放大\u0026#39;, \u0026#39;%1/%2\u0026#39; =\u0026gt; \u0026#39;%1/%2 \u0026#39;, \u0026#39;First page\u0026#39; =\u0026gt; \u0026#39;第一页\u0026#39;, \u0026#39;Page %1\u0026#39; =\u0026gt; \u0026#39;页 %1\u0026#39;, \u0026#39;You are required to change your password.\u0026#39; =\u0026gt; \u0026#39;你需要更改你的密码\u0026#39;, \u0026#39;No file was found matching your search criteria.\u0026#39; =\u0026gt; \u0026#39;没有找到符合您搜索条件的文件\u0026#39;, \u0026#39;To upload files, drag them from your computer\u0026#39; =\u0026gt; \u0026#39;要上传文件，请将其从资源管理器中拖出\u0026#39;, \u0026#39;Account settings\u0026#39; =\u0026gt; \u0026#39;帐号设定\u0026#39;, \u0026#39;Download all\u0026#39; =\u0026gt; \u0026#39;下载全部文件\u0026#39;, \u0026#39;Use \u0026#34;Page Down\u0026#34; and \u0026#34;Page Up\u0026#34; to change the page\u0026#39; =\u0026gt; \u0026#39;使用 \u0026#34;Page Down\u0026#34; 和 \u0026#34;Page Up\u0026#34; 来改变页\u0026#39;, \u0026#39;Empty trash\u0026#39; =\u0026gt; \u0026#39;清空已删除文件\u0026#39;, \u0026#39;Emptying trash...\u0026#39; =\u0026gt; \u0026#39;正在清空...\u0026#39;, \u0026#39;Empty trash?\u0026#39; =\u0026gt; \u0026#39;确定要清空？\u0026#39;, \u0026#39;All files and folders in your trash are about to be permanently deleted.\u0026#39; =\u0026gt; \u0026#39;垃圾桶中的所有文件和文件夹将被永久删除\u0026#39;, \u0026#39;An error occurred while trying to process the request.\u0026#39; =\u0026gt; \u0026#39;尝试处理请求时发生错误\u0026#39;, \u0026#39;Resume\u0026#39; =\u0026gt; \u0026#39;恢复\u0026#39;, \u0026#39;Delete folder?\u0026#39; =\u0026gt; \u0026#39;是否确认删除文件夹？\u0026#39;, \u0026#39;Please enter a new name for the item:\u0026#39; =\u0026gt; \u0026#39;请为该项目取一个新名称： \u0026#39;, \u0026#39;Are you sure you want to move the folder?\u0026#39; =\u0026gt; \u0026#39;你确定要移动文件夹吗？\u0026#39;, \u0026#39;Move folder?\u0026#39; =\u0026gt; \u0026#39;是否确认移动文件夹？\u0026#39;, \u0026#39;Web link\u0026#39; =\u0026gt; \u0026#39;共享链接\u0026#39;, \u0026#39;Please type the %1label\\\u0026#39;s text%2\u0026#39; =\u0026gt; \u0026#39;请输入 %1label\\\u0026#39;s text%2\u0026#39;, \u0026#39;Date Format: Files\u0026#39; =\u0026gt; \u0026#39;m/d/Y h:i A\u0026#39;, \u0026#39;Tags\u0026#39; =\u0026gt; \u0026#39;标签\u0026#39;, \u0026#39;Failed to load file list.\u0026#39; =\u0026gt; \u0026#39;载入文件列表失败\u0026#39;, \u0026#39;You need a modern browser in order to use this feature.\u0026#39; =\u0026gt; \u0026#39;您需要一个现代浏览器才能使用此功能\u0026#39;, \u0026#39;Please select a PNG or JPG image file.\u0026#39; =\u0026gt; \u0026#39;请选择一个 PNG 或者 JPG 格式的图像文件\u0026#39;, \u0026#39;File request\u0026#39; =\u0026gt; \u0026#39;创建文件提交页面\u0026#39;, \u0026#39;What are you requesting?\u0026#39; =\u0026gt; \u0026#39;你想要什么？\u0026#39;, \u0026#39;Photos, Documents, Contracts...\u0026#39; =\u0026gt; \u0026#39;照片，文件，文档...\u0026#39;, \u0026#39;Shared with\u0026#39; =\u0026gt; \u0026#39;共享\u0026#39;, \u0026#39;Search options\u0026#39; =\u0026gt; \u0026#39;搜索选项\u0026#39;, \u0026#39;Create new folder\u0026#39; =\u0026gt; \u0026#39;创建新目录\u0026#39;, \u0026#39;This field is required\u0026#39; =\u0026gt; \u0026#39;这是必填项\u0026#39;, \u0026#39;Photos\u0026#39; =\u0026gt; \u0026#39;照片\u0026#39;, \u0026#39;Uploading...\u0026#39; =\u0026gt; \u0026#39;上传中...\u0026#39;, \u0026#39;Help\u0026#39; =\u0026gt; \u0026#39;帮助\u0026#39;, \u0026#39;Date deleted\u0026#39; =\u0026gt; \u0026#39;删除日期\u0026#39;, \u0026#39;Search in\u0026#39; =\u0026gt; \u0026#39;搜索\u0026#39;, \u0026#39;Display mode\u0026#39; =\u0026gt; \u0026#39;显示模式\u0026#39;, \u0026#39;Detailed list\u0026#39; =\u0026gt; \u0026#39;详细列表\u0026#39;, \u0026#39;Thumbnails\u0026#39; =\u0026gt; \u0026#39;缩略图\u0026#39;, \u0026#39;Last taken\u0026#39; =\u0026gt; \u0026#39;最近拍摄的\u0026#39;, \u0026#39;By date\u0026#39; =\u0026gt; \u0026#39;按 日期 分组\u0026#39;, \u0026#39;By tag\u0026#39; =\u0026gt; \u0026#39;按 标签 分组\u0026#39;, \u0026#39;Music\u0026#39; =\u0026gt; \u0026#39;音乐\u0026#39;, \u0026#39;Last added\u0026#39; =\u0026gt; \u0026#39;最近添加的\u0026#39;, \u0026#39;By artist\u0026#39; =\u0026gt; \u0026#39;按 艺术家 分组\u0026#39;, \u0026#39;By album\u0026#39; =\u0026gt; \u0026#39;按 专辑 分组\u0026#39;, \u0026#39;Random\u0026#39; =\u0026gt; \u0026#39;随机\u0026#39;, \u0026#39;Failed to load audio file.\u0026#39; =\u0026gt; \u0026#39;加载音频文件失败\u0026#39;, \u0026#39;There are no photos in here\u0026#39; =\u0026gt; \u0026#39;没有照片\u0026#39;, \u0026#39;There are no audio files in here\u0026#39; =\u0026gt; \u0026#39;没有音频文件\u0026#39;, \u0026#39;There is one other item\u0026#39; =\u0026gt; \u0026#39;还有一个项目\u0026#39;, \u0026#39;There are %1 other items\u0026#39; =\u0026gt; \u0026#39;有％1个其他项目\u0026#39;, \u0026#39;Show all items\u0026#39; =\u0026gt; \u0026#39;显示所有项目\u0026#39;, \u0026#39;Show the item\u0026#39; =\u0026gt; \u0026#39;显示项目\u0026#39;, \u0026#39;Scan files for changes\u0026#39; =\u0026gt; \u0026#39;扫描文件所进行的更改\u0026#39;, \u0026#39;This folder is empty\u0026#39; =\u0026gt; \u0026#39;这个文件夹是空白的\u0026#39;, \u0026#39;Tag files\u0026#39; =\u0026gt; \u0026#39;标记文件\u0026#39;, \u0026#39;Please select at least a file or a folder!\u0026#39; =\u0026gt; \u0026#39;请至少选择一个文件或文件夹！\u0026#39;, \u0026#39;Please add at least one tag!\u0026#39; =\u0026gt; \u0026#39;请添加至少一个标签！\u0026#39;, \u0026#39;Add tags...\u0026#39; =\u0026gt; \u0026#39;添加标签...\u0026#39;, \u0026#39;Tag selected\u0026#39; =\u0026gt; \u0026#39;已选择标记\u0026#39;, ), \u0026#39;General\u0026#39; =\u0026gt; array ( \u0026#39;One file successfully copied.\u0026#39; =\u0026gt; \u0026#39;文件成功复制\u0026#39;, \u0026#39;Folder successfully moved.\u0026#39; =\u0026gt; \u0026#39;文件夹移动成功\u0026#39;, \u0026#39;One minute ago\u0026#39; =\u0026gt; \u0026#39;大于1分钟\u0026#39;, \u0026#39;One minute\u0026#39; =\u0026gt; \u0026#39;1分钟\u0026#39;, \u0026#39;Under one minute\u0026#39; =\u0026gt; \u0026#39;小于1分钟\u0026#39;, \u0026#39;just now\u0026#39; =\u0026gt; \u0026#39;刚才\u0026#39;, \u0026#39;Folder successfully copied.\u0026#39; =\u0026gt; \u0026#39;文件夹复制成功\u0026#39;, \u0026#39;Copying...\u0026#39; =\u0026gt; \u0026#39;正在...\u0026#39;, \u0026#39;Submit\u0026#39; =\u0026gt; \u0026#39;提交\u0026#39;, \u0026#39;Save\u0026#39; =\u0026gt; \u0026#39;保存\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Error\u0026#39; =\u0026gt; \u0026#39;错误\u0026#39;, \u0026#39;Invalid path.\u0026#39; =\u0026gt; \u0026#39;非法路径.\u0026#39;, \u0026#39;File not found!\u0026#39; =\u0026gt; \u0026#39;文件不存在!\u0026#39;, \u0026#39;You are not allowed to preview the selected file.\u0026#39; =\u0026gt; \u0026#39;您无权预览选定文件.\u0026#39;, \u0026#39;%1 users\u0026#39; =\u0026gt; \u0026#39;%1 用户\u0026#39;, \u0026#39;You are not allowed to download the requested file!\u0026#39; =\u0026gt; \u0026#39;您无权下载该文件!\u0026#39;, \u0026#39;The file you are trying to download is no longer available!\u0026#39; =\u0026gt; \u0026#39;您试图下载的文件已失效!\u0026#39;, \u0026#39;You are not allowed to download or preview files.\u0026#39; =\u0026gt; \u0026#39;您无权下载或预览文件.\u0026#39;, \u0026#39;Invalid folder.\u0026#39; =\u0026gt; \u0026#39;非法目录.\u0026#39;, \u0026#39;You are not allowed to copy that shared file.\u0026#39; =\u0026gt; \u0026#39;您无权复制该共享文件.\u0026#39;, \u0026#39;You are not allowed to copy files to the specified target.\u0026#39; =\u0026gt; \u0026#39;您无权复制文件至指定目标.\u0026#39;, \u0026#39;No file was copied!\u0026#39; =\u0026gt; \u0026#39;文件复制失败\u0026#39;, \u0026#39;One file copied.\u0026#39; =\u0026gt; \u0026#39;1个文件被复制完毕.\u0026#39;, \u0026#39;%1 files copied.\u0026#39; =\u0026gt; \u0026#39;%1个文件被复制完毕.\u0026#39;, \u0026#39;No more file space available.\u0026#39; =\u0026gt; \u0026#39;磁盘空间不足.\u0026#39;, \u0026#39;You are not allowed to delete files from this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权从此共享目录删除文件.\u0026#39;, \u0026#39;No files were deleted!\u0026#39; =\u0026gt; \u0026#39;没有文件被删除!\u0026#39;, \u0026#39;One file deleted.\u0026#39; =\u0026gt; \u0026#39;1个文件被成功删除.\u0026#39;, \u0026#39;%1 files successfully deleted.\u0026#39; =\u0026gt; \u0026#39;%1个文件被成功删除.\u0026#39;, \u0026#39;You are not allowed to move that shared file.\u0026#39; =\u0026gt; \u0026#39;您无权移动该共享文件.\u0026#39;, \u0026#39;You are not allowed to move files to the specified target.\u0026#39; =\u0026gt; \u0026#39;您无权移动文件至指定目标.\u0026#39;, \u0026#39;You are not allowed to move these shared files to your own folder.\u0026#39; =\u0026gt; \u0026#39;您无权移动此共享文件到您的目录.\u0026#39;, \u0026#39;No file was moved!\u0026#39; =\u0026gt; \u0026#39;没有文件被移动!\u0026#39;, \u0026#39;One file moved.\u0026#39; =\u0026gt; \u0026#39;1个文件被移动.\u0026#39;, \u0026#39;%1 files moved.\u0026#39; =\u0026gt; \u0026#39;%1个文件被移动.\u0026#39;, \u0026#39;Invalid target path, file already exists.\u0026#39; =\u0026gt; \u0026#39;目标路径非法, 文件已存在.\u0026#39;, \u0026#39;The selected file is currently locked by another user.\u0026#39; =\u0026gt; \u0026#39;文件被其他人锁定.\u0026#39;, \u0026#39;Invalid path, not a file.\u0026#39; =\u0026gt; \u0026#39;非法路径, 不是一个文件.\u0026#39;, \u0026#39;Invalid path, not a folder.\u0026#39; =\u0026gt; \u0026#39;非法路径, 不是一个目录.\u0026#39;, \u0026#39;Invalid source path, not a folder.\u0026#39; =\u0026gt; \u0026#39;非法源路径, 不是一个目录.\u0026#39;, \u0026#39;Invalid target path, not a folder.\u0026#39; =\u0026gt; \u0026#39;非法目标路径, 不是一个目录.\u0026#39;, \u0026#39;Invalid source path, not a file.\u0026#39; =\u0026gt; \u0026#39;非法源路径, 不是一个文件.\u0026#39;, \u0026#39;You are not allowed to rename files in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权重命名此共享目录下的文件.\u0026#39;, \u0026#39;File successfully renamed.\u0026#39; =\u0026gt; \u0026#39;文件重命名成功.\u0026#39;, \u0026#39;There is already a file or a folder with the same name!\u0026#39; =\u0026gt; \u0026#39;此目录已存在同名文件!\u0026#39;, \u0026#39;Failed to rename file!\u0026#39; =\u0026gt; \u0026#39;重命名文件失败!\u0026#39;, \u0026#39;You are not allowed to extract archives in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权在此共享目录内解压文件.\u0026#39;, \u0026#39;You are not allowed to zip files in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权在此共享目录内压缩文件.\u0026#39;, \u0026#39;Invalid folder name!\u0026#39; =\u0026gt; \u0026#39;非法目录名!\u0026#39;, \u0026#39;Invalid file name\u0026#39; =\u0026gt; \u0026#39;非法文件名\u0026#39;, \u0026#39;A folder with that name already exists!\u0026#39; =\u0026gt; \u0026#39;已存在同名目录!\u0026#39;, \u0026#39;Unzipped Files\u0026#39; =\u0026gt; \u0026#39;解压缩文件\u0026#39;, \u0026#39;The archive was successfully extracted.\u0026#39; =\u0026gt; \u0026#39;文档成功解压.\u0026#39;, \u0026#39;Invalid zip name!\u0026#39; =\u0026gt; \u0026#39;压缩文件名非法!\u0026#39;, \u0026#39;A file with that name already exists!\u0026#39; =\u0026gt; \u0026#39;已存在同名文件!\u0026#39;, \u0026#39;Zip archive successfully created.\u0026#39; =\u0026gt; \u0026#39;成功创建压缩文档.\u0026#39;, \u0026#39;You are not allowed to delete that shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权删除该共享目录.\u0026#39;, \u0026#39;You cannot delete the root of a shared folder.\u0026#39; =\u0026gt; \u0026#39;不能删除共享根目录.\u0026#39;, \u0026#39;Folder deleted.\u0026#39; =\u0026gt; \u0026#39;目录删除成功.\u0026#39;, \u0026#39;Failed to delete folder!\u0026#39; =\u0026gt; \u0026#39;目录删除失败!\u0026#39;, \u0026#39;You are not allowed to move that shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权移动该共享目录.\u0026#39;, \u0026#39;You are not allowed to copy that shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权复制该共享目录.\u0026#39;, \u0026#39;You are not allowed to copy folder to the specified target.\u0026#39; =\u0026gt; \u0026#39;您无权复制目录至指定目标.\u0026#39;, \u0026#39;You are not allowed to move the folder to the shared location.\u0026#39; =\u0026gt; \u0026#39;您无权移动目录至共享位置.\u0026#39;, \u0026#39;You are not allowed to move this shared folder to your own folder.\u0026#39; =\u0026gt; \u0026#39;您无权移动该共享目录到您的目录.\u0026#39;, \u0026#39;Folder moved.\u0026#39; =\u0026gt; \u0026#39;目录移动成功.\u0026#39;, \u0026#39;Failed to move folder!\u0026#39; =\u0026gt; \u0026#39;目录移动失败!\u0026#39;, \u0026#39;Failed to rename folder!\u0026#39; =\u0026gt; \u0026#39;文件夹重命名失败\u0026#39;, \u0026#39;There is already a folder with the same name in this folder!\u0026#39; =\u0026gt; \u0026#39;此目录下已存在同名目录!\u0026#39;, \u0026#39;Folder successfully created.\u0026#39; =\u0026gt; \u0026#39;目录创建成功.\u0026#39;, \u0026#39;Failed to create folder!\u0026#39; =\u0026gt; \u0026#39;目录创建失败!\u0026#39;, \u0026#39;Failed to upload file \u0026#34;%1\u0026#34;: %2\u0026#39; =\u0026gt; \u0026#39;上传文件失败 \u0026#34;%1\u0026#34;: %2\u0026#39;, \u0026#39;You are not allowed to upload to this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权上传至此共享目录.\u0026#39;, \u0026#39;No more file space available!\u0026#39; =\u0026gt; \u0026#39;磁盘空间不足!\u0026#39;, \u0026#39;File uploaded.\u0026#39; =\u0026gt; \u0026#39;文件上传成功.\u0026#39;, \u0026#39;The previous version is available from the versioning menu.\u0026#39; =\u0026gt; \u0026#39;上一可用版本.\u0026#39;, \u0026#39;Failed to upload file.\u0026#39; =\u0026gt; \u0026#39;文件上传失败.\u0026#39;, \u0026#39;Please specify a file for upload.\u0026#39; =\u0026gt; \u0026#39;请指定上传文件.\u0026#39;, \u0026#39;The monthly traffic limit has been reached!\u0026#39; =\u0026gt; \u0026#39;已达到月流量限制!\u0026#39;, \u0026#39;Click \u0026lt;a href=\u0026#34;%1\u0026#34;\u0026gt;here\u0026lt;/a\u0026gt; to go back.\u0026#39; =\u0026gt; \u0026#39;点击 \u0026lt;a href=\u0026#34;%1\u0026#34;\u0026gt;这里\u0026lt;/a\u0026gt; 返回.\u0026#39;, \u0026#39;A file named \u0026#34;%1\u0026#34; already exists!\u0026#39; =\u0026gt; \u0026#39;已存在同名文件 \u0026#34;%1\u0026#34; !\u0026#39;, \u0026#39;The path of your home folder doesn\\\u0026#39;t point to an existing folder. Please contact the site administrator.\u0026#39; =\u0026gt; \u0026#39;您的个人工作目录不存在, 请联系系统管理员.\u0026#39;, \u0026#39;Failed to move file %1\u0026#39; =\u0026gt; \u0026#39;无法移动文件 %1\u0026#39;, \u0026#39;The file size exceeds the destination folder quota.\u0026#39; =\u0026gt; \u0026#39;文件大小超过目标文件夹配额。\u0026#39;, \u0026#39;Zip Archive.zip\u0026#39; =\u0026gt; \u0026#39;压缩为archive.zip\u0026#39;, \u0026#39;The shared folder is no longer available.\u0026#39; =\u0026gt; \u0026#39;共享文件夹不再可用。\u0026#39;, \u0026#39;You are not allowed to modify files in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权修改此共享目录内的文件\u0026#39;, \u0026#39;You are not allowed to upload files in this folder.\u0026#39; =\u0026gt; \u0026#39;您无权在此目录上传文件\u0026#39;, \u0026#39;Please type a name for the file!\u0026#39; =\u0026gt; \u0026#39;请为此文件输入文件名\u0026#39;, \u0026#39;Please type a name for the folder!\u0026#39; =\u0026gt; \u0026#39;请输入文件夹的名称\u0026#39;, \u0026#39;You are not allowed to create folders under this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权在此目录创建文件夹\u0026#39;, \u0026#39;%1 minutes\u0026#39; =\u0026gt; \u0026#39;%1分钟\u0026#39;, \u0026#39;%1 minutes ago\u0026#39; =\u0026gt; \u0026#39;%1分钟之前\u0026#39;, \u0026#39;One hour\u0026#39; =\u0026gt; \u0026#39;1小时\u0026#39;, \u0026#39;One hour ago\u0026#39; =\u0026gt; \u0026#39;1小时之前\u0026#39;, \u0026#39;%1 hours\u0026#39; =\u0026gt; \u0026#39;%1小时\u0026#39;, \u0026#39;%1 hours ago\u0026#39; =\u0026gt; \u0026#39;%1小时之前\u0026#39;, \u0026#39;One day\u0026#39; =\u0026gt; \u0026#39;1天\u0026#39;, \u0026#39;One day ago\u0026#39; =\u0026gt; \u0026#39;1天之前\u0026#39;, \u0026#39;Yesterday\u0026#39; =\u0026gt; \u0026#39;昨天\u0026#39;, \u0026#39;%1 days\u0026#39; =\u0026gt; \u0026#39;%1天\u0026#39;, \u0026#39;%1 days ago\u0026#39; =\u0026gt; \u0026#39;%1天之前\u0026#39;, \u0026#39;One week\u0026#39; =\u0026gt; \u0026#39;1周\u0026#39;, \u0026#39;One week ago\u0026#39; =\u0026gt; \u0026#39;1周之前\u0026#39;, \u0026#39;%1 weeks\u0026#39; =\u0026gt; \u0026#39;%1周\u0026#39;, \u0026#39;%1 weeks ago\u0026#39; =\u0026gt; \u0026#39;%1周之前\u0026#39;, \u0026#39;One month\u0026#39; =\u0026gt; \u0026#39;1个月\u0026#39;, \u0026#39;One month ago\u0026#39; =\u0026gt; \u0026#39;1个月之前\u0026#39;, \u0026#39;%1 months\u0026#39; =\u0026gt; \u0026#39;%1个月\u0026#39;, \u0026#39;%1 months ago\u0026#39; =\u0026gt; \u0026#39;%1个月之前\u0026#39;, \u0026#39;One year\u0026#39; =\u0026gt; \u0026#39;1年\u0026#39;, \u0026#39;One year ago\u0026#39; =\u0026gt; \u0026#39;1年之前\u0026#39;, \u0026#39;%1 years\u0026#39; =\u0026gt; \u0026#39;%1年\u0026#39;, \u0026#39;%1 years ago\u0026#39; =\u0026gt; \u0026#39;%1年之前\u0026#39;, \u0026#39;You are not allowed to rename folders!\u0026#39; =\u0026gt; \u0026#39;您不能重命名文件夹\u0026#39;, \u0026#39;You are not allowed to create folders!\u0026#39; =\u0026gt; \u0026#39;你不能创建文件夹\u0026#39;, \u0026#39;One file moved to trash.\u0026#39; =\u0026gt; \u0026#39;移动文件到垃圾箱\u0026#39;, \u0026#39;%1 files successfully moved to trash.\u0026#39; =\u0026gt; \u0026#39;%1 个文件已成功移至垃圾箱\u0026#39;, \u0026#39;One folder moved to trash.\u0026#39; =\u0026gt; \u0026#39;移动文件夹到垃圾箱\u0026#39;, \u0026#39;%1 files and folders successfully deleted.\u0026#39; =\u0026gt; \u0026#39;%1 个文件和文件夹已成功删除\u0026#39;, \u0026#39;%1 files and folders successfully moved to trash.\u0026#39; =\u0026gt; \u0026#39;%1 个文件和文件夹已成功移至垃圾箱\u0026#39;, \u0026#39;Invalid folder name\u0026#39; =\u0026gt; \u0026#39;文件夹名称无效\u0026#39;, \u0026#39;Folder successfully renamed.\u0026#39; =\u0026gt; \u0026#39;文件夹重命名成功\u0026#39;, \u0026#39;One folder successfully copied.\u0026#39; =\u0026gt; \u0026#39;文件夹成功复制\u0026#39;, \u0026#39;One folder successfully moved.\u0026#39; =\u0026gt; \u0026#39;文件夹成功移动\u0026#39;, \u0026#39;File successfully copied.\u0026#39; =\u0026gt; \u0026#39;文件成功复制\u0026#39;, \u0026#39;File successfully moved.\u0026#39; =\u0026gt; \u0026#39;文件成功移动\u0026#39;, \u0026#39;%1 files and folders successfully copied.\u0026#39; =\u0026gt; \u0026#39;已成功复制%1 个文件和文件夹\u0026#39;, \u0026#39;%1 files and folders successfully moved.\u0026#39; =\u0026gt; \u0026#39;%1 个文件和文件夹已成功移动\u0026#39;, \u0026#39;%1 folders successfully copied.\u0026#39; =\u0026gt; \u0026#39;%1 个文件夹已成功复制\u0026#39;, \u0026#39;%1 folders successfully moved.\u0026#39; =\u0026gt; \u0026#39;%1 个文件夹已成功移动\u0026#39;, \u0026#39;You cannot copy a deleted file.\u0026#39; =\u0026gt; \u0026#39;您不能复制已删除的文件\u0026#39;, \u0026#39;You cannot move a deleted file.\u0026#39; =\u0026gt; \u0026#39;您无法移动已删除的文件\u0026#39;, \u0026#39;The folder cannot be copied under itself!\u0026#39; =\u0026gt; \u0026#39;该文件夹不能被复制在原文件夹中\u0026#39;, \u0026#39;The folder cannot be moved under itself!\u0026#39; =\u0026gt; \u0026#39;该文件夹不能被移动到原文件夹中\u0026#39;, \u0026#39;The specified target location is the same!\u0026#39; =\u0026gt; \u0026#39;指定的目标位置是相同的\u0026#39;, \u0026#39;One file successfully moved.\u0026#39; =\u0026gt; \u0026#39;文件成功移动\u0026#39;, \u0026#39;%1 files successfully copied.\u0026#39; =\u0026gt; \u0026#39;%1 个文件已成功复制\u0026#39;, \u0026#39;%1 files successfully moved.\u0026#39; =\u0026gt; \u0026#39;%1 个文件已成功移动\u0026#39;, \u0026#39;You are not allowed to zip folders\u0026#39; =\u0026gt; \u0026#39;你不能压缩文件夹\u0026#39;, \u0026#39;You are no longer logged in.\u0026#39; =\u0026gt; \u0026#39;您没有登录\u0026#39;, \u0026#39;This application requires authentication.\u0026#39; =\u0026gt; \u0026#39;此应用程序需要验证\u0026#39;, \u0026#39;Your user account does not have permission to perform the requested operation!\u0026#39; =\u0026gt; \u0026#39;您的用户帐户无权这样做\u0026#39;, \u0026#39;You are not allowed to move this shared item.\u0026#39; =\u0026gt; \u0026#39;您不能移动这个共享项目\u0026#39;, \u0026#39;You are not allowed to rename this shared item.\u0026#39; =\u0026gt; \u0026#39;你不能重命名这个共享项目\u0026#39;, \u0026#39;You are not allowed to delete this shared item.\u0026#39; =\u0026gt; \u0026#39;您不能删除此共享项目\u0026#39;, \u0026#39;The destination folder no longer exists!\u0026#39; =\u0026gt; \u0026#39;目标文件夹不再存在！\u0026#39;, \u0026#39;The selected file or folder no longer exists!\u0026#39; =\u0026gt; \u0026#39;所选文件或文件夹不再存在！\u0026#39;, \u0026#39;Please type a new folder name!\u0026#39; =\u0026gt; \u0026#39;请输入新的文件夹名称！\u0026#39;, \u0026#39;Please type a new file name!\u0026#39; =\u0026gt; \u0026#39;请输入新的文件名称！\u0026#39;, ), \u0026#39;DateTime\u0026#39; =\u0026gt; array ( \u0026#39;This month\u0026#39; =\u0026gt; \u0026#39;本月\u0026#39;, \u0026#39;January\u0026#39; =\u0026gt; \u0026#39;一月\u0026#39;, \u0026#39;February\u0026#39; =\u0026gt; \u0026#39;二月\u0026#39;, \u0026#39;March\u0026#39; =\u0026gt; \u0026#39;三月\u0026#39;, \u0026#39;April\u0026#39; =\u0026gt; \u0026#39;四月\u0026#39;, \u0026#39;May\u0026#39; =\u0026gt; \u0026#39;五月\u0026#39;, \u0026#39;June\u0026#39; =\u0026gt; \u0026#39;六月\u0026#39;, \u0026#39;July\u0026#39; =\u0026gt; \u0026#39;七月\u0026#39;, \u0026#39;August\u0026#39; =\u0026gt; \u0026#39;八月\u0026#39;, \u0026#39;September\u0026#39; =\u0026gt; \u0026#39;九月\u0026#39;, \u0026#39;October\u0026#39; =\u0026gt; \u0026#39;十月\u0026#39;, \u0026#39;November\u0026#39; =\u0026gt; \u0026#39;十一月\u0026#39;, \u0026#39;December\u0026#39; =\u0026gt; \u0026#39;十二月\u0026#39;, \u0026#39;Sunday\u0026#39; =\u0026gt; \u0026#39;星期日\u0026#39;, \u0026#39;Monday\u0026#39; =\u0026gt; \u0026#39;星期一\u0026#39;, \u0026#39;Tuesday\u0026#39; =\u0026gt; \u0026#39;星期二\u0026#39;, \u0026#39;Wednesday\u0026#39; =\u0026gt; \u0026#39;星期三\u0026#39;, \u0026#39;Thursday\u0026#39; =\u0026gt; \u0026#39;星期四\u0026#39;, \u0026#39;Friday\u0026#39; =\u0026gt; \u0026#39;星期五\u0026#39;, \u0026#39;Saturday\u0026#39; =\u0026gt; \u0026#39;星期六\u0026#39;, \u0026#39;Today\u0026#39; =\u0026gt; \u0026#39;今天\u0026#39;, \u0026#39;This date is before the minimum date\u0026#39; =\u0026gt; \u0026#39;此日期早于最早许可日期\u0026#39;, \u0026#39;This date is after the maximum date\u0026#39; =\u0026gt; \u0026#39;此日期晚于最晚许可日期\u0026#39;, \u0026#39;Next Month (Control+Right)\u0026#39; =\u0026gt; \u0026#39;下月(Control+右方向键)\u0026#39;, \u0026#39;Previous Month (Control+Left)\u0026#39; =\u0026gt; \u0026#39;前月(Control+左方向键)\u0026#39;, \u0026#39;Choose a month (Control+Up/Down to move years)\u0026#39; =\u0026gt; \u0026#39;选择月份(Control+上/下方向键来改变年份)\u0026#39;, \u0026#39;{0} (Spacebar)\u0026#39; =\u0026gt; \u0026#39;{0} (空格键)\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Jan\u0026#39; =\u0026gt; \u0026#39;一月\u0026#39;, \u0026#39;Feb\u0026#39; =\u0026gt; \u0026#39;二月\u0026#39;, \u0026#39;Mar\u0026#39; =\u0026gt; \u0026#39;三月\u0026#39;, \u0026#39;Apr\u0026#39; =\u0026gt; \u0026#39;四月\u0026#39;, \u0026#39;Jun\u0026#39; =\u0026gt; \u0026#39;六月\u0026#39;, \u0026#39;Jul\u0026#39; =\u0026gt; \u0026#39;七月\u0026#39;, \u0026#39;Aug\u0026#39; =\u0026gt; \u0026#39;八月\u0026#39;, \u0026#39;Sep\u0026#39; =\u0026gt; \u0026#39;九月\u0026#39;, \u0026#39;Oct\u0026#39; =\u0026gt; \u0026#39;十月\u0026#39;, \u0026#39;Nov\u0026#39; =\u0026gt; \u0026#39;十一月\u0026#39;, \u0026#39;Dec\u0026#39; =\u0026gt; \u0026#39;十二月\u0026#39;, ), \u0026#39;Trash\u0026#39; =\u0026gt; array ( \u0026#39;A file or folder already exists at the original location.\u0026#39; =\u0026gt; \u0026#39;已存在该恢复路径.\u0026#39;, \u0026#39;One item permanently deleted.\u0026#39; =\u0026gt; \u0026#39;1 个项目被永久删除\u0026#39;, \u0026#39;No items were restored!\u0026#39; =\u0026gt; \u0026#39;没有项目被恢复!\u0026#39;, \u0026#39;One item restored.\u0026#39; =\u0026gt; \u0026#39;1 个项目被恢复\u0026#39;, \u0026#39;%1 items successfully restored.\u0026#39; =\u0026gt; \u0026#39;%1 个项目被恢复\u0026#39;, \u0026#39;Trash emptied\u0026#39; =\u0026gt; \u0026#39;清空回收站\u0026#39;, \u0026#39;Failed to empty trash\u0026#39; =\u0026gt; \u0026#39;清空回收站失败\u0026#39;, \u0026#39;%1 items permanently deleted.\u0026#39; =\u0026gt; \u0026#39;%1 个项目被永久删除\u0026#39;, ), \u0026#39;Account Settings\u0026#39; =\u0026gt; array ( \u0026#39;Current password\u0026#39; =\u0026gt; \u0026#39;当前密码\u0026#39;, \u0026#39;New password\u0026#39; =\u0026gt; \u0026#39;新密码\u0026#39;, \u0026#39;Confirm new password\u0026#39; =\u0026gt; \u0026#39;确认新密码\u0026#39;, \u0026#39;Save changes\u0026#39; =\u0026gt; \u0026#39;保存\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Please type the current password correctly.\u0026#39; =\u0026gt; \u0026#39;请正确输入当前密码.\u0026#39;, \u0026#39;The password needs at least one character.\u0026#39; =\u0026gt; \u0026#39;密码需要包含至少1个字符\u0026#39;, \u0026#39;Please retype the new password correctly.\u0026#39; =\u0026gt; \u0026#39;请正确输入确认密码.\u0026#39;, \u0026#39;Please type your name\u0026#39; =\u0026gt; \u0026#39;请输入你的用户名\u0026#39;, \u0026#39;Please type your e-mail address\u0026#39; =\u0026gt; \u0026#39;请输入你的 E-mail 地址\u0026#39;, \u0026#39;Basic details\u0026#39; =\u0026gt; \u0026#39;基础信息\u0026#39;, \u0026#39;The password needs at least %1 more characters.\u0026#39; =\u0026gt; \u0026#39;密码需要包含至少%1个字符\u0026#39;, \u0026#39;The password needs at least one uppercase letter.\u0026#39; =\u0026gt; \u0026#39;密码需要包含至少1个大写字母\u0026#39;, \u0026#39;The password needs at least one special character.\u0026#39; =\u0026gt; \u0026#39;密码需要包含至少1个特殊字符\u0026#39;, \u0026#39;The password needs at to contain at least one letter.\u0026#39; =\u0026gt; \u0026#39;密码需要包含至少1个字母\u0026#39;, \u0026#39;The password needs at to contain at least one digit.\u0026#39; =\u0026gt; \u0026#39;密码需要包含至少1个数字\u0026#39;, \u0026#39;The password cannot contain the \u0026#34;%1\u0026#34; sequence.\u0026#39; =\u0026gt; \u0026#39;密码不能包含\u0026#34;%1\u0026#34;数列\u0026#39;, \u0026#39;The password cannot contain the \u0026#34;%1\u0026#34; part.\u0026#39; =\u0026gt; \u0026#39;密码不能包含\u0026#34;%1\u0026#34;部分\u0026#39;, \u0026#39;Access revoked for %1 apps\u0026#39; =\u0026gt; \u0026#39;已取消%1应用的访问权限\u0026#39;, \u0026#39;The changes has been successfully saved\u0026#39; =\u0026gt; \u0026#39;修改已经成功保存\u0026#39;, \u0026#39;Failed to save the changes!\u0026#39; =\u0026gt; \u0026#39;修改保存失败\u0026#39;, \u0026#39;No changes made\u0026#39; =\u0026gt; \u0026#39;没有进行任何修改\u0026#39;, \u0026#39;Change password\u0026#39; =\u0026gt; \u0026#39;修改密码\u0026#39;, \u0026#39;Your password has been last changed %1\u0026#39; =\u0026gt; \u0026#39;在%1您修改过密码\u0026#39;, \u0026#39;2-Step verification\u0026#39; =\u0026gt; \u0026#39;两步验证\u0026#39;, \u0026#39;Enable 2-step verification\u0026#39; =\u0026gt; \u0026#39;启用两步验证\u0026#39;, \u0026#39;Every time you login you will need to type in also a temporary code which can be generated on your mobile device with a dedicated app such as Google Authenticator.\u0026#39; =\u0026gt; \u0026#39;每次登录时，您都需要输入一个临时代码，这个代码可以通过Google Authenticator等专用应用程序在您的移动设备上生成\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;姓名\u0026#39;, \u0026#39;E-mail address\u0026#39; =\u0026gt; \u0026#39;E-mail 地址\u0026#39;, \u0026#39;E-mail notifications\u0026#39; =\u0026gt; \u0026#39;E-mail 通知\u0026#39;, \u0026#39;Mute sound notifications\u0026#39; =\u0026gt; \u0026#39;声音提示静音\u0026#39;, \u0026#39;Connected apps\u0026#39; =\u0026gt; \u0026#39;已连接的apps\u0026#39;, \u0026#39;Revoke access\u0026#39; =\u0026gt; \u0026#39;取消访问授权\u0026#39;, \u0026#39;Granted on %1 from %2\u0026#39; =\u0026gt; \u0026#39;从 %2 授予 %1\u0026#39;, \u0026#39;Profile image successfully updated\u0026#39; =\u0026gt; \u0026#39;头像上传成功\u0026#39;, \u0026#39;Failed to upload image file: %1\u0026#39; =\u0026gt; \u0026#39;上传图像文件%1失败\u0026#39;, \u0026#39;Profile image\u0026#39; =\u0026gt; \u0026#39;头像\u0026#39;, \u0026#39;Phone\u0026#39; =\u0026gt; \u0026#39;电话\u0026#39;, ), \u0026#39;File Upload\u0026#39; =\u0026gt; array ( \u0026#39;File uploaded\u0026#39; =\u0026gt; \u0026#39;文件上传成功\u0026#39;, \u0026#39;Failed to upload file\u0026#39; =\u0026gt; \u0026#39;文件上传失败\u0026#39;, \u0026#39;Failed to create folder\u0026#39; =\u0026gt; \u0026#39;文件夹创建失败\u0026#39;, \u0026#39;Failed to upload file \u0026#34;%1\u0026#34;: %2\u0026#39; =\u0026gt; \u0026#39;文件 \u0026#34;%1\u0026#34;: %2 上传失败\u0026#39;, \u0026#39;The monthly traffic limit has been reached!\u0026#39; =\u0026gt; \u0026#39;已经到达每月流量限额！\u0026#39;, \u0026#39;No more file space available!\u0026#39; =\u0026gt; \u0026#39;没有更多的可用空间了！\u0026#39;, \u0026#39;A file named \u0026#34;%1\u0026#34; already exists!\u0026#39; =\u0026gt; \u0026#39;已经存在一个名为 \u0026#34;%1\u0026#34; 的文件！\u0026#39;, \u0026#39;The file needs to be uploaded from the beginning.\u0026#39; =\u0026gt; \u0026#39;这个文件需要重新开始上传\u0026#39;, \u0026#39;Failed to transfer data. Make sure you are not trying to upload an empty folder.\u0026#39; =\u0026gt; \u0026#39;转移数据失败，请确保你没有在尝试上传一个空文件夹\u0026#39;, \u0026#39;You are not allowed to upload to this shared folder.\u0026#39; =\u0026gt; \u0026#39;你无权上传文件到这个共享文件夹\u0026#39;, \u0026#39;Failed to upload file part\u0026#39; =\u0026gt; \u0026#39;上传文件分片失败\u0026#39;, \u0026#39;Failed to upload file. Please try again.\u0026#39; =\u0026gt; \u0026#39;文件上传失败，请再试一次\u0026#39;, ), \u0026#39;E-mail Files\u0026#39; =\u0026gt; array ( \u0026#39;Done\u0026#39; =\u0026gt; \u0026#39;完成\u0026#39;, \u0026#39;Please fill in \u0026#34;From\u0026#34; field!\u0026#39; =\u0026gt; \u0026#39;请填写发件人!\u0026#39;, \u0026#39;Please set at least one recipient!\u0026#39; =\u0026gt; \u0026#39;请填写收件人!\u0026#39;, \u0026#39;Please type a subject!\u0026#39; =\u0026gt; \u0026#39;请输入标题!\u0026#39;, \u0026#39;Please type a message!\u0026#39; =\u0026gt; \u0026#39;请输入内容!\u0026#39;, \u0026#39;Email successfuly sent!\u0026#39; =\u0026gt; \u0026#39;Email发送成功!\u0026#39;, \u0026#39;Failed to send email!\u0026#39; =\u0026gt; \u0026#39;Email发送失败!\u0026#39;, \u0026#39;From\u0026#39; =\u0026gt; \u0026#39;发件人\u0026#39;, \u0026#39;To\u0026#39; =\u0026gt; \u0026#39;收件人\u0026#39;, \u0026#39;Separate recipients by ,\u0026#39; =\u0026gt; \u0026#39;多个收件人用 , 分隔\u0026#39;, \u0026#39;Select Users\u0026#39; =\u0026gt; \u0026#39;选择用户\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Subject\u0026#39; =\u0026gt; \u0026#39;标题\u0026#39;, \u0026#39;Message\u0026#39; =\u0026gt; \u0026#39;内容\u0026#39;, \u0026#39;Attachments\u0026#39; =\u0026gt; \u0026#39;附件\u0026#39;, \u0026#39;Send WebLinks instead of attaching the files.\u0026#39; =\u0026gt; \u0026#39;创建附件链接，而不发送真实附件.\u0026#39;, \u0026#39;Web link to\u0026#39; =\u0026gt; \u0026#39;链接至\u0026#39;, \u0026#39;Send\u0026#39; =\u0026gt; \u0026#39;发送\u0026#39;, \u0026#39;Please make the appropriate \u0026lt;br\u0026gt;changes to the highlighted fields.\u0026#39; =\u0026gt; \u0026#39;高亮区域请做适当修改.\u0026#39;, \u0026#39;Sending e-mail...\u0026#39; =\u0026gt; \u0026#39;正在发送，请稍候...\u0026#39;, \u0026#39;No recipient addresses found!\u0026#39; =\u0026gt; \u0026#39;未发现收件人!\u0026#39;, \u0026#39;You are not allowed to share the file \u0026#34;%1\u0026#34;!\u0026#39; =\u0026gt; \u0026#39;您无权从该目录发送文件!\u0026#39;, \u0026#39;Optional: include a personal message...\u0026#39; =\u0026gt; \u0026#39;可选：包含个人信息......\u0026#39;, \u0026#39;Web Link Options\u0026#39; =\u0026gt; \u0026#39;分享链接选项\u0026#39;, \u0026#39;The message was not sent to any of the recipients\u0026#39; =\u0026gt; \u0026#39;该消息没有发送到任何人。\u0026#39;, \u0026#39;The message has been sent to one recipient\u0026#39; =\u0026gt; \u0026#39;该消息已经被发送给1个收件人。\u0026#39;, \u0026#39;The message has been sent to %1 recipients\u0026#39; =\u0026gt; \u0026#39;该消息已经被发送给1%个收件人。\u0026#39;, \u0026#39;Errors: %1\u0026#39; =\u0026gt; \u0026#39;错误: %1\u0026#39;, \u0026#39;Overwrite existing link settings.\u0026#39; =\u0026gt; \u0026#39;覆盖现有的链接设置\u0026#39;, \u0026#39;You are not allowed to share the folder \u0026#34;%1\u0026#34;!\u0026#39; =\u0026gt; \u0026#39;你没有分享 \u0026#34;%1\u0026#34; 文件夹的权限！\u0026#39;, \u0026#39;You are not allowed to create links! You can send files only as attachments.\u0026#39; =\u0026gt; \u0026#39;你没有创建链接的权限！你只能通过附件发送文件。\u0026#39;, \u0026#39;%1 sent you a file\u0026#39; =\u0026gt; \u0026#39;%1 向你发送了 1 个文件\u0026#39;, \u0026#39;%1 sent you %2 files\u0026#39; =\u0026gt; \u0026#39;%1 向你发送了 %2 个文件\u0026#39;, \u0026#39;Please wait\u0026#39; =\u0026gt; \u0026#39;请稍等\u0026#39;, ), \u0026#39;Share Files\u0026#39; =\u0026gt; array ( \u0026#39;Add guest user\u0026#39; =\u0026gt; \u0026#39;添加访客用户\u0026#39;, \u0026#39;Next\u0026#39; =\u0026gt; \u0026#39;下一个\u0026#39;, \u0026#39;Upload\u0026#39; =\u0026gt; \u0026#39;上传\u0026#39;, \u0026#39;Download\u0026#39; =\u0026gt; \u0026#39;下载\u0026#39;, \u0026#39;Add comments\u0026#39; =\u0026gt; \u0026#39;添加评论\u0026#39;, \u0026#39;Read comments\u0026#39; =\u0026gt; \u0026#39;读取评论\u0026#39;, \u0026#39;Make changes\u0026#39; =\u0026gt; \u0026#39;做出改变\u0026#39;, \u0026#39;Share anonymously\u0026#39; =\u0026gt; \u0026#39;匿名共享\u0026#39;, \u0026#39;Share with\u0026#39; =\u0026gt; \u0026#39;共享\u0026#39;, \u0026#39;Select Users\u0026#39; =\u0026gt; \u0026#39;选择用户\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Unsorted, %1 users\u0026#39; =\u0026gt; \u0026#39;不排序, %1用户\u0026#39;, \u0026#39;Permissions\u0026#39; =\u0026gt; \u0026#39;权限\u0026#39;, \u0026#39;Options\u0026#39; =\u0026gt; \u0026#39;选项\u0026#39;, \u0026#39;Add Users\u0026#39; =\u0026gt; \u0026#39;添加用户\u0026#39;, \u0026#39;Remove\u0026#39; =\u0026gt; \u0026#39;移除\u0026#39;, \u0026#39;Save\u0026#39; =\u0026gt; \u0026#39;保存\u0026#39;, \u0026#39;Loading data...\u0026#39; =\u0026gt; \u0026#39;加载数据...\u0026#39;, \u0026#39;Saving options...\u0026#39; =\u0026gt; \u0026#39;保存选项...\u0026#39;, \u0026#39;Add users to share with.\u0026#39; =\u0026gt; \u0026#39;添加共享用户.\u0026#39;, \u0026#39;Sharing options saved.\u0026#39; =\u0026gt; \u0026#39;共享选项已保存.\u0026#39;, \u0026#39;Ok\u0026#39; =\u0026gt; \u0026#39;确定\u0026#39;, \u0026#39;Share as\u0026#39; =\u0026gt; \u0026#39;共享为\u0026#39;, \u0026#39;Share links\u0026#39; =\u0026gt; \u0026#39;分享链接\u0026#39;, \u0026#39;Add user\u0026#39; =\u0026gt; \u0026#39;添加用户\u0026#39;, ), \u0026#39;Folder Notifications\u0026#39; =\u0026gt; array ( \u0026#39;Notification settings successfully saved\u0026#39; =\u0026gt; \u0026#39;通知消息成功保存\u0026#39;, \u0026#39;Notifications for \u0026#34;read\u0026#34; actions cannot be set on shared folders.\u0026#39; =\u0026gt; \u0026#39;无法在已共享的文件夹上设置关于“读取”行为的通知消息\u0026#39;, \u0026#39;No changes were made.\u0026#39; =\u0026gt; \u0026#39;没有做出修改\u0026#39;, ), \u0026#39;Web Links\u0026#39; =\u0026gt; array ( \u0026#39;Upload\u0026#39; =\u0026gt; \u0026#39;上传\u0026#39;, \u0026#39;The link has been copied to clipboard.\u0026#39; =\u0026gt; \u0026#39;链接已经拷贝到剪切板\u0026#39;, \u0026#39;Loading data...\u0026#39; =\u0026gt; \u0026#39;加载数据...\u0026#39;, \u0026#39;Link address\u0026#39; =\u0026gt; \u0026#39;链接地址\u0026#39;, \u0026#39;Expiration date\u0026#39; =\u0026gt; \u0026#39;过期时间\u0026#39;, \u0026#39;Download limit\u0026#39; =\u0026gt; \u0026#39;可供下载次数\u0026#39;, \u0026#39;Set a password\u0026#39; =\u0026gt; \u0026#39;设置密码\u0026#39;, \u0026#39;Receive e-mail notifications.\u0026#39; =\u0026gt; \u0026#39;接受电子邮件提示\u0026#39;, \u0026#39;Allow visitors to upload files.\u0026#39; =\u0026gt; \u0026#39;允许访问者上传文件\u0026#39;, \u0026#39;Save changes\u0026#39; =\u0026gt; \u0026#39;更新设置\u0026#39;, \u0026#39;Remove link\u0026#39; =\u0026gt; \u0026#39;移除Web链接\u0026#39;, \u0026#39;You cannot allow uploads in this folder\u0026#39; =\u0026gt; \u0026#39;你不能设置允许上传文件到该文件夹\u0026#39;, \u0026#39;Web link successfully created!\u0026#39; =\u0026gt; \u0026#39;Web链接创建成功!\u0026#39;, \u0026#39;Failed to create web link!\u0026#39; =\u0026gt; \u0026#39;Web链接创建失败!\u0026#39;, \u0026#39;Web link successfully updated!\u0026#39; =\u0026gt; \u0026#39;Web链接更新成功!\u0026#39;, \u0026#39;Failed to update web link!\u0026#39; =\u0026gt; \u0026#39;Web链接更新失败!\u0026#39;, \u0026#39;Web link successfully deleted!\u0026#39; =\u0026gt; \u0026#39;Web链接删除成功!\u0026#39;, \u0026#39;Failed to delete web link!\u0026#39; =\u0026gt; \u0026#39;Web链接删除失败!\u0026#39;, \u0026#39;The requested file requires a password.\u0026#39; =\u0026gt; \u0026#39;请求的文件需要密码.\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;密码\u0026#39;, \u0026#39;Submit\u0026#39; =\u0026gt; \u0026#39;提交\u0026#39;, \u0026#39;The requested file is no longer available!\u0026#39; =\u0026gt; \u0026#39;请求的文件已失效!\u0026#39;, \u0026#39;Click \u0026lt;a href=\u0026#34;%1\u0026#34;\u0026gt;here\u0026lt;/a\u0026gt; to go back.\u0026#39; =\u0026gt; \u0026#39;点击 \u0026lt;a href=\u0026#34;%1\u0026#34;\u0026gt;这里\u0026lt;/a\u0026gt; 返回.\u0026#39;, \u0026#39;Open\u0026#39; =\u0026gt; \u0026#39;打开\u0026#39;, \u0026#39;E-mail\u0026#39; =\u0026gt; \u0026#39;电子邮件\u0026#39;, \u0026#39;Grid view\u0026#39; =\u0026gt; \u0026#39;网格显示\u0026#39;, \u0026#39;Short Link\u0026#39; =\u0026gt; \u0026#39;短链接\u0026#39;, \u0026#39;Image gallery\u0026#39; =\u0026gt; \u0026#39;图像库\u0026#39;, \u0026#39;Audio playlist\u0026#39; =\u0026gt; \u0026#39;音频播放列表\u0026#39;, \u0026#39;RSS feed\u0026#39; =\u0026gt; \u0026#39;RSS订阅\u0026#39;, \u0026#39;You are required to password protect the link\u0026#39; =\u0026gt; \u0026#39;你需要一个密码以保护该链接\u0026#39;, \u0026#39;Advanced\u0026#39; =\u0026gt; \u0026#39;高级\u0026#39;, \u0026#39;Download Terms\u0026#39; =\u0026gt; \u0026#39;下载条款\u0026#39;, \u0026#39;Comments\u0026#39; =\u0026gt; \u0026#39;注释\u0026#39;, \u0026#39;Share the file comments with the visitors.\u0026#39; =\u0026gt; \u0026#39;向访客分享文件的评论\u0026#39;, \u0026#39;Link\u0026#39; =\u0026gt; \u0026#39;链接\u0026#39;, \u0026#39;Add download terms and conditions\u0026#39; =\u0026gt; \u0026#39;添加下载条款和限制：\u0026#39;, \u0026#39;Force the visitors to accept your written terms before being able to download files.\u0026#39; =\u0026gt; \u0026#39;强制访客在下载前接受你的条款。\u0026#39;, \u0026#39;QR Code\u0026#39; =\u0026gt; \u0026#39;QR码\u0026#39;, \u0026#39;Scan this QR code with your mobile device.\u0026#39; =\u0026gt; \u0026#39;用你的移动设备扫描该QR码\u0026#39;, \u0026#39;A Bitly Access Token needs to be configured from the control panel.\u0026#39; =\u0026gt; \u0026#39;需要从控制面板配置令牌\u0026#39;, \u0026#39;Ok\u0026#39; =\u0026gt; \u0026#39;确认\u0026#39;, \u0026#39;You are not allowed to access web links!\u0026#39; =\u0026gt; \u0026#39;没有权限访问此链接\u0026#39;, \u0026#39;Prevent the browser from opening the file.\u0026#39; =\u0026gt; \u0026#39;阻止浏览器直接打开文件\u0026#39;, \u0026#39;Some common types of files are being opened by the browser instead of asking the visitors from saving to their computers.\u0026#39; =\u0026gt; \u0026#39;一些普通类型的文件会通过浏览器直接打开而不是开始下载\u0026#39;, \u0026#39;Changes saved.\u0026#39; =\u0026gt; \u0026#39;保存修改\u0026#39;, \u0026#39;Empty contents.\u0026#39; =\u0026gt; \u0026#39;清空评论\u0026#39;, \u0026#39;Failed to save changes.\u0026#39; =\u0026gt; \u0026#39;保存修改失败\u0026#39;, \u0026#39;Done\u0026#39; =\u0026gt; \u0026#39;完成\u0026#39;, \u0026#39;E-mail program\u0026#39; =\u0026gt; \u0026#39;E-mail 程序\u0026#39;, \u0026#39;Share link\u0026#39; =\u0026gt; \u0026#39;共享链接\u0026#39;, \u0026#39;Shorten\u0026#39; =\u0026gt; \u0026#39;短链接转化\u0026#39;, \u0026#39;You are not allowed to share the selected file!\u0026#39; =\u0026gt; \u0026#39;你无权分享选定的文件！\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Display users names.\u0026#39; =\u0026gt; \u0026#39;显示用户的名字\u0026#39;, \u0026#39;Download\u0026#39; =\u0026gt; \u0026#39;下载\u0026#39;, \u0026#39;Give this link to people you’re requesting files from\u0026#39; =\u0026gt; \u0026#39;将此链接指向要请求文件的人员 \u0026#39;, \u0026#39;Download All\u0026#39; =\u0026gt; \u0026#39;下载所有\u0026#39;, \u0026#39;Submit files\u0026#39; =\u0026gt; \u0026#39;发送文件\u0026#39;, \u0026#39;%1 is requesting\u0026#39; =\u0026gt; \u0026#39;%1正在请求\u0026#39;, \u0026#39;Only %1 will see the files you upload.\u0026#39; =\u0026gt; \u0026#39;只有 %1 可以看见你上传的这些文件\u0026#39;, \u0026#39;Choose files\u0026#39; =\u0026gt; \u0026#39;选择文件\u0026#39;, \u0026#39;File request\u0026#39; =\u0026gt; \u0026#39;文件请求 \u0026#39;, \u0026#39;Enable file request.\u0026#39; =\u0026gt; \u0026#39;启用文件请求。 \u0026#39;, \u0026#39;Allow visitors to see and download the existing files.\u0026#39; =\u0026gt; \u0026#39;允许访客浏览和下载存在的文件\u0026#39;, \u0026#39;Or drag them from your computer onto this page.\u0026#39; =\u0026gt; \u0026#39;或者将他们从你的电脑拖动到这个页面\u0026#39;, \u0026#39;Who is sending the files?\u0026#39; =\u0026gt; \u0026#39;谁在发送这些文件？\u0026#39;, \u0026#39;Type your name here\u0026#39; =\u0026gt; \u0026#39;在此输入你的名字\u0026#39;, \u0026#39;Start upload\u0026#39; =\u0026gt; \u0026#39;开始上传\u0026#39;, \u0026#39;The files have been successfully sent!\u0026#39; =\u0026gt; \u0026#39;文件已经成功发送\u0026#39;, \u0026#39;Upload starting...\u0026#39; =\u0026gt; \u0026#39;开始上传...\u0026#39;, \u0026#39;Uploading...\u0026#39; =\u0026gt; \u0026#39;上传中...\u0026#39;, \u0026#39;Refreshing page...\u0026#39; =\u0026gt; \u0026#39;刷新页面...\u0026#39;, \u0026#39;List view\u0026#39; =\u0026gt; \u0026#39;列表显示\u0026#39;, \u0026#39;One item\u0026#39; =\u0026gt; \u0026#39;一个项目\u0026#39;, \u0026#39;Empty folder\u0026#39; =\u0026gt; \u0026#39;空文件夹\u0026#39;, \u0026#39;%1 items\u0026#39; =\u0026gt; \u0026#39;%1 项目\u0026#39;, \u0026#39;Options\u0026#39; =\u0026gt; \u0026#39;选项\u0026#39;, \u0026#39;Copy\u0026#39; =\u0026gt; \u0026#39;复制\u0026#39;, \u0026#39;Require visitors to be signed in.\u0026#39; =\u0026gt; \u0026#39;要求访问者登录\u0026#39;, \u0026#39;Only registered users will be able to access this link.\u0026#39; =\u0026gt; \u0026#39;只有注册用户才能访问此链接\u0026#39;, ), \u0026#39;Files Activity Log\u0026#39; =\u0026gt; array ( \u0026#39;File moved with parent folder\u0026#39; =\u0026gt; \u0026#39;文件与父文件夹一起移动\u0026#39;, \u0026#39;Folder moved with parent folder\u0026#39; =\u0026gt; \u0026#39;文件夹与父文件夹移动\u0026#39;, \u0026#39;Date\u0026#39; =\u0026gt; \u0026#39;日期\u0026#39;, \u0026#39;User\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Action\u0026#39; =\u0026gt; \u0026#39;行为\u0026#39;, \u0026#39;Details\u0026#39; =\u0026gt; \u0026#39;明细\u0026#39;, \u0026#39;No activity records found for this file.\u0026#39; =\u0026gt; \u0026#39;没有发现该文件的活动日志。\u0026#39;, \u0026#39;You are not allowed to access the files activity logs\u0026#39; =\u0026gt; \u0026#39;你不允许访问该文件的活动日志。\u0026#39;, \u0026#39;Displaying records {0} - {1} of {2}\u0026#39; =\u0026gt; \u0026#39;显示记录{0} - {1} of {2}\u0026#39;, \u0026#39;No records to display\u0026#39; =\u0026gt; \u0026#39;没有要显示的记录\u0026#39;, \u0026#39;Page\u0026#39; =\u0026gt; \u0026#39;页\u0026#39;, \u0026#39;of {0}\u0026#39; =\u0026gt; \u0026#39;共{0}\u0026#39;, \u0026#39;First Page\u0026#39; =\u0026gt; \u0026#39;第一页\u0026#39;, \u0026#39;Last Page\u0026#39; =\u0026gt; \u0026#39;最后一页\u0026#39;, \u0026#39;Next Page\u0026#39; =\u0026gt; \u0026#39;下一页\u0026#39;, \u0026#39;Previous Page\u0026#39; =\u0026gt; \u0026#39;前一页\u0026#39;, \u0026#39;Refresh\u0026#39; =\u0026gt; \u0026#39;刷新\u0026#39;, \u0026#39;%2 by \u0026lt;span style=\u0026#34;color:black\u0026#34;\u0026gt;%1\u0026lt;/span\u0026gt;\u0026#39; =\u0026gt; \u0026#39;%2 由\u0026lt;span style=\u0026#34;color:black\u0026#34;\u0026gt;%1\u0026lt;/span\u0026gt;\u0026#39;, \u0026#39;File uploaded\u0026#39; =\u0026gt; \u0026#39;文件已上传\u0026#39;, \u0026#39;Uploaded by %1\u0026#39; =\u0026gt; \u0026#39;由%1上传\u0026#39;, \u0026#39;File downloaded\u0026#39; =\u0026gt; \u0026#39;文件已下载\u0026#39;, \u0026#39;Downloaded by %1\u0026#39; =\u0026gt; \u0026#39;由%1下载\u0026#39;, \u0026#39;File archived for download\u0026#39; =\u0026gt; \u0026#39;文件已经被打包供下载\u0026#39;, \u0026#39;Archived for download by %1\u0026#39; =\u0026gt; \u0026#39;由%1打包\u0026#39;, \u0026#39;File archived\u0026#39; =\u0026gt; \u0026#39;文件被打包\u0026#39;, \u0026#39;File copied\u0026#39; =\u0026gt; \u0026#39;文件被复制\u0026#39;, \u0026#39;Copied by %1\u0026#39; =\u0026gt; \u0026#39;由%1复制\u0026#39;, \u0026#39;File pasted\u0026#39; =\u0026gt; \u0026#39;文件被粘贴\u0026#39;, \u0026#39;Pasted by %1\u0026#39; =\u0026gt; \u0026#39;由%1粘贴\u0026#39;, \u0026#39;File moved\u0026#39; =\u0026gt; \u0026#39;文件被移动\u0026#39;, \u0026#39;Moved by %1\u0026#39; =\u0026gt; \u0026#39;有%1移动\u0026#39;, \u0026#39;File deleted\u0026#39; =\u0026gt; \u0026#39;文件被删除\u0026#39;, \u0026#39;Deleted by %1\u0026#39; =\u0026gt; \u0026#39;被%1删除\u0026#39;, \u0026#39;Deleted file restored\u0026#39; =\u0026gt; \u0026#39;已恢复被删除文件\u0026#39;, \u0026#39;Restored by %1\u0026#39; =\u0026gt; \u0026#39;由%恢复\u0026#39;, \u0026#39;File previewed\u0026#39; =\u0026gt; \u0026#39;文件被预览\u0026#39;, \u0026#39;Previewed by %1\u0026#39; =\u0026gt; \u0026#39;由%1预览\u0026#39;, \u0026#39;WebLink download\u0026#39; =\u0026gt; \u0026#39;WebLink被下载\u0026#39;, \u0026#39;Downloaded through %1\\\u0026#39;s WebLink\u0026#39; =\u0026gt; \u0026#39;下载通过%1的WebLink\u0026#39;, \u0026#39;WebLink created\u0026#39; =\u0026gt; \u0026#39;WebLink被创建\u0026#39;, \u0026#39;%1 attached a WebLink\u0026#39; =\u0026gt; \u0026#39;%1附加了WebLink\u0026#39;, \u0026#39;WebLink updated\u0026#39; =\u0026gt; \u0026#39;WebLink被更新\u0026#39;, \u0026#39;%1 changed the WebLink\\\u0026#39;s options\u0026#39; =\u0026gt; \u0026#39;%1更改了WebLink选项\u0026#39;, \u0026#39;WebLink removed\u0026#39; =\u0026gt; \u0026#39;WebLink被删除\u0026#39;, \u0026#39;%1 removed the WebLink\u0026#39; =\u0026gt; \u0026#39;%1删除了WebLink\u0026#39;, \u0026#39;Comment added\u0026#39; =\u0026gt; \u0026#39;评论被添加\u0026#39;, \u0026#39;%1 wrote a comment\u0026#39; =\u0026gt; \u0026#39;%1添加了评论：%2\u0026#39;, \u0026#39;Comment removed\u0026#39; =\u0026gt; \u0026#39;评论被删除\u0026#39;, \u0026#39;%1 removed a comment\u0026#39; =\u0026gt; \u0026#39;%1删除了评论：%2\u0026#39;, \u0026#39;Metadata changed\u0026#39; =\u0026gt; \u0026#39;元数据被更改\u0026#39;, \u0026#39;Metadata changed by %1\u0026#39; =\u0026gt; \u0026#39;元数据被%1更改\u0026#39;, \u0026#39;File locked\u0026#39; =\u0026gt; \u0026#39;文件被锁定\u0026#39;, \u0026#39;Locked by %1\u0026#39; =\u0026gt; \u0026#39;文件被%1锁定\u0026#39;, \u0026#39;File unlocked\u0026#39; =\u0026gt; \u0026#39;文件被解锁\u0026#39;, \u0026#39;Unlocked by %1\u0026#39; =\u0026gt; \u0026#39;文件被%1解锁\u0026#39;, \u0026#39;Previous file version restored\u0026#39; =\u0026gt; \u0026#39;预览文件版本被恢复\u0026#39;, \u0026#39;Previous version restored by %1\u0026#39; =\u0026gt; \u0026#39;预览文件版本被%1恢复\u0026#39;, \u0026#39;Previous file version deleted\u0026#39; =\u0026gt; \u0026#39;预览文件版本被删除\u0026#39;, \u0026#39;Previous version deleted by %1\u0026#39; =\u0026gt; \u0026#39;预览文件版本被%1删除\u0026#39;, \u0026#39;File renamed\u0026#39; =\u0026gt; \u0026#39;文件被重命名\u0026#39;, \u0026#39;Renamed by %1\u0026#39; =\u0026gt; \u0026#39;文件被%1重命名\u0026#39;, \u0026#39;File encrypted\u0026#39; =\u0026gt; \u0026#39;文件被加密\u0026#39;, \u0026#39;Encrypted by %1\u0026#39; =\u0026gt; \u0026#39;文件被%1加密\u0026#39;, \u0026#39;File decrypted\u0026#39; =\u0026gt; \u0026#39;文件被解密\u0026#39;, \u0026#39;Decrypted by %1\u0026#39; =\u0026gt; \u0026#39;文件被%1解密\u0026#39;, \u0026#39;File sent by e-mail\u0026#39; =\u0026gt; \u0026#39;文件被通过电子邮件发送\u0026#39;, \u0026#39;Send by e-mail by %1\u0026#39; =\u0026gt; \u0026#39;由%1通过电子邮件发送\u0026#39;, \u0026#39;Changed label\u0026#39; =\u0026gt; \u0026#39;更改标记\u0026#39;, \u0026#39;Label removed\u0026#39; =\u0026gt; \u0026#39;标记被删除\u0026#39;, \u0026#39;Labeled by %1: %2\u0026#39; =\u0026gt; \u0026#39;被 %1: %2 标记\u0026#39;, \u0026#39;Label removed by %1\u0026#39; =\u0026gt; \u0026#39;标记被 %1 删除\u0026#39;, \u0026#39;Are you sure you want to clear the file\\\u0026#39;s activity log?\u0026#39; =\u0026gt; \u0026#39;你确定要清除文件活动日志吗？\u0026#39;, \u0026#39;Activity log successfully cleared\u0026#39; =\u0026gt; \u0026#39;活动日志成功清除\u0026#39;, \u0026#39;Failed to clear activity log\u0026#39; =\u0026gt; \u0026#39;活动日志清除失败\u0026#39;, \u0026#39;Clear log\u0026#39; =\u0026gt; \u0026#39;清除日志\u0026#39;, \u0026#39;Activity log has been successfully archived!\u0026#39; =\u0026gt; \u0026#39;活动日志已成功存档！\u0026#39;, ), \u0026#39;Metadata\u0026#39; =\u0026gt; array ( \u0026#39;You are not allowed to alter data in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权在此共享目录内更改数据.\u0026#39;, \u0026#39;Software Error: Failed to insert new path.\u0026#39; =\u0026gt; \u0026#39;软件错误: 插入新路径失败.\u0026#39;, \u0026#39;File Type\u0026#39; =\u0026gt; \u0026#39;文件类型\u0026#39;, \u0026#39;Select...\u0026#39; =\u0026gt; \u0026#39;选择...\u0026#39;, \u0026#39;- File Type Not Found -\u0026#39; =\u0026gt; \u0026#39;- 未找到文件类型 -\u0026#39;, \u0026#39;Save\u0026#39; =\u0026gt; \u0026#39;保存\u0026#39;, \u0026#39;Saving data...\u0026#39; =\u0026gt; \u0026#39;保存数据...\u0026#39;, \u0026#39;Failed to save data!\u0026#39; =\u0026gt; \u0026#39;保存数据失败!\u0026#39;, \u0026#39;- No Special Type -\u0026#39; =\u0026gt; \u0026#39;- 无指定类型 -\u0026#39;, \u0026#39;No changes were made\u0026#39; =\u0026gt; \u0026#39;无变化\u0026#39;, \u0026#39;Changes saved\u0026#39; =\u0026gt; \u0026#39;已保存更改\u0026#39;, ), \u0026#39;Versioning\u0026#39; =\u0026gt; array ( \u0026#39;Version\u0026#39; =\u0026gt; \u0026#39;版本\u0026#39;, \u0026#39;User\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Date\u0026#39; =\u0026gt; \u0026#39;日期\u0026#39;, \u0026#39;Download\u0026#39; =\u0026gt; \u0026#39;下载\u0026#39;, \u0026#39;Restore\u0026#39; =\u0026gt; \u0026#39;还原\u0026#39;, \u0026#39;Delete\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;File version restored.\u0026#39; =\u0026gt; \u0026#39;文件版本还原成功.\u0026#39;, \u0026#39;Failed to restore file version.\u0026#39; =\u0026gt; \u0026#39;文件版本还原失败.\u0026#39;, \u0026#39;File version deleted.\u0026#39; =\u0026gt; \u0026#39;文件版本删除成功.\u0026#39;, \u0026#39;Failed to delete file version.\u0026#39; =\u0026gt; \u0026#39;文件版本删除失败.\u0026#39;, \u0026#39;You are not allowed to lock/unlock files in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权在此目录内锁定/解锁文件.\u0026#39;, \u0026#39;The file has been locked.\u0026#39; =\u0026gt; \u0026#39;该文件已被锁定.\u0026#39;, \u0026#39;The file has been unlocked.\u0026#39; =\u0026gt; \u0026#39;该文件已解锁.\u0026#39;, \u0026#39;Failed to lock file!\u0026#39; =\u0026gt; \u0026#39;锁定文件失败!\u0026#39;, \u0026#39;Failed to unlock file!\u0026#39; =\u0026gt; \u0026#39;解锁文件失败!\u0026#39;, \u0026#39;File is locked by another user.\u0026#39; =\u0026gt; \u0026#39;文件已被其他人锁定.\u0026#39;, \u0026#39;File is already locked by somebody else.\u0026#39; =\u0026gt; \u0026#39;文件已被其他人锁定.\u0026#39;, \u0026#39;Modified by\u0026#39; =\u0026gt; \u0026#39;修改者\u0026#39;, \u0026#39;Size\u0026#39; =\u0026gt; \u0026#39;大小\u0026#39;, \u0026#39;The file is not locked.\u0026#39; =\u0026gt; \u0026#39;文件还未被锁定\u0026#39;, \u0026#39;The file is already locked.\u0026#39; =\u0026gt; \u0026#39;文件已经被锁定\u0026#39;, ), \u0026#39;Searching\u0026#39; =\u0026gt; array ( \u0026#39;File name\u0026#39; =\u0026gt; \u0026#39;文件名\u0026#39;, \u0026#39;File contents\u0026#39; =\u0026gt; \u0026#39;文件内容\u0026#39;, \u0026#39;Look in\u0026#39; =\u0026gt; \u0026#39;查看\u0026#39;, \u0026#39;Metadata Field\u0026#39; =\u0026gt; \u0026#39;元数据域\u0026#39;, \u0026#39;Metadata\u0026#39; =\u0026gt; \u0026#39;元数据\u0026#39;, \u0026#39;Select...\u0026#39; =\u0026gt; \u0026#39;选择...\u0026#39;, \u0026#39;Path\u0026#39; =\u0026gt; \u0026#39;路径\u0026#39;, \u0026#39;Searching...\u0026#39; =\u0026gt; \u0026#39;搜索...\u0026#39;, \u0026#39;Search\u0026#39; =\u0026gt; \u0026#39;搜索\u0026#39;, \u0026#39;- None Selected -\u0026#39; =\u0026gt; \u0026#39;- 未选定 -\u0026#39;, \u0026#39;Metadata Type\u0026#39; =\u0026gt; \u0026#39;元数据类型\u0026#39;, \u0026#39;Field Value\u0026#39; =\u0026gt; \u0026#39;字段值\u0026#39;, ), \u0026#39;Custom Actions: CloudConvert\u0026#39; =\u0026gt; array ( \u0026#39;API Key\u0026#39; =\u0026gt; \u0026#39;API密钥 \u0026#39;, \u0026#39;Convert \u0026#34;%1\u0026#34; to:\u0026#39; =\u0026gt; \u0026#39;将“%1”转换为： \u0026#39;, \u0026#39;No conversion option found for the \u0026#34;%1\u0026#34; file type.\u0026#39; =\u0026gt; \u0026#39;找不到“%1”文件类型的转换选项。\u0026#39;, ), \u0026#39;File Comments\u0026#39; =\u0026gt; array ( \u0026#39;Author\u0026#39; =\u0026gt; \u0026#39;作者\u0026#39;, \u0026#39;Comment\u0026#39; =\u0026gt; \u0026#39;评论\u0026#39;, \u0026#39;Add comment\u0026#39; =\u0026gt; \u0026#39;添加评论\u0026#39;, \u0026#39;Type in your comment\u0026#39; =\u0026gt; \u0026#39;输入您的评论\u0026#39;, \u0026#39;Remove comment\u0026#39; =\u0026gt; \u0026#39;删除评论\u0026#39;, \u0026#39;You are not allowed to read comments.\u0026#39; =\u0026gt; \u0026#39;您无权读取评论\u0026#39;, \u0026#39;You are not allowed to add comments.\u0026#39; =\u0026gt; \u0026#39;您无权添加评论\u0026#39;, \u0026#39;You are not allowed to remove comments.\u0026#39; =\u0026gt; \u0026#39;您无权删除评论\u0026#39;, \u0026#39;You are not allowed to add comments to files in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权添加此目录的评论。\u0026#39;, \u0026#39;You are not allowed to remove comments from files in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权删除此目录的评论。\u0026#39;, \u0026#39;You are allowed to delete only your own comments from a shared file.\u0026#39; =\u0026gt; \u0026#39;您仅可删除共享文件中您自己的评论.\u0026#39;, \u0026#39;You are not allowed to read comments in this shared folder.\u0026#39; =\u0026gt; \u0026#39;您无权读取此目录的评论。\u0026#39;, \u0026#39;No comments available for this file.\u0026#39; =\u0026gt; \u0026#39;没有评论。\u0026#39;, \u0026#39;Comment successfully added.\u0026#39; =\u0026gt; \u0026#39;评论成功.\u0026#39;, \u0026#39;Failed to add comment to file.\u0026#39; =\u0026gt; \u0026#39;评论失败.\u0026#39;, \u0026#39;Comment successfully removed.\u0026#39; =\u0026gt; \u0026#39;评论删除成功.\u0026#39;, \u0026#39;Failed to remove comment from file.\u0026#39; =\u0026gt; \u0026#39;评论删除失败.\u0026#39;, ), \u0026#39;Custom Actions: Text Editor\u0026#39; =\u0026gt; array ( \u0026#39;Text Editor\u0026#39; =\u0026gt; \u0026#39;文本编辑器\u0026#39;, \u0026#39;Text File\u0026#39; =\u0026gt; \u0026#39;创建文本文件\u0026#39;, \u0026#39;Untitled.txt\u0026#39; =\u0026gt; \u0026#39;未命名.txt\u0026#39;, \u0026#39;Save\u0026#39; =\u0026gt; \u0026#39;保存\u0026#39;, \u0026#39;Saving...\u0026#39; =\u0026gt; \u0026#39;保存中...\u0026#39;, \u0026#39;File successfully saved\u0026#39; =\u0026gt; \u0026#39;文本文件保存成功\u0026#39;, \u0026#39;File successfully created\u0026#39; =\u0026gt; \u0026#39;文本文件创建成功\u0026#39;, \u0026#39;A file with that name already exists\u0026#39; =\u0026gt; \u0026#39;同名文件已存在\u0026#39;, \u0026#39;Please type a file name\u0026#39; =\u0026gt; \u0026#39;请输入文件名\u0026#39;, \u0026#39;Other..\u0026#39; =\u0026gt; \u0026#39;其他..\u0026#39;, \u0026#39;New Text File.txt\u0026#39; =\u0026gt; \u0026#39;新建文本文件.txt\u0026#39;, \u0026#39;Would you like to reload the file using the selected charset? Any unsaved changes will be lost.\u0026#39; =\u0026gt; \u0026#39;你想使用选定的字符集重新加载文件？任何未保存的更改都将丢失。 \u0026#39;, \u0026#39;Save and close\u0026#39; =\u0026gt; \u0026#39;保存并关闭\u0026#39;, \u0026#39;Word wrap\u0026#39; =\u0026gt; \u0026#39;自动换行 \u0026#39;, \u0026#39;The file type is not allowed.\u0026#39; =\u0026gt; \u0026#39;文件类型是不允许的。 \u0026#39;, \u0026#39;Close\u0026#39; =\u0026gt; \u0026#39;关闭\u0026#39;, ), \u0026#39;Custom Actions: Zoho\u0026#39; =\u0026gt; array ( \u0026#39;API key\u0026#39; =\u0026gt; \u0026#39;API密钥 \u0026#39;, \u0026#39;Zoho Editor\u0026#39; =\u0026gt; \u0026#39;Zoho 编辑器\u0026#39;, \u0026#39;Document with Zoho\u0026#39; =\u0026gt; \u0026#39;Zoho文档\u0026#39;, \u0026#39;Untitled.docx\u0026#39; =\u0026gt; \u0026#39;未命名.docx\u0026#39;, \u0026#39;Blank file created successfully\u0026#39; =\u0026gt; \u0026#39;空文件创建成功\u0026#39;, ), \u0026#39;Custom Actions: File Encryption\u0026#39; =\u0026gt; array ( \u0026#39;Path to AESCrypt\u0026#39; =\u0026gt; \u0026#39;AESCrypt的路径 \u0026#39;, \u0026#39;Download and install AESCrypt from \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;here\u0026lt;/a\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;\t从\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;此处\u0026lt;/a\u0026gt;下载并安装AESCrypt。\u0026#39;, \u0026#39;AES File Encryption\u0026#39; =\u0026gt; \u0026#39;AES文件加密\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;密码\u0026#39;, \u0026#39;Decrypt \u0026#34;%1\u0026#34;\u0026#39; =\u0026gt; \u0026#39;解密 “%1”\u0026#39;, \u0026#39;Encrypt \u0026#34;%1\u0026#34;\u0026#39; =\u0026gt; \u0026#39;加密 “%1”\u0026#39;, \u0026#39;Processing file...\u0026#39; =\u0026gt; \u0026#39;文件处理中...\u0026#39;, \u0026#39;The user doesn\\\u0026#39;t have permission to use this function!\u0026#39; =\u0026gt; \u0026#39;这个用户无权使用该功能！\u0026#39;, \u0026#39;The selected file was successfully decrypted.\u0026#39; =\u0026gt; \u0026#39;选中的文件已被成功解密。\u0026#39;, \u0026#39;Failed to decrypt the selected file!\u0026#39; =\u0026gt; \u0026#39;选中的文件无法成功解密！\u0026#39;, \u0026#39;A file named \u0026#34;%1\u0026#34; already exists!\u0026#39; =\u0026gt; \u0026#39;一个叫做“%1”的文件已经存在！\u0026#39;, \u0026#39;The selected file was successfully encrypted.\u0026#39; =\u0026gt; \u0026#39;选中的文件已被成功加密。\u0026#39;, \u0026#39;Failed to encrypt the selected file!\u0026#39; =\u0026gt; \u0026#39;选中的文件无法成功加密！\u0026#39;, \u0026#39;The selected file was not found!\u0026#39; =\u0026gt; \u0026#39;无法找到选中的文件！\u0026#39;, \u0026#39;Confirm password\u0026#39; =\u0026gt; \u0026#39;确认密码\u0026#39;, \u0026#39;Delete the source file\u0026#39; =\u0026gt; \u0026#39;删除源文件\u0026#39;, \u0026#39;Please type the password\u0026#39; =\u0026gt; \u0026#39;请输入密码\u0026#39;, \u0026#39;Please confirm the password\u0026#39; =\u0026gt; \u0026#39;请再次输入密码\u0026#39;, ), \u0026#39;Admin\u0026#39; =\u0026gt; array ( \u0026#39;Control Panel\u0026#39; =\u0026gt; \u0026#39;控制面板\u0026#39;, \u0026#39;Users\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Import users\u0026#39; =\u0026gt; \u0026#39;导入用户\u0026#39;, \u0026#39;Activity logs\u0026#39; =\u0026gt; \u0026#39;活动日志\u0026#39;, \u0026#39;E-mail notifications\u0026#39; =\u0026gt; \u0026#39;E-mail通知\u0026#39;, \u0026#39;Configuration\u0026#39; =\u0026gt; \u0026#39;系统配置\u0026#39;, \u0026#39;Configure system options.\u0026#39; =\u0026gt; \u0026#39;系统选项.\u0026#39;, \u0026#39;Interface\u0026#39; =\u0026gt; \u0026#39;界面选项\u0026#39;, \u0026#39;Login and registration\u0026#39; =\u0026gt; \u0026#39;用户登录和注册\u0026#39;, \u0026#39;E-mail\u0026#39; =\u0026gt; \u0026#39;E-mail设置\u0026#39;, \u0026#39;Indexing\u0026#39; =\u0026gt; \u0026#39;文件索引和搜索\u0026#39;, \u0026#39;Misc options\u0026#39; =\u0026gt; \u0026#39;Misc选项\u0026#39;, \u0026#39;Metadata\u0026#39; =\u0026gt; \u0026#39;元数据\u0026#39;, \u0026#39;Software update\u0026#39; =\u0026gt; \u0026#39;软件升级\u0026#39;, \u0026#39;Software licensing\u0026#39; =\u0026gt; \u0026#39;软件许可证\u0026#39;, \u0026#39;Tools\u0026#39; =\u0026gt; \u0026#39;工具\u0026#39;, \u0026#39;Storage usage\u0026#39; =\u0026gt; \u0026#39;磁盘配额\u0026#39;, \u0026#39;Traffic quota usage\u0026#39; =\u0026gt; \u0026#39;流量配额\u0026#39;, \u0026#39;Login as\u0026#39; =\u0026gt; \u0026#39;登录为\u0026#39;, \u0026#39;Archive logs\u0026#39; =\u0026gt; \u0026#39;归档日志\u0026#39;, \u0026#39;Roles\u0026#39; =\u0026gt; \u0026#39;角色\u0026#39;, \u0026#39;Groups\u0026#39; =\u0026gt; \u0026#39;组\u0026#39;, \u0026#39;Thumbnails and preview\u0026#39; =\u0026gt; \u0026#39;文件预览和缩略图\u0026#39;, \u0026#39;File Manager\u0026#39; =\u0026gt; \u0026#39;文件管理器\u0026#39;, \u0026#39;Sign out\u0026#39; =\u0026gt; \u0026#39;登出\u0026#39;, \u0026#39;Displaying records {0} - {1} of {2}\u0026#39; =\u0026gt; \u0026#39;显示记录 {0} - {1} 共 {2}\u0026#39;, \u0026#39;No records to display\u0026#39; =\u0026gt; \u0026#39;没有要显示的记录\u0026#39;, \u0026#39;Page\u0026#39; =\u0026gt; \u0026#39;页\u0026#39;, \u0026#39;of {0}\u0026#39; =\u0026gt; \u0026#39;共 {0}\u0026#39;, \u0026#39;First Page\u0026#39; =\u0026gt; \u0026#39;第一页\u0026#39;, \u0026#39;Last Page\u0026#39; =\u0026gt; \u0026#39;最后一页\u0026#39;, \u0026#39;Next Page\u0026#39; =\u0026gt; \u0026#39;下一页\u0026#39;, \u0026#39;Previous Page\u0026#39; =\u0026gt; \u0026#39;上一页\u0026#39;, \u0026#39;Refresh\u0026#39; =\u0026gt; \u0026#39;刷新\u0026#39;, \u0026#39;Field sets\u0026#39; =\u0026gt; \u0026#39;字段集\u0026#39;, \u0026#39;File types\u0026#39; =\u0026gt; \u0026#39;文件类型\u0026#39;, \u0026#39;Open Web Link\u0026#39; =\u0026gt; \u0026#39;打开Web Links\u0026#39;, \u0026#39;Please confirm web link deletion\u0026#39; =\u0026gt; \u0026#39;请确认删除Web Links\u0026#39;, \u0026#39;Add\u0026#39; =\u0026gt; \u0026#39;新建\u0026#39;, \u0026#39;Edit\u0026#39; =\u0026gt; \u0026#39;修改\u0026#39;, \u0026#39;Search\u0026#39; =\u0026gt; \u0026#39;搜索\u0026#39;, \u0026#39;Quick search\u0026#39; =\u0026gt; \u0026#39;快速搜索\u0026#39;, \u0026#39;Save changes\u0026#39; =\u0026gt; \u0026#39;保存更改\u0026#39;, \u0026#39;Add Groups\u0026#39; =\u0026gt; \u0026#39;添加组\u0026#39;, \u0026#39;Add Users\u0026#39; =\u0026gt; \u0026#39;添加用户\u0026#39;, \u0026#39;Remove Selected\u0026#39; =\u0026gt; \u0026#39;删除所选\u0026#39;, \u0026#39;Select Users\u0026#39; =\u0026gt; \u0026#39;选择用户\u0026#39;, \u0026#39;Delete\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Delete users?\u0026#39; =\u0026gt; \u0026#39;请确认删除选中的用户\u0026#39;, \u0026#39;Permanently delete the users home folders.\u0026#39; =\u0026gt; \u0026#39;永久删除用户主目录\u0026#39;, \u0026#39;Third party services\u0026#39; =\u0026gt; \u0026#39;第三方服务\u0026#39;, \u0026#39;Enable Pusher.com Integration\u0026#39; =\u0026gt; \u0026#39;启用与Pusher.com的集成\u0026#39;, \u0026#39;Number of days to keep the user activity log entries\u0026#39; =\u0026gt; \u0026#39;用户日志保留天数\u0026#39;, \u0026#39;Number of days to keep the file activity log entries\u0026#39; =\u0026gt; \u0026#39;文件日志保留天数\u0026#39;, \u0026#39;Searching\u0026#39; =\u0026gt; \u0026#39;搜索\u0026#39;, \u0026#39;You will find the option under the Permissions tab.\u0026#39; =\u0026gt; \u0026#39;您将在“权限”选项卡下找到该选项。\u0026#39;, \u0026#39;To start, configure the Superuser account with a home folder.\u0026#39; =\u0026gt; \u0026#39;首先，使用主文件夹配置超级用户帐户。\u0026#39;, \u0026#39;Welcome to FileRun!\u0026#39; =\u0026gt; \u0026#39;欢迎使用FileRun！\u0026#39;, \u0026#39;View activity log\u0026#39; =\u0026gt; \u0026#39;查看活动日志\u0026#39;, \u0026#39;View\u0026#39; =\u0026gt; \u0026#39;查看\u0026#39;, \u0026#39;Password policy\u0026#39; =\u0026gt; \u0026#39;密码策略\u0026#39;, \u0026#39;Export users\u0026#39; =\u0026gt; \u0026#39;导出用户\u0026#39;, \u0026#39;Clients\u0026#39; =\u0026gt; \u0026#39;客户端\u0026#39;, \u0026#39;Deleting web links...\u0026#39; =\u0026gt; \u0026#39;正在删除共享链接...\u0026#39;, \u0026#39;Web link successfully deleted.\u0026#39; =\u0026gt; \u0026#39;成功删除共享链接\u0026#39;, \u0026#39;No web link has been deleted!\u0026#39; =\u0026gt; \u0026#39;没有共享链接被删除！\u0026#39;, \u0026#39;%1 web links successfully deleted.\u0026#39; =\u0026gt; \u0026#39;成功删除 %1 个共享链接\u0026#39;, \u0026#39;Users online\u0026#39; =\u0026gt; \u0026#39;在线用户\u0026#39;, \u0026#39;There is only one user online at this moment\u0026#39; =\u0026gt; \u0026#39;当前只有一个在线用户\u0026#39;, \u0026#39;There are %1 users currently online\u0026#39; =\u0026gt; \u0026#39;当前有%1在线用户\u0026#39;, \u0026#39;There are no other users currently online\u0026#39; =\u0026gt; \u0026#39;当前没有在线用户\u0026#39;, \u0026#39;Options\u0026#39; =\u0026gt; \u0026#39;选项\u0026#39;, \u0026#39;Settings\u0026#39; =\u0026gt; \u0026#39;设置\u0026#39;, \u0026#39;Logs\u0026#39; =\u0026gt; \u0026#39;日志\u0026#39;, \u0026#39;\u0026#34;Open with..\u0026#34; options\u0026#39; =\u0026gt; \u0026#39;\u0026#34;打开方式\u0026#34;选项\u0026#39;, \u0026#39;Defaults\u0026#39; =\u0026gt; \u0026#39;默认\u0026#39;, \u0026#39;Files\u0026#39; =\u0026gt; \u0026#39;文件\u0026#39;, \u0026#39;Security\u0026#39; =\u0026gt; \u0026#39;安全\u0026#39;, \u0026#39;More\u0026#39; =\u0026gt; \u0026#39;更多\u0026#39;, \u0026#39;Notifications\u0026#39; =\u0026gt; \u0026#39;通知\u0026#39;, \u0026#39;Add new\u0026#39; =\u0026gt; \u0026#39;新建\u0026#39;, \u0026#39;Calculate all\u0026#39; =\u0026gt; \u0026#39;计算全部\u0026#39;, ), \u0026#39;Admin: Setup\u0026#39; =\u0026gt; array ( \u0026#39;Music\u0026#39; =\u0026gt; \u0026#39;音乐\u0026#39;, \u0026#39;Upload language file\u0026#39; =\u0026gt; \u0026#39;上传语言文件\u0026#39;, \u0026#39;Application title\u0026#39; =\u0026gt; \u0026#39;页面标题\u0026#39;, \u0026#39;Logo URL\u0026#39; =\u0026gt; \u0026#39;登陆URL\u0026#39;, \u0026#39;Welcome message\u0026#39; =\u0026gt; \u0026#39;欢迎消息 \u0026#39;, \u0026#39;Default display mode\u0026#39; =\u0026gt; \u0026#39;默认查看模式\u0026#39;, \u0026#39;Detailed list\u0026#39; =\u0026gt; \u0026#39;列表方式\u0026#39;, \u0026#39;Thumbnails\u0026#39; =\u0026gt; \u0026#39;缩略方式\u0026#39;, \u0026#39;Default\u0026#39; =\u0026gt; \u0026#39;默认\u0026#39;, \u0026#39;Enabled\u0026#39; =\u0026gt; \u0026#39;启用\u0026#39;, \u0026#39;Set a number between 1 and 99, representing the quota usage percentage.\u0026#39; =\u0026gt; \u0026#39;设置一个 1 到 99 之间的数，用来表示配额的百分比\u0026#39;, \u0026#39;Default language\u0026#39; =\u0026gt; \u0026#39;默认语言\u0026#39;, \u0026#39;Display language menu\u0026#39; =\u0026gt; \u0026#39;显示语言菜单\u0026#39;, \u0026#39;Double-click files action\u0026#39; =\u0026gt; \u0026#39;双击文件动作\u0026#39;, \u0026#39;open preview\u0026#39; =\u0026gt; \u0026#39;打开预览\u0026#39;, \u0026#39;open in browser\u0026#39; =\u0026gt; \u0026#39;在浏览器内打开\u0026#39;, \u0026#39;prompt to save\u0026#39; =\u0026gt; \u0026#39;提示保存\u0026#39;, \u0026#39;display contextual menu\u0026#39; =\u0026gt; \u0026#39;显示上下文菜单\u0026#39;, \u0026#39;User Login\u0026#39; =\u0026gt; \u0026#39;用户登录\u0026#39;, \u0026#39;User Registration\u0026#39; =\u0026gt; \u0026#39;用户注册\u0026#39;, \u0026#39;These settings are not available when using a third-part authentication plugin.\u0026#39; =\u0026gt; \u0026#39;当使用第三方验证插件时，这些设置将不起作用\u0026#39;, \u0026#39;Maximum login attempts\u0026#39; =\u0026gt; \u0026#39;最大登录尝试次数\u0026#39;, \u0026#39;The user\\\u0026#39;s account will be automatically deactivated after the last failed attempt.\u0026#39; =\u0026gt; \u0026#39;最后一次登录尝试后，用户账户将自动锁定\u0026#39;, \u0026#39;The recommended value is 4.\u0026#39; =\u0026gt; \u0026#39;推荐值为 4\u0026#39;, \u0026#39;Enable user registration.\u0026#39; =\u0026gt; \u0026#39;允许用户注册\u0026#39;, \u0026#39;E-mail account confirmation links.\u0026#39; =\u0026gt; \u0026#39;E-mail账户确认链接\u0026#39;, \u0026#39;New accounts require admin activation.\u0026#39; =\u0026gt; \u0026#39;新账户需要管理员激活\u0026#39;, \u0026#39;Automatically generate the passwords.\u0026#39; =\u0026gt; \u0026#39;自动生成密码.\u0026#39;, \u0026#39;Required fields\u0026#39; =\u0026gt; \u0026#39;必填项\u0026#39;, \u0026#39;ImageMagick support\u0026#39; =\u0026gt; \u0026#39;启用 ImageMagick 支持\u0026#39;, \u0026#39;Path to \u0026#34;magick\u0026#34; or \u0026#34;convert\u0026#34; binary\u0026#39; =\u0026gt; \u0026#39;ImageMagick \u0026#34;转化\u0026#34; 二进制路径\u0026#39;, \u0026#39;Thumbnail size\u0026#39; =\u0026gt; \u0026#39;缩略图大小\u0026#39;, \u0026#39;Enable FFmpeg support.\u0026#39; =\u0026gt; \u0026#39;启用对FFmpeg的支持\u0026#39;, \u0026#39;Path to FFmpeg binary\u0026#39; =\u0026gt; \u0026#39;FFmpeg的路径\u0026#39;, \u0026#39;Generate FFmpeg thumbnails for the following file types\u0026#39; =\u0026gt; \u0026#39;为下列文件创建FFmpeg缩略图\u0026#39;, \u0026#39;Use a SMTP server.\u0026#39; =\u0026gt; \u0026#39;使用SMTP服务器\u0026#39;, \u0026#39;SMTP server\u0026#39; =\u0026gt; \u0026#39;SMTP服务器\u0026#39;, \u0026#39;SMTP requires authentication.\u0026#39; =\u0026gt; \u0026#39;SMTP需要身份验证.\u0026#39;, \u0026#39;SMTP username\u0026#39; =\u0026gt; \u0026#39;SMTP 用户名\u0026#39;, \u0026#39;SMTP password\u0026#39; =\u0026gt; \u0026#39;SMTP 密码\u0026#39;, \u0026#39;Notifications\u0026#39; =\u0026gt; \u0026#39;E-mail 通知\u0026#39;, \u0026#39;From e-mail address\u0026#39; =\u0026gt; \u0026#39;默认发送者电子邮件地址\u0026#39;, \u0026#39;Instant email notifications\u0026#39; =\u0026gt; \u0026#39;立即E-mail通知\u0026#39;, \u0026#39;Uncheck this option if you will be running the notification script using a scheduled task.\u0026#39; =\u0026gt; \u0026#39;如果您使用计划任务通知脚本请勿选择此项.\u0026#39;, \u0026#39;Allow users to set notification settings to folders.\u0026#39; =\u0026gt; \u0026#39;允许用户为目录设置提示消息\u0026#39;, \u0026#39;Enable content indexing for text documents\u0026#39; =\u0026gt; \u0026#39;启用文件索引\u0026#39;, \u0026#39;File indexing\u0026#39; =\u0026gt; \u0026#39;文件索引\u0026#39;, \u0026#39;Metadata\u0026#39; =\u0026gt; \u0026#39;元数据\u0026#39;, \u0026#39;Allow users to change their passwords.\u0026#39; =\u0026gt; \u0026#39;允许用户修改密码.\u0026#39;, \u0026#39;Allow users to import e-mail attachments.\u0026#39; =\u0026gt; \u0026#39;允许用户导入E-mail附件\u0026#39;, \u0026#39;Number of old versions to keep for each file\u0026#39; =\u0026gt; \u0026#39;为每个文件保留的旧版本数量 \u0026#39;, \u0026#39;Redirect URL after logout\u0026#39; =\u0026gt; \u0026#39;注销后重定向URL\u0026#39;, \u0026#39;Users quota warning level\u0026#39; =\u0026gt; \u0026#39;用户配额报警级别\u0026#39;, \u0026#39;Settings successfully saved.\u0026#39; =\u0026gt; \u0026#39;设置已保存\u0026#39;, \u0026#39;Metadata search mode\u0026#39; =\u0026gt; \u0026#39;元数据搜索模式\u0026#39;, \u0026#39;Broad match\u0026#39; =\u0026gt; \u0026#39;模糊匹配\u0026#39;, \u0026#39;Exact match\u0026#39; =\u0026gt; \u0026#39;精确匹配\u0026#39;, \u0026#39;Check\u0026#39; =\u0026gt; \u0026#39;检查\u0026#39;, \u0026#39;Regular\u0026#39; =\u0026gt; \u0026#39;定期\u0026#39;, \u0026#39;Allow users to reset their passwords.\u0026#39; =\u0026gt; \u0026#39;允许用户重置密码\u0026#39;, \u0026#39;Force users to change their passwords after reset.\u0026#39; =\u0026gt; \u0026#39;强制用户在重置密码后修改新密码。\u0026#39;, \u0026#39;Example list:\u0026#39; =\u0026gt; \u0026#39;示例:\u0026#39;, \u0026#39;Settings saved\u0026#39; =\u0026gt; \u0026#39;设置已保存\u0026#39;, \u0026#39;Title\u0026#39; =\u0026gt; \u0026#39;登陆界面标题\u0026#39;, \u0026#39;Blocked file types\u0026#39; =\u0026gt; \u0026#39;阻止的文件类型 \u0026#39;, \u0026#39;User Logout\u0026#39; =\u0026gt; \u0026#39;用户登出\u0026#39;, \u0026#39;Enable \u0026lt;a href=\u0026#34;http://en.wikipedia.org/wiki/CAPTCHA\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;CAPTCHA\u0026lt;/a\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;启用\u0026lt;a href=\u0026#34;http://en.wikipedia.org/wiki/CAPTCHA\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;CAPTCHA\u0026lt;/a\u0026gt;.\u0026#39;, \u0026#39;Default groups\u0026#39; =\u0026gt; \u0026#39;默认组\u0026#39;, \u0026#39;E-mail address\u0026#39; =\u0026gt; \u0026#39;电子邮件地址\u0026#39;, \u0026#39;Company\u0026#39; =\u0026gt; \u0026#39;公司\u0026#39;, \u0026#39;Web site address\u0026#39; =\u0026gt; \u0026#39;网站地址\u0026#39;, \u0026#39;Comment\u0026#39; =\u0026gt; \u0026#39;评论\u0026#39;, \u0026#39;Disable the file activity logs.\u0026#39; =\u0026gt; \u0026#39;禁用文件活动日志\u0026#39;, \u0026#39;Applies only to first time visitors. Your language preference has already been saved to your browser. You will not see a change if you select a different option here and logout, unless you specifically change it from the login form.\u0026#39; =\u0026gt; \u0026#39;仅适用于首次访问者。您的语言偏好设置已保存到您的浏览器中。如果您在此处选择其他选项并注销，则不会看到更改，除非您从登录表单中专门更改它。\u0026#39;, \u0026#39;Bitly Access Token\u0026#39; =\u0026gt; \u0026#39;令牌\u0026#39;, \u0026#39;Host URL\u0026#39; =\u0026gt; \u0026#39;主机URL\u0026#39;, \u0026#39;Default search criteria\u0026#39; =\u0026gt; \u0026#39;默认搜索模式\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;名称\u0026#39;, \u0026#39;Contents\u0026#39; =\u0026gt; \u0026#39;内容\u0026#39;, \u0026#39;Upload file..\u0026#39; =\u0026gt; \u0026#39;上传文件...\u0026#39;, \u0026#39;Failed to upload language file: %1\u0026#39; =\u0026gt; \u0026#39;语言文件 %1 上传失败\u0026#39;, \u0026#39;%1 translation successfully uploaded\u0026#39; =\u0026gt; \u0026#39;语言文件 %1 上传成功\u0026#39;, \u0026#39;%1 translation successfully updated\u0026#39; =\u0026gt; \u0026#39;语言文件 %1 更新成功\u0026#39;, \u0026#39;Failed to upload file \u0026#34;%1\u0026#34;: %2\u0026#39; =\u0026gt; \u0026#39;上传文件 \u0026#34;%1\u0026#34;: %2 失败\u0026#39;, \u0026#39;Invalid file name!\u0026#39; =\u0026gt; \u0026#39;无效的文件名!\u0026#39;, \u0026#39;The filename should not contain space characters!\u0026#39; =\u0026gt; \u0026#39;文件名不能包含空格字符\u0026#39;, \u0026#39;Please upload only .php FileRun-specific language files!\u0026#39; =\u0026gt; \u0026#39;请仅选择 text 文件！\u0026#39;, \u0026#39;Disables users access and WebLinks.\u0026lt;br\u0026gt;The superuser still has normal access.\u0026#39; =\u0026gt; \u0026#39;禁用用户访问和分享链接。\u0026lt;br\u0026gt;超级用户仍然具有正常的访问权限\u0026#39;, \u0026#39;Maintenance message to users\u0026#39; =\u0026gt; \u0026#39;对用户的维护信息\u0026#39;, \u0026#39;Maintenance message to public\u0026#39; =\u0026gt; \u0026#39;公开的维护信息\u0026#39;, \u0026#39;Allow the users to edit the e-mail address they are sending files from.\u0026#39; =\u0026gt; \u0026#39;允许用户编辑他们发送文件的电子邮件地址\u0026#39;, \u0026#39;Test settings\u0026#39; =\u0026gt; \u0026#39;测试设置\u0026#39;, \u0026#39;Please type a hostname\u0026#39; =\u0026gt; \u0026#39;请输入主机名\u0026#39;, \u0026#39;Please type a port number\u0026#39; =\u0026gt; \u0026#39;请输入端口号\u0026#39;, \u0026#39;Please type a username\u0026#39; =\u0026gt; \u0026#39;请输入用户名\u0026#39;, \u0026#39;The SMTP settings have been successfully tested\u0026#39; =\u0026gt; \u0026#39;SMTP设置测试通过\u0026#39;, \u0026#39;The SMTP authentication failed: %1\u0026#39; =\u0026gt; \u0026#39;SMTP认证失败:%1\u0026#39;, \u0026#39;The SMTP connection test failed: %1\u0026#39; =\u0026gt; \u0026#39;SMTP连接测试失败:%1\u0026#39;, \u0026#39;Password policy\u0026#39; =\u0026gt; \u0026#39;密码策略\u0026#39;, \u0026#39;Minimum password length\u0026#39; =\u0026gt; \u0026#39;最小密码长度\u0026#39;, \u0026#39;Recommended value:\u0026#39; =\u0026gt; \u0026#39;推荐值:\u0026#39;, \u0026#39;Passwords should contain both letters and digits\u0026#39; =\u0026gt; \u0026#39;密码应同时包含数字和字母\u0026#39;, \u0026#39;Passwords should contain at least one uppercase letter\u0026#39; =\u0026gt; \u0026#39;密码至少包含一个大写字母\u0026#39;, \u0026#39;Passwords should contain at least one special character\u0026#39; =\u0026gt; \u0026#39;密码需要包含至少一个特殊字符\u0026#39;, \u0026#39;Special characters:\u0026#39; =\u0026gt; \u0026#39;特殊字符:\u0026#39;, \u0026#39;Passwords should not contain keyboard row sequences\u0026#39; =\u0026gt; \u0026#39;密码不应该包含键盘行序列\u0026#39;, \u0026#39;Example sequences:\u0026#39; =\u0026gt; \u0026#39;示例序列：\u0026#39;, \u0026#39;Prevent user information to be used as part of the password\u0026#39; =\u0026gt; \u0026#39;防止将用户信息用作密码的一部分\u0026#39;, \u0026#39;Number of days users can use the same passwords\u0026#39; =\u0026gt; \u0026#39;用户可以使用相同密码的天数 \u0026#39;, \u0026#39;The users will be asked to change their passwords at this interval.\u0026#39; =\u0026gt; \u0026#39;用户将被要求在此间隔更改密码。 \u0026#39;, \u0026#39;Third-party authentication\u0026#39; =\u0026gt; \u0026#39;第三方认证\u0026#39;, \u0026#39;Enabled plugin\u0026#39; =\u0026gt; \u0026#39;启用插件\u0026#39;, \u0026#39;Use this application\\\u0026#39;s own users database\u0026#39; =\u0026gt; \u0026#39;使用这个应用程序的用户数据库 \u0026#39;, \u0026#39;Hide the logout option\u0026#39; =\u0026gt; \u0026#39;隐藏注销选项 \u0026#39;, \u0026#39;Logout URL\u0026#39; =\u0026gt; \u0026#39;注销网址 \u0026#39;, \u0026#39;Sync passwords to the local database\u0026#39; =\u0026gt; \u0026#39;将密码同步到本地数据库 \u0026#39;, \u0026#39;Allows the users to login even after the third-party authentication system is not active or enabled. The passwords are stored encrypted.\u0026#39; =\u0026gt; \u0026#39;允许用户在第三方认证系统未激活或启用后登录。密码被加密存储。 \u0026#39;, \u0026#39;Automatically create and assign groups\u0026#39; =\u0026gt; \u0026#39;自动创建和分配组 \u0026#39;, \u0026#39;Make sure you have a user account with the superuser\\\u0026#39;s username in the third-party authentication database before disabling this option. If you lock the superuser out, you can disable the plugin by renaming its file.\u0026#39; =\u0026gt; \u0026#39;在禁用此选项之前，请确保在第三方身份验证数据库中拥有超级用户的用户名。如果您锁定超级用户，则可以通过重命名其文件来禁用该插件。 \u0026#39;, \u0026#39;Site key\u0026#39; =\u0026gt; \u0026#39;网站密钥 \u0026#39;, \u0026#39;Secret key\u0026#39; =\u0026gt; \u0026#39;密钥 \u0026#39;, \u0026#39;Enable \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;reCAPTCHA\u0026lt;/a\u0026gt;\u0026#39; =\u0026gt; \u0026#39;启用\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt; reCAPTCHA \u0026lt;/a\u0026gt; \u0026#39;, \u0026#39;OAuth\u0026#39; =\u0026gt; \u0026#39;OAuth 的 \u0026#39;, \u0026#39;API \u0026#34;browser\u0026#34; key\u0026#39; =\u0026gt; \u0026#39;API“浏览器”项 \u0026#39;, \u0026#39;API key\u0026#39; =\u0026gt; \u0026#39;API密钥 \u0026#39;, \u0026#39;Google API credentials can be generated from the \u0026#34;\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Google API Manager\u0026lt;/a\u0026gt;\u0026#34;\u0026#39; =\u0026gt; \u0026#39;Google API凭据可以从“\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt; Google API Manager \u0026lt;/a\u0026gt;”获取\u0026#39;, \u0026#39;BCC\u0026#39; =\u0026gt; \u0026#39;BCC \u0026#39;, \u0026#39;Specify an e-mail address where to send copies of the notifications\u0026#39; =\u0026gt; \u0026#39;指定发送通知副本的电子邮件地址 \u0026#39;, \u0026#39;Message template\u0026#39; =\u0026gt; \u0026#39;消息模板\u0026#39;, \u0026#39;Subject template\u0026#39; =\u0026gt; \u0026#39;标题模板\u0026#39;, \u0026#39;Force users to access via HTTPS.\u0026#39; =\u0026gt; \u0026#39;强制用户通过HTTPS访问\u0026#39;, \u0026#39;Failed to test HTTPS connection! The settings have not been saved.\u0026#39; =\u0026gt; \u0026#39;无法测试HTTPS连接！设置尚未保存\u0026#39;, \u0026#39;TLS/SSL connection\u0026#39; =\u0026gt; \u0026#39;TLS/SSL连接\u0026#39;, \u0026#39;Enable pngquant support.\u0026#39; =\u0026gt; \u0026#39;启用pngquant支持\u0026#39;, \u0026#39;Path of the pngquant binary\u0026#39; =\u0026gt; \u0026#39;pngquant的路径\u0026#39;, \u0026#39;Setting this to 0 disables the versioning system.\u0026#39; =\u0026gt; \u0026#39;将其设置为0将禁用版本控制系统 \u0026#39;, \u0026#39;The recommended value is 10.\u0026#39; =\u0026gt; \u0026#39;建议值是10\u0026#39;, \u0026#39;Show online users\u0026#39; =\u0026gt; \u0026#39;显示在线用户\u0026#39;, \u0026#39;After enabling this option, a section entitled \u0026#34;Users online\u0026#34; will show in the menu next time the control panel is loaded.\u0026#39; =\u0026gt; \u0026#39;启用此选项后，下一次加载控制面板时，会在菜单中显示标题为“用户在线”的部分\u0026#39;, \u0026#39;New users\u0026#39; =\u0026gt; \u0026#39;新用户 \u0026#39;, \u0026#39;Inactivity timeout\u0026#39; =\u0026gt; \u0026#39;超时时间 \u0026#39;, \u0026#39;The user is automatically logged out after this defined number of minutes of inactivity.\u0026#39; =\u0026gt; \u0026#39;在规定的非活动分钟数之后，用户会自动注销\u0026#39;, \u0026#39;The recommended value is 30.\u0026#39; =\u0026gt; \u0026#39;建议值是30\u0026#39;, \u0026#39;Security\u0026#39; =\u0026gt; \u0026#39;安全\u0026#39;, \u0026#39;More\u0026#39; =\u0026gt; \u0026#39;更多\u0026#39;, \u0026#39;Hide options\u0026#39; =\u0026gt; \u0026#39;隐藏选项\u0026#39;, \u0026#39;Default \u0026#34;Open with..\u0026#34; options\u0026#39; =\u0026gt; \u0026#39;默认“打开..”选项\u0026#39;, \u0026#39;Defaults\u0026#39; =\u0026gt; \u0026#39;默认\u0026#39;, \u0026#39;Plugins\u0026#39; =\u0026gt; \u0026#39;插件\u0026#39;, \u0026#39;Requires a scheduled task which periodically runs the command line script \u0026#34;cron/process_search_index_queue.php\u0026#34;. Do not enable without setting the task.\u0026#39; =\u0026gt; \u0026#39;需要定期运行命令行脚本“cron / process_search_index_queue.php”的计划任务。不要在没有设置任务的情况下启用\u0026#39;, \u0026#39;Exclude files by extension\u0026#39; =\u0026gt; \u0026#39;通过扩展排除文件\u0026#39;, \u0026#39;Path to Apache Tika jar file\u0026#39; =\u0026gt; \u0026#39;Apache Tika jar文件的路径\u0026#39;, \u0026#39;Stats\u0026#39; =\u0026gt; \u0026#39;统计\u0026#39;, \u0026#39;Number of indexed files\u0026#39; =\u0026gt; \u0026#39;索引文件的数量 \u0026#39;, \u0026#39;Number of queued operations\u0026#39; =\u0026gt; \u0026#39;排队操作的数量 \u0026#39;, \u0026#39;Port number\u0026#39; =\u0026gt; \u0026#39;端口号\u0026#39;, \u0026#39;Apache Tika server hostname\u0026#39; =\u0026gt; \u0026#39;Apache Tika服务器主机名 \u0026#39;, \u0026#39;Test server\u0026#39; =\u0026gt; \u0026#39;测试服务器\u0026#39;, \u0026#39;The default Apache Tika port is %1\u0026#39; =\u0026gt; \u0026#39;默认的Apache Tika端口是％1 \u0026#39;, \u0026#39;If a hostname is set, then Apache Tika will be used in server mode.\u0026#39; =\u0026gt; \u0026#39;如果设置了主机名，那么Apache Tika将在服务器模式下使用。 \u0026#39;, \u0026#39;Set a number between 70 and 100, representing the quota usage percentage.\u0026#39; =\u0026gt; \u0026#39;设置70到100之间的数字，表示配额使用百分比。 \u0026#39;, \u0026#39;Enable maintenance mode\u0026#39; =\u0026gt; \u0026#39;启用维护模式\u0026#39;, \u0026#39;Use Gravatar.com for users profile images.\u0026#39; =\u0026gt; \u0026#39;使用 Gravatar.com 作为用户的头像\u0026#39;, \u0026#39;Check path\u0026#39; =\u0026gt; \u0026#39;检查路径\u0026#39;, \u0026#39;Allow local user accounts to login\u0026#39; =\u0026gt; \u0026#39;允许本地账户登录\u0026#39;, \u0026#39;Role\u0026#39; =\u0026gt; \u0026#39;用户类型\u0026#39;, \u0026#39;IP address limitation\u0026#39; =\u0026gt; \u0026#39;IP地址限制 \u0026#39;, \u0026#39;Example:\u0026#39; =\u0026gt; \u0026#39;例如:\u0026#39;, \u0026#39;Enable the authentication plugin only for users using certain IP addresses.\u0026#39; =\u0026gt; \u0026#39;仅对使用特定IP地址的用户启用认证插件\u0026#39;, \u0026#39;There are three possible formats that can be used:\u0026#39; =\u0026gt; \u0026#39;有三种可能的格式可以使用： \u0026#39;, \u0026#39;1. Wildcard format: 1.2.3.*\u0026#39; =\u0026gt; \u0026#39;1.通配符格式：1.2.3。* \u0026#39;, \u0026#39;2. CIDR format: 1.2.3/24 OR 1.2.3.4/255.255.255.0\u0026#39; =\u0026gt; \u0026#39;2. CIDR格式：1.2.3 / 24或1.2.3.4/255.255.255.0 \u0026#39;, \u0026#39;3. Start-End IP format: 1.2.3.0-1.2.3.255\u0026#39; =\u0026gt; \u0026#39;3.起始IP地址格式：1.2.3.0-1.2.3.255 \u0026#39;, \u0026#39;It does not work with the \u0026#34;%1\u0026#34; option enabled.\u0026#39; =\u0026gt; \u0026#39;它不适用于启用“%1”选项。\u0026#39;, \u0026#39;Disable plugin\u0026#39; =\u0026gt; \u0026#39;禁用插件\u0026#39;, \u0026#39;Edit plugin: %1\u0026#39; =\u0026gt; \u0026#39;编辑插件：%1\u0026#39;, \u0026#39;Plugin settings\u0026#39; =\u0026gt; \u0026#39;插件设置\u0026#39;, \u0026#39;Read more about this \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;here\u0026lt;/a\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;阅读更多有关\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;此处\u0026lt;/a\u0026gt;的信息\u0026#39;, \u0026#39;Files without extension\u0026#39; =\u0026gt; \u0026#39;没有扩展名的文件 \u0026#39;, \u0026#39;Get it from %1\u0026#39; =\u0026gt; \u0026#39;从%1获取\u0026#39;, \u0026#39;Get them from %1\u0026#39; =\u0026gt; \u0026#39;从%1中获取它们\u0026#39;, \u0026#39;Page background\u0026#39; =\u0026gt; \u0026#39;登录界面背景图片 URL\u0026#39;, \u0026#39;For a background image type in a full URL.\u0026#39; =\u0026gt; \u0026#39;在完整的URL中输入背景图片\u0026#39;, \u0026#39;For a background color type in a hexadecimal value, for example #EC6952\u0026#39; =\u0026gt; \u0026#39;对于十六进制值的背景颜色类型，例如＃EC6952\u0026#39;, \u0026#39;Help URL\u0026#39; =\u0026gt; \u0026#39;帮助页面 URL\u0026#39;, \u0026#39;URL of your help and support page\u0026#39; =\u0026gt; \u0026#39;你的帮助和支持页面的 URL\u0026#39;, \u0026#39;Google Static Maps API\u0026#39; =\u0026gt; \u0026#39;Google Static Maps API \u0026#39;, \u0026#39;Google Maps APIs - Static Maps API\u0026#39; =\u0026gt; \u0026#39;Google Maps API - 静态地图API \u0026#39;, \u0026#39;Tracker codes\u0026#39; =\u0026gt; \u0026#39;跟踪代码 \u0026#39;, \u0026#39;Paste here your traffic analysis tracking HTML code\u0026#39; =\u0026gt; \u0026#39;在这里粘贴您的流量分析跟踪HTML代码\u0026#39;, \u0026#39;Enable download accelerator\u0026#39; =\u0026gt; \u0026#39;启用下载加速器 \u0026#39;, \u0026#39;- None -\u0026#39; =\u0026gt; \u0026#39;- 没有 -\u0026#39;, \u0026#39;NGINX X-Accell\u0026#39; =\u0026gt; \u0026#39;NGINX X-Accell \u0026#39;, \u0026#39;Apache XSendfile\u0026#39; =\u0026gt; \u0026#39;Apache XSendfile \u0026#39;, \u0026#39;LiteSpeed Internal Redirect\u0026#39; =\u0026gt; \u0026#39;LiteSpeed内部重定向 \u0026#39;, \u0026#39;Select the appropriate option for your particular web server.\u0026#39; =\u0026gt; \u0026#39;为特定的Web服务器选择适当的选项\u0026#39;, \u0026#39;Note that only the downloading of really large files will benefit from this option.\u0026#39; =\u0026gt; \u0026#39;请注意，只有下载非常大的文件才能从此选项中受益\u0026#39;, \u0026#39;If in doubt select \u0026#34;- None -\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;如果有疑问，请选择“ - 无 - ”\u0026#39;, \u0026#39;Make sure to check the integrity of the downloaded files after enabling an accelerator.\u0026#39; =\u0026gt; \u0026#39;启用加速器后，请确保检查下载的文件的完整性\u0026#39;, \u0026#39;Setting this to 0 will have the users permanently logged in until they sign out themselves.\u0026#39; =\u0026gt; \u0026#39;将此值设置为 0 会使用户永久处于登录状态直到用户自行注销\u0026#39;, \u0026#39;You are about to enable an authentication plugin. Please confirm that you have used the \u0026#34;Test settings\u0026#34; button to make sure the plugin is properly configured.\u0026#39; =\u0026gt; \u0026#39;您即将启用身份验证插件。请确认您已使用“测试设置”按钮确保插件配置正确。\u0026#39;, \u0026#39;Phone\u0026#39; =\u0026gt; \u0026#39;电话\u0026#39;, \u0026#39;I confirm\u0026#39; =\u0026gt; \u0026#39;我确定\u0026#39;, \u0026#39;Show thumbnails\u0026#39; =\u0026gt; \u0026#39;显示缩略图\u0026#39;, \u0026#39;Guest users\u0026#39; =\u0026gt; \u0026#39;访客用户\u0026#39;, \u0026#39;Thumbnail size for \u0026#34;Photos\u0026#34; display mode\u0026#39; =\u0026gt; \u0026#39;照片缩略图大小\u0026#39;, \u0026#39;Enable file rating\u0026#39; =\u0026gt; \u0026#39;启用文件评级\u0026#39;, \u0026#39;Branding\u0026#39; =\u0026gt; \u0026#39;品牌\u0026#39;, \u0026#39;Branding options\u0026#39; =\u0026gt; \u0026#39;品牌选项\u0026#39;, \u0026#39;Login page\u0026#39; =\u0026gt; \u0026#39;登录页面\u0026#39;, \u0026#39;Color theme\u0026#39; =\u0026gt; \u0026#39;颜色主题\u0026#39;, \u0026#39;Blue\u0026#39; =\u0026gt; \u0026#39;蓝色\u0026#39;, \u0026#39;Green\u0026#39; =\u0026gt; \u0026#39;绿色\u0026#39;, \u0026#39;Red\u0026#39; =\u0026gt; \u0026#39;红\u0026#39;, \u0026#39;Custom\u0026#39; =\u0026gt; \u0026#39;习惯\u0026#39;, \u0026#39;The default value is \u0026#34;Broad match\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;默认值为\u0026#34;模糊匹配\u0026#34;。\u0026#39;, \u0026#39;If searching becomes slow, it is recommeneded to use the \u0026#34;Exact match\u0026#34; instead.\u0026#39; =\u0026gt; \u0026#39;如果搜索变慢，建议使用\u0026#34;精确匹配\u0026#34;。\u0026#39;, \u0026#39;When \u0026#34;Broad match\u0026#34; is enabled, use \u0026lt;em\u0026gt;\u0026#34;keyword\u0026#34;\u0026lt;/em\u0026gt; for exact match.\u0026#39; =\u0026gt; \u0026#39;启用\u0026#34;模糊匹配\u0026#34;后，请使用\u0026lt;em\u0026gt;\u0026#34;keyword\u0026#34;\u0026lt;/em\u0026gt;进行精确匹配。\u0026#39;, \u0026#39;When \u0026#34;Exact match\u0026#34; is enabled, use \u0026lt;em\u0026gt;*keyword*\u0026lt;/em\u0026gt; for broad match.\u0026#39; =\u0026gt; \u0026#39;启用\u0026#34;精确匹配\u0026#34;后，请使用\u0026lt;em\u0026gt;* keyword *\u0026lt;/em\u0026gt;进行模糊匹配。\u0026#39;, \u0026#39;Search results limit\u0026#39; =\u0026gt; \u0026#39;搜索结果限制\u0026#39;, \u0026#39;The default value is 200. Larger numbers can cause the users browsers to freeze.\u0026#39; =\u0026gt; \u0026#39;默认值为200.较大的数字可能导致用户浏览器卡顿。\u0026#39;, \u0026#39;Enabling this will allow access to the users that do not have an account with the third-party system.\u0026#39; =\u0026gt; \u0026#39;启用此选项将允许没有帐户的第三方系统用户访问。\u0026#39;, \u0026#39;List users\u0026#39; =\u0026gt; \u0026#39;用户列表\u0026#39;, ), \u0026#39;Admin: Users\u0026#39; =\u0026gt; array ( \u0026#39;Date Format: Registration date\u0026#39; =\u0026gt; \u0026#39;d M Y\u0026#39;, \u0026#39;Date Format: Last login\u0026#39; =\u0026gt; \u0026#39;Y-M-d, H:i\u0026#39;, \u0026#39;Date Format: Expiration date\u0026#39; =\u0026gt; \u0026#39;Y-M-d\u0026#39;, \u0026#39;Generate random password\u0026#39; =\u0026gt; \u0026#39;生成随机密码\u0026#39;, \u0026#39;Important: Changing this path will remove the users folder sharing settings and weblinks.\u0026#39; =\u0026gt; \u0026#39;重要：更改本路径将会删除用户文件夹的共享和WebLinks。\u0026#39;, \u0026#39;Users\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Parent user\u0026#39; =\u0026gt; \u0026#39;父用户\u0026#39;, \u0026#39;You are not allowed to manage users.\u0026#39; =\u0026gt; \u0026#39;你无权管理用户.\u0026#39;, \u0026#39;You are not allowed to manage user accounts.\u0026#39; =\u0026gt; \u0026#39;你无权管理用户账户.\u0026#39;, \u0026#39;User successfully created.\u0026#39; =\u0026gt; \u0026#39;用户创建成功.\u0026#39;, \u0026#39;You cannot delete your own account!\u0026#39; =\u0026gt; \u0026#39;你不能删除自己的账户!\u0026#39;, \u0026#39;You cannot create user accounts any more, the limit was reached!\u0026#39; =\u0026gt; \u0026#39;你不能继续创建账户，账户数已达上限!\u0026#39;, \u0026#39;You are not allowed to manage this user.\u0026#39; =\u0026gt; \u0026#39;你无权管理此用户.\u0026#39;, \u0026#39;User successfully updated!\u0026#39; =\u0026gt; \u0026#39;用户更新成功!\u0026#39;, \u0026#39;Sorry, the \u0026#34;superuser\u0026#34; account cannot be deactivated!\u0026#39; =\u0026gt; \u0026#39;无法锁定超级用户账户!\u0026#39;, \u0026#39;You cannot deactivate your own user account!\u0026#39; =\u0026gt; \u0026#39;你不能锁定自己的账户!\u0026#39;, \u0026#39;Action unavailable in this demo version of the software!\u0026#39; =\u0026gt; \u0026#39;演示版本中此功能无效!\u0026#39;, \u0026#39;Please type a username!\u0026#39; =\u0026gt; \u0026#39;请输入用户名!\u0026#39;, \u0026#39;Please type a name!\u0026#39; =\u0026gt; \u0026#39;请输入名称!\u0026#39;, \u0026#39;Please don\\\u0026#39;t use special characters for the username!\u0026#39; =\u0026gt; \u0026#39;用户名中请勿使用特殊字符!\u0026#39;, \u0026#39;Username already in use. Please choose another one.\u0026#39; =\u0026gt; \u0026#39;用户名已存在，请选择其他用户名.\u0026#39;, \u0026#39;Please type a password!\u0026#39; =\u0026gt; \u0026#39;请输入密码!\u0026#39;, \u0026#39;Please retype the password correctly!\u0026#39; =\u0026gt; \u0026#39;请正确的重新输入密码!\u0026#39;, \u0026#39;An independent admin user should be able to create at least one user account!\u0026#39; =\u0026gt; \u0026#39;唯一的管理账户应该至少创建一个用户账户!\u0026#39;, \u0026#39;You are required to set a space quota for this user!\u0026#39; =\u0026gt; \u0026#39;请为此用户设置空间配额!\u0026#39;, \u0026#39;The maximum space quota you can assign to this user is %1MB!\u0026#39; =\u0026gt; \u0026#39;您能为此用户分配的最大空间配额是 %1MB!\u0026#39;, \u0026#39;Copy to clipboard\u0026#39; =\u0026gt; \u0026#39;复制到剪贴板\u0026#39;, \u0026#39;Guest access URL\u0026#39; =\u0026gt; \u0026#39;访客访问URL\u0026#39;, \u0026#39;Failed to update user!\u0026#39; =\u0026gt; \u0026#39;更新用户失败!\u0026#39;, \u0026#39;Edit user.\u0026#39; =\u0026gt; \u0026#39;编辑用户.\u0026#39;, \u0026#39;Sorry, the superuser account cannot be deleted!\u0026#39; =\u0026gt; \u0026#39;无法删除超级用户账户!\u0026#39;, \u0026#39;Failed to delete user \u0026#34;%1\u0026#34;!\u0026#39; =\u0026gt; \u0026#39;无法删除用户\u0026#34;%1\u0026#34;!\u0026#39;, \u0026#39;Delete user\u0026#39; =\u0026gt; \u0026#39;删除用户\u0026#39;, \u0026#39;You cannot create user accounts when custom authentication is used!\u0026#39; =\u0026gt; \u0026#39;使用自定义身份验证时，无法创建用户账户!\u0026#39;, \u0026#39;Can interact with\u0026#39; =\u0026gt; \u0026#39;可以看到\u0026#39;, \u0026#39;[All users]\u0026#39; =\u0026gt; \u0026#39;[所有用户]\u0026#39;, \u0026#39;Hold \u0026#34;Ctrl\u0026#34; key to select multiple options.\u0026#39; =\u0026gt; \u0026#39;按住\u0026#34;CTRL\u0026#34;键选择多个选项。\u0026#39;, \u0026#39;Failed to create user!\u0026#39; =\u0026gt; \u0026#39;创建用户失败!\u0026#39;, \u0026#39;Create user\u0026#39; =\u0026gt; \u0026#39;创建用户\u0026#39;, \u0026#39;Username\u0026#39; =\u0026gt; \u0026#39;用户名\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;密码\u0026#39;, \u0026#39;Retype password\u0026#39; =\u0026gt; \u0026#39;确认密码\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;名称\u0026#39;, \u0026#39;Company\u0026#39; =\u0026gt; \u0026#39;公司\u0026#39;, \u0026#39;Website\u0026#39; =\u0026gt; \u0026#39;网站地址\u0026#39;, \u0026#39;E-mail address\u0026#39; =\u0026gt; \u0026#39;E-mail地址\u0026#39;, \u0026#39;Notifications\u0026#39; =\u0026gt; \u0026#39;通知\u0026#39;, \u0026#39;Role\u0026#39; =\u0026gt; \u0026#39;角色\u0026#39;, \u0026#39;- None -\u0026#39; =\u0026gt; \u0026#39;- 无 -\u0026#39;, \u0026#39;The role defines the user\\\u0026#39;s permission settings. The individual permission settings of the user cannot be changed if a role is selected.\u0026#39; =\u0026gt; \u0026#39;角色可以定义用户的权限设置. 用户被指定角色时，该用户独立的权限设定将无法修改.\u0026#39;, \u0026#39;Home folder\u0026#39; =\u0026gt; \u0026#39;主目录\u0026#39;, \u0026#39;Your personal home folder is:\u0026#39; =\u0026gt; \u0026#39;您的个人主目录为:\u0026#39;, \u0026#39;Check path\u0026#39; =\u0026gt; \u0026#39;检查路径\u0026#39;, \u0026#39;Create folder now\u0026#39; =\u0026gt; \u0026#39;创建目录\u0026#39;, \u0026#39;The path is valid.\u0026#39; =\u0026gt; \u0026#39;路径正确.\u0026#39;, \u0026#39;Please specify a path!\u0026#39; =\u0026gt; \u0026#39;请指定一个路径!\u0026#39;, \u0026#39;Invalid folder!\u0026#39; =\u0026gt; \u0026#39;路径非法!\u0026#39;, \u0026#39;The folder \u0026#34;%1\u0026#34; does not exists or it is not accessible by PHP.\u0026#39; =\u0026gt; \u0026#39;目录 \u0026#34;%1\u0026#34; 不存在，或者PHP无法访问.\u0026#39;, \u0026#39;Failed to create folder.\u0026#39; =\u0026gt; \u0026#39;创建目录失败.\u0026#39;, \u0026#39;Folder successfuly created.\u0026#39; =\u0026gt; \u0026#39;创建目录成功.\u0026#39;, \u0026#39;Permissions\u0026#39; =\u0026gt; \u0026#39;权限\u0026#39;, \u0026#39;User can upload files\u0026#39; =\u0026gt; \u0026#39;用户可以上传文件\u0026#39;, \u0026#39;User can download files\u0026#39; =\u0026gt; \u0026#39;用户可以下载文件\u0026#39;, \u0026#39;User can share via web links\u0026#39; =\u0026gt; \u0026#39;用户可以发布文件为Web链接\u0026#39;, \u0026#39;User can share via e-mail\u0026#39; =\u0026gt; \u0026#39;用户可以将文件以附件形式发送Email\u0026#39;, \u0026#39;User can share with other users\u0026#39; =\u0026gt; \u0026#39;用户可以共享目录\u0026#39;, \u0026#39;User can access tags, ratings and other metadata\u0026#39; =\u0026gt; \u0026#39;用户可以访问元数据\u0026#39;, \u0026#39;User can change the password\u0026#39; =\u0026gt; \u0026#39;用户可以修改账户密码\u0026#39;, \u0026#39;User can download folders and collections\u0026#39; =\u0026gt; \u0026#39;用户可以压缩并下载文件\u0026#39;, \u0026#39;User can read comments and view labels\u0026#39; =\u0026gt; \u0026#39;用户可以读取文件评论\u0026#39;, \u0026#39;User can write comments and set labels\u0026#39; =\u0026gt; \u0026#39;用户可以修改文件评论\u0026#39;, \u0026#39;Space quota\u0026#39; =\u0026gt; \u0026#39;空间配额\u0026#39;, \u0026#39;User can share with guest users\u0026#39; =\u0026gt; \u0026#39;用户可以与访客用户共享\u0026#39;, \u0026#39;Phone\u0026#39; =\u0026gt; \u0026#39;电话\u0026#39;, \u0026#39;User group(s)\u0026#39; =\u0026gt; \u0026#39;用户组\u0026#39;, \u0026#39;Home folder\u0026lt;br\u0026gt;template path\u0026#39; =\u0026gt; \u0026#39;主目录\u0026lt;br\u0026gt;临时路径\u0026#39;, \u0026#39;This folder will be automatically created in your home folder, if it doesn\\\u0026#39;t exists already.\u0026#39; =\u0026gt; \u0026#39;如果该目录不存在，将自动在您的主目录生成\u0026#39;, \u0026#39;Admin\u0026#39; =\u0026gt; \u0026#39;管理员\u0026#39;, \u0026#39;Yes\u0026#39; =\u0026gt; \u0026#39;是\u0026#39;, \u0026#39;Yes, Independent\u0026#39; =\u0026gt; \u0026#39;是, 唯一的\u0026#39;, \u0026#39;- Can only see and manage users, groups, etc. created by himself.\u0026#39; =\u0026gt; \u0026#39;- 仅能查看并且管理他自己创建的用户和群组等.\u0026#39;, \u0026#39;- He can assign space quotas within a total of his own space quota.\u0026#39; =\u0026gt; \u0026#39;- 可以分配整个空间配额.\u0026#39;, \u0026#39;User can create new user accounts.\u0026#39; =\u0026gt; \u0026#39;可以创建新用户账户.\u0026#39;, \u0026#39;User can manage groups.\u0026#39; =\u0026gt; \u0026#39;可以管理群组.\u0026#39;, \u0026#39;User can manage roles.\u0026#39; =\u0026gt; \u0026#39;可以管理角色.\u0026#39;, \u0026#39;User can manage notifications.\u0026#39; =\u0026gt; \u0026#39;可以管理通知.\u0026#39;, \u0026#39;User can access the activity logs.\u0026#39; =\u0026gt; \u0026#39;可以访问活动日志.\u0026#39;, \u0026#39;User can change the metadata settings.\u0026#39; =\u0026gt; \u0026#39;可以修改元数据设置.\u0026#39;, \u0026#39;Can manage\u0026#39; =\u0026gt; \u0026#39;可以管理\u0026#39;, \u0026#39;[All groups]\u0026#39; =\u0026gt; \u0026#39;- 所有群组 -\u0026#39;, \u0026#39;Max users\u0026#39; =\u0026gt; \u0026#39;最大用户数\u0026#39;, \u0026#39;This is the maximum number of user accounts this independent admin user can create.\u0026#39; =\u0026gt; \u0026#39;这是此独立管理员可以创建的最大用户数.\u0026#39;, \u0026#39;Example: /home/users/{USERNAME}\u0026#39; =\u0026gt; \u0026#39;示例: /home/users/{USERNAME}\u0026#39;, \u0026#39;{USERNAME} will be automatically replaced with each user\\\u0026#39;s login name.\u0026#39; =\u0026gt; \u0026#39;{USERNAME} 会自动被用户的登录名取代.\u0026#39;, \u0026#39;{NAME} will be automatically replaced with this user\\\u0026#39;s name.\u0026#39; =\u0026gt; \u0026#39;{NAME} 会自动被用户的姓名取代.\u0026#39;, \u0026#39;{EMAIL} will be automatically replaced with this user\\\u0026#39;s e-mail.\u0026#39; =\u0026gt; \u0026#39;{EMAIL} 会自动被用户的电子邮件取代.\u0026#39;, \u0026#39;{COMPANY} will be automatically replaced with this user\\\u0026#39;s company name.\u0026#39; =\u0026gt; \u0026#39;{COMPANY} 会自动被用户的公司名取代.\u0026#39;, \u0026#39;The permission to manage roles cannot be granted if a \u0026#34;Home folder template path\u0026#34; is set.\u0026#39; =\u0026gt; \u0026#39;如果用户主目录被设置，管理角色的权限无法分配。\u0026#39;, \u0026#39;If you wish to grant the permission to manage roles, please use the \u0026#34;Can manage\u0026#34; option to select at least one group of users.\u0026#39; =\u0026gt; \u0026#39;如果您希望授权管理角色权限，请使用看“可以管理”选项来选择至少一个组。\u0026#39;, \u0026#39;If you wish to grant the permission to create new user accounts, please use the \u0026#34;Can manage\u0026#34; option to select at least one group.\u0026#39; =\u0026gt; \u0026#39;如果你希望授权创建用户权限，请使用“剋有管理”选项来选择至少一个组。\u0026#39;, \u0026#39;Leave the field empty to allow the admin to set the paths manually.\u0026#39; =\u0026gt; \u0026#39;保持该项为空以便允许管理员手动设置路径.\u0026#39;, \u0026#39;You need to allow the user to manage at least one group to be able to create new user accounts.\u0026#39; =\u0026gt; \u0026#39;你应该允许该用户管理至少一个群组，以便可以创建新的账户.\u0026#39;, \u0026#39;You need to allow the user to manage at least one group to be able to manage roles.\u0026#39; =\u0026gt; \u0026#39;你应该允许该用户管理至少一个群组，以便可以管理角色.\u0026#39;, \u0026#39;Note\u0026#39; =\u0026gt; \u0026#39;提示\u0026#39;, \u0026#39;Send a notification now\u0026#39; =\u0026gt; \u0026#39;现在发送提醒。\u0026#39;, \u0026#39;An e-mail message with the login information will be sent to the user\\\u0026#39;s address.\u0026#39; =\u0026gt; \u0026#39;一封包含登陆信息的邮件已经被发送给用户。\u0026#39;, \u0026#39;Submit\u0026#39; =\u0026gt; \u0026#39;提交\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;This is the \u0026#34;superuser\u0026#34; account, and it cannot be deleted.\u0026#39; =\u0026gt; \u0026#39;这是超级用户账户，不能删除.\u0026#39;, \u0026#39;Please confirm the deletion of the user\u0026#39; =\u0026gt; \u0026#39;确认删除用户\u0026#39;, \u0026#39;Delete\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;You can add %1 more users.\u0026#39; =\u0026gt; \u0026#39;不能添加 %1 用户.\u0026#39;, \u0026#39;You have reached the maximum number of user account allowed.\u0026#39; =\u0026gt; \u0026#39;已达到最大用户数限制.\u0026#39;, \u0026#39;Showing only users created by\u0026#39; =\u0026gt; \u0026#39;仅显示被谁创建的用户\u0026#39;, \u0026#39;Click \u0026lt;a href=\u0026#34;%1/?module=users\u0026amp;section=admin\u0026amp;page=index\u0026amp;filter_indep=1\u0026#34; style=\u0026#34;text-decoration:underline\u0026#34;\u0026gt;here\u0026lt;/a\u0026gt; to show all \u0026#34;independent admin users\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;点击 \u0026lt;a href=\u0026#34;%1/?module=users\u0026amp;section=admin\u0026amp;page=index\u0026amp;filter_indep=1\u0026#34; style=\u0026#34;text-decoration:underline\u0026#34;\u0026gt;这里\u0026lt;/a\u0026gt; 显示所有独立管理员用户\u0026#39;, \u0026#39;Show only \u0026#34;independent admin users\u0026#34;\u0026#39; =\u0026gt; \u0026#39;仅显示独立管理员用户\u0026#39;, \u0026#39;Show only deactivated users\u0026#39; =\u0026gt; \u0026#39;仅显示未激活的用户。\u0026#39;, \u0026#39;Filter users by group:\u0026#39; =\u0026gt; \u0026#39;以组别过滤用户\u0026#39;, \u0026#39;- All -\u0026#39; =\u0026gt; \u0026#39;- 所有 -\u0026#39;, \u0026#39;Users created:\u0026#39; =\u0026gt; \u0026#39;用户创建:\u0026#39;, \u0026#39;Calculating space quota for users created by \u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;:\u0026#39; =\u0026gt; \u0026#39;计算被谁创建的所有用户的空间总配额 \u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;:\u0026#39;, \u0026#39;There is no user account created by this user.\u0026#39; =\u0026gt; \u0026#39;该用户没有创建其他用户账户。\u0026#39;, \u0026#39;Loading...\u0026#39; =\u0026gt; \u0026#39;加载中...\u0026#39;, \u0026#39;Free space available:\u0026#39; =\u0026gt; \u0026#39;剩余有效空间:\u0026#39;, \u0026#39;Edit User\u0026#39; =\u0026gt; \u0026#39;编辑用户\u0026#39;, \u0026#39;Search users by name:\u0026#39; =\u0026gt; \u0026#39;以名称搜索用户:\u0026#39;, \u0026#39;Search by company name:\u0026#39; =\u0026gt; \u0026#39;以公司名搜索用户:\u0026#39;, \u0026#39;Toggle filtering options\u0026#39; =\u0026gt; \u0026#39;过滤选项\u0026#39;, \u0026#39;Page:\u0026#39; =\u0026gt; \u0026#39;页码:\u0026#39;, \u0026#39;Search\u0026#39; =\u0026gt; \u0026#39;搜索\u0026#39;, \u0026#39;This is the \u0026#34;superuser\u0026#34; account, and it cannot be deactivated.\u0026#39; =\u0026gt; \u0026#39;这是超级用户账户，不能锁定.\u0026#39;, \u0026#39;Browse users\u0026#39; =\u0026gt; \u0026#39;浏览用户\u0026#39;, \u0026#39;Browse users created by this \u0026#34;independent admin user\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;查看这个独立管理员账户所创建的用户.\u0026#39;, \u0026#39;Space quota info\u0026#39; =\u0026gt; \u0026#39;空间配额信息\u0026#39;, \u0026#39;View space quota information with breakdown by users.\u0026#39; =\u0026gt; \u0026#39;查看空间配额详细信息.\u0026#39;, \u0026#39;Delete user.\u0026#39; =\u0026gt; \u0026#39;删除用户.\u0026#39;, \u0026#39;No\u0026#39; =\u0026gt; \u0026#39;否\u0026#39;, \u0026#39;Total\u0026#39; =\u0026gt; \u0026#39;总共\u0026#39;, \u0026#39;The users created by this administrator will have their home folders set depending on this template.\u0026#39; =\u0026gt; \u0026#39;由管理员创建的用户将会拥有基于本模板设定的主目录。\u0026#39;, \u0026#39;{ADMUSERNAME} will be automatically replaced with this user\\\u0026#39;s login name.\u0026#39; =\u0026gt; \u0026#39;{ADMUSERNAME} 将会自动被替换为用户的登录名。\u0026#39;, \u0026#39;Last login\u0026#39; =\u0026gt; \u0026#39;上一次登陆\u0026#39;, \u0026#39;User \u0026#34;%1\u0026#34; successfully deleted!\u0026#39; =\u0026gt; \u0026#39;用户\u0026#34;%1\u0026#34;已被成功删除！\u0026#39;, \u0026#39;Require user to change the password\u0026#39; =\u0026gt; \u0026#39;需要用户修改密码\u0026#39;, \u0026#39;Registration date\u0026#39; =\u0026gt; \u0026#39;注册日期\u0026#39;, \u0026#39;The user\\\u0026#39;s home folder cannot be deleted as other users have home folders located inside!\u0026#39; =\u0026gt; \u0026#39;无法删除该用户的主文件夹，因为其中包含其他用户的主文件夹！\u0026#39;, \u0026#39;Add User\u0026#39; =\u0026gt; \u0026#39;新建用户\u0026#39;, \u0026#39;Basic Information\u0026#39; =\u0026gt; \u0026#39;基本信息\u0026#39;, \u0026#39;Login Info\u0026#39; =\u0026gt; \u0026#39;登陆信息\u0026#39;, \u0026#39;E-mail Options\u0026#39; =\u0026gt; \u0026#39;电子邮件选项\u0026#39;, \u0026#39;Details\u0026#39; =\u0026gt; \u0026#39;明细\u0026#39;, \u0026#39;Expiration date\u0026#39; =\u0026gt; \u0026#39;过期时间\u0026#39;, \u0026#39;The user account will be automatically deactivated at the specified date.\u0026#39; =\u0026gt; \u0026#39;用户账户将会在过期日自动冻结。\u0026#39;, \u0026#39;Please replace the back slashes (\\\\) with forward slashes (/)!\u0026#39; =\u0026gt; \u0026#39;请使用正斜杠 (/) 替换这个反斜杠 (\\\\)!\u0026#39;, \u0026#39;The path should start with a drive letter! Example: C:/files/\u0026#39; =\u0026gt; \u0026#39;路径应该开始于盘符，例如C:/Files/\u0026#39;, \u0026#39;The path should start with a forward slash! Example: /files/\u0026#39; =\u0026gt; \u0026#39;路径应该开始于反斜杠，例如/Files/\u0026#39;, \u0026#39;User can access the files\\\u0026#39; activity logs\u0026#39; =\u0026gt; \u0026#39;用户可以访问文件活动日志\u0026#39;, \u0026#39;Quotas\u0026#39; =\u0026gt; \u0026#39;容量\u0026#39;, \u0026#39;The values are in megabytes. The value of 0 disables the limitation.\u0026#39; =\u0026gt; \u0026#39;值的单位是兆字节。值为0时取消限制。\u0026#39;, \u0026#39;Permanently delete the user\\\u0026#39;s home folder.\u0026#39; =\u0026gt; \u0026#39;用户删除用户的主目录。\u0026#39;, \u0026#39;Delete User Account\u0026#39; =\u0026gt; \u0026#39;删除用户账户\u0026#39;, \u0026#39;The account is deactivated\u0026#39; =\u0026gt; \u0026#39;该账户已被冻结\u0026#39;, \u0026#39;Important: Changing this path will update the home folder paths of all user accounts using this role. It will results in the automatic removal of the users\\\u0026#39; folder sharing settings and weblinks.\u0026#39; =\u0026gt; \u0026#39;重要：更改本路径将会更新所有该用户组的主目录路径。将会自动删除这些用户的共享和WebLinks。\u0026#39;, \u0026#39;User can sync folders with BitTorrent Sync\u0026#39; =\u0026gt; \u0026#39;用户可以使用BitTorrent同步本目录的文件。\u0026#39;, \u0026#39;Important: Changing this path will update the home folder paths of all user accounts created by this admin. It will results in the automatic removal of these users\\\u0026#39; folder sharing settings and weblinks.\u0026#39; =\u0026gt; \u0026#39;重要：更改本路径将会更新由管理员创建的用户主目录路径。这将导致自动删除这些用户的共享和WebLinks。\u0026#39;, \u0026#39;Important: Changing this path will update the home folder paths of all user accounts created by admins using this role. It will results in the automatic removal of the users\\\u0026#39; folder sharing settings and weblinks.\u0026#39; =\u0026gt; \u0026#39;重要：更改本路径将会更新所有由该管理员创建的用户的主目录路径。将会自动删除这些用户的共享和WebLinks。\u0026#39;, \u0026#39;Enable 2-step verification\u0026#39; =\u0026gt; \u0026#39;启用二次认证\u0026#39;, \u0026#39;In order for the user to login, he will need to type in also a temporary code which can be generated on a mobile device with a dedicated app such as Google Authenticator.\u0026#39; =\u0026gt; \u0026#39;为使该用户可以登入，他将需要输入一个通过移动设备上如 Google Authenticator 这样的专用APP所生成的临时的代码 \u0026#39;, \u0026#39;Expires\u0026#39; =\u0026gt; \u0026#39;有效期\u0026#39;, \u0026#39;User can change personal information\u0026#39; =\u0026gt; \u0026#39;用户可以修改账户信息\u0026#39;, \u0026#39;Upload max file size\u0026#39; =\u0026gt; \u0026#39;文件最大大小\u0026#39;, \u0026#39;Admin permissions\u0026#39; =\u0026gt; \u0026#39;管理员权限\u0026#39;, \u0026#39;First name\u0026#39; =\u0026gt; \u0026#39;姓\u0026#39;, \u0026#39;Last name\u0026#39; =\u0026gt; \u0026#39;名\u0026#39;, \u0026#39;Disabled\u0026#39; =\u0026gt; \u0026#39;被冻结\u0026#39;, \u0026#39;Please confirm the user deactivation\u0026#39; =\u0026gt; \u0026#39;请确认是否冻结该用户\u0026#39;, \u0026#39;User \u0026#34;%1\u0026#34; successfully deactivated!\u0026#39; =\u0026gt; \u0026#39;用户 \u0026#34;%1\u0026#34;被成功冻结\u0026#39;, \u0026#39;Failed to deactivated user \u0026#34;%1\u0026#34;!\u0026#39; =\u0026gt; \u0026#39;无法冻结用户 \u0026#34;%1\u0026#34;\u0026#39;, \u0026#39;Folder already exists.\u0026#39; =\u0026gt; \u0026#39;文件夹已存在.\u0026#39;, \u0026#39;The URL has been copied to clipboard.\u0026#39; =\u0026gt; \u0026#39;该URL已复制到剪贴板。\u0026#39;, \u0026#39;User can make changes to files and folders\u0026#39; =\u0026gt; \u0026#39;用户可以更改文件和文件夹\u0026#39;, \u0026#39;User can upload files and folders\u0026#39; =\u0026gt; \u0026#39;\t用户可以上传文件和文件夹\u0026#39;, \u0026#39;Path\u0026#39; =\u0026gt; \u0026#39;路径\u0026#39;, \u0026#39;Access\u0026#39; =\u0026gt; \u0026#39;访问\u0026#39;, \u0026#39;Share\u0026#39; =\u0026gt; \u0026#39;分享\u0026#39;, \u0026#39;Change\u0026#39; =\u0026gt; \u0026#39;更改\u0026#39;, \u0026#39;Allowed file types\u0026#39; =\u0026gt; \u0026#39;允许的文件类型\u0026#39;, \u0026#39;Specify a list of file types the user will be limited to when upload files.\u0026#39; =\u0026gt; \u0026#39;指定上载文件时用户将限制的文件类型列表。\u0026#39;, \u0026#39;An empty field will allow the user to upload any type of file.\u0026#39; =\u0026gt; \u0026#39;空字段将允许用户上载任何类型的文件。\u0026#39;, \u0026#39;Example list:\u0026#39; =\u0026gt; \u0026#39;示例列表：\u0026#39;, \u0026#39;Type the path to a folder on your server. This is the user\\\u0026#39;s personal working space.\u0026#39; =\u0026gt; \u0026#39;输入服务器上文件夹的路径。这是用户的个人工作空间。\u0026#39;, \u0026#39;As an example path, this app is located at %1\u0026#39; =\u0026gt; \u0026#39;作为示例路径，此应用程序位于%1\u0026#39;, ), \u0026#39;Admin: Groups\u0026#39; =\u0026gt; array ( \u0026#39;You are not allowed to delete groups.\u0026#39; =\u0026gt; \u0026#39;您无权删除群组.\u0026#39;, \u0026#39;You are not allowed to manage user groups.\u0026#39; =\u0026gt; \u0026#39;您无权管理用户组.\u0026#39;, \u0026#39;You are not allowed to manage this group.\u0026#39; =\u0026gt; \u0026#39;您无权管理此群组.\u0026#39;, \u0026#39;(%1 users)\u0026#39; =\u0026gt; \u0026#39;(%1 用户)\u0026#39;, \u0026#39;Group successfully created!\u0026#39; =\u0026gt; \u0026#39;群组创建成功!\u0026#39;, \u0026#39;Add a new user groups.\u0026#39; =\u0026gt; \u0026#39;添加新用户组.\u0026#39;, \u0026#39;Please type a name for the group!\u0026#39; =\u0026gt; \u0026#39;请输入群组名!\u0026#39;, \u0026#39;Please don\\\u0026#39;t use special characters for the group\\\u0026#39;s name!\u0026#39; =\u0026gt; \u0026#39;请不要在组名称中使用特殊字符！\u0026#39;, \u0026#39;Group name already used. Please choose another one.\u0026#39; =\u0026gt; \u0026#39;群组名已存在，请使用其他名称.\u0026#39;, \u0026#39;Failed to create group!\u0026#39; =\u0026gt; \u0026#39;创建群组失败!\u0026#39;, \u0026#39;Groups\u0026#39; =\u0026gt; \u0026#39;群组\u0026#39;, \u0026#39;Create group\u0026#39; =\u0026gt; \u0026#39;创建群组\u0026#39;, \u0026#39;Group name\u0026#39; =\u0026gt; \u0026#39;群组名\u0026#39;, \u0026#39;Description\u0026#39; =\u0026gt; \u0026#39;群组描述\u0026#39;, \u0026#39;Failed to edit group!\u0026#39; =\u0026gt; \u0026#39;编辑群组失败!\u0026#39;, \u0026#39;Edit group\u0026#39; =\u0026gt; \u0026#39;编辑群组\u0026#39;, \u0026#39;Delete group\u0026#39; =\u0026gt; \u0026#39;删除群组\u0026#39;, \u0026#39;Failed to delete group!\u0026#39; =\u0026gt; \u0026#39;删除群组失败!\u0026#39;, \u0026#39;Please confirm group deletion.\u0026#39; =\u0026gt; \u0026#39;确认删除群组.\u0026#39;, \u0026#39;Delete\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;Edit group.\u0026#39; =\u0026gt; \u0026#39;编辑群组.\u0026#39;, \u0026#39;Delete group.\u0026#39; =\u0026gt; \u0026#39;删除群组.\u0026#39;, \u0026#39;Group successfully deleted!\u0026#39; =\u0026gt; \u0026#39;删除群组成功!\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;姓名\u0026#39;, \u0026#39;Created by\u0026#39; =\u0026gt; \u0026#39;创建者\u0026#39;, \u0026#39;Users\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Add Group\u0026#39; =\u0026gt; \u0026#39;添加群组\u0026#39;, \u0026#39;Group successfully updated!\u0026#39; =\u0026gt; \u0026#39;群组更新成功!\u0026#39;, ), \u0026#39;Admin: Notifications\u0026#39; =\u0026gt; array ( \u0026#39;Notifications\u0026#39; =\u0026gt; \u0026#39;通知\u0026#39;, \u0026#39;Notification rule added.\u0026#39; =\u0026gt; \u0026#39;通知角色添加成功.\u0026#39;, \u0026#39;Failed to add notification!\u0026#39; =\u0026gt; \u0026#39;通知角色添加失败!\u0026#39;, \u0026#39;Please type an email address.\u0026#39; =\u0026gt; \u0026#39;请输入Email地址.\u0026#39;, \u0026#39;Please select at least one action.\u0026#39; =\u0026gt; \u0026#39;请选择至少1个动作.\u0026#39;, \u0026#39;Notification rule removed.\u0026#39; =\u0026gt; \u0026#39;通知角色删除成功.\u0026#39;, \u0026#39;Failed to remove notification!\u0026#39; =\u0026gt; \u0026#39;通知角色删除失败!\u0026#39;, \u0026#39;Action\u0026#39; =\u0026gt; \u0026#39;动作\u0026#39;, \u0026#39;E-mail address\u0026#39; =\u0026gt; \u0026#39;Email地址\u0026#39;, \u0026#39;Ungrouped users\u0026#39; =\u0026gt; \u0026#39;未分组用户\u0026#39;, \u0026#39;File previewed\u0026#39; =\u0026gt; \u0026#39;文件已预览\u0026#39;, \u0026#39;File uploaded\u0026#39; =\u0026gt; \u0026#39;文件上传完毕\u0026#39;, \u0026#39;File received (via upload)\u0026#39; =\u0026gt; \u0026#39;文件已接收 (通过上传)\u0026#39;, \u0026#39;File received (via copy)\u0026#39; =\u0026gt; \u0026#39;文件已接收 (通过复制)\u0026#39;, \u0026#39;File received (via move)\u0026#39; =\u0026gt; \u0026#39;文件已接收 (通过移动)\u0026#39;, \u0026#39;Upload failed\u0026#39; =\u0026gt; \u0026#39;上传失败\u0026#39;, \u0026#39;File downloaded\u0026#39; =\u0026gt; \u0026#39;文件下载完毕\u0026#39;, \u0026#39;WebLink download\u0026#39; =\u0026gt; \u0026#39;Web链接下载\u0026#39;, \u0026#39;File received (via WebLink)\u0026#39; =\u0026gt; \u0026#39;文件已接收(通过WebLink)\u0026#39;, \u0026#39;Folder shared\u0026#39; =\u0026gt; \u0026#39;目录共享完毕\u0026#39;, \u0026#39;Folder unshared\u0026#39; =\u0026gt; \u0026#39;目录解除共享完毕\u0026#39;, \u0026#39;New shared folder available\u0026#39; =\u0026gt; \u0026#39;新共享目录生效\u0026#39;, \u0026#39;Login\u0026#39; =\u0026gt; \u0026#39;登录\u0026#39;, \u0026#39;Logout\u0026#39; =\u0026gt; \u0026#39;注销\u0026#39;, \u0026#39;File moved\u0026#39; =\u0026gt; \u0026#39;文件移动完毕\u0026#39;, \u0026#39;Folder moved\u0026#39; =\u0026gt; \u0026#39;目录移动完毕\u0026#39;, \u0026#39;Folder copied\u0026#39; =\u0026gt; \u0026#39;目录复制完毕\u0026#39;, \u0026#39;Failed to copy folder\u0026#39; =\u0026gt; \u0026#39;目录复制失败\u0026#39;, \u0026#39;File copied\u0026#39; =\u0026gt; \u0026#39;文件复制完毕\u0026#39;, \u0026#39;File deleted\u0026#39; =\u0026gt; \u0026#39;文件删除完毕\u0026#39;, \u0026#39;Folder deleted\u0026#39; =\u0026gt; \u0026#39;目录删除完毕\u0026#39;, \u0026#39;File renamed\u0026#39; =\u0026gt; \u0026#39;文件重命名完毕\u0026#39;, \u0026#39;Failed to rename file\u0026#39; =\u0026gt; \u0026#39;文件重命名失败\u0026#39;, \u0026#39;Folder renamed\u0026#39; =\u0026gt; \u0026#39;目录重命名完毕\u0026#39;, \u0026#39;New folder created\u0026#39; =\u0026gt; \u0026#39;新目录创建完毕\u0026#39;, \u0026#39;WebLink upload failed\u0026#39; =\u0026gt; \u0026#39;文件上传失败\u0026#39;, \u0026#39;Failed to move file\u0026#39; =\u0026gt; \u0026#39;文件移动失败\u0026#39;, \u0026#39;Failed to copy file\u0026#39; =\u0026gt; \u0026#39;文件复制失败\u0026#39;, \u0026#39;Failed to move folder\u0026#39; =\u0026gt; \u0026#39;目录移动失败\u0026#39;, \u0026#39;Failed to delete file\u0026#39; =\u0026gt; \u0026#39;文件删除失败\u0026#39;, \u0026#39;Failed to delete folder\u0026#39; =\u0026gt; \u0026#39;目录删除失败\u0026#39;, \u0026#39;Failed to rename folder\u0026#39; =\u0026gt; \u0026#39;目录重命名失败\u0026#39;, \u0026#39;Failed to create new folder\u0026#39; =\u0026gt; \u0026#39;目录创建失败\u0026#39;, \u0026#39;File version restored\u0026#39; =\u0026gt; \u0026#39;文件版本还原完毕\u0026#39;, \u0026#39;Failed to restore file version\u0026#39; =\u0026gt; \u0026#39;文件版本还原失败\u0026#39;, \u0026#39;File version deleted\u0026#39; =\u0026gt; \u0026#39;文件版本删除完毕\u0026#39;, \u0026#39;Failed to delete file version\u0026#39; =\u0026gt; \u0026#39;文件版本删除失败\u0026#39;, \u0026#39;New user registration\u0026#39; =\u0026gt; \u0026#39;用户注册\u0026#39;, \u0026#39;Folder zipped\u0026#39; =\u0026gt; \u0026#39;目录打包完毕\u0026#39;, \u0026#39;Failed to zip folder\u0026#39; =\u0026gt; \u0026#39;目录打包失败\u0026#39;, \u0026#39;Files zipped\u0026#39; =\u0026gt; \u0026#39;文件打包完毕\u0026#39;, \u0026#39;Failed to zip files\u0026#39; =\u0026gt; \u0026#39;文件打包失败\u0026#39;, \u0026#39;Restored deleted file\u0026#39; =\u0026gt; \u0026#39;还原已删除文件完毕\u0026#39;, \u0026#39;Restored deleted folder\u0026#39; =\u0026gt; \u0026#39;还原已删除目录完毕\u0026#39;, \u0026#39;File permanently deleted\u0026#39; =\u0026gt; \u0026#39;文件已永久删除\u0026#39;, \u0026#39;Folder permanently deleted\u0026#39; =\u0026gt; \u0026#39;目录已永久删除\u0026#39;, \u0026#39;File locked\u0026#39; =\u0026gt; \u0026#39;文件锁定完毕\u0026#39;, \u0026#39;Failed to lock file\u0026#39; =\u0026gt; \u0026#39;文件锁定失败\u0026#39;, \u0026#39;File unlocked\u0026#39; =\u0026gt; \u0026#39;文件解锁完毕\u0026#39;, \u0026#39;Failed to unlock file\u0026#39; =\u0026gt; \u0026#39;文件解锁失败\u0026#39;, \u0026#39;File comment added\u0026#39; =\u0026gt; \u0026#39;文件留言添加完毕\u0026#39;, \u0026#39;Failed to add comment to file\u0026#39; =\u0026gt; \u0026#39;文件留言添加失败\u0026#39;, \u0026#39;File comment removed\u0026#39; =\u0026gt; \u0026#39;文件留言移除完毕\u0026#39;, \u0026#39;Failed to remove comment from file\u0026#39; =\u0026gt; \u0026#39;文件留言移除失败\u0026#39;, \u0026#39;Files sent by email\u0026#39; =\u0026gt; \u0026#39;Email发送文件完毕\u0026#39;, \u0026#39;Failed to send files by email\u0026#39; =\u0026gt; \u0026#39;Email发送文件失败\u0026#39;, \u0026#39;You are not allowed to manage e-mail notifications.\u0026#39; =\u0026gt; \u0026#39;您无权管理Email通知.\u0026#39;, \u0026#39;User added\u0026#39; =\u0026gt; \u0026#39;用户添加完毕\u0026#39;, \u0026#39;User edited\u0026#39; =\u0026gt; \u0026#39;用户编辑完毕\u0026#39;, \u0026#39;User deleted\u0026#39; =\u0026gt; \u0026#39;用户删除完毕\u0026#39;, \u0026#39;User manual activation\u0026#39; =\u0026gt; \u0026#39;用户手动激活\u0026#39;, \u0026#39;User manual deactivation\u0026#39; =\u0026gt; \u0026#39;用户手动锁定\u0026#39;, \u0026#39;Space quota warning\u0026#39; =\u0026gt; \u0026#39;空间配额报警\u0026#39;, \u0026#39;Password recovery\u0026#39; =\u0026gt; \u0026#39;密码恢复\u0026#39;, \u0026#39;WebLink removed\u0026#39; =\u0026gt; \u0026#39;WebLink已删除\u0026#39;, \u0026#39;WebLink modified\u0026#39; =\u0026gt; \u0026#39;WebLink已删除\u0026#39;, \u0026#39;WebLink created\u0026#39; =\u0026gt; \u0026#39;WebLink已创建\u0026#39;, \u0026#39;Metadata changed\u0026#39; =\u0026gt; \u0026#39;元数据已更改\u0026#39;, \u0026#39;Role added\u0026#39; =\u0026gt; \u0026#39;角色已添加\u0026#39;, \u0026#39;Role edited\u0026#39; =\u0026gt; \u0026#39;角色已编辑\u0026#39;, \u0026#39;Role deleted\u0026#39; =\u0026gt; \u0026#39;角色已删除\u0026#39;, \u0026#39;Add Notification Rule\u0026#39; =\u0026gt; \u0026#39;新增提醒规则\u0026#39;, \u0026#39;Edit Notification Rule\u0026#39; =\u0026gt; \u0026#39;编辑提醒规则\u0026#39;, \u0026#39;Delete Notification Rule\u0026#39; =\u0026gt; \u0026#39;删除提醒规则\u0026#39;, \u0026#39;Please confirm notification rule deletion.\u0026#39; =\u0026gt; \u0026#39;请确认要删除提醒规则。\u0026#39;, \u0026#39;User or group\u0026#39; =\u0026gt; \u0026#39;用户或组\u0026#39;, \u0026#39;Users\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Notify e-mail address\u0026#39; =\u0026gt; \u0026#39;电子邮件通知\u0026#39;, \u0026#39;Actions\u0026#39; =\u0026gt; \u0026#39;行动\u0026#39;, \u0026#39;WebLink folder access\u0026#39; =\u0026gt; \u0026#39;WebLink文件夹地址\u0026#39;, \u0026#39;File encrypted\u0026#39; =\u0026gt; \u0026#39;文件已加密\u0026#39;, \u0026#39;File decrypted\u0026#39; =\u0026gt; \u0026#39;文件已解密\u0026#39;, \u0026#39;Logs\u0026#39; =\u0026gt; \u0026#39;日志\u0026#39;, \u0026#39;E-mail notifications logs\u0026#39; =\u0026gt; \u0026#39;电子邮件提醒日志\u0026#39;, \u0026#39;Sent message (%1)\u0026#39; =\u0026gt; \u0026#39;发送消息 (%1)\u0026#39;, \u0026#39;Date\u0026#39; =\u0026gt; \u0026#39;日期\u0026#39;, \u0026#39;From\u0026#39; =\u0026gt; \u0026#39;从\u0026#39;, \u0026#39;To\u0026#39; =\u0026gt; \u0026#39;到\u0026#39;, \u0026#39;Subject\u0026#39; =\u0026gt; \u0026#39;主题\u0026#39;, \u0026#39;Has errors\u0026#39; =\u0026gt; \u0026#39;发送错误\u0026#39;, \u0026#39;File downloaded by another user\u0026#39; =\u0026gt; \u0026#39;文件已被其他用户下载\u0026#39;, \u0026#39;Folder added to BitTorrent Sync\u0026#39; =\u0026gt; \u0026#39;文件已经添加到BitTorrent Sync\u0026#39;, \u0026#39;Folder removed from BitTorrent Sync\u0026#39; =\u0026gt; \u0026#39;文件夹从BitTorreny Sync删除\u0026#39;, \u0026#39;Label changed\u0026#39; =\u0026gt; \u0026#39;变更标记\u0026#39;, \u0026#39;Star added\u0026#39; =\u0026gt; \u0026#39;添加收藏\u0026#39;, \u0026#39;Star removed\u0026#39; =\u0026gt; \u0026#39;移除收藏\u0026#39;, \u0026#39;Trash emptied\u0026#39; =\u0026gt; \u0026#39;清空回收站\u0026#39;, \u0026#39;Failed to empty trash\u0026#39; =\u0026gt; \u0026#39;清空回收站失败\u0026#39;, \u0026#39;Label received\u0026#39; =\u0026gt; \u0026#39;收到标签 \u0026#39;, \u0026#39;Download failed\u0026#39; =\u0026gt; \u0026#39;下载失败\u0026#39;, \u0026#39;Notification rule successfully deleted!\u0026#39; =\u0026gt; \u0026#39;通知规则已成功删除\u0026#39;, \u0026#39;Folder received (via copy)\u0026#39; =\u0026gt; \u0026#39;收到文件夹（通过复制）\u0026#39;, \u0026#39;Folder received (via move)\u0026#39; =\u0026gt; \u0026#39;收到文件夹（通过移动） \u0026#39;, \u0026#39;File shared\u0026#39; =\u0026gt; \u0026#39;文件共享\u0026#39;, \u0026#39;File unshared\u0026#39; =\u0026gt; \u0026#39;文件未共享\u0026#39;, \u0026#39;New shared file available\u0026#39; =\u0026gt; \u0026#39;新的共享文件可用\u0026#39;, \u0026#39;Guest user added\u0026#39; =\u0026gt; \u0026#39;访客用户已添加\u0026#39;, \u0026#39;Guest account created\u0026#39; =\u0026gt; \u0026#39;来宾帐户已创建\u0026#39;, ), \u0026#39;Admin: Logs\u0026#39; =\u0026gt; array ( \u0026#39;Date Format: Grid - Date\u0026#39; =\u0026gt; \u0026#39;Y-m-d H:i\u0026#39;, \u0026#39;Activity logs\u0026#39; =\u0026gt; \u0026#39;活动日志\u0026#39;, \u0026#39;Toggle search options\u0026#39; =\u0026gt; \u0026#39;搜索选项\u0026#39;, \u0026#39;User\u0026#39; =\u0026gt; \u0026#39;单用户\u0026#39;, \u0026#39;Users\u0026#39; =\u0026gt; \u0026#39;多用户\u0026#39;, \u0026#39;Actions\u0026#39; =\u0026gt; \u0026#39;动作\u0026#39;, \u0026#39;Date start\u0026#39; =\u0026gt; \u0026#39;开始日期\u0026#39;, \u0026#39;Date end\u0026#39; =\u0026gt; \u0026#39;截止日期\u0026#39;, \u0026#39;Search\u0026#39; =\u0026gt; \u0026#39;搜索\u0026#39;, \u0026#39;Loading data...\u0026#39; =\u0026gt; \u0026#39;加载数据...\u0026#39;, \u0026#39;Date\u0026#39; =\u0026gt; \u0026#39;日期\u0026#39;, \u0026#39;Details\u0026#39; =\u0026gt; \u0026#39;详细\u0026#39;, \u0026#39;Keyword\u0026#39; =\u0026gt; \u0026#39;关键字\u0026#39;, \u0026#39;Please confirm the archiving and deletion of the activity logs.\u0026#39; =\u0026gt; \u0026#39;请确认归档并删除活动日志.\u0026#39;, \u0026#39;Activity log has been successfuly archived!\u0026#39; =\u0026gt; \u0026#39;活动日志归档完毕!\u0026#39;, \u0026#39;Failed to retrieve log data!\u0026#39; =\u0026gt; \u0026#39;恢复日志数据失败!\u0026#39;, \u0026#39;Failed to create archive file!\u0026#39; =\u0026gt; \u0026#39;创建归档文件失败!\u0026#39;, \u0026#39;Failed to clear logs!\u0026#39; =\u0026gt; \u0026#39;清除日志失败!\u0026#39;, \u0026#39;Failed to archive logs!\u0026#39; =\u0026gt; \u0026#39;归档日志失败!\u0026#39;, \u0026#39;You are not allowed to access the activity logs.\u0026#39; =\u0026gt; \u0026#39;您无权访问活动日志.\u0026#39;, \u0026#39;Export results to CSV\u0026#39; =\u0026gt; \u0026#39;到处结果到CSV\u0026#39;, \u0026#39;Action\u0026#39; =\u0026gt; \u0026#39;行动\u0026#39;, \u0026#39;Search Activity Logs\u0026#39; =\u0026gt; \u0026#39;搜索活动日志\u0026#39;, \u0026#39;Export\u0026#39; =\u0026gt; \u0026#39;导出\u0026#39;, ), \u0026#39;Admin: Metadata\u0026#39; =\u0026gt; array ( \u0026#39;You cannot delete this file type.\u0026#39; =\u0026gt; \u0026#39;您不能删除此文件类型\u0026#39;, \u0026#39;Metadata\u0026#39; =\u0026gt; \u0026#39;元数据\u0026#39;, \u0026#39;Manage the different types of information that can be associated with classes of files.\u0026#39; =\u0026gt; \u0026#39;管理各种与文件关联的类型信息.\u0026#39;, \u0026#39;You are not allowed to manage the metadata settings.\u0026#39; =\u0026gt; \u0026#39;您无权管理元数据设置.\u0026#39;, \u0026#39;Fieldsets\u0026#39; =\u0026gt; \u0026#39;属性列\u0026#39;, ), \u0026#39;Admin: Metadata: Filetypes\u0026#39; =\u0026gt; array ( \u0026#39;Comma separated list of file types that should automatically use this file type.\u0026#39; =\u0026gt; \u0026#39;逗号分隔的文件类型列表，应自动使用此文件类型\u0026#39;, \u0026#39;File type\u0026#39; =\u0026gt; \u0026#39;文件类型\u0026#39;, \u0026#39;File types\u0026#39; =\u0026gt; \u0026#39;文件类型\u0026#39;, \u0026#39;File type successfully created!\u0026#39; =\u0026gt; \u0026#39;文件类型创建成功!\u0026#39;, \u0026#39;File type successfully deleted!\u0026#39; =\u0026gt; \u0026#39;文件类型删除成功!\u0026#39;, \u0026#39;Add File Type\u0026#39; =\u0026gt; \u0026#39;创建\u0026#39;, \u0026#39;Please type a name for the file type!\u0026#39; =\u0026gt; \u0026#39;请输入文件类型名称!\u0026#39;, \u0026#39;Please don\\\u0026#39;t use weird characters for the file type\\\u0026#39;s name!\u0026#39; =\u0026gt; \u0026#39;文件类型名称请勿使用特殊字符!\u0026#39;, \u0026#39;File type name already in use. Please choose another one.\u0026#39; =\u0026gt; \u0026#39;文件类型名已存在，请选择其他名称.\u0026#39;, \u0026#39;Failed to edit file type!\u0026#39; =\u0026gt; \u0026#39;编辑文件类型失败!\u0026#39;, \u0026#39;Failed to add file type!\u0026#39; =\u0026gt; \u0026#39;添加文件类型失败!\u0026#39;, \u0026#39;Edit File Type\u0026#39; =\u0026gt; \u0026#39;编辑文件类型\u0026#39;, \u0026#39;Description\u0026#39; =\u0026gt; \u0026#39;描述\u0026#39;, \u0026#39;Click here to manage fieldsets.\u0026#39; =\u0026gt; \u0026#39;点此管理属性列.\u0026#39;, \u0026#39;Delete File Type\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;File type successfully updated!\u0026#39; =\u0026gt; \u0026#39;文件类型更新成功!\u0026#39;, \u0026#39;Failed to delete file type!\u0026#39; =\u0026gt; \u0026#39;文件类型删除失败!\u0026#39;, \u0026#39;Please confirm file type deletion.\u0026#39; =\u0026gt; \u0026#39;请确认删除文件类型.\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Field sets\u0026#39; =\u0026gt; \u0026#39;属性列\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;名称\u0026#39;, \u0026#39;Created by\u0026#39; =\u0026gt; \u0026#39;创建者\u0026#39;, \u0026#39;File type name\u0026#39; =\u0026gt; \u0026#39;文件类型名称\u0026#39;, \u0026#39;File extensions\u0026#39; =\u0026gt; \u0026#39;文件扩展名 \u0026#39;, \u0026#39;Comma separated list of file extensions that should automatically use this file type.\u0026#39; =\u0026gt; \u0026#39;逗号分隔的应该自动使用这个文件类型的文件扩展名列表\u0026#39;, \u0026#39;Automatic source\u0026#39; =\u0026gt; \u0026#39;自动来源 \u0026#39;, \u0026#39;This is the path to the \u0026#34;Media Info\u0026#34; field.\u0026#39; =\u0026gt; \u0026#39;这是“媒体信息”字段的路径\u0026#39;, \u0026#39;File count\u0026#39; =\u0026gt; \u0026#39;文件数量 \u0026#39;, ), \u0026#39;Admin: Metadata: Fieldsets\u0026#39; =\u0026gt; array ( \u0026#39;Fieldset successfully deleted!\u0026#39; =\u0026gt; \u0026#39;属性列删除失败!\u0026#39;, \u0026#39;Add Field Set\u0026#39; =\u0026gt; \u0026#39;添加字段集 \u0026#39;, \u0026#39;Please type a name for the field set!\u0026#39; =\u0026gt; \u0026#39;请输入属性列名称!\u0026#39;, \u0026#39;Field set name already in use. Please choose another one.\u0026#39; =\u0026gt; \u0026#39;属性列名称已存在，请使用其他名称.\u0026#39;, \u0026#39;Failed to edit field set!\u0026#39; =\u0026gt; \u0026#39;属性列编辑失败!\u0026#39;, \u0026#39;Failed to add field set!\u0026#39; =\u0026gt; \u0026#39;属性列添加失败!\u0026#39;, \u0026#39;Failed to delete field set!\u0026#39; =\u0026gt; \u0026#39;属性列删除失败!\u0026#39;, \u0026#39;Field set successfully added\u0026#39; =\u0026gt; \u0026#39;属性列创建成功\u0026#39;, \u0026#39;Field set successfully updated\u0026#39; =\u0026gt; \u0026#39;属性列更新成功\u0026#39;, \u0026#39;Field set name\u0026#39; =\u0026gt; \u0026#39;属性列名称\u0026#39;, \u0026#39;Description\u0026#39; =\u0026gt; \u0026#39;描述\u0026#39;, \u0026#39;Generic field set\u0026#39; =\u0026gt; \u0026#39;常规属性\u0026#39;, \u0026#39;A generic field set is one that is available for every file by default.\u0026#39; =\u0026gt; \u0026#39;常规属性默认对于所有文件有效.\u0026#39;, \u0026#39;Edit\u0026#39; =\u0026gt; \u0026#39;编辑\u0026#39;, \u0026#39;Delete\u0026#39; =\u0026gt; \u0026#39;删除属性列\u0026#39;, \u0026#39;Fieldsets\u0026#39; =\u0026gt; \u0026#39;属性列\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;名称\u0026#39;, \u0026#39;Fields\u0026#39; =\u0026gt; \u0026#39;字段\u0026#39;, \u0026#39;Created by\u0026#39; =\u0026gt; \u0026#39;创建者\u0026#39;, \u0026#39;Edit Field Set\u0026#39; =\u0026gt; \u0026#39;编辑字段集\u0026#39;, \u0026#39;Delete Field Set\u0026#39; =\u0026gt; \u0026#39;删除字段集\u0026#39;, \u0026#39;Field set successfuly deleted\u0026#39; =\u0026gt; \u0026#39;字段集成功删除\u0026#39;, \u0026#39;Basic Info\u0026#39; =\u0026gt; \u0026#39;基础信息\u0026#39;, \u0026#39;Fields can be added after creating the set.\u0026#39; =\u0026gt; \u0026#39;字段可以在创建集合后添加。\u0026#39;, \u0026#39;Please confirm field set deletion.\u0026#39; =\u0026gt; \u0026#39;请确认删除字段集。\u0026#39;, \u0026#39;Add\u0026#39; =\u0026gt; \u0026#39;新建\u0026#39;, ), \u0026#39;Admin: Metadata: Fields\u0026#39; =\u0026gt; array ( \u0026#39;Fields\u0026#39; =\u0026gt; \u0026#39;属性列\u0026#39;, \u0026#39;Add Field\u0026#39; =\u0026gt; \u0026#39;创建\u0026#39;, \u0026#39;Edit Field\u0026#39; =\u0026gt; \u0026#39;编辑\u0026#39;, \u0026#39;Field successfully deleted!\u0026#39; =\u0026gt; \u0026#39;属性列删除成功!\u0026#39;, \u0026#39;Please type a name for the field!\u0026#39; =\u0026gt; \u0026#39;请输入属性列名称!\u0026#39;, \u0026#39;Field name already in use. Please choose another one.\u0026#39; =\u0026gt; \u0026#39;属性列名称已存在，请选择其他名称.\u0026#39;, \u0026#39;Failed to edit field!\u0026#39; =\u0026gt; \u0026#39;属性列编辑失败!\u0026#39;, \u0026#39;Failed to delete field!\u0026#39; =\u0026gt; \u0026#39;属性列删除失败!\u0026#39;, \u0026#39;Failed to add fieldset!\u0026#39; =\u0026gt; \u0026#39;属性列添加失败!\u0026#39;, \u0026#39;Field successfully added\u0026#39; =\u0026gt; \u0026#39;属性列添加成功\u0026#39;, \u0026#39;Field successfully updated\u0026#39; =\u0026gt; \u0026#39;属性列更新成功\u0026#39;, \u0026#39;Field successfully deleted\u0026#39; =\u0026gt; \u0026#39;属性列删除成功\u0026#39;, \u0026#39;Delete Field\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;Field name\u0026#39; =\u0026gt; \u0026#39;属性名称\u0026#39;, \u0026#39;Show by default as column in file grid\u0026#39; =\u0026gt; \u0026#39;默认以列显示\u0026#39;, \u0026#39;Description\u0026#39; =\u0026gt; \u0026#39;描述\u0026#39;, \u0026#39;Hide fieldset name in column header\u0026#39; =\u0026gt; \u0026#39;列的头部隐藏属性名称\u0026#39;, \u0026#39;Predefined values\u0026#39; =\u0026gt; \u0026#39;预定义值\u0026#39;, \u0026#39;Separate values by commas. Example: one, two, three\u0026#39; =\u0026gt; \u0026#39;值用逗号分开. 例如: 1, 2, 3\u0026#39;, \u0026#39;The already attached meta information will remained unchanged, even though you rename the values here.\u0026#39; =\u0026gt; \u0026#39;即时您重命名值，已经存在的元信息也将保持不变\u0026#39;, \u0026#39;Please confirm field deletion.\u0026#39; =\u0026gt; \u0026#39;请确认属性删除.\u0026#39;, \u0026#39;Sort\u0026#39; =\u0026gt; \u0026#39;分类\u0026#39;, \u0026#39;Set a number to define the field\\\u0026#39;s sorting position.\u0026#39; =\u0026gt; \u0026#39;设置一个数字以定义字段的排序位置\u0026#39;, \u0026#39;Field type\u0026#39; =\u0026gt; \u0026#39;属性类型 \u0026#39;, \u0026#39;Normal text\u0026#39; =\u0026gt; \u0026#39;普通文本 \u0026#39;, \u0026#39;Large text\u0026#39; =\u0026gt; \u0026#39;大文本 \u0026#39;, \u0026#39;Predefined list\u0026#39; =\u0026gt; \u0026#39;预定义列表 \u0026#39;, \u0026#39;Multiple values\u0026#39; =\u0026gt; \u0026#39;多个值 \u0026#39;, \u0026#39;Date/time\u0026#39; =\u0026gt; \u0026#39;日期/时间\u0026#39;, ), \u0026#39;Admin: Licensing\u0026#39; =\u0026gt; array ( \u0026#39;Software licensing\u0026#39; =\u0026gt; \u0026#39;软件许可信息\u0026#39;, \u0026#39;You are using \u0026lt;b\u0026gt;%1 user accounts\u0026lt;/b\u0026gt; out of \u0026lt;b\u0026gt;%2\u0026lt;/b\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;您已经创建\u0026lt;b\u0026gt;%1个用户\u0026lt;/b\u0026gt;，授权共许可\u0026lt;b\u0026gt;%2个用户\u0026lt;/b\u0026gt;。\u0026#39;, \u0026#39;Update\u0026#39; =\u0026gt; \u0026#39;更新\u0026#39;, \u0026#39;Failed to upgrade license:\u0026#39; =\u0026gt; \u0026#39;升级许可失败:\u0026#39;, \u0026#39;Failed to connect to licensing server!\u0026#39; =\u0026gt; \u0026#39;链接授权服务器失败！\u0026#39;, \u0026#39;License successfully updated.\u0026#39; =\u0026gt; \u0026#39;授权升级成功！\u0026#39;, \u0026#39;The license will expire on \u0026lt;b\u0026gt;%1\u0026lt;/b\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;授权将于\u0026lt;b\u0026gt;%1\u0026lt;/b\u0026gt;过期。\u0026#39;, \u0026#39;License upgraded.\u0026lt;br\u0026gt;\u0026lt;span class=\u0026#34;nowrap\u0026#34;\u0026gt;You can now have \u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; user accounts.\u0026lt;/span\u0026gt;\u0026#39; =\u0026gt; \u0026#39;许可升级成功.\u0026lt;br\u0026gt;\u0026lt;span class=\u0026#34;nowrap\u0026#34;\u0026gt;您现在可以拥有 \u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; 用户.\u0026lt;/span\u0026gt;\u0026#39;, \u0026#39;License key in use: \u0026lt;b\u0026gt;%1\u0026lt;/b\u0026gt;\u0026#39; =\u0026gt; \u0026#39;正在使用的授权：\u0026lt;b\u0026gt;%1\u0026lt;/b\u0026gt;\u0026#39;, \u0026#39;unlimited\u0026#39; =\u0026gt; \u0026#39;无限制\u0026#39;, \u0026#39;Please provide the key!\u0026#39; =\u0026gt; \u0026#39;请提供授权 key ！\u0026#39;, \u0026#39;Your FileRun license is now registered.\u0026#39; =\u0026gt; \u0026#39;你的 FileRun 授权已成功注册\u0026#39;, \u0026#39;An e-mail message has been now sent to you.\u0026#39; =\u0026gt; \u0026#39;一封邮件已发送至你的 E-mail 邮箱\u0026#39;, ), \u0026#39;Admin: Software update\u0026#39; =\u0026gt; array ( \u0026#39;Software update\u0026#39; =\u0026gt; \u0026#39;软件升级\u0026#39;, \u0026#39;Step 1:\u0026#39; =\u0026gt; \u0026#39;第1步:\u0026#39;, \u0026#39;Check for updates\u0026#39; =\u0026gt; \u0026#39;检查更新\u0026#39;, \u0026#39;Step 2:\u0026#39; =\u0026gt; \u0026#39;第2步:\u0026#39;, \u0026#39;Download update\u0026#39; =\u0026gt; \u0026#39;下载更新\u0026#39;, \u0026#39;Step 3:\u0026#39; =\u0026gt; \u0026#39;第3步:\u0026#39;, \u0026#39;Install update\u0026#39; =\u0026gt; \u0026#39;安装更新\u0026#39;, \u0026#39;Start over (to check for more updates)\u0026#39; =\u0026gt; \u0026#39;重新检查可用更新\u0026#39;, \u0026#39;Step 4:\u0026#39; =\u0026gt; \u0026#39;第4步:\u0026#39;, \u0026#39;Your current software version is %1\u0026#39; =\u0026gt; \u0026#39;当前软件版本为%1\u0026#39;, \u0026#39;Upload starting...\u0026#39; =\u0026gt; \u0026#39;上传开始......\u0026#39;, \u0026#39;Uploading...%1%\u0026#39; =\u0026gt; \u0026#39;上传...%1%\u0026#39;, \u0026#39;Uploading software update files is not available.\u0026#39; =\u0026gt; \u0026#39;无法上传软件更新文件\u0026#39;, \u0026#39;Failed to upload file \u0026#34;%1\u0026#34;: %2\u0026#39; =\u0026gt; \u0026#39;无法上传文件\u0026#34;%1\u0026#34;: %2\u0026#39;, \u0026#39;The file needs to be a Zip archive!\u0026#39; =\u0026gt; \u0026#39;该文件需要是Zip存档\u0026#39;, \u0026#39;The filename should not contain space characters!\u0026#39; =\u0026gt; \u0026#39;文件名不应包含空格字符\u0026#39;, \u0026#39;Update file successfully uploaded.\u0026#39; =\u0026gt; \u0026#39;更新文件已成功上传\u0026#39;, \u0026#39;Failed to upload update file. The temporary file on the server is missing. Please try again.\u0026#39; =\u0026gt; \u0026#39;无法上传更新文件。服务器上的临时文件丢失。请再试一次。\u0026#39;, \u0026#39;Upload failed: %1\u0026#39; =\u0026gt; \u0026#39;上传失败: %1\u0026#39;, ), \u0026#39;Admin: Roles\u0026#39; =\u0026gt; array ( \u0026#39;Add a new user role.\u0026#39; =\u0026gt; \u0026#39;添加新用户角色\u0026#39;, \u0026#39;Create role\u0026#39; =\u0026gt; \u0026#39;创建角色\u0026#39;, \u0026#39;Role name\u0026#39; =\u0026gt; \u0026#39;角色名称\u0026#39;, \u0026#39;Description\u0026#39; =\u0026gt; \u0026#39;描述\u0026#39;, \u0026#39;Automatically create the folder if it doesn\\\u0026#39;t exists.\u0026#39; =\u0026gt; \u0026#39;如果不存在，自动创建目录.\u0026#39;, \u0026#39;(%1 users)\u0026#39; =\u0026gt; \u0026#39;(%1 用户)\u0026#39;, \u0026#39;Edit Role\u0026#39; =\u0026gt; \u0026#39;编辑角色\u0026#39;, \u0026#39;Delete Role\u0026#39; =\u0026gt; \u0026#39;删除角色\u0026#39;, \u0026#39;Please set a home folder template.\u0026#39; =\u0026gt; \u0026#39;请设置一个主目录模板\u0026#39;, \u0026#39;Please confirm role deletion.\u0026#39; =\u0026gt; \u0026#39;请确认删除角色.\u0026#39;, \u0026#39;Delete\u0026#39; =\u0026gt; \u0026#39;删除\u0026#39;, \u0026#39;You are required to set a space quota for this role!\u0026#39; =\u0026gt; \u0026#39;您应为此角色设置空间配额!\u0026#39;, \u0026#39;You are required to set a traffic quota for this role!\u0026#39; =\u0026gt; \u0026#39;您应为此角色设置流量配额!\u0026#39;, \u0026#39;The maximum traffic quota you can assign to this role is %1MB!\u0026#39; =\u0026gt; \u0026#39;您能为此角色分配的最大流量配额是 %1MB!\u0026#39;, \u0026#39;The maximum space quota you can assign to this role is %1MB!\u0026#39; =\u0026gt; \u0026#39;您能为此角色分配的最大空间配额是 %1MB!\u0026#39;, \u0026#39;You are not allowed to manage this role.\u0026#39; =\u0026gt; \u0026#39;您无权管理此角色.\u0026#39;, \u0026#39;You are not allowed to manage user roles.\u0026#39; =\u0026gt; \u0026#39;您无权管理用户角色.\u0026#39;, \u0026#39;Role successfully created!\u0026#39; =\u0026gt; \u0026#39;角色创建成功!\u0026#39;, \u0026#39;Role successfully updated!\u0026#39; =\u0026gt; \u0026#39;角色更新成功!\u0026#39;, \u0026#39;Roles\u0026#39; =\u0026gt; \u0026#39;角色\u0026#39;, \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;姓名\u0026#39;, \u0026#39;Created by\u0026#39; =\u0026gt; \u0026#39;创建者\u0026#39;, \u0026#39;Users\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Home folder template\u0026#39; =\u0026gt; \u0026#39;主目录模板\u0026#39;, \u0026#39;Add Role\u0026#39; =\u0026gt; \u0026#39;添加角色\u0026#39;, \u0026#39;Save changes\u0026#39; =\u0026gt; \u0026#39;保存更改\u0026#39;, \u0026#39;You cannot delete this role because it is assigned to %1 users.\u0026#39; =\u0026gt; \u0026#39;你不能删除这个角色因为有 %1 个用户关联到该角色。\u0026#39;, \u0026#39;Role successfully deleted!\u0026#39; =\u0026gt; \u0026#39;角色删除成功！\u0026#39;, \u0026#39;Home folder\u0026#39; =\u0026gt; \u0026#39;主目录\u0026#39;, \u0026#39;Path template\u0026#39; =\u0026gt; \u0026#39;路径模板\u0026#39;, ), \u0026#39;Admin: WebLinks\u0026#39; =\u0026gt; array ( \u0026#39;Path\u0026#39; =\u0026gt; \u0026#39;路径\u0026#39;, \u0026#39;User\u0026#39; =\u0026gt; \u0026#39;用户\u0026#39;, \u0026#39;Expires\u0026#39; =\u0026gt; \u0026#39;有效期\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;密码\u0026#39;, \u0026#39;Allow uploads\u0026#39; =\u0026gt; \u0026#39;允许上传\u0026#39;, \u0026#39;Created\u0026#39; =\u0026gt; \u0026#39;创建日期\u0026#39;, ), \u0026#39;Admin: Tools\u0026#39; =\u0026gt; array ( \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;姓名\u0026#39;, \u0026#39;Username\u0026#39; =\u0026gt; \u0026#39;用户名\u0026#39;, \u0026#39;Quota\u0026#39; =\u0026gt; \u0026#39;配额\u0026#39;, \u0026#39;Used\u0026#39; =\u0026gt; \u0026#39;已使用\u0026#39;, \u0026#39;Usage\u0026#39; =\u0026gt; \u0026#39;使用率\u0026#39;, \u0026#39;Calculating quota usage for \u0026#34;%1\u0026#34;...\u0026#39; =\u0026gt; \u0026#39;为 \u0026#34;%1\u0026#34; 计算空间配额使用率...\u0026#39;, \u0026#39;Last reset happened on %1.\u0026#39; =\u0026gt; \u0026#39;上一次重置发生于%1\u0026#39;, \u0026#39;Reset now\u0026#39; =\u0026gt; \u0026#39;现在重置\u0026#39;, \u0026#39;Id\u0026#39; =\u0026gt; \u0026#39;序号\u0026#39;, ), \u0026#39;Admin: Tools: Import Users\u0026#39; =\u0026gt; array ( \u0026#39;Comma\u0026#39; =\u0026gt; \u0026#39;逗号\u0026#39;, \u0026#39;Semicolon\u0026#39; =\u0026gt; \u0026#39;分号\u0026#39;, \u0026#39;Tab\u0026#39; =\u0026gt; \u0026#39;制表键\u0026#39;, \u0026#39;Import Users\u0026#39; =\u0026gt; \u0026#39;导入用户\u0026#39;, \u0026#39;Step 1: Upload CSV File\u0026#39; =\u0026gt; \u0026#39;步骤一：上传CSV文件\u0026#39;, \u0026#39;Step 2: Map Fields\u0026#39; =\u0026gt; \u0026#39;步骤二：映射字段\u0026#39;, \u0026#39;Step 3: Import Users\u0026#39; =\u0026gt; \u0026#39;步骤三：导入用户\u0026#39;, \u0026#39;Upload CSV file\u0026#39; =\u0026gt; \u0026#39;选择CSV文件\u0026#39;, \u0026#39;Only CSV files are supported!\u0026#39; =\u0026gt; \u0026#39;仅支持CSV文件\u0026#39;, \u0026#39;The CSV file should have at least two columns!\u0026#39; =\u0026gt; \u0026#39;CSV文件应该至少包含三列数据\u0026#39;, \u0026#39;Fields are separated by\u0026#39; =\u0026gt; \u0026#39;字段分隔由\u0026#39;, \u0026#39;Uploading...%1%\u0026#39; =\u0026gt; \u0026#39;上传中...%1%\u0026#39;, \u0026#39;Upload starting...\u0026#39; =\u0026gt; \u0026#39;上传开始...\u0026#39;, \u0026#39;%1 records were found\u0026#39; =\u0026gt; \u0026#39;已发现%1个记录\u0026#39;, \u0026#39;Assign a role to the users\u0026#39; =\u0026gt; \u0026#39;为用户分配角色\u0026#39;, \u0026#39;Add the users to groups\u0026#39; =\u0026gt; \u0026#39;为用户分配组\u0026#39;, \u0026#39;Start with record number\u0026#39; =\u0026gt; \u0026#39;从记录数开始\u0026#39;, \u0026#39;Failed to parse file contents!\u0026#39; =\u0026gt; \u0026#39;解析文件内容失败\u0026#39;, \u0026#39;Only the first 10 records are being displayed here.\u0026#39; =\u0026gt; \u0026#39;这里只显示前十条记录\u0026#39;, \u0026#39;Username\u0026#39; =\u0026gt; \u0026#39;用户名\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;密码\u0026#39;, \u0026#39;Name 1\u0026#39; =\u0026gt; \u0026#39;姓名 1\u0026#39;, \u0026#39;Name 2\u0026#39; =\u0026gt; \u0026#39;姓名 2\u0026#39;, \u0026#39;Name 3\u0026#39; =\u0026gt; \u0026#39;姓名 3\u0026#39;, \u0026#39;E-mail\u0026#39; =\u0026gt; \u0026#39;电子邮件\u0026#39;, \u0026#39;Company\u0026#39; =\u0026gt; \u0026#39;公司\u0026#39;, \u0026#39;Website\u0026#39; =\u0026gt; \u0026#39;网站\u0026#39;, \u0026#39;Note\u0026#39; =\u0026gt; \u0026#39;注释\u0026#39;, \u0026#39;You need to map a column for the username!\u0026#39; =\u0026gt; \u0026#39;你需要为用户名映射一个字段\u0026#39;, \u0026#39;You need to map a column for the password!\u0026#39; =\u0026gt; \u0026#39;你需要为密码映射一个字段\u0026#39;, \u0026#39;You need to map at least one column for the name!\u0026#39; =\u0026gt; \u0026#39;你需要为姓名至少映射一个字段\u0026#39;, \u0026#39;The selected role was not found!\u0026#39; =\u0026gt; \u0026#39;没有找到选定的角色\u0026#39;, \u0026#39;Record %1: The username is missing! The record was skipped.\u0026#39; =\u0026gt; \u0026#39;记录%1：查找用户名失败，该记录被跳过。\u0026#39;, \u0026#39;Record %1: The name is missing! The record was skipped.\u0026#39; =\u0026gt; \u0026#39;记录%1：查找姓名失败，该记录被跳过。\u0026#39;, \u0026#39;Record %1: The password is missing! The record was skipped.\u0026#39; =\u0026gt; \u0026#39;记录%1：查找密码失败，该记录被跳过。\u0026#39;, \u0026#39;Record %1: The username \u0026#34;%2\u0026#34; is already in use! The record was skipped.\u0026#39; =\u0026gt; \u0026#39;记录%1：用户名\u0026#34;%2\u0026#34;已经存在，该记录被跳过。\u0026#39;, \u0026#39;Record %1: User \u0026#34;%2\u0026#34; has been added. Password: %3\u0026#39; =\u0026gt; \u0026#39;记录%1：用户“%2”已经被添加\u0026#39;, \u0026#39;Passwords are in clear text\u0026#39; =\u0026gt; \u0026#39;密码是明文 \u0026#39;, \u0026#39;Enable this option if the passwords stored in your CSV files are not encrypted.\u0026#39; =\u0026gt; \u0026#39;如果存储在CSV文件中的密码未加密，请启用此选项\u0026#39;, \u0026#39;Record number\u0026#39; =\u0026gt; \u0026#39;记录编号 \u0026#39;, \u0026#39;Username/E-mail\u0026#39; =\u0026gt; \u0026#39;用户名/电子邮件 \u0026#39;, \u0026#39;Send a notification now\u0026#39; =\u0026gt; \u0026#39;现在发送通知 \u0026#39;, \u0026#39;An e-mail message with the login information will be sent to the user\\\u0026#39;s address.\u0026#39; =\u0026gt; \u0026#39;包含登录信息的电子邮件将被发送到用户的地址\u0026#39;, \u0026#39;The CSV file needs to contain at least two columns, for username and name.\u0026#39; =\u0026gt; \u0026#39;对于用户名和名称，CSV文件至少需要包含两列。\u0026#39;, \u0026#39;You will be asked to map the fields, so the names and the order of the columns are not important.\u0026#39; =\u0026gt; \u0026#39;系统将要求您映射字段，因此列的名称和顺序并不重要。\u0026#39;, ), \u0026#39;Metadata: Custom\u0026#39; =\u0026gt; array ( \u0026#39;Image proprieties\u0026#39; =\u0026gt; \u0026#39;图像的规范\u0026#39;, \u0026#39;Audio proprieties\u0026#39; =\u0026gt; \u0026#39;音频属性 \u0026#39;, \u0026#39;Height\u0026#39; =\u0026gt; \u0026#39;高度 \u0026#39;, \u0026#39;Width\u0026#39; =\u0026gt; \u0026#39;宽度 \u0026#39;, \u0026#39;Codec\u0026#39; =\u0026gt; \u0026#39;解码器\u0026#39;, \u0026#39;Duration\u0026#39; =\u0026gt; \u0026#39;持续时间 \u0026#39;, \u0026#39;Various information\u0026#39; =\u0026gt; \u0026#39;各种信息 \u0026#39;, \u0026#39;Author\u0026#39; =\u0026gt; \u0026#39;作者\u0026#39;, \u0026#39;Description\u0026#39; =\u0026gt; \u0026#39;描述 \u0026#39;, \u0026#39;Caption\u0026#39; =\u0026gt; \u0026#39;标题 \u0026#39;, \u0026#39;Copyright\u0026#39; =\u0026gt; \u0026#39;版权 \u0026#39;, \u0026#39;GPS latitude\u0026#39; =\u0026gt; \u0026#39;GPS纬度 \u0026#39;, \u0026#39;GPS longitude\u0026#39; =\u0026gt; \u0026#39;GPS经度 \u0026#39;, \u0026#39;Movie title\u0026#39; =\u0026gt; \u0026#39;电影标题 \u0026#39;, \u0026#39;Subject\u0026#39; =\u0026gt; \u0026#39;学科 \u0026#39;, \u0026#39;Album\u0026#39; =\u0026gt; \u0026#39;专辑 \u0026#39;, \u0026#39;Artist\u0026#39; =\u0026gt; \u0026#39;艺术家 \u0026#39;, \u0026#39;Title\u0026#39; =\u0026gt; \u0026#39;标题 \u0026#39;, \u0026#39;Location\u0026#39; =\u0026gt; \u0026#39;位置\u0026#39;, \u0026#39;Tags\u0026#39; =\u0026gt; \u0026#39;标签\u0026#39;, \u0026#39;Date Created\u0026#39; =\u0026gt; \u0026#39;创建日期 \u0026#39;, \u0026#39;Rating\u0026#39; =\u0026gt; \u0026#39;评分 \u0026#39;, ), \u0026#39;Labels\u0026#39; =\u0026gt; array ( \u0026#39;APPROVED\u0026#39; =\u0026gt; \u0026#39;已批准\u0026#39;, \u0026#39;PENDING\u0026#39; =\u0026gt; \u0026#39;待定中\u0026#39;, \u0026#39;REJECTED\u0026#39; =\u0026gt; \u0026#39;已拒绝\u0026#39;, \u0026#39;Failed to insert new label\u0026#39; =\u0026gt; \u0026#39;插入新标记失败\u0026#39;, \u0026#39;No files were labeled\u0026#39; =\u0026gt; \u0026#39;没有文件被标记\u0026#39;, \u0026#39;File successfully labeled\u0026#39; =\u0026gt; \u0026#39;文件被成功标记\u0026#39;, \u0026#39;%1 files successfully labeled\u0026#39; =\u0026gt; \u0026#39;%1 个文件被成功标记\u0026#39;, \u0026#39;Label successfully removed\u0026#39; =\u0026gt; \u0026#39;标记被成功移除\u0026#39;, \u0026#39;Labels successfully removed from %1 files\u0026#39; =\u0026gt; \u0026#39;%1 个文件的标记被成功移除\u0026#39;, ), \u0026#39;Custom Actions: MediaInfo\u0026#39; =\u0026gt; array ( \u0026#39;Media Info\u0026#39; =\u0026gt; \u0026#39;媒体信息 \u0026#39;, ), \u0026#39;Stars\u0026#39; =\u0026gt; array ( \u0026#39;You are not allowed to set stars!\u0026#39; =\u0026gt; \u0026#39;你无权设置收藏\u0026#39;, \u0026#39;No stars were added\u0026#39; =\u0026gt; \u0026#39;没有收藏被添加\u0026#39;, \u0026#39;Star successfully added\u0026#39; =\u0026gt; \u0026#39;收藏已成功添加\u0026#39;, \u0026#39;%1 stars successfully added\u0026#39; =\u0026gt; \u0026#39;%1 个收藏已成功添加\u0026#39;, \u0026#39;No stars were removed\u0026#39; =\u0026gt; \u0026#39;没有收藏被移除\u0026#39;, \u0026#39;Star successfully removed\u0026#39; =\u0026gt; \u0026#39;收藏已成功移除\u0026#39;, \u0026#39;%1 stars successfully removed\u0026#39; =\u0026gt; \u0026#39;%1 个收藏已成功移除\u0026#39;, ), \u0026#39;Admin: Tools: Export Users\u0026#39; =\u0026gt; array ( \u0026#39;Export\u0026#39; =\u0026gt; \u0026#39;导出\u0026#39;, ), \u0026#39;Admin: API\u0026#39; =\u0026gt; array ( \u0026#39;Name\u0026#39; =\u0026gt; \u0026#39;名称\u0026#39;, \u0026#39;Client/App name\u0026#39; =\u0026gt; \u0026#39;客户/应用程序名称 \u0026#39;, \u0026#39;Publisher\u0026#39; =\u0026gt; \u0026#39;开发者\u0026#39;, \u0026#39;Client ID\u0026#39; =\u0026gt; \u0026#39;客户端ID \u0026#39;, \u0026#39;Client secret\u0026#39; =\u0026gt; \u0026#39;客户密码 \u0026#39;, \u0026#39;Authorized redirect URIs\u0026#39; =\u0026gt; \u0026#39;授权重定向URI \u0026#39;, \u0026#39;One URI per line\u0026#39; =\u0026gt; \u0026#39;每行一个URI \u0026#39;, \u0026#39;Needs to start with \u0026#34;https://\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;需要以“https://”开头。\u0026#39;, \u0026#39;\u0026#34;http://\u0026#34; only allowed for \u0026#34;localhost\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;“http://”只允许“localhost”。\u0026#39;, \u0026#39;No URL fragments, and no relative paths.\u0026#39; =\u0026gt; \u0026#39;没有URL片段，也没有相对路径。 \u0026#39;, \u0026#39;Can\\\u0026#39;t be a non-private IP Address.\u0026#39; =\u0026gt; \u0026#39;不能是非私人IP地址。 \u0026#39;, \u0026#39;Website\u0026#39; =\u0026gt; \u0026#39;网站\u0026#39;, \u0026#39;Description\u0026#39; =\u0026gt; \u0026#39;描述 \u0026#39;, \u0026#39;Oauth2 client successfully added\u0026#39; =\u0026gt; \u0026#39;Oauth2客户端成功添加 \u0026#39;, \u0026#39;Failed to add client!\u0026#39; =\u0026gt; \u0026#39;无法添加客户端\u0026#39;, \u0026#39;One of the provided URIs is not valid\u0026#39; =\u0026gt; \u0026#39;提供的URI之一是无效的 \u0026#39;, \u0026#39;Oauth2 client successfully updated\u0026#39; =\u0026gt; \u0026#39;Oauth2客户端已成功更新 \u0026#39;, \u0026#39;Failed to save changes!\u0026#39; =\u0026gt; \u0026#39;无法保存更改\u0026#39;, \u0026#39;Client not found!\u0026#39; =\u0026gt; \u0026#39;未找到客户端\u0026#39;, \u0026#39;Oauth2 client successfully deleted\u0026#39; =\u0026gt; \u0026#39;Oauth2客户端成功删除 \u0026#39;, \u0026#39;Failed to delete client!\u0026#39; =\u0026gt; \u0026#39;无法删除客户端\u0026#39;, \u0026#39;Requires a HTTPS-configured web server\u0026#39; =\u0026gt; \u0026#39;需要HTTPS配置的Web服务器\u0026#39;, \u0026#39;Logo URL\u0026#39; =\u0026gt; \u0026#39;徽标网址 \u0026#39;, \u0026#39;App website\u0026#39; =\u0026gt; \u0026#39;App网站 \u0026#39;, \u0026#39;Enable API\u0026#39; =\u0026gt; \u0026#39;启用API \u0026#39;, \u0026#39;OAuth2 requires that you access this website via HTTPS\u0026#39; =\u0026gt; \u0026#39;OAuth2要求您通过HTTPS访问本网站 \u0026#39;, ), \u0026#39;OAuth2\u0026#39; =\u0026gt; array ( \u0026#39;OAuth2 Consent\u0026#39; =\u0026gt; \u0026#39;OAuth2 授权\u0026#39;, \u0026#39;List files and folders in your \u0026#34;%1\u0026#34; account.\u0026#39; =\u0026gt; \u0026#39;在您的“％1”帐户中列出文件和文件夹\u0026#39;, \u0026#39;List files and folders inside your \u0026#34;Apps/%1\u0026#34; folder.\u0026#39; =\u0026gt; \u0026#39;列出“Apps /％1”文件夹中的文件和文件夹\u0026#39;, \u0026#39;Download files available in your \u0026#34;%1\u0026#34; account.\u0026#39; =\u0026gt; \u0026#39;下载“％1”帐户中可用的文件\u0026#39;, \u0026#39;Download files from your \u0026#34;Apps/%1\u0026#34; folder.\u0026#39; =\u0026gt; \u0026#39;从“Apps /％1”文件夹下载文件\u0026#39;, \u0026#39;Upload files to your \u0026#34;%1\u0026#34; account.\u0026#39; =\u0026gt; \u0026#39;上传文件到您的“％1”帐户\u0026#39;, \u0026#39;Upload files inside your \u0026#34;Apps/%1\u0026#34; folder.\u0026#39; =\u0026gt; \u0026#39;上传“Apps /％1”文件夹中的文件\u0026#39;, \u0026#39;Make changes to the files and folders inside your \u0026#34;%1\u0026#34; account.\u0026#39; =\u0026gt; \u0026#39;更改“％1”帐户中的文件和文件夹\u0026#39;, \u0026#39;Delete files from your \u0026#34;%1\u0026#34; account.\u0026#39; =\u0026gt; \u0026#39;从您的“％1”帐户中删除文件\u0026#39;, \u0026#39;Delete files inside your \u0026#34;Apps/%1\u0026#34; folder.\u0026#39; =\u0026gt; \u0026#39;删除“Apps /％1”文件夹中的文件\u0026#39;, \u0026#39;View your basic \u0026#34;%1\u0026#34; account information.\u0026#39; =\u0026gt; \u0026#39;查看您的基本“％1”帐户信息\u0026#39;, \u0026#39;That includes your name, company name, website and logo.\u0026#39; =\u0026gt; \u0026#39;这包括你的名字，公司名称，网站和标志\u0026#39;, \u0026#39;View your e-mail address (%1).\u0026#39; =\u0026gt; \u0026#39;查看您的电子邮件地址（％1）\u0026#39;, \u0026#39;Create public links to files inside your \u0026#34;%1\u0026#34; account.\u0026#39; =\u0026gt; \u0026#39;在您的“％1”帐户中创建公共文件链接\u0026#39;, \u0026#39;Create public links to files inside your \u0026#34;Apps/%1\u0026#34; folder.\u0026#39; =\u0026gt; \u0026#39;创建“Apps /％1”文件夹中的文件的公共链接\u0026#39;, \u0026#39;Manage \u0026#34;%1\u0026#34; user accounts with your administrative privileges.\u0026#39; =\u0026gt; \u0026#39;用您的管理权限管理“％1”用户帐户\u0026#39;, \u0026#39;You are logged into %1 as \u0026#34;%2\u0026#34;\u0026#39; =\u0026gt; \u0026#39;您已经以％2登入％1\u0026#39;, \u0026#39;Not you?\u0026#39; =\u0026gt; \u0026#39;不是你？\u0026#39;, \u0026#39;Use of your data is subject to the third-party application\\\u0026#39;s publisher privacy policy.\u0026#39; =\u0026gt; \u0026#39;您的数据的使用取决于第三方应用程序的发布者隐私政策\u0026#39;, \u0026#39;Accept\u0026#39; =\u0026gt; \u0026#39;接受\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;The application %1 would like permission to:\u0026#39; =\u0026gt; \u0026#39;应用程序％1所需权限：\u0026#39;, \u0026#39;Share folders with other users.\u0026#39; =\u0026gt; \u0026#39;与其他用户共享文件夹\u0026#39;, \u0026#39;Share folders inside your \u0026#34;Apps/%1\u0026#34; folder with other users.\u0026#39; =\u0026gt; \u0026#39;与其他用户共享“Apps /％1”文件夹内的文件夹\u0026#39;, \u0026#39;Identification\u0026#39; =\u0026gt; \u0026#39;审阅\u0026#39;, \u0026#39;Authorization\u0026#39; =\u0026gt; \u0026#39;授权\u0026#39;, \u0026#39;Maintenance\u0026#39; =\u0026gt; \u0026#39;保留\u0026#39;, \u0026#39;by\u0026#39; =\u0026gt; \u0026#39;通过\u0026#39;, \u0026#39;as\u0026#39; =\u0026gt; \u0026#39;如\u0026#39;, \u0026#39;Sign in as a different user\u0026#39; =\u0026gt; \u0026#39;以不同的用户身份登录\u0026#39;, \u0026#39;The app \u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; would like to:\u0026#39; =\u0026gt; \u0026#39;该应用\u0026lt;strong\u0026gt;％1 \u0026lt;/ strong\u0026gt;希望：\u0026#39;, \u0026#39;The app \u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; would like full access to \u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt; as \u0026lt;span class=\u0026#34;nowrap-bold\u0026#34;\u0026gt;%3\u0026lt;/span\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;该应用程序\u0026lt;strong\u0026gt;％1 \u0026lt;/ strong\u0026gt;希望完全访问\u0026lt;strong\u0026gt;％2 \u0026lt;/ strong\u0026gt;作为\u0026lt;span class =“nowrap-bold”\u0026gt;％3 \u0026lt;/ span\u0026gt;\u0026#39;, \u0026#39;Would like to receive full access to:\u0026#39; =\u0026gt; \u0026#39;希望获得完全访问权限：\u0026#39;, \u0026#39;Would like to receive \u0026lt;a href=\u0026#34;javascript:showAccess()\u0026#34;\u0026gt;access\u0026lt;/a\u0026gt; to:\u0026#39; =\u0026gt; \u0026#39;想要接收\u0026lt;a href=\u0026#34;javascript:showAccess()\u0026#34;\u0026gt;访问\u0026lt;/a\u0026gt;到：\u0026#39;, \u0026#39;Use of your data is subject to the privacy policy of \u0026lt;span class=\u0026#34;nowrap-bold\u0026#34;\u0026gt;%1\u0026lt;/span\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;使用您的数据需遵守\u0026lt;span class =“nowrap-bold”\u0026gt;％1 \u0026lt;/ span\u0026gt;的隐私政策\u0026#39;, \u0026#39;Your account is configured for 2-step verification.\u0026#39; =\u0026gt; \u0026#39;您的帐户已配置为进行两步验证\u0026#39;, \u0026#39;Please provide your \u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; credentials.\u0026#39; =\u0026gt; \u0026#39;请提供您的\u0026lt;strong\u0026gt;％1 \u0026lt;/ strong\u0026gt;凭据\u0026#39;, \u0026#39;1. Select and copy the following key code:\u0026#39; =\u0026gt; \u0026#39;1.选择并复制以下代码：\u0026#39;, \u0026#39;2. Open your 2-step verification app and create an account with this key code.\u0026#39; =\u0026gt; \u0026#39;2.打开您的两步验证应用程序，并使用此密钥代码创建一个帐户\u0026#39;, \u0026#39;3. Lastly, copy the generated verification code (not the one above) from the app to the field bellow.\u0026#39; =\u0026gt; \u0026#39;3.最后，将生成的验证码（不是上面的）从应用程序复制到下面的字段\u0026#39;, \u0026#39;Verification code\u0026#39; =\u0026gt; \u0026#39;验证码\u0026#39;, \u0026#39;Username\u0026#39; =\u0026gt; \u0026#39;用户名\u0026#39;, \u0026#39;Password\u0026#39; =\u0026gt; \u0026#39;密码\u0026#39;, \u0026#39;Proceed\u0026#39; =\u0026gt; \u0026#39;继续\u0026#39;, \u0026#39;View your e-mail address, although your account currently doesn\\\u0026#39;t have one set.\u0026#39; =\u0026gt; \u0026#39;查看您的电子邮件地址，虽然您的帐户目前没有一套\u0026#39;, ), \u0026#39;Custom Actions: Google Editor\u0026#39; =\u0026gt; array ( \u0026#39;Read the \u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;configuration guide\u0026lt;/a\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;阅读\u0026lt;a href=\u0026#34;%1\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;配置指南\u0026lt;/a\u0026gt;。\u0026#39;, \u0026#39;OAuth Client Secret\u0026#39; =\u0026gt; \u0026#39;OAuth客户端密钥\u0026#39;, \u0026#39;OAuth Client ID\u0026#39; =\u0026gt; \u0026#39;OAuth客户端ID\u0026#39;, \u0026#39;Signing into Google...\u0026lt;br\u0026gt;Please check the opened popup for proceeding to the editor.\u0026#39; =\u0026gt; \u0026#39;登录Google ... \u0026lt;br\u0026gt;请检查打开的弹出窗口以继续进行编辑。\u0026#39;, \u0026#39;Sending document data to Google...\u0026lt;br\u0026gt;Please wait.\u0026#39; =\u0026gt; \u0026#39;将文档数据发送给Google ... \u0026lt;br\u0026gt;请稍候。\u0026#39;, \u0026#39;Waiting for the editor to close...\u0026lt;br\u0026gt;If you close this window, your changes will not be saved to the document.\u0026#39; =\u0026gt; \u0026#39;等待编辑器关闭... \u0026lt;br\u0026gt;如果关闭此窗口，您的更改将不会保存到文档中。\u0026#39;, \u0026#39;Importing document from Google...\u0026#39; =\u0026gt; \u0026#39;从Google导入文档...\u0026#39;, \u0026#39;Blank file created successfully\u0026#39; =\u0026gt; \u0026#39;空白文件已成功创建\u0026#39;, \u0026#39;Document with Google\u0026#39; =\u0026gt; \u0026#39;与Google合作\u0026#39;, ), \u0026#39;Notifications\u0026#39; =\u0026gt; array ( \u0026#39;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;, from %3, downloaded the file \u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;从%3开始，\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;下载了\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;文件\u0026#39;, \u0026#39;Your file \u0026#34;%1\u0026#34; was downloaded through the shared link.\u0026#39; =\u0026gt; \u0026#39;您的文件“%1”是通过共享链接下载的\u0026#39;, \u0026#39;From the IP address: %1\u0026#39; =\u0026gt; \u0026#39;从IP地址：%1\u0026#39;, \u0026#39;The folder \u0026#34;%1\u0026#34; has been accessed through the shared link.\u0026#39; =\u0026gt; \u0026#39;已经通过共享链接访问文件夹“%1”\u0026#39;, \u0026#39;The file \u0026#34;%1\u0026#34; has been uploaded by a visitor inside the folder \u0026#34;%2\u0026#34; which was shared through a link.\u0026#39; =\u0026gt; \u0026#39;文件“%1”已经被访问者上传到通过链接共享的文件夹“%2”中\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; uploaded the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; (%3) inside his \u0026#34;%4\u0026#34; folder.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”在他的“%4”文件夹中上传了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”（%3）\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; uploaded the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户\u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; 上传了文件\u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;\u0026#39;, \u0026#39;\u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; has shared \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; with you.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”与您共享了文件夹“%2”\u0026#39;, \u0026#39;The file \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; (%2) was received from \u0026#34;\u0026lt;strong\u0026gt;%3\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;从“\u0026lt;strong\u0026gt;%3 \u0026lt;/ strong\u0026gt;”收到了文件“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”（%2）\u0026#39;, \u0026#39;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; downloaded the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;下载了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; previewed the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”预览了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; failed to login, using the IP address %2.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”未能使用IP地址%2登录\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; has signed in.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”已登录\u0026#39;, \u0026#39;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; changed the label on the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;: \u0026lt;span style=\u0026#34;margin-left:5px;padding:1px;border:1px solid %3\u0026#34;\u0026gt;%4\u0026lt;/span\u0026gt;.\u0026#39; =\u0026gt; \u0026#39;\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;更改了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”上的标签：\u0026lt;span style =\u0026#34;margin-left：5px; padding：1px; border：1px solid %3\u0026#34;\u0026gt; %4 \u0026lt;/span\u0026gt;\u0026#39;, \u0026#39;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; removed the label from the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;从文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”中删除了该标签\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; has performed the following action: \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”执行了以下操作：“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; has shared the folder \u0026#34;%2\u0026#34; with:\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”已经与以下用户共享文件夹“%2”：\u0026#39;, \u0026#39;group \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34;\u0026#39; =\u0026gt; \u0026#39;组“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;user \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34;\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; deleted the file \u0026#34;%2\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”删除了文件“%2”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; deleted the folder \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”已删除文件夹“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt; downloaded the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; (\u0026lt;em\u0026gt;%3\u0026lt;/em\u0026gt;).\u0026#39; =\u0026gt; \u0026#39;\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;下载了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”（\u0026lt;em\u0026gt;%3 \u0026lt;/ em\u0026gt;）\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; added the following comment on the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;:\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”在文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”上添加了以下评论：\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; restored the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”恢复了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; restored the folder \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”恢复了文件夹“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; copied the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; (%3).\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”复制了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”（%3）\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; pasted the folder \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”粘贴了文件夹“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; locked the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”锁定了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; cut the folder \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”剪切了文件夹“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; pasted the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; (%3).\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”粘贴了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”（%3）\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; renamed the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; from \u0026#34;\u0026lt;strong\u0026gt;%3\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”已从“\u0026lt;strong\u0026gt;%3 \u0026lt;/ strong\u0026gt;”重命名文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; renamed the folder \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; from \u0026#34;\u0026lt;strong\u0026gt;%3\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”已从“\u0026lt;strong\u0026gt;%3 \u0026lt;/ strong\u0026gt;”重命名文件夹“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; unlocked the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”解锁了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; copied the folder \u0026#34;%2\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”复制了文件夹“%2”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; created the new folder \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”创建了新文件夹“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; deleted a previous version of the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”删除了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”的先前版本\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; restored a previous version of the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”恢复了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”的以前版本\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; created the \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; Zip archive.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”创建了“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”Zip存档\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; added the following files to the \u0026#34;%2\u0026#34; Zip archive:\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”将以下文件添加到“%2”Zip存档：\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; added the folder \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; to a Zip archive.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”将文件夹“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”添加到Zip存档\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; updated the metadata of the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”更新了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”的元数据\u0026#39;, \u0026#39;Field\u0026#39; =\u0026gt; \u0026#39;领域\u0026#39;, \u0026#39;Old value\u0026#39; =\u0026gt; \u0026#39;旧的价值\u0026#39;, \u0026#39;New value\u0026#39; =\u0026gt; \u0026#39;新的价值\u0026#39;, \u0026#39;%1 has e-mailed the following files\u0026#39; =\u0026gt; \u0026#39;%1已通过电子邮件发送以下文件\u0026#39;, \u0026#39;%1 has shared the following file\u0026#39; =\u0026gt; \u0026#39;%1已共享以下文件\u0026#39;, \u0026#39;%1 has shared the following files\u0026#39; =\u0026gt; \u0026#39;%1共享了以下文件\u0026#39;, \u0026#39;Link valid until\u0026#39; =\u0026gt; \u0026#39;链接有效，直到\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; changed the password.\u0026#39; =\u0026gt; \u0026#39;用户“\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;”更改了密码\u0026#39;, \u0026#39;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;, from %4, downloaded the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; (\u0026lt;em\u0026gt;%3\u0026lt;/em\u0026gt;).\u0026#39; =\u0026gt; \u0026#39;从%4开始，\u0026lt;strong\u0026gt;%1 \u0026lt;/ strong\u0026gt;下载了文件“\u0026lt;strong\u0026gt;%2 \u0026lt;/ strong\u0026gt;”（\u0026lt;em\u0026gt;%3 \u0026lt;/ em\u0026gt;）\u0026#39;, \u0026#39;User \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; moved the file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;用户\u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34; 移动了文件\u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34;\u0026#39;, \u0026#39;The file \u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; was uploaded thorugh the web link created by user \u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34;.\u0026#39; =\u0026gt; \u0026#39;文件\u0026#34;\u0026lt;strong\u0026gt;%2\u0026lt;/strong\u0026gt;\u0026#34; 是通过用户\u0026#34;\u0026lt;strong\u0026gt;%1\u0026lt;/strong\u0026gt;\u0026#34;创建的网络链接上传的\u0026#39;, ), \u0026#39;Admin: Plugins\u0026#39; =\u0026gt; array ( \u0026#39;Raw image files\u0026#39; =\u0026gt; \u0026#39;原始图像文件 \u0026#39;, \u0026#39;Files without extension\u0026#39; =\u0026gt; \u0026#39;没有扩展名的文件 \u0026#39;, \u0026#39;Image files\u0026#39; =\u0026gt; \u0026#39;图像文件 \u0026#39;, \u0026#39;Archive files\u0026#39; =\u0026gt; \u0026#39;存档文件 \u0026#39;, \u0026#39;Video files\u0026#39; =\u0026gt; \u0026#39;视频文件 \u0026#39;, \u0026#39;Web-playable video files\u0026#39; =\u0026gt; \u0026#39;网络播放的视频文件 \u0026#39;, \u0026#39;Audio files\u0026#39; =\u0026gt; \u0026#39;音频文件 \u0026#39;, \u0026#39;Web-playable audio files\u0026#39; =\u0026gt; \u0026#39;网络播放的音频文件 \u0026#39;, \u0026#39;AutoCAD projects\u0026#39; =\u0026gt; \u0026#39;AutoCAD项目 \u0026#39;, \u0026#39;OpenOffice documents\u0026#39; =\u0026gt; \u0026#39;OpenOffice文档 \u0026#39;, \u0026#39;Microsoft Office documents\u0026#39; =\u0026gt; \u0026#39;Microsoft Office文档 \u0026#39;, \u0026#39;Plain text files\u0026#39; =\u0026gt; \u0026#39;纯文本文件 \u0026#39;, \u0026#39;Edit default viewer\u0026#39; =\u0026gt; \u0026#39;编辑默认查看器 \u0026#39;, \u0026#39;Add default viewer\u0026#39; =\u0026gt; \u0026#39;添加默认查看器 \u0026#39;, \u0026#39;File type\u0026#39; =\u0026gt; \u0026#39;文件类型 \u0026#39;, \u0026#39;File extension\u0026#39; =\u0026gt; \u0026#39;文件扩展名 \u0026#39;, \u0026#39;File extensions\u0026#39; =\u0026gt; \u0026#39;文件扩展名 \u0026#39;, \u0026#39;Open with\u0026#39; =\u0026gt; \u0026#39;打开方式\u0026#39;, \u0026#39;Please select a file type or type an extension.\u0026#39; =\u0026gt; \u0026#39;请选择一个文件类型或输入一个扩展名 \u0026#39;, \u0026#39;The \u0026#34;%1\u0026#34; extension already has a default viewer assigned.\u0026#39; =\u0026gt; \u0026#39;“%1”扩展程序已经分配了一个默认查看器\u0026#39;, \u0026#39;The selected file type is already assigned.\u0026#39; =\u0026gt; \u0026#39;所选文件类型已被分配\u0026#39;, \u0026#39;Changes successfully saved.\u0026#39; =\u0026gt; \u0026#39;更改已成功保存\u0026#39;, \u0026#39;Failed to save changes!\u0026#39; =\u0026gt; \u0026#39;无法保存更改\u0026#39;, \u0026#39;The entry was successfully deleted!\u0026#39; =\u0026gt; \u0026#39;该条目已成功删除\u0026#39;, \u0026#39;Failed to delete entry!\u0026#39; =\u0026gt; \u0026#39;无法删除条目\u0026#39;, \u0026#39;- None Selected -\u0026#39; =\u0026gt; \u0026#39;- 没有选择 -\u0026#39;, ), \u0026#39;Custom Actions: Audio Player\u0026#39; =\u0026gt; array ( \u0026#39;Audio Player\u0026#39; =\u0026gt; \u0026#39;音频播放器\u0026#39;, \u0026#39;Select\u0026#39; =\u0026gt; \u0026#39;选择\u0026#39;, \u0026#39;Loading audio player...\u0026#39; =\u0026gt; \u0026#39;加载音频播放器......\u0026#39;, \u0026#39;Close player\u0026#39; =\u0026gt; \u0026#39;关闭\u0026#39;, \u0026#39;Previous\u0026#39; =\u0026gt; \u0026#39;历史\u0026#39;, \u0026#39;Play/Pause\u0026#39; =\u0026gt; \u0026#39;播放/暂停\u0026#39;, \u0026#39;Next\u0026#39; =\u0026gt; \u0026#39;下一曲\u0026#39;, \u0026#39;Shuffle\u0026#39; =\u0026gt; \u0026#39;拖曳\u0026#39;, ), \u0026#39;Custom Actions: Archive Explorer\u0026#39; =\u0026gt; array ( \u0026#39;Archive Explorer\u0026#39; =\u0026gt; \u0026#39;归档浏览器\u0026#39;, ), \u0026#39;Custom Actions: Video Player\u0026#39; =\u0026gt; array ( \u0026#39;Video Player\u0026#39; =\u0026gt; \u0026#39;视频播放器\u0026#39;, ), \u0026#39;Custom Actions: Image Viewer\u0026#39; =\u0026gt; array ( \u0026#39;Image Viewer\u0026#39; =\u0026gt; \u0026#39;图像查看器\u0026#39;, ), \u0026#39;Custom Actions: ONLYOFFICE\u0026#39; =\u0026gt; array ( \u0026#39;Download and install %1\u0026#39; =\u0026gt; \u0026#39;下载并安装 %1\u0026#39;, \u0026#39;DocumentServer URL\u0026#39; =\u0026gt; \u0026#39;ONLYOFFICE服务器URL\u0026#39;, \u0026#39;Document with ONLYOFFICE\u0026#39; =\u0026gt; \u0026#39;文件与ONLYOFFICE\u0026#39;, \u0026#39;New Document.docx\u0026#39; =\u0026gt; \u0026#39;新Word.docx\u0026#39;, \u0026#39;New Spreadsheet.xlsx\u0026#39; =\u0026gt; \u0026#39;新Excel.xlsx\u0026#39;, \u0026#39;New Presentation.pptx\u0026#39; =\u0026gt; \u0026#39;新Ppt.pptx\u0026#39;, \u0026#39;Presentation\u0026#39; =\u0026gt; \u0026#39;介绍\u0026#39;, \u0026#39;Spreadsheet\u0026#39; =\u0026gt; \u0026#39;电子表格\u0026#39;, \u0026#39;Word Document\u0026#39; =\u0026gt; \u0026#39;Word文档\u0026#39;, \u0026#39;The file extension needs to be one of the following: %1\u0026#39; =\u0026gt; \u0026#39;文件扩展名必须是以下之一: %1\u0026#39;, \u0026#39;A file with the specified name already exists. Please try again.\u0026#39; =\u0026gt; \u0026#39;已存在具有指定名称的文件。请再试一次。\u0026#39;, \u0026#39;Blank file created successfully\u0026#39; =\u0026gt; \u0026#39;空白文件已成功创建\u0026#39;, ), \u0026#39;Custom Actions: Zamzar\u0026#39; =\u0026gt; array ( \u0026#39;API key\u0026#39; =\u0026gt; \u0026#39;API密钥\u0026#39;, ), \u0026#39;Custom Actions: Autodesk\u0026#39; =\u0026gt; array ( \u0026#39;API client ID\u0026#39; =\u0026gt; \u0026#39;API客户端ID \u0026#39;, \u0026#39;API client secret\u0026#39; =\u0026gt; \u0026#39;API客户端密钥 \u0026#39;, ), \u0026#39;Custom Actions: Google Earth\u0026#39; =\u0026gt; array ( \u0026#39;Google Maps\u0026#39; =\u0026gt; \u0026#39;谷歌地图\u0026#39;, ), \u0026#39;Custom Actions\u0026#39; =\u0026gt; array ( \u0026#39;New tab\u0026#39; =\u0026gt; \u0026#39;新标签 \u0026#39;, ), \u0026#39;Custom Actions: E-book Reader\u0026#39; =\u0026gt; array ( \u0026#39;E-book Reader\u0026#39; =\u0026gt; \u0026#39;电子书阅读器 \u0026#39;, \u0026#39;Menu\u0026#39; =\u0026gt; \u0026#39;菜单\u0026#39;, \u0026#39;Fullscreen\u0026#39; =\u0026gt; \u0026#39;全屏\u0026#39;, ), \u0026#39;Metadata: Indexing\u0026#39; =\u0026gt; array ( \u0026#39;Please note that this will import metadata from the files and can overwrite metadata which you have manually added.\u0026#39; =\u0026gt; \u0026#39;请注意，这将从文件中导入元数据，并可以覆盖手动添加的元数据\u0026#39;, \u0026#39;Collecting file list...\u0026#39; =\u0026gt; \u0026#39;正在获取文件列表...\u0026#39;, \u0026#39;%1 files found\u0026#39; =\u0026gt; \u0026#39;找到%1个文件\u0026#39;, \u0026#39;Indexing files...\u0026#39; =\u0026gt; \u0026#39;正在索引文件...\u0026#39;, \u0026#39;%1 remaining\u0026#39; =\u0026gt; \u0026#39;剩余的%1\u0026#39;, \u0026#39;Indexing completed!\u0026#39; =\u0026gt; \u0026#39;索引完成\u0026#39;, \u0026#39;The folder seems to be empty\u0026#39; =\u0026gt; \u0026#39;该文件夹似乎是空的\u0026#39;, \u0026#39;There are problems with the server.\u0026#39; =\u0026gt; \u0026#39;服务器有问题\u0026#39;, \u0026#39;Retrying...\u0026#39; =\u0026gt; \u0026#39;重试...\u0026#39;, \u0026#39;Cancel\u0026#39; =\u0026gt; \u0026#39;取消\u0026#39;, \u0026#39;Close\u0026#39; =\u0026gt; \u0026#39;关闭\u0026#39;, ), \u0026#39;Custom Actions: Photo Proof Sheet\u0026#39; =\u0026gt; array ( \u0026#39;Create photo proof sheet\u0026#39; =\u0026gt; \u0026#39;创建照片校样页\u0026#39;, \u0026#39;Photo proof sheet successfully created in your home folder.\u0026#39; =\u0026gt; \u0026#39;在您的主文件夹中成功创建了照片校样页。\u0026#39;, ), \u0026#39;Custom Actions: Bing Maps\u0026#39; =\u0026gt; array ( \u0026#39;Bing Maps API Key\u0026#39; =\u0026gt; \u0026#39;Bing地图API密钥\u0026#39;, ), \u0026#39;Admin: Guest Users\u0026#39; =\u0026gt; array ( \u0026#39;Enable guest user accounts\u0026#39; =\u0026gt; \u0026#39;启用访客用户帐户\u0026#39;, ), \u0026#39;Custom Actions: HTML Editor\u0026#39; =\u0026gt; array ( \u0026#39;HTML Editor\u0026#39; =\u0026gt; \u0026#39;HTML编辑器\u0026#39;, \u0026#39;Save\u0026#39; =\u0026gt; \u0026#39;保存\u0026#39;, \u0026#39;Save and close\u0026#39; =\u0026gt; \u0026#39;保存并关闭\u0026#39;, \u0026#39;Close\u0026#39; =\u0026gt; \u0026#39;关闭\u0026#39;, \u0026#39;Unsaved changes\u0026#39; =\u0026gt; \u0026#39;未保存的更改\u0026#39;, \u0026#39;Discard the changes made?\u0026#39; =\u0026gt; \u0026#39;放弃所做的更改？\u0026#39;, ), ), ); ","date":"2023-04-14T14:14:20+08:00","permalink":"https://dev.leiyanhui.com/nas/file-run-chinese/","title":"filerun切换中文语言 获取语言包并上传方法"},{"content":"场景和前言 家庭和小团队数据中心，是一个相对硬性的需求。有很多解决方案，我这里只论述适合我的。实心括号内是我的选择\n家庭成员 照片同步 影音观看 【filerun webdav MT-Photos rclone infuse 】 团队 文档编辑 文件同步 代码上传 【filerun webdav rclone gitea】 私有git 以及自动同步github 【gitea】 笔记同步 【思源笔记 docker webdav/minio 】 虚拟机环境 容器环境 【pve lxc 】 android/ios开发环境【pve 黑苹果】 远程办公开发环境【pve ipsec winRDP remoutapp codeserver 阿里容器镜像】 科学环境【独立x86 openwrt 】 异地部分【rclone + kopia 加密备份收费的对象储存oss/cos 和 免费云盘 alist 】 每一个方案 都不同的解决方案。 无法一一展开。\n我先付费版网盘，后 折腾 群晖，ovm freenas unraid等，个人网盘程序 也经历 nginxWebdav caddy alist cloudreve seafile nextcloud 等。 最后选择一个整体适合我的方案。\n常用方案的对比 filerun vs nextcloud vs 其他 nextcloud 是佼佼者，但是真的卡，无论如何优化，webui都卡的难受。完全没有丝滑的感觉。 seafile ui和理念 上个世纪的吧，文件储存放不是直接存硬盘的，给其他扩展留下的可操作空间不大。ui丑。比多数简易网盘程序的优势 就是支持wopi了。\ncloudreve 新版支持wopi协议，但是他的webdav 是有问题的，另外 无法直接系统操作文件，新家的文件他是看不到的。没有类似nextcloud的扫描功能，也没有filerun的实时更新功能。至于支持第三方储存，有rclone 那个网盘程序不支持呢 对吧。\nalist 如同他的名字，他就是一个list，优势不在这里，虽然他很强，而且支持本地储存，但是它更适合挂载rclone不支持网盘转webdav而不是完全替代一个私有云储存。我们方案里面有它的座位，但不是它来驻场负责最底层的文件系统。\nminio 储存好样的，但是它专业不在此。有座位不是驻场程序。\nfilebrower 这个。。真的太简陋了，只适合在硬路由器等极端硬件资源紧张的场合用。\nfilerun 优点，功能还可以。 缺点 非开源软件 免费版 有限制 详情查看 filerun\n群晖 unraid esxi freeNas pve 原生linux 群晖 不单是nas更是一个虚拟化和容器平台，虽然黑群晖可以免费。但是很多地方不喜欢，比如他每个磁盘都要写入系统，固定的分区格式。无法直接接入带数据的旧硬盘等\nunraid 参考群晖，unraid有它优秀的地方，比如可以简单搞定pci直通，点击下就可以黑苹果等。我不觉它适合对linux/kvm有一定了解的人，但是他确实挺不错\nesxi 不评价，非要评价的话，就是 曾经的王者 眼下的垃圾\nfreeNAS、ovm 参考 esxi\n原生linux方案，我之前也做过一个 也用过几个月，最后的感觉，灵活但是没有pve方便 所以弃用了。\nwindowsServer 这个。。咋说呢，不说了。。。 macos server 刚好有mac要做server的话 也行吧\npve 优点 开源免费 ，比 直接 cli操作kvm lxc更加直观方便，自带的lxc方案要带docker更灵活 容易扩展，开箱即可使用。缺点：需要有一点点linux基础。而aio和nas圈子的很多人都是linux小白，新手都算不上。\n备份方案 群晖的云盘备份真的是很让人羡慕，一键搞定，还没有额外的开支。 自己弄的话 就需要rclone加密 + kopia + rclone + alist + 不太稳妥的后端免费网盘\n搭建过程 上述多数教程本站都有，但是可能比较零散，请用搜索引擎 搜索 关键词 site:dev.leiyanhuil.com 查看 部分文章 我我会连接到下面\nfilerun 搭建和使用 filerun 搭建和初步使用\n","date":"2023-04-14T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/nas/my-nas-2023-04014/","title":"个人/小团队数据中心媒体中心方案实施（pve lxc docker rclone）"},{"content":"我们都有一些核心的数据文件，一些可能是配置文件，一些可能是密码文件，或者可能是笔记软件的备份库。 这部分文件 小的话几M 大的话几个G，自己搭建私有盘或者nas是可以备份，但是这部分文件显然还是需要异地备份的。 而且需要多平台能用。\n肯定付费的话，肯定是选择 国内云厂商的s3储存，可以用rclone加密备份过去，速度也很理想。\n那么免费的怎么选？\n几个免费方案的对比和选 坚果云 看起来很美好，支持webdav 但是流量限制离谱，而且webdav限制也离谱，几乎是无法使用状态。即便是是付费版本速度也很垃圾，webdav照样限制，且不可以退款\n阿里云盘 百度云盘 等 可以用alist挂载，但是百度云盘限速离谱 阿里云盘在alist上也不够稳定经常存在掉盘，当我们需要操作这部分文件的时候，发现网盘挂载掉了，这真的还是挺痛苦的事情\ngoogle drive 、 dropbox 很稳定 ，免费容量够用，但是国内需要挂梯子。\n那么？ 1 koofr 免费10g 国内速度可以,Koofr网盘 在线管理你的Dropbox、Onedrive、Google Drive 文件，并且支持WebDAV 2 pcloud ，免费8G，国内速度也还凑合\npcloud 优点：\n全平台支持 linux ui支持和 cil支持 ！ rclone支持 国内不需要梯子就可以用 免费容量 8G 网站有繁体中文，英语不好的小伙伴不用担心 客户端有文件同步支持，就是尊贵的同步盘功能\n缺点： 免费容量 就8G，再想更大需要邀请人，如果只是备份核心文件的话，其实也够用了 国内访问速度一般般啦，Ping 218.80ms 下載 93.89Mbps (11.74 MB/s) 上傳 5.80Mbps (0.72 MB/s)小文件备份可以，或者自己科学上网哦 rclone 挂载说明 rclone新建的pcloud的时候 client_id 和 client_secret 留空即可，然后会打开网页让你授权\n最终配置文件格式参考\n1 2 3 4 5 6 7 8 9 10 [pcloud] type = pcloud hostname = api.pcloud.com token = {\u0026#34;access_token\u0026#34;:\u0026#34;XXXXXXXXXXXXXXXXXXXX\u0026#34;,\u0026#34;token_type\u0026#34;:\u0026#34;bearer\u0026#34;,\u0026#34;expiry\u0026#34;:\u0026#34;XXXXXXXXXXXX\u0026#34;} [pcloud-jiami] type = crypt remote = pcloud: filename_encryption = obfuscate directory_name_encryption = false password = XXXXXXXXXXXXXXXX 测试\n1 rclone lsf pcloud: --config /root/rclone-sh-cfg/rclone.conf 补充 cloudflare的r2 另外一个推荐是 cloudflare的r2 目前国内没有墙 正常可用，如果被墙了，也可以用自己域名绕过（gwf对cf的业务 目前基本都是墙域名，这几年很少墙ip） cloudflare的r2 r2 10G储存 每月百万次操作，其他操作限制千万次，单次操作限制 5G流量，流量免费\n","date":"2023-04-13T04:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/free-small-netdisk/","title":"国内使用 适合重要文件的备份同步"},{"content":"cloudreve 是一个真的不错的网盘程序，并且支持webdav哈，虽然ios客户端收费，但是支持webdav的客户端app太多了。不一定非要买。\n尤其是 cloudreve新版支持 onlyoffice后，我开始用他作为主力网盘使用。\n长期使用后发现 他的webui 还是，有一些不方便的地方。\n遗憾 文件预览 没有返回按钮 无法直接复制文档和目录的路径 多选功能要点右键 webdav的问题 在使用kopia 直连cloudreve的时候 出现405错误，暂时没有找到解决方法，临时的方案是通过rclone中转，尚不知有没有问题。\n这个问题比较严重，正在考虑了要不要切换到 filerun 或者 nextcloud\n优势 golang 轻量没啥依赖 高性能 webdav 账户独立 对onlyoffice的完美支持 文档齐全，tg群活跃，作者也经常在tg群出没 可以和nextcloud一样 保持原目录结构储存文件，迁移方便 为什么不选其他的 nextcloud 基于php 依赖太多了，而且 真的吃性能。但是真的很强大\nseafile 丑出天际，webui难用的要死，资源占用比nextcloud好，和cloudreve没法比\n其他 试用一圈 要么简陋 要么吃性能\n未来 期待作者继续优化webui吧 ，暂时还是用他做主力网盘。\n","date":"2023-04-11T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/cloudreve-bug/","title":"cloudreve 使用几个月的感受"},{"content":"先说结论，两个都长时间使用过，整体我倾向于思源，目前也是思源。\n202403 已经迁移到 outline\n共同点 都支持云同步和私有同步，这也是区别于 我来 语雀等不同的地方 都支持s3对象储存同步和webdav同步，并且都支持良好 都支持加密同步 都对坚果云支持不好，因为坚果云的限制实在是太狠了。 joplin会丢文档，思源会同步失败。 pc客户端 都是 Electron，吃内存吃硬盘，不过一般办公机没啥压力。思源另外有webapp功能。 joplin 的一些问题或者比思源缺点 代码片段没有 复制按钮，需要拿鼠标拖 没有webapp功能 思源有一个docker版本 可以浏览器部署 同步时间5分钟 不能做到保存即同步 同步目录中的md文件全部放一个目录里面，某些情况下会有问题，比如会导致同步服务器资源占用比较大 没有多标签管理功能，只能编辑同一个文档里面的？ 二级 文档只是一个目录 不是文档 ，不算缺点吧 没有内置思维导图流程图之类的支持，但是支持相关插件 全部导出压缩包功能，默认的文件名称 是 日 月 年，然后还没有时分秒。。 思源的一些问题或者对joplin的缺点 貌似没有分享功能 ，或许收费版有 网页剪辑功能，貌似也是收费版本才有 md文档的导出 导出来是压缩包，需要解压一次 ，很烦很烦这个！！！！ 无法全部导出为md ，需要逐个文档导出zip然后解压，joplin 这点要比思源好太多了 二级文档 本身是一个文档，不算缺点吧 内置思维导图流程图比较简陋，好像不支持相关插件，简单的图可以胜任,复杂一点的因使用率不高没有仔细研究。 文档移动的时候，全屏提示需要重建索引，这个比较烦。新版好像修复了，我一直用2.7.1 md文档的 编辑，虽然所见所得，但是没有选择显示源码的选项 有时候不太方便 joplin 比思源支持更多的云端，比如 OneDriv googledrive等，这个。。国内环境别想了 思源docker部署 1 2 3 mkdir /root/siyuan_date chown -R 1000:1000 /root/siyuan_date docker run -itd --restart=always --name=sy --hostname sy -v /root/siyuan_date:/root/siyuan_date -p 6806:6806 b3log/siyuan --workspace=/root/siyuan_date 更新命令\n综合 因为我主要是纯笔记，思源的一些小问题也有，但是没有影响到日常使用效率\n而且目前更新非常频繁，小问题或许以后会修复。只是我甚至懒得升级，一直在用docker 2.7.2 尤其是docker部署的 web app （功能齐全的），在新设备上 可以直接用，省去一堆麻烦。 配合edge 和 chrome 直接创建应用也舒服，ipad上 safari也可以直接创建\n网上有一个叫 完美公社 的一直在喷思源，感觉不是水军，只是一个智力发育不太好的病人，身残志坚带病上网 还是很佩服 。\n","date":"2023-04-11T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/siyuan-vs-joplin/","title":"国产思源笔记和joplin 对比使用感受"},{"content":"前言 之前一直用 nginxWebUI 来管理，甚至在给作者反馈一些问题后，作者置之不理后，自己二开了一个版本。\n但是nginxWebUI 因为不能手动编辑配置文件，使用起来还是略微麻烦。鼠标点来点去 很烦的哈。\n于是又拿起来Nginx-Proxy-Manager\n环境 pve lxc alpine 硬盘1G 内存 512M swap关闭 ip 10.1.1.51\n准备 1 2 3 4 5 6 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata rm -rf /var/cache/apk/* 安装 docker安装 一般情况推荐docker安装，但是我可能需要修改一些地方，所以手动装，官网有推荐一个第三方安装脚本。直接开开始\n1 wget --no-cache -qO - https://raw.githubusercontent.com/ej52/proxmox/main/lxc/nginx-proxy-manager/setup.sh | sh 结果在安装到python的地方出错，算了 还是docker 套娃吧。（关于特权容器 安装docker的问题请群内搜索，如果没啥必要就用非特权容器） 顺带装上sshd\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 apk add docker rc-update add docker boot service docker start docker version # cat /etc/docker/daemon.json cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt; EOF { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;http://hub-mirror.c.163.com\u0026#34;, \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34; ] } EOF service docker restart 1 2 3 4 apk add openssh rc-update add sshd boot sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config service sshd restart 创建 因为这个lxc就运行这一个，所以host模式\n1 2 3 4 docker run -itd \\ --name=nginx --hostname nginx \\ --net=host \\ jc21/nginx-proxy-manager:2.10.2 因为要修改\n基本配置 http://10.1.1.51:81\nEmail: admin@example.com\nPassword: changeme\n申请ssl证书的时候 zope 错误 1 2 docker exec -it nginx /bin/bash pip install zope 参考：https://github.com/NginxProxyManager/nginx-proxy-manager/issues/2440\n手动配置nginx配置文件 证书目录 1 2 certificate /etc/letsencrypt/live/npm-5/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/npm-5/privkey.pem; 如果要定制一些特殊的 npm-X 这个需要自己记住\n配置文件目录 1 2 /etc/nginx/conf.d/ /data/nginx/proxy_host/1.conf 怎么用 简单的代理 直接在web界面处理就行 需要定制的情况可以直接手写conf\n最周 其实 更加灵活的情况 还是 自己手写 后期如果有时间 打算自己做一个 类似功能。\n","date":"2023-04-10T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/lxc-nginx-proxy-mananger/","title":"aio主机上的http统一管理"},{"content":"场景 对象储存是一个简单的网络文件储存协议，Simple Storage Service 基于http。性能要超过webdav。\n因为云厂商的s3价格比较贵，免费的限制很多。所以在部分情况下，还是用自己的搭建的。\nminio golang写的 绿色环保 轻量 高性能 开源 免费\n环境准备 我这里是pve平台，采用lxc alpine搭建。创建以一个ct容器 id 9000 ，镜像选择alpine3.17 硬盘8g，另外直通一个物理盘进来，lxc直通教程请站内搜索。 ip 固定10.1.1.90 alpine 启动后，修改源 市区\n1 2 3 4 5 6 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata rm -rf /var/cache/apk/* 安装minio 1 2 3 apk add wget wget https://dl.min.io/server/minio/release/linux-amd64/minio #活跃软件更新比较频繁 chmod +x minio 启动测试 1 2 3 4 MINIO_ROOT_USER=admin MINIO_ROOT_PASSWORD=123456 ./minio server /mnt/data --console-address \u0026#34;:9001\u0026#34; # http://10.1.1.90:9001 # 用户名：admin # 密码： 123456 ctrl -c 结束\n配置证书 我的证书文件 均由 github action 托管，所以我这里直接拉取回来即可。详情\nminio要求 私钥为private.key，公共证书为public.crt。 配置自动更新证书的脚本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 cat \u0026gt; auto-updatessl-form-github.sh \u0026lt;\u0026lt; EOF cd /root rm ssl.zip* wget https://cdn.jsdelivr.net/gh/XXXX/sXXXX.zip #https://github.com/XXXXXXXXXXXXX.zip if [ ! -f \u0026#34;/root/ssl.zip\u0026#34; ]; then wget -O/dev/null -q https://api.day.app/你的key/SSL-update-err/[home-mino]?sound=birdsong\u0026amp;amp;isArchive=1 else rm -rf ssl 7z x ssl.zip -p密码 #密码和p之间不能有空格 supervisorctl restart minio nginx -S reload fi EOF echo \u0026#34;15 8 * * * sh /root/auto-updatessl-form-github.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root \u0026amp;\u0026amp; cat /etc/crontabs/root 启用证书 minio 支持tls通讯，但是理解起来有一点困难，本着能不用脑子的时候，绝对不用的前提。 我还是选 用nginx来搞定,下面操作依旧是基于alpine 其他linux系统注意一下 路径\naio环境也可以集中到 nginxWebUI处理\n1 2 3 4 apk add nginx rc-update add nginx boot mv /etc/nginx/http.d/default.conf /etc/nginx/http.d/default.conf-bak vi /etc/nginx/http.d/mino.conf 内容,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 server { server_name s3.jia.leiyanhui.com; #管理面板 listen 51443 ssl http2; ssl_certificate /root/ssl/XXXX.cer; ssl_certificate_key /root/ssl/XXX.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 51442; if ($scheme = http) { return 301 https://$host:51443$request_uri; } error_page 497 https://$host:51443; # Allow special characters in headers ignore_invalid_headers off; # Allow any size file to be uploaded. # Set to a value such as 1000m; to restrict file size to a specific value client_max_body_size 0; # Disable buffering proxy_buffering off; proxy_request_buffering off; location / { proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-NginX-Proxy true; # This is necessary to pass the correct IP to be hashed real_ip_header X-Real-IP; proxy_connect_timeout 300; # To support websocket proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; chunked_transfer_encoding off; proxy_pass http://10.1.1.90:9001/; # This uses the upstream directive definition to load balance and assumes a static Console port of 9001 } } server { server_name s3api.域名.com; #api listen 51443 ssl http2; ssl_certificate /root/ssl/XXXX.cer; ssl_certificate_key /root/ssl/XXX.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 51442; if ($scheme = http) { return 301 https://$host:51443$request_uri; } error_page 497 https://$host:51443; # Allow special characters in headers ignore_invalid_headers off; # Allow any size file to be uploaded. # Set to a value such as 1000m; to restrict file size to a specific value client_max_body_size 0; # Disable buffering proxy_buffering off; proxy_request_buffering off; location / { proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_connect_timeout 300; # Default is HTTP/1, keepalive is only enabled in HTTP/1.1 proxy_http_version 1.1; proxy_set_header Connection \u0026#34;\u0026#34;; chunked_transfer_encoding off; proxy_pass http://10.1.1.90:9000/; # This uses the upstream directive definition to load balance } } 上文参考：https://min.io/docs/minio/linux/integrations/setup-nginx-proxy-with-minio.html\n去掉了负载均衡部分\n测试ssl 1 2 service nginx start MINIO_ROOT_USER=admin MINIO_ROOT_PASSWORD=12345678 ./minio server /mnt/data --console-address \u0026#34;:9001\u0026#34; 写入服务 配置和环境变量 通常 都是使用 supervisorctl，使用也比较简单。但是今天准备尝试用 alpine的rc服务管理器来处理。 minio 已经不建议用 \u0026ndash;config-dir 来管理配置文件，而是把配置文件 放到了 目录的 .minio.sys\n1 ls /mnt/data/.minio.sys 我这里直接export 放到 start_pre ~~ 我这里直接改环境变量 echo \u0026ldquo;export MINIO_ROOT_USER=admin\u0026rdquo;\u0026raquo;/etc/profile\necho \u0026ldquo;export MINIO_ROOT_PASSWORD=123456\u0026rdquo;\u0026raquo;/etc/profile\nsource /etc/profile ~~\n添加系统服务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 vi /etc/init.d/minio ----------------------- #!/sbin/openrc-run name=\u0026#34;minio\u0026#34; command=\u0026#34;/root/minio \u0026#34; command_args=\u0026#34;server /mnt/data --console-address \u0026#39;:9001\u0026#39;\u0026#34; command_background=\u0026#34;yes\u0026#34; pidfile=\u0026#34;/run/$RC_SVCNAME.pid\u0026#34; start_pre() { export MINIO_ROOT_USER=admin export MINIO_ROOT_PASSWORD=12345678 } depend() { need localmount need logger } 此处有一个小坑 ，密码长度不能低于8位 用户名不能低于三位。 另外这个账户密码 是 面板 以及 mc的管理里面。面板可以禁用 mc的不确定，所以密码强度最好高一点\n1 2 3 4 chmod +x /etc/init.d/minio rc-service --list rc-update add minio boot service minio start ","date":"2023-04-09T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-minio/","title":"lxc搭建自己的对象储存s3 mino over ssl/tls"},{"content":"场景 有时候我们需要在md文件插入的文件中调整图片大小，或者其他一些调整，而其他md编辑器支持的的语法hugo不见得都支持\n于是自然而然想手写html来实现，从Hugo V.0.60开始，默认的markdown渲染器是Goldmark，而Goldmark 默认会关闭html的解析\n打开html解析功能 也就是添加一个配置项 markup.goldmark.renderer.unsafe: true\n如你的hugo 是用的 config.yaml文件，那么添加或者修改\n1 2 3 4 markup: goldmark: renderer: unsafe: true 对于config.toml文件，那么添加或者修改\n1 2 3 4 [markup] [markup.goldmark] [markup.goldmark.renderer] unsafe = true 最终，你就可以直接用\n1 \u0026lt;img src=\u0026#34;//XXXX.jpg\u0026#34; width=\u0026#34;300px\u0026#34; /\u0026gt; ","date":"2023-04-08T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/mdbook/hugo-img-html/","title":"makedown hugo 定义图片宽度以及直接解析html的方法"},{"content":"本地测试 获取hugo win环境 https://github.com/gohugoio/hugo/releases 下载 hugo_extended_0.111.3_windows-amd64.zip 解压到 D：/hugo\n1 2 3 hugo new site D:\\hugo\\site1 cp hugo.exe D:\\hugo\\site1\\hugo.exe cd D:\\hugo\\site1 选一个模板 我这里用 https://github.com/alex-shpak/hugo-book 这个，因为支持左右两侧导航 更适合文档类的。\n1 2 3 4 5 git init git submodule add https://github.com/alex-shpak/hugo-book themes/hugo-book :: 从 \\themes\\hugo-book\\exampleSite 复制一个文件_index.md 到 \\content\\_index.md hugo server --minify --theme hugo-book :: 打开测试 通用型优化 准备把这个目录 所谓所有文档类型的模板。需要处理一点 新建一个 文件\u0026quot; .gitignore \u0026quot; 把 hugo.exe 添加进去\n推送到私有git 测试没有问题后，文件cp到 linux开发机\n1 2 3 4 5 6 7 8 rm -rf .git rm -rf .gitmodules git init git checkout -b main git add . git commit -m \u0026#34;first commit\u0026#34; git remote add origin https://gitXXXXX git push -u origin main 私有git配置和github的同步 在gitea 的仓库的设置里面，Git 远程仓库链接 添加github的 地址 用户名 和 有action权限的密码\n这个github仓库为私有仓库，另外新建一个公开仓库作为page 公开仓库设置 sshkey 私有仓库设置 secrets 这个不在多说。\n新建actione文件 .github\\workflows\\hugo-to-pub.yml 内容如下，其中 secrets.FOR_PAGE_SSHKEY 是 公开仓库的ssh 私key\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 name: hugo-to-pub on: push: branches: - main jobs: hugo-to-pub: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 with: fetch-depth: 0 - name: 安装 hugo run: | mkdir hugo curl -sSL https://github.com/gohugoio/hugo/releases/download/v0.111.3/hugo_extended_0.111.3_linux-amd64.tar.gz | tar -xz --directory=./hugo echo `pwd`/hugo \u0026gt;\u0026gt; $GITHUB_PATH - name: 编译 hugo run: | echo \u0026#34;编译\u0026#34; hugo --theme=hugo-book --baseUrl=\u0026#34;https://doc.XXXX/\u0026#34; - name: 处理独立域名的绑定 run: | echo \u0026#34;doc.XXXX\u0026#34; \u0026gt;\u0026gt; ./public/CNAME - name: 处理ssh权限 env: FOR_PAGE_SSHKEY: ${{ secrets.FOR_PAGE_SSHKEY }} run: | mkdir -p ~/.ssh/ echo \u0026#34;$FOR_PAGE_SSHKEY\u0026#34; \u0026gt; ~/.ssh/id_rsa chmod 600 ~/.ssh/id_rsa ssh-keyscan github.com \u0026gt;\u0026gt; ~/.ssh/known_hosts - name: 初始化git并推送到github公开库 run: | cd public git config --global init.defaultBranch main echo \u0026#34;init\u0026#34; git init git checkout -b main git add -A echo \u0026#34;config\u0026#34; git config user.name \u0026#34;joyanhui\u0026#34; git config user.email \u0026#34;joyanhui@qq.com\u0026#34; echo \u0026#34;commit\u0026#34; git commit -m \u0026#34;自动生成 $GITHUB_SHA \u0026#34; echo \u0026#34;推送到公开库\u0026#34; git remote add origin git@github.com:joyanhui/XXXXX.git git push -u origin main -f -q 最后配置dns和cdn 国内解析到国内cdn回源到github\n国外解析到github.io 完毕\n补充 在codeserver 里面开发 hugo的话，注意调试的时候的ip绑定\n1 2 3 4 5 6 7 8 9 10 11 12 echo \u0026#34;http://10.1.1.99:1313/\u0026#34; ./hugo server --theme hugo-book --bind=10.1.1.99 test(){ ./hugo server --minify --theme hugo-book --baseURL=http://yoursite.org/ \\ --port=131 \\ --appendPort=false \\ --bind=87.245.198.50 } ","date":"2023-04-08T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/mdbook/hugo-book/","title":"hugo 搭建一个多语言帮助网页 并托管到github和国内cdn"},{"content":"场景 既然是nas 就需要做异地备份。\n备份目的地 一般备份到网盘或对象储存比较划算。 如果数据量比较大，还是要备份到免费的网盘，比如阿里云盘 1-2T 123pan 2T，还有od gd等容量更大的选择。 用alist挂载后，只要不滥用，账号不会被封。\n数据量不大话，尤其核心数据，可以备份到对象储存，比如 alioss也不贵 七牛还有免费的10G kodo\n部分敏感数据需要加密储存。为了防止网盘删文件，尤其是小姐姐们，也需要加密储存。\n部分数据 需要按照版本储存。\n部分数据 需要按照原目录储存，方便在网盘可以直接访问。比如小姐姐们 可以直接存到pikpak\n关于duplicati 也是我第一个使用的备份程序\nduplicati 是.net写的，可以装到pc 也可以装到服务器，支持linux(mono) ，也有docker版本\n支持加密储存，支持增量，支持版本储存。\n使用中发现的问题：\n不支持按照原始目录储存方式 备份过程中会占用很大的本地硬盘空间 虽然他是基于rclone的，但不算是一个轻量化工具 关于rclone 可以用sysnc方式实现同步，可以不占用本地磁盘，但不支持的\n没有图形界面 不支持按照版本保存 restic 支持常见的储存模式，也支持rclone挂载的储存。也就是alist挂载的网盘也没问题。 rclone是文件同步，也就是和大部分网盘软件一样，来源文件是什么样的，目的文件就是什么样的。restic是面向文件的专业备份工具，其在备份文件前将会先进行加密再传输，而且是增量备份，只备份变化的部分。\nrclone并不记录文件版本，无法回溯特定时间点上的文件。restic会对每次备份生成一个快照，记录该时间点文件变化和存储结构，可以随时回溯到特定时间点的文件。\n最终的考量 考虑到 我要备份的文件主要有以下几种\n文档类 修改频繁 代码类 gitea+github处理，不需要nas备份 minio 思源笔记 修改频繁 影音视频 只需要同步 不合规的影音视频 需要单独同步备份到 境外网盘 或者加密同步到境内网盘 私人相册视频 加密同步到境内网盘 restic 不太熟悉需要时间看文档踩坑，最终决定 使用rclone+压缩包增量的方式，更底层 更轻量！ 最终 单独一个lxc（pve）平台运行rclone，配置文件中挂载了包括alist 私有minio 阿里云对象储存 在内的我常用的储存\n并把部分储存挂载到本地， 然后用crontab 定时处理 ，全手动管理\n关于网盘的选择 简单的说，核心文件 还是加密放到 收费的对象储存 。\n无关紧要的文件 ，放到哪家网盘都一样。\n免费的网盘的话，依旧是阿里云盘比较良心，而且官方已提供api不滥用的话是完全合规的。\n我这里也只有一个 904G 的账号，不存太多电影视频的话 足够用了。\n百度网盘上传速度其实也还好，下载速度嘛没办法，如果需要取回的时候，开个会员就好。\n123pan虽然有2T容量，但是实际测试 限制还是有一些。单个目录下文件数量不可以超过99个。\n准备工作 宿主系统选择 alpine 够轻量，创建一个lxc 10009，去掉 非特权容器的勾号，选择 alpine镜像，磁盘空间，选择 默认 8G 。因为部分tar需要临时缓存\n创建完成后 在选项 功能里面 勾选上 嵌套 NFS SMB fuse\n修改源和时区 1 2 3 4 5 6 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata rm -rf /var/cache/apk/* 安装ssh 这个不是必须的 不装了，要装的话\n1 2 3 4 apk add openssh rc-update add sshd boot sed -i \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g\u0026#39; /etc/ssh/sshd_config service sshd restart 准备所需软件 我考虑了一下，还是选择用 7zip作为增量备份工具，而不是xz ，因为不想学。。。\n1 2 3 4 5 6 apk add p7zip apk add wget wget -c https://downloads.rclone.org/v1.62.2/rclone-v1.62.2-linux-amd64.zip 7z x rclone*.zip cp rclone-*/rclone /usr/bin/ #复制到bin目录 rm -rf rclone* 准备rclone配置文件 可以直接用\n1 rclone config --config /root/rclone.conf 配置，也可以手写，配置文件可以存到自己的笔记里面。不再多说\n这里要 rclone 挂载了 自己的nas，我这里用webdav挂载的 cloudreve 然后挂载 alist 阿里云 对象储存等\n最终rclone内的节点如下 1 2 3 4 5 6 7 8 Name Type ==== ==== alist webdav #公网 alist-local webdav #内网 cloudreve webdav #公网 cloudreve-local webdav #内网 oss-qd s3 #公网 oss-sh s3 #公网 *-local的是用内网链接的\n测试 1 2 3 4 5 6 rclone lsd alist:/ --config /root/rclone.conf rclone lsd alist-local:/ --config /root/rclone.conf rclone lsd cloudreve:/ --config /root/rclone.conf rclone lsd cloudreve-local:/ --config /root/rclone.conf --no-check-certificate #忽略证书检查 rclone lsd minio:/note --config /root/rclone.conf rclone lsd minio-local:/note --config /root/rclone.conf 关于minio的一点补充 Minio目前并不支持所有的S3特性。特别是它不支持MD5校验（ETag）或者是元数据。这就表示Rclone不能通过MD5SUMs进行校验或者保存最后修改时间。不过你可以用Rclone的—size-only flag。\n1 2 3 4 5 rclone lsd minio: #查看储存桶 rclone mkdir minio:bucket #创建一个储存桶 rclone --size-only copy /path/to/files minio:bucket #复制 rclone --size-only --dry-run sync /path/to/files minio:bucket #测试同步 rclone --size-only sync /path/to/files minio:bucket #标准同步 ","date":"2023-04-03T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/auto-back/","title":"nas的自动备份工具的选择  Restic  rclone duplicati等"},{"content":"场景 在内网挂载webdav的时候，直接用内网ip+端口挂载。但是对应端口上只提供了公网的ssl\n解决方法 通过chatgpt搜索的 修改rclone.conf文件 在对应节点上添加一行 insecure_skip_verify = true 实际测试没效果 最终解决方案 在命令后面 添加 \u0026ndash;no-check-certificate\n测试 1 2 rclone lsd cloudreve-local:/ --config /root/rclone.conf rclone lsd cloudreve-local:/ --config /root/rclone.conf --no-check-certificate 补充 其实这个使用场景下，可以通过修改hosts文件来避免证书错误的问题，又可以绕过外网。\n参考：https://github.com/rclone/rclone/issues/168\n","date":"2023-04-03T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/rclone-skip-ssl/","title":"rclone跳过证书检查"},{"content":"rclone 是一个非常强大的 网络文件系统辅助工具！ 支持并不限与以下功能\n挂载 对象储存 挂载 多数正常的网盘（非国内阉割盘） sync同步 文件复制 删除 ls 临时获取url link等 加密同步 下面整理记录常用命令\n安装 golang写的 直接解压即可 ，或者用linux自带的包管理器\n1 2 3 4 wget https://downloads.rclone.org/rclone-current-linux-amd64.zip unzip rclone-current-linux-amd64.zip cp rclone-*-linux-amd64/rclone /mnt/sda1/rclone \u0026amp;\u0026amp; rm -rf rclone-* chown root:root /mnt/sda1/rclone \u0026amp;\u0026amp; chmod 755 /mnt/sda1/rclone 配置文件 向导模式 1 2 /mnt/sda1/rclone config # 默认路径在 ~/.config/rclone/rclone.conf /mnt/sda1/rclone config --config /mnt/sda1/rclone.conf 手动编辑 例子\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cat \u0026gt;/mnt/sda1/rclone.conf \u0026lt;\u0026lt; EOF [cloudreve] type = webdav url = https://cloudreve地址:5213/dav vendor = nextcloud user = 密码 pass = 加密后的密码 [oss-sh] type = s3 provider = Alibaba access_key_id = XXXXX secret_access_key = XXXXXX endpoint = oss-cn-shanghai.aliyuncs.com acl = private storage_class = STANDARD bucket_acl = private EOF 备份和恢复 1 2 3 rclone copy oss-qd:demo-docker-img-bak/emqx.5.0.17.tar.gz /demo/docker-img-bak/emqx.5.0.17.tar.gz --config /demo/etc/rclone.conf rclone sync oss-qd:demo-serv-emqx-bak/ /demo/emqx --config /demo/etc/rclone.conf rclone sync /demo/emqx oss-qd:demo-serv-emqx-bak/ --config /demo/etc/rclone.conf sysnc 和 copy 区别 等于 系统 sysnc 和 cp的区别\n获取临时链接 仅限部分储存可以用。有一些储存肯定是不可以的用的。\n1 /root/opt/rclone link --expire 1m oss-qd:demo-serv-bak/opt_serv1/main.txt 检查 查询 ls 列出文件\n1 2 3 4 5 rclone ls 列出路径中的对象及其大小和路径。 rclone lsd 列出路径中的所有目录/容器/桶。 rclone lsf 列出 remote:path 格式的目录和对象以供解析。 rclone lsjson 以 JSON 格式列出路径中的目录和对象。 rclone lsl 列出路径中的对象及其修改时间、大小和路径。 例如\n1 rclone lsd cloudreve:/ --config /demo/etc/rclone.conf 挂载命令 1 /mnt/sda1/rclone mount cloudreve:/ /mnt/dav --config /mnt/sda1/rclone.conf 如果提示 fusermount3 找不到，应该是缺少 fuse3 这个包 apk add fuse3\n其他常用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 rclone copy - 复制 rclone move - 移动，如果要在移动后删除空源目录，请加上 --delete-empty-src-dirs 参数 rclone sync - 同步：将源目录同步到目标目录，只更改目标目录。 rclone size - 查看网盘文件占用大小。 rclone delete - 删除路径下的文件内容。 rclone purge - 删除路径及其所有文件内容。 rclone mkdir - 创建目录。 rclone rmdir - 删除目录。 rclone rmdirs - 删除指定灵境下的空目录。如果加上 --leave-root 参数，则不会删除根目录。 rclone check - 检查源和目的地址数据是否匹配。 rclone ls - 列出指定路径下的所有的文件以及文件大小和路径。 rclone lsl - 比上面多一个显示上传时间。 rclone lsd 列出指定路径下的目录 rclone lsf - 列出指定路径下的目录和文 常用参数 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 -n = --dry-run - 测试运行，用来查看 rclone 在实际运行中会进行哪些操作。 -P = --progress - 显示实时传输进度，500mS 刷新一次，否则默认 1 分钟刷新一次。 --cache-chunk-size SizeSuffi - 块的大小，默认5M，理论上是越大上传速度越快，同时占用内存也越多。如果设置得太大，可能会导致进程中断。 --cache-chunk-total-size SizeSuffix - 块可以在本地磁盘上占用的总大小，默认10G。 --transfers=N - 并行文件数，默认为4。如果你cpu性能差，建议调低，但太低可能会影响多个文档同时传输的速度。 --config string - 指定配置文件路径，string为配置文件路径。 --ignore-errors - 跳过错误。比如 OneDrive 在传了某些特殊文件后会提示Failed to copy: failed to open source object: malwareDetected: Malware detected，这会导致后续的传输任务被终止掉，此时就可以加上这个参数跳过错误。但需要注意 RCLONE 的退出状态码不会为0。 --no-check-certificate 忽略证书检查 --allow-other：允许非当前 rclone 用户外其它用户进行访问 --attr-timeout 5m：文件属性缓存，（大小，修改时间等）的时间。如果 VPS 配置比较低，建议适当提高这个值，避免过多内核交互，降低资源占用。 -vfs-cache-mode full：开启 VFS 文件缓存，可减少 rclone 与 API 交互，同时可提高文件读写效率 --vfs-cache-max-age 24h：VFS 文件缓存时间，这里设置 24 小时，如果文件很少更改，建议设置更长时间 --vfs-cache-max-size 10G：VFS文件缓存上限大小，建议不超过当前空余磁盘的50% vfs-read-chunk-size-limit 100M：分块读取大小，这里设置的是100M，可提高文件读的效率，比如1G的文件，大致分为10个块进行读取，但与此同时API请求次数也会增多 --buffer-size 100M：内存缓存，如果您内存比较小，可降低此值，如果内存比较大，可适当提高 --daemon：指后台方式运行 --low-level-retries：该参数为传输文档没速度的时候重试次数，没速度的时候，单个会自动睡眠10ms起，然后再重试，不行，再睡眠更长一段时间，再重试，这样可以稍微加快文档上传进度。 –transfers 4 表示文件并行数量 –max-size 3G 传输的文件最大3G –min-size 3G 传输的文件最小3G –checkers 64 并行检查64个文件 关于读取部分的一些 参数\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 --dir-cache-time 12h --vfs-read-chunk-size 32M --vfs-read-chunk-size-limit 1G 1. --vfs-cache-mode off - 所有文件操作全部直接进行 - 失败无法自动重试 2. --vfs-cache-mode minimal - 读写模式打开的文件将会首先缓冲到磁盘 - 其他模式打开文件直接进行操作 - 失败无法自动重试 3. --vfs-cache-mode writes - 读写模式打开的文件将会首先缓冲到磁盘 - 只写模式打开的文件将会首先缓冲到磁盘 - 只读取模式打开的文件将会直接进行操作 - 支持自动重试 4. --vfs-cache-mode full - 所有文件操作全部缓存 - 读取会下载整个文件 日志 rclone 有 4 个级别的日志记录，ERROR，NOTICE，INFO 和 DEBUG。默认情况下，rclone 将生成 ERROR 和 NOTICE 级别消息。 -q - rclone将仅生成 ERROR 消息。 -v - rclone将生成 ERROR，NOTICE 和 INFO 消息，推荐此项。 -vv - rclone 将生成 ERROR，NOTICE，INFO和 DEBUG 消息。 \u0026ndash;log-level LEVEL - 标志控制日志级别。 输出日志到文件 使用 \u0026ndash;log-file=FILE 选项，rclone 会将 Error，Info 和 Debug 消息以及标准错误重定向到 FILE，这里的 FILE 是你指定的日志文件路径。 另一种方法是使用系统的指向命令，比如： rclone sync -v Onedrive:/DRIVEX Gdrive:/DRIVEX \u0026gt; \u0026ldquo;~/DRIVEX.log\u0026rdquo; 2\u0026gt;\u0026amp;1\n文件过滤 \u0026ndash;exclude - 排除文件或目录。 \u0026ndash;include - 包含文件或目录。 \u0026ndash;filter - 文件过滤规则，相当于上面两个选项的其它使用方式。包含规则以 + 开头，排除规则以 - 开头。 文件类型过滤 比如 \u0026ndash;exclude \u0026ldquo;*.bak\u0026rdquo;、\u0026ndash;filter \u0026ldquo;- .bak\u0026rdquo;，排除所有 bak 文件。也可以写作。 比如 \u0026ndash;include \u0026ldquo;.{png,jpg}\u0026quot;、\u0026ndash;filter \u0026ldquo;+ *.{png,jpg}\u0026quot;，包含所有 png 和 jpg 文件，排除其他文件。 \u0026ndash;delete-excluded 删除排除的文件。需配合过滤参数使用，否则无效。\n目录过滤 目录过滤需要在目录名称后面加上 /，否则会被当做文件进行匹配。以 / 开头只会匹配根目录（指定目录下），否则匹配所目录。这同样适用于文件。 \u0026ndash;exclude \u0026ldquo;.git/\u0026rdquo; 排除所有目录下的.git 目录。 \u0026ndash;exclude \u0026ldquo;/.git/\u0026rdquo; 只排除根目录下的.git 目录。 \u0026ndash;exclude \u0026ldquo;{Video,Software}/\u0026rdquo; 排除所有目录下的 Video 和 Software 目录。 \u0026ndash;exclude \u0026ldquo;/{Video,Software}/\u0026rdquo; 只排除根目录下的 Video 和 Software 目录。 \u0026ndash;include \u0026ldquo;/{Video,Software}/**\u0026rdquo; 仅包含根目录下的 Video 和 Software 目录的所有内容。\n文件大小过滤 默认大小单位为 kBytes ，但可以使用 k ，M 或 G 后缀。 \u0026ndash;min-size 过滤小于指定大小的文件。比如 \u0026ndash;min-size 50 表示不会传输小于 50k 的文件。 \u0026ndash;max-size 过滤大于指定大小的文件。比如 \u0026ndash;max-size 1G 表示不会传输大于 1G 的文件。 TIPS: 博主在实际使用中发现大小过滤两个选项不能同时使用。 过滤规则文件 \u0026ndash;filter-from \u0026lt;规则文件\u0026gt; 从文件添加包含 / 排除规则。比如 \u0026ndash;filter-from filter-file.txt。 过滤规则文件示例：\nsecret*.jpg *.jpg *.png file2.avi /dir/Trash/** /dir/** rclone创建webdav服务器 实例\n1 2 3 4 nohup rclone serve webdav gd:media --etag-hash MD5 --addr 127.0.0.1:8080 --user whackeralpha --pass Bush993475Xjt5621 --dir-cache-time 300s --cache-dir /root/webdav_cache --vfs-cache-mode writes -v \u0026amp; nohup rclone serve webdav d:backup/appdata/KeePass --etag-hash MD5 --addr 127.0.0.1:8080 --user alpabete --pass C6keP2sr_pi8 --cache-dir /root/webdav_cache --vfs-cache-mode writes -v \u0026amp; nohup rclone serve webdav gd:media --addr 127.0.0.1:8080 --user whackeralpha --pass Bush993475Xjt5621 --cache-dir /root/webdav_cache \u0026amp; nohup rclone serve http g:media --addr 127.0.0.1:8080 --user whackeralpha --pass Bush993475Xjt5621 --cache-dir /root/http_cache -v \u0026amp; 这里只举例比较常用和简单的一些过滤用法，更复杂和高端的用法可以查看官方文档。\n环境变量 rclone 中的每个选项都可以通过环境变量设置。环境变量的名称可以通过长选项名称进行转换，删除 \u0026ndash; 前缀，更改 - 为_，大写并添加前缀 RCLONE_。环境变量的优先级会低于命令行选项，即通过命令行追加相应的选项时会覆盖环境变量设定的值。 比如设置最小上传大小 \u0026ndash;min-size 50，使用环境变量是 RCLONE_MIN_SIZE=50。当环境变量设置后，在命令行中使用 \u0026ndash;min-size 100，那么此时环境变量的值就会被覆盖。 常用环境变量 RCLONE_CONFIG - 自定义配置文件路径 RCLONE_CONFIG_PASS - 若 rclone 进行了加密设置，把此环境变量设置为密码，可自动解密配置文件。 RCLONE_RETRIES - 上传失败重试次数，默认 3 次 RCLONE_RETRIES_SLEEP - 上传失败重试等待时间，默认禁用，单位s、m、h分别代表秒、分钟、小时。 CLONE_TRANSFERS - 并行上传文件数。 RCLONE_CACHE_CHUNK_SIZE - 块的大小，默认5M，理论上是越大上传速度越快，同时占用内存也越多。如果设置得太大，可能会导致进程中断。 RCLONE_CACHE_CHUNK_TOTAL_SIZE - 块可以在本地磁盘上占用的总大小，默认10G。 RCLONE_IGNORE_ERRORS=true - 跳过错误\n其他 rclone 忽略证书错误 https://dev.leiyanhui.com/all-in-one/rclone-skip-ssl/\nrclone webui 可以实现 文件浏览 挂载等操作\n1 rclone rcd --rc-web-gui --rc-addr :80 --config /root/rclone.conf rclone 跨平台浏览工具 Rclone Browser\n需要 指定rclone 和 rclone.conf 的位置\nwin下需要 winfsp 和 sshfs\n有几个小bug，\nsftp浏览和挂载不能离开home目录。 win下系统托盘 的退出功能无效 暗黑模式标题栏有点小问题 已经停止更新很久，但是免费开源体积也不大。\n","date":"2023-04-02T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/rclone-all/","title":"rclone 常用命令 挂载 ls 临时url等"},{"content":"场景 主力手机 iPhone，安卓手机不随身带。 手机号码多个，微信多个。\n痛点 因为ios上微信多开比较麻烦，虽然有ios开发者账号，但是更新和封号 都麻烦很多。\n需要解决 多手机号码 一个iPhone一个手机接听 一个手机可以接收其他手机的微信消息 部分只有app的软件 电脑上使用 安卓app开发调试 硬件方案 安卓备用机一台（红米4x）放家里，pve下 usb直通 或者wifi连接到 开发机。\n软件解决方案 远程控制手机：自建rustdesk中转，解决外出远程控制安卓手机的问题。（也可以用scrcpy-ios 过于麻烦） pc机上直接使用手机：scrcpy 消息转发，安卓手机消息，转发给主力手机 相关代码和工具 adb wifi 连接 先usb连接到pc，打开手机的usb调试等，pc安装scrcpy，可以正常使用usb投屏的情况下。\n1 2 3 D: cd D:\\soft\\scrcpy-win64-v2.0 adb tcpip 5555 然后断开usb，路由器里面配置dhcp静态ip给安卓手机 例如 10.1.1.14\n创建 _startWifi.bat\n1 2 3 4 D: cd D:\\soft\\scrcpy-win64-v2.0 adb connect 10.1.1.14:5555 scrcpy.exe wifi连接 略微卡顿，看视频会更差一些。可惜我手上的安卓数据线 只有一条，还要做别的用。暂时凑合一下。\n隐藏cmd.vbs 1 CreateObject(\u0026#34;WScript.Shell\u0026#34;).Run \u0026#34;cmd /c D:\\soft\\scrcpy-win64-v2.0\\_startWifi.bat\u0026#34;,0 安卓消息转发 用 通知滤盒 这个app，规则里面 规则 增强，webhook 输入 企业微信/钉钉机器人的webhook 或 Bark(ios) 或 各种微信公众号消息通知的webhook 例： wxpusher pushplus Server酱 coolpush 等 通知滤盒 正版不贵，破解版 网上也有。\n通知滤盒 -\u0026gt; Bark 默认通知地址 感谢Bark 作者\n1 https://api.day.app/XXXXXXXXXXXXXXXXXXXX/{android.title}/{filterbox.field.APP_NAME}-{android.text}?sound=birdsong\u0026amp;isArchive=1 其他 单iPhone手机多号码方案 1阿里小号 2移动 无忧行 3 其他：安卓手机短信转发 手机互转等\nscrcpy自动黑屏 安卓手机设置 usb调试选项里面 设置充电时候不熄屏幕，然后拆掉屏幕。拆掉屏幕不方便，不然还是忍一下吧。。\n或者屏幕亮度调到最低 也行\n电池问题 从保护板后面剪掉电池，接4.2v dc电源 + 一个电解电容+限流电阻。或者 干脆一个大一点的电解电容+一个限流电阻 完事。\nscrcpy 常用快捷键 我这里mod键 是 alt\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 MOD + f\t切换到全屏 / 取消全屏 MOD + 左\t往左旋转屏幕 MOD + 右\t往右旋转屏幕 MOD + g\t重置屏幕尺寸到 像素比1:1（一般都是变得硕大） MOD + w\t重置屏幕尺寸消除黑色边框 MOD + h\t等同于 home 键 MOD + b\t等同于 返回 键 MOD + s\t等同于切换app操作 MOD + m\t对应解锁屏的按键，如果是锁屏的话，仅点亮屏幕 MOD + 下\t减少音量 MOD + 上\t增加音量 MOD + p\t等同于按电源键 右键点击\t等同于点亮屏幕 MOD + o\t把设备屏幕关闭但保持镜像同步 MOD + Shift + o\t点亮设备屏幕 MOD + r\t旋转屏幕（测试好像不好用，不知道是不是快捷键冲突） MOD + n\t打开消息面板 MOD + n + n\t双击n，打开顶部设置栏 MOD + shift + n\t收起面板 MOD + c\t同步复制到电脑剪贴板 MOD + x\t同步剪贴到电脑剪贴板 MOD + v\t同步粘贴电脑剪贴板的内容（pc-\u0026gt;手机或手机-\u0026gt;pc均可） MOD + i\t启用或禁用FPS计数 Ctrl + 点击和移动\t相当于多指捏合动作 安装APK\t拖拽APK文件到窗口 推送文件到手机\t拖拽非APK文件到窗口 升级方案 骁龙835 150-350元左右 300一下的基本不能插卡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 MOTOz2f lgv30 夏普r（shv39） 小白推荐：米6 mix2 三星s8 努比亚z17 索尼xz1/xzp[doge] 坚果Pro2 夏普rc（701sh） 中兴blade a7 诺基亚x5 三星s6/s6edge/edge+ 魅族Pro5 红米note3（这玩意一定要买全网通晓龙650的，楼主之前收了部双网，直接卡死[辣眼睛]） 乐视2 小米Max 红米note4x 360n4s晓龙版（楼主收过，刷个MIUI很香哒[嗑瓜子]） 中国移动n2 https://www.bilibili.com/video/BV11L411n7zi/ 参考\n","date":"2023-03-30T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/new/scrcpy-ios/","title":"自己搭建云手机，投屏，消息通知给iPhone 等"},{"content":"golang 编写的可执行程序， 几乎不依赖环境，可以随意迁移。\n作为服务来运行，可以注册到 rc 或者 systemd 或者 使用supervisord 等第三方程序守护 等等。。\n我这里 使用docker来 处理，因为宿主机本身已经安装了docker 所有服务都docker运行，但是因为golang 程序很多，每一个小程序都维护一个docker镜像 反而会增加工作量。\n这里简单来说一下。\ngolang的编译 我这里用alpine镜像 在编译golang的时候 注意添加 CGO_ENABLED=0，Makefile如下\n1 2 3 4 5 6 .PHONY: buildandrun BIN_FILE=XXXXXX buildandrun: @CGO_ENABLED=0 go build -o \u0026#34;${BIN_FILE}\u0026#34; ${BIN_FILE}.go #./\u0026#34;${BIN_FILE}\u0026#34; 如果使用centos debian之类的镜像不需要额外处理\n上传编译后的可执行文件 1 2 3 4 5 apt install sshpass ssh root@10.1.1.111 # 先登录一次 然后推出 make sshpass -p 密码 scp -P 22 ./可执行文件root@10.1.1.111:/fish/opt/serv-bin/ sshpass -p 密码 scp -P 22 ./*.json root@10.1.1.111:/fish/opt/serv-bin/ 创建docker 在服务器上运行\n1 2 3 4 tempName=fish-send-code docker run -itd --name ${tempName} --hostname ${tempName} --network host --privileged=true --restart=always \\ -v /fish/opt/serv-bin/:/fish/opt/serv-bin/ \\ alpine:3.17.2 /fish/opt/serv-bin/${tempName} 查看日志\n1 docker logs -f ${tempName} ","date":"2023-03-23T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/docker/","title":"docker 运行golang的简单方法，免维护镜像"},{"content":"速度 遍历速度 Set = list \u0026gt; hash\n插入删除速度 Hash = set \u0026gt; list\n随机访问速度 hash = list \u0026gt; set\n重复 list 有序可重复,存入顺序和取出顺序完全相同 set 无序不可重复,存入的顺序和取出的顺序不一定一致 会自动去重 zset 有序 hash key不可重复，value可以重复\n","date":"2023-03-17T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/redis-hash-set-list/","title":"redis hash list set zset 的对比和使用"},{"content":"项目一开始选择了uniapp来做，因为js语法 加上vue。并且是oneman项目\n但是没想到uniapp的坑如此之多\n每一个坑 基本上都要 查搜索搜索引擎，或者 自己重写一个替代， 一个坑 折腾几个小时甚至一整天。\n因为没打算做小程序平台，一度打算 切换到futter上。\n考虑到学习成本 又数次放弃。。。\n还有 hbuilderx 这个编辑器，就是王婆卖瓜 ，难用的很\n还有各种月经bug 这个版本修复，下个版本 不指定什么适合 又出现。。。\n虽然是国产的，但是官网 文档 压根不全，很多问题的解决方案官网文档里面并未提供。\n你去论坛问，官网的技术，可能都是机器人。。。。不是手册里面提到的问题，你也问不到，手册里面有的问题，也犯不上去问。。。bug或者非常规的问题你问几个月也不见得问到答案。\n官方QQ 群里面，全部是死人 和新手。 每天只有新手发问，偶尔冒一个半拉新手出来解答，或者私聊你收费帮你处理（水平烂，付费并不能搞定）。 官方的技术管理员 就是尸体号。。。\n还有 对 他自己家的unicloud的深度绑定，你不用 他一直提示，甚至 报 err！！！ ，你用 不是今天到期 就是明天整改,后天维护。\nuniapp 这家公司，属于 那种吹牛无边无际的\u0026hellip; 官网明目张胆的 写 很多上线项目稳定使用他家的各种bug何种问题的 unicloud！ 不知道那个正规项目脑子被驴踢了。。。\nide里面 加广告这事 就不说多恶心的，如果你产品真好用，可以忍。但是你..\n更多 真的不想列举。。。\n其实 单纯的 h5 也非常不建议用 uniapp开发，看起来简单上手快，实际上 坑一个接一个。。。。\n如果你弄app 或者 小程序 或者 真的多端。。。你会发现，每天都在踩坑的路上。。。。\n有人说，我就做一个简单的功能。 也不是不可以，但是要看要做多简单的。。。简单到一个Hello, world ,那自然没问题。。。\n略微复杂一点点的。。。。必定 ，100% 有坑等着你。。。。\n比如 简单的注册登录，注册的时候 表单验证，用自带的 form.validate()。 没问题对吧? 然后你会发现，在低分屏幕设备上，错误提示消息显示不全！ 然后我们自然而然的想到，重写一下css，然后你又会发现 ，你写到页面里面 压根不生效！ 然后 慢慢去啃他uni-forms-item组件吧。。 你技术还过得去，等弄好 1个多小时过去了。\n诸如此类的小坑 ，你做完一个app 你会发现 几十个 ！ 有的坑可能需要你自己写原生代码，甚至有的坑 无法解决！\nuniapp就是这么神奇的东西\n","date":"2023-03-06T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/uniapp-bug/","title":"uniapp的bug和坑真的是太多太多了"},{"content":"前言 不想花钱，为什么不用黑群晖。原因\n1、首先我这个是家用为主，兼顾小团队工作使用。 主要的需求很明确。\n2、遭遇过黑群晖突然无法引导的问题，人在异地无法处理。 3、所谓\n宿主机环境 宿主机器 pve 7.3-4 cpu：i8850h qnct 6核12线程 内存32G nvme 硬盘1块 机械硬盘 N块 pve 使用 ventoy启动，核显开启了gvt-g\n替代 对标群晖\nlxc alpine 开 smb sftp webdav 用 cloudreve开webdav rclone挂载后开smb 和sftp lxc alpine Aria2 + nginx+AriaNG 下载工具 lxc alpine docker 跑 duplicati 核心数据异地备份 rclone +alist网盘同步 lxc alpine docker+ 思源在线md 同步到minio lxc alpine 跑minio 私有s3对象储存 lxc alpine 跑 gogs + SQLite3 私有git 独立lxc 跑 nginx+acme.sh 处理一切证书。后改为 github action 视频 plex、emby、jellyfin tinyMediaManager 音乐 webdav+ nPlayer AVplayer AcePlayer ES文件浏览器 在线office cloudreve + onlyoffice 比群晖 兼容性更好！ 人脸识别相册 无解 我这里无需求。实在要用 只能群晖挂载smb后用别人破解的so文件搞。 在线 golang 开发 docker debian golang + codeserver + chrome 完整解决方案 查看下面的文章之前，你如果对lxc和alpine不熟悉，最好先看本文后面的lxc和alpine的内容。尤其是特权容器和docker 以及 目录挂载的一些权限问题。 2023-02-17 后使用的方案为：全lxc 每个lxc运行1-多个服务 分开管理\ngithub actione自动处理证书 并加密 本地自动获取前面的证书 lxc 10000 alpine 运行 cloudereve + rclone（挂载cr的webdav） + smb + sftp lxc 10001 alpine 运行 alist 挂网盘 lxc 10002 alpine 运行 aria2+ariaNG 和 cloudereve 直通同一个硬盘 处理离线下载 lxc 10003 alpine 运行 docker版duplicati 同步 以及 加密备份文件 到 云盘 lxc 10010 alpine 运行 nginx + docker版onlyoffice 处理在线文档 众多端口号和域名自己记不住的问题：gitcode.net 开一个私有库，创建一个md文件 就完事，不需要再去折腾导航站。、 未完待续 lxc基本使用 ct镜像 全部选择alpine3.17， alpine的优点不用说了，小巧干净！无可替代！\n国内下载地址： https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/alpine-3.17-default_20221129_amd64.tar.xz\n因为是小团队使用，所以全部使用特权容器 启动。\n创建一个lxc CT CT ID 输入：10080 名称 nas-core 输入root密码 去掉 无特权容器 勾号。模板选择 alpine3.17，磁盘1G，cpu 12核心，内存1024，交换分区0，网络开dhcp，稍后在路由器中绑定静态分配到 10.1.1.80，其他默认，先不启动。选项里面，勾选上 开机自动启动，功能里面勾选上嵌套。\n这个lxc 如果不需要运行docker所以不需要额外处理。只需要挂机械硬盘进去， 硬盘只有一个分区已经格式化为brtfs。在pve下没有挂载，节点在/dev/sda1\n1 2 pct set 10080 -mp0 /dev/sda1,mp=/mnt/sda1 #把 第一个硬盘的第一个分区挂到 lxc的/mnt/sda1 下 pct start 10080 #启动 alpine系统准备 配置alpine的源和时区 1 2 3 4 5 6 7 8 9 10 # 配置源和时区 alpine内运行 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata rm -rf /var/cache/apk/* # vim替换为nano apk add nano apk del vim \u0026amp;\u0026amp; ln -s /usr/bin/nano /usr/bin/vim \u0026amp;\u0026amp; rm -rf /usr/bin/vi \u0026amp;\u0026amp; ln -s /usr/bin/nano /usr/bin/vi 特权lxc运行docker alpine特权容器安装运行docker\n","date":"2023-02-27T18:55:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas/","title":"pve下使用lxc 直通硬盘搭建 nas 服务  全面替代群晖 freenas OMV 等 总览"},{"content":"特点 干净整洁，不集成任何插件，但是 可以随意安装科学插件，可以任意重新打包备份 导出到本地等等。\n是最新最新的源构建！ 版本: 22.03.3 内核版本：肯定是爱快的内核。\n尤其适合不支持的虚拟化的主机安装爱快的情况下 使用openwrt 作为旁路由 接替 网关 dns 提供 科学学习 以及去广告等服务。\n支持 docker的其他环境 也可以用。\n爱快后台可以直接点几下 就安装。\n一键开机 ipv6 默认主题：argon Web服务器 : nginx\n使用教程 仅供赞助用户，赞助 20 元，邮件 joyanhui@qq.com 索取。邮件标题注明 爱快 docker运行 openwrt\n另外接受定制，可以 提供 lxc docker镜像 VMware镜像 以及物理机镜像，\n","date":"2023-02-25T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/ikuai/","title":"一个适合爱快docker运行的openwrt"},{"content":"alpine 轻量，适合很多场景使用。但是目前除了很多人用他来做docker基础镜像之外，还是小众了一些。所以很多软件包没有提供编译好的安装包。 而alpine的官方仓库，一直控制在10000以内，所以\u0026hellip;\n比如 阿里云的 ossfs 腾讯的 cosfs 都不行，连s3fs 也没有。。。\n自己编译？？？ 要装一堆依赖，，，（其实 可以docker里面编译完了删除就行）不符合 我们需求.. 还是用rclone吧。 可以用国产的alist cloudreve，我这个场景更适合rclone，因为我只是同步备份数据，不做本地储存用。\n安装获取 1 2 3 4 apk add unzip wget wget https://downloads.rclone.org/v1.61.1/rclone-v1.61.1-linux-amd64.zip unzip rclone-v1.61.1-linux-amd64.zip mv rclone-v1.61.1-linux-amd64/rclone . rclone默认的配置文件 是在 ~/.config/rclone/rclone.conf ，你可以用命令 查看 rclone config paths 我这里手动指定 ./rclone config --config /root/rclone.conf 是进入交互引导模式 帮你创建储存点。简单点\n1 2 3 4 5 6 7 8 9 10 11 cat \u0026gt; /root/rclone.conf \u0026lt;\u0026lt; EOF [oss] type = s3 provider = Alibaba access_key_id = 你的access_key_id secret_access_key = 你的secret_access_key endpoint = oss-cn-地区.aliyuncs.com acl = public-read storage_class = STANDARD bucket_acl = public-read EOF 测试\n1 2 3 4 5 #./rclone ls oss:你的存储桶名称 --config /root/rclone.conf #列出所有文件 ./rclone lsd oss:你的存储桶名称 --config /root/rclone.conf #列出指定的目录的子目录 ./rclone lsf oss:你的存储桶名称 --config /root/rclone.conf #列出文件个目录的文件和目录 ./rclone copy /root/rclone.conf oss:你的存储桶名称/ --config /root/rclone.conf # 复制一个文件 ./rclone lsf oss:你的存储桶名称 --config /root/rclone.conf 腾讯cos 和 亚马逊s3 同理\nrclone 还内置 删除 sync 等操作 ，具体 ./rcone -h 查看\n挂载到本地 1 2 apk add fuse # 必须的，如果你在容器里面，宿主和容器 都要有fuse权限 rclone mount cos:/你的存储桶名称/子目录或者不需要 /mnt/本地挂载路径 --no-check-certificate --allow-other --allow-non-empty 还有其他一些更丰富的参数 这里不说了\n开机自动挂载？ rc-local 处理就好了。\n","date":"2023-02-23T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/alpine-s3/","title":"alpine挂载 阿里云oss 腾讯cos 亚马逊s3 等对象储存方法"},{"content":"场景： 核心数据 主从同步 持久化\n非核心 大并发 可以接受丢失但是尽量不丢失的，主从同步 ，从机持久化\n日志类数据 需要转存 但是可以接受丢失 不开主从 不持久化\n最简单的方法 还是创建多个实例来处理。下面记录过程。\nredis 准备配置文件 需要三个实例，分别 是 ①核心数据 需要同步容灾 需要持久化 需要oss转存 ②临时数据 处理一些 limt 验证码等 不持久 不同步 ③设备日志临时存储 限制大小可丢一部分\n1 2 3 4 wget http://repo.huaweicloud.com/redis/redis-7.0.8.tar.gz #菊花家 官网https://github.com/redis/redis/archive/7.0.8.tar.gz tar -zxvf redis-7.0.8.tar.gz cp ./redis-7.0.8/redis.conf /root/redis/redis-template.conf #备份一份 rm -rf redis-7.0.8* 修改配置 持久化 ，只有main节点需要 并且是混合持久化 即：1秒aof一次 根据规则再压缩，默认配置文件 是关闭 rdb的但是开了 appendfsync everysec 1秒一次 以及 aof-use-rdb-preamble ，增长比例 auto-aof-rewrite-percentage 为100 文件大小 auto-aof-rewrite-min-size 64mb ，no-appendfsync-on-rewrite 默认为 no 就是 主线程和和子线程冲突 的时候，等待 会偶发堵塞但是不会丢数据。cache的 也默认开持久化，暂时不关闭，no-appendfsync-on-rewrite 改为yes 就是冲突的时候用硬盘缓存解决。 默认持久化文件：dump.rdb appendonly.aof\n1 2 3 4 5 6 7 8 9 10 11 12 13 export redisName=db rm -rf /data/redis/${main}* \u0026amp;\u0026amp; cp /root/redis/redis-template.conf /root/redis/${redisName}.conf sed -i \u0026#34;s@# requirepass foobared@requirepass cx6hYJcCpZybXT112233@g\u0026#34; /root/redis/${redisName}.conf #修改密码 sed -i \u0026#34;s@appendonly no@appendonly yes@g\u0026#34; /root/redis/${redisName}.conf # appendonly 打开混合持久化 sed -i \u0026#34;s@bind 127.0.0.1 -::1@#bind 127.0.0.1 -::1@g\u0026#34; /root/redis/${redisName}.conf # ip #启动 新版docker的redis 需要手动指定配置文件 docker stop ${redisName} \u0026amp;\u0026amp; docker rm ${redisName} docker run -itd --name ${redisName} --hostname ${redisName} -p 6381:6379 \\ -v /root/redis/${redisName}.conf:/redis.conf -v /root/redis/date-${redisName}:/data --restart=always \\ redis:7.0.8-alpine3.17 redis-server /redis.conf docker logs -f -t --since=\u0026#34;2020-02-08\u0026#34; --tail=50 ${redisName} #其他 sed -i \u0026#34;s@no-appendfsync-on-rewrite no@no-appendfsync-on-rewrite yes@g\u0026#34; /root/redis/${redisName}.conf #避开堵塞但是可能会丢数据 \u0026lt;不建议\u0026gt; ram\n1 2 3 4 5 6 7 8 9 10 export redisName=ram rm -rf /data/redis/${main}* \u0026amp;\u0026amp; cp /root/redis/redis-template.conf /root/redis/${redisName}.conf sed -i \u0026#34;s@# requirepass foobared@requirepass cx6hYJcCpZybXT112233@g\u0026#34; /root/redis/${redisName}.conf #修改密码 sed -i \u0026#34;s@bind 127.0.0.1 -::1@#bind 127.0.0.1 -::1@g\u0026#34; /root/redis/${redisName}.conf # ip sed -i \u0026#39;s@# save \u0026#34;\u0026#34;@save \u0026#34;\u0026#34;@g\u0026#39; /root/redis/${redisName}.conf # 取消持久化 docker stop ${redisName} \u0026amp;\u0026amp; docker rm ${redisName} docker run -itd --name ${redisName} --hostname ${redisName} -p 6382:6379 \\ -v /root/redis/${redisName}.conf:/redis.conf --restart=always \\ redis:7.0.8-alpine3.17 redis-server /redis.conf devlog\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 export redisName=devlog rm -rf /data/redis/${redisName}* \u0026amp;\u0026amp; cp /root/redis/redis-template.conf /root/redis/${redisName}.conf sed -i \u0026#34;s@# requirepass foobared@requirepass cx6hYJcCpZybXT112233@g\u0026#34; /root/redis/${redisName}.conf #修改密码 sed -i \u0026#34;s@bind 127.0.0.1 -::1@#bind 127.0.0.1 -::1@g\u0026#34; /root/redis/${redisName}.conf # ip sed -i \u0026#39;s@# save \u0026#34;\u0026#34;@save \u0026#34;\u0026#34;@g\u0026#39; /root/redis/${redisName}.conf # 取消持久化 # 执行 ram的命令创建docker之前 再 限制一下大小 sed -i \u0026#34;s@# maxmemory \u0026lt;bytes\u0026gt;@maxmemory 268435456@g\u0026#34; /root/redis/${redisName}.conf #限制 256M sed -i \u0026#34;s@# maxmemory \u0026lt;bytes\u0026gt;@maxmemory 536870912@g\u0026#34; /root/redis/${redisName}.conf #限制 512M sed -i \u0026#34;s@# maxmemory \u0026lt;bytes\u0026gt;@maxmemory 1073741824@g\u0026#34; /root/redis/${redisName}.conf #限制 1G docker stop ${redisName} \u0026amp;\u0026amp; docker rm ${redisName} docker run -itd --name ${redisName} --hostname ${redisName} -p 6383:6379 \\ -v /root/redis/${redisName}.conf:/redis.conf --restart=always \\ redis:7.0.8-alpine3.17 redis-server /redis.conf redis命令查看限制：info memory 最后 创建一个 slave-test 作为从机测试\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 export redisName=slave-test rm -rf /data/redis/${redisName}* \u0026amp;\u0026amp; cp /root/redis/redis-template.conf /root/redis/${redisName}.conf sed -i \u0026#34;s@# requirepass foobared@requirepass cx6hYJcCpZybXT112233@g\u0026#34; /root/redis/${redisName}.conf #修改密码 sed -i \u0026#34;s@bind 127.0.0.1 -::1@#bind 127.0.0.1 -::1@g\u0026#34; /root/redis/${redisName}.conf # ip sed -i \u0026#39;s@# save \u0026#34;\u0026#34;@save \u0026#34;\u0026#34;@g\u0026#39; /root/redis/${redisName}.conf # 取消持久化 sed -i \u0026#39;s@# masterauth \u0026lt;master-password\u0026gt;@masterauth cx6hYJcCpZybXT112233@g\u0026#39; /root/redis/${redisName}.conf # 设置主的密码 docker stop ${redisName} \u0026amp;\u0026amp; docker rm ${redisName} docker run -itd --name ${redisName} --hostname ${redisName} -p 6389:6379 \\ -v /root/redis/${redisName}.conf:/redis.conf --restart=always \\ redis:7.0.8-alpine3.17 redis-server /redis.conf docker restart slave-test # 切换为 从机 docker exec -it slave-test redis-cli -h localhost -p 6379 -a cx6hYJcCpZybXT112233 SLAVEOF 10.1.1.111 6381 # 切换为 主机 docker exec -it slave-test redis-cli -h localhost -p 6379 -a cx6hYJcCpZybXT112233 slaveof NO ONE 从机 从主机 同步的数据，如果主机是持久化，从级没有开启，但是丛机 会持久化这部分数据。 从机可以从0数据 或者有一部分数据 或者 有其他数据 开始切换为从机模式 从机 的数据 在开启 主从 后 会丢失，从机进入从模式后 无法写入数据 在简单的逻辑下，可以用shell脚本 免登录处理。\n强制关闭 程序后，再进行切换操作。\n","date":"2023-02-23T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/redis-more/","title":"同一台机器搭建多个redis实例 并测试主从同步"},{"content":"连续几天 上传速度只有可怜的 几百K\n","date":"2023-02-20T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/aliyundocker-limit/","title":"阿里云docker私有镜像服务貌似限速了"},{"content":"lxc容器运行的 alpine 里面单独装一个 mariadb。\n1 2 3 4 5 6 7 8 9 10 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk search mysql apk search mariadb # mariadb-server-utils-10.6.10-r0 apk add mariadb mariadb-client rc-update add mariadb default touch /run/openrc/softlevel /etc/init.d/mariadb setup rc-service mariadb start mysql -u root -p 如果要装 mysql5.7 需要官网去下载 二进制。 或者 套docker\n1 2 3 Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 3 Server version: 10.6.10-MariaDB MariaDB Server 查看具体版本 记住\n1 2 # mysql -V mysql Ver 15.1 Distrib 10.6.10-MariaDB, for Linux (x86_64) using readline 5.1 修改本地用户密码 1 2 mysql -u root -p mysql\u0026gt; ALTER USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;你的密码\u0026#39;; 打开远程访问 远程用户密码 1 2 3 4 5 mysql -u root -p mysql\u0026gt; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;你的密码\u0026#39;; mysql\u0026gt; use mysql; mysql\u0026gt; SELECT host,user,password from user; mysql\u0026gt; flush privileges; 配置文件 将 vi /etc/my.cnf.d/mariadb-server.cnf 中bind-address = XXXX 加# 注释掉 或者改为 bind-address = 0.0.0.0\n小坑 此处有一个小坑，alpine的 mariadb默认skip-networking 就是不监听tcp，需要一起去掉注释\n重启 1 rc-service mariadb restart 进阶 清理 localhost 的root用户。可选操作，不太建议 1 2 3 4 5 6 mysql -u root -p mysql\u0026gt; DROP USER \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39;; mysql\u0026gt; use mysql; mysql\u0026gt; SELECT host,user,password from user; mysql\u0026gt; flush privileges; mysql\u0026gt; exit; 修改端口 1 2 vi /etc/my.cnf # 在mysqlld节点下增加一行 port=端口号 ","date":"2023-02-18T19:13:10+08:00","permalink":"https://dev.leiyanhui.com/docker/alpine-mysql-err/","title":"alpine中安装mysql/mariadb的一个小坑 无法远程访问的问题"},{"content":"单独一个lxc运行 aria2，系统alpine 并挂载 硬盘进来\n1 pct set 10002 -mp0 /dev/sda1,mp=/mnt/sda1 这个硬盘 要求运行 cloudreve的lxc容器也可以访问。不然cloudreve没法移动文件进去。\n安装aria2 用p3terx的最后版本，需要科学环境\n1 2 3 apk add bash wget ca-certificates curl wget -N git.io/aria2.sh \u0026amp;\u0026amp; chmod +x aria2.sh ./aria2.sh # 安装 安装完成后 在aria2.sh 配置修改一下,主要修改下载目录。 安装完成后 会提示 RPC 密钥 还有NG的地址。\nBT下载功能 需要开 51413端口，另外aria2是不支持 ed2k协议的。冷门bt下载，还是用开迅雷去吧。其他都不好用。\n开机自动启动,因为p3terx的脚本不支持alpine，需要处理一下，我这里为了省事直接用supervisor\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 apk add supervisor rc-update add supervisord boot service supervisord restart echo_supervisord_conf \u0026gt; /etc/supervisord.conf echo \u0026#34;[include]\u0026#34;\u0026gt;\u0026gt;/etc/supervisord.conf echo \u0026#34;files = /root/supervisor/*.ini\u0026#34;\u0026gt;\u0026gt;/etc/supervisord.conf mkdir /root/supervisor/ #supervisor aria2 配置 cat \u0026gt; /root/supervisor/aria2.ini \u0026lt;\u0026lt; EOF [program:aria2c] directory=/root/.aria2c/ command=/usr/local/bin/aria2c --conf-path=/root/.aria2c/aria2.conf autostart=true autorestart=true ;stderr_logfile=/tmp/aria2c.err ;stdout_logfile=/tmp/aria2c.log environment=CODENATION_ENV=prod EOF # 其他指令 supervisord -c /etc/supervisord.conf supervisorctl start aria2c supervisorctl stop aria2c supervisorctl status aria2c AriaNg 可视化的Aria 管理界面，用nginx跑吧\n1 2 3 4 5 6 7 8 9 apk add nginx rm -rf /var/cache/apk/* rc-update add nginx boot service nginx start cd ~ mkdir ng-html \u0026amp;\u0026amp; cd ng-html wget https://github.com/mayswind/AriaNg/releases/download/1.3.2/AriaNg-1.3.2.zip unzip AriaNg* rm AriaNg* 配置nginx ，还有修改一下 nginx的运行用户 或者 目录所有者\n1 2 3 4 5 6 7 8 9 10 mv /etc/nginx/http.d/default.conf /etc/nginx/http.d/default.conf-bak cat \u0026gt; /etc/nginx/http.d/ariang.conf \u0026lt;\u0026lt; EOF server { listen 80 ; server_name _ ; root /root/ng-html;# 站点根目录 index index.html; } EOF nginx -s reload 测试 http://10.1.1.82/#!/settings/rpc/set/ws/10.1.1.82/6800/jsonrpc/XXXXXXXXXXX\n如果你的 ariaNG 要外网使用，再去处理一下ssl和端口映射就好。\n","date":"2023-02-17T18:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-cloudreve-aria2/","title":"lxc alpine下使用cloudreve替代nginx搭建webdav 之aria2离线下载 "},{"content":"之前在github 下用两个库实现了自动更新 地址 ：https://dev.leiyanhui.com/web/auto-get-ssl\n这里记录下 使用的时候自动部署的方法 以alpine下为例\n1 2 3 4 5 apk add nano wget p7zip rc-update add crond boot service crond start cd /root nano auto-updatessl-form-github.sh 内容\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 cat \u0026gt; auto-updatessl-form-github.sh \u0026lt;\u0026lt; EOF cd /root rm ssl.zip* wget https://cdn.jsdelivr.net/gh/XXXX/sXXXX.zip #https://github.com/XXXXXXXXXXXXX.zip if [ ! -f \u0026#34;/root/ssl.zip\u0026#34; ]; then wget -O/dev/null -q https://api.day.app/你的key/SSL-update-err/[home-mino]?sound=birdsong\u0026amp;amp;isArchive=1 else rm -rf ssl 7z x ssl.zip -p密码 #密码和p之间不能有空格 supervisorctl restart minio #根据情况修改 nginx -s reload fi EOF echo \u0026#34;15 8 * * * sh /root/auto-updatessl-form-github.sh\u0026#34; \u0026gt;\u0026gt; /etc/crontabs/root \u0026amp;\u0026amp; cat /etc/crontabs/root 添加计划任务 crontab -e 每天7点50\n1 50 7 * * * sh /root/auto-updatessl-form-github.sh ","date":"2023-02-16T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/auto-updatessl-form-github/","title":"从自己的github上自动获取证书并部署到本地"},{"content":"pve下 可以把lxc当作应用容器使用，所以系统肯定选择只有3m的alpinelinux\n不用docker配置，优点体积小，缺点略微繁琐一丢。\n创建alpine lxc容器 pve下操作，特权容器，创建完成后，选项功能 里面 最好勾选 嵌套和 fuse，磁盘大小0.3G。\n1 2 3 4 5 6 7 8 9 10 # 配置源和时区 alpine内运行 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata rm -rf /var/cache/apk/* # vim替换为nano apk add nano apk del vim \u0026amp;\u0026amp; ln -s /usr/bin/nano /usr/bin/vim \u0026amp;\u0026amp; rm -rf /usr/bin/vi \u0026amp;\u0026amp; ln -s /usr/bin/nano /usr/bin/vi 安装alist 官网一键安装命令 不支持alpine，手动装，alpine 没有 glibc，我用musl版本\n1 2 3 4 5 6 akp add wget cd ~ wget https://github.com/alist-org/alist/releases/download/v3.11.0/alist-linux-musl-amd64.tar.gz tar -zxvf alist-*.tar.gz \u0026amp;\u0026amp; rm alist-*.tar.gz chmod +x alist ./alist server # 运行程序 查看有没有异常 ctrl +c 停止\n如果要更新alist，上面命令简单修改一下即可\n1 2 ./alist admin # 获得管理员用户名和密码信息 kT0voJRZ ./alist server \u0026amp; # 临时后台运行，然后去后台配置 配置完成后 killall alist alpine下配置alist守护进程 可以用 rc.local , 我这里使用supervisor 更简单一些\n1 2 3 apk add supervisor nano rc-update add supervisord boot service supervisord restart 初始化配置文件\n1 2 echo_supervisord_conf \u0026gt; /etc/supervisord.conf nano /etc/supervisord.conf 编辑或者添加文件末尾两行\n1 2 [include] files = /etc/supervisord_conf/*.ini 1 2 mkdir -p /etc/supervisord_conf/ nano /etc/supervisord_conf/alist.ini 根据自己的情况配置 注意这个文件是ini格式的\n1 2 3 4 5 6 7 8 [program:alist] directory=/root/ command=/root/alist server autostart=true autorestart=true ;stderr_logfile=/tmp/alist.err ;stdout_logfile=/tmp/alist.log environment=CODENATION_ENV=prod 管理\n1 2 3 4 5 supervisord -c /etc/supervisord.conf supervisorctl start alist supervisorctl stop alist supervisorctl status alist reboot # 重启后检查alist是否已经ok 配置外网ssl 获取证书 获取你的域名证书。我这里是 部署到github上的acme.sh，直接拉回来解压。你可以自签，也可以单独装acmesh 甚至宝塔 自己随意就好。\n1 2 3 wget https://github.com/joyanhui/ssl/raw/main/ssl.zip apk add p7zip 7z x ssl.zip -p密码 #密码和p字母之间没有空格 配置nginx alpine下nginx的配置文件 是在 http.d 目录下哈\n1 2 3 4 apk add nginx rc-update add nginx rc-service nginx start nginx -s reload # 重载 1 2 mv /etc/nginx/http.d/default.conf /etc/nginx/http.d/default.conf-bak #非必须 nano /etc/nginx/http.d/alist.conf 内容\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 server { listen 端口号码 ssl; server_name 你的域名; ssl_certificate /root/ssl/ddns.leiyanhui.com.cer; # fullchain.pem ssl_certificate_key /root/ssl/ddns.leiyanhui.com.key; #privkey.pem ssl_verify_client off; server_tokens off; root /usr/share/nginx/html; location / { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_pass http://127.0.0.1:5244; # the max size of file to upload client_max_body_size 20000m; } } 结束 重载nginx，路由器设置好ip绑定和端口转发 完毕\nwindows下 挂载后，尝试复制大文件正常。\n","date":"2023-02-15T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-alist/","title":"pve下lxc运行alpine + alist + ssl 非docker方式"},{"content":"pve自带的archlinux的 CT模板 会延迟几个月，archlinux因为是滚动更新，直接使用会无法正常更新。 在 梦中大佬指点搞定\n准备ct模板 选择 archlinux-base_20221111-1_amd64.tar.zst 。现在是2023 02 15，直接更新会出错。\n修改源 1 nano /etc/pacman.d/mirrorlist 在最前面添加一行，后面的不要删除。\n1 Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch 开始更新 更新\n1 pacman -Syy 继续\n1 pacman -Su 出错，按照提示\n1 pacman-key --init 继续\n1 2 3 pacman-key --populate #Reload the default keys from the (given) keyrings pacman -S archlinux-keyring pacman -Su archlinux-keyring 搞定，可以继续装其他软件了。\n总结 首先要 初始化key后需要 然后 从密钥环中重新加载默认密钥，最后先单独装keyring 再更新\n","date":"2023-02-15T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-archlinux/","title":"pve下lxc运行archlinux"},{"content":"安装arch并更新到最新版 参考之前文章\n准备工作 安装yay sudo 添加新用户\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 nano /etc/pacman.conf ---- [archlinuxcn] Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch ---- pacman -Sy archlinuxcn-keyring pacman -S yay pacman -S doas echo \u0026#34;permit persist :wheel\u0026#34; \u0026gt; /etc/doas.conf chown -c root:root /etc/doas.conf chmod -c 0400 /etc/doas.conf doas -C /etc/doas.conf \u0026amp;\u0026amp; echo \u0026#34;config ok\u0026#34; || echo \u0026#34;config error\u0026#34; useradd -m -G wheel -s /bin/bash leiyanhui passwd leiyanhui 选择桌面和输入法 我这里选 xorg kde 了 如果安装i3 参考 https://dev.leiyanhui.com/arch/xinitc-xrdp/\nxorg 1 pacman -S xorg-server 显示管理器 我这里用 xinitrc\n1 2 pacman -S xorg-xinit cp /etc/X11/xinit/xinitrc /etc/X11/xinit/xinitrc-bak 1 2 3 4 5 6 7 nano /etc/X11/xinit/xinitrc #注释掉下面几行 这几乎是启动一个时钟 几个 xterm，实际上会导致xrdp无法登录 #twm \u0026amp; #xclock -geometry 50x50-1+1 \u0026amp; #xterm -geometry 80x50+494+51 \u0026amp; #xterm -geometry 80x20+494-0 \u0026amp; #exec xterm -geometry 80x66+0+0 -name login 安装kde 我这里直接装 plasma 整个包，然后卸载开发包 。 因为plasma-desktop 其实不全，后期弄起来麻烦。\n1 2 3 pacman -S plasma pacman -Rscn plasma-sdk pacman -Rscn `pacman -Qqs kde games` 网络管理 lxc下没必要\n1 systemctl enable NetworkManager xrdp 处理 注意科学环境\n1 yay -S xrdp 声音 1 pacman -S pulseaudio 其他参考 https://dev.leiyanhui.com/c/arch-install-xrdp/\n","date":"2023-02-15T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-arch-desktop-xrdp/","title":"pve下lxc运行archlinux桌面环境 包括输入法 远程桌面 3d加速等"},{"content":"考虑到使用方便，把证书加密后 发送到公开仓库。部署的时候，只需要定时从公开仓库wget下来即可使用。\n后续会考虑自动推送到cdn，因为cdn那边是生产环境，暂时还是不用免费证书。\ngithub自动申请 域名证书，加密推送到公开库以及自动部署等 自动申请 准备 1、两个github仓库 1个私有库 存放 自动脚本，另外一个公开仓库存放加密的证书压缩包 公开就好，可以开pages 或者套cdn 默认分支为main\n2、申请域名证书的域名dns服务器的api，我这里都是用dnspods为例\n3、一对ssh公私钥。公钥匙要配置到 公开仓库 的Deploy keys，私玥部署到 私有库的Secret\n4、一个16位以上足够复杂的密码（zip包可以穷举，所以务必要高强度的密码）\n5、少许linux基础知识\n配置加密信息 配置公私玥 公开库的在仓库的 Settings 中Deploy keys添加 填写 ssh公钥，勾选上 Allow write access 名字随意\n私钥部署到私有库的Secret 名称为 MYGITHUBKEY\ndns api 在仓库的 Settings 中添加 Secret，创建 DNSAPI 填写上文获取的 API KEY 格式如下，具体格式 查看 acme.sh 的文档\n1 2 3 4 export DP_Id=\u0026#34;214234234\u0026#34; export DP_Key=\u0026#34;XXXXXXXXXX\u0026#34; export CF_Token=\u0026#34;XXXXXXXXXXXXXX\u0026#34; export CF_Account_ID=\u0026#34;XXXXXXXXXXXX\u0026#34; 压缩包密码 再创建一个 ZIPPASSWORD 输入压缩包解压密码，一定必须要超级高强度的密码。比如 16位以上 包含数字字母特殊符号汉字\n配置github actions 在私有仓库中创建 ​ .github/workflows/AutoACME.yml ​​ 配置文件,参考复制粘贴如下.\ncron 是 UTC时间 每月26日下午17点7分 自动执行 完整内容参考 ：https://github.com/joyanhui/file.leiyanhui.com/blob/main/github-actions/%E8%87%AA%E5%8A%A8%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6%E5%B9%B6%E6%8E%A8%E9%80%81%E5%88%B0%E5%85%AC%E5%BC%80%E4%BB%93%E5%BA%93.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 name: Auto ACME on: workflow_dispatch: schedule: - cron: \u0026#34;7 17 20 * *\u0026#34; watch: types: [started] env: ACME: /home/runner/.acme.sh/acme.sh PUBHUB: /你的用户名/仓库地址 DNSAPI: ${{ secrets.DNSAPI }} ZIPPASSWORD: ${{ secrets.ZIPPASSWORD }} MYGITHUBKEY: ${{ secrets.MYGITHUBKEY }} EMAIL: 你的邮箱地址@qq.com TZ: Asia/Shanghai jobs: build: runs-on: ubuntu-latest if: github.event.repository.owner.id == github.event.sender.id steps: - name: Checkout uses: actions/checkout@v2 with: ref: main github_token: ${{ secrets.GITHUB_TOKEN }} - name: 安装和初始化acme.sh run: | curl https://get.acme.sh | sh echo \u0026#34;$DNSAPI\u0026#34; \u0026gt;\u0026gt; /home/runner/.acme.sh/account.conf $ACME --register-account -m $EMAIL - name: 开始获取证书 run: | mkdir -p ./ssl #如果要处理多个域名，复制后面三行即可 默认使用zerossl的证书 其他参数参考acme.sh文档 mydomian=你的域名.com $ACME --issue --dns dns_dp -d ${mydomian} -d *.${mydomian} $ACME --installcert -d ${mydomian} --key-file ./ssl/${mydomian}.key --fullchain-file ./ssl/${mydomian}.cer - name: 带密码打包证书 run: | zip -r acme.zip /home/runner/.acme.sh -P $ZIPPASSWORD zip -r ssl.zip ssl -P $ZIPPASSWORD - name: 提交加密后的证书到公开库 run: | mkdir -p ~/.ssh/ echo \u0026#34;$MYGITHUBKEY\u0026#34; \u0026gt; ~/.ssh/id_rsa chmod 600 ~/.ssh/id_rsa ssh-keyscan github.com \u0026gt;\u0026gt; ~/.ssh/known_hosts rm -rf .git* \u0026amp;\u0026amp; rm -rf README.md echo \u0026#34;处理公开库的readme文件\u0026#34; wget https://raw.githubusercontent.com/$PUBHUB/main/README.md echo -e \u0026#34;\\n证书最后更新： $(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;)\u0026#34;\u0026gt;\u0026gt;README.md git init git config --global user.name \u0026#34;githubactions bot\u0026#34; git config --global user.email \u0026#34;$ACME\u0026#34; git add ./ssl.zip ./README.md ./acme.zip git commit -m \u0026#34;证书自动更新 on $(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;)\u0026#34; git remote add origin git@github.com:$PUBHUB.git git remote -v git push origin master:main -f -q ‍\n‍\n客户端使用 wget 后 7z -P 密码 ，然后 nginx -s reload即可\n自动更新 参考 ：https://dev.leiyanhui.com/web/auto-updatessl-form-github\n自动部署到国内cdn 后续处理\n","date":"2023-02-14T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/auto-get-ssl/","title":"私有仓库GitHub actions运行acme.sh 并加密推送到公开仓库"},{"content":"接上一篇，在pve lxc下以cloudreve为核心搭建了nas https://dev.leiyanhui.com/pve/lxc-nas-core-cloudreve\n下面需要配置 在线编辑功能，考虑到alpine的依赖问题，单独配置一个lxc容器来运行office部分\n特权容器 安装docker 方法：查看这里\noffice的选择，肯定是选大名鼎鼎的LibreOffice，另外Office Online Server微软的 ，在部分授权情况下可以免费使用，但是需要window server主机。另外一个OnlyOffice 不知为什么我这里没成功\n安装配置docker 基本配置和安装docker https://dev.leiyanhui.com/pve/alpine-docker\n运行docker 因为Office Online Server收费，OnlyOffice的兼容性也没看到，并且我这里配置只能预览无法编辑，所以选择LibreOffice.\n尝试使用 Collabora Online (LibreOffice Online) 建议用ubuntu22.04运行，直接安装 不使用docker。 创建一个lxc 至少需要2.8G 建议 5G。 内存要1G+\n修改源 那些不用说了。\n1 2 3 4 5 6 7 8 9 10 11 12 export customer_hash=Example-413539ece39485afc35b4a469adfde0a279d2fd2 cd /usr/share/keyrings wget https://collaboraoffice.com/downloads/gpg/collaboraonline-release-keyring.gpg cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/apt/sources.list.d/collaboraonline.sources Types: deb URIs:https://www.collaboraoffice.com/repos/CollaboraOnline/22.05/customer-ubuntu2204-$customer_hash Suites: ./ Signed-By: /usr/share/keyrings/collaboraonline-release-keyring.gpg EOF apt update apt install coolwsd collabora-online-brand 1 2 3 4 5 6 7 8 docker stop code \u0026amp;\u0026amp; docker rm code docker run -t -d -p 9980:9980 --name code --hostname code \\ -e TZ=Asia/Shanghai \\ -e dictionaries=zh-CN \\ -e \u0026#34;aliasgroup1=https://pan.jia.leiyanhui.com:5213\u0026#34; \\ -e \u0026#34;username=admin\u0026#34; \\ -e \u0026#34;password=admin\u0026#34; \\ --restart always collabora/code 配置ssl 我这里使用github actions集中管理的ssl证书 https://dev.leiyanhui.com/web/auto-get-ssl\n直接下载回来 用 7z 带密码解压 （unzip部分发行版不支持密码）\n1 2 3 wget https://github.com/joyanhui/ssl/raw/main/ssl.zip apk add p7zip 7z x ssl.zip -p密码 #密码和p字母之间没有空格 安装nginx 处理ssl\n1 2 3 4 5 apk add nginx rc-update add nginx rc-service nginx start nginx -s reload # 重载 nano /etc/nginx/http.d/code.conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 server { listen 8443 ssl; server_name office.jia.leiyanhui.com; ssl_certificate /root/ssl/jia.leiyanhui.com.cer; ssl_certificate_key /root/ssl/jia.leiyanhui.com.key; # static files location ^~ /browser { proxy_pass https://127.0.0.1:9980; proxy_set_header Host $http_host; } # WOPI discovery URL location ^~ /hosting/discovery { proxy_pass https://127.0.0.1:9980; proxy_set_header Host $http_host; } # Capabilities location ^~ /hosting/capabilities { proxy_pass https://127.0.0.1:9980; proxy_set_header Host $http_host; } # main websocket location ~ ^/cool/(.*)/ws$ { proxy_pass https://127.0.0.1:9980; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;Upgrade\u0026#34;; proxy_set_header Host $http_host; proxy_read_timeout 36000s; } # download, presentation and image upload location ~ ^/(c|l)ool { proxy_pass https://127.0.0.1:9980; proxy_set_header Host $http_host; } # Admin Console websocket location ^~ /cool/adminws { proxy_pass https://127.0.0.1:9980; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;Upgrade\u0026#34;; proxy_set_header Host $http_host; proxy_read_timeout 36000s; } } 管理 https:///browser/dist/admin/admin.html\n配置cloudreve 管理员登陆 ，到后台，参数设施 图像预览 WOPI 客户端 启用\n进阶 安装中文字体 1 2 3 4 cd ~ wget -c https://ghproxy.com/https://github.com/joyanhui/file.leiyanhui.com/archive/refs/heads/windows_font.zip unzip windows_font.zip mv file.leiyanhui.com-windows_font win_font 重建docker\n1 2 3 4 5 6 7 8 9 docker stop code \u0026amp;\u0026amp; docker rm code docker run -t -d -p 9980:9980 --name code --hostname code \\ -v /root/win_font:/usr/share/fonts/win_font \\ -e TZ=Asia/Shanghai \\ -e dictionaries=zh-CN \\ -e \u0026#34;aliasgroup1=https://pan.jia.leiyanhui.com:5213\u0026#34; \\ -e \u0026#34;username=admin\u0026#34; \\ -e \u0026#34;password=admin\u0026#34; \\ --restart always collabora/code 进入docker 继续处理\n1 2 3 4 5 6 7 8 9 10 11 12 # docker exec -u 0 -it code /bin/bash #必须带 -u 0 cat /etc/issue # Ubuntu 18.04.6 LTS apt update fc-cache -fv coolwsd-systemplate-setup /opt/cool/systemplate /opt/collaboraoffice apt install collaboraofficebasis-zh-cn # 发现已经安装 apt -y install language-pack-zh-hans language-pack-zh-hans-base exit # docker restart code 本文参考官方手册：https://docs.cloudreve.org/use/wopi\nhttps://sdk.collaboraonline.com/docs/installation/CODE_Docker_image.html#code-docker-image\n","date":"2023-02-13T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-office/","title":"lxc alpine下使用cloudreve 和 LibreOffice 的配置 "},{"content":"因为对LibreOffice的兼容性不看好，加上Collabora Online (LibreOffice Online)的界面语言显示不知道到底和什么有关。加上网络上关于他的资料多数较老。所以继续尝试onlyoffice。\nonlyoffice 社区开源版本，限制20个文件同时编辑。但是因为开源，所以是可以绕过去的。我这里用不到所以没有尝试修改这个限制。\n本文主要内容：\n搭建公网环境可用的onlyoffice 限制仅限自己可用的onlyoffice 基于 pve7.3-4 lxc alpine3.17\n初步搭建。 lxc alpine安装docker 参考之前的文章：基本配置和安装docker https://dev.leiyanhui.com/pve/alpine-docker\n准备证书 我这里是 部署到github上的acme.sh，直接拉回来解压\n1 2 3 wget https://github.com/joyanhui/ssl/raw/main/ssl.zip apk add p7zip 7z x ssl.zip -p密码 #密码和p字母之间没有空格 自动更新 参考 ：https://dev.leiyanhui.com/web/auto-updatessl-form-github\ndocker安装onlyoffice onlyoffice 依赖不少，直接docker弄吧。 我这里证书用nginx处理，方便后面禁止别人使用。\n也可以把证书挂载到 /var/www/onlyoffice/Data/certs/ onlyoffice.crt onlyoffice.key 直接开443。如果你有80和443的话，他好像会自动帮你申请证书。\n1 docker run -itd -p 8080:80 --name office2 -e WOPI_ENABLED=true --restart always -e TZ=Asia/Shanghai onlyoffice/documentserver 打开检查\n1 http://10.1.1.84:8080 群友的,可以参考\n1 docker run -i -t -d -p 9001:80 -p 9002:443 -e WOPI_ENABLED=true -v /root/onlyoffice/DocumentServer/logs:/var/log/onlyoffice -v /root/onlyoffice/DocumentServer/data:/var/www/onlyoffice/Data -v /root/onlyoffice/DocumentServer/lib:/var/lib/onlyoffice -v /root/onlyoffice/DocumentServer/rabbitmq:/var/lib/rabbitmq -v /root/onlyoffice/DocumentServer/redis:/var/lib/redis -v /root/onlyoffice/DocumentServer/db:/var/lib/postgresql onlyoffice/documentserver nginx反代 alpine下nginx的配置文件 是在 http.d 目录下哈\n1 2 3 4 apk add nginx rc-update add nginx rc-service nginx start nginx -s reload # 重载 1 2 mv /etc/nginx/http.d/default.conf /etc/nginx/http.d/default.conf-bak #非必须 nano /etc/nginx/http.d/office.conf 内容，如果你还有其他虚拟主机，记得处理 段落位置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 upstream docservice { server 127.0.0.1:8080; } map $http_host $this_host { \u0026#34;\u0026#34; $host; default $http_host; } map $http_x_forwarded_proto $the_scheme { default $http_x_forwarded_proto; \u0026#34;\u0026#34; $scheme; } map $http_x_forwarded_host $the_host { default $http_x_forwarded_host; \u0026#34;\u0026#34; $this_host; } map $http_upgrade $proxy_connection { default upgrade; \u0026#34;\u0026#34; close; } proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $proxy_connection; proxy_set_header X-Forwarded-Host $the_host; proxy_set_header X-Forwarded-Proto $the_scheme; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #陷阱主机 为了拦截域名错误的请求 server { listen 10011 ssl; server_name trap.ddns.leiyanhui.com *.ddns.leiyanhui.com *.leiyanhui.com; ssl_certificate /root/ssl/ddns.leiyanhui.com.cer; # fullchain.pem ssl_certificate_key /root/ssl/ddns.leiyanhui.com.key; #privkey.pem ssl_verify_client off; server_tokens off; root /usr/share/nginx/html; } #真实主机 server { listen 10011 ssl; server_name office.ddns.leiyanhui.com; server_tokens off; root /usr/share/nginx/html; # 证书位置 ssl_certificate /root/ssl/ddns.leiyanhui.com.cer; # fullchain.pem ssl_certificate_key /root/ssl/ddns.leiyanhui.com.key; #privkey.pem ssl_verify_client off; ssl_ciphers \u0026#34;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH\u0026#34;; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_session_cache builtin:1000 shared:SSL:10m; ssl_prefer_server_ciphers on; add_header Strict-Transport-Security \u0026#34;max-age=1209600; includeSubDomains\u0026#34; always; add_header X-Content-Type-Options nosniff; location / { proxy_pass http://127.0.0.1:8080; proxy_http_version 1.1; } } 另外找到 nginx.conf 的 ssl_session_cache shared:SSL:2m; 注释掉\n重载nginx nginx -s reload\n测试 打开网站 https://office.ddns.leiyanhui.com:10011/ 没问题了，在cloudreve 后台面板中 图像预览中配置 https://office.ddns.leiyanhui.com:10011/hosting/discovery 打开office文档测试\n注意和Collabora Online (LibreOffice Online)不同的地方。onlyoffice 对 doc xsl ppt 旧版格式 是不支持的，这个困扰我好久，最后在 cloudreve作者的提醒下 才知道，必须用 docx xslx pptx\n限制只能自己使用 因为onlyoffice 没有验证功能，所以任何人知道你接口地址 后 都可以访问你。那么就会导致 很容易超过20个文件的限制。而且自己资源被别人白嫖你心理也不爽。\n初步解决方案 前面 nginx 配置的 server_name 的 域名弄一个复杂的子域名 ，例如上例中的 office.ddns.leiyanhui.com 修改成 office-ankN35wvy5owLv-3JtR8cCguagRct.ddns.leiyanhui.com\n如果要这样做，这个子域名 必须是泛域名的一个下级域名，dns解析记录里面 不应该有他。\n比如，我的*.ddns.leiyanhui.com cname 到ddns.leiyanhui.com，ddns.leiyanhui.com 配置了ddns。这样几乎没有被扫到可能性。\n然后分享预览，最好也关闭。不然依旧会暴露。\n限制referers 前面的\n1 2 3 4 location / { proxy_pass http://127.0.0.1:8080; proxy_http_version 1.1; } 修改为\n1 2 3 4 5 6 7 location / { valid_referers none blocked 调用域名.com onlyoffice的域名.com; if ($invalid_referer) {return 403;} proxy_pass http://127.0.0.1:8080; proxy_http_version 1.1; } 同时把 cloudreve和onlyoffice 的地址添加进去即可\n限制wopisrc 在前面的 location / 再添加一段\n1 2 3 4 5 6 location /hosting/wopi { if ( $args ~ wopisrc=https%3A%2F%2F你的域名.com%3A ) { proxy_pass http://127.0.0.1:8080; } proxy_http_version 1.1; } %3A 是冒号转义符 后面跟的端口号，如果你的没有记得删除%3A。\n","date":"2023-02-13T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-office-onlyoffice/","title":"lxc alpine下使用cloudreve 和 onlyoffice 的配置 包括onlyoffice的配置"},{"content":" 2023年6月30日 补充：因cloudreve 的webui其实完成度并不高，office的wopi也有一些问题，issues基本停滞在你提你的作者自己有自己的想法，或者说压根无人处理的状态。 我最终选了filerun 并搭上了filerun的最后一班免费10用户的车。nextcloud 因为web界面一直卡卡的感觉处于备用状态。自己尝试用go 或者rust重写一个webui来用，但是尚未有太多进展。 核心的webdav sftp smb 我全部改为rclone server实现。具体站内搜索。\ncloudreve 是优秀的国产开源程序，使用golang写的，轻量高性能，3.7版本以后开始支持 wopi扩展office在线编辑。而且可以直接加ssl 以及对象储存支持等\n要说缺点。。。就是ios客户端 收费。。。不过有第三方webdav 客户端这个也不算太大缺点。\n但是 cloudreve 貌似不支持默认路径储存，也就是无法和smb无缝配合,而且他的数据库功能也就限制了，你要使用smb的话，就必须要要 先挂载webdav 再开启smb套娃\u0026hellip;\n买断的话 实际最少价格 是 399 + 398 不便宜，不过好在免费版本也可以用\n本文主要内容\n利用 几个开源golang程序 搭建 轻量但是灵活高性能nas cloudreve 搭建在线web网盘和webdav，acme.sh获取域名证书，rclone挂载到本地，samba wsdd搭建smb，openssh搭建sftp\nalpine的配置 宿主机器 依旧是使用lxc的alpine alpine 容器的创建和基本配置 ：https://dev.leiyanhui.com/pve/lxc-nas\n创建特权容器 10000 ，模板 alpine 3.17 ，磁盘0.5G cpu12核 ，内存 1024 swap 0 开dhcp 并且在选项里面 打开 嵌套 和fuse。 挂载 pve上的物理过来\n1 2 pct set 10000 -mp0 /dev/sda1,mp=/mnt/sda1 pct start 10000 #启动 其他修改源 时区 还有常用工具安装 参考 https://dev.leiyanhui.com/pve/lxc-nas\n安装 cloudreve 1 2 3 4 5 6 cd /mnt/sda1 apk add wget wget https://github.com/cloudreve/Cloudreve/releases/download/3.7.0/cloudreve_3.7.0_linux_amd64.tar.gz tar -zxvf cloudreve*.tar.gz rm -rf LICENSE README* cloudreve*.tar.gz ./cloudreve 启动后会自动显示 端口和 用户密码等\n1 2 [Info] 02-13 14:38:39 Admin user name: admin@cloudreve.org [Info] 2023-02-13 14:38:39 Admin password: HMLXclhK cloudreve 的本机储存 是放在同目录的upload目录下，所以。。cloudreve 可以直接放到 lxc直通硬盘里面。\n配置cloudreve本地储存路径 这个步骤可以省略，我这里直接放到了/mnt/sda1/ 并在 另外一个容器中用duplicati+alist 整体备份sda1 到阿里云盘 1、增加一个本地储存策略 名称“本地机械硬盘” /mnt/sda1/cloudreve/{uid}/{path}\n2、修改对应用户组 储存策略 为 “本地机械硬盘”\nalpine下配置自动启动和守护 用supervisor 更简单一些\n1 2 3 apk add supervisor nano rc-update add supervisord boot service supervisord restart 初始化配置文件\n1 2 echo_supervisord_conf \u0026gt; /etc/supervisord.conf nano /etc/supervisord.conf 编辑或者添加文件末尾两行\n1 2 [include] files = /mnt/sda1/conf/supervisor/*.ini 1 2 mkdir -p /mnt/sda1/conf/supervisor/ nano /mnt/sda1/conf/supervisor/cloudreve.ini 根据自己的情况配置 注意这个文件是ini格式的\n1 2 3 4 5 6 7 8 [program:cloudreve] directory=/mnt/sda1/ command=/mnt/sda1/cloudreve autostart=true autorestart=true ;stderr_logfile=/tmp/cloudreve.err ;stdout_logfile=/tmp/cloudreve.log environment=CODENATION_ENV=prod 管理\n1 2 3 4 5 supervisord -c /etc/supervisord.conf supervisorctl start cloudreve supervisorctl restart cloudreve supervisorctl stop cloudreve supervisorctl status cloudreve 配置ssl 我这里为了避免麻烦，直接用cloudreve+acme.sh\nacme.sh 安装 1 2 apk add curl openssl curl https://get.acme.sh | sh -s email=joyanhui@qq.com acme.sh 依赖openssl，国内手动安装\n1 2 3 4 5 6 apk add wget unzip cd ~ wget https://ghproxy.com/https://github.com/acmesh-official/acme.sh/archive/refs/heads/master.zip unzip mv acme.sh-master .acme.sh rm -rf master.zip .acme.sh/.githu 配置dns 我这里用的dnspod,先登录到 dnspod 账号, 生成你的 api id 和 api key, 这个简单，自己看dnspod操作即可\n1 vi /etc/profile 末尾添加\n1 2 3 export DP_Id=\u0026#34;1243354\u0026#34; export DP_Key=\u0026#34;XXXXXXXXXXXXXXXXXXXX\u0026#34; alias acme.sh=/root/.acme.sh/acme.sh 启用和测试\n1 2 source /etc/profile echo $DP_Id 创建证书 1 acme.sh --register-account -m joyanhui@qq.com --issue --dns dns_dp -d jia.leiyanhui.com -d *.jia.leiyanhui.com 其他参数\n1 --server letsencrypt # 更换letsencrypt证书，默认是zerossl的 检查计划任务, 顺带修改一下时间，避开高峰期。\n1 2 3 crontab -e ======== 20 14 * * * \u0026#34;/root/.acme.sh\u0026#34;/acme.sh --cron --home \u0026#34;/root/.acme.sh\u0026#34; \u0026gt; /dev/null 配置cloudreve 使用ssl证书 conf.ini 添加一段\n1 2 3 4 [SSL] Listen = :5213 CertPath = /root/.acme.sh/jia.leiyanhui.com_ecc/fullchain.cer KeyPath = /root/.acme.sh/jia.leiyanhui.com_ecc/jia.leiyanhui.com.key 重启 supervisorctl restart cloudreve\n打开 https://10.1.1.80:5213/ 查看 当然证书肯定是有问题的，但是可以看到证书对应到域名了。\n进阶 数据库 文件多，或者用户数比较多的情况下，最好启用mysql数据库。\n在线编辑office 使用wopi https://dev.leiyanhui.com/pve/lxc-nas-office\n其他问题 目前cloudreve webdav上传的文件不能自动创建缩略图，作者表示3.8版本会修复。\n本机挂载webdav 为smb和sftp准备 创建webdav密码 cloudreve的webdav密码是独立的，帐号是和用户名的邮箱通用的。\n前台登录后，点击 链接 webdav 创建新帐号，输入备注，然后密码是自动生成的，用户名是当前用户。\n挂载 rclone davfs2 的挂载后有一些小问题，不太确定原因。推荐使用rclone\n1 2 3 4 5 6 7 curl -O https://downloads.rclone.org/rclone-current-linux-amd64.zip unzip rclone-current-linux-amd64.zip cd rclone-*-linux-amd64 cp rclone /usr/bin/ chown root:root /usr/bin/rclone chmod 755 /usr/bin/rclone rclone config #按照提示创建一个webdav节点 名称 cloudreve，vendor选择nextcloud就行，按照提示配置账户密码，其他默认 rclone的配置文件如下\n1 2 3 4 5 6 [cloudreve] type = webdav url = https://外网地址:5213/dav vendor = nextcloud user = 你的邮箱 pass = 加密后的密码 手动挂载 1 2 3 mkdir /mnt/dav apk add fuse rclone mount cloudreve:/ /mnt/dav 开机自动挂载 这里一方面 需要开机自动运行，一方面还需要cloudreve启动后 才可以。 证书忽略 --insecure 或者 -k\n1 2 serv_http_code=`curl -I -k -m 10 -o /dev/null -s -w %{http_code} https://localhost:5213/` echo $serv_http_code 创建一个脚本 nano /etc/local.d/mount_webdav.start 后台启动一个脚本\n1 sh /mnt/sda1/mount_webdav.sh \u0026amp; chmod +x /etc/local.d/mount_webdav.start 以及一个shell用来判断cloudreve的状态，如果没启动 那么尝试去启动，代码很简单。\nnano /mnt/sda1/mount_webdav.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 while : do serv_http_code=`curl -I -k -m 10 -o /dev/null -s -w %{http_code} https://localhost:5213/` echo \u0026#34;检查cloudreve状态：\u0026#34;${serv_http_code} if [ \u0026#34;$serv_http_code\u0026#34; -eq \u0026#34;200\u0026#34; ];then if grep -qs \u0026#39;/mnt/dav\u0026#39; /proc/mounts; then echo \u0026#34;已经挂载 不需要做任何事情\u0026#34; echo \u0026#34;备份数据库文件\u0026#34; \u0026amp;\u0026amp; cp /root/cloudreve.db /mnt/dav/ else echo \u0026#34;未曾挂载，尝试挂载\u0026#34; nohup rclone mount cloudreve:/ /mnt/dav \u0026amp; sleep 3 #echo \u0026#34;备份数据库文件\u0026#34; \u0026amp;\u0026amp; cp /root/cloudreve.db /mnt/dav/ fi else umount /mnt/dav supervisorctl restart cloudreve fi sleep 10 done 1 2 rc-update add local #添加一个local service local restart 重启测试，ls /mnt/dav 应该可以看到 lost+found 那就是没问题了。\n配置smb 1 2 3 4 5 6 7 8 apk add samba rc-update add samba smbpasswd -a root # 配置用户的 smb密码 注意这个用户和运行cloudreve的用户 必须是同一个 否则会有权限冲突。 apk add wsdd #发现服务 rc-update add wsdd boot service wsdd restart # 创建一个文件夹给 pve用 `mkdir /mnt/dav/pve-node` rm -rf /etc/samba/smb.conf \u0026amp;\u0026amp; nano /etc/samba/smb.conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # nano /etc/samba/smb.conf 编辑完成后重启 samba start [global] allow insecure wide links = yes workgroup = WORKGROUP dos charset = cp866 unix charset = utf-8 [webdav] path = /mnt/dav writable = yes write list = root valid users = root display charset = UTF-8 unix charset = UTF-8 dos charset = cp936 [sda1] path = /mnt/sda1 writable = yes write list = root valid users = root display charset = UTF-8 unix charset = UTF-8 dos charset = cp936 #下面这段给pve挂载用 mkdir /mnt/sda1/pve [pve-node] path = /mnt/dav/pve-node writable = yes write list = root valid users = root display charset = UTF-8 unix charset = UTF-8 dos charset = cp936 1 rc-service samba restart #重启 windows下应该可以直接能访问了。如果不可以 可能需要 重启几次。\nsftp配置 1 2 3 apk add openssh rc-update add sshd boot service sshd restart 允许root 密码登录\n1 2 # nano /etc/ssh/sshd_config 添加或者编辑下面内容 然后重启 service sshd restart PermitRootLogin yes ","date":"2023-02-13T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-core-cloudreve/","title":"lxc alpine下使用cloudreve替代nginx搭建webdav 并开启smb/nfs和sftp "},{"content":"两者都是虚拟化容器，都和宿主之间隔离，并且有非常低的风险被绕过容器隔离。\n都支持桥接物理网络，直接接入上级路由，或者类似虚拟机那种仅限主机的网络配置。\n两者在性能上没差别 都可以方便的备份和迁移 两者都可以挂载目录，或者挂到 raw格式的虚拟磁盘内。 内核都是使用宿主机内核\ndocker： 定位为应用程序容器，docker 至少有一个程序在前端运行，不然docker会直接关掉退出。 一般情况下，原则上一个docker只跑一个服务，早期的docker 就是lxc ，docker文件分层，docker的更新是整个镜像更新，要保留的文件需要提前映射到目录外部。\ndocker的镜像超多 使用方便\nlxc：定位为系统容器，可以视作一个完整的操作系统，lxc的文件不分层 lxc没有镜像更新的概念他本身就是一个完整的操作系统，直接在系统内部升级对应的应用或者系统自身等即可。\nlxc更为灵活，lxc因为是一个完整的系统，lxc内的是可以正常安装docker的 并且和lxc的宿主之间完全隔离 lxc的镜像较少，一般只是几个常见发行版的镜像\n中小团队如何选择？\npve平台的话，不用考虑 lxc 也可以 一个lxc 跑一个服务。 能不用docker的 就直接lxc即可。 需要docker的 可以lxc 里面安装docker\n如果所需服务不多，可以全部在一个lxc里面搞定\nlxc 的alpine+docker 磁盘占用，比裸的lxc debian要小\n","date":"2023-02-12T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/docker-vs-lxc/","title":"docker和lxc的对比和选择"},{"content":"简单说，是需要 more_set_headers 这个模块，一般情况下nginx没有自带\nhttps://github.com/openresty/headers-more-nginx-module\n以alpine下载的nginx为例\n1 apk add nginx-mod-http-headers-more 1 nginx -V 发现是动态加载的\n1 find / -name \u0026#34;*more*\u0026#34; 找到了文件 /usr/lib/nginx/modules/ngx_http_headers_more_filter_module.so\n修改配置文件 nginx.conf添加一行\n1 load_module /usr/lib/nginx/modules/ngx_http_headers_more_filter_module.so; nginx版本必须大于 1.9.11，否则需要自己编译了不能使用动态加载了\n新版alpine的nginx默认配置文件会自动加载 /etc/nginx/modules/ 这里的配置文件，不需要自己 load_module\n解决中文文件夹重命名问题 将请求头Destination中的https替换为http，并解决webdav重命名中文文件夹的乱码问题： 修改配置文件 http部分\n1 2 3 4 map $http_destination $webdav_dest { ~*https://(.+) http://$1; default $http_destination; } 上传文件大小限制问题 这部分内容放到server，或者http部分\n1 2 # 修改包大小上限避免上传错误 client_max_body_size 10G; 其他的问题 这部分内容放到 location\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 解决webdav不能创建文件夹问题 if ($request_method = MKCOL) { rewrite ^(.*[^/])$ $1/ break; } # 解决webdav不能重命名问题 if (-d $request_filename) { rewrite ^(.*[^/])$ $1/; set $webdav_dest $webdav_dest/; more_set_input_headers \u0026#39;Destination: $webdav_dest\u0026#39;; } # 解决webdav不能复制、移动文件问题 if ($request_method ~ (MOVE|COPY)) { more_set_input_headers \u0026#39;Destination: $webdav_dest\u0026#39;; } 最终配置文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 load_module /usr/lib/nginx/modules/ngx_stream_module.so; load_module /usr/lib/nginx/modules/ngx_http_headers_more_filter_module.so; worker_processes auto; events { worker_connections 1024; accept_mutex on; } http { include mime.types; default_type application/octet-stream; keepalive_timeout 75s; gzip on; gzip_min_length 4k; gzip_comp_level 4; client_max_body_size 1024m; client_header_buffer_size 32k; client_body_buffer_size 8m; server_names_hash_bucket_size 512; proxy_headers_hash_max_size 51200; proxy_headers_hash_bucket_size 6400; gzip_types application/javascript application/x-javascript text/javascript text/css application/json application/xml; map $http_upgrade $connection_upgrade { default upgrade; \u0026#39;\u0026#39; close; } map $http_destination $webdav_dest { ~*https://(.+) http://$1; default $http_destination; } server { server_name alist.jia.leiyanhui.com; listen 50443 ssl http2; ssl_certificate /home/nginxWebUI/.acme.sh/jia.leiyanhui.com/fullchain.cer; ssl_certificate_key /home/nginxWebUI/.acme.sh/jia.leiyanhui.com/jia.leiyanhui.com.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 50080; if ($scheme = http) { return 301 https://$host:50443$request_uri; } error_page 497 https://$host:50443; #解决http到ssl端口的400错误; client_max_body_size 10G; location / { proxy_pass http://10.1.1.52/; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $http_host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_redirect http:// https://; proxy_set_header Range $http_range; # 解决webdav不能创建文件夹问题 if ($request_method = MKCOL) { rewrite ^(.*[^/])$ $1/ break; } # 解决webdav不能重命名问题 if (-d $request_filename) { rewrite ^(.*[^/])$ $1/; set $webdav_dest $webdav_dest/; more_set_input_headers \u0026#39;Destination: $webdav_dest\u0026#39;; } # 解决webdav不能复制、移动文件问题 if ($request_method ~ (MOVE|COPY)) { more_set_input_headers \u0026#39;Destination: $webdav_dest\u0026#39;; } } } } ","date":"2023-02-12T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/nginx-proxy-webdav/","title":"nginx 反向代理webdav的问题  无法创建续传 重命名 移动 等问题"},{"content":"本文 是 pve lxc 搭建nas 的系列文章 的一部分。 因为篇幅较长，所以分开。\n原文索引 ：https://dev.leiyanhui.com/pve/lxc-nas\n本文主要内容 本地重要数据的异地备份 的相关记录。\nduplicati 不支持alpine 直接安装，官网的包用的 zst 压缩的deb，alpine下的dpkg 弄不死\nalpine 容器的创建和基本配置 原文索引 ：https://dev.leiyanhui.com/pve/lxc-nas\n硬盘要分2G，duplicati体积不小\n挂载物理硬盘 查看前面的alpine 容器的创建和基本配置,简单说就一行命令\n1 pct set 10081 -mp0 /dev/sda1,mp=/mnt/sda1 安装docker 特权容器安装docker 需要打开嵌套，并手动修改一下cnf文件 原文索引 ：https://dev.leiyanhui.com/pve/lxc-docker-err\nalist 挂载网盘 支持很多网盘的一个小程序，适合把网盘转webdav。目录列表功能可以加密。 alist具体安装过程掠过，官网文档很全。\ndocker 运行 我这里选择duplicati，比自己写shell脚本简单很多，而且支持可视化界面，支持加密备份。\n缺点是体积比较大，不算轻量。 这个lxc要\n1 2 3 4 5 6 7 8 9 10 11 docker run -d \\ --name=duplicati --hostname=duplicati \\ -e PUID=1000 \\ -e PGID=1000 \\ -e TZ=Asia/Shanghai \\ -p 80:8200 \\ -v /root/config-duplicati:/config \\ -v /root/backups-duplicati:/backups \\ -v /mnt/sda1:/mnt/sda1 \\ --restart unless-stopped \\ linuxserver/duplicati:latest backups 这个目录是本地存放备份的目录，因为我主要是异地备份到 阿里云盘 和 对象储存，所以这里就保持默认 source 是原始目录。可以配置为在前面挂载过来的物理硬盘. 因为这个lxc只运行这一个docker，所以80端口直接分给他\n配置duplicati 打开网页 http://lxc的ip+端口 例如 http://10.1.1.213/ 刚刚加载进来页面是英文的，先提示创建密码，点yes。然后界面就自动转换中文了。\n设置完成密码后 重新登录，而后 新增备份即可。\n文件可加密后备份，也可以分卷 也可以定时清理过期数据 还是很方便的。\n","date":"2023-02-08T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-autobackup/","title":"pve下使用lxc 直通硬盘搭建 nas 服务  全面替代群晖 freenas OMV 等  异地备份"},{"content":"本文 是 pve lxc 搭建nas 的系列文章 的一部分。 因为篇幅较长，所以分开。\n原文索引 ：https://dev.leiyanhui.com/pve/lxc-nas\n本文主要内容 webdav https-git minio s3对象储存 思源 套ssl的相关记录。\n我这里使用 nginxwebui的修改版本，具体看看之前文章点这里。这里只记录最终配置文件。\nnginx反代思源 需要ws，最终配置如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 server { server_name 域名; listen 50443 ssl http2; ssl_certificate /home/nginxWebUI/.acme.sh/域名/fullchain.cer; ssl_certificate_key /home/nginxWebUI/.acme.sh/域名/jia.leiyanhui.com.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 50080; if ($scheme = http) { return 301 https://$host:50443$request_uri; } error_page 497 https://$host:50443; #解决http到ssl端口的400错误; location / { proxy_pass http://10.1.1.68/; proxy_redirect http:// https://; } location /ws { proxy_pass http://10.1.1.68; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_redirect http:// https://; proxy_read_timeout 60s; } } nginx反代网盘类 需要安装模块 more_set_headers alpine下包名称nginx-mod-http-headers-more 在nginx.conf配置文件的http块（注意 不是 server块）中添加map指令，将请求头Destination中的https替换为http，并解决webdav重命名中文文件夹的乱码问题：\n1 2 3 4 map $http_destination $webdav_dest { ~*https://(.+) http://$1; default $http_destination; } 1 2 3 4 5 6 7 8 9 10 11 12 location / { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Range $http_range; proxy_set_header If-Range $http_if_range; proxy_redirect off; proxy_pass http://127.0.0.1:5244; # the max size of file to upload client_max_body_size 20000m; } ","date":"2023-02-08T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-ssl/","title":"pve下使用lxc 直通硬盘搭建 nas 服务  全面替代群晖 freenas OMV 等 服务套ssl"},{"content":"本文已经更新为 使用cloudreve和davfs 搭建多合1 文件中心 ：https://dev.leiyanhui.com/pve/lxc-nas-core-cloudreve\n2023年6月30日 补充：因cloudreve 的webui其实完成度并不高，office的wopi也有一些问题，issues基本停滞在你提你的作者自己有自己的想法，或者说压根无人处理的状态。 我最终选了filerun 并搭上了filerun的最后一班免费10用户的车。nextcloud 因为web界面一直卡卡的感觉处于备用状态。自己尝试用go 或者rust重写一个webui来用，但是尚未有太多进展。 核心的webdav sftp smb 我全部改为rclone server实现。具体站内搜索。\n本文 是 pve lxc 搭建nas 的系列文章 的一部分。 因为篇幅较长，所以分开。\n原文索引 ：https://dev.leiyanhui.com/pve/lxc-nas\n本文主要内容 是 直通 硬盘 以及配置 smb sftp webdav 相关 nas的基础应用。\nalpine 容器的创建和基本配置 原文索引 ：https://dev.leiyanhui.com/pve/lxc-nas\n安装sudo nano 1 2 3 4 # 用更加轻量的doas 替代sudo nano替代vi lxc 内运行 apk add doas nano apk del vim ln -s /usr/bin/doas /usr/bin/sudo #替代sudo 添加用户 先添加一个用户 作为 三个服务的登录用户 并给他sudo权限，lxc 内运行\n1 2 3 adduser -g yanhui adduser yanhui -G wheel #添加用戶到wheel 输入密码 echo \u0026#34;permit persist :wheel\u0026#34;\u0026gt;/etc/doas.d/doas.conf #把用户添加到doas 配置磁盘目录所有者权限 1 chown -R yanhui:wheel /mnt/sda1 开启配置sftp smb webdav sftp 直接安装openssh ，不推荐dropbear\n1 2 3 apk add openssh rc-update add sshd boot service sshd restart smb 1 2 3 4 apk add samba rc-update add samba smbpasswd -a yanhui # 配置用户的 smb密码 rm -rf /etc/samba/smb.conf \u0026amp;\u0026amp; nano /etc/samba/smb.conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # nano /etc/samba/smb.conf 编辑完成后重启 samba start [global] allow insecure wide links = yes workgroup = WORKGROUP dos charset = cp866 unix charset = utf-8 [cloudreve] path = /mnt/sda1 writable = yes write list = yanhui valid users =yanhui display charset = UTF-8 unix charset = UTF-8 dos charset = cp936 #下面这段给pve挂载用 mkdir /mnt/sda1/pve [pve] path = /mnt/sda1/pve writable = yes write list = yanhui valid users =yanhui display charset = UTF-8 unix charset = UTF-8 dos charset = cp936 1 rc-service samba restart #重启 windows资源管理器 打开 \\\\10.1.1.80​ 即可访问，windows无法发现，是因为没有开始 wdds，需要的话继续\nwsdd wsdd 就是 是 smb的网络发现服务。alpine仓库自带\nhttps://github.com/christgau/wsdd\n1 2 3 apk add wsdd rc-update add wsdd boot service wsdd restart webdav 选择最熟悉的nginx来处理。nginx搭建的webdav有一些小问题。 推荐使用 cloudreve\ncloudreve搭建网盘 ：https://dev.leiyanhui.com/pve/lxc-cloudreve\n1 2 apk add nginx nginx-mod-http-dav-ext openssl nginx-mod-http-headers-more echo \u0026#34;yanhui:$(openssl passwd 123456)\u0026#34; \u0026gt;/etc/nginx/.passwords.list # 这个用户和系统用户完全不相关,只是重名 配置nginx运行用户\n1 nano /etc/nginx/nginx.conf # 把 user nginx; 这行注释掉，添加一行 user yanhui wheel; access_log 这行如果不需要日志也注释掉 nginx一些小问题 首行添加一行\n1 load_module /usr/lib/nginx/modules/ngx_http_headers_more_filter_module.so; 后面添加一段,http部分\n1 2 3 4 map $http_destination $webdav_dest { ~*https://(.+) http://$1; default $http_destination; } 创建webdav用户，通过上面的ngin.conf 我们知道 alpine下配置文件 在 /etc/nginx/http.d/​\n1 2 mv /etc/nginx/http.d/default.conf /etc/nginx/http.d/default.conf-bak nano /etc/nginx/http.d/webdav.conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 server { listen 80; #这个端口号如果要用80 需要另外处理一下/etc/nginx/nginx.conf server_name localhost; #打开目录浏览功能 autoindex on; #默认为on，显示出文件的确切大小，单位是bytes #显示出文件的大概大小，单位是kB或者MB或者GB autoindex_exact_size off; #时间显示默认为off，显示的文件时间为GMT时间。 #改为on后，显示的文件时间为文件的服务器时间 autoindex_localtime on; add_header Cache-Control no-store; #让浏览器不保存临时文件 # 设置使用utf-8编码,防止中文文件名乱码 charset utf-8; # 默认存放文件的路径 root /mnt/sda1; auth_basic realm_name; # 用户密码文件存放位置 auth_basic_user_file /etc/nginx/.passwords.list; # dav 允许的操作 dav_methods PUT DELETE MKCOL COPY MOVE; dav_ext_methods PROPFIND OPTIONS; # 创建文件的默认权限 dav_access user:rw group:rw all:r; # 临时文件位置 client_body_temp_path /tmp; # 最大上传文件限制, 0表示无限制 client_max_body_size 0; # 允许自动创建文件夹(如果有需要的话) create_full_put_path on; } 1 2 3 rc-update add nginx rc-service nginx start nginx -s reload # 重载 Windows下挂载webdav 建议用第三方工具 (RaiDrive CyberDuck WinSCP)， 默认不支持 非https，大文件 写入有问题\n清理和备份 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 echo \u0026#34;===========================\u0026#34; \u0026gt;\u0026gt; /etc/issue echo \u0026#34;==== nas core ====\u0026#34; \u0026gt;\u0026gt; /etc/issue echo \u0026#34;===========================\u0026#34; \u0026gt;\u0026gt; /etc/issue echo \u0026#34;===========================\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;==== nas core ====\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;===========================\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;/etc/doas.d/doas.conf\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;/etc/samba/smb.conf \u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;WebDav paswd /etc/nginx/.passwords.list \u0026#34;\u0026gt;\u0026gt; /etc/motd echo \u0026#34;/etc/nginx/nginx.conf\u0026#34;\u0026gt;\u0026gt; /etc/motd echo \u0026#34;/etc/nginx/http.d/webdav.conf\u0026#34;\u0026gt;\u0026gt; /etc/motd echo \u0026#34;===========================\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;rc-service samba restart\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;rc-service nginx restart\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;rc-service sshd restart\u0026#34; \u0026gt;\u0026gt; /etc/motd echo \u0026#34;===========================\u0026#34; \u0026gt;\u0026gt; /etc/motd rm -rf /var/cache/apk/* rm .ash_history poweroff lxc 关机备份，备份完成后 系统只有区区的 37M 舒服\nwebdav套ssl 我这里用一个单独的lxc运行 nginx和acme.sh\n详情查看 ：https://dev.leiyanhui.com/pve/lxc-ssl\n","date":"2023-02-08T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-nas-core/","title":"pve下使用lxc 直通硬盘搭建 nas 服务  全面替代群晖 freenas OMV 等 核心 之  smb sftp webdav"},{"content":"pve下 vm 可以在选项里面直接修改名字，lxc容器需要自行修改文件。\n1 2 /var/lib/lxc/容器的id编号/config /etc/pve/lxc/容器的id编号.conf 只修改后面这个文件也可以\n","date":"2023-02-07T07:10:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-rename/","title":"pve lxc 修改名字"},{"content":"本文不适合linux纯小白，对linux有所了解的可以看。\n国内 openwrt esxi pve unraid 包括 群晖 等 群体，是一个 比较有特色的人相对比较集中的群体。。。。 切莫轻信这些群里一些人言之凿凿的一些言语。高手 太多了\n群晖系统跟Windows不同,Windows有个盘要当成系统盘,而群晖会在每个硬盘上自动安装系统。\n对于黑群晖来说也就是 你可以只插入一个引导盘和一个数据盘就可以启动起来群晖。\n但是在pve上，我们可以 1引导盘 1虚拟数据盘 多lxc外挂smb/nfs硬盘的方式来使用。\n这样群晖对我们来说只是一个简单易用的nas管理工具。离开群晖，我们的硬盘依旧可以正常访问，甚至群晖关机后依旧不影响我们nas的使用。\n缺点： 1、门槛略高一点 2、群晖需要替换.so文件 3、cpu要参与群晖和物理硬盘之间的数据交互，会增加一点负载。\n这种情况下的 硬盘的分配 1、引导盘，黑群晖必须的。 2、系统盘，就是黑群晖自身的系统安装的盘，此盘多余空间 可以作为 群晖的储存池 ，也就是你可用的空间。这个磁盘用虚拟磁盘即可。 3、数据盘 N个 或者raid，一般是直通过来的硬盘，或者 挂虚拟磁盘也可以。 pve下因为有先天优势，如果你pve性能过得去，可以把硬盘先挂载到lxc开启smb/nfs后，再把盘以万兆pve内置交换挂到群晖。\nsmb和nfs挂载的目录，群晖默认不支持照片和视频的那些操作，网上有对应的补丁可以处理。\n引导盘 通常情况下，引导盘 大家都是用 arpl 的img直接转换qcow2，然后导入到群晖中。\n1 qm importdisk 虚拟ID arpl镜像路径 local --format=qcow2 这个磁盘是1g 实际占用空间 要看驱动集成情况。\n系统盘 群晖 920+ 7.1.1 42962 大概需要 10G左右空间。实际 1G多 他自己留了一部分空间 用于安装套件。低于13G会导致系统盘上无法创建储存空间。\n众所周知的 pve的备份功能的速度 和 磁盘标注容量有关系。所以肯定是越小越好。 所以系统盘的尺寸 必须13G以上，另外部分套件占用这个储存空间，套件装基本全的话差不多，另外需要10G左右空间。 至少建议16G。 看个人需求。 我实际使用25G。 这个第二块磁盘（第一个是黑群晖引导盘），承担群晖套件和储存卷，姑且就叫系统盘\n数据盘 看个人情况。 重要数据，一定一定 异地备份。 既然是已经pve运行群晖了，除非你pve宿主性能非常拉跨，否则不建议硬盘直通给群晖。 更灵活方便的方式： 硬盘直通给lxc容器，开smb/nfs/webdav/sftp，而后在群晖中挂载，并替换群晖文件实现 一些不支持的套件使用。 系统盘可以现行在lxc中组raid。关于lxc系统的选择。\n关于系统的备份和恢复 因为我们是黑群晖，引导盘和系统盘 要定期备份，群晖关机后用 pve复制对应的qcow2文件出来即可。\n系统重装后，重新挂载smb/nfs即可。\n数据盘系统 硬盘根据自己情况组建raid 自己看情况来，软硬都可以\nlxc系统 技术不到位可以omv，技术可以的话，直接 alpine / debian 装smb/nfs/nginx/sshd 配置好权限和目录 就完了。\n关于 部分套件不支持 smb/nfs挂载的目录问题 感谢jinlife\n1 2 3 The patch for libsynosdk.so.7 will allow remote NFS/CIFS shared folder be used in VideoStation, AudioStation and Photos etc. cp /volume1/homes/jinlife/libsynosdk.so.7 /usr/lib/ https://github.com/jinlife/Synology_Photos_Face_Patch\n关于担心黑群晖挂掉的问题。 如果担心群晖升级后无法使用，不如一次性弄好以后，把所有可能要用的套件配置好。然后把虚拟机的群晖整机备份一次。\n就此养老，天荒地老了\n","date":"2023-02-06T19:11:20+08:00","permalink":"https://dev.leiyanhui.com/pve/pve-qh-vdisksize/","title":"pve 装群晖 系统盘分多大合适 / pve上黑群晖的更舒服的使用姿势 "},{"content":"为什么用lxc运行docker，因为更轻量，相对vm运行 管理更方便。 比如 家用环境的 aio上， 可以把路由器常用的功能 全部集成到一个或者多个lxc里面。 pve 跑vm 再去跑docker 虽然上手简单，但是会有一些其他问题。\n之所以用lxc去运行docker，因为很多软件只有docker版本 或为了部署/更新/备份/更方便。\n最小化部署docker 模板选择alpine，改一下ct源。不改也可以直接去国内镜像下载，例如： https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/\n1 https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/alpine-3.17-default_20221129_amd64.tar.xz 去掉无特权容器的勾号，ip的地方选择dhcp，然后先不开机。其他按照默认设置即可\n点选项 功能，选中 fuse 和 嵌套。 编辑nano ​ /etc/pve/lxc/容器id.conf 具体查看本文 lxc 特权容器 和非特权容器的选择 章节，编辑完成后启动 启动后逐行运行，都有注释\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 替换国内源 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories # 安装时区设置 apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone # 卸载时区 apk del tzdata rm -rf /var/cache/apk/* # 安装docker apk add docker #nano rm -rf /var/cache/apk/* # 开机启动启动docker rc-update add docker boot # 手动启动docker service docker start # 查看docker版本 docker version 这样运行的docker 不会有兼容性问题，也不会存在那些一知半解的人说的 什么什么不能运行的问题。\nlxc模板的选择 主要是 debian/ubuntu 和 alpine的 二选一\n如果lxc 只打算用来跑docker 那么 肯定是首选alpine，alpine宿主lxc只有几M。如果要跑一些非docker的软件。 有几种情况下，建议选 debian/ubuntu\nalpine因为musl 和 rc的问题 和部分软件兼容性不好，可能需要手动处理一些东西。 如果你没有时间弄那些 部分软件的发行版 不支持alpine 想直接装deb lxc 特权容器 和非特权容器的选择 无特殊情况，首选特权容器。特权容器外挂pve的目录更方便，而且特权容器也是支持docker的。nano ​ /etc/pve/lxc/容器id.conf 添加下面几行\n1 2 3 lxc.apparmor.profile: unconfined lxc.cgroup.devices.allow: a lxc.cap.drop: lxc内运行的服务 是直接安装还是再套一次docker 看服务的软件情况。优选直接安装，尤其是依赖很少的服务。 例如 ddns-go 作者提供二进制包，而且支持alpine，那么就没必要再套docker了。\n再比如 思源笔记，作者没有提供二进制包，服务版只有docker版，那么就肯定就是docker来运行了。\n再比如 alist ，如果你lxc跑的alpine ，alist能运行，但是不支持安装的启动服务里面，那么手写启动脚本，还是直接docker 那就随便你了。\n一个lxc里面可以运行多少个服务，多少个docker 没有限制，但lxc也是容器，通常而言最好也遵循 一个容器一个服务的原则。 比如 lxc 100 运行openwrt 做旁路由/网关 lxc 101 运行 mosdns lxc 102 运行 alist lxc 103 运行 rustdesk 的两个中继服务 lxc 104 跑一个nginx webdav网盘 互相独立，这样最合理，备份和管理也方便一些。 但是你全部放到一个lxc里面 也没毛病。\nlxc 创建那么多内容够用嘛？ lxc 的内存 是上限内存 不是分给他就就全占用了。 所以创建你几十个lxc，但是都没有太大负载，每个都分给他10G内存，也是没问题的。\nlxc 里面可以再套一次pve嘛？ 理论上可以，直接套kvm 再去跑一个windows 是可以的。\nlxc 内部的ssh反映慢 选项里面 勾选 嵌套 。重启即可\nlxc 内无法运行appimage 程序 选项里面 勾选 fuse 。重启即可\nlxc 挂载外部目录 没有写权限 非特权容器需要处理用户映射，特权容器可以直接读写。详情查看 本站内文章： https://dev.leiyanhui.com/pve/lxc-mount-dir/\nlxc 无法直接导入 openwrt的包 因为ostype 的问题，pve的webui界面操作里面不支持这个配置。用命令行导入即可,例子：\n1 2 3 pct create 2008 /var/lib/vz/template/cache/openwrt-dmz-02.05.2023-x86-64-generic-rootfs__1_.tar.gz --arch amd64 \\ --hostname dmz-OpenWrt --rootfs local:2 --memory 2048 -swap 0 --cores 12 --ostype unmanaged \\ --unprivileged 0 -net0 bridge=vmbr0,name=eth0 lxc 可以运行出来一个桌面嘛 当然可以，你正常在lxc里面 安装桌面包就ok了。比如 gnome kde i3w 等等 都是可以的，而且可以开显卡加速\nlxc 里面可以运行一个windows嘛 可以，甚至 运行一个macos都是可以的。当然就是和docker里面跑win跑macos一样 都是需要 lxc 里面套kvm了。\n现有虚拟机导入lxc 可以嘛？ 可以，但是仅限linux虚拟机 ： https://dev.leiyanhui.com/pve/kvm-to-lxc/\n","date":"2023-02-06T00:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/docker-mini/","title":"pve 用lxc容器运行docker最小化部署，以及lxc所有问题汇总！"},{"content":"主要有两种情况，1特权容器 2 无特权容器\n特权容器 如果lxc创建的时候 没有勾选 无特权容器 那么直接挂载即可\n例如 lxc 的id是50443(就是pve里面显示的虚拟机和ct的那个数字) ，要把pve的 /nvme/lxc_mount/nginxWebUI挂载到lxc容器里面的 /home/nginxWebUI\n范例挂载这个目录出来是为了pve能使用nginxwebui自己签名的ssl证书，以及其他服务也可以用。\n1 pct set 50443 -mp1 /nvme/lxc_mount/nginxWebUI,mp=/home/nginxWebUI 执行完成后 不需要重启 即可生效。 上面的命令等同 在 /etc/pve/lxc/50443.conf 添加一行\n1 mp1: /nvme/lxc_mount/nginxWebUI,mp=/home/nginxWebUI 往后就mp1、mp2、mp3 。。。。\n非特权容器 基于安全性考虑，以及嵌套docker的时候的一些问题，创建ct容器的时候，通常使用非特权容器。 这个时候直接挂载的目录可能会有权限问题。 其实可以用特权用户运行docker 查看 : http://dev.leiyanhui.com/pve/kxc-docker-err\n查看root用户情况 1 2 3 4 grep root /etc/subgid /etc/subuid ------------- /etc/subgid:root:100000:65536 /etc/subuid:root:100000:65536 root的从属用户起始id为100000，数量65536个。\n修改lxc的用户 把lxc里面的用户映射到pve的root用户\n容器内root(id=0)映射为pve 服务器id 100000，递增65536个，即容器内用户id 0-65535对应服务器100000-165535 nano /etc/pve/lxc/50443.conf 添加两行\n1 2 lxc.idmap: u 0 100000 65536 lxc.idmap: g 0 100000 65536 配置目录权限 将挂载目录让容器内root可读写的话在服务器内将所有者更改为id 100000。\n1 chown -R 100000:100000 /nvme/lxc_mount/nginxWebUI 对应目录不可以是非linux原生文件系统，比如ntfs exfat均不可以\npve上映射用户 映射pve用户，服务器和容器内有相同ID的用户。 nano /etc/subuid 添加一行\n1 lxc.idmap = u 1000 1000 1 nano /etc/subgid 添加一行\n1 lxc.idmap = g 1000 1000 1 本文参考：https://www.haiyun.me/archives/1419.html\n","date":"2023-02-04T07:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-mount-dir/","title":"pve lxc 挂载宿主机 目录 最简单方法 （特权容器）"},{"content":"错误提示 1 2 docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: unable to apply caps: operation not permitted: unknown. ERRO[0005] error waiting for container: context canceled 先运行 hello word 试试\n1 docker run hello-world 这个问题 发生在 特权容器上.\n简单的解决方法 - 非特权容器 不使用特权容器\n然后关于非特权容器的 目录挂载 比较麻烦，可以查看\n查看 (http://dev.leiyanhui.com/pve/lxc-mount-dir)[http://dev.leiyanhui.com/pve/lxc-mount-dir]\n使用 特权容器 使用特权容器 其实是可以安装docker的，创建的lxc的时候 去掉 无特权容器的 勾选，创建完成后 在选项里面 功能 勾选上 嵌套 在lxc的配置文件 添加三行 可以用特权容器开启docker /etc/pve/lxc/容器id.conf\n1 2 3 lxc.apparmor.profile: unconfined lxc.cgroup.devices.allow: a lxc.cap.drop: 另外 pve的webui里面 这个容器也要打开嵌套，也就是conf文件里面要有 features: nesting=1\n安裝docker 以alpine为例\n1 2 3 4 5 6 7 8 9 10 11 12 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata rm -rf /var/cache/apk/* sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add docker #nano rm -rf /var/cache/apk/* rc-update add docker boot service docker start docker version ","date":"2023-02-04T07:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/lxc-docker-err/","title":"pve lxc 里面运行docker的一些错误"},{"content":"pve运行docker，母系统使用lxc的alpine是多数情况下的最佳选择了。\n原因：体积小，占用资源小，启动快。 可以一个lxc运行一个docker服务。\n缺点：musl 和 gcc 有一些不兼容，不过这对使用docker没有任何影响。\n1 2 3 4 5 6 7 8 9 10 # 配置源和时区 alpine内运行 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone apk del tzdata rm -rf /var/cache/apk/* # vim替换为nano apk add nano apk del vim \u0026amp;\u0026amp; ln -s /usr/bin/nano /usr/bin/vim \u0026amp;\u0026amp; rm -rf /usr/bin/vi \u0026amp;\u0026amp; ln -s /usr/bin/nano /usr/bin/vi 1 2 3 4 5 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories #替换源 apk add docker #nano # 安装docker 和 nano rc-update add docker boot # 开机启动启动 service docker start # 启动 docker version # 查看版本 如果是特权容器，需要修改lxc的配置\n如果要挂载目录，最好要用特权创建，并开启嵌套，然后在lxc的配置文件 添加三行 可以用特权容器开启docker ​ /etc/pve/lxc/容器id.conf\n1 2 3 lxc.apparmor.profile: unconfined lxc.cgroup.devices.allow: a lxc.cap.drop: ","date":"2023-02-04T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/alpine-docker/","title":"alpine 一键安装docker"},{"content":"因为 安卓和ios 都默认支持ipsec 而不需要另外安装软件。所以 作为内网服务使用还是非常方便。\n加上之前openwrt迁移到lxc后，发现自带的ipsec 有问题。所以干脆lxc单独运行一个，独立运行 备份和使用都方便太多了。\nlxc 也应该遵守 one 容器 one server\n废话到此为止\n创建 一个lxc 母盘 我选的 alpine 3.16 , dhcp分配ip，然后在dhcp路由上绑定静态ip 。 系统盘1g就够用 内存随便给一点 swap关闭，cpu给12核心 运行一下命令先安装配置docker\n之所以lxc套docker 是因为懒得折腾，而且alpine体积很小。\n1 2 3 4 5 sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories apk add docker rc-update add docker boot service docker start docker version 准备配置文件 下面的命令 要一次性输入\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 cat \u0026gt; /root/ipsec.env \u0026lt;\u0026lt;EOF # Define your own values for these variables # - DO NOT put \u0026#34;\u0026#34; or \u0026#39;\u0026#39; around values, or add space around = # - DO NOT use these special characters within values: \\ \u0026#34; \u0026#39; # psk密钥 VPN_IPSEC_PSK=密钥 # 配置用于登陆VPN的账号和密码 VPN_USER=主用户名 VPN_PASSWORD=主用户名的密码 # 如下应该填写本机的外网IP 不强制 # VPN_PUBLIC_IP=10.1.1.45 # (Optional) Define additional VPN users # - Uncomment and replace with your own values # - Usernames and passwords must be separated by spaces # 配置额外的用户名和密码 VPN_ADDL_USERS=用户2 用户3 VPN_ADDL_PASSWORDS=用户2的密码 用户3的密码 # (Optional) Use alternative DNS servers # - By default, clients are set to use Google Public DNS # - Example below shows using Cloudflare\u0026#39;s DNS service VPN_DNS_SRV1=1.1.1.1 VPN_DNS_SRV2=223.6.6.6 EOF 启动docker 1 2 3 4 5 6 7 8 9 10 docker run \\ --name ipsec --network=host \\ --env-file /root/ipsec.env \\ --restart=always \\ -v ikev2-vpn-data:/etc/ipsec.d \\ -v /lib/modules:/lib/modules:ro \\ -p 500:500/udp \\ -p 4500:4500/udp \\ -d --privileged \\ hwdsl2/ipsec-vpn-server 查看状态 1 docker exec -it ipsec ipsec status 查看用户链接 1 docker exec -it ipsec ipsec whack --trafficstatus 测试和公网访问 主路由上 或者 dmz上，创建 端口映射 500 和4500 两个端口的 udp即可。\n备份 lxc 容器，直接在pve后台备份即可\n更多 查看作者的：https://github.com/hwdsl2/docker-ipsec-vpn-server/blob/master/docs/advanced-usage-zh.md\n","date":"2023-02-03T16:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/ipsec/","title":"pve下以lxc模式运行 ipsec （套docker）"},{"content":"如果是linux 不需要显示屏显示的话，建议lxc运行。\n对比 lxc 和 虚拟机kvm对比 lxc没办法支持 macos win 以及黑群晖 爱快等非常规系统，支持常见linux类服务，支持嵌套docker\nlxc 支持热备份\nlxc 性能更高，几乎就是原声性能，尤其是是需要硬件的服务，例如 openwrt jellyfin 等差距很大\nkvm多了一层转换，性能略低于lxc，部分情况下差距很大！ 例如 openwrt\nlxc 和 docker 对比 lxc 和docker 差不多。\nlxc 没有分层文件系统，在频繁需要修改东西上。比如数据库，openwrt这种经常修改配置的服务上，更适合。\nlxc 可以在创建完成后 修改挂载 甚至不需要中断服务\nlxc 在pve上 约等于一个独立的 linux虚拟机，比docker的更完整\npve上的lxc 在网络配置上可以直接使用桥接接入宿主机器物理网络\nlxc 可以独立且简单方便的嵌套docker docker 优势：更多的原始镜像的支持\n但是在pve下 因为自带lxc的支持，所以能用lxc跑的 就不要麻烦docker了。 实要用docker 可以 lxc套docker 或者 pve直接装docker 都可以。\nlxc 有一个小小的缺点： 无特权容器 外挂目录有权限问题要处理否则只能只读，特权容器跑docker有一点点问题，需要额外处理。你可以在本站找到相关教程。\npve官网建议 原文\n1 If you want to run application containers, for example, Docker images, it is recommended that you run them inside a Proxmox Qemu VM. This will give you all the advantages of application containerization, while also providing the benefits that VMs offer, such as strong isolation from the host and the ability to live-migrate, which otherwise isn’t possible with containers. 大概就是说 vm跑docker 迁移性和强制隔离效果更好。\n实际使用中，你会发现 lxc套docker 一个lxc 跑一个alpine 套1-N个更方便。一些家用必须有的服务，比如 ipsec nginx反代\n关于lxc 导入的格式 就是带权限的压缩包，比如 tar gz zst等格式。所以 无论原始是什么，我们只要最终 打包文件就可以了。\n虚拟机 虚拟机如果可以关机的话，直接转换原来磁盘文件为img即可，qcow2 也可以直接在pve下挂载，下面以img为例。 其他格式 包括 vmware 和 virtualbox的 都可以转换。\n1 2 3 4 5 6 7 cd /var/lib/vz/template/cache mkdir op root_partition=$((`fdisk -l op.img | grep .img2 | awk \u0026#39;{print $2}\u0026#39;` * 512)) mount -o loop,offset=$root_partition op.img /var/lib/vz/template/cache/op cd op \u0026amp;\u0026amp; tar zcf /var/lib/vz/template/cache/op.tar.gz * \u0026amp;\u0026amp;cd .. # 打包至PVE中LXC模板路径 umount op \u0026amp;\u0026amp; rm -rf op #rm -rf 固件名称.img 最终拿到压缩包 op.tar.gz，然后就可以直接在pve 创建ct容器了。\n如果是 openwrt等系统，可能还需要另外处理一下。 参考：https://dev.leiyanhui.com/openwrt/pve-lxc-install-op/\n正在运行的虚拟机 如果是pve的话，直接备份，然后 再导入到虚拟机，然后再处理磁盘即可。\n参考：https://dev.leiyanhui.com/openwrt/pve-lxc-install-op/\ndocker的话，直接导出 1 2 docker save -o centos. tar centos:latest #将centos:latest 镜像导出 为centos. tar docker export debian-go-codeserver-git \u0026gt; debian11-for-sshd.tar # 将正在运行的容器 不保留历史记录 直接导出 部分容器 导出的后的 压缩包不能直接导入到lxc，建议 lxc 嵌套docker\n","date":"2023-02-03T12:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/kvm-to-lxc/","title":"pve下虚拟机kvm转lxc docker转lxc 正在运行的虚拟机也可以， 以及lxc和docker kvm之间的对比"},{"content":" 本文是旁路路由模式，主路由模式 请浏览 ： https://dev.leiyanhui.com/openwrt/lxc-mian-op/\npve 没有默认docker，需要单独安装。通常不推荐这样做。原因是那个尽量不动pve自身的原则。一般在大量使用容器的情况下，采用lxc 开启一个debian11，然后在里面安装docker。 或者干脆开一个 alpine虚拟机。\n那么openwrt 因为要接管我们网络的网关，最好在一个独立的容器里面运行。 用虚拟机方式跑openwrt ，在内网没人下载东西的时候，它依旧会吃相当一部分cpu，所以还是用lxc方式合适，其性能就是你物理机的性能\n另外lxc 没有docker的层概念，所以非常适合运行这种独立的服务！\n获取openwrt的 rootfs 我这里是自己编译的，如果你有这个需求，可以联系我编译。也可以用官网版本（新手不建议，坑多）\n代编译说明 直接拿到tar.gz包 https://dev.leiyanhui.com/openwrt/diy\n原有镜像转lxc 转换为img qcow2/vmdk 如果原来镜像是 qcow2 vmdk\n1 2 qemu-img convert -p -f qcow2 -O raw op.qcow2 op.img qemu-img convert -p -f vmdk -O raw op.vmdk op.img img.gz 1 gzip -d openwrt-01.10.2023-x86-64-generic-squashfs-combined.img.gz 正在运行的虚拟机openwrt转lxc 直接在pve web控制台点备份，选择 gzip格式 ,得到文件 /var/lib/vz/dump/vzdump-qemu-100-2023_02_03-12_29_56.vma.gz\n在 local 备份里面 找到这个文件 点恢复 导入到一个新虚拟机 102\n1 qemu-img convert -p -f qcow2 -O raw /var/lib/vz/images/102/vm-102-disk-0.qcow2 op.img 挂载和打包 1 2 3 4 5 6 7 cd /var/lib/vz/template/cache mkdir op root_partition=$((`fdisk -l op.img | grep .img2 | awk \u0026#39;{print $2}\u0026#39;` * 512)) mount -o loop,offset=$root_partition op.img /var/lib/vz/template/cache/op cd op \u0026amp;\u0026amp; tar zcf /var/lib/vz/template/cache/op.tar.gz * \u0026amp;\u0026amp;cd .. # 打包至PVE中LXC模板路径 umount op \u0026amp;\u0026amp; rm -rf op #rm -rf 固件名称.img 如果img是正在运行的系统且使用的Overlay模式，会丢失Overlay内容（恢复默认了）。你需要在原来系统里面 导出 后覆盖过来。\n上传lxc 上传到 local节点 ct模板 op.tar.gz 后面操作都基于local和这个文件名。\n创建CT容器 直接在pve里面创建 会提示 unknown ID 'openwrt' in /etc/os-release file, trying fallback detection TASK ERROR: unable to create CT 2000 - unable to detect OS distribution 这样的错误，我们需要修改ostype，这在pve的webui里面是无法是实现的。 登录 pve shell 命令 创建 2000 使用上面的rootfs 磁盘和内存 cpu 也配置一下\n1 pct create 2000 /var/lib/vz/template/cache/op.tar.gz --arch amd64 --hostname lxc-OpenWrt --rootfs local:2 --memory 2048 -swap 0 --cores 12 --ostype unmanaged --unprivileged 0 -net0 bridge=vmbr0,name=eth0 --rootfs local:2 代表放到 local 2g大小\n你需要根据你的情况修改上面命令的部分内容，btrfs 的话路径是/var/lib/pve/local-btrfs/template/cache/\n网络配置 创建 添加网卡\n我这里是做旁路由使用，如果你做主路由用，还需要把映射 /dev/ppp 以及分配额外的网卡过来。 一般不建议 aio平台跑主路由哈。\n启动 1 pct start 2000 其他操作 如果你是用的别人编译的 或者官网的，还需要去容器里面 修改一下ip，如果是定制版本的 直接就可以开始用了。\n1 lxc-attach 2000 # 进入容器终端 其他常见问题 luci-static 错误 部分固件提示：\n1 2 3 4 Function statements require a function name in http://10.1.1.20/luci-static/resources/network.js?v=git-94eb2a9:? at http://10.1.1.20/luci-static/resources/luci.js?v=git-24.033.44588-94eb2a9:179:29 at async Promise.all (index 4) 固件本身的问题 换固件。\nssh无法登录 固件问题\nipsec无法链接的问题 问题不明，最佳方案，单独一个lxc/docker 运行 ipsec 详情： https://dev.leiyanhui.com/pve/ipsec\n","date":"2023-02-03T04:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/pve-lxc-install-op/","title":"pve下以lxc模式运行openwrt"},{"content":"特色 可以后台一键安装市面上有的任何插件，可以内置你常用插件。 不用你自己搜ipk包上传 有很多可以自由定制项 基于最近源码构建，每日同步3次官方库 支持平台 市面上多数主流可以刷机的硬路由 vmware esxi镜像 pve unraid镜像 群晖等nas和爱快的vm镜像 docker镜像 lxc镜像 硬路由注意事项 部分硬路由 需要先刷 不死uboot 或者解锁ssh等，请提前处理好，需要我远程代为处理的，需要提供 额外的网络环境（另外一个路由 或者手机热点） 太古老的路由器可能不支持了，因为最新的op对芯片要求和十年前已经不太一样\n支持的定制项目 插件自选（详情查看后文） 默认ip 10.0.0.1 默认root密码 root ipv6 默认是否开启 关闭 是否内置ppoe宽带帐号 dhcp 默认主题 argon Web服务器 nginx/uhttpd 默认旁路由模式 否 （详情查看后文） wifi帐号密码 openwrt/无密码 防火墙 firewall （可选nftables） 端口转发 firewall 不叠加socat (socat支持ipv6转v4) 主机名 opwnert （可以修改为指定的名称） 自定义签名 dev.leiyanhui.com 固件版本\t主机名称 日期 by 签名 / LuCI Master git-* 每次初始化自定义shell脚本 无 x86/vm软路由平台可以选 Overlay分区容量（0.5-6G），磁盘格式SquashFS/EXT4 x86 可选EFI或Legacy 关于插件自选 如果不选择任何插件，就是一个干净整洁的openwrt 你稍后可以自行在后台可视化一键安装插件\n如果不懂，可以一次性告诉我你的需求，我来帮你选择。\n常见插件需求 每个人需求不同，常用插件包已经有9千多个，这里按照分类，你自己说清具体软件名称，或者需求\nNAS类/网盘类（抛砖：alist rclone istorage nastools vm-群晖等 ） 影音解码类 （抛砖：docker处理 等） docker 虚拟机类 远程控制类 （抛砖：ddnsto frpc rustdesk 端口转发 等） 内网穿透类 （抛砖：ddnsto frpc ipv6映射等） 学习类（抛砖：*** ） 内网服务类 （抛砖：端口转发，内网反代，宝塔，nginx-proxy等） 附加收费 技术栈：linux winsServer ios开发 ios签名 nginx golang php pythone node.js openwrt 爱快 黑群晖 黑苹果 kvm pve unraid vmware/hyper-v/virtualbox\n","date":"2023-02-01T02:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/diy/","title":"openwrt定制说明"},{"content":"具体表现，padaven路由器打开允许外网访问，外网可以访问到路由器web管理界面。然后端口转发的内网的服务器 均无法访问。\n有人说是网关问题，测试后发现 应该就是 固件的bug，修改端口转发协议也无效。。。\n因为我内网还有一个旁路由，所以 干脆就不辛苦这个10年老古董的k2p（padaven）了，开dmz 到旁路由，端口转发转移到旁路由来处理。。。\n因为我这个旁路由 性能过得去，所以这里也就干脆 用 Socat 在旁路由上处理了。\nSocat 的优点，设置简单，支持ipv6 ipv4 缺点：比防火墙转发更加消耗cpu性能，不适合太低配置的路由器使用。\n也可以用op自带的防火墙\n","date":"2023-01-31T11:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/padaven-port-rule/","title":"padaven 固件端口转发配置无效的问题"},{"content":"设备情况如下： 1、AP： 小米路由器 AP 2个 1个是访客网络 一个是北厂区的AP，还有一个K2P 在用 2、x86 ： 两台 一个i7 8850h 装的pve 另外一个是信步的N2600 装的openwrt 3、终端：几十个2.4G的物联网设备 14个ppoe监控 监控硬盘机 手机 笔记本若干\n一直没扔的k2p 是因为他的2.4G信号很稳，适合物联网设备覆盖。之前也是拿他当作主路由使用了10多年。\n一直以来的纠结 就是 软路由和 pve 的功能重叠，以及信步这个板子的一些问题。\n纠结的地方 关于 信步这个板子 断电后偶尔会出现不能自动启动，另外N2600 不支持虚拟化，自带显卡也无法在linux下驱动 这就导致很多限制。\n还是想去掉他，卖掉的钱还能换一个 1-2T矿场硬盘。\n路由的思考 在不添加新硬件（穷）的情况下，想用靠谱的网络。 最终的解决方案 可能还是 旁路由（旁网关）方案。 我的k2p 在不跑科学软件的情况下，实际是可以跑满带宽，内网有交换机不需要他。驼子里面拔将军，还是尝试用他做主路由。然后再尝试指定ip的网关到pve上的旁路由。 这就需要，k2p刷的固件的dhcp支持这个功能.\n因为 运行pve的aio本身是不需要科学的。 为了全局科学（物联网设备可以在openwrt排除） 考虑方案如下\n新方案 尽量不影响现有设备的情况下快速平滑过度。\nk2p 固件 k2p 是肯定不能刷爱快的，硬改后可以但是不少人说内网都会掉到500M。剩下的就是高ge 官改 openwrt 和 Padavan。\nopenwrt 熟悉很多，但是padaven 有人说 是可以跑满1000M 的，而openwrt 不太清楚，本着能用就行的态度。我决定 还是 用 padaven ，只是dhcp静态绑定的迁移有一点麻烦。两者的配置文件不通用。\n旁路由网关 系统肯定是op了。 用pve的虚拟机跑吧 省心。然后除了跑openclash ipsec 其他基本都不需要。dhcp也暂定关掉。\n最重要的： 自动网关（文末） 因为我主路由受固件限制无法指定部分设备走旁路由网关，手动处理确实也比较麻烦，并且我需要 新设备加入后可以自动科学 ipsec拨进来的设备也可以。 所以打算在主路由上定时（1分钟）ping一下旁路由，如果不通，那么就把dhcp的网关切换回主路由，并重启 dhcp服务器。 另外 dhcp的生命周期也尽可能短一些 这样才能尽快生效。 （虽然对padaven不熟悉，但是好在他也提供ssh的，总可以搞定。 ）\n这样就完美实现了，全局都走科学，部分不需要科学的设备，单独从openclash里面用规则处理掉即可。\n这样带来的好处就是 ，无论怎么折腾 主路由都可以提供基本的上网服务。旁路由上线 后 就提供科学和ipsec等。\n小问题的处理 padaven 的内置ddns 不支持我常用的3322（自定义可以） 和 dnspod 以及 cloudfare， 暂时注册一个它支持的，然后用cname解决。\npadaven 的静态dhcp的备份 喜欢备份是一个好习惯。。 系统管理 - 配置管理 直接备份\npadaven 的ipv6 可以开启 ，以及 padaven 详情：https://www.jianshu.com/p/cb51fb0fb2ac\npadaven p段的迁移 之前的ip段是10.1.1.1 自定义的op固件，但padaven 默认的ip\nvlmcsd padaven 有自带\nalist 挪到pve里面，单独一个容器/vm运行\nnginxWebUI 挪到pve里面，单独一个容器/vm运行\nrustdesk服务 挪到pve里面，单独一个容器/vm运行\n内网穿透 因为我有公网ip所以不需要其他穿透，仅需要80个443的穿透映射。 pve 和 路由器的 web界面 用 ddnsto 直接弄 简单省心。 3389 之类的端口可以直接用不费心。 80和443端口穿透 有两个解决，是备案过的域名 用 腾讯cdn穿透，未备案的域名用cloudfare穿透\n一些应用级的，直接用非标端口解决\n端口转发 怎么都没想到，会在端口转发的上遇到问题 padaven 的固件的端口转发竟然有问题。\n临时解决方案：dmz 到旁路由，在旁路由上 直接上 socat\npve的自动备份 qm stop 后，直接cp磁盘出来。\nnas的处理 暂时用黑群晖简单很多，核心数据定时导出备份，影片等数据外挂直通的矿渣机械盘\n自动检测旁路由脚本 实现：全局科学，去广告等，外网可以用ipsec协议链回家并科学。指定ip段 禁止科学。 旁路由离线后1-2分钟内，全局改为普通模式上网。 旁路由上限后 自动恢复。 https://dev.leiyanhui.com/openwrt/auto-change-gatway\n","date":"2023-01-31T11:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/my-jiujie/","title":"我的all in one  以及路由器 nas 的纠结和最终的方案"},{"content":"还要说 远离坚果云 国内支持webdav的网盘，只有坚果云一家，但是家只能说知乎营销做的不错\u0026hellip;\n买过1年会员，速度拉跨，找客服退款 不给退款。。。\n因为还有部分文件放在他家，会员过期后也在继续用，心想 最起码有每个月1g的流量，同步一点小文本文件 还可以的。。。结果在我用到34M 流量的时候（pc ios 网页 都显示只用了30M，其实我就用吧 floccus同步放里面，然后同步了一点纯文本的文件 openwrt /etc/config 这个目录，不到2M ）， 他提示我超过流量了。。。。\n然后win客户端 我没退出，电脑也是24小时开机的，等睡一觉后，他弹出了20几个 提示交钱的弹出窗！\n另外坚果云明确对webdav调用做了限制，付费用户限制也很多。\n一个公网的第三方webdav可以做什么 可以随意挂载到 任何一个操作系统上做本地磁盘用，win linux macos ios android 都可。\n大量支持同步的软件的内置支持：floccus LastPass Obsidian 思源笔记 joplin Zotero\n替代方案 自建 缺点是需要一个服务器来弄 alist之类的挂载 还是需要一个电脑来运行 teracloud teracloud teracloud 是日本，国内可以访问，也有英文界面，注册后控制台有中文。 功能简单 注册简单。 之所以没有被墙，你应该能猜到，他的分享功能 1 不支持预览 2 只有注册用户可以下载 所以他依旧在局域网内活到现在。 免费有 15G，不限速 不限流量，但是滥用肯定封。 如果只是用来同步一些非影音类视频 足够了。 收费版本略贵，有提供 PayPal 和信用卡付款\n小粉红 请自己忽略。。\n注册 地址：https://teracloud.jp/en/ 支持 国内邮箱 需要邮件验证码激活\n扩容 注册后10G，用扩容码可以+5G 永久免费空间。 地址：https://teracloud.jp/en/modules/mypage/usage/ 在 Referral Bonus 地方输入 4FMWV 增加5G空间\n这个邀请码 分享给别人 只给加4G空间有效期也只有1年，没啥用。15G基本够用了。 20G的活动 早结束了，没活动的时候 只能加到15G\n网页管理地址 比较简陋，就是一个webdav的网页客户端 https://toi.teracloud.jp/browser/\nwebdav 链接地址 打开 https://teracloud.jp/en/modules/mypage/usage/ 勾选 Apps Connection 然后点击 eissue 会生成 webdav密码\n","date":"2023-01-31T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/webdav/net-disk/","title":"非常适合国内使用的支持webdav的网盘 免费15G"},{"content":"几个私有网盘的对比：https://dev.leiyanhui.com/all-in-one/mynetdisk-duibi\n之前一直用 smb/nfs 在局域网内使用，主要是解决 几个wifi摄像头转存以及 macos的备份。 后续开始用webdav。\n时间旧了以后开始对在线文档编辑有需求。\n其实想要的功能很多，比如 在线思维导图，当然是自己可控的。 还有类似win快捷方式的链接功能（只能手写文本的样子）。\n","date":"2023-01-28T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/my-netdisk/","title":"2023 搭建私有网盘的一些需求和想法"},{"content":"私有网盘程序功能对比 基本需求 如果只是要基本的 网盘功能，几乎所有的网盘程序都可以。 甚至nginx 自带的webdav也挺不错的。甚至sftp可能都可以。支持的客户端也众多。 下面从几个常见的网盘客户端程序中作一个对比，并根据我的需求来简单选择一下。\n简单对比 先说结论，很多网盘程序软文满天飞，广告天花乱坠。但是实际提供的功能 也就是 远程文件管理+权限管理。 在 在线文档方面 很弱智。\n我想要的网盘功能： 协议：肯定要支持webdav，不然玩个锤子，最好能兼容sftp，是否兼通smb不强求 ios客户端：如果支持相册视频备份最好（不过有FE文件管理器 PhotoSync Resilio Sync 可以替代[部分收费]） 不要求一定可以支持云盘备份挂载，因为有 其他替代方案可以实现。 一定要有比较好用的在线makedown编辑工具 最好有基本的doc和execl编辑功能 可以对接onlyoffice nextcloud /owncloud 虽然是基于php的，但是多数人实测是可以跑满内网100M的。\n但是 功能强大，扩展性强。 因为文件是按照原始格式储存，不清楚 加密本地储存以及 smb/sftp 配合使用会出什么问题 ios客户端免费 致命缺点：性能要求高，吃cpu 吃内存 有人说还有大文件上传下载的资源占用bug\nCloudreve 最大最大的优点，不是php pythone脚本语言写的，是用的golang。 性能提升N倍数资源占用降低N倍。非常适合cpu性能低的清空下使用。 支持在线makedown，其他对比nextcloud的缺点没有在线文档功能，只有预览 缺点：ios客户端收费而且还不便宜，当然可以替代。文件目录 好像打乱了 。 另外论坛发现可以 对接 https://forum.cloudreve.org/d/1200\nfilebrowser 只有很简单的功能，好像连webdav 都没有\nseafile 文件本地是分块储存的，貌似就无法提供smb sftp了\n界面丑陋上个世纪的东西。没有扩展性。office文件直接无法预览，但是可以创建。。。md文件预览加载出不来。。。\n觉得。。。这么一个东西。。还是算了。\n可道云 可道云有两个版本，界面玄，功能。。弱鸡。但是在群晖 或者群晖衍伸的人群中很受欢迎，甚至有人奉为信仰。。。还是两个字：弱鸡\nalist 可以挂本地，也可以挂多数网盘以及共享等。在挂载这方面可以说无人能比。但是完全不支持在线文档。非常适合作一个网盘 列表程序，但是不适合作一个功能齐全的网盘程序。\n中间发现一些非常奇葩的网盘程序 比如 dzzoffice，你新建一个文本，重命名为 .md 他非要给你加上.txt你再改一次，依旧。。。十年脑血栓\n","date":"2023-01-28T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/mynetdisk-duibi/","title":"几个私有盘的选择和对比"},{"content":"pve7.3 基于debian11 。。这种非滚动发行的版本内核相对来说都是比较陈旧的，目前还是在pve-kernel-5.15 (7.3-1) / 5.15.83 在跑docker的时候 会非常不爽。 甚至部分软件还有一些兼容性问题。\n当然最简单方法是，虚拟机跑一个archlinux或CachyOS ，然后再去跑docker 也就没问题了。当然性能会差一点\n","date":"2023-01-27T11:24:20+08:00","permalink":"https://dev.leiyanhui.com/pve/update-to-linux6/","title":"pve 7.3 升级到 linux6.1内核"},{"content":"打开 /tmp/dhcp.leases 删除想要回收的那行，然后重启dhcp /etc/init.d/dnsmasq restart 文件也可以完全清空\n1 2 rm -rf /tmp/dhcp.leases \u0026amp;\u0026amp; touch /tmp/dhcp.leases /etc/init.d/dnsmasq restart 重新在op里面静态分配绑定好地址，然后重启对应机器的dhcp客户端服务即可 或者干脆重启客户端机器，或者重新链接wifi或者网线 均可\n这个文件的地址，在路由的 网络\u0026gt; dhcp \u0026gt; host和解析文件 ：租约文件 是可以看到的。\n","date":"2023-01-27T11:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/del-dhcp/","title":"openwrt回收（释放）已经分出去的dchp的ip地址"},{"content":"最终目的，实现 在虚拟磁盘启动的物理机运行的pve，并最终开始使用。 期间结合我这几年来折腾的经验给出建议。\nvhd安装pve why? 因为不影响磁盘分区，可以随意移动。\n我是硬盘gpt按爪给你的ventoy，ventoy分区为fat32格式，里面放了几个pe和linux live盘，以及 ventoy配置文件，黑苹果的opencore引导，以及 一些vhd的vtoy链接文件。如果不懂这些，建议先去了解一下ventoy。\nwin下用virtualbox7 创建虚拟机名称pve 磁盘格式vhd 7G就够用了。分配全部空间，开启efi 开启 vm嵌套 网卡配置为桥接。挂上pve的安装镜像开始，安装pve7.3 用ext4格式安装。 安装完成后自动重启，挂载ventoy的vtoyboot-1.0.25.iso镜像,\n1 2 3 4 5 mount /dev/cdrom /mnt cp /mnt/vtoyboot*.tar.gz . tar -zxvf vtoyboot* cd vtoyboot* sh vtoyboot.sh 执行完成后，输入poweroff 关机，然后打开虚拟机的目录找到 pve.vhd 移动到自己需要的位置（注意分区格式，最好不要ntfs分区，最次exfat）重命名为 pve-7g-ext4.vhd.vtoy\n打开 ventoy的工具 VentoyVlnk.exe，创建lnk文件到 ventoy的第一分区，文件名为：1.pve-7g-ext4.vhd.vlnk.vtoy\nventoy分区的/ventoy/ventoy.json内容如下，大概就是跳过win11检测，运行linux挂载镜像所在目录，自动启动超时时间3秒（即默认启动第一个可启动文件，也就是为什么上面要重命名vlnk文件为1.***）\n1 2 3 4 5 6 7 { \u0026#34;control\u0026#34;:[ { \u0026#34;VTOY_WIN11_BYPASS_CHECK\u0026#34;: \u0026#34;1\u0026#34; }, { \u0026#34;VTOY_LINUX_REMOUNT\u0026#34;: \u0026#34;1\u0026#34; }, { \u0026#34;VTOY_MENU_TIMEOUT\u0026#34;: \u0026#34;3\u0026#34; } ] } 万事后重启，会自动重启到vhd版的pve。\n如果首选启动是 .vtoy这个不存在的文件，那就是ventoy搜到了回收站的文件，自己去pe或者win下或者pve下删除ventoy分区 回收站文件 就好了。pve下处理\n1 2 mount /dev/nvme0n1p1 /mnt # nvme0n1p1是我的ventoy的分区 cd mnt \u0026amp;\u0026amp; rm -rf \u0026#39;$RECYCLE.BIN\u0026#39; \u0026amp;\u0026amp; rm -rf System\\ Volume\\ Information/ \u0026amp;\u0026amp; umount /mnt 网络配置 因为刚刚是虚拟机环境，启动到物理机后是无法联网的。还需要修改一下ip和绑定的网卡。 https://dev.leiyanhui.com/pve/changip-and-netcard/ 如果前面是桥接网络安装的pve，已经配置好了ip，这里就只需要修改网卡名称就可以了。\npve web界面套ssl 建议直接在openwrt路由器上用nginxWebUI套ssl，当然。。也可以手动配置证书文件。\n修改国内源 https://dev.leiyanhui.com/pve/guonei/\n开启x11 转发 方便 在pve上远程跑个浏览器啥的 https://dev.leiyanhui.com/pve/x11/\n1 2 apt install -y xauth systemctl restart sshd 开启sftp 方便openwrt上的alist挂载 https://dev.leiyanhui.com/pve/open-sftp/\n安装fish apt install -y fish # 非必须看个人喜好\n自动挂载其他分区 fdisk -l查看 分区情况，挂载必要的分区\n1 2 3 4 5 6 7 mkdir /nvme /exfat /ventoy-fat32 # mkdir /root/other-etc-bak \u0026amp;\u0026amp; cp /etc/fstab /root/other-etc-bak nano /etc/fstab # 添加三行 # ----------------------- /dev/nvme0n1p1 /ventoy-fat32 vfat defaults 0 2 /dev/nvme0n1p5 /nvme btrfs defaults 0 2 /dev/nvme0n1p6 /exfat exfat defaults 0 2 检查好再重启，可能会导致无法自动启动，需要物理键盘操作。\n移动虚拟机和lxc iso目录 https://dev.leiyanhui.com/pve/pve-mv-dir/\n1 2 3 4 5 cd /var/lib/vz/ rm -rf images \u0026amp;\u0026amp; ln -s /nvme/images images cd /var/lib/vz/template rm -rf iso \u0026amp;\u0026amp; ln -s /exfat/iso iso rm -rf cache \u0026amp;\u0026amp; ln -s /exfat/lxc_cache cache pic和显卡直通 以核显为例 https://dev.leiyanhui.com/pve/igpu-pass/\n因为显卡可以在虚拟机挂机的情况下直通给其他虚拟机，所以我考虑到偶尔的游戏需求这没有用gvt（性能差一些，而且一些非win系统里面驱动处理起来更加复杂）\n","date":"2023-01-27T02:12:20+08:00","permalink":"https://dev.leiyanhui.com/pve/pve-ventoy-7g-all-use/","title":"pve 虚拟磁盘安装 目录移动以及硬件直通等 全部常用内容"},{"content":"尝试在 单网口的 all in one 主机上 使用kvm运行 openwrt 实现替代一个x86软路由的方案。 为什么 要吧路由器放到 aio主机上，是因为想节省一台设备 避免维护复杂化。 为了避免 all in boom，单独找了一个闲置小米路由，配置好dhcp静态分配和ppoe 作为备用路由器。\n硬件设备：\n光猫 桥接模式 硬路由 k2p 信号不错，但是性能不够，所以做AP模式 交换机 4口万兆 8口千兆 16口poe交换机 和监控若干 组装机一台 24小时开机，qnct魔改U 8代4核，64G内存 pio主板 带一个pice口 单网卡 nvme硬盘512G 机械盘 4块 加起来 5T 软件情况： 硬路由 k2p 刷 Padavan all in one主机，自己做的 ventoy+ archlinux+docker+kvm系统 https://dev.leiyanhui.com/all-in-one/arch-aio/\nall in one系统情况：\n主要跑三个系统 win archlinux/kde（kvm） 直通macos win主要做rdp转发和游戏串流 日用 archlinux 编译适合主机的openwrt 核心软件包 1 autocore-x86 automount base-files bash block-mount busybox ca-bundle coremark curl dnsmasq-full dropbear ds-lite e2fsprogs fdisk firewall fstools grub2-bios-setup htop kmod-8139cp kmod-8139too kmod-alx kmod-amazon-ena kmod-amd-xgbe kmod-bnx2 kmod-bnx2x kmod-button-hotplug kmod-drm-amdgpu kmod-drm-i915 kmod-e1000 kmod-e1000e kmod-forcedeth kmod-fs-vfat kmod-i40e kmod-iavf kmod-igb kmod-igbvf kmod-igc kmod-ipt-nat kmod-ipt-nat6 kmod-ixgbe kmod-lib-zstd kmod-mlx4-core kmod-mlx5-core kmod-mmc kmod-pcnet32 kmod-phy-broadcom kmod-r8125 kmod-r8168 kmod-sdhci kmod-tcp-bbr kmod-tg3 kmod-tulip kmod-usb-hid kmod-vmxnet3 libc libgcc libustream-wolfssl lm-sensors-detect logd lsblk luci-app-advanced luci-app-autoreboot luci-app-firewall luci-app-gpsysupgrade luci-app-opkg luci-app-upnp luci-app-wizard luci-base luci-compat luci-lib-fs luci-lib-ipkg mkf2fs mtd nano netifd odhcp6c odhcpd-ipv6only openssh-sftp-server opkg partx-utils pciutils ppp ppp-mod-pppoe procd procd-seccomp resolveip swconfig uci uclient-fetch urandom-seed urngd usbutils wget-ssl zram-swap 附加软件包 1 luci-app-socat luci-app-ipsec-vpnd luci-app-ddns luci-app-diskman luci-app-ksmbd luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config 去掉了docker 和alist等 增加了 openclash\n其他配置 内置ppoe帐号 ip 改为 10.1.0.1 初始密码： dev.leiyanhui.com 主机名称 kvm-op 根目录(Overlay)容量(M) : 512M 因为不打算用他跑太多东西了。所以512M足够了。 创建op虚拟主机 12核 512M内存。 cd /home/yanhui/mnt/nvme/vdisk/ qemu-img convert -p -f ram -O qcow2 openwrt-01.24.2023-x86-64-generic-squashfs-combined.img op.qcow2\n创建 虚拟主机 12核 1G内存。 注意要另外添加一个虚拟网卡给这个虚拟机。都是走桥接，arch-aio 桥接问题看 https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/\n更改物理布局 光猫 -\u0026gt; 交换机 -\u0026gt; arch-aio主机 去掉 原来的n2600的op\n后续 可能会尝试 用docker来跑 openwrt 作为主路由\n","date":"2023-01-24T02:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/kvm-my/","title":"openwrt 定制版本 我自用的版本- kvm版本"},{"content":"说起来amh就难免说到宝塔。曾经优秀的国产软件，沦落到现在\u0026hellip;\n先有强制绑定手机，后有接连爆出漏洞，最后又被实锤半夜上传数据\u0026hellip;\n逐步尝试用其他软件替代宝塔。今天尝试amh.sh\n大概看了一下amh.sh 主要基于 bash脚本和php脚本实现的。（PS：为什么就没有一个用golang做的靠谱的面板）\n基于debian11 创建 使用我自己的镜像\n1 2 3 docker run -itd --name amh --hostname amh --privileged=true \\ -p 50010:2222 -p 50011-50029:50011-50029 \\ registry.cn-qingdao.aliyuncs.com/joyanhui/base-sh-debian:debian11-sshd-autoboot.sh2222 sh /autoboot.sh 安装 1 2 3 docker exec -it amh /bin/bash apt-get install -y wget wget http://dl.amh.sh/amh.sh \u0026amp;\u0026amp; bash amh.sh nginx-1.20,mysql-5.7,php-7.4 35546 依赖很多，安装需要一点时间，官网说的免编译安装，结果卡卡卡 全编译安装，查看了一下文档也没有说到底什么环境才是免编译的。未免对amh.sh大失所望。 还没装完已经想删除了。\n简单配置 修改端口 默认管理端口是 8888 9999 官网文档没有说明。。。我以为是可以自定义，看了下文档 也没有说明。。。\n附加软件 phpmyadmin amrewrite amdata\n鉴于 amh文档残缺 ，已经删除，不相信这玩意能好用到哪里去\n","date":"2023-01-22T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/amh-sh/","title":"docker运行amh.sh 以及amh的体验"},{"content":"说起来amh就难免说到宝塔。曾经优秀的国产软件，沦落到现在\u0026hellip;\n先有强制绑定手机，后有接连爆出漏洞，最后又被实锤半夜上传数据\u0026hellip;\n逐步尝试用其他软件替代宝塔。今天尝试 urlos\ndocker run -itd \u0026ndash;name urlos \u0026ndash;restart always -p 9969:9969 -p 9968:9968 -p 9966:9966 urlos/urlos\n也是一个奇葩。。。 强制绑定手机号，然后手机号不可以直接注册，要先邮箱注册。。。然后。。不知后面还有什么套路。已经删掉\n","date":"2023-01-22T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/urlos/","title":"docker运行amh.sh 以及amh的体验"},{"content":"概述 这是我目前 2023-01-14 自用的版本，尽可能的极致精简，集成了常用必备插件。\n基本说明 ip：10.1.1.1\n用户名：root\n密码：dev.leiyanhui.com luci环境：nginx ipv6支持，ipv6端口转发支持，墙体内外分流全局doh 默认开ppoe有内置我自己的宽带账号，自己改成你自己的即可() 没有内置任何usb网卡 驱动和WiFi驱动。() 默认主题：argon 漂亮不花哨\n~~ 使用Firewall4(nftables)~~ 根目录(Overlay)容量 2048M 内核版本：5.15.86\n平台：x86/64\n支持用ventoy启动\n其他插件尽量能docker允许的尽量docker。这是一个稳定的软路由器的基本使用习惯。\n同容量的Overlay 系统升级，不会丢失Overlay 分区之外的数据\n基本使用 下载后，直接用balenaEtcher写盘即可。 或者用ventoy的openwrt工具解压后启动。 支持efi 和 Legacy ，VMware/esxi/pve/unraid/kvm ，docker/lxc 启动\n或者在你路由器后台直接上传下载的gz包\n使用步骤 概述 https://dev.leiyanhui.com/openwrt/my_use\n下载地址 因为带了docker，所以体积较大（120M+） 暂时删除下载连接.联系joyanhui@qq.com免费索取\n软件包 核心基础包 1 autocore-x86 automount base-files bash block-mount busybox ca-bundle coremark curl dnsmasq-full dropbear ds-lite e2fsprogs fdisk firewall fstools grub2-bios-setup htop kmod-8139cp kmod-8139too kmod-alx kmod-amazon-ena kmod-amd-xgbe kmod-bnx2 kmod-bnx2x kmod-button-hotplug kmod-drm-amdgpu kmod-drm-i915 kmod-e1000 kmod-e1000e kmod-forcedeth kmod-fs-vfat kmod-i40e kmod-iavf kmod-igb kmod-igbvf kmod-igc kmod-ipt-nat kmod-ipt-nat6 kmod-ixgbe kmod-lib-zstd kmod-mlx4-core kmod-mlx5-core kmod-mmc kmod-pcnet32 kmod-phy-broadcom kmod-r8125 kmod-r8168 kmod-sdhci kmod-tcp-bbr kmod-tg3 kmod-tulip kmod-usb-hid kmod-vmxnet3 libc libgcc libustream-wolfssl lm-sensors-detect logd lsblk luci-app-advanced luci-app-autoreboot luci-app-firewall luci-app-gpsysupgrade luci-app-opkg luci-app-upnp luci-app-wizard luci-base luci-compat luci-lib-fs luci-lib-ipkg mkf2fs mtd nano netifd odhcp6c odhcpd-ipv6only openssh-sftp-server opkg partx-utils pciutils ppp ppp-mod-pppoe procd procd-seccomp resolveip swconfig uci uclient-fetch urandom-seed urngd usbutils wget-ssl zram-swap 附加包 1 luci-app-socat luci-app-ipsec-vpnd luci-app-alist luci-app-ddns luci-app-diskman luci-app-dockerman luci-app-ksmbd luci-app-rclone luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config 大概说明\n1 2 3 4 5 6 7 8 9 10 11 12 luci-app-socat # 端口转发工具 问题更少 luci-app-ipsec-vpnd #仅ipsec 支持 ios 安卓原生连接，支持外网拨号进来后访问外网可走梯子 ios连接改个配置文件 https://dev.leiyanhui.com/openwrt/ipsec-server luci-app-alist # 网盘列表程序 以及转webdav luci-app-ddns # 动态dns 支持3322 aliyun等几乎所有ddns，支持ipv6 luci-app-diskman #磁盘管理 和挂载工具 luci-app-dockerman #docker 可视化管理工具 luci-app-ksmbd # smb共享，内核级 luci-app-rclone # 多网盘挂载程序，可以和alist配合 luci-app-ttyd #网页shell luci-app-vlmcsd #kms激活 自动启动自动激活内网win luci-app-watchcat # 掉网重启检测 uci-app-argon-config #argon主题配置 其他 ~~ luci-app-passwall2 : 支持doh 支持自定义分流 https://dev.leiyanhui.com/openwrt/passwall2 ~~ 学习工具后来不再打包进来是因为太多软件了各有特色还在摸索适合自己的。暂时是用的passwall2 后面可能会换openclash dns软件同理 ipv6 支持 luci-app-socat 端口转发，支持ipv4 ipv6 ，用于替代自带的防火墙转发 https://dev.leiyanhui.com/openwrt/ipv6-v4-port\n常见问题 端口转发 请使用socat\n整机备份和自动备份 https://dev.leiyanhui.com/openwrt/backup\niphone连不上ipsec的vpn https://dev.leiyanhui.com/openwrt/ipsec-server\nipsec的vpn的客户端无法访问外网 参考上文\n部分软件界面部分显示英文 ctrl+F5 刷新一下浏览器缓存。\n一点看法 关于集成的软件 ddns kms docker ipsec socat 这几个软件是我必用的 ，且非常适合我自己的,对我来说也是路由的核心。虽然可以自行安装，但是我日常备份系统，直接在线tar，所以为了减少备份文件体积，这里就预装了。如果你不需要可以自行卸载。或者找我定制均可。\n关于x86平台插件和docker的选择 x86软路由算是一个宿主机运行docker的低配版all in one，甚至包括我在内的很多人还会再docker上直接开nas 虚拟机等，为了避免all in boom（梗），宿主机的稳定性非常重要。但是linux系统原生的docker支持，不使用真的可惜。\n比如 smartdns 这种会影响全局的功能，你插件安装，一个不小心可能就全家掉线了。但是你用docker跑，等调试测试完成后，再把ip或端口指向 就完事了。还有一些防火墙的调试配置等\n其他必用的软件，比如 alist rclone smb acme nginx-proxy smartdns 等 还有一些pcdn收益软件 尽量能docker的不装插件。以牵扯宿主机机依赖，备份迁移都方便很多。\n当然 硬路由等硬件资源受限的情况下，还是插件安装吧至少省很多储存空间。或者对docker不熟悉，感觉没图形界面方便，那么还是插件安装\n关于Overlay容量 为什么选择2G 我是32G磁盘，但是依旧选择了 2G的Overlay，因为 1、其他分区挂到/opt 后 ，单纯常用软件其实1G都勉强够用，但是折腾太多的话1G其实有点紧张。 2、分区小了以后DD备份，刷入和迁移都方便 3、即便是装上桌面系统2G 都够用了。何况还有docek可以跑桌面软件\n所以权衡之下 overlay分区默认1.5-2G 较为合理\n不用默认ip的原因 内网还有其他路由和下级ap 他们的默认固件的默认ip可能会导致冲突。所以这里不用10.0.0.1 192.168.31.1 或者192.168.1.1 另外我的设备没有那么多, 肯定是254个设备以内的，所以也就不用多折腾了。\n","date":"2023-01-13T02:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/my/","title":"openwrt 定制版本 我自用的版本"},{"content":"登录 登录地址和密码参考 https://dev.leiyanhui.com/openwrt/my/\n部分界面如果是英文，在浏览器里面按下 crtl+F5 就好了。\n修改密码 系统 - 管理权 修改\nddns配置 配置了一组 3322 的ipv4 一组 dnspods的v4和v6 ，配置很简单不用多说。 dnspods需要用token的id和key。\n注意：ipv6地址的获取，可以用 lan 口，默认wan口是获取不到的。如果配置好了 科学软件的情况下或者不使用科学上网，也可以用 url http://checkipv6.dyndns.com 获取\n科学上网工具可能影响ipv6的使用 ，需要额外配置\n配置 vpn 参考 https://dev.leiyanhui.com/openwrt/ipsec-server/\nKMS服务器 不用配置，默认启动的。会自动激活内网的win，如果不能 自己找一个key手动激活。会自动续签。\nalist挂载 略过\nrclone挂载alist的webdav 略过\n挂载和扩容 我这里overlay分区比较大，2G。装日常插件足够了。甚至都可以装上桌面环境，但是如果跑kvm和太多docker 是肯定不够的。所以新建一个分区挂载到/opt\n点击 系统 - DiskMan 磁盘管理 ，编辑主硬盘msata /dev/sda 新建一个分区。sda3。然后返回 系统 - 挂载点 挂到/opt\n我这里，习惯用它的自动挂载，默认是自动挂载到 /mnt/sda3 的，所以 docker直接把储存目录 切换到 /mnt/sda3 或者软连接到/opt 都可以。\n我主路由器 没有跑虚拟机，虚拟机平台 是在另外一台机器上。\ndocker恢复 略过 如果 docker切换到之前存放docker的位置，会自动还原的。\ndocker - 配置 Docker 根目录 设置为msata上的空闲分区的自动挂载地址 /mnt/sda3\n端口转发 用 网络 - socat 来转发\n网络 防火墙 转发的端口，openwrt自己 不能用 公网地址+端口 访问（内网其他机器和外网可以访问），所以最好用socat 更简单省心\n系统备份和还原 建议直接用命令行来备份和还原，参考https://dev.leiyanhui.com/openwrt/backup 同时也建议使用squashfs-combined固件\n简单示例 备份\n1 2 3 4 mkdir /mnt/sda3/openwrt-backup tar -czvf /mnt/sda3/openwrt-backup/$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay # 计划任务 # 45 8 * * * tar -czvf /mnt/sda3/openwrt-backup/$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay 还原\n1 2 3 4 rm -rvf /overlay/* cd / tar -xzvf /mnt/sda1/openwrt-backup/XXXX-overlay.tar.gz reboot # 很重要 马上重启 还原后 一定马上重启 否则会带来一些其他奇奇怪怪问题\n科学软件配置 用暂时用passwall2 支持全局doh，自定义规则简单。但是 ipv6 好像会受影响，另外有几个编译版本bug也比较多。\nv2rayA 相对简单一些，只是单纯翻墙，不折腾自定义规则 那些乱七八糟的，可以用，也稳定\n另外推荐 openclash 界面复杂，但是使用并不复杂，而且功能好太多了。\n","date":"2023-01-13T02:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/my_use/","title":"openwrt 定制版本 我自用的版本 - 使用"},{"content":"alist支持主流网盘程序的挂载，并支持全部管理员转webdav，部分目录隐藏或者加密 ，以及针对个别目录单独管理 等等。。。\n但是有一些常见问题，官方没有给出解决方案。\nlxc + alpine linux 安装alist请参考 https://dev.leiyanhui.com/pve/lxc-nas-alist\nopenwrt下安装 三种方式，1是官方命令模式安装 2是插件安装luci-app-alist 3是docker安装\n插件安装最直观方便，但是在op里面 会显示出管理员密码 alist貌似是golang写的，而且支持json导出备份迁移方便，所以要不要docker安装，看个人需求吧。\ndocker安装 1 docker run -d --restart=always -v /opt/docker_file/op_alist:/opt/alist/data -v /:/openwrt -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name=\u0026#34;alist\u0026#34; --hostname \u0026#34;alist\u0026#34; xhofe/alist:latest ssl 加密通讯 op插件安装话可以直接配置证书，但是不建议。因为我们家用用户的证书通常都是短期的最长也就1年 维护麻烦。 所以证书都是统一管理的。\n我使用的国产的 nginxWebUI工具的docker版，在op上运行，统一管理内网证书，并反带所有内网的服务套上ssl， 详情查看：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl/\n上传文件504错误 这个主要是前端用nginx反代后出现的。因为nginx限制了后端超时时间。 Request failed with status code 504\n上传文件413错误 这个主要是前端用nginx反代后出现的。 因为nginx限制了上传文件大小。 如果是用的nginxWebUI，那么在对应的反代站点里面 设置额外参数 client_max_body_size 值51200m; #上传限制\n上传文件504错误 这个主要是前端用nginx反代后出现的。因为nginx限制了后端超时时间。 Request failed with status code 504\n如果是用的nginxWebUI，那么在对应的反代站点里面 设置额外参数 对照巷陌413错误的处理方式 分别添加额外参数\n1 2 3 proxy_send_timeout 7200; proxy_read_timeout 7200; proxy_connect_timeout 7200; nginx反向代理 最终代码如下，如果你用宝塔之类的，自行调整。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 server { server_name pan.jia.leiyanhui.com; listen 50443 ssl http2; ssl_certificate /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/fullchain.cer; ssl_certificate_key /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/*.jia.leiyanhui.com.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 50081; if ($scheme = http) { return 301 https://$host:50443$request_uri; } error_page 497 https://$host:50443; #解决http到ssl端口的400错误; client_max_body_size 51200m; #上传限制; proxy_send_timeout 7200; #超时时间send和上传有关; proxy_read_timeout 7200; #超时时间read和下载有关; proxy_connect_timeout 60; #超时时间connect和于后端alist建立连接有关; location / { proxy_pass http://10.1.1.1:5244; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $http_host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header X-Forwarded-Proto $scheme; proxy_redirect http:// https://; } 其他问题 如果是上传 常见系统镜像，建议使用对应网盘的标准客户端来处理。 因为会本地验证后秒传。\n","date":"2023-01-13T02:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/alist/","title":"openwrt 挂载网盘alist常见问题整理"},{"content":"openclash 可以说是最强大的科学软件，缺点就是 略微繁琐界面不友好，另外对路由器性能有要求，低端的硬路由刷op的情况 就不太适合。x86的话因为性能富裕，所以非常适合。\nopenclash 安装后，只要添加订阅地址后 就可以 愉快使用。如果有更多要求部分地方可能还需要自己手动调整一下。\n记录一下 我的配置\n在线订阅转换 推荐使用 acl4ssr oneline full，添加Emoji 启用 udp。弄完之后 要重启一下 openclash\n自动测速自动切换节点 Dashboard 控制面板 ，Selector 选择 自动\nipv6支持和ddns无法获取ipv6地址的处理 openwrt 全局设置：dns设置 允许 IPv6 类型 DNS 解析\nddns myddns_ipv6 -\u0026gt; IP 地址来源 -\u0026gt; 接口 接口选择 br-lan\n节点不支持ipv6的情况下 会自动走v4,当然也打不开纯v6站点\n模式设置里面 IPv6 流量代理 不建议打开\n指定网站强制走代理 例如 dev.leiyanhui.com 我同时在国内cdn 和 GitHub page 两个镜像，因为国内cdn延迟更新，所以自己访问 强制到 GitHub\n在全局设置 访问控制 绕过中国大陆 IPv4 黑名单 里面添加 dev.leiyanhui.com 即可，同理可以ipv6的也添加上域名\n全局doh/dot的实现 全局设置 dns 打开 本地 DNS 劫持 自定义上游 DNS 服务器 *远程域名解析 追加上游 DNS 追加默认 DNS 禁止 Dnsmasq 缓存 DNS\n然后 在下面的设置自定义上游 DNS 服务器 里面 只勾选 http和 tls 类的dns，也可以自己添加\n需要自定义配置文件的一些功能实现 自定义规则 可以附加到 机场的规则前面。 全局设置 规则设置 自定义规则 勾选上，规则 添加到 设置自定义规则（优先匹配） 的rules:里面\n全局被走代理 检查规则没问题，但是用国内的网站查询ip依旧是梯子的工具。\n经过测试，在 openclash 代理模式 切换一次 即可。 常用ip查询网站：\nhttps://ip.skk.moe/ （境外cf，openclash默认绕过）\nhttps://ip.cn/ (注意，这个网站在境外cf) https://ip138.com/ （境内，不少机场默认阻断） https://ip.chinaz.com/ （境内，不少机场默认阻断） http://checkip.synology.com/ (境内) https://test-ipv6.com/ (境外，可以检测ipv6) http://checkip.dyndns.com （境外，IPv4 ） http://checkipv6.dyndns.com （境外，IPv6 ）\n指定网站强制不走代理 例如\n1 2 3 4 5 6 7 8 9 10 - DOMAIN-SUFFIX,checkip.dyndns.com,DIRECT - DOMAIN-SUFFIX,checkipv6.dyndns.com,DIRECT - DOMAIN-SUFFIX,checkip.synology.com,DIRECT - DOMAIN-SUFFIX,ifconfig.co,DIRECT - DOMAIN-SUFFIX,api.myip.com,DIRECT - DOMAIN-SUFFIX,ip-api.com,DIRECT - DOMAIN-SUFFIX,ipapi.co,DIRECT - DOMAIN-SUFFIX,ip6.seeip.org,DIRECT - DOMAIN-SUFFIX,members.3322.org,DIRECT - DOMAIN-SUFFIX,github.dev,DIRECT 内网指定设备强制走固定线路 比如，内网某一个手机强制 走 香港01 这个线路\n1 - SRC-IP-CIDR,192.168.1.201/32,26, 🇸🇬 新加坡 01 | 专线 或者\n1 - SRC-IP-CIDR,10.0.0.1/32,🇭🇰 香港节点 ","date":"2023-01-13T02:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/openclash/","title":"openwrt 下openclash 常用规则和配置"},{"content":"之前用 smartdns+ssrp 来解决，后来发现过于复杂。\n简单的方法 还是用 openclash 或者 passwall2。但是openclash 规则设置过于繁琐。所以我这里简单的用passwall2 来实现。\n本文停止更新，新文章优化解决方案：\npasswall2 方案简单容易且靠谱 https://dev.leiyanhui.com/openwrt/passwall2\nssrp+smartdns 略微麻烦 https://dev.leiyanhui.com/openwrt/ssr_doh\nopenclash 自由 强大 https://dev.leiyanhui.com/openwrt/openclash\n如果可以接受openclash的繁琐，还是建议openclash，自由，强大 ：\n本文基于 passwall2\n实现目标 1、国内不走代理，dns走doh到阿里云，境外ip全部走代理，doh用cloudflare 2、可以指定部分域名走 或者 不走 代理\n配置passwall2 可能需要卸载smartdns，然后安装luci-app-passwall2 关闭其他代理工具。\n节点订阅 配置好，以及自动更新 订阅 启动切换 等等\n配置代理环境 基本配置 mian 这个地方 Node 选分流总节点 其他看情况自己配置，他自带了一个Direct规则，内置的国内dns 还有常用的苹果 微软等规则。这个选直连，其他的看自己需求 包括奈飞 和去广告 还有国内那个 china等等。\n最关键的是 下面那个 其他或者叫做* 默认 这行是配置好首选节点\n这就完成了 基本的上网环境\n全局doh配置 基本设置，dns直连dns，选doh选阿里云。远程 DNS 协议 同样设置 选cf。\n完毕\n自定义两个规则 passwall2 自带的规则 基本上可以满足日常使用。不需要额外定制。但是有一些特殊的情况。\n强制走代理的域名 新建以规则名称my_proxy 拖到 最前面，编辑内容。 域名这个地方,有说明，我这里 以本站为例,输入下面两行任意一行都是可以的\n1 2 dev.leiyanhui.com full:dev.leiyanhui.com 返回，基本设置，给 my_proxy 配置一个线路\n强制不走代理的域名 新建以规则名称my_direct 拖到 最前面my_proxy之前，编辑内容。\n1 2 test-ipv6.com dyndns.com 返回，基本设置，给 my_direct 设置为直连\n测试 可能需要重启浏览器 或者清理本机缓存，打开 test-ipv6.com 查看自己的ip 不在是梯子的ip， 还有：http://checkipv6.dyndns.com http://checkip.dyndns.com/\nping dev.leiyanhui.com 也应该返回国外的ip段（gitbub.io），用国内在线ping 工具返回国内ip（阿里云） 打开网站查看 dev.leiyanhui.com 查看证书是le的 也就是强制走了代理。国内的是亚洲诚信的证书\n进阶ip直连 直连doh的ip，可以查看之前的文章 末尾 https://dev.leiyanhui.com/openwrt/ssr_doh\n配合smartdns smartdns 支持预更新dns等功能 支持ttl缓存等等 如果性能够用可能会舒服一些更方便一些。\n如果需要，可以另外搭建smartdns 到docker，这里设置为smartdns的地址即可。\n","date":"2023-01-12T08:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/passwall2/","title":"openwrt上配置doh/dot，以及科学工具分流解析的方法 以及自定义分流等 简单方法"},{"content":"简单的说明 最简单的方法 是用 passwall2\n本文停止更新，新文章优化解决方案： passwall2 方案简单容易且靠谱 https://dev.leiyanhui.com/openwrt/passwall2\n科学工具 用 ssrp luci-app-ssr-plus dns 工具用 luci-app-smartdns\nsmartdns 里面添加两种dns上游服务器\n一组境内的 组名称 china，一组境外的，组名称 gfw\n境外的doh均勾选上 从default默认服务器组中排除\n同时 smartdns 也开启两组服务\n常规设置里面，端口修改掉不要用53 防止故障导致全家断网，我这里用 6453\n第二DNS服务器 也开启 端口 6553 ，服务器组 选择 gfw\n这样 在 6453端口上 走国内doh解析，在 6553 走国外doh解析\n然后 在 ssrp里面 访问国外域名 DNS 服务器 自定义输入 127.0.0.1:6553 国内 DNS 服务器 127.0.0.1:6453\n这样就ok了\nsmartdns 支持明文上游dns 也支持 doh和dot\n我在用的上游dns china组 1 2 https://dns.alidns.com/dns-query https://doh.pub/dns-query 台湾也有一组：https://dns.twnic.tw/dns-query\ngwf组 1 2 3 4 https://dns.google/dns-query https://cloudflare-dns.com/dns-query https://dns.quad9.net/dns-query https://doh.sb/dns-query 关键点来了 如果ssrp上的用的ip分流。。他需要先解析出来 再判断，所以。。就会导致 所有的网站 可能都无法访问。。。\n解决方法也简单，就是上游doh服务器，用ip直接链接。而不是用域名。。\n阿里云的也可以这样写\n1 2 https://223.5.5.5/dns-query https://223.6.6.6/dns-query 腾讯的貌似不支持直接ip的方式，不过腾讯的doh和dot 一直不怎么稳定，测试运行了几百年了还是不稳定\n360的 电信移动 https://101.226.4.6 https://218.30.118.6 360的 联通 https://123.125.81.6 https://140.207.198.6\ncf的可以这样写 https://1.1.1.1/dns-query google的这样写 https://8.8.8.8\n为什么不选择其他工具 pypass 内置了一个smartdns，但是pypass 自己有域名 走代理和不走代理的 配置bug ，也就是无效。暂时不支持新版会不会解决\nclash 规则过于复杂，没时间折腾\nmosdns 不错，支持域名别名解析，比如 可以强制自己在国内对象储存和githubpage 同时存在的网站，可以强制别名到 xxx.github.io ,但是，mosdns 真的太简陋了。\n同时 smartdns支持 域名 指定的上游组解析，所以别名解析 也不需要了。\n","date":"2023-01-12T07:12:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/ssr_doh/","title":"openwrt上配置doh/dot，以及科学工具分流解析的方法"},{"content":"前 家人要听良友电台，之前都是使用web方式 给她在手机桌面创建webapp到 https://ly729.airtime.pro/embed/player?stream=s1\u0026amp;skin=2\n而后发现诸多不便\n于是还是简单弄一个app\n源地址 从 https://tx.729ly.net/zh-sc/ 获取到三个地址\n1 2 3 var source1 = \u0026#34;https://ly729.out.airtime.pro/ly729_a\u0026#34;; var source2 = \u0026#34;https://c20.radioboss.fm/stream/572\u0026#34;; var source3 = \u0026#34;https://listen.729ly.net:8001/ly729_a\u0026#34;; 仓库地址 https://github.com/joyanhui/radio_ly\n使用库 1 2 3 4 cupertino_icons: ^1.0.2 audioplayers: ^5.2.1 flutter_launcher_icons: \u0026#34;^0.13.1\u0026#34; url_launcher: ^6.2.2 自己编译 linux下需要\n1 2 3 sudo apt-get install clang cmake ninja-build pkg-config libgtk-3-dev liblzma-dev sudo apt-get install libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev sudo apt-get install gstreamer1.0-plugins-good gstreamer1.0-plugins-bad windows下\n1 https://github.com/bluefireteam/audioplayers/blob/main/packages/audioplayers_windows/README.md#setup-for-windows 自定义源测试地址 1 2 http://satellitepull.cnr.cn/live/wxnxxwgb/playlist.m3u8 http://sk.cri.cn/887.m3u8 ","date":"2023-01-11T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/new/radio-ly/","title":"良友电台app"},{"content":"先说为什么不用浏览器自带的。原因很简单：需要用多个浏览器！ 另外 可信度不高，几乎都没有历史回档功能 ，我曾经在edge和火狐 搞丢一次密码。 最后万幸的是，同步过一次icloud，然后从icloud找回来的。\nedge 应该是最近最火的了，但是edge 在win下，需要跟随系统更新，而且帐号登录环境复杂的时候经常自动退出，不胜其烦。\n其次啰嗦几句常用的浏览器：火狐，火狐 的webapp功能砍掉了。然后有插件可以实现，但是会导致一些热键问题，比chrome 系差了不是一点半点。\n当然 火狐最大的优势依旧是 在linux下 多数发行版自带，arch上不需要aur就可以安装。还有linux下硬解码的优势。\nchrome\u0026hellip;国内环境，自动同步略微麻烦一些,标签在多设备发送 更是要求全局 都科学。。。\nsafari 不用说了。。。仅macos和ios\n这就导致我常用的浏览器 是 edge+firefox+safari\n先说 目前的方案：bitwarden/KeePass + floccus + 坚果云 + 一个win虚拟机\n对密码同步的需求 1、必须支持ios平台 2、最好可以同步到自己的储存空间（安全） 3、历史回档/回收站 4、必须支持firefox 5、有导入导出\n对书签同步的要求 1、必须是可以直接替代浏览器默认收藏的 2、最好支持ios 3、历史回档/回收站 4、必须支持firefox 5、有导入导出\n密码同步 LastPass 已经开始收费，bitwarden 目前免费版够用，另外bitwarden 支持部分中文,控制台还有客户端 都是中文的。支持firefox safari ios。 在ios下可以替代自带的密码管理器\n当然，bitwarden 是把密码同步到了bitwarden 官方服务器里面。如果不放心可以考虑使用 KeePass，支持webdav同步。快捷键自动填写等等\nKeePass大致流程 先配置好KeePass，创建数据库并加密，配置后保存数据库文件，然后关闭数据库。\n然后坚果云中创建文件夹(KeePass)，把KeePass的密码文件上传进去，然后在keepass再配置一次。\nkeepass打开选择url打开 https://dav.jianguoyun.com/dav/KeePass/文件名\n官网说明：https://help.jianguoyun.com/?p=3348\nios下 使用 keepassium strongbox 都可以 在设置里面 密码 密码选项 选中 即可\n商店里面有一个 叫 奇密(FantasyPass - iKeepass) 的国产软件，12块钱，经过测试发现，卡顿离谱 莫名其妙问题很多，已经退款\nstrongbox 免费版本每次都要输入主密码，如果主密码比较复杂 就很烦躁！！！最多只能保存10分钟\nkeepassium 免费版本 目前看来 好像比较好用，但是免费版本只支持一个数据库，个人用 也足够了\n这几个 在部分网站上 都无法自动输入用户名。。。有一些蛋疼\n书签同步 书签同步。书签没有太大私密要求，我选择 floccus 直接到坚果云的webdav了。简单省心。然后自己在alist 和 rclone中 做一次定时异地备份。\n值得注意的有三点：\n坚果云的挂载点 要 ： https://dav.jianguoyun.com/dav/你创建的同步文件夹\n第二个密码 是文件加密密码，如果你不想加密 留空即可，否则对应的文件无法直接从其他浏览器打开\nhtml格式 在手机端有解析问题，会报错。建议选择 xbel 格式\n最后关于坚果云的数据安全问题 密码和书签 都可以加密后储存\n坚果云支持webdav，可以从系统中挂载后，另外自行sync一份到本地 或者其他云盘\n","date":"2023-01-08T15:14:20+08:00","permalink":"https://dev.leiyanhui.com/os/brower-sysnc/","title":"跨平台跨浏览器书签和密码同步公工具"},{"content":"家里路由器是openwrt x86，内外有跑一些服务。这里用路由器上配置nginx+ssl，然后内网的所有web服务都经过nginx到公网，因为家用宽带不只\nnginxwebui是国产基于java的开源nginx配置文件生成器，用于替代死板的nginx-proxy-manage 。\n优点是 更加灵活 强大 支持中文，几乎支持所有的nginx功能的可视化配置。\n缺点是 略微繁琐，尤其是不能自动载入配置文件，创建项目后，要手动在webui里面，点替换和重载。\ndocker安装 nginxwebui 官网docker实例是用的host模式运行，不建议。还是自定义端口映射。\n我这里需要3个端口 nginxwebui管理端口50088，http 端口50081 https 端口50443\n1 docker run -itd --restart=always --name=nginxwebui --hostname nginxwebui -e BOOT_OPTIONS=\u0026#34;--server.port=50088\u0026#34; -p 50081:50081 -p 50088:50088 -p 50443:50443 --privileged=true cym1102/nginxwebui:latest 证书目录 是保存在： /home/nginxWebUI/.acme.sh/ 下面\n配置文件/home/nginxWebUI/nginx.conf 。\n如果需要对证书单独管理，可以映射出来。也恩可以用docker cp 定时复制出来。\n1 docker run -itd -v /opt/docker_file/op_nginxWebUI:/home/nginxWebUI --restart=always --name=nginxwebui --hostname nginxwebui -e BOOT_OPTIONS=\u0026#34;–server.port=50088\u0026#34; -p 50081:50081 -p 50088:50088 -p 50443:50443 --privileged=true cym1102/nginxwebui:latest 而后在 nginxwebui 内部 再反代 管理端口出来 套上ssl 即可从外网ssl访问。\n为了方便备份，我这里没有映射目录出来。记得自行定时清理日志：/home/nginxWebUI/log/nginxWebUI.log\n注意： http://10.0.0.1:50088/ web界面 打开可能会空白，这个\u0026hellip;.大概是因为java启动慢的原因，等一会 刷新一下就好了。\n一个典型的反代配置 包括http自动跳转ssl\n1 2 3 4 5 6 7 8 9 转发类型 http 监听端口：这个如果要开启ssl的话要输入ssl端口 50443 选择密码文件：这个是base的密码 开机ssl：是 选择内置证书：（提前配置） 开启https：是 ssl协议版本：全部勾选 http跳转https：是 从该端口跳转：第一个留空 第二个输入ssl的端口后 50081 这样就可以实现，访问http的时候自动跳转到ssl 最终配置文件大概如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 server { server_name 域名; listen 50443 ssl http2; ssl_certificate /home/nginxWebUI/.acme.sh/jia.leiyanhui.com/fullchain.cer; ssl_certificate_key /home/nginxWebUI/.acme.sh/jia.leiyanhui.com/jia.leiyanhui.com.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 50081; if ($scheme = http) { return 301 https://$host:50443$request_uri; } location / { # 自己; proxy_pass http://10.0.0.1:50088; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $http_host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header X-Forwarded-Proto $scheme; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; proxy_redirect http:// https://; } } 自动备份到阿里云镜像 https://dev.leiyanhui.com/docker/img-to-aliyun/\n1 10 3 * * 6 sh /etc/docker_up_aliyun_nginxWebUi.sh 使用nginxWebUI反代 主路由的一个小问题 如果op主路由配置了 根据域名跳转（https://dev.leiyanhui.com/openwrt/acme-ssl/），op需要绑定一个不属于最终配置文件的域名 。或者 使用下面的方法。 另外 op里面的网页终端需要单独处理（我选择 直接弃用）。\n还有一个方案 是 不传递host参数，然后直接访问 https://你的域名:端口/cgi-bin/luci/ 也可以解决。\n关于使用http协议访问https端口的400错误处理 例如我正常访问我的路由器应该是https://域名:50443如果用http://域名:50443访问端口还是https的端口就会提示400错误。 因为服务是家人也用。 不能指望他们理解http（S）这些。所以我采取的方法是直接拦截错误，并跳转到正确的首页地址。\n首先这个错误是 497 错误，nginxWebUI支持参数模板，添加一个参数模板，名字随意，添加参数error_page 497 值https://$host:50443; #解决http到ssl端口的400错误 然后用默认配置应用到反向代理。完毕\n最好的解决方案 编辑对应的ningxWebUi反向代理配置， 添加一个 = / 自定义localtions 添加参数 return 值 301 https://$host:50443/cgi-bin/luci （意思就是网址后面没有东西的情况下跳转到后面地址）即可 （注意好要清理浏览器缓存不然不会生效） 最终代码如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 server { server_name op.jia.leiyanhui.com; listen 50443 ssl http2; ssl_certificate /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/fullchain.cer; ssl_certificate_key /home/nginxWebUI/.acme.sh/*.jia.leiyanhui.com/*.jia.leiyanhui.com.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; listen 50081; if ($scheme = http) { return 301 https://$host:50443$request_uri; } error_page 497 https://$host:50443; #解决http到ssl端口的400错误; location = / { # op自动跳转; return 301 https://$host:50443/cgi-bin/luci; } location / { # op代理; proxy_pass http://10.1.1.1/; proxy_redirect http:// https://; } } 进阶 1、解决 在web界面直接点击 域名 链接打开的是不带端口的导致非标端口打不开的情况。 https://github.com/joyanhui/nginxWebUI 2、解决 定时续签2点拥堵的问题， 下载 我自己的修改的 jar，替换到docker里面\n1 2 3 4 5 docker exec -it nginxwebui rm /home/nginxWebUI.jar #删除原版jar wget https://github.com/joyanhui/nginxWebUI/releases/download/2st/nginxWebUI.jar docker cp nginxWebUI.jar nginxwebui:/home/nginxWebUI.jar # 复制宿主机上的修改过的jar进去 docker restart nginxwebui #重启 rm -rf nginxWebUI.jar 下载地址 https://www.123pan.com/s/EqorVv-n0nPA 提取码:yhjt\n详细 https://github.com/joyanhui/nginxWebUI\n其他问题 nginxwebui 和 nginx-proxy-manager 都同样的问题，就是在web界面直接点击 域名 链接打开的是不带端口的。在前者的github 提交过issues但是作者没有回应。后at作者后，作者表示：这个界面是展示信息用，不是给你高强度使用的 不知所云。\n已经自己修改 https://github.com/joyanhui/nginxWebUI\n不过nginxwebui 相对 nginx-proxy-manager 依旧适合非标端口的 如果是内网使用，家用宽带没有标准端口的情况下，可以通过一个简单方法实现，就是在路由器上转发跳转一次，详情：https://dev.leiyanhui.com/openwrt/acme-ssl/\n另外 nginxwebui 的证书申请 有几个小遗憾，1 证书检查时间固定在凌晨2点不可以修改，还是很拥挤的。2 没有日志显示，如果出错你也不知道。。。只能等待。。。\n","date":"2023-01-07T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl/","title":"docker运行nginx 并反代内网的一些服务2(nginxwebui修改版)"},{"content":"openwrt下配置ipsec,基于luci-app-ipsec-vpnd 注意不是luci-app-ipsec-server 后者有一些奇奇怪怪问题。\n默认设置发现 外网无法拨上来。随后发现内网也无法拨上来。\n配置文件 1 nano /etc/ipsec.conf 找到\n1 # strictcrlpolicy=yes 取消注释，然后重启ipsec 就好了。\n1 /etc/init.d/ipsec restart 启动脚本 如果重启后 这个上面的文件自动恢复，那就是有其它脚本处理过这个文件。经过检查 发现 是 /etc/init.d/ipsec 这个脚本，。找到 start_service() 这段 的config setup\n修改下面的内容\n1 2 3 4 5 config setup # strictcrlpolicy=yes # edit this form /etc/init.d/ipsec strictcrlpolicy=yes uniqueids=never 其他无法访问内网 等其他问题 没发现。都正常。\n防火墙处理 另外 网络-防火墙-转发 将拒绝改为接受 ， 检查 通讯规则里面 应该有自动添加的 500 和4500 两个端口\n如果是二级路由器 还需要在主路由做端口转发，这个不用多说了。\n另外防火墙规则，我vpn网段是 10.10.10.2/24 添加如下内容（非必须）\n1 2 3 tables -t nat -I POSTROUTING -s 10.10.10.0/24 -j MASQUERADE tables -I FORWARD -i vpn -s 10.10.10.0/24 -j ACCEPT ptables -I INPUT -i vpn -s 10.10.10.0/24 -j ACCEPT 如果想让vpn客户端也可以 科学上网，需要在对应的科学软件里面配置。 比如：ssrp的话，默认配置的情况下，只从访问控制 接口控制里面 选中两个vpn接口即可\n启动ipsec vpn 系统，启动项，找到 ipsec 重启 或者启动\n","date":"2023-01-07T04:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/ipsec-server/","title":"openwrt 下配置IPSec "},{"content":"openwrt更新的时候 出现 Signature check failed,，然后部分软件包也有问题，就是源的签名有问题。\n在 某些修改版固件上常见，尤其腾讯云的源，解决方法 就是找到\n/cgi-bin/luci/admin/system/packages/ipkg OPKG 基础配置 或者直接编辑 /etc/opkg.conf 把最后一行 option check_signature 或者 option check_signature 1 注释掉\n","date":"2023-01-06T15:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/source-signature-err/","title":"openwrt Signature check failed.错误的解决"},{"content":"在使用openwrt的端口转发时候遇到一个小问题，就是 外网可以用 公网IP/域名 + 端口的方式 访问内网。但是内网内不可以这样访问。\n经过电报群里面大佬Gx Hunter的提醒，检查了一下端口回流。然后查阅其他人文章 发现 是docker导致的端口回流问题。\n简单处理放方法\nvi /etc/sysctl.d/11-br-netfilter.conf 检查和修改下面三行内容，没有的话添加，有的话修改\n1 2 3 net.bridge.bridge-nf-call-arptables=0 net.bridge.bridge-nf-call-ip6tables=0 net.bridge.bridge-nf-call-iptables=0 vi /etc/sysctl.conf 检查和修改 ，没有的话添加，有的话修改 文件不存在的话创建，内容也是前面的三行\n验证sysctl -p 输出内容应该也是这三行内容，检查无误后，重启sysctl\n1 /etc/init.d/sysctl restart ","date":"2023-01-06T15:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/forwards-err/","title":"openwrt端口转发的一个小问题，端口回流的问题"},{"content":"报错信息\n1 docker: Error response from daemon: driver failed programming external connectivity on endpoint alist (53d606bcf21ac0e0943a9d21eddb3934f0d2f71c75a8fa7fb652685e3fdd9253): (iptables failed: iptables --wait -t nat -A DOCKER -p tcp -d 0/0 --dport XXX -j DNAT --to-destination 172.17.0.2:XXX ! -i docker0: iptables: No chain/target/match by that name. 检查了一圈没有找到问题，然后从openwrt的luci里面重启了一下docker 解决。。。\n","date":"2023-01-06T15:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/docker-iptable-err/","title":"openwrt上的docker提示iptable错误的解决方案"},{"content":"我这里选择用docker运行,需要你先在openwrt上配置好docker。\n1、注册配置好cf 登录后，在cf点击域名/网站， 点击左侧的 流量 -》 Cloudflare Tunnel 启动 Cloudflare Zero Trust 仪表盘\n在仪表盘 选择 access -》 Tunnel 按照提示配置 即可。\n路由上直接运行 仪表盘提示的docker命令\n","date":"2023-01-06T15:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/cloudflare-net/","title":"openwrt上配置cloudflare内网穿透"},{"content":"dns 是非常古老的协议，非常容易劫持 容易泄露隐私。主要是劫持这点非常不方便。\ndoh 也就是 dns over https，就是让dns协议去走https协议，可以完全防止dns污染，也防止隐私泄露。主流系统都一直支持自行配置，但是在每台设备上弄 还是麻烦。 所以 还是弄到路由器上省心。\n本文停止更新，新文章优化解决方案：\npasswall2 方案简单容易且靠谱 https://dev.leiyanhui.com/openwrt/passwall2\nssrp+smartdns 略微麻烦 https://dev.leiyanhui.com/openwrt/ssr_doh\nopenclash 自由 强大 https://dev.leiyanhui.com/openwrt/openclash\n如果可以接受openclash的繁琐，还是建议openclash，自由，强大 ：\n安装插件https-dns-proxy\n1 2 3 4 5 6 #核心 opkg install https-dns-proxy #网页界面 opkg install luci-app-https-dns-proxy #中文 opkg install luci-i18n-https-dns-proxy-zh-cn 中文语言包 好像失效了。找到一个 https://openwrt.pkgs.org/19.07/openwrt-luci-x86_64/luci-i18n-https-dns-proxy-zh-cn_2021-07-29-1-1_all.ipk.html\n注意 https-dns-proxy 安装后会默认启动，并接管dns，且默认使用google和cf的dns 墙内肯定 会导致全局网络无法dns，需要尽快去配置为国内可用的。\n常用doh服务商 测试\n1 2 curl --http2 -H \u0026#39;accept: application/dns-json\u0026#39; https://1.1.1.1/dns-query?name=cloudflare.com curl https://dns.alidns.com/resolve?name=taobao.com 境内 腾讯/dnspods https://doh.pub/dns-query\u0026quot; 阿里云 https://dns.alidns.com/dns-query\n另外说一下阿里云的doh 阿里云的doh会强制显示client ip，google cf等没有这情况。但是总所周知，google和cf 都相对比较慢一些，而且需要你有网络学习环境。\n目前阿里云的doh在手动指定 client-subnet的时候设置为墙外ip会返回没有污染的结果。 这个小漏洞的起因应该是阿里云在墙外有上级纯净的权威dns\n但是我们可以在墙内使用阿里云doh来获取没有污染的结果。\n","date":"2023-01-06T15:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/doh/","title":"openwrt上配置doh，让全体用上doh (内有新解决方案)"},{"content":"nginx标准端口下，我们常用rewrite把80端口强制调整到https，那么在非标准端口下，应该如何处理？\n其实也很简单\n修改站点配置文件 大概内容如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 server { # http端口 listen 8880; # https端口 listen 8443 ssl http2; server_name 你的域名; index index.php index.html index.htm default.php default.htm default.html; root /www/wwwroot/Sites/site-vod; #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则 #error_page 404/404.html; #HTTP_TO_HTTPS_START if ($server_port !~ 8443){ rewrite ^(/.*)$ https://$host:8443$1 permanent; } #HTTP_TO_HTTPS_END ","date":"2023-01-06T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/web/nginx-http-https-no443/","title":"nginx 非标端口 http强制跳转https "},{"content":"xrdp 相对 vnc 以及第三方的其他的原创桌面的软件 例如 todesk rustdesk（自建） nomactione 以及 串流等，都有速度优势。\n但是xrdp 肯定是只支持x11/xorg的，目前只有gnome自带的远程（用户级且不稳定）支持Wayland\n在不同桌面的下 xrdp的处理也稍有差异，这里分别记录常见的\n安装配置xrdp 这里跳过桌面环境的搭建 kde、i3、xfce4 ，以及驱动部分，只记录xrdp相关的\n1 2 3 4 5 sudo pacman -S xorg-xinit # 一般桌面应该都带了 sudo pacman -S base-devel #all 一些编译要用的包 yay -S xrdp yay -S xorgxrdp-glamor sudo pacman -S xorg-xrdb 声卡的处理要用pulseaudio\n1 2 3 4 sudo pacman -S pulseaudio sudo pacman -S sbc bluez yay -S pulseaudio-module-xrdp 处理启动脚本 xrdp 使用xinit 启动\n1 2 3 4 5 6 7 8 cp /etc/X11/xinit/xinitrc ~/.xinitrc #复制一个过来 nano ~/.xinitrc #注释掉最后的几行 #twm \u0026amp; #xclock -geometry 50x50-1+1 \u0026amp; #xterm -geometry 80x50+494+51 \u0026amp; #xterm -geometry 80x20+494-0 \u0026amp; #exec xterm -geometry 80x66+0+0 -name login pulseaudio 1 2 3 # 声音部分可能需要 有的桌面环境不需要 PULSE_SCRIPT=/etc/xrdp/pulse/default.pa pulseaudio --daemonize=no pulseaudio \u0026amp; 添加需要启动的桌面 i3w / dwm 添加一行\n1 exec i3w gnome 1 2 3 unset SESSION_MANAGER unset DBUS_SESSION_BUS_ADDRESS exec dbus-launch gnome-shell --x11 kde 1 2 export DESKTOP_SESSION=plasma /usr/lib/plasma-dbus-run-session-if-needed startplasma-x11 xfce4 1 2 3 unset SESSION_MANAGER unset DBUS_SESSION_BUS_ADDRESS exec dbus-launch startxfce4 后续处理 Xwrapper 1 2 sudo nano /etc/X11/Xwrapper.config allowed_users=anybody 启动xrdp 1 2 sudo systemctl enable xrdp sudo systemctl start xrdp ","date":"2023-01-02T09:40:20+08:00","permalink":"https://dev.leiyanhui.com/arch/xrdp-all/","title":"archlinux 各种桌面环境下的xrdp的配置"},{"content":"选择 用 https://hub.docker.com/r/linuxserver/webtop\n默认用户名：abc 密码：abc\n3D加速 Ubuntu 1 --device=/dev/dri:/dev/dri fuse 宿主机要安装fuse\n1 --privileged 另外一个方案 是\n1 2 --device /dev/fuse \\ --cap-add SYS_ADMIN \\ 端口 3000 是web-vnc 3389 和22 不用多说\n1 2 3 -p 10100:3000 -p 10101:3389 -p 10102:22 ubuntu 3D 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 docker run -d \\ --name=webtop-ubuntu \\ --privileged \\ --security-opt seccomp=unconfined \\ -e PUID=1000 \\ -e PGID=1000 \\ -e TZ=Asia/Shanghai \\ -e SUBFOLDER=/ \\ -e KEYBOARD=en-us-qwerty \\ -e TITLE=webtop-ubuntu \\ -p 10100:3000 \\ -p 10101:3389 \\ -p 10102:22 \\ -v /home/yanhui/mnt/nvme/webtop-ubuntu:/config \\ -v /var/run/docker.sock:/var/run/docker.sock \\ --device=/dev/dri:/dev/dri \\ --restart unless-stopped \\ lscr.io/linuxserver/webtop:ubuntu-kde 输入法 1 sudo apt install fcitx5 fcitx5-rime 另外需要编辑 /init 实现自动启动\narch kde的镜像 有点问题，xrdp连不上\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 docker run -d \\ --name=webtop-arch \\ --privileged \\ --security-opt seccomp=unconfined \\ -e PUID=1000 \\ -e PGID=1000 \\ -e TZ=Asia/Shanghai \\ -e SUBFOLDER=/ \\ -e KEYBOARD=en-us-qwerty \\ -e TITLE=webtop-arch \\ -p 10100:3000 \\ -p 10101:3389 \\ -p 10102:22 \\ -v /home/yanhui/mnt/nvme/webtop-arch:/config \\ -v /var/run/docker.sock:/var/run/docker.sock \\ --device=/dev/dri:/dev/dri \\ --restart unless-stopped \\ lscr.io/linuxserver/webtop:arch-i3 ","date":"2023-01-01T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/docker-linux-desktop/","title":"docker 一个可用的完整桌面系统  "},{"content":"旧版查看 ：https://dev.leiyanhui.com/all-in-one/diy/\n安装和下载 https://www.123pan.com/s/EqorVv-K2nPA 提取码:arch 下载后解压，然后用ventoy，用支持x11转发的ssh客户端（例如 MobaXterm） 登录 用户名yanhui 密码 1 root 密码也是 1 但是root默认禁止登录。\n简明使用方法 https://dev.leiyanhui.com/all-in-one/arch-aio-use/\n部分需要你继续处理的 仅限2022-12-29 版本 ： 修改服务引导顺序\n使用桥接网络 https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/\n自动挂载其他磁盘的案例 https://dev.leiyanhui.com/arch/auto\u0026ndash;dock-kvm/\n其他常见问题 https://dev.leiyanhui.com/all-in-one/faq\n","date":"2022-12-30T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/arch-aio/","title":"选择arch-aio，彻底抛弃pve esxi unraid"},{"content":"旁路由方案的痛点 旁路由在出问题的时候，会影响网关配置为旁路由的设备使用。所以需要自动检测旁路由。\n首先 主路由要有完整权限的系统，就是有ssh权限的！ 爱快请使用分流方案 到二级路由以及环回等方式实现。\n旁路由的自动切换方案是很多的人的刚性需求。\n用软路由做主路由，主要问题两点，折腾过程中的失误一些不确定东西，容易断网。还有x86软路由 不少人遇到突然断电导致的无法启动后全家断网 自动切换旁路由方案，更加稳定一些。\n本文撰写于2019年，后期虽有修改补充，但是部分内容已经落后 有能力有时间的朋友，建议还是上x86 方案，不需要旁路由。 或者使用爱快分流方案。 https://dev.leiyanhui.com/route/ikuai-bypass-gfw/\n个人经验 爱快分流方案更为稳健，但是需要另外开一个op 以及docker来处理分流规则。 对设备内存要求较高（x32爱快不支持kvm docker可用镜像有限，爱快x64 需要4G内存安装 2G内存运行）。 如果内存紧张最好还是选择openwrt one only\n实现目标 主路由为硬路由负责上网和dhcp 顺带wifi，硬交换负责nas和机顶盒 台式机之间通讯。 去掉 x86 软路由 nas或者aio主机 或者 N1 或者闲置手机作为旁路由/旁网关(后面统称旁路由)\n重点目标： 旁路由离线后，所有设备自动切换到主路由网关 双旁路由A和B A正常运行的时候B删除不存在在需要调整的时候，复制一个独立的旁路由出来，自己手动修改主机电脑的网关到旁路由B测试没问题后替换A 可控制部分设备科学，部分设备不科学 ksm ipsec 科学 广告过滤 alist ddns nas 等，全部由旁路由或者aio/nas处理。 实现原理 旁路由用pve 或者 unraid 或者docker运行，关闭dhcp服务，静态ip（10.0.0.50），网关指定为主路由。也就是旁路由只是主路由下面的一个普通设备而已。\n双DHCP 存在抢dhcp的情况，所以dhcp本身占不了太多资源，还是主路由统一管理。 主路由10.1.1.1 开启dhcp dhcp的网关改为程序脚本控制 dhcp的租期尽可能短一些（120秒） 主路由 dhcp的ip段为 10.1.1.200-245 重点设备 静态绑定到 10.1.1.200以内的ip段。\n逻辑如下 主路由每隔一定时间 30秒或者1分钟，检查一次旁路由是否在线， 如果在线那么 dhcp服务的网关改为旁路由（10.0.0.50）\n如果旁路由不在线 那么dhcp服务的网关改为主路由（10.0.0.1）\n如果旁路由状态发生了变化，那么重启一次dnsmasq（或者再重启wifi 或者重启整个系统）\n科学部分，由openclash 实现分流，就是部分设备不走科学还有部分设备强制全局科学等等。 这个可以看我以前的文章 https://dev.leiyanhui.com/openwrt/openclash/\n具体实现 我主路由依旧用10多年前的 古董级k2p刷Padavan 固件，因为他的2.4G信号一直很好，Padavan 可以跑满1000M，5G的话也能跑到500M，另外一个5G路由器因为2.4G信号一般所以只能做ap用。 万兆由下级一个交换机处理，千兆以内众生平等 适合自己的才是最好的。\nPadavan 也是开源linux 和openwrt使用起来在系统层面差距不是很大 ，只要有ssh权限，所有固件都大同小异。\n旁路由 用 pve 跑的自己编译的openwrt，直接挂的vm跑的，因为我这边，8核心，64G内存 所以没用lxc和docker。\n脚本测试 padvan默认是关闭ssh的，系统管理 - 服务 找到ssh 打开，客户端登录ssh\n检查旁路由是否在线 1 curl http://10.1.1.50 这是openwrt的登录页面 他会自动301跳转，查看返回http代码 -m 3 是3秒\n1 curl -I -s -m 3 http://10.1.1.50 -w %{http_code} | tail -n1 应该会自动返回一个301代码, http://10.1.1.50/cgi-bin/luci/ 的话应该是返回403，这个先不管 如果是不存在的地址，那么应该是返回 000\n找dnsmasql的配置文件地址 1 find / -name \u0026#34;*dnsmasq*\u0026#34; 返回 结果 逐个检查后发现Padavan和openwrt一样 都是/etc/dnsmasq.conf 这个文件，同时已经分配的列表也是/tmp/dnsmasq.leases这个文件。\n在主路由中 设置dhcp的网关为 旁路由地址10.1.1.50 ，然后执行 cat /etc/dnsmasq.conf应该有一行dhcp-option=tag:lan,3,10.1.1.50\n测试配置文件的查找和替换 记住上面的那段 dhcp-option=tag:lan,3,10.1.1.50 用grep搜索试试\n1 grep dhcp-option=tag:lan,3,10.1.1.50 /etc/dnsmasq.conf |wc -l # 查找 如果有的话应该返回1 替换\n1 2 3 sed -i \u0026#34;s/dhcp-option=tag:lan,3,10.1.1.50/dhcp-option=tag:lan,3,10.1.1.1/g\u0026#34; /etc/dnsmasq.conf ## 检查 cat /etc/dnsmasq.conf 如果padavan的话不用这么麻烦 用nvram set dhcp_gateway_x=10.1.1.1 重启 dnsmasq openwrt 下面这两个命令 都一样的效果\n1 2 service dnsmasq restart /etc/init.d/dnsmasq restart Padavan 下可执行文件是 /usr/sbin/dnsmasq 通过查询网上资料得知 Padavan把服务脚本放在/sbin 直接执行/sbin/restart_dhcpd 即可\n编写脚本 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 #!/bin/bash default_gateway=\u0026#39;10.1.1.1\u0026#39; #主路由 IP up_gateway=\u0026#39;10.1.1.50\u0026#39; #旁路由 IP （需设置的主路由 DNS 地址） check_ip_available(){ #使用 ping 命令检测旁路由是否在线 ping -c 3 $1 | grep packets | awk \u0026#39;{print $4}\u0026#39; } change_gateway_dns(){ #网关 DNS 切换 nvram set dhcp_gateway_x=$1 #设置网关 nvram set dhcp_dns1_x=$1 nvram set dhcp_dns2_x=\u0026#34;\u0026#34; #设置 DNS nvram commit #提交修改 sleep 2 rc rc_service restart_net_and_phy #重启主路由 网络服务 restart_dns #重启主路由 DNS restart_dhcpd #重启主路由 DHCP # sleep 5 # reboot #自动修改后存在网络故障，可能需要直接重启路由器， 等待时间较长 } # If the gateway of the up close, the network is completely unusable res=`check_ip_available $up_gateway` #检测旁路由是否存在 current_gateway=`nvram get dhcp_gateway_x` #获取主路由当前网关 if [ $(($res)) -eq 0 ]; #检测结果等于 0，即旁路由不存在，应设置网关和 DNS 为主路由地址 then if [ \u0026#34;$current_gateway\u0026#34; != \u0026#34;$default_gateway\u0026#34; ]; then #如果当前网关地址不是主路由地址 echo \u0026#34;up_gateway to default\u0026#34; `change_gateway_dns $default_gateway` #将网关和DNS切换为主路由地址 并重启 fi echo \u0026#34;use default gateway , nothing changed\u0026#34; # 什么都不用做 exit 1 fi if [ $(($res)) -ne 0 ]; #检测结果不等于 0，即旁路由存在，应设置网关和 DNS 为旁路由地址 then if [ \u0026#34;$current_gateway\u0026#34; != \u0026#34;$up_gateway\u0026#34; ]; then #如果当前网关地址不是主路由地址 echo \u0026#34;up_gateway to auxiliary_gateway\u0026#34; `change_gateway_dns $up_gateway` #将网关和DNS切换为旁路由地址 并重启 fi echo \u0026#34;use auxiliary_gateway , nothing changed\u0026#34; # 什么都不用做 exit 1 fi #将脚本置于 /etc/storage/change_gatway.sh #设置脚本运行权限：`chmod +x /etc/storage/change_gatway.sh ` #保存脚本，防止重启丢失：`/sbin/mtd_storage.sh save` #自动定时运行脚本（每一分钟检测一次）： #`系统管理 - 服务 ` 调度任务 (Crontab) 加入 `*/1 * * * * /etc/storage/change_gatway.sh` 最后\n将脚本置于 /etc/storage/change_gatway.sh 设置脚本运行权限：chmod +x /etc/storage/change_gatway.sh 保存脚本，防止重启丢失：/sbin/mtd_storage.sh save 自动定时运行脚本（每一分钟检测一次）： 系统管理 - 服务 调度任务 (Crontab) 加入 */1 * * * * /etc/storage/change_gatway.sh\n以上内容抄 自：恩山，xuezou\n最后存在的问题 经过测试 无论是wifi接入还是网线加入的设备 都可以在短暂掉线后 自动切换成功\n","date":"2022-12-30T09:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/auto-change-gatway/","title":"旁路由方案，自动切换网关方案 参考"},{"content":"先禁止docker和kvm(libvirtd)开机自动 1 2 systemctl disable docker systemctl disable libvirtd 自定义一个开机服务rc-local rc-local.servic nano /usr/lib/systemd/system/rc-local.service\n1 2 3 4 5 6 7 8 9 10 11 12 13 [Unit] Description=\u0026#34;/etc/rc.local Compatibility\u0026#34; [Service] Type=forking ExecStart=/etc/rc.local start TimeoutSec=0 StandardInput=tty RemainAfterExit=yes SysVStartPriority=99 [Install] WantedBy=multi-user.target rc.local nano /etc/rc.local 查找/etc/rc.local.d/下的脚本并执行\n1 2 3 4 5 6 7 8 #!/bin/sh # /etc/rc.local if test -d /etc/rc.local.d; then for rcscript in /etc/rc.local.d/*.sh; do test -r \u0026#34;${rcscript}\u0026#34; \u0026amp;\u0026amp; sh ${rcscript} done unset rcscript fi 权限 目录 和开机自启 1 2 3 chmod a+x /etc/rc.local mkdir /etc/rc.local.d systemctl enable rc-local 创建自动脚本 sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh\n内容如下\n1 2 3 4 5 6 7 8 # 自动挂载 #mkdir-p mnt/nvme mnt/efi mnt/exfat mount /dev/nvme0n1p6 /home/yanhui/mnt/exfat mount /dev/nvme0n1p5 /home/yanhui/mnt/nvme mount /dev/nvme0n1p1 /home/yanhui/mnt/efi docker 和kvm的迁移 1 2 3 4 systemctl stop docker rsync -avzP /var/lib/docker /home/yanhui/mnt/nvme mv /var/lib/docker /var/lib/docker.bak \u0026amp;\u0026amp; ln -s /home/yanhui/mnt/nvme/docker /var/lib/ # 完成后 rm -rf /var/lib/docker.bak 1 2 3 4 systemctl stop libvirtd rsync -avzP /var/lib/libvirt /home/yanhui/mnt/nvme mv /var/lib/libvirt /var/lib/libvirt.bak \u0026amp;\u0026amp; ln -s /home/yanhui/mnt/nvme/libvirt /var/lib/ # 完成后 rm -rf /var/lib/libvirt.bak 修改docker和libvirtd服务启动顺序 1 cd /usr/lib/systemd/system/ 分别编辑 sudo nano libvirtd.service 和 sudo nano docker.service 在[Unit] 段 增加一行\n1 After=rc-local.service 这行是为了让docker和libvirtd 在rc-local这个服务之后启动，方便我们在 rc-local 内先挂载好磁盘 最后这两个服务设置为自动启动\n1 2 3 4 sudo systemctl enable libvirtd sudo systemctl enable docker sudo systemctl start docker sudo systemctl start libvirtd 另一个文章 https://dev.leiyanhui.com/arch/auto\u0026ndash;dock-kvm/\n","date":"2022-12-29T18:15:20+08:00","permalink":"https://dev.leiyanhui.com/arch/auto-mount-dock-kvm/","title":"arhclinux 下开机按照顺序挂载磁盘和启动docker以及kvm"},{"content":"libvirtd/virt-manager 找不到磁盘 libvirtd 应该在rc.local 之后启动\nvirt-manager 弹不出界面 1、 使用支持x11转发的客户端，win下使用 MobaXterm Macos和linux andriod下也又对应的客户端。如果是ios设备也有弯道解决方案 2、后台有virt-manager进程，那么先关掉 killall virt-manager\nvirt-manager 无法连接 1 Unable to connect to libvirt qemu:///system. 连不到virtqemud-sock 因为 libvirtd 没启动，可以用下面两种方式启动\n1 2 systemctl enable libvirtd systemctl start libvirtd 修改docker/kvm目录后，无法自动启动 自动挂载建议放到rc-local 服务用，docker和libvirtd 在rc-local之后启动 具体方法\n","date":"2022-12-29T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/faq/","title":"arch-aio 常见问题"},{"content":"本文基于 arch-aio，如果你是其他系统，请先处理好相关依赖。\n未完成\n查看 1 2 3 cat /etc/qemu/bridge.conf -------------- allow virbr0 virbr0 是自动创建的，并不能完成虚拟机 映射到外网\n继续查看其他情况\n1 2 ip a sudo brctl show 判断出来物理口是 enp1s0\n安装 networkmanager 我这里还是选用传统的networkmanager来处理，感觉更简单无脑一些。\n1 2 3 pacman -S networkmanager systemctl enable NetworkManager systemctl start NetworkManager 配置桥接br0 根据你的实际情况修改ip网关dns等\n1 nmcli connection add type bridge ifname br0 con-name br0 ipv4.addresses 10.1.1.1/24 ipv4.gateway 10.1.1.254 ipv4.dns 114.114.114.114 ipv4.method manual 我这里还是打算用dhcp所以执行下面的\n1 nmcli connection add type bridge ifname br0 con-name br0 桥接网卡子网卡 关联物理卡 1 nmcli connection add type bridge-slave con-name br0-slave1 ifname enp1s0 master br0 开启 1 2 3 4 nmcli connection up br0-slave1 nmcli connection up br0 nmcli connection show # systemctl restart NetworkManager 此时网络会断开，原来ip无法连接，可以使用br0上的ip 重新连接。 如果是dhcp 可以从路由器看到多分配到br0上的ip。\n重启 NetworkManager 后，或者重启物理机器后，两个ip都可以连接。\n后续可选处理 关闭br0的stp\n禁止物理卡开机启动 可以避免要占用两个ip的问题\n开启ip4转发 1 2 3 4 sysctl net.ipv4.ip_forward=1 nano /etc/sysctl.d/99-sysctl.conf -------- net.ipv4.ip_forward = 1 加载tun 1 2 3 4 modprobe tun nano /etc/modules-load.d/tun.conf ------------- tun 恢复之前的操作(未经测试) 1 2 3 4 5 6 sudo ip link set br0 down sudo brctl delif br0 enp1s0 sudo ip link set enp1s0 down sudo ip link set up enp1s0 #重启物理网卡 sudo ip link set dev br0 down #关闭 删除br0 sudo brctl delbr br0 参考文章：\nhttps://wiki.archlinux.org/title/Network_bridge\nhttps://blog.csdn.net/qq_42197548/article/details/120655449\n","date":"2022-12-29T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/","title":"arch-aio 的 virt-manager上配置桥接网络"},{"content":"下载 1、 arch-aio：https://dev.leiyanhui.com/all-in-one/diy/ 下载后解压到硬盘或U盘，要求分区格式是（exFAT/NTFS/UDF/XFS/Ext2(3)(4) ）\n2、 www.ventoy.net 下载 ，并安装到U盘 或者硬盘（新版支持无损安装了）\n3、 配置ventoy的自动启动以及VTOY_LINUX_REMOUNT ，可以使用arch-aio 下载链接里面的ventoy文件的json文件，具体参考 ventoy官网说明\n4、 配置 lnk.vtoy 等等，具体参考 ventoy官网说明，也可以在ventoy引导界面按下F2 浏览找到对应的 vhd.vtoy 文件\n启动 使用ventoy启动即可，具体参考 ventoy官网说明\n登录arch-aio 使用默认用户 yanhui 或 root 登录。\nwin客户端登录建议使用MobaXterm免费版\n修改密码 root和yanhui的密码 都要修改,yanhui\n1 2 passwd yanhui passwd root 可选shell和neofetch 1 2 3 sudo pacman -S fish neofetch #编辑 nano .bashrc 添加两行\n1 2 neofetch fish neofetch 是登录后自动打印系统信息，fish是一个还不错的shell终端，命令补充和提示好用一些，另外一个不错的shell 叫做nushell 安装后启动命令是nu\n.bashrc 文件是你命令行登录后自动执行的一个文件。可以让它自动启动一些脚本方便使用。\n检查和自动配置挂载 检查 使用 fdisk -l 和 lsblk 查看分区情况，使用 df -h 查看挂载情况。 值得注意的是，/dev/mapper/ventoy 的两个分区 是arch-aio 虚拟磁盘镜像的两个分区分别对应efi和/\n配置自动挂载 建议使用rc-local 这个系统服务来处理，不建议使用fstab\n以下实例直接从yanhui这个用户下处理\n1 2 3 4 5 6 cd ~ mkdir -p mnt/nvme mnt/efi mnt/exfat # 测试 sudo mount /dev/nvme0n1p6 /home/yanhui/mnt/exfat sudo mount /dev/nvme0n1p5 /home/yanhui/mnt/nvme sudo mount /dev/nvme0n1p1 /home/yanhui/mnt/efi 没问题后修改 sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh 内容\n1 2 3 mount /dev/nvme0n1p6 /home/yanhui/mnt/exfat mount /dev/nvme0n1p5 /home/yanhui/mnt/nvme mount /dev/nvme0n1p1 /home/yanhui/mnt/efi 重启测试\n迁移和配置docker和kvm docker 1 2 3 4 sudo systemctl stop docker sudo rsync -avzP /var/lib/docker /home/yanhui/mnt/nvme sudo mv /var/lib/docker /var/lib/docker.bak \u0026amp;\u0026amp; sudo ln -s /home/yanhui/mnt/nvme/docker /var/lib/ # 完成后 rm -rf /var/lib/docker.bak kvm/libvirtd 此步骤 可以不处理\n1 2 3 4 systemctl stop libvirtd rsync -avzP /var/lib/libvirt /home/yanhui/mnt/nvme mv /var/lib/libvirt /var/lib/libvirt.bak \u0026amp;\u0026amp; ln -s /home/yanhui/mnt/nvme/libvirt /var/lib/ # 完成后 rm -rf /var/lib/libvirt.bak 配置docker和libvirtd开机自动启动 先禁止他们的开机自动启动，改为从rc.local这个服务里面启动，已方便在挂载完成后再启动对应的服务\n1 2 systemctl disable docker systemctl disable libvirtd 修改 sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh 内容 添加两行\n1 2 systemctl start docker systemctl start libvirtd 2022-12-29版本这个默认文件的libvirtd少了一个字母d，注意修改以下 重启\n安装一个系统（win10为例） 安装镜像 先去弄一个win安装镜像,我这里有了\n1 mnt/exfat/iso/SW_DVD9_Win_Pro_10_22H2_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-20012.ISO 对应的目录是 /var/lib/libvirt/images windows virio驱动镜像 1 2 3 sudo pacman -S wget cd mnt/exfat/iso/ wget -c https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.225-2/virtio-win-0.1.225.iso 这个网站访问速度很慢，最好挂个代理，或者下载后用MobaXterm上传到对应目录\n准备安装 MobaXterm或者其他支持x11的ssh客户端里面 用yanhui登录，执行\n1 2 systemctl start libvirtd virt-manager 会弹出virt-manager 图形界面窗口，先connect上默认的QEMU/KVM\n点 file -\u0026gt; New virual Machine 选默认的 local install，点下一步 Forward\n点后面的浏览Browse 弹出来一个 locate Iso 管理窗口，点左下角的 + 号 Name 输入 ISO ，type 保持默认 dir: ,目标路径 Target 输入ISO储存路径/home/yanhui/mnt/exfat/iso 然后点Finish 结束\n然后选中新建的iso里面的win10安装镜像， 返回虚拟主机的配置界面 去掉automatically ... 这个自动识别系统版本的勾号，在上面输入win10 搜索 选中对应的系统。然后 点下一步 Forward\n可能弹出一个权限的提醒，下一步忽略就好，分配cpu和内存。下一步 Forward 创建磁盘。参考前面iso的配置同样的方法创建一个专门放置vdisk的目录/home/yanhui/mnt/nvme/vdisk，并创建一个磁盘 win10-base.qcow2 在这里个目录，大小要14G以上哦，不然不够win10安装用的，下一步 Forward ，勾选上 Customize configuration before install\n继续配置，添加一个ide磁盘cdrom 到 驱动virtio-win-0.1.225.iso。\n默认磁盘改为 virtIO,缓存 unfase，\n如果需要和宿主机文件的交互，添加 File System，选择 virtio-9p\n网络接口等等 其他简单也配置以下，点begin installxxx\n开始安装 就好了。 找不到磁盘 记得加载驱动，完成后 记得装完整驱动。别的都简单 不用多说。\n网络如果不会配置桥接的话，暂时先用NAT\nwin11 的话记得添加tpm 桥接网络的配置 点这里查看\n","date":"2022-12-29T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/arch-aio-use/","title":"arch-aio 免费高扩展性灵活且开放的all in one 系统的基本使用"},{"content":"最近开始对在线文档 和 第三方云备份有较大的需求，尝试过几次后，决定在pve上跑一个群晖来处理这些问题。\n有很多开源免费项目都可以实现这些功能，但是群晖肯定是实现起来最简单功能也是最强的。\n再次感谢 群晖公司对黑群晖的容忍\n本文不适合linux纯小白，但是部分内容适合pve新手\npve运行群晖 个人期望和解决方案 因为黑群晖出过问题，所以有以下需求。\n1、方便备份整机\n2、群晖挂了不影响数据访问\n解决方案 为了满足我上面的要求，我才用 硬盘直通一个单独的lxc容器，然后开smb和webdav/sftp，这个容器称为 filecenter 。群晖用补丁实现 smb挂载的文件的 photo audio video的支持。\n额外的支持 群晖不做ssl 和 ddns 。\nssl 用一个单独的lxc 运行 我自己修改过的 nginxWebUI 处理。\nddns 用一个单独的lxc 运行 ddns-go\n对象储存 用一个单独的 lxc 运行 minio\ngit仓库 可以用gitlab实现 我这里直接用阿里的codeup了\n核心数据异地备份功能 群晖整机定时的备份 lxc单独运行一个alpine，定时任务ssh到pve实现。备份出来的oma，同步到 filecenter的sftp\n备份到百度云 群晖cloud sysnc实现\n备份到阿里云盘 群晖cloud sysnc + alist webdav\n‍\n安装 pve准备 开启核显直通或者gvt-g。 过程 ： https://dev.leiyanhui.com/pve/igpu-one-key/ 创建虚拟机，硬盘Sata，然后稍后删掉\n准备引导镜像 https://github.com/fbelavenuto/arpl/releases\n1 2 3 qemu-img convert -p -f raw -O qcow2 arpl-1.0-beta13a.img arpl-1.0-beta13a.qcow2 # 导入 qm importdisk 5000 /exfat/vm-cnf-and-vdisk-bak/Synology/arpl-1.0-beta13a.qcow2 local --format=qcow2 编译引导的说明 启动虚拟机，然后按照提示打开网页\n1 2 3 4 m 是选择机型，我这里选 DS920+ n 是选择版本，选最新的 42962 然后随机序列号 其他都不用改动，然后 选择 build the loader 会自动编译 恢复引导\n1 2 3 4 qm stop 5000 rm -rf /var/lib/vz/images/5000/vm-5000-disk-0.qcow2 cp /exfat/vm-cnf-and-vdisk-bak/Synology/arpl-1.0-beta13a.qcow2 /var/lib/vz/images/5000/vm-5000-disk-0.qcow2 # http://10.1.1.70:7681/ 清理引导和系统 到空白\n1 2 3 4 5 qm stop 7000 rm -rf /var/lib/vz/images/5000/vm-5000-disk-0.qcow2 cp /exfat/vm-cnf-and-vdisk-bak/arpl-1.0-beta13a.qcow2 /var/lib/vz/images/5000/vm-5000-disk-0.qcow2 rm -rf /var/lib/vz/images/5000/vm-5000-disk-1.qcow2 cp /exfat/vm-cnf-and-vdisk-bak/temp-120g.qcow2 /var/lib/vz/images/5000/vm-5000-disk-1.qcow2 查看核显\n1 ls /dev/dri 系统和引导备份\n1 2 3 4 5 6 7 pvevmid=5000 backuppath=/exfat/vm-cnf-and-vdisk-bak/Synology/$(date +%Y%m%d-%H%M%S) mkdir -p $backuppath qm stop $pvevmid cp /var/lib/vz/images/$pvevmid/vm-$pvevmid-disk-0.qcow2 $backuppath/load.qcow2 qemu-img convert -p -f qcow2 -O qcow2 /var/lib/vz/images/$pvevmid/vm-$pvevmid-disk-1.qcow2 $backuppath/sys.qcow2 cp /etc/pve/qemu-server/$pvevmid.conf $backuppath/pve-vm.conf https://dev.leiyanhui.com/pve/qunhui\n‍\n","date":"2022-12-29T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/qunhui/","title":"pve安装群晖最新版7.2 物理机安装同理"},{"content":"我选择 arch-aio的理由\narch-aio的简介 https://dev.leiyanhui.com/all-in-one/diy/\npve 磁盘分区 需要12-20G左右，备份起来不方便 ，虚拟磁盘名称不方便自定义 多了不太常用的lxc，没有原生docker 需要自己处理 hyper-v 宿主机占用资源偏多 部分硬件的直通存在一些问题 hyper-v 虽然免费，但win是收费的 破解版不适合商用 esxi 个人免费，商用收费 非原生linux，功能限制太多。 硬件要求尤其是网卡要求多 unraid 占用一个usb口 需要一个非常靠谱的u盘 墙内使用麻烦，需要梯子 会破坏一块硬盘的数据 收费，破解版多数有挖矿后台 爱快 这个怎么说呢\u0026hellip;也就比较适合不折腾的用户吧 虽然支持docker，但是没有shell 扩展性太差，简直可以说是垃圾中的战斗机 但是他的dhcp 以及流控 都很简单易用 有黑历史 慎重 群晖 要么硬件买，钱多可以 黑群晖 有一些莫名其妙的问题，有时候可能是致命性的，不少人出现一段时间后无法启动需要接上显示器处理。 openwrt 路由器系统，不太适合宿主机折腾 ","date":"2022-12-29T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/other-os/","title":"常见all in one 系统的一些问题"},{"content":"为了灵活管理，arch-aio 单独创建一个了rc-local服务，用来添加开机自动启动的脚本。 同时也是这个原因，建议在rc-local 里面处理自动挂载脚本。\n仅限2022-12-29 版本\n1 cd /usr/lib/systemd/system/ 分别编辑 sudo nano libvirtd.service 和 sudo nano docker.service 在[Unit] 段 增加一行\n1 After=rc-local.service 这行是为了让docker和libvirtd 在rc-local这个服务之后启动，方便我们在 rc-local 内先挂载好磁盘 最后这两个服务设置为自动启动\n1 2 sudo systemctl enable libvirtd sudo systemctl enable docker 关于和自动挂载其他分区配合的方法，可以参考这里：https://dev.leiyanhui.com/arch/auto\u0026ndash;dock-kvm/\n","date":"2022-12-29T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/server-after/","title":"旧版本 arch-aio all in one系统的，docker和kvm 与挂载磁盘顺序的一个小地方需要自己处理以下"},{"content":" 本文停止更新，新版查看 https://dev.leiyanhui.com/all-in-one/arch-aio/\n前言 经历 前前后后用过很多 all in one 系统，hyper-v pve6-7.3 unraid，esxi 还有 群晖 爱快，感觉到很多不方便的地方。所以自己做了一个基于arch 和 ventoy的all in one 母系统。\n缺点：门槛略微高一点点。你需要会用linux的基本命令。包括不限ln mount 优点：灵活，免费,不占用额外分区，强大扩展，较新并非常稳定的内核\n使用方法 https://www.123pan.com/s/EqorVv-K2nPA 提取码:arch\n下载后解压，然后用ventoy，用支持x11转发的ssh客户端（例如 MobaXterm） 登录 用户名yanhui 密码 1 root 密码也是 1 但是root默认禁止登录。\n简明使用方法：https://dev.leiyanhui.com/all-in-one/arch-aio-use/\n虚拟机 先挂载分区，并 ln -s /var/lib/libvirt/images /目录 或者直接把这个目录挂载到分区 MobaXterm 中运行 virt-manager 会弹出virt-manager界面\n如果你只想用命令行，也可以卸载掉它。\n在不支持x11 转发的设备上管理虚拟机，请继续看后面\ndocker 先挂载分区，并ln /var/lib/docker 目录 或者直接把这个目录挂载到分区 如果要图形界面，可以安装portainer\n1 2 3 4 docker run -d -p 8000:8000 -p 9443:9443 \\ --name portainer --restart=always \\ -v /var/run/docker.sock:/var/run/docker.sock \\ portainer/portainer-ce:latest 然后浏览器访问：https://ip:9443\n新建用户 新建用户请 添加到wheel组 和 libvirt 组，例如用户名 xiaolei\n1 2 sudo useradd -m -G wheel -s /bin/bash xiaolei sudo usermod -a -G libvirt xiaolei 然后设置密码\n1 sudo passwd xiaolei 清理日志和缓存文件 1 sh /root/del-log.sh 扩容 如果默认容量不够，需要扩容。请参考 https://dev.leiyanhui.com/arch/ventoy-vdisk-resize\nexfat4 和ntfs支持 1 2 sudo pacman -S exfat-utils sudo pacman -S ntfs-3g exfat 和 ntfs 在linux下性能一般，ntfs稳定性更是一般，不建议高强度使用\n关于sudo 和 vi vim 用doas 和nano替代的 软连接对应的sudo 和 vi vim\n运行浏览器和其他软件 请尽量挂载到其他分区后用appimages 例如火狐\n1 2 3 4 5 6 sudo pacman -S fuse #AppImage 依赖 sudo pacman -S dbus-glib # 火狐依赖 cd /挂载目录 wget https://apprepo.de/appimage/download/firefox --output-document=Firefox.AppImage chmod +x ./*.AppImage ./Firefox.AppImage 火狐在x11转发下首次启动很卡，等一会关掉再次打开就流畅很多 中文字体支持\n1 sudo pacman -S wqy-zenhei 中文输入法：https://wiki.archlinuxcn.org/wiki/Fcitx5\n开机自动启动脚本 rc-local服务：/usr/lib/systemd/system/rc-local.service 和 /etc/rc.local\nsh脚本放到 /etc/rc.local.d 目录\n开机自动挂载 建议放到 /etc/rc.local.d目录。 参考编辑文件sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh\n详细说明参考这里：https://dev.leiyanhui.com/arch/auto-mount-dock-kvm\n开机自动启动其他分区的vm 或者docker 参考编辑文件sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh\n详细说明参考这里：https://dev.leiyanhui.com/arch/auto-mount-dock-kvm\n桥接虚拟机网络 https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/\n关于远程访问虚拟机 如果客户端非ios设备，网络尚可 直接用支持x11转发的ssh客户端管理\n如果是ios设备，因为没有可用的客户端，建议kvm 或者docker中运行一个 有桌面的win 或者linux，再远程过去.再套娃访问宿主机\ndocker 运行linux桌面参考 https://dev.leiyanhui.com/docker/run-deskto-gpu-usb/\n上文中的docker 支持网页vnc和xrdp微软远程链接，你甚至可以v挂载虚拟磁盘目录进去，里面有一些基本的软件，包括浏览器完成网盘备份等操作。\n当然，你也可以直接在宿主系统上安装一个gnome kde等桌面系统，然后开xrdp或者vnc 或者 向日葵 rustdesk 等等 尽情想想\u0026hellip;\n关于win/winpe下访问 因为镜像是vhd格式的，在win系统和多数winpe下可以直接挂载。 brtfs分区的访问请安装驱动，详情\n系统内软件包 母盘 archlinux-2022.12.01-x86_64.iso arch滚动更新，我用的母盘的版本不影响你 你可随意随时升级到最新版\n用archinstall 直接安装的 minimal 模式\n源 改为清华源，未开启archlinuxcn源，如果你需要aur软件包自行开启 https://mirrors.tuna.tsinghua.edu.cn/help/archlinuxcn/ 内核考虑到安卓x86 选择 linux-zen\n额外的软件包和配置 基本 开启了非root用户的x11转发，依赖xorg-xauth 基本包： openssh dhcpcd nano doas\nventoy依赖：which lvm2\nsudo用doas替换了，但是同时ln到/bin/sudo\nvi 未安装 如果不喜欢用nano自行处理\nkvm和docker相关 exfat-utils rsync qemu-base samba dnsmasq dmidecode iptables-nft bridge-utils openbsd-netcat libvirt virt-manager docker\n开机自定启动的额外服务 sshd dhcpcd\n注意 docker 和 kvm的libvirt 默认是通过 /etc/rc.local.d/auto-mount-and-start-aio.sh 启动的\n我对all in one的一点要求 自定义、灵活、内核新，不破坏原来硬盘。\n简单说一下各个系统的缺陷 https://dev.leiyanhui.com/all-in-one/other-os/\n为什么选择arch 只使用qemu 等几个软件的情况下，也不存在滚挂的可能性。除非你真的大半年不更新。 相对 debian centos系，内核新，很多新特性都可以支持 wiki资料丰富，扩展容易 为什么选择ventoy引导 ventoy新版已经有限的支持无损安装到硬盘，同时也兼容grub4dos\n磁盘容量的纠结 控制到3.7G 以内是最好的选择，但是可用空间实在是太少了。安装qemu的常用依赖后，剩余空间只有几百M。无法满足正常使用的需求。 考虑许久后，决定抛弃兼容fat32和4G U盘的不实际的想法，改为7.3G。 即便是要安装一个桌面系统 应该也勉强够用。 另外 home opt等目录都可以挂载出来。\n磁盘格式的选择 ventoy只支持 固定大小的vhd vdi raw/img 三种格式 虚拟磁盘启动linux。kvm只支持其中raw，vbox支持前两者，win可以直接挂载vhd\nlinux可以用qemu-img随意转换其他格式，vhd文件也可以转换成raw/img后挂载。 综合考虑，还是选择了vhd格式\nvdisk内efi分区的大小 考虑到换内核的可能性和内核更新的情况，还是用多数情况适用的512M（正常只占用60m左右）\nvdisk内根分区文件系统的选择 我这里选择brtfs，支持压缩和快照。并且几乎所有winpe下都可以 右键加载驱动后访问，虽然不够稳定但是要比其他文件系统简单一些。\nswap的选择 默认不开启，如果需要自行创建swap文件即可\n","date":"2022-12-29T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/diy/","title":"选择arch-aio，彻底抛弃pve esxi unraid"},{"content":"这里以 archlinux 和 vhd格式 为例，raw格式 可以用qemu-img 扩容。\n一个可以正常启动的linux镜像archinstall-ext4.vhd.vtoy 如果不会弄，参考：https://dev.leiyanhui.com/arch/boot-vhd-ventoy/\nventoy启动的linux 扩容比较麻烦\n虚拟磁盘扩容 先关掉系统，然后重启到另外一个带虚拟机的系统，linux 或者win 都可以 linux下 建议用qemu-img 转换到ram后扩容 过程掠过\n1 2 3 4 5 6 mv archinstall-ext4.vhd.vtoy archinstall-ext4.vhd pacman -S qemu-img # vpc 是vhd格式 qemu-img convert -p -f vpc -O raw archinstall-ext4.vhd archinstall-ext4.raw qemu-img resize archinstall-ext4.raw +5G mv archinstall-ext4.raw archinstall-ext4.raw.vtoy win下 可以直接使用diskpart 或者 第三方工具扩容。比如Bootice.exe 一般pe都有，在磁盘信息的地方输入新容量即可\n缩小镜像，会导致不可以预料的文件丢失 ，轻易不要尝试\n新虚拟磁盘文件挂载到虚拟机 可以用virtualbox或者kvm,root用户登录\n在系统内部处理 用ventoy启动扩容好的虚拟磁盘系统，ssh登录\n1 cfdisk /dev/sdXXX resize需要处理的分区，我这里是/dev/sda2，然后write写入 yes确认 退出\next4 格式 1 resize2fs /dev/sdXXX btrfs格式 操作根目录 1 btrfs filesystem resize max / 然后重新执行vtoyboot 1 2 cd /root/vtoyboot* sh vtoyboot.sh 准备重启 虚拟磁盘文件重命名为 XX.vtoy ，重新用ventoy引导 完毕。\n","date":"2022-12-29T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/arch/ventoy-vdisk-resize/","title":"基于ventoy启动的linux虚拟磁盘的扩容"},{"content":"arch 的一个家庭server上启用 x11 转发 方便应急的情况下用浏览器备份文件到网页端网盘\n本文基于 Linux archlinux 6.1.1-zen1-1-zen 1 2 sudo pacman -S xorg-xauth sudo nano /etc/ssh/sshd_config sshd_config\n1 2 3 X11Forwarding yes X11DisplayOffset 10 X11UseLocalhost yes 重启sshd 重新链接 ok了\n1 sudo systemctl restart sshd \u0026mdash;\u0026mdash; 下面内容作废 \u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026mdash;\u0026ndash; 修改 sshd_config\n1 2 3 4 5 6 7 8 9 sudo nano /etc/ssh/sshd_config ----下面几行取消#注释--- #AllowAgentForwarding yes #非必须 #AllowTcpForwarding yes #非必须 #X11Forwarding no #取消注释并改为yes #X11DisplayOffset 10 #X11UseLocalhost yes #AddressFamily any # 这项下面添加一行 AddressFamily inet 重启ssh后 发现无效 查询wiki后发现需要 xorg-xauth 安装xorg-xauth\n1 sudo pacman -S xorg-xauth 配置\n1 touch ~/.Xauthority \u0026amp;\u0026amp; chmod 600 ~/.Xauthority 重启sshd\n1 sudo systemctl restart sshd 重新链接 ok了\n参考 https://wiki.archlinuxcn.org/wiki/OpenSSH#X11_forwarding\n","date":"2022-12-28T15:20:20+08:00","permalink":"https://dev.leiyanhui.com/arch/x11-forwarding/","title":"archlinux 打开x11转发"},{"content":"本文旧版：https://dev.leiyanhui.com/kvm/archlinux-kvm/\n配置基本的宿主系统 手动安装arch https://dev.leiyanhui.com/arch/base-install/\n可选操作 最小化安装gnome https://dev.leiyanhui.com/arch/arch-linux-install-gnome-desktop/ gnome 的远程桌面 好像有一些问题 基于安全还需要配置 证书之类的麻烦。。而且xrdp性能比rdp差太多了。 我这里用rustdesk 安装rustdesk远程控制 https://dev.leiyanhui.com/arch/rustdesk/\n禁用wayland（安装rustdesk 只支持xorg）：https://rustdesk.com/docs/en/manual/linux/#login-screen 或者 不要桌面，直接用x11转发 https://dev.leiyanhui.com/arch/x11-forwarding/\n配置kvm qemu-base 1 sudo pacman -S qemu-base 现在kvm 已经可以用了，但是\u0026hellip;只能用命令行，而且还有一些权限问题需要处理。 我这里打算直接用图形界面，所以继续处理。\n其他支持 1 2 sudo pacman -S samba dnsmasq dmidecode sudo pacman -S iptables-nft bridge-utils openbsd-netcat 客户端选择 aqemu 有一点问题，我这里选 libvirt + virt-manager\nlibvirt virsh 是用于管理和配置域（虚拟机）的命令行程序。 就是支持 xml管理kvm虚拟机了一个基本程序\n1 sudo pacman -S libvirt 处理权限相关\n1 2 sudo groupadd libvirt sudo usermod -a -G libvirt $USER 配置 sudo nano /etc/libvirt/libvirtd.conf 找到#unix_sock_group = \u0026quot;libvirt\u0026quot; 取消注册\n1 2 3 sudo systemctl enable libvirtd sudo systemctl start libvirtd sudo systemctl status libvirtd ui 客户端 1 sudo pacman -S virt-manager virt-manager 是一个功能强大virsh的ui客户端\nvirt-manager 链接的时候 记得选择 用户级的 qemu:///session\n其他软件 安装浏览器 和文件管理工具\n1 2 sudo pacman -S firefox wqy-zenhei sudo pacman -S thunar 建议用appimage\n1 2 3 4 5 sudo pacman -S fuse #AppImage 依赖 sudo pacman -S dbus-glib # 火狐依赖 wget https://apprepo.de/appimage/download/firefox --output-document=Firefox.AppImage chmod +x ./*.AppImage ./Firefox.AppImage ","date":"2022-12-28T14:00:20+08:00","permalink":"https://dev.leiyanhui.com/arch/install-kvm/","title":"archlinux运行kvm all in one主机，包括核显和pci直通  保姆级教程 新版"},{"content":"archlinux 作为服务端，客户端我用的win上网本。 在10M的带宽上 可以系统1080p 30帧的 流畅体验，办公没有任何压力，游戏的话体验就差一点。60帧要20M\n显卡驱动 我这里是核显 intel uhd630\n1 sudo pacman -S vulkan-intel 服务端安装sunshine 有很多安装方法，我这里用aur的 简单一些\n1 yay -S sunshine 服务器端处理 依赖\n1 sudo pacman -S fuse 用户权限\n1 sudo usermod -a -G input $USER udev 规则\n1 2 echo \u0026#39;KERNEL==\u0026#34;uinput\u0026#34;, GROUP=\u0026#34;input\u0026#34;, MODE=\u0026#34;0660\u0026#34;, OPTIONS+=\u0026#34;static_node=uinput\u0026#34;\u0026#39; | \\ sudo tee /etc/udev/rules.d/85-sunshine-input.rules KMS 的额外设置\n1 sudo setcap cap_sys_admin+p $(readlink -f $(which sunshine)) 用户服务\n1 2 mkdir -p ~/.config/systemd/user/ nano ~/.config/systemd/user/sunshine.service 1 2 3 4 5 6 7 8 9 10 [Unit] Description=Sunshine Gamestream Server for Moonlight [Service] ExecStart=/usr/bin/sunshine #Flatpak Only #ExecStop=flatpak kill dev.lizardbyte.sunshine [Install] WantedBy=graphical-session.target 启动\n1 2 systemctl --user enable sunshine systemctl --user start sunshine 重启服务器，使用x11 登录桌面，我这里是kde （要无人职守的话，需要配置自动登录）\n打开 https://IP:47990/ 配置帐号密码，并配置好帐号密码。\n客户端下载，我这里是 windows\nhttps://github.com/moonlight-stream/moonlight-qt/releases\nhttps://github.com/moonlight-stream/moonlight-qt/releases/download/v4.3.1/MoonlightPortable-x64-4.3.1.zip\n解压 运行，\n链接 linux的ip ，让输入pin数字，在网页端 https://IP:47990/ 点pin 输入，然后客户端等一下自动链接上 点击desktop 完毕\n推出快捷键是 ctl alt shift Q\n鼠标灵敏度问题，需要两边设置分辨率一样 就ok了\n","date":"2022-12-27T09:25:20+08:00","permalink":"https://dev.leiyanhui.com/arch/moonlight-sunshine-install/","title":"linux搭建串流服务器 玩游戏 刷视频，客户端支持 ios 安卓 win linux macos等"},{"content":"gnome的密钥环不能跟随自动登录自动解锁，会导致一些使用的问题。例如 gnome自带的xrdp无法链接。 需要手动解锁一次\n简单的处理，直接删除所有\n1 rm ~/.local/share/keyrings/login.keyring 点击需要密钥环的地方（例如共享），或者安装并启动seahorse\n1 pacman -S seahorse 提示选择新密钥环，让输入密码的时候，密码留空\n","date":"2022-12-26T09:58:20+08:00","permalink":"https://dev.leiyanhui.com/arch/gnome-key-err/","title":"linux下gnome自动登录后密钥环的问题"},{"content":"关闭虚拟机，必须关闭，不能重启 假设102是你的虚拟机编号\n1 nano /etc/pve/qemu-server/102.conf 顶部添加一行\n1 args: -cpu host,-hypervisor,+kvm_pv_unhalt,+kvm_pv_eoi,hv_spinlocks=0x1fff,hv_vapic,hv_time,hv_reset,hv_vpindex,hv_runtime,hv_relaxed,kvm=off,hv_vendor_id=intel\u0026#39; 开机后，任务管理器 查看 cpu 不提示虚拟机，然后打开游戏即可\nPS： 游戏检测虚拟机 有千千万种办法，所以这东西 当前能用就行，以后不能用再想办法\n","date":"2022-12-25T19:16:20+08:00","permalink":"https://dev.leiyanhui.com/pve/game-vm/","title":"pve 下虚拟机过游戏检测 -原神"},{"content":"本文基于Virtual Environment 7.3-3 理论上pve7系列通用。显卡是uhd630核显，如果你是其他显卡，需要修改一下vfio.conf这个文件里面的ids=\n一键关闭 核显直通 和 gvt-g 从核显直通到gvt 必须 关闭 再 开启\n1 2 3 4 5 6 7 8 9 10 11 12 13 cd /root wget -c https://file.leiyanhui.com/pve-unraid-kvm/igpu-etc-bak.tar.gz tar -zxvf igpu-etc-bak.tar.gz rm -rf /etc/default/grub \u0026amp;\u0026amp; cp /root/igpu-etc-bak/grub /etc/default/grub update-grub # cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh # 最好重启一下再继续 rm -rf /etc/modules \u0026amp;\u0026amp; cp /root/igpu-etc-bak/modules /etc/modules rm -rf /etc/modprobe.d/pve-blacklist.conf \u0026amp;\u0026amp; cp /root/igpu-etc-bak/pve-blacklist.conf /etc/modprobe.d/pve-blacklist.conf rm -rf /etc/modprobe.d/kvm.conf rm -rf /etc/modprobe.d/iommu_unsafe_interrupts.conf rm -rf /etc/modprobe.d/vfio.conf update-initramfs -u # cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh # 重启后检查 lsmod | grep vfio 一键切换 核显直通 需要先关闭gvt-g\n1 2 3 4 5 6 7 8 9 10 11 12 13 cd /root wget -c https://file.leiyanhui.com/pve-unraid-kvm/igpu-etc-passed-bak.tar.gz tar -zxvf igpu-etc-passed-bak.tar.gz rm -rf /etc/default/grub \u0026amp;\u0026amp; cp /root/igpu-etc-passed-bak/grub /etc/default/grub update-grub # cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh # 最好重启一下再继续 rm -rf /etc/module \u0026amp;\u0026amp; cp /root/igpu-etc-passed-bak/modules /etc/modules rm -rf /etc/modprobe.d/pve-blacklist.conf \u0026amp;\u0026amp; cp /root/igpu-etc-passed-bak/pve-blacklist.conf /etc/modprobe.d/pve-blacklist.conf rm -rf /etc/modprobe.d/kvm.conf \u0026amp;\u0026amp; cp /root/igpu-etc-passed-bak/kvm.conf /etc/modprobe.d/kvm.conf rm -rf /etc/modprobe.d/iommu_unsafe_interrupts.conf \u0026amp;\u0026amp; cp /root/igpu-etc-passed-bak/iommu_unsafe_interrupts.conf /etc/modprobe.d/iommu_unsafe_interrupts.conf rm -rf /etc/modprobe.d/vfio.conf \u0026amp;\u0026amp; cp /root/igpu-etc-passed-bak/vfio.con /etc/modprobe.d/vfio.conf update-initramfs -u # cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh # 重启后检查 lsmod | grep vfio 一键切换 gvt-g 1 2 3 4 5 6 7 8 9 10 11 12 13 cd /root wget -c https://file.leiyanhui.com/pve-unraid-kvm/igpu-etc-gvt-g-bak.tar.gz tar -zxvf igpu-etc-gvt-g-bak.tar.gz rm -rf /etc/default/grub \u0026amp;\u0026amp; cp /root/igpu-etc-gvt-g-bak/grub /etc/default/grub update-grub # cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh # 最好重启一下再继续 rm -rf /etc/modules \u0026amp;\u0026amp; cp /root/igpu-etc-gvt-g-bak/modules /etc/modules rm -rf /etc/modprobe.d/pve-blacklist.conf rm -rf /etc/modprobe.d/kvm.conf rm -rf /etc/modprobe.d/iommu_unsafe_interrupts.conf rm -rf /etc/modprobe.d/vfio.conf update-initramfs -u # cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh # 重启后检查 lsmod | grep vfio gvt-g 备份 关闭状态开启gvt-g 只需要修改两个文件\nnano /etc/default/grub 编辑GRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet intel_iommu=on iommu=pt i915.enable_gvt=1\u0026quot; update-grub nano /etc/modules 添加 一行一个 vfio vfio_iommu_type1 vfio_pci vfio_virqfd kvmgt update-initramfs -u -k all 1 2 3 4 5 mkdir /root/igpu-etc-gvt-g-bak cp /etc/default/grub /root/igpu-etc-gvt-g-bak cp /etc/modules /root/igpu-etc-gvt-g-bak tar -zcvf igpu-etc-gvt-g-bak.tar.gz igpu-etc-gvt-g-bak 手动处理过程 备份需要处理的文件 1 2 3 4 mkdir /root/igpu-etc-bak cp /etc/default/grub /root/igpu-etc-bak cp /etc/modules /root/igpu-etc-bak cp /etc/modprobe.d/pve-blacklist.conf /root/igpu-etc-bak 压缩备份文件 cd /root tar -zcvf igpu-etc-bak.tar.gz igpu-etc-bak\n处理文件 https://dev.leiyanhui.com/pve/igpu-pass/\n备份处理过的文件 1 2 3 4 5 6 7 mkdir /root/igpu-etc-passed-bak cp /etc/default/grub /root/igpu-etc-passed-bak cp /etc/modules /root/igpu-etc-passed-bak cp /etc/modprobe.d/pve-blacklist.conf /root/igpu-etc-passed-bak cp /etc/modprobe.d/kvm.conf /root/igpu-etc-passed-bak cp /etc/modprobe.d/iommu_unsafe_interrupts.conf /root/igpu-etc-passed-bak cp /etc/modprobe.d/vfio.conf /root/igpu-etc-passed-bak 压缩备份文件 cd /root tar -zcvf igpu-etc-passed-bak.tar.gz igpu-etc-passed-bak\n","date":"2022-12-24T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/igpu-one-key/","title":"pve 7.3 一键开启核显直通"},{"content":"grub处理 nano 1 2 #GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet\u0026#34; GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on\u0026#34; 有可能还需要\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on video=efifb:off\u0026#34; intel_iommu=on 是开启分组\nvideo=efifb:off 是关闭pve的显示\nvesafb:off 禁用legacy启动的显示设备 非必须\n更新grub后重启\n1 update-grub ventoy的pve 还需要处理一下 再重启\n1 cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh 开启vfio模块 nano /etc/modules\n1 2 3 4 vfio vfio_iommu_type1 vfio_pci vfio_virqfd 创建黑名单 nano /etc/modprobe.d/pve-blacklist.conf 屏蔽常见设备和核显等\n1 2 3 blacklist i915 blacklist snd_hda_intel blacklist snd_hda_codec_hdmi 其他的显卡 自己按需要屏蔽\n1 2 3 4 5 6 7 # block AMD driver blacklist radeon blacklist amdgpu # block NVIDIA driver blacklist nouveau blacklist nvidia blacklist nvidiafb 避免 无限重启 1 echo \u0026#34;options kvm ignore_msrs=1\u0026#34; \u0026gt; /etc/modprobe.d/kvm.conf 允许不安全的中断 1 echo \u0026#34;options vfio_iommu_type1 allow_unsafe_interrupts=1\u0026#34; \u0026gt; /etc/modprobe.d/iommu_unsafe_interrupts.conf 查看要屏蔽的设备的id， 1 2 3 lspci -nn | grep UHD --------- 00:02.0 VGA compatible controller [0300]: Intel Corporation CoffeeLake-H GT2 [UHD Graphics 630] [8086:3e9b] 记住前面和最后的地址 00:02 和 8086:3e9b\n1 echo \u0026#34;options vfio-pci ids=8086:3e9b\u0026#34; \u0026gt; /etc/modprobe.d/vfio.conf ps：执行此操作后可能无法输出到外接显示器，若出现此情况，请撤回该步骤.另外有一个 参数 disable_vga=1 也可能会影响\n1 echo \u0026#34;options vfio-pci ids=8086:3e9b disable_vga=1\u0026#34; \u0026gt; /etc/modprobe.d/vfio.conf 更新initramfs 1 2 3 update-initramfs -u # ventoy启动的pve.vhd 还需要处理一下vtoyboot cd /root/vtoyboot**/ \u0026amp;\u0026amp; sh vtoyboot.sh 再重启\n检查 1 2 3 4 5 6 7 8 root@pve ~# lsmod | grep vfio ------------------------------------------ vfio_pci 16384 0 vfio_pci_core 73728 1 vfio_pci vfio_virqfd 16384 1 vfio_pci_core irqbypass 16384 16 vfio_pci_core,kvm vfio_iommu_type1 40960 0 vfio 45056 2 vfio_pci_core,vfio_iommu_type1 完毕 其他问题 参考以前的记录 ：https://dev.leiyanhui.com/pve/win-gpu/\n","date":"2022-12-24T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/igpu-pass/","title":"pve 7.3开启核显/独显直通pic设备直通简易教程"},{"content":"你可以直接安装完整的 gnome kde等桌面系统。\n我这里的pve 没有显卡（都直通给你虚拟机了），也不会经常用他桌面系统，所以我这里是用x11转发，由控制pve的远程电脑来显示图形界面。软件也尽量用appimages，以便减少对pve系统的修改。\n开启x11 转发 https://dev.leiyanhui.com/pve/x11/\n准备客户端工具 这里是win客户机，我用 MobaXterm\n清理系统 我原来是apt安装的火狐和thunar 卸载掉\n1 2 apt-get purge firefox-esr thunar apt-get autoremove 安装appimages常用软件 存放目录\n1 2 mkdir appimages cd appimages 火狐 1 2 3 wget https://apprepo.de/appimage/download/firefox --output-document=Firefox.AppImage chmod +x ./*.AppImage ./Firefox.AppImage 需要一点依赖 我们这里自己装一下\n1 2 # apt-get install libgtk-3-0 # apprepo.de的不需要 apt-get install libdbus-glib-1-2 火狐appimages 仓库：https://github.com/srevinsaju/Firefox-Appimage/\npve 自带了Lynx ，可以浏览一些文本类型为主的网站\n1 lync dev.leiyanhui.com 图形化文件管理工具 可选 Far2l ，这是一个基于命令行的图形界面的软件，支持鼠标操作，x11 转发毕竟没有终端方便\nFar2l 1 2 3 wget https://apprepo.de/appimage/download/far2l --output-document=Far2l.AppImage chmod +x ./Far2l.AppImage ./Far2l.AppImage DFileManager 依赖QT\n一些其他的常用软件的appimages整理\nhttps://appimage.github.io\nhttps://apprepo.de/\n","date":"2022-12-24T23:10:20+08:00","permalink":"https://dev.leiyanhui.com/pve/brower-filemanage/","title":"pve 安装图形界面软件：文件管理器，浏览器等 用于基本配置和云备份等"},{"content":"btrfs 大有替代 ext4的趋势，支持压缩 支持快照 简直爽的不要不要的\nwin10下启用btrfs 经过长时间使用发现winbtrfs这个项目算是相对不错 且稳定的 https://github.com/maharmstone/btrfs\n安装方法\n下载，https://github.com/maharmstone/btrfs/releases/download/v1.8.1/btrfs-1.8.1.zip 解压，注意 是 btrfs-XX.zip 不是debug和pdb那两个\n右键 btrfs.inf ,安装，不用重启即可使用\n测试 大文件可以全速读写 4k 未测试。\n后记 winpe下 测试winpe 为 firpe v1.8.1 ，也支持。 winpe下不需要重启即可使用\n不建议主力 win下使用linux原生分区格式，建议还是应急为主。\n如果你的系统以win为主，建议还是exfat 兼容性处理起来更简单 也更稳。\n如果是linux为主的话，那么 上btrfs 吧！不会后悔\n","date":"2022-12-23T01:14:20+08:00","permalink":"https://dev.leiyanhui.com/win/winbtrfs/","title":"windows 使用btrfs分区 "},{"content":"有什么用 可以在不修改你磁盘分区的情况下，只占用5G的硬盘空间(新版占用12G，剩余7G+)，使用vhd虚拟磁盘的方式 启动一个性能和功能完全不受影响在物理机运行的pve系统。 可以和其他系统共存并不需要额外的分区 可以同时存在多个pve系统 自由切换，例如一个开启gvt-g的一个开启核显直通的 可以很方便的整个系统备份和恢复 开始使用 1、准备一个空白U盘，或者硬盘安装好 ventoy,下载 解压 pve.vhd 文件到 任意一个分区（exFAT/NTFS/UDF/XFS/Ext2(3)(4)格式的分区），重命名为 pve.vhd.vtoy 2、开机用ventoy磁盘引导，按下F2 浏览，找到 pve.vhd.vtoy，正常启动 用户名root 密码root 3、配置网卡和ip等 重启，详细说明看这里 4、挂载其他磁盘修改虚拟机和ct容器目录 详细说明看后文\n只是修改了pve内部的引导挂载路径,使用方法 和正常安装的pve一样 ，不影响直通和其他任何功能。更不影响任何性能。\n进阶 1、扩容方法（以后补 剩余7G其实足够了\u0026hellip; 先用工具扩容vhd，然后在从pve内部处理lvm即可） 2、配置开机启动启动pve 查看这里 3、不使用ventoy的启动（整理中..）\npve通用进阶教程 开启pci直通简明教程 开启虚拟化嵌套 安装macos 更新说明 2022-12-23\n更新为12G 容量，剩余空间7G左右，放弃5G镜像，之所以做一个容量大一些的，是发现1.3G的剩余空间在安装几个常用软件后经常就占满了，再次去扩容过于折腾。而7G容量足够安装常用软件，甚至可以安装上一个桌面系统。 安装firefox 和 hrub 为了减少体积，网盘包改为 7zip 格式 linux解压命令，debian/ubuntu:apt-get install p7zip \u0026amp;\u0026amp; 7z x pve20221223.vhd.vtoy.7z -r -o /目标路径 概述 基于 Virtual Environment 7.3-3 内核最新版（目前是 5.15.74-1） 基于vtoyboot-1.0.25（ventoy） 支持硬盘/U盘安装的 vtoyboot，也支持grub4dos插件启动，推荐用vtoyboot 硬盘占用空间5G 剩余空间1.1G 左右（可扩容） 默认ip：5G版：10.0.0.8 12G初始版：10.0.0.120 默认用户名root 密码 root Local-lvm 默认没有启用(低容量会默认禁用)Local开启全功能 开启x11 转发，方便在上面运行图形化软件，支持浏览器 文件管理等所有linux图形化软件 开启了sftp 可以用alist rclone之类的软件挂载 详情 修改为国内源 显示cpu主频 cpu温度 nvme硬盘温度 sata硬盘温度 去掉订阅弹窗 支持升级 不影响pci直通等操作 绝对没有后门，所有修改过的文件，都备份了一份在 /root/bak-sources, 所有的历史命令和操作记录 都保留，你可以自行删除\n计划中的功能 精简到4G 以内 方便fat32 分区使用\n已经处理的步骤和常见问题 挂载其他分区 查看所有磁盘和分区\n1 fdisk -l 挂载一个分区到/mnt/nvme1\n1 2 mkdir /mnt/nvme1 mount /dev/nvmen0p2 /mnt/nvme1 开机自动挂载，修改fstab 或者 添加开机自动执行脚本。 查看本文 https://dev.leiyanhui.com/pve/auto-mount-exfat 更多内容请自行google \u0026ldquo;linux 挂载分区\u0026quot;关键词\npve 可以挂载ntfs分区，但是不建议长期使用，性能和稳定性都有问题。\n修改ct和虚拟机主机的路径 https://dev.leiyanhui.com/pve/pve-mv-dir\n国内源 已经更换到清华源 https://dev.leiyanhui.com/pve/guonei\n显示温度 已经处理过，不需要你再处理\n1 2 3 4 5 cp /usr/share/perl5/PVE/API2/Nodes.pm /root/bak-sources cp /usr/share/pve-manager/js/pvemanagerlib.js /root/bak-sources #覆盖文件后 执行下面命令 apt-get install lm-sensors \u0026amp;\u0026amp; apt-get install nvme-cli \u0026amp;\u0026amp; apt-get install hddtemp \u0026amp;\u0026amp; chmod +s /usr/sbin/nvme \u0026amp;\u0026amp; chmod +s /usr/sbin/hddtemp \u0026amp;\u0026amp; chmod +s /usr/sbin/smartctl \u0026amp;\u0026amp; systemctl restart pveproxy 订阅弹出窗口 已经处理过，不需要你再处理\n1 2 cp /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js /root/bak-sources sed -Ezi.bak \u0026#34;s/(Ext.Msg.show\\(\\{\\s+title: gettext\\(\u0026#39;No valid sub)/void\\(\\{ \\/\\/\\1/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service 可能需要清理缓存\nX11 转发 已经处理过，不需要你再处理：https://dev.leiyanhui.com/pve/x11 用 Xming 或者MobaXterm 连接上，安装一个图形界面软件 测试，比如 apt install firefox-esr thunar 然后执行firefox 即可打开火狐，thunar 也是一个简单的文件管理工具。\n注意：x11 转发 只适合简单的场景使用。如果你要流畅，还是考虑 扩容后安装一个完整的桌面系统kde gnome等，然后xrdp vnc或者todesk之类的连接上使用。\n清理日志和历史命令 https://dev.leiyanhui.com/pve/del-log/\n系统升级到最新版 1 2 apt update \u0026amp;\u0026amp; apt full-upgrade cd /root/vtoyboot-*/ \u0026amp;\u0026amp; sh vtoyboot.sh 更新vtoyboot 1 cd /root/vtoyboot-*/ \u0026amp;\u0026amp; sh vtoyboot.sh 应该在系统更新和修改grub后，重启之前执行一次，详情参考 https://www.ventoy.net/cn/plugin_vtoyboot.html\n怎么访问 vhd所在的分区 参考 ventoy faq手册 启动类问题的说明第四条 默认情况下，Linux系统启动之后，存放ISO文件的分区无法挂载（会提示 Busy）。如果确实需要挂载，请使用 全局控制插件 中的 VTOY_LINUX_REMOUNT 选项。\n也可以查看本文 关于自动启动的说明\nwinpe/win下如何备份和配置pve 备份 直接复制压缩 XXX.vtoy 文件\n配置ventoy 建议用完整win，或者firpe，然后 用它自带的工具 VentoyPlugson.exe ，默认地址是 http://127.0.0.1:24681\n修改pve内部文件 重命名为 .vhd，然后挂载到Windows，而后用支持ext4分区的软件来操作 推荐 ExtFS 最稳定，免费10天，也有XXX的版本\nhttps://china.paragon-software.com/home-windows/extfs-for-windows/download.html\nventoy和pve的使用需要注意 ventoy 不支持差分vhd磁盘，不要尝试改为vhd文件后再次差分，但是可以自己转换为vdi或者img格式 修改grub后或者内核升级后记得运行一次 vtoyboot.sh 再重启。平时不需要 vhd.vtoy文件可以放在ntfs分区，不影响使用。但不建议pve内的虚拟机放在ntfs分区，所有的非win系统，对ntfs的支持都不够稳定。 记得修改密码！！！！！ 下载地址 如果失效，请联系 joyanhui@qq.com\nhttps://www.123pan.com/s/EqorVv-fPnPA 提取码:0pve\n其他未尽事宜 请参考ventoy手册：https://www.ventoy.net/cn/doc_news.html\n","date":"2022-12-22T03:14:20+08:00","permalink":"https://dev.leiyanhui.com/all-in-one/pve-ventoy-vdisk/","title":"一个可以不动硬盘分区，直接从一个文件启动的proxmox（pve） 打造all in one "},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 mkdir /root/bak-sources # 企业源 mv /etc/apt/sources.list.d/pve-install-repo.list /root/bak-sources #这个文件新版不存在了 这行不需要执行 mv /etc/apt/sources.list.d/pve-enterprise.list /root/bak-sources nano /etc/apt/sources.list.d/pve-enterprise.list ----------------- deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bullseye pve-no-subscription # debian源 mv /etc/apt/sources.list /root/bak-sources #apt update #apt install apt-transport-https ca-certificates nano /etc/apt/sources.list ----------- deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free # CT/LXC 源 备份后替换，然后重启pvedaemon cp /usr/share/perl5/PVE/APLInfo.pm /root/bak-sources sed -i \u0026#39;s|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g\u0026#39; /usr/share/perl5/PVE/APLInfo.pm systemctl restart pvedaemon.service 更新到最新版 不建议\n1 2 apt update \u0026amp;\u0026amp; apt full-upgrade cd /root/vtoyboot-*/ \u0026amp;\u0026amp; sh vtoyboot.sh ","date":"2022-12-21T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/guonei/","title":"pve 更换国内源，完整操作"},{"content":"pve已经内置了exfat支持，直接挂载即可。 其他linux内建支持的分区格式用同样方法挂载即可。nfts格式的话需要先apt install ntfs-3g 先手动挂载\n1 2 3 4 5 6 7 8 # 查看分区 fdisk -l # 目标分区 /dev/nvme0n1p3 # 挂载 mkdir /nvme mount /dev/nvme0n1p3 /nvme # 检查 ls /nvme 自动挂载\n1 nano /etc/fstab 添加一行\n1 2 3 # \u0026lt;file system\u0026gt; \u0026lt;mount point\u0026gt; \u0026lt;type\u0026gt; \u0026lt;options\u0026gt; \u0026lt;dump\u0026gt; \u0026lt;pass\u0026gt; /dev/nvme0n1p3 /nvme exfat defaults 0 2 /dev/nvme0n1p3 是分区, /nvmek是挂载的文件夹, exfat是磁盘格式, defaults 默认.\n第一个数字：0表示开机不检查磁盘，1表示开机检查磁盘；\n第二个数字：0表示交换分区，1代表启动分区（Linux），2表示普通分区\n重启测试\n读写速度测试 读取\n1 hdparm -t /dev/nvme0n1p3 Timing buffered disk reads: 3874 MB in 3.00 seconds = 1291.26 MB/sec 写入\n1 dd if=/dev/zero of=/nvme/test.for.write bs=1M count=8000 oflag=direct #写入一个8G的文件 结果\n1 2 3 8000+0 records in 8000+0 records out 8388608000 bytes (8.4 GB, 7.8 GiB) copied, 12.7129 s, 660 MB/s 写入速度有点拉跨，不过也还好，马马马虎虎，考虑到兼容性和方便性exfat分区还是值得\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 root@pve-yanhui ~# dd if=/dev/zero of=/nvme/test.for.write bs=1M count=8000 oflag=direct 8000+0 records in 8000+0 records out 8388608000 bytes (8.4 GB, 7.8 GiB) copied, 12.7129 s, 660 MB/s root@pve-yanhui ~# rm -rf /nvme/test.for.write root@pve-yanhui ~# dd if=/dev/zero of=/nvme/test.for.write bs=100M count=80 oflag=direct 80+0 records in 80+0 records out 8388608000 bytes (8.4 GB, 7.8 GiB) copied, 16.8002 s, 499 MB/s root@pve-yanhui ~# dd if=/dev/zero of=/nvme/test.for.write bs=100M count=80 oflag=direct 80+0 records in 80+0 records out 8388608000 bytes (8.4 GB, 7.8 GiB) copied, 16.7228 s, 502 MB/s root@pve-yanhui ~# dd if=/dev/zero of=/nvme/test.for.write bs=10M count=800 oflag=direct 800+0 records in 800+0 records out 8388608000 bytes (8.4 GB, 7.8 GiB) copied, 14.3473 s, 585 MB/s 结语 对于nvme 硬盘来说，exfat真的不合适，linux下性能损耗太大了，上面的测试可以看到性能损耗差不多一半！血亏\n多系统使用强烈建议 使用brtfs格式。linux肯定没问题 win和winpe 可以使用 本文方法：https://dev.leiyanhui.com/win/winbtrfs/\nmacos的话，目前好像只有用虚拟机映射分区的方法访问，然后sftp或者其他方式再挂载出来。\n","date":"2022-12-21T22:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/auto-mount-exfat/","title":"pve 开机自动挂载exfat分区"},{"content":"首先，你要有公网ip。 ipv6 也行\n群晖下ssl证书有几种处理方法，\n是docker 或者vm 运行一个 支持证书续签的服务 然后用-v挂载出来或者用计划任务复制出来 常用的宝塔 docker acme.sh 等 实际上可以直接处理，但是需要pythone3 这个依赖。 准备 首先只有一个默认证书才可以 控制面板 安全性 证书 查看只有一个自签证书的情况下\n域名商处理 域名商那边获取id key之类的 过程参考对应域名厂商。\n域名那边创建两个子域名 例如 jia.leiyanhui.com A记录到任意一个ip\n然后 *.jia.leiyanhui.com Cnama 到 jia.leiyanhui.com\n配置DDNS 可以在路由器处理，也可以直接在群晖里面处理\n配置ssl续签脚本 在 file 里面创建一个目录 下载 的脚本 上传到对应目录解压。 项目地址：https://github.com/andyzhshg/syno-acme\n详情参考：http://www.up4dev.com/2018/05/29/synology-ssl-wildcard-cert-update/\n注意一点 最后的脚本内容有一个 cert-up.sh update\n1 /volume1/system_file/syno-acme-0.3.0_dsm7_beta/cert-up.sh update \u0026gt;\u0026gt; /volume1/system_file/syno-acme_log.txt 2\u0026gt;\u0026amp;1 可以先手动指定执行一次sudo bash /volume1/system_file/syno-acme-0.3.0_dsm7_beta/cert-up.sh update 查看日志：\n1 sudo cat /volume1/system_file/syno-acme_log.txt 没问题的话 \u0026gt;\u0026gt; 和后面的内容可以删掉，也可以改为 \u0026gt; 例如下面两行都可以\n1 2 /volume1/system_file/syno-acme-0.3.0_dsm7_beta/cert-up.sh update \u0026gt; /volume1/system_file/syno-acme-0.3.0_dsm7_beta/cert-up.sh update http自动跳转https 打开控制面板找到登录门户，在网页服务处勾选自动将DSM桌面的HTTP连接重定向到HTTPS后点击保存。\n路由器注意转发端口过来 过程略\n","date":"2022-12-21T22:14:20+08:00","permalink":"https://dev.leiyanhui.com/qh/ssl/","title":"群晖7.1.1 开启ssl 并开启自动续签 非docker方法"},{"content":"ventoy 无论配置 自动启动 linux 还是 windows.vhd 甚至 黑苹果的opencore 都是一样的\n前置条件 ventoy 内置了常见efi以及linux的虚拟磁盘启动。如果windows的话需要Ventoy分区 也就是 第一个分区里面，新建一个目录ventoy 并放入win7或者win8-11的ventoy_vhdboot.img文件 启动虚拟磁盘的linux的话，需要把对应的vhd img vdi文件修改后缀为 .vtoy\n配置ventoy 建议用 VentoyPlugson 直接在网页配置 或者复制下面代码到Ventoy分区 的ventoy\\ventoy.json中 VTOY_MENU_TIMEOUT 设置时间为3秒 VTOY_DEFAULT_IMAGE 建议留空，这样可以按照文件名顺序启动 VTOY_LINUX_REMOUNT 建议打开 完整的配置文件 ventoy\\ventoy.json如下\n1 2 3 4 5 6 { \u0026#34;control\u0026#34;:[ { \u0026#34;VTOY_LINUX_REMOUNT\u0026#34;: \u0026#34;1\u0026#34; }, { \u0026#34;VTOY_MENU_TIMEOUT\u0026#34;: \u0026#34;3\u0026#34; } ] } 配置虚拟磁盘链接 在winpe或者win下或者linux下用VentoyVlnk 创建一个想自动开机的虚拟磁盘的链接文件，放到Ventoy分区，并改名为 0.xxxx.vlnk.xxx 让他默认排在第一个\nbios中设置引导顺序 安装ventoy的硬盘或者U盘为第一引导设备\n重启测试，3秒后会自动选择 文件名排序第一的可引导文件\n","date":"2022-12-21T06:19:20+08:00","permalink":"https://dev.leiyanhui.com/os/ventoy-auto-boot/","title":"ventoy 配置开机自动启动 "},{"content":"格式化 1 2 3 mkfs.btrfs /dev/nvme0n1p4 mkfs.btrfs -f /dev/nvme0n1p4 #强制 lsblk 压缩 挂载时候全盘启用压缩 1 2 mount -o compress=lzo /dev/nvme0n1p4 /mnt mount -o compress=zstd /dev/sdx /mnt 自动挂载fstab\n1 /dev/nvme0n1p4 / btrfs defaults,compress-force=lzo,subvol=snapshot 0 1 lzo是压缩算法，目前btrfs支持lzo zlib ZSTD三种算法,旧版只支持lzo zlib ，默认压缩方式是 zlib 压缩等级是3\n单文件或者路径压缩 1 2 chattr +c file btrfs property set file compression zstd 关于写复制 改动频繁的文件，务必 使用chattr命令给文件或目录添加C属性\nwindows下可以全速读写btrfs分区：https://dev.leiyanhui.com/win/winbtrfs/\n参考： https://btrfs.readthedocs.io/en/latest/btrfs-man5.html#how-to-enable-compression\n后记 winpe 支持 测试winpe 为 firpe v1.8.1\n其他 真的不建议再用exfat了， macos的话，也可以用虚拟机映射分区的方法访问，然后sftp或者其他方式再挂载出来。 另外爱折腾我们最爱的ventoy 尚不支持 btrfs\n","date":"2022-12-21T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/linux/btrfs/","title":"btrfs 文件系统 简要说明 "},{"content":"mesa sudo pacman -S mesa 它提供用于3D加速的基础DRI驱动程序。\n虚拟机下的显卡驱动 虚拟机的情况，有很多中，常用的 vmware 和 virio gpu\nvirio gpu 需要手动 编译mesa\nvmware / virtual box sudo pacman -S xf86-video-vmware intel核显 sudo pacman -S xf86-video-intel Ivy Bridge及以上架构的cpu 只安装vulkan-intel 也可以\nNvidia sudo pacman -S nvidia nvidia-prime nvidia-settings nvidia-utils opencl-nvidia lib32-nvidia-utils lib32-opencl-nvidia nvidia驱动非开源的 可能需要/etc/pacman.conf打开 multilib 仓库 另外可能需要\nsudo pacman -S xf86-video-nouveau ","date":"2022-12-19T09:25:20+08:00","permalink":"https://dev.leiyanhui.com/arch/gpu-drvi/","title":"archLinux 下显卡驱动相关整理 intel amd Nvidia 包括虚拟机的"},{"content":"检查 cat /sys/module/kvm_intel/parameters/nested\n如果输出Y 那就是支持 就不用搞了\n如果没有打开 注意 必须关闭所有虚拟机，最好连容器一起关闭 然后\n1 2 3 4 modprobe -r kvm_intel modprobe kvm_intel nested=1 # 再次检查nested,输出Y，即为开启成功。 cat /sys/module/kvm_intel/parameters/nested 设置每次开机都打开 echo \u0026quot;options kvm_intel nested=1\u0026quot; \u0026gt;\u0026gt; /etc/modprobe.d/modprobe.conf 虚拟机设置 设置需要直通的虚拟机的cpu类型为host\n完毕 开启intel gvt - vgpu https://dev.leiyanhui.com/kvm/gvt-g-vgpu/\n简单安装esxi黑苹果 https://dev.leiyanhui.com/esxi/macos13/\n","date":"2022-12-15T00:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/pve-vm-esxi/","title":"pve开启虚拟化嵌套，方便后续使用esxi嵌套黑苹果以便使用核显"},{"content":" 之所以尝试esxi ，是因为 据说esxi下直通和黑苹果都要容易一些 而pve下直接直通核显到macos，后续的驱动处理实在是麻烦，甚至付费找不少人来处理都没有成功，实在是太单独时间了，过于折腾 所以本文尝试 用pve嵌套大esxi 来安装macos\n我网卡 是螃蟹卡，RTL8168。esxi 8 暂时没办法驱动，esxi7 也需要自己打包驱动，而且我更喜欢鲫鱼debian的pve或者直接原生的linux+kvm的方式。 宿主机是pve，开启了虚拟化嵌套，准备使用嵌套的方式 安装黑苹果并使用核显直通或者vgpu的方式。\n并且在pve开启了gvt,我不玩游戏，而且pve主机24小时开机，耗电上独显实在不适合我。另外 仅有的一个核显 还要给主力linux系统和另外一个Jellyfin使用，所以我这里选择了gvt方式。\n当然直通并点亮理论上也是可以的。\npve开启gvt\n准备esxi安装镜像 因为要安装macos，需要unlock掉esxi，所以先去看了一下unlock支持的esxi版本，得知已经支持esxi8\nvmware 官网下载一直提示邮编错误，不好处理。 sysin的集成镜像也开始收费\n找到一个博主的 https://www.dinghui.org/vmware-iso-download.html 最终选 了\n一开始选了8.0的镜像，但是web界面登录有问题，没时间排查，更换VMware-VMvisor-Installer-7.0U3g-20328353.x86_64.iso\n安装esxi 我这里是pve，步骤如下 创建虚拟机主机，机型选q35，传统bios（为了省事），qemu代理打开 磁盘 选SATA ，储存选32G （只装esxi 足够了，esxi7以后需要最小32G了），虚拟机文件另外挂盘处理 网卡的地方 网络模型 选 VMware vmxnet3，其他新版不支持 添加其他设备\n声卡：我不打算直通，因为我都是远程用，所以添加一个虚拟音频设置 ich9-intel-hda PCI设备： 核显，添加一个 i915-GVTg_V5_8 给它 wifi，添加bcm给他 usb设备：把bmc蓝牙给他 开机 安装\n登录esxi ","date":"2022-12-15T00:40:20+08:00","permalink":"https://dev.leiyanhui.com/esxi/pve-esxi-macos13/","title":"彻底解决pve下macos 直通核显的 问题！"},{"content":"arch安装xrdp，方便win和ipad远程控 1、先安装 yay arch安装yay最简单的办法 - 小类随手记 (leiyanhui.com)\n2、安装\n1 2 yay -S xrdp yay -S xorgxrdp ＃用ｘｏｒｇ做后端，推荐安装，也可以不用 xorgxrdp 和 xorgxrdp-glamor xorgxrdp-nvidia 选一个，\n官网wifi的一句话\n1 2 #将 allowed_users=anybody 添加到 /etc/X11/Xwrapper.config 以允许任何人启动 X 服务器。 sudo nano /etc/X11/Xwrapper.config 显卡3D 加速 用这两个就不用 xorgxrdp了\n1 2 3 4 #intel xorgxrdp-glamor 和 Nvidia GPU 安装 xorgxrdp-nvidia yay -S xorgxrdp-glamor #或者 yay -S xorgxrdp-nvidia 声音，需要用pulseaudio\n1 2 sudo pacman -S pulseaudio yay -S pulseaudio-module-xrdp 注意 pulseaudio-module-xrdp 依赖 sbc 和 bluez，如果没有安装的话，编译失败后 看一下原因\n提示\n1 Remember to pass the environment \u0026#34;PULSE_SCRIPT=/etc/xrdp/pulse/default.pa\u0026#34; to pulseaudio to make this module work 新版会自动添加 不用额外处理\n1 2 3 4 sudo nano /etc/xrdp/sesman.ini #添加 [SessionVariables] PULSE_SCRIPT=/etc/xrdp/pulse/default.pa 3、配置xrdp桌面，这步很重要 很重要 ,不然登录是空白\n1 2 3 4 5 6 7 8 9 cp /etc/X11/xinit/xinitrc ~/.xinitrc nano ~/.xinitrc #注释掉下面几行 这几乎是启动一个时钟 几个 xterm，实际上会导致xrdp无法登录 #twm \u0026amp; #xclock -geometry 50x50-1+1 \u0026amp; #xterm -geometry 80x50+494+51 \u0026amp; #xterm -geometry 80x20+494-0 \u0026amp; #exec xterm -geometry 80x66+0+0 -name login 添加内容\n声音部分的处理\n1 2 3 # 声音部分可能需要 有的桌面环境不需要 PULSE_SCRIPT=/etc/xrdp/pulse/default.pa pulseaudio --daemonize=no pulseaudio \u0026amp; 桌面环境\n1 2 3 # 添加 注意我的的 kde plasma 其他桌面自行处理 export DESKTOP_SESSION=plasma /usr/lib/plasma-dbus-run-session-if-needed startplasma-x11 如果是i3的话，直接exec就可以 dwm类似\n1 exec i3 4、启动和配置开机自动启动\n1 2 sudo systemctl enable xrdp sudo systemctl start xrdp 结束\n其他问题： 从xrdp里面关机或者重启 会导致xrdp黑屏无法登录，但是不会关机。\n解决方法 就是去ssh 处理，如果黑屏后需要重新登录xrdp就重启一下xrdp就好了 systemctl restart xrdp\n没声音的问题，基本上 pulseaudio 没启动，或者远程桌面客户端这边 没设置声音播放\n感受 单纯文字办公 和写代码的话，还可以，如果要播放视频，视频可以很流畅，但是声音卡会卡。\nxvnc 要比 xorg 流畅很多，声音也要比xorg流畅一点点\n中间尝试过自己搭建 rustdesk 中转 ，效果也一般般。哪怕局域网内 rustdesk 有时候 也会糊，但是声音要比xrdp流畅一些。\n另外 ibus 也有一点问题，建议用 fcitx5\n","date":"2022-12-14T13:14:20+08:00","permalink":"https://dev.leiyanhui.com/c/arch-install-xrdp/","title":"archlinux安装xrdp，可以和方便win和ipad远程控 i3 kde dwm"},{"content":"关于阿里云的镜像服务 目前阿里云的docker镜像服务只限制并发数要求\u0026lt;10，并不限制容量和速度。 可以满足日常小团队使用。\n配置阿里云容器服务 打开 https://cr.console.aliyun.com/cn-qingdao/instances 我这里选青岛节点\n创建个人版实例\n弄一个公开的镜像 创建一个镜像仓库 先弄一个公开的 仓库名称 ：base-sh-debian 选择本地仓库\n推送镜像 docker login --username=邮箱 registry.cn-qingdao.aliyuncs.com # 用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。 docker docker images # docker tag [ImageId] registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:[镜像版本号] docker tag debian11:sshd-autoboot.sh2222 registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222 # docker push registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:[镜像版本号] docker push registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222 因为这个是公开的，所以可以直接使用 1 2 3 docker run -itd --name debian-go-codeserver-git --privileged=true \\ -p 59010:2222 -p 59011-59019:59011-59019 \\ registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222 sh /autoboot.sh 这镜像的详细使用 点击这里查看\n清理 docker rmi registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222 私有镜像，也就是只有有密码才可以获取的 创建一个私有仓库 过程略 名字就叫做 mydocker\n把正在使用的容器直接打包到镜像 我这里不保留历史记录 所以不使用docker commit\n1 2 3 4 5 6 7 8 # 导出 docker export debian-go-codeserver-git \u0026gt; debian11-for-sshd.tar # 打包压缩 这步可以跳过,因为这里还要本地储存一下 gzip debian11-for-sshd.tar # 导入，这里直接导入到阿里云的格式 就不用再打一次标签。 cat debian11-for-sshd.tar.gz | docker import - registry.cn-qingdao.aliyuncs.com/joyanhui/mydocker:debian11-ssh-coder-golang-git-autoboot.sh2222-2022-1213 # 推送 docker push registry.cn-qingdao.aliyuncs.com/joyanhui/mydocker:debian11-ssh-coder-golang-git-autoboot.sh2222-2022-1213 清理\n1 docker rmi registry.cn-qingdao.aliyuncs.com/joyanhui/mydocker:debian11-ssh-coder-golang-git-autoboot.sh2222-2022-1213 编写一个shell docker.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # 一键备份正在运行的docker到阿里云 并丢弃历史记录 # 登录 # docker login --username=用户名 registry.cn-区域.aliyuncs.com # 阿里云远程地址 remoturl=registry.cn-qingdao.aliyuncs.com/你的/你的仓库名称 # 要备份的容器名称 dockername=debian-go-codeserver-git # 标签前缀 tagname=debian11-ssh-coder-golang-git-autoboot.sh2222 # 临时文件名前缀 tarfilename=debian-go-codeserver-git datename=$(date +%Y%m%d-%H%M%S) echo 当前时间 $datename echo 导出到tar... docker export $dockername\u0026gt; $tarfilename-$datename.tar echo 导出到tar...完毕 echo tar导入到镜像... cat $tarfilename-$datename.tar | docker import - $remoturl:$tagname-$datename echo tar导入到镜像...完毕 echo 推送镜像到阿里云青岛... docker push $remoturl:$tagname-$datename echo 推送镜像到阿里云青岛... 完毕 echo 删除本地镜像 docker rmi $remoturl:$tagname-$datename echo 删除本地文件 rm -rf $tarfilename-$datename.tar echo 完毕 echo 请打开 https://cr.console.aliyun.com/cn-qingdao/instance/repositories 查看 加到计划任务，每天一次 /var/spool/cron/crontabs/root 或者 crontab -e 查看状态service crond status\n1 2 3 4 5 6 7 8 9 10 11 cat /var/spool/cron/crontabs/root # do daily/weekly/monthly maintenance # min hour day month weekday command */15 * * * * run-parts /etc/periodic/15min 0 * * * * run-parts /etc/periodic/hourly 0 2 * * * run-parts /etc/periodic/daily 0 3 * * 6 run-parts /etc/periodic/weekly 0 5 1 * * run-parts /etc/periodic/monthly 15 9 * * * sh /home/tom/docker.sh ","date":"2022-12-13T09:58:20+08:00","permalink":"https://dev.leiyanhui.com/docker/img-to-aliyun/","title":"docker镜像备份到阿里云容器服务"},{"content":"项目简介 https://hub.docker.com/r/linuxserver/\n他是默认开了web vnc 和 xrdp的\n其中ubuntu的镜像是支持3d加速的。\n准备工作 先查看宿主机的显卡 ls /dev/dri usb设备 ls /dev/bus/usb 可以用 usbutils 和 lspice 详细查看\n选择 webtop 镜像 没有gnome,我这里 选择 ubuntu-kde，\n和常规docker不一样的地方 1、设备的映射\n--device /dev/dri:/dev/dri \\ --device /dev/fuse \\ /dev/dri 显卡 /dev/fuse 就是fuse 宿主机要 \u0026lsquo;modprobe fuse\u0026rsquo;\n2、docker嵌套\n-v /var/run/docker.sock:/var/run/docker.sock \\ 3、权限\n1 2 --device /dev/fuse \\ --cap-add SYS_ADMIN \\ 或者\n1 2 3 --device /dev/fuse \\ --cap-add SYS_ADMIN \\ --security-opt apparmor:unconfined \\ 实在不行直接上 --privileged\n创建 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 docker stop webtop-arch-kde \u0026amp;\u0026amp; docker rm webtop-arch-kde docker run -d \\ --name=webtop-arch-kde \\ --hostname=docker-arch \\ --privileged \\ --security-opt seccomp=unconfined \\ -e PUID=1000 \\ -e PGID=1000 \\ -e TZ=Asia/Shanghai \\ -e SUBFOLDER=/ \\ -e KEYBOARD=en-us-qwerty \\ -e TITLE=Webtop \\ -p 59030:3000 \\ -p 59031:3389 \\ -p 59032:22 \\ -p 59033-59039:59033-59039 \\ -v /var/run/docker.sock:/var/run/docker.sock \\ -v /dev/bus/usb:/dev/bus/usb \\ --device /dev/dri:/dev/dri \\ --cap-add SYS_ADMIN --cap-add MKNOD --device /dev/fuse:mrw \\ --restart unless-stopped \\ linuxserver/webtop:arch-kde 中文和汉化 1 2 sudo pacman -Sy nano sudo nano /etc/pacman.d/mirrorlist 1 Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch 1 2 3 sudo pacman -S wqy-microhei sudo pacman -S wqy-zenhei sudo pacman -S fcitx5-im fcitx5-rime 时区 需要su sudo passwd root echo \u0026ldquo;Asia/Shanghai\u0026rdquo; \u0026gt; /etc/timezone rm -rf /etc/localtime ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n输入法配置 1 2 3 4 5 6 7 sudo nano /etc/environment ----------- GTK_IM_MODULE=fcitx QT_IM_MODULE=fcitx XMODIFIERS=@im=fcitx SDL_IM_MODULE=fcitx GLFW_IM_MODULE=ibus 1 source /etc/environment yay 1 sudo nano /etc/pacman.conf 1 2 [archlinuxcn] Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch 1 2 sudo pacman -Sy archlinuxcn-keyring sudo pacman -S yay 其他常用工具 1 sudo pacman -S wget unzip 聊天软件 1 2 3 4 5 6 7 8 9 10 11 sudo pacman -S libnotify dunst #通知服务 yay -S electronic-wechat-uos-bin #kde还需要一个 sudo pacman -S xdg-desktop-portal-kde wget -c https://dldir1.qq.com/qqfile/qq/QQNT/4691a571/QQ-v2.0.1-429_x64.AppImage chmod u+x ./QQ-* #AppImage依赖fuse，docker里面的fuse有一点小问题，启动测试 ./QQ-v2.0.1-429_x64.AppImage --appimage-extract-and-run sudo pacman -S telegram-desktop 宿主重启一下docker 1 docker restart webtop-arch-kde 最后结语 因为docker的原因，后续一些小地方的处理会非常麻烦\n尝鲜 可以，或者只用几个简单的软件也没啥问题，日用还是有一些问题的。\n只用来跑一个几个软件 是不错的选择。\n","date":"2022-12-13T09:58:20+08:00","permalink":"https://dev.leiyanhui.com/docker/run-deskto-gpu-usb/","title":"docker运行一个可以使用usb和显卡加速的桌面linux"},{"content":"基于pve7.3 理论上7.x 通用\npve7.3 默认安装后不需要编辑sshd_config，直执行 apt install -y xauth 即可\n1 2 3 4 5 apt install -y xauth nano /etc/ssh/sshd_config --------------- X11Forwarding yes X11UseLocalhost no 重启ssh\n1 systemctl restart sshd 用 Xming 或者MobaXterm 重新连接上，安装一个图形界面软件 测试，比如 apt install firefox\n而后测试\n","date":"2022-12-11T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/x11/","title":"pve 开启x11转发"},{"content":"修改网卡 需要修改配置文件的两处地方\n查看网卡 ip a 除去lo和vmbr0 之外的网卡 就是我们需要用的网卡，如果是wifi网卡（一般wl开头的）的话需要额外处理 这里不在记录 我这里的实际需要的网卡名称为 enp1s0\n编辑interfaces 1 nano /etc/network/interfaces 把 iface xxx inet manual 这行里面的网卡名称修改为enp1s0 再把 bridge-ports XXX 后面的网卡名称修改为enp1s0\n修改ip 需要修改3个文件,注意网关掩码 都根据你的情况修改\n1 2 3 /etc/network/interfaces /etc/issue /etc/hosts 重启PVE\n修改主机名 需要修改两个文件\n1 2 /etc/hostname /etc/hosts 如果用邮件服务，还要修改\n1 /etc/postfix/main.cf ","date":"2022-12-11T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/changip-and-netcard/","title":"pve 修改网卡和ip 主机名称"},{"content":"cachyos是基于arch的一个发行版，有点是带x86_64_v3 的一个仓库。 可以提升10%的cpu性能。 并且可以和arch的仓库混用。\n准备切换 ，就备份一下 1 sudo cp /etc/pacman.conf /etc/pacman.conf-bak-before-cachyos 直接用官网包处理源 1 2 3 wget https://mirror.cachyos.org/cachyos-repo.tar.xz tar xvf cachyos-repo.tar.xz \u0026amp;\u0026amp; cd cachyos-repo sudo ./cachyos-repo.sh 实际修改后的文件多了一段 1 2 [cachyos-v3] Include = /etc/pacman.d/cachyos-v3-mirrorlist 更新 1 sudo pacman -Syyu 会把你已经装过的替换为v3版\n更换内核 1 sudo pacman -S linux-cachyos-pds-lto 配置引导 1 2 3 4 5 sudo nano /etc/default/grub ---添加或者修改三行-方便引导的时候选择内核 GRUB_DISABLE_SUBMENU=y GRUB_DEFAULT=saved GRUB_SAVEDEFAULT=true 更新引导 然后重启 选择新装的内核pds sudo grub-mkconfig -o /boot/grub/grub.cfg\n卸载旧内核清理 1 2 3 sudo pacman -Rns linux sudo grub-mkconfig -o /boot/grub/grub.cfg yay -Sccc ","date":"2022-12-11T20:25:20+08:00","permalink":"https://dev.leiyanhui.com/arch/arch-to-cachyos/","title":"archLinux 切换到cachyos发行版"},{"content":"简单说明 i3w 不单 可以多个屏幕，还可以多组windows，甚至可以存在 父组 子组等。\n常用快捷键 $mod + Enter\t启动虚拟终端\n$mod + A\t焦点转义到父窗口上\n$mod + S\t堆叠布局\n$mod + W\t标签布局\n$mod + E\t默认布局 连续按下 可以从 纵向排列和竖向排列之间 来回切换\n$mod + SpaceBar\t焦点在平铺式／浮动式转换\n$mod + Shift + SpaceBar\t窗口在平铺式／浮动式转换\n$mod + shift + \u0026lt;数字键\u0026gt; 将当前程序发送到指定window\n$mod + \u0026lt;方向键\u0026gt; 移动鼠标到焦点\n$mod + shift + \u0026lt;方向键\u0026gt; 移动窗口位置\n$mod + D\t启动 dmenu\n$mod + H\t水平分割窗口\n$mod + V\t垂直分割窗口\n$mod + J\t焦点往左窗口移\n$mod + K\t焦点往下窗口移\n$mod + L\t焦点往上窗口移\n$mod + ;\t焦点往右窗口移\n$mod + Shift + Q\t杀死当前窗口的进程\n$mod + Shift + E\t退出 i3\n$mod + Shift + C\t当场重新加载 i3config, 无需重启\n$mod + Shift + R\t重启 i3 （还重新加载了 i3config, 又没有退出过程）\n$mod + Shift + J\t窗口左移 等同于 $mod + shift + \u0026lt;方向键\u0026gt;\n$mod + Shift + K\t窗口下移 等同于 $mod + shift + \u0026lt;方向键\u0026gt;\n$mod + Shift + L\t窗口上移 等同于 $mod + shift + \u0026lt;方向键\u0026gt;\n$mod + Shift + :\t窗口右移 等同于 $mod + shift + \u0026lt;方向键\u0026gt;\n$mod + \u0026lt;数字键\u0026gt; 切换window\n$mod + F 焦点窗口全屏\n","date":"2022-12-11T08:23:20+08:00","permalink":"https://dev.leiyanhui.com/arch/i3w-config-key/","title":"i3w 常用快捷键和基本配置"},{"content":"在/home/用户名 这个目录下存放着我们的大量配置文件。尤其是系统的一些配置i，还有一些个别软件的配置。\n先创建远程私有库和token key 过程略\n配置过滤文件 .gitignore .gitignore\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 修改后需要执行下面命令清理缓存 # git rm -r --cached . /.cache /Downloads /下载 /.mozilla /.config/electronic-wechat /.config/icalingua /.config/QQ /.local/share/logs /golang/webdavgo/.git /golang/webdavgo/bin /.gocache /golang/ole/ /.local/share/code-server/logs vscode.lock code-server-stdout.log /.local/share/fish/fish_history 处理git 这样嗯里 git.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 定义源 git remote set-url origin https://joyanhui:XXX@github.com/joyanhui/XXXX.git # 修改 .gitignore 后需要清理缓存 # #git init #git rm -r --cached . git add . git commit -m \u0026#34;sh git.sh 自动 $(date \u0026#34;+%Y-%m-%d %H:%M:%S\u0026#34;) -$RANDOM\u0026#34; # 挂代理 export http_proxy=\u0026#34;10.0.0.1:20172\u0026#34; export https_proxy=\u0026#34;10.0.0.1:20172\u0026#34; # git remote add origin https://joyanhui:XXX@github.com/joyanhui/XXXX.git # git remote set-url origin https://joyanhui:XXX@github.com/joyanhui/XXXX.git # git pull --rebase origin master # 强制覆盖 git push -f origin master git push -u origin master ","date":"2022-12-11T07:25:20+08:00","permalink":"https://dev.leiyanhui.com/arch/git-backup-userdir/","title":"linux下git备份home目录到远程仓库"},{"content":"安裝 ibus 基础 1 sudo pacman -S ibus 安装一个输入法引擎 1 sudo pacman -S ibus-rime # ibus-libpinyin ibus-pinyin 启动 1 ibus-daemon -d -x 配置 右键ibus托盘，简单配置。 rime的话，直接打开输入框（第一次启动有一些延迟） 然后点F4 选择简体\n和其他软件的通讯 多数软件可以使用，部分软件,最好加到 ~/.pam_environment\n1 2 3 4 export GTK_IM_MODULE=ibus export XMODIFIERS=@im=ibus export QT_IM_MODULE=ibus ibus-daemon -d -x ","date":"2022-12-08T08:02:20+08:00","permalink":"https://dev.leiyanhui.com/arch/ibus-install/","title":"archLinux ibus "},{"content":"现在用的i3w，准备安装一个gnome 一起使用，从头开始弄\n手动安装最基本的archlinux https://dev.leiyanhui.com/arch/base-install/\n安装xorg和显卡驱动之类的 pacman -S linux-firmware xf86-video-vesa xorg-server sudo pacman -S --needed xorg-server gnome-shell sudo pacman -S gnome-shell 解压后300M+\n其他可能需要的gnome 组件 设置组件 sudo pacman -S gnome-control-center 解压后130M，包括壁纸设置 分辨率 屏幕方向 等等\n配置中文 sudo nano /etc/locale.gen ------ en_US.UTF-8 UTF-8 zh_CN.UTF-8 UTF-8 zh_SG.UTF-8 UTF-8 主题和扩展 sudo pacman -S gnome-themes-extra yay -S chrome-gnome-shell 火狐打开 https://extensions.gnome.org/ 按照提示安装扩展 比如 dock from dash ，固定dock\n卸载 1 sudo pacman -Rns gnome-themes-extra chrome-gnome-shell gnome-control-center gnome-shell 中文字体 自己选一个，我还是喜欢雅黑。。\n输入法 sudo pacman -S ibus-rime 安装登录管理器 可以用 xorg-xinit ，但是我这里需要用rustdesk 所以选 lightdm\nsudo pacman -S lightdm-gtk-greeter sudo systemctl enable lightdm sudo systemctl start lightdm 其他 应用软件 自己喜欢的文件管理器和终端 文本编辑器等尽量和i3w 复用\n1 sudo pacman -S thunar xed terminator ","date":"2022-12-07T09:58:20+08:00","permalink":"https://dev.leiyanhui.com/arch/arch-linux-install-gnome-desktop/","title":"arch linux最小化安装gnome"},{"content":"qq终于更新linux版本啦。 虽然不出所料是electron版，但是总算是更新啦\u0026hellip;\n内测群消息 2022-12-07 09:47\nhttps://dldir1.qq.com/qqfile/qq/QQNT/4691a571/QQ-v2.0.1-429_x64.AppImage\n#Linux QQ 全新来袭#时隔3年，Linux QQ基于NT架构全新升级啦\n[庆祝]12月7日起，正式开启公测，期待收到大家反馈的声音关于体验方式点击下方链接，即刻“尝鲜”\nhttps://dldir1.qq.com/qqfile/qq/QQNT/4691a571/QQ-v2.0.1-429_x64.deb\nhttps://dldir1.qq.com/qqfile/qq/QQNT/4691a571/QQ-v2.0.1-429_x64.rpm\nhttps://dldir1.qq.com/qqfile/qq/QQNT/4691a571/QQ-v2.0.1-429_x64.AppImage\nps：暂时只支持x64架构，arm64架构还在加急适配中，敬请期待！关于体验名单仅限12月6日19点前进群的成员\n关于体验反馈点击主面板左下角的“更多-帮助-意见反馈”进行用户反馈最后，期待并感谢大家的体验和反馈～\n初步测试 白名单内测，不在内测群的帐号登录不上。cpu不算太高，我这单核心30%以内，其他几个进程多数休眠状态。内测200-300M之间波动，\n比起第三方Icalingua++ 和旧版不错的地方\n可以群搜索 可以折叠群 群文件 正常 私聊发送文件 正常 界面和macos的测试版差不多。 表情可以漫游 邮箱可以调用默认浏览器 有qq空间和小世界入口 调用内置浏览器 等等 存在的问题\narch i3w 下 没有系统托盘图标 没有消息通知 暂时不知道依赖和插件情况 无法处理，管理没明确说，这算是严重bug，后续应该会修复。 没有语音通话和视频通话 无法接受语音消息 群聊里面 聊天记录列表不显示管理或者群主头衔，群聊右侧用户列表可以显示 wayland 下截图应该是有问题 x11 xorg 下截图会闪一下窗口，卡2秒左右 群不显示在线人数，只显示全部人数 有人反映不关闭新版QQ 无法关机 需要扫码登录 暂时不支持密码登录，以后是否支持不确定（mac electron版已经支持） 字体默认，无法修改，部分界面存在两种字体混用的情况 怪怪的。需要认真自行配置桌面环境字体。 双击回复功能 没有，只能右键 QQ频道 公众号 小程序也没有（这算最大优点 哈哈） 小世界 没有硬解，纯软解，吃你2个核心的cpu不在话下 哈哈 聊天记录 存放在 .config/QQ/nt_qq_XXXX/ 目录，自动备份config目录的同学注意啦。。 小问题有一些，主要是系统托盘和消息提醒功能 以及语音和视频，但是整体可以用。 意外的惊喜\n全局快捷键支持，兼容i3w 这个版本支持多开 整体感觉 比之前的版本的界面好了不是一点半点，消息通知问题，晚点看看 应该可以解决。测试版也不是最终版。\n当然 也支持docker 运行\n用户文件看起来放 ~/.config/QQ里了,\n然后鬼畜的是聊天记录文件也放到config了 .config/QQ/nt_qq_XXXX/。不知道这是内测版的失误，还是有心这样做的。群里讨论这个话题很长时间，官方管理没有对此回复。\n大部分linux用户有备份甚至自动同步config目录的习惯。这下 都被测试版给坑了。一会功夫config目录从几百K变成几个G\u0026hellip;.\ndocker x11转发完美运行，再也不用担心qq 乱读我的文件 吃我cpu和内存了。\n感谢Icalingua++ 的相伴，卸载啦\n一点小遗憾 其实还是希望qt的，如果常用软件都electron了\u0026hellip;linux桌面环境只能更加恶劣\n内测申请 目前测试是内测白名单，群内昨天下午进群的自动白名单。没有进群的需要填写表单申请\n申请地址： https://docs.qq.com/form/page/DUXdac0ZaVEZUSnVn#/fill\n","date":"2022-12-07T09:58:20+08:00","permalink":"https://dev.leiyanhui.com/arch/new-qq2022/","title":"QQ linux 新版终于发布啦"},{"content":"宝塔经历过几次严重漏洞，加上最近小bug不断，甚至有的bug反反复复，如同月经一样，每个月出现一次（宝塔周更）\n还有之前直播间的事故，强制绑定手机号等等\u0026hellip;.官网bug论坛的机器人一样的回复：我没有bug，你更新一下\n反正就是死不承认，然后一直到反馈的人多了，甚至过去数周才去修复，然后过几周可能又复现\n这个曾经优秀的国产软件，也可能是因为用户群太多，也可能是内部管理真的是混乱不堪。频繁爆出bug 还有 安全问题。\n去年开始，新机器上就避免再使用宝塔。\n这次宝塔的操作 也非常惊人，宝塔官方自己的demo都被黑掉，依旧不承认有漏洞，然后在论坛开始疯狂删反馈贴！\n搞笑的是，宝塔自己的demo 迟迟都没有处理掉，第二天早上直接挂403了。 真的是。。。\n首先说，还是推荐尽量手搓的方式来管理生产服务器，真的不建议再用宝塔这种鬼东西。\n如果实在是需要图形界面 或者一键环境 可以看一下相关替代产品\n替代品 1、https://cockpit-project.org/\nCockpit 是由 Red Hat 开发的使得管理服务器变得轻松简单的自由开源软件。它非常适合于进行简单的系统管理任务和新手系统管理员。\n2、https://github.com/midoks/mdserver-web UI跟宝塔差不多，但个人试用了一下发现占用资源挺高的。\n3、https://hestiacp.com/ 太简单，功能不足\n4、https://oneinstack.com/ 类lnmp，无web UI\n5、https://cyberpanel.net/ 太简单，功能不足\n6、https://lnmp.org/ 无web UI\n7、https://github.com/DevHaoZi/Panel 耗子面板，仅支持redhat系列\n8、http://amh.sh/ amh面板\n9、https://www.appnode.com/\n10、https://vestacp.com/\n11、https://fastpanel.direct/\n12、https://www.urlos.com/\n13、https://www.hws.com/\n14、https://www.digitalocean.com/community/tools/nginx?global.app.lang=zhCN\n15、 Nginx Proxy Manager https://nginxproxymanager.com/ 纯nginx反代 和 le证书管理工具\n16、 纯证书管理 https://github.com/acmesh-official/acme.sh\n17、超过25年的老古董Webmin/Virtualmin\n","date":"2022-12-07T09:58:20+08:00","permalink":"https://dev.leiyanhui.com/linux/other-bt/","title":"再见宝塔，关于宝塔的17个替代品"},{"content":"安装配置codeserver 1 2 yay -S code-server sudo systemctl enable --now code-server@$USER 默认地址：http://127.0.0.1:8080 配置文件在 ~/.config/code-server/config.yaml 简单修改允许外网访问，并在路由做好端口转发 或者nginx ssl代理\n1 2 3 4 bind-addr: 0.0.0.0:8080 auth: password password: 密码 cert: false 重启\n1 sudo systemctl restart code-server@$USER 安装go 建议手动安装 ：https://dev.leiyanhui.com/c/ubuntu-install-golang/\npacman 安装也可以sudo pacman -S go\n非root用户的处理 1 2 cd ~ mkdir .gocache 编辑 /etc/profile 或者用户目录下.profile文件\n1 export GOCACHE=/home/用户名/.gocache 完整内容\n1 2 3 4 5 6 7 export GO111MODULE=on export GOROOT=/opt/go export GOPATH=/opt/gopath #export GOCACHE=/opt/gocache export GOCACHE=/home/用户名/.gocache export GOPROXY=https://proxy.golang.com.cn,direct export PATH=$PATH:$GOROOT/bin:$GOPATH/bin 配置codeserver的go插件 注意点，如当前用户权限不够，需要su到root下执行,sudo执行 会有网络超时的问题 https://dev.leiyanhui.com/codeserver/vscode-golang-err-gocache/\n测试一个项目 1 2 3 4 mkdir golang \u0026amp;\u0026amp; cd golang git clone https://github.com/joyanhui/webdavgo.git su #切换到root go get golang.org/x/net/webdav #webdav coderserver 打开运行测试\n","date":"2022-12-06T09:25:20+08:00","permalink":"https://dev.leiyanhui.com/arch/arch-golang-codeserver/","title":"archLinux 快速搭建golang开发环境"},{"content":"超简单\n1 sudo pacman -S arduino 库文件路径 /home/用户名/.arduino15/\n其他说明 https://wiki.archlinux.org/title/Arduino_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#\n","date":"2022-12-06T09:10:20+08:00","permalink":"https://dev.leiyanhui.com/arch/install-adruino/","title":"archLinux 快速搭建garduino单片机开发环境"},{"content":" 此类软件为了躲避审查都存活时间不长久。看到就赶紧下载吧。\n不需要越狱，下载后需要简单处理后才会变成正常电影app\n这类软件多数是采集的第三方，所以速度不一定适合你的网络情况。\n如果提示没在对应的国家上架，那么大概就是被发现后被下架了。可以尝试换到外区id，如果还不行，就等新的吧。\n1、小厨房\nhttps://apps.apple.com/cn/app/%E5%B0%8F%E5%8E%A8%E6%88%90%E9%95%BF%E8%AE%B0/id6444581520\n安装后，点 首页左上角 小厨成长记 连续点3下，退出划掉后台重新打开\n目前暂时无广告，线路多，速度还可以,不卡\n2、常拜访\n连续点击顶部的【拜访日程】3下，退出划掉后台重进 。 有广告。也不卡。\nhttps://apps.apple.com/cn/app/%E5%B8%B8%E6%8B%9C%E8%AE%BF/id6444376912\n3、生活图记\n打开后只能能用，如不行，划掉重新打开。\nhttps://apps.apple.com/cn/app/%E7%94%9F%E6%B4%BB%E5%9B%BE%E8%AE%B0/id6444063802\n无广告，但是线路少，有点卡\n","date":"2022-12-06T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/ios/other_vodapp/","title":"iphone苹果手机免费观看电影的app"},{"content":"##linux常用的远程桌面 方式 不得不说 对比 微软的rdp协议，linux和macos下 都没有可以比肩的。rdp可以在低带宽提供几乎没有任何延迟的桌面体验。但开源的xrdp相比而言 简直就是一个垃圾了。 如果是kvm运行的系统 也可以用spice协议。vnc这种上古方式，也不是不可以用，看个人需求吧。\n第三方的，好用一点点的基本都收费，我这里用rustdesk 来替代那些收费的第三方\nhttps://wiki.archlinux.org/title/List_of_applications/Internet\n前置 pve中运行的archlinux安装了i3w 并基本可以用 https://dev.leiyanhui.com/arch/startx/ 安装了yay https://dev.leiyanhui.com/c/archlinux-install-yay/ 自建了一个rustdesk的中转服务器，https://dev.leiyanhui.com/docker/rustdesk-server/ pve中分配给arch的显卡是 virio 支持3D 安装 rust官方提供了 zst 包\n1 wget -c https://gitee.com/rustdesk/rustdesk/releases/download/1.1.9/rustdesk-1.1.9-manjaro-arch.pkg.tar.zst gitee真牛比，国内网络可以提供比github还慢的速度\u0026hellip;\n1 pacman -U rustdesk-1.1.9-manjaro-arch.pkg.tar.zst 依赖也不少\n1 2 3 4 5 6 Packages (12) python-3.10.8-3 python-attrs-22.1.0-1 python-cffi-1.15.1-1 python-cryptography-38.0.4-1 python-packaging-21.3-1 python-pip-22.3.1-1 python-ply-3.11-10 python-pycparser-2.21-3 python-pyparsing-3.0.9-1 python-wheel-0.38.4-1 ttf-arphic-uming-0.2.20080216.2-1 rustdesk-1.1.9-0 Total Download Size: 23.72 MiB Total Installed Size: 119.66 MiB i3w 里面启动和配置 启动 win（hotkey）+d ，输入 restdesk，启动，配置id服务器和密钥\n浮动窗口 不开启浮动窗口的话。。。大概要占个屏幕\n开机启动启动 sudo systemctl enable rustdesk rustdesk 不支持tty（startx） 的解决。 需要安装一个显示管理器，我这里用lightdm\nsudo pacman -S lightdm-gtk-greeter sudo systemctl enable lightdm sudo systemctl start lightdm lightdm+i3的一些配置 同时需要处理一下输入法和分辨率 直接改 i3的位置文件\n1 2 3 4 5 6 7 8 9 10 11 12 #壁纸 exec_always --no-startup-id feh --randomize --bg-fill ~/wallpaper #半透明 exec_always --no-startup-id picom #分辨率 exec --no-startup-id xrandr --output Virtual-1 --mode 1920x1080 #输入法 exec --no-startup-id fcitx -d #截屏工具 exec --no-startup-id flameshot 输入法 放到\nnano .bashrc 其他 yay -S rustdesk 这个包有坑，不建议\n","date":"2022-12-04T00:23:20+08:00","permalink":"https://dev.leiyanhui.com/arch/rustdesk/","title":"archlinux i3w下配置rustdesk"},{"content":" 1 2 3 4 5 6 7 8 # 挂载阿里云盘 webdav，这个写计划任务靠谱一些 */1 * * * * rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime */1 * * * * rclone mount aliyunpan:/MediaVodCenter /mnt/MediaVodCenter --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime # 整机重启 15 5 * * * sleep 70 \u0026amp;\u0026amp; echo \u0026#34;每天5点15分+70秒路由器自动重启\u0026#34; \u0026gt; /etc/banner \u0026amp;\u0026amp; reboot 15 17 * * * sleep 70 \u0026amp;\u0026amp; echo \u0026#34;每天17点15分+70秒路由器自动重启\u0026#34; \u0026gt; /etc/banner \u0026amp;\u0026amp; reboot # 重启dnsmasq 15 */3 * * * sleep 70 \u0026amp;\u0026amp; echo \u0026#34;三小时重启一次dnsmasp\u0026#34; \u0026gt; /etc/banner \u0026amp;\u0026amp; /etc/init.d/dnsmasq restart ","date":"2022-12-01T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/crontab/","title":"openwrt常用计划任务"},{"content":"以 移动local节点的目录为例，先配置分区自动挂载到pve 查看本文 https://dev.leiyanhui.com/pve/auto-mount-exfat\n我这里主要是移动images目录，也就是虚拟机的lxc的目录\n关闭所有虚拟机和lxc，\n1 2 cd /var/lib/vz/ mv images /nvme/pve_vm_images # mkdir /nvme/pve_vm_images pve 会自动新建image目录，所以我们要同时执行rm 和ln\n1 rm -rf images \u0026amp;\u0026amp; ln -s /nvme/pve_vm_images images 注意新装的pve 有可能是没有images目录的 完毕\ntemplate 目录 不建议直接移动，毕竟要用的iso的和lxc镜像并不多，直接在对应目录下ln -s 可能更简单一些。\n如果要处理 一样 执行\n1 2 3 4 cd /var/lib/vz/template #mv iso /exfat/iso rm -rf iso \u0026amp;\u0026amp; ln -s /exfat/iso iso rm -rf iso \u0026amp;\u0026amp; ln -s /exfat/iso iso 其他的目录也可以修改 dump private snippets\n/var/lib/vz/dump\n1 2 3 4 5 6 cd /var/lib/vz mv dump /exfat/dump-pve-back rm -rf dump \u0026amp;\u0026amp; ln -s /exfat/dump-pve-back dump mv snippets /exfat/exfat/snippets-pve rm -rf snippets \u0026amp;\u0026amp; ln -s /exfat/snippets-pve snippets ","date":"2022-11-29T23:34:20+08:00","permalink":"https://dev.leiyanhui.com/pve/pve-mv-dir/","title":"pve 移动默认目录"},{"content":"运行太久了 会越来越大。\n1 ls /var/log/pveproxy/ 1 access.log access.log.1 access.log.2.gz access.log.3.gz access.log.4.gz access.log.5.gz access.log.6.gz 清理 1 2 3 4 5 6 rm -rf /var/log/* mkdir /var/log/pveproxy touch /var/log/pveproxy/access.log chown -R www-data:www-data /var/log/pveproxy systemctl restart pveproxy.service 删除历史命令 1 2 history -c echo \u0026gt; $HOME/.bash_history ","date":"2022-11-29T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/del-log/","title":"pve 删除运行日志"},{"content":"windows server 2012以后的版本都支持，但是考虑到不折腾，win7 win8 win10 都是可以实现的，考虑到兼容性 和免折腾，我选择 win10。\n母盘选择Win_Pro_10_22H2_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-20012.ISO kms激活到专业工作站版本，专业版也可以。家庭版不确定 Microsoft Windows [版本 10.0.19045.2006] 借用第三方开源工具remoteapptool轻松实现\nhttp://www.kimknight.net/remoteapptool\nhttps://github.com/kimmknight/remoteapptool\nremoteapptool 的权限问题依赖账户系统，也比较简单。如果需要严格详细的限制权限功能，还是用window server自带的remoteapp 来处理。 我这里是小团队使用没有那么复杂\n下载安装RemoteApp.Tool https://github.com/kimmknight/remoteapptool/releases/download/v6.0.0.0/RemoteApp.Tool.6000.zip\n解压就可以了，使用很简单 就是添加可执行文件，\n因为是自己用，所以先添加两个 C:\\Windows\\explorer.exe C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe\n创建rdp文件 然后rdp文件复制到其他win或者macos电脑上。win下直接打开 macos下用微软的 远程桌面客户端 就可以了。\nLinux的客户端 还没研究明白\n当然需要先自行打开 Windows的远程桌面 并且正常连接后\n下一步是需要处理 win10的多用户登录\nwin10 多用户登录 这个是非必须的，但不解决只能同时使用一个用户登录，并且不可以 去下载，主页：https://github.com/stascorp/rdpwrap\n下载破解程序 https://github.com/stascorp/rdpwrap/releases/download/v1.6.2/RDPWrap-v1.6.2.zip 加载后解压即可，这个程序不少杀毒软件都提示病毒风险的，这个是正常的。也已经很久没更新过了\n下载最新的破解配置文件 只要不是太新的win内核版本（最近1-2周的） 一般都支持 https://github.com/sebaxakerhtc/rdpwrap.ini/blob/master/rdpwrap.ini 下载后复制到和RDPWrap 同一个目录下\n开始处理 建议全部挪到 C:\\Program Files\\RDP Wrapper 目录下 先打开RDPConf.exe 查看一下 双击下运行 install.bat 就耐心等待。 一直到提示You can check RDP functionality with RDPCheck program. 重新打开 RDPConf.exe 全绿色就好了\n常见问题 微信黑框的问题 暂时无解\n聊天软件 和其他软件系统托盘的问题 暂时无解\n后台程序热键问题 暂时无解\nedge不能启动问题 edge 有后台常驻程序，会导致不能多用户启动。手动运行任务 C:\\windows\\System32\\Taskmgr 结束掉 就可以了。 或者 干脆使用 默认支持多用户的浏览器。火狐 chrome 都可以用户模式安装。\n","date":"2022-11-29T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/win/win10-remoteapp-server/","title":"win10 搭建remoteapp 服务器，实现app 随处可移动"},{"content":"参考 docker中制作alpine+sshd的基础镜像\n选择基础系统镜像 还是考虑用debian系列，docker pull debian:bullseye-slim\ndocker run -itd --name debian-for-sshd -p 59010:2222 -p 59011:22 --privileged=true debian:bullseye-slim /bin/bash docker exec -it debian-for-sshd /bin/bash 安装sshd 国内源/更新/安装sshd nano tzdata sudo sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list apt update apt install openssh-server nano tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 配置登录信息 1 2 3 4 5 6 7 sed -i \u0026#34;s/#PermitRootLogin.*/PermitRootLogin yes/g\u0026#34; /etc/ssh/sshd_config \u0026amp;\u0026amp; \\ ssh-keygen -t dsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_dsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t rsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_rsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t ecdsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_ecdsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t ed25519 -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_ed25519_key echo \u0026#34;root:root\u0026#34; | chpasswd 打开sftp https://dev.leiyanhui.com/pve/open-sftp/\n修改端口 为2222 1 2 nano /etc/ssh/sshd_config /etc/init.d/ssh restart 测试登录 1 ssh root@10.0.0.9 -p 59010 配置脚本自动启动 1 2 echo \u0026#34;/etc/init.d/ssh start\u0026#34; \u0026gt; /autoboot.sh echo \u0026#34;tail -f /dev/null\u0026#34; \u0026gt;\u0026gt; /autoboot.sh 最后这行是防止退出的\n清理 apt clean apt autoclean 备份容器 在宿主机运行\n1 2 3 4 5 6 7 8 docker stop debian-for-sshd docker export debian-for-sshd \u0026gt; debian11-for-sshd.tar # 打包压缩 gzip debian11-for-sshd.tar #备份 cp debian11-for-sshd.tar.gz /mnt/smb/docker # 删除旧的容器 docker rm debian-for-sshd 创建新容器 1 2 3 4 5 cat debian11-for-sshd.tar.gz | docker import - debian11:sshd-autoboot.sh2222 docker run -itd --name debian-go-codeserver-git --privileged=true \\ -p 59010:2222 -p 59011-59019:59011-59019 \\ debian11:sshd-autoboot.sh2222 sh /autoboot.sh 可以直接用我放在阿里云上的\n1 2 3 docker run -itd --name debian-go-codeserver-git --privileged=true \\ -p 59010:2222 -p 59011-59019:59011-59019 \\ registry.cn-qingdao.aliyuncs.com/joyanhui/base-sh-debian:debian11-sshd-autoboot.sh2222 sh /autoboot.sh 搞其他的 ssh 连接上随便玩起来，如果要添加跟随容器启动的程序 就编辑 /autoboot.sh\n","date":"2022-11-29T07:20:20+08:00","permalink":"https://dev.leiyanhui.com/docker/debian-sshd/","title":"docker 配置一个支持sshd的debian"},{"content":"新版codeserver 依赖glibc已经不支持 在alpine上安装，尝试过用官网docker来处理 发现不符合我要求，而且存在权限问题。所以还是自己新建一个基本系统来处理。\ndocker 配置一个支持sshd的debian https://dev.leiyanhui.com/docker/debian-sshd\n因为这个docker还要迁移，所以我这里不打算映射任何目录 端口也固定分配\ncat debian11-for-sshd.tar.gz | docker import - debian11:sshd-autoboot.sh2222 docker run -itd --name debian-go-codeserver-git --privileged=true \\ -p 59010:2222 -p 59011-59019:59011-59019 \\ debian11:sshd-autoboot.sh2222 sh /autoboot.sh ssh登录到59010端口 挂一下学习工具 export http_proxy=\u0026quot;10.0.0.1:20172\u0026quot; export https_proxy=\u0026quot;10.0.0.1:20172\u0026quot; 安装 apt install curl curl -fsSL https://code-server.dev/install.sh | sh 启动 code-server 修改密码和端口 nano ~/.config/code-server/config.yaml 内容\nbind-addr: 0.0.0.0:59011 auth: password password: cd89d839912d5d87cd7db6c7 cert: false 注意 每个冒号后面都有空格\n自动启动 nano /autoboot.sh 内容\n/etc/init.d/ssh start /usr/bin/code-server \u0026amp; tail -f /dev/null 最后。。 codesever 新版 依赖 glibc 已经无法安装，会麻烦很多。基础镜像还是建议用\n","date":"2022-11-29T07:20:20+08:00","permalink":"https://dev.leiyanhui.com/docker/debian-go-codeserver-git/","title":"docker部署vscode和golang git"},{"content":"基本使用 https://coder.com/docs/code-server/latest/install#docker\n1 2 3 4 5 6 7 mkdir -p ~/.config/codeserver docker run -it --name code-server -p 8080:8080 \\ -v \u0026#34;$HOME/.config/codeserver:/home/coder/.config\u0026#34; \\ -v \u0026#34;$PWD:/home/coder/project\u0026#34; \\ -u \u0026#34;$(id -u):$(id -g)\u0026#34; \\ -e \u0026#34;DOCKER_USER=$USER\u0026#34; \\ codercom/code-server:latest 要配置golang 就在codeserver的终端里面 安装就好了。 如果要做web开发 或者其他网络的开发 的话，你可能还需要多映射几个端口进去。\n进阶 手动打造一个主机的golang git 开发环境 点击这里 https://dev.leiyanhui.com/docker/golang-codeserserver/\n","date":"2022-11-29T07:05:20+08:00","permalink":"https://dev.leiyanhui.com/docker/codeserver/","title":"docker部署vscode/codeserver和golang 可以迁移git开发环境"},{"content":" win8以后的win系统默认不支持smb1，记得添加smb1的支持后方可\n更新源到国内 https://dev.leiyanhui.com/pve/guonei/\n安装smb apt-get install samba 启动 1 2 3 systemctl enable smbd systemctl start smbd systemctl restart smbd root直接使用 自己用的话，直接用root用户 就好了 设置root用户的 smb的密码 smbpasswd -a root 这个密码和root的管理密码无关\nnano /etc/samba/smb.conf 1 2 3 4 5 6 7 8 [nvme] comment = Share-rw path = /nvme available = yes browsable = yes public = yes writable = yes valid users = root 配置账号 smbpasswd -a 【用户名】 需要提前新建用户\naddgroup wheel useradd -m -G wheel -s /bin/bash 【用户名】 passwd 【用户名】 #最好顺带配置一下sudo https://dev.leiyanhui.com/arch/base-install/#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7 # 或者干脆 groupadd test -g 6000\u0026amp; useradd test -u 6000 -g 6000 -s /sbin/nologin -d /dev/null 配置共享 nano /etc/samba/smb.conf 添加内容\n1 2 3 4 5 6 7 8 9 10 11 [shareMNT] comment = Share-rw ;共享目录全路径 path = /mnt available = yes browsable = yes ;写入权限 public = yes writable = yes ;可访问的用户 valid users = yourUserName 可能还需要配置权限 chmod -R 777 /mnt #简单一点 关闭默认主目录 把 homes 哪段删掉就好\n其他命令 1 2 3 4 5 6 7 8 9 10 smbpasswd -d 冻结用户，就是这个用户不能在登录了 smbpasswd -e 恢复用户，解冻用户，让冻结的用户可以在使用 smbpasswd -n 把用户的密码设置成空. 要在global中写入 null passwords -true systemctl status nmbd // 查询SMB状态 systemctl status smbd systemctl enable smbd // 允许SMB开机启动 ","date":"2022-11-29T00:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/open-smb/","title":"pve/debian11 开启smb和 虚拟机以及局域网其他设备共享"},{"content":"本文以hugo为例，hexo同理 实现目的，\n无服务器 如同本站 接近0费用 只有cdn和oss费用 cdn本身费用很低 oss 那边看cdn配置和文章更新频繁程度 搭建文章网站。实现博客或者帮助文档在线公开浏览。 国外访客直接走githubpage 国内访客 走腾讯-\u0026gt; 阿里云oss .md原文件 不暴露到公网 部署到 oss 会增加大概100多秒的actions执行时间，也会导致oss那边产生一些写入费用。 我的actions 从一开始的18-25秒执行时间，变成2m30s左右。单独上传到alioss 差不多需要2分钟。\nGitHub上部署hugo 或者mdbook hexo到私有库 hugo ： https://dev.leiyanhui.com/mdbook/hugo-install-nolocal/\nmdbook: https://dev.leiyanhui.com/mdbook/siyou/\nhexo 已经弃用很久，自己搞定 都差不多。\n在阿里云创建oss和相关key 详细步骤略，主要是 拿到 AccessKey ID 和 AccessKey Secret, 对应的Bucket 权限 应该是所有人可读 我创建了一个 青岛 mydev-bolg.oss-cn-qingdao.aliyuncs.com\n在对应的Bucket的配置 域名配置 里面绑定一个临时域名 oss.dev.leiyanhui.com\n然后在数据管理静态页面中设置 首页 index.html 打开子目录首页 Redirect 404页面 404.html\n域名解析部分 dev.leiyanhui.com 境外到xxx.gitHub.io dev.leiyanhui.com 境内到cdn，我这里到腾讯cdn 修改GitHub私有库上的自动部署脚本 以下操作在github的私有库上操作\n先配置环境变量 依次点击 /settings/secrets/actions 添加变量OSS_ACCESS_KEY_ID OSS_ACCESS_KEY_SERCRET 对应阿里云的 AccessKey ID 和 AccessKey Secret 原来的变量FOR_PAGE_SSHKEY 参考上面私有库配置的文章。\n这样做是为了防止在编译过程日志里面显示敏感信息\n编辑github actions文件 /.github/workflows/deploy.yml 原始文件内容参考 https://github.com/joyanhui/file.leiyanhui.com/blob/main/github-actions/hugo/hugo-Private-to-public-whis-theme-deploy.yml\n添加内容 就是增加一段到alioss的配置 我们用manyuanrong/setup-ossutil@v1.0 这个 注意run 那行我们是 复制 public 文件到 oss://Bucket名称/（Bucket名称） 如果你用其他程序，需要自己修改以下\n1 2 3 4 5 6 7 8 9 10 11 - name: setup aliyun oss uses: manyuanrong/setup-ossutil@master with: endpoint: oss-cn-qingdao.aliyuncs.com access-key-id: ${{ secrets.OSS_ACCESS_KEY_ID }} access-key-secret: ${{ secrets.OSS_ACCESS_KEY_SERCRET }} - name: cp files to aliyun run: | rm -rf .git* rm -rf public/.git* ossutil cp -rf public oss://mydev-bolg/ # 将mydev-bolg改为创建的Bucket名称，-rf表示覆盖 完整文件：https://github.com/joyanhui/file.leiyanhui.com/blob/main/github-actions/hugo/hugo-Private-to-public-to-Alioss-whis-theme-deploy.yml\n测试 actions 执行完成后，打开域名mydev-bolg.oss-cn-qingdao.aliyuncs.com 测试，可以打开\n推送到腾讯cos的配置 没有买cos，感觉贵一些,所以这里没相关配置，实际和上面操作 大同小异\n配置cdn 我这里cdn用的腾讯的，之所以套一个cdn 而不是直接用alioss 静态页面功能，当然是为了省钱。。。\n阿里oss 删掉这个域名，或者直接添加一个 域名 dev.leiyanhui.com\n在腾讯cdn 域名管理中 添加 回源地址 GitHub作为 热备源站，主站用oss-cn-qingdao.aliyuncs.com\n进阶 节省oss费用，降低写入次数。 设置为定时执行 默认的情况是 当向master分支push代码或提交pull request的时候触发\n1 2 3 4 5 on: push: branches: [ master ] pull_request: branches: [ master ] 看手册 https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows 如果想要实现，push 并且距离上次时间 超过1小时，因为cron 不支持这个操作，而我们acions内的脚本 无法持久保存文件。所以不好实现。\nschedule cron的方式 手册：https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule\n1 2 3 on: schedule: - cron: \u0026#39;30 5,17 * * *\u0026#39; 可以定时执行，但是也和我们预期效果不一样。因为我们不是每天或者每小时都要更新内容。\n手动执行发方法 最简单 办法 是用 workflow_dispatch，想同步的时候，手动执行一次\n1 2 on: workflow_dispatch: 定时和手动结合 手动加定时任务\n1 2 3 4 5 on: workflow_dispatch: schedule: # 第二位小时数，要北京时间-8 后输入 比如 2是10点 - cron: \u0026#34;16 5 */3 * *\u0026#34; 手动触发 ，或者 每间隔3天的13点16分自动执行一次\n完美：添加时间戳的方法 原理：在阿里云oss上创建一个文本记录上次同步到阿里云的时间戳，然后每次同步到阿里云之前比较一下时间戳，如果超过指定的时间3600 那么就同步一次，否则 不执行。 新建一个文件last_update.txt内容last_update=0 手动上传到阿里云oss\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 - name: setup aliyun oss uses: manyuanrong/setup-ossutil@master with: endpoint: oss-cn-qingdao.aliyuncs.com access-key-id: ${{ secrets.OSS_ACCESS_KEY_ID }} access-key-secret: ${{ secrets.OSS_ACCESS_KEY_SERCRET }} - name: cp files to aliyun run: | #获取当前时间戳 current=`date \u0026#34;+%Y-%m-%d %H:%M:%S\u0026#34;` timeStamp=`date -d \u0026#34;$current\u0026#34; +%s` currentTimeStamp=$(((timeStamp*1000+10#`date \u0026#34;+%N\u0026#34;`/1000000)/1000)) #将current转换为时间戳，精确到秒 #获取上次更新的时间戳到变量last_update curl -o last_update.txt https://你的地址.oss-cn-qingdao.aliyuncs.com/last_update.txt?$GITHUB_SHA source last_update.txt Time_over_val=`expr $currentTimeStamp - $last_update` if [ \u0026#34;$Time_over_val\u0026#34; -ge \u0026#34;3600\u0026#34; ];then echo \u0026#34;阿里oss 记录时间\u0026#34; echo \u0026#34;last_update=$currentTimeStamp\u0026#34; \u0026gt; public/last_update.txt rm -rf .git* rm -rf public/.git* ossutil cp -rf public oss://你的Bucket/ else echo \u0026#34;跳过更新阿里oss\u0026#34; fi 同时 修改触发条件为，每次改动，或手动,并添加定时，防止最后一次push后未同步的情况下 不能自动提交给阿里云的情况。\n1 2 3 4 5 6 7 8 9 on: workflow_dispatch: schedule: # 第二位小时数，要北京时间-8 后输入 比如 2是10点 - cron: \u0026#34;33 2 * * *\u0026#34; push: branches: [master] pull_request: branches: [master] 最终文件 点击这里\n小问题 manyuanrong/setup-ossutil@master 是从 http://gosspublic.alicdn.com/ossutil/1.7.7/ossutil64 下载安装，git去下载话 有时候偶尔抽风速度不是很理想。有时候需要4分钟。。占用actions时间。\n","date":"2022-11-29T00:14:20+08:00","permalink":"https://dev.leiyanhui.com/mdbook/hugo-to-oss/","title":"hugo、hexo、mdbook自动部署到GitHub私有库和阿里云oss 并嵌套腾讯cdn的完整方案"},{"content":"宝塔 终于出官方docker了 基于CentOS 7.9.2009 x86_64\nhttps://hub.docker.com/r/btpanel/baota https://www.bt.cn/bbs/thread-79499-1-1.html LNMP镜像大小大概 733.3MB 解压后大概3006.51MB 。。。没得办法，宝塔的依赖项真的是太多了。。。 在软路由上搞起来先\n先整理端口 不打算映射数据出来，方便转移，并预留ssh 和常用端口\n#宝塔面板 22 ssl http phpmyadmin -p 51888:8888 -p 51022:22 -p 51443:443 -p 51080:80 -p 51188:888 \\ # 路由器封80 443自定义web端口 以及22重复 -p 51081:51081 -p 51444:51444 -p 51000:22 \\ # mysql -p 51306:3306 \\ # redis -p 51379:6379 \\ # pgsql -p 51432:5432 \\ # MongoDB -p 51017:27017 \\ # 备用端口 -p 51200-51299:51200-51299 \\ 你问我为啥开这么多端口。。我开心我乐意，反正外网又访问不到。。。\n镜像和标签的选择 latest 标签拉取的是lib标签，安装了面板并且安装集成依赖包，安装每个软件都会快一点。\nfresh 标签表示安装了面板但是没有安装集成依赖包，安装第一个软件会比较慢，因为需要装依赖包。\nlib 标签表示安装了面板并且安装集成依赖包，安装每个软件都会快一点。\nlnmp 标签表示安装了面板、集成包并且集成LNMP【Nginx1.22+MySQL5.7+PHP7.4】arm标签是MySQL5.6\nlamp 标签表示安装了面板、集成包并且集成LAMP【Apache2.4+MySQL5.7+PHP7.4】arm标签是MySQL5.6\n我这里选择lnmp 经过测试发现，其实还集成了ftp\n目录的挂载 /www/server/data 数据库\n/www/wwwroot 网站目录 或者说 静态文件目录\n/www/server/panel/vhost 虚拟机主机配置文件\n其他目录参考宝塔官网\n我不打算映射出来，因为可以在宝塔内挂载oss之类的网盘自动备份。\n而且不映射任何目录的话，docker的备份和迁移更为简单简单一些。\n最终命令的整理 1 2 3 4 5 6 7 8 9 docker run -d --restart unless-stopped --name baota \\ -p 51888:8888 -p 51022:22 -p 51443:443 -p 51080:80 -p 51188:888 \\ -p 51081:51081 -p 51444:51444 -p 51000:22 \\ -p 51306:3306 \\ -p 51379:6379 \\ -p 51432:5432 \\ -p 51017:27017 \\ -p 51200-51299:51200-51299 \\ btpanel/baota:lnmp 默认账户名密码 和登录地址 现在，您可以在浏览器访问默认地址 http://您的ip地址:8888/btpanel 上的宝塔面板。 默认用户：btpanel 默认密码：btpaneldocker 默认SSH密码：用户名 root 密码 btpaneldocker\n默认用户：btpanel\n默认密码：btpaneldocker\n容器默认SSH密码：btpaneldocker\n其他 容器内的服务处理 是使用的/bt.sh 这个文件，除了默认服务之外，其他服务需要自行添加默认内容\n#!/bin/bash PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin export PATH init_path=/etc/init.d Root_Path=`cat /var/bt_setupPath.conf` Setup_Path=$Root_Path/server/mysql Data_Path=$Root_Path/server/data soft_start(){ ${init_path}/nginx start ${init_path}/php-fpm-74 start ${init_path}/pure-ftpd start ${init_path}/bt restart pkill crond /sbin/crond /usr/sbin/sshd -D \u0026amp; } is_empty_Data(){ return `ls -A ${Data_Path}/|wc -w` } init_mysql(){ # initialize_mysql if [ -f /init_mysql.sh ];then sh /init_mysql.sh rm -f /init_mysql.sh fi } start_mysql(){ chown -R mysql:mysql ${Data_Path} chgrp -R mysql ${Setup_Path}/. ${init_path}/mysqld start rm -f /init_mysql.sh } soft_start \u0026gt; /dev/null is_empty_Data \u0026gt; /dev/null if [ $? == 0 ];then init_mysql \u0026gt; /dev/null else start_mysql \u0026gt; /dev/null fi tail -f /dev/null 计划任务的bug 宿主机运行\ndocker exec -it 容器名称baota bash pkill crond \u0026amp;\u0026amp; /sbin/crond 然后重新添加计划任务\n容器内的ssh的bug 已经默认安装了openssh，但是可能还需要处理一下才可以连接，注意 复制的时候 要看一下宿主机的情况。如果不是host模式的话不存在这个问题\n#获取容器ID docker ps|awk 'NR \u0026gt; 1{print$1}' #复制必要密钥文件到容器内 \\cp -r /etc/ssh/ssh_host_* /home/ chmod 600 /home/ssh_host_* docker cp /home/ssh_host_rsa_key 容器ID:/etc/ssh/ docker cp /home/ssh_host_ecdsa_key 容器ID:/etc/ssh/ docker cp /home/ssh_host_ed25519_key 容器ID:/etc/ssh/ #给容器设置一个root密码，qqwwee123替换成自己想要的密码 docker exec -it 容器ID /bin/bash -c \u0026quot;echo 'qqwwee123'|passwd --stdin root\u0026quot; #让sshd运行起来 docker exec 容器ID /usr/sbin/sshd -D \u0026amp; rm -rf /home/ssh_host_* 问题和其他bug docker版本更新滞后，也不算大事，宝塔新版问题更多哈哈 web控制面板卡顿，web终端卡顿 甚至打不开，不缺点是宝塔新版的问题，还是软路由器性能问题 宝塔内置系统防火墙不可用（docker的限制。不过确实没必要） ssl的证书夹在某些特定情况下 无法保存的问题。这个应该是宝塔自己的bug，月经bug 宝塔反反复复，经常间隔几个版本就出现一次 .重新登录一次面板，然后续签一次证书，或者重新部署一次。运气好的话 就好了，或者整个站点都删掉重新添加，运气不好的话，。。。。删了宝塔吧。。 innodb_log_buffer_size 的bug，这个以及是宝塔本身的月经bug 反复出现，手动设置一下就好 web面板 配置mysql的界面 mysql状态不显示，这个应该也是宝塔自己的bug，月经bug web面板 终端偶尔打不开 应该是xterm和bug，宝塔本身也或许有问题，退出重新登录就好，或者清理浏览器缓存 重新登录 通知模块偶尔显示 名称：undefined xxx，无配置。。这个也是宝塔的月经bug 不算是问题，但一定注意第一时间修改 面板用户名密码以及ssh的root密码 题外话 其实已经很久没有新装过宝塔了，然后发现 现在的宝塔 是bug成堆。。。硬硬把用户当作实验台，略有能力的情况下能不用就不用了吧\n以前会去宝塔论坛 认真截图 说复现步骤，反馈，然后论坛客服 除了一堆毫无意义的机械回复，也没啥，有时候反馈一个bug 竟然要回帖数次。。。 基本上 修补了上一个bug 然后出现新bug\n正经的生产环境，真的不怎么建议用宝塔。。。毕竟现在docker环境可选多部署一个新环境也不难\n","date":"2022-11-27T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/baota/","title":"docker运行 官方宝塔 "},{"content":"本文停止更新，建议使用 nginxwebui ：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl\n支持中文，也支持静态站，甚至可以转发php之类的。\nnginx-proxy-manage 是一个有web管理解决的 纯nginx管理工具，基于node开发的。类似宝塔。。自带了ssl证书管理（基于Let’s Encrypt的）\n适合 在轻量的主机上运行，例如 软路由。。。\n比宝塔来说优势有\n支持更多dns验证api，几乎支持所有的常见国内外域名和dns商，并且支持 acmedns_api 更加轻量简单 缺点嘛，，就是没有别的功能了。只有nginx 和 ssl 。所以很适合 路由上使用 要求多的话，还是建议使用宝塔，现在宝塔官网已经发布docker\n基本命令 参考：https://hub.docker.com/r/jlesage/nginx-proxy-manager 改动一下\n1 2 3 4 5 6 docker run -d \\ --name=nginx-proxy-manager \\ -p 50181:8181 \\ -p 50080:8080 \\ -p 50443:4443 \\ jlesage/nginx-proxy-manager web访问端口 是 50080:8080 ssl 50443:4443 管理端口 50181:8181 默认用户名密码 admin@example.com changeme\n后续我发现真正的官网镜像实际不是这个！ 而是 jc21/nginx-proxy-manager:latest 文档地址：https://nginxproxymanager.com/setup/#using-mysql-mariadb-database 并且官网文档是明确支持ipv6的 只是默认禁用\n基本使用 修改用户密码 登录后就会自动提示修改，按照提示修改一下\n试着申请个域名ssl 很简单 不用多说，看不懂 自己开翻译软件（吐槽：软路由圈子 英语不好 还不肯开翻译软件的人。。多好。。）\n这个工具存在的问题 只支持LE的证书，我本想和acme.sh的配合 使用，发现。。。这货好像把证书放在了数据库里面，，服了。。。然后自定义证书 也只能是上传。。。 后续发现存放到了/etc/letsencrypt ，但是格式和acme.sh 不能完全兼容。。 dns api的配置记录不能自动保存，添加多个证书的时候 需要每次都输入一次 api接口的key信息 下载回来的证书，只有nginx格式 面板本身好像不可以直接启用ssl，应该需要sh进去改配置文件，或者自己代理自己一次 没有中文界面 镜像体积不小， 182.90MB 左右 在主机列表页面直接打开对应的域名，是使用默认端口打开。不会帮你跳到50080:8080 ssl 50443:4443,我node 水平一般也没有找打 队以ing的文件 同时 在反代 pve 或 openwrt等应用的适合，会导致 vnc或者终端控制台打不开。（这个好像是 noVNC 以及xterm.js的问题） pve可以用 /etc/pve/local/qemu-server/.conf 添加vnc配置的方法用客户端链接 oc的控制docker台 可以用shell登录后 docker exec -it 容器名 /bin/bash 或者docker 另外跑一个浏览器 来访问内网的这个web，然后nginx-proxy-manager再套上ssl 就可以了 其他暂未发现 结论 很适合要求不高的情况下使用，也适合小白。 其实 还是建议直接docker跑一个宝塔算了，自己用debian、centos基础做也行，现在宝塔官方也支持docker了\nhttps://dev.leiyanhui.com/docker/baota\n另外一个替代项目 https://www.nginxwebui.cn/\n简单看了一下 国产的，支持中文，支持负载均衡，但是证书虽然是用 acme.sh ,但是同样也是 只支持 LE的自动续期和申请。。\n使用说明 ：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl\n官网：https://github.com/cym1102/nginxWebUI#docker%E5%AE%89%E8%A3%85%E8%AF%B4%E6%98%8E\n","date":"2022-11-27T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/nginx-proxy-manage/","title":"docker运行nginx 并反代内网的一些服务，"},{"content":"客户端 可以用 winscp MobaXterm 或者 其他 支持 sftp的软件，直接上传文件。这对 新手（老手也是） 来说更方便。另外也可以挂载到alist统一管理。\n但是pve 默认是关闭 sftp的，打开方法也很简单。\n用 vim 或者 nano 编辑sshd配置文件，我这里用nano\n# apt install nano # mkdir /root/other-etc-bak \u0026amp;\u0026amp; cp /etc/ssh/sshd_config /root/other-etc-bak nano /etc/ssh/sshd_config 往下翻，找到Subsystem sftp /usr/lib/openssh/sftp-server 这行，注释掉，然后添加一行Subsystem sftp internal-sftp\n#Subsystem sftp /usr/lib/openssh/sftp-server Subsystem sftp internal-sftp 重启ssh\n/etc/init.d/ssh restart 使用支持sftp的客户端 重新登录ssh\n搞定\n","date":"2022-11-27T00:40:20+08:00","permalink":"https://dev.leiyanhui.com/pve/open-sftp/","title":"pve 打开sftp 直接上传文件 debian centos arch 同理"},{"content":"最近win下先换到了rime输入法，因为反映速度快，对机器要求低。同时mac和ios 还有arch下也换到rime 。但是在arch下遇到一点小问题，就是部分后选词乱码。\n网上大概搜了一下，没有fcitx的详细方案。经过摸索\n比如：https://www.zdic.net/hans/%F0%A8%88%96 显示为 𨈖 还有 𫟄 同样的一些字在后选词里面显示豆腐块，但是打出来是正常\n是rime默认字体的原因，可以修改配置文件换字体，最简单方便 是就安装 noto字体包，然后重启一下就完了。基于\n1 2 3 4 5 yay -S noto-fonts-sc \u0026gt; Found 08_NotoSansCJKsc.zip -\u0026gt; Found 13_NotoSansMonoCJKsc.zip -\u0026gt; Found 09_NotoSerifCJKsc.zip 或者干脆\n1 sudo pacman -S noto-fonts-cjk ","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/arch/rime-luanma/","title":"archlinux 下rime输入法部分后选词乱码 问题"},{"content":"archlinux其实还是很容易安装的，\n本文最后更新 2022-12-01 安装系统需要你先明白几个基本概念,如果你能明白，那么手动安装一个archlinux也就轻松简单。不明白照着做也可。\n引导，一般电脑支持efi和传统bios两种分区模式， bios引导分区模式需要用传统磁盘格式也就是只能4个主分区，或者3个主分区+扩展的N个分区 efi引导的分区模式可以用gpt，也就是可以4个以上主分区，但是必须有一个fat16 fat32的分区，主板启动后从磁盘的这个分区里面找efi引导程序 磁盘 linux下的磁到 /dev下 一般用 fdisk -l命令查看 分区，linux下分区 需要挂载到文件目录。开机自动挂载的配置文件是 /etc/fatab 启动后 如果是笔记本需要先配置wifi，arch的安装镜像也支持usb共享多数手机的网络。\n如果不想在机器上上敲下面的命令，可以先给root设置一个临时密码passwd 输入两次密码\n然后ip a查看一下ip，再在一台机器上ssh链接上ssh root@IP ,就可以抄袭下面的作业了。\narchlinux自带的 archinstall 已经很好用，一般情况不再建议手动安装。\n分区 efi模式至少两个分区，bois模式1个只一个分区也可以 1、efi分区 fat32格式，可以和黑苹果 win公用 （bois安装的分区 看文末） 2、根分区，格式自己随意，如果只是跑简单业务建议用ext4 其他分区自定义 分区可以用winpe diskgen，也可以用 live盘的 cfdisk\n启动和准备 使用archlinux 官网live iso 下载地址 https://archlinux.org/download/ 底部有国内镜像源 写入到U盘，或者用ventoy等支持iso启动的工具启动iso。 启动后先 ping baidu.com 看看是否联网了，如果没有先去配置联网环境，此处掠过，不是笔记本的都简单，如果网卡不能识别，可以暂时usb插iPhone 打开共享\n编辑源，自己找一个靠谱源。部分源更新慢，比如 nuesoft，部分源速度不稳定比如aliyun，其他自己选 此步骤不是必须的，目前新版archlinux 2022.11.1以后版本的iso 在联网环境下，可以自动帮你整理最快的镜像作为默认源\n1 nano /etc/pacman.d/mirrorlist 例如清华源地址，放到 最前面 Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch\n可能需要fdisk -l 查看一下磁盘并格式化部分分区 可以用cfdisk 创建操作分区，使用uefi启动的电脑，至少需要两个分区，一个efi一个根分区，然后用mkfs.xxxx 格式化对应的分区\n1 cfdisk /dev/\u0026lt;磁盘名 sda1 nvmexxxx mmcxxx vdaxxx\u0026gt; cfdisk 比diskpart简单一些，并且是命令行的图形界面\n关于分区 如果是efi模式启动，必须需要两个分区 一个 32M 以上的efi分区格式化为fat16或者fat32格式，另外一个分区格式为linux常用文件系统格式，推荐ext4格式\n如果是传统启动模式，那么不需要额外的分区，最小只需要一个分区 / 格式为\n关于分区格式 linux下不是不是可以安装到fat或者exfat 甚至ntfs分区格式，只是不推荐，会有很多莫名其妙的问题。\n一般常用的分区格式 还是 ext4，其他更先进的分区格式 xfs,BtrFS,GlusterFS 除非非常有需求，比如压缩 快照 raid等，否则不建议。\n如果你双系统，有和win交换文件的需求，强烈建议单独创一个exfat分区作为文件交换用，或者在win下安装ext4的读取驱动（不要写）\n另外，win下常用的diskgen 对ext4分区的支持是有限的，但是可以完成基本的分区到镜像的备份。读取功能不稳。\n格式需要的分区 cfdisk只能分区不能格式，还是需要用mkfs工具格式，如果已经格式好了。或者对应的分区已经有文件，可以跳过这步。\n1 2 3 4 # efi分区 mkfs.fat -F 32 /dev/nvme0n1p1 ## 根分区 mkfs.ext4 /dev/nvme0n1p2 马上2023年 brtfs已经很不错了um efi必须 fa32 或fat16， 根分区 分区格式我这里用ext4\n如果要做swap分区，自己看一下官网wiki，我喜欢用文件swap所以这里没弄。 设置 文件swap\n挂载分区 根分区挂载到/mnt efi分区挂载到/mnt/boot/efi\n1 2 3 mount /dev/nvme0n1p2 /mnt mkdir -p /mnt/boot/efi mount /dev/nvme0n1p1 /mnt/boot/efi 如果你还要做swap分区，继续弄，也可以后面开启swapfile的\n如果是传统启动模式 不是 efi模式 可以跳过 挂载efi的这步。\n/mnt开始安装 最基本的系统\n1 pacstrap /mnt base linux 另外还有三个常用包 自己选择是否安装。linux-headers linux-firmware base-devel base-devel包里面 有编译和yay（aur）常用的工具\n如果有提示 key错误，尤其是openssl的，可能需要先执行一次\n1 2 pacman -S archlinux-keyring pacman-key --refresh-keys 或者 干脆运行一次archinstall 然后会自动更新keyting，再退出就好了\n写入自动挂载fstab 直接用genfstab 工具，免去手写fstab配置文件的麻烦\n1 2 genfstab -U /mnt \u0026gt;\u0026gt; /mnt/etc/fstab cat /mnt/etc/fstab 切换到新系统 1 arch-chroot /mnt 继续安装一些基础包 简单文本编辑nano sudo权限管理 或者 dosa 1 pacman -S nano 你也可以装vim\n可选包网络相关的 dhcp客户端，ssh服务器端，网络管理，usb共享iPhone网络\n1 pacman -S dhcpcd openssh 设置几个需要开机启动的服务 1 2 systemctl enable dhcpcd systemctl enable sshd 可选包\n1 2 3 pacman -S networkmanager usbmuxd systemctl enable systemd-resolved systemctl enable NetworkManager 修改root密码 设置用户等 root密码 1 passwd 添加用户 添加一个日常使用用户，同时这个用户默认可以ssh登录\n1 2 useradd -m -G wheel -s /bin/bash leiyanhui passwd leiyanhui 我用fish替代bash 但是不建议 用fish 彻底替代bash，因为fish和bash ash之间有兼容问题。 基础shell 还是 base 或者 ash。 想要fish自动自动，以后修改 .bashrc文件就好了\n1 pacman -S fish 设置wheel用户组的sudo权限 sudo 1 2 pacman -S sudo nano /etc/sudoers 找到# %wheel ALL=(ALL:ALL) ALL 取消前面的#注释 或者带 NOPASSWD的 那行，以后sudo 就不需要密码\ndoas 替代sudo 更轻量更简单，如果要用xrdp的话不建议用doas\n1 2 3 4 pacman -S doas nano /etc/doas.conf ------ permit :wheel 或者permit persist :wheel 后面需要有一个空行 设置文件权限\n1 2 chown -c root:root /etc/doas.conf chmod -c 0400 /etc/doas.conf 验证\n1 doas -C /etc/doas.conf \u0026amp;\u0026amp; echo \u0026#34;config ok\u0026#34; || echo \u0026#34;config error\u0026#34; 替代sudo\n1 ln -s /bin/dosa /bin/sudo 设置时区 对时 1 2 ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime hwclock --systohc 写入引导 还是建议用grub，因为如果你要后面折腾虚拟化 kvm之类的会省心甚多 （bois安装的分区 看文末）\n1 2 3 pacman -S grub efibootmgr grub-install /dev/nvme0n1 #(注意，不是efi分区，而且是整个磁盘) grub-mkconfig -o /boot/grub/grub.cfg grub-mkconfig 这个工具在efibootmgr包里面\n重启 1 2 3 exit # 退出到live盘 reboot # 或者 poweroff 系统备份 可以用live盘 直接 tar 整个 /mnt，如果用ext4分区 也可以Windows用diskgen备份。 修复引导 就live 盘 arch-chroot 到磁盘分区，然后 重新写入一次引导 和配置文件\n传统启动模式安装 适合于 老设备，或者 虚拟机，尤其是 pve下的kvm模式 只需要最少一个分区就可以了 ，其他操作和efi一样\n注意点 就是 cfdisk 第一次打开的时候 不能用gpt分区，用dos分区模式，如果弄错了就要重新设置格式，会丢失所有数据。\nparted /dev/vda #然后输入 mklabel msdos #提示你会丢失所有书 Yes #退出 quit 我这个系统是用来打算做kvm的底层的，所以除了docker不再安装任何东西\n所有安装的包记录\n1 2 3 4 5 6 7 8 9 10 11 12 13 base linux linux-headers linux-firmware #基本工具 sudo nano #网络 dhcpcd networkmanager openssh #引导 grub efibootmgr #个人需要的 exfat 和 fish exfat-utils fish # kvm相关的 qemu-base ovmf 我上面没有设置swap 是因为我习惯性用swap file 查看这里： https://dev.leiyanhui.com/arch/swapfile/\n进阶功能和相关记录文章 手动安装一个archlinux 查看这里： https://dev.leiyanhui.com/arch/base-install/\n桌面环境dwm 查看这里：https://dev.leiyanhui.com/linux/arch-install-dwm/\n桌面环境i3w 查看这里：https://dev.leiyanhui.com/arch/xinitc-xrdp/\narch下kvm基本安装 查看这里： https://dev.leiyanhui.com/kvm/arch-install-kvm/\narch下kvm虚拟机开机自动启动 查看这里： https://dev.leiyanhui.com/kvm/auto_start_vm/\n关于efi模式启动 查看这里： https://dev.leiyanhui.com/kvm/ovmf/\nkvm安装macos 查看这里：https://dev.leiyanhui.com/kvm/install-macos-base/\nkvm安装macos附加上一个win 查看这里：https://dev.leiyanhui.com/kvm/macos_add_win10/\n进阶：配置桥接网络，以及硬件直通 桥接网络：https://dev.leiyanhui.com/kvm/net-br/\n硬件直通：https://dev.leiyanhui.com/kvm/kvm/pci-usb/\n","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/arch/base-install/","title":"archlinux保姆级自定义安装-最简单，最小化 自定义分区安装 、efi和bios模式"},{"content":"安装官方版本portainer\n安装docker 此步骤不用多说。。。\n创建一个portainer容器 核心就是挂载宿主的/var/run/docker.sock 以便和宿主机通信，当然也可以管理其他主机上的docker\n执行 1 2 3 4 5 6 # 标准命令 docker run -d -p 8000:8000 -p 9443:9443 \\ --name portainer --restart=always \\ -v /var/run/docker.sock:/var/run/docker.sock \\ -v /opt/portainer/data:/data \\ portainer/portainer-ce:latest ce是社区版 ee是商业版\n精简\n1 2 3 4 5 # 标准命令 docker run -d -p 8000:8000 -p 9443:9443 \\ --name portainer --restart=always \\ -v /var/run/docker.sock:/var/run/docker.sock \\ portainer/portainer-ce:latest 配置 打开 http://ip:8000 就好了 9443 就是 https://ip:9443\n密码。。设置 要12位。。\n关于汉化 如果需要汉化的话，需要把pubic目录映射出来，不建议。。因为这个就是web的前端目录，映射出来替换掉。。那就意味着。。你无法升级，除非汉化包一起升级。。。\n实在不会 开个翻译软件 啥都解决了。\n","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/portainer/","title":"docker 图形管理工具portainer （web管理）"},{"content":"支持在所有运行docker的设备上 linux系统 windows macos openwrt unraid pve等 自动申请签发证书（爱快这种畸形的除外）\n简单的运行 docker run --rm -itd \\ -v \u0026quot;$(pwd)/out\u0026quot;:/acme.sh \\ --net=host \\ --name=acme.sh \\ neilpang/acme.sh daemon 使用方法 docker exec acme.sh --help docker exec acme.sh --issue --dns dns_cf -d *.example.com -d example.com 指定dns的api 走dns验证的，例如cf家的\ndocker run --rm -itd \\ -v \u0026quot;$(pwd)/ssl_out\u0026quot;:/acme.sh \\ -e CF_Email=\u0026quot;example@example.com\u0026quot; \\ -e CF_Key=\u0026quot;asasasasasadasasas\u0026quot; \\ --net=host \\ --name=acme.sh \\ neilpang/acme.sh daemon 如果是 dnspod\nexport DP_Key=\u0026quot;sADDsdasdgdsf\u0026quot; docker run --rm -itd \\ -v \u0026quot;$(pwd)/ssl_out\u0026quot;:/acme.sh \\ -e DP_Id=\u0026quot;1234\u0026quot; \\ -e DP_Key=\u0026quot;sADDsdasdgdsf\u0026quot; \\ --net=host \\ --name=acme.sh \\ neilpang/acme.sh daemon 其他的dns 的api参考 https://github.com/acmesh-official/acme.sh/wiki/dnsapi\n如果不支持自动api的话，参考他官网的别名解析验证 https://github.com/acmesh-official/acme.sh/wiki/DNS-alias-mode\n进阶 可以和其他容器 包括 宝塔 或者 nginx-proxy-manager 配合使用（这两个只支持LE的免费域名，兼容性极差）\n其他资源 支持180天的 （半年的）泛域名 以及 ip申请 ，应该 还是不支持内网ip的\nhttps://hostloc.com/forum.php?mod=viewthread\u0026tid=1050449\n作者主页：https://github.com/Neilpang\n","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/acme-sh/","title":"docker 运行证书管理工具acme.sh "},{"content":" 1 2 3 4 5 docker run --name mysql5.7 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d \\ -v /usr/local/docker_data/mysql/data:/var/lib/mysql \\ -v /usr/local/docker_data/mysql/conf:/etc/mysql/ \\ -v /usr/local/docker_data/mysql/logs:/var/log/mysql \\ mysql:5.7 ","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/mysql5-7/","title":"docker5.7"},{"content":"前言 本文基于 archlinux 2022-12-1 镜像 ventoy-1.0.86 vtoyboot-1.0.25\n我做好的 https://www.123pan.com/s/EqorVv-r2nPA 提取码:arch\n建议选择 arch-base-btrfs-7.3gfree5g.vhd.vtoy.7z 解压后7.3G 空闲5G 可以满足基本需求，可以自行扩容。扩容教程 这个也是我的arch-aio的母盘 默认用户名 yanhui 密码 1 开启了ssh 和 dhcp\nroot用户禁止ssh 密码 1 直接用archinstall安装的基础包，然后补充软件：\ndhcpcd openssh nano doas which lvm2\n如果你网卡不能免驱 或者wifi要处理，请先virtualbox 启动后配置网卡驱动\n如果内核升级 或者grub升级，记得 cd /root/vtoyboot* \u0026amp;\u0026amp;sh vtoyboot.sh 安装archlinux 需要有一个运行了虚拟机的系统，我这里用的 linux版 virtualbox ，win下一样操作\nvirtualbox 创建一个虚拟机，专家模式 启用efi，磁盘格式选择 vhd，也可以其他格式 稍后自行转换到 vhd vdi raw 必须是预分配磁盘，不可以使用动态磁盘\n我这里选择 vhd格式，\n其他安装步骤 和正常安装一样 https://dev.leiyanhui.com/arch/base-install/\n并且\n1 ln -s /bin/doas /bin/sudo 处理Ventoy 1 pacman -S which lvm2 虚拟机挂载 https://github.com/ventoy/vtoyboot/releases/download/v1.0.25/vtoyboot-1.0.25.iso\n1 2 3 4 5 6 7 mount /dev/cdrom /mnt cd /root cp /mnt/vtoy* . tar -xf vtoy* rm -rf *.gz cd vtoyboot* sh vtoyboot.sh 提示只能用于efi启动\nventoy硬盘或者U盘安装配置 很简单不用多说了。注意一点 VTOY_LINUX_REMOUNT 方便linux下挂载管理vhd所在分区 具体参考 ：https://www.ventoy.net/cn/faq.html 搜索 VTOY_LINUX_REMOUNT 关键词\n其他处理 autodetect 处理 据说兼容性更好 1 nano /etc/mkinitcpio.conf 把hooks一行的autodetect删掉\ngrub shell抢救 如果非常不幸地进入了grub shell，也就是只有个grub\u0026gt;的界面，可以按照下面的步骤来抢救：\nls来查看硬盘，（hd0）这样的是硬盘，（hd0，msdos1）这样的是分区 ls (hd0,msdos1)/（注意有斜杠）来查看分区里的内容，找到那个里面有vmlinuz-linux文件的，它是启动分区 set root=(hd0,msdos1)（hd0，msdos1）改成你的启动分区 linux /vmlinuz-linux root=/dev/sda1sda1改成你的根目录分区 initrd /initramfs-linux.img boot 就可以进系统了，再想想引导怎么配吧。\n本文参考 ：https://www.bilibili.com/read/cv19777065 感谢 monki\n","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/arch/boot-vhd-ventoy/","title":"把最新版本 archlinux安装到vhd/raw/img文件并物理机器启动"},{"content":"博主 已经全部切换到 lxc 方案。暂时抛弃Nastools 2023-02-17 后使用的方案为：全lxc 每个lxc运行1-多个服务 分开管理\nlxc 10000 alpine 运行 cloudereve + rclone（挂载cr的webdav） + smb + sftp lxc 10001 alpine 运行 alist 挂网盘 lxc 10002 alpine 运行 aria2+ariaNG 和 cloudereve 直通同一个硬盘 处理离线下载 lxc 10003 alpine 运行 rclone +crontab 和 duplicati 同步 以及 加密备份文件 到 云盘 lxc 10010 alpine 运行 nginx + docker版onlyoffice 和cloudereve配合处理在线文档 其他 更多 查看原文：https://dev.leiyanhui.com/pve/lxc-nas/ 目标和环境 环境 在一个弱鸡电脑上（N2600+4G+32G）用纯docker搭建个人媒体中心\n并配合 阿里云盘 或者本地硬盘 实现大容量储存，\n目标 自动搜索下载自己在豆瓣或者微信标注的影片，并存储到阿里云盘，可以用emby或者阿里云盘客户端app播放。 进阶目标：自动清理删除许久为观看的电影 节省阿里云盘空间。我只有4T啊。。\n前置准备工作 docker 环境 【openwrt下docker的和其他插件的安装和网络异常处理】\n豆瓣账号\n我这里docker 就是路由器系统是openwrt,其他linux 操作一样。\n准备储存 我这里没有额外的多余硬盘做这个工作，所以直接使用阿里云盘了。\n先把阿里云盘挂载到本地。具体方法查看： https://dev.leiyanhui.com//openwrt/rclone/\n如果你有其他硬盘 最好格式好后自行挂载到宿主机。 我这里单独挂载一个 阿里云盘的目录 空白目录MediaVodCenter 到 /mnt/MediaVodCenter 稍后会从云盘里面 移动之前的硬盘过来，也会测试下载功能，之所以单独创建一个目录，是为了避免误操作丢失文件\n使用阿里云盘 就要忍受 刷新延迟带来的麻烦哈。肯定没有本地磁盘来的反应速度快，这个是无论如何也解决不聊的。只能忍受了哦\n安装配置Nastools 媒体中心 docker安装Nastools 我这里是openwrt 直接用root用户，如果你用其他用户管理，自行查看Nastools文档 https://github.com/jxxghp/nas-tools Nastools 的配置项众多，而且可能会出现依赖变动无法更新的情况，所以单独创建一个目录储存系统配置\n1 mkdir /mnt/config_MediaVodCenter 1 2 3 4 5 6 7 8 9 10 11 12 docker run -itd \\ --name nas-tools \\ --hostname nas-tools \\ -p 50300:3000 \\ -v /mnt/MediaVodCenter:/MediaVodCenter \\ -v /mnt/config_MediaVodCenter:/config \\ -e PUID=0 \\ -e PGID=0 \\ -e UMASK=000 \\ -e REPO_URL=https://ghproxy.com/https://github.com/jxxghp/nas-tools.git \\ -e NASTOOL_AUTO_UPDATE=true \\ jxxghp/nas-tools http://IP:50300/ 去登录，这个docker启动略微慢，稍微等待 默认用户密码：admin/password\n初步配置Nastools 修改账户名密码，配置。系统提示还要配置TMDB API Key 下一步去申请\n注册申请TMDB 网址 ： https://www.themoviedb.org/signup 网站虽然是中文的，但是在境外，可能会打不开，挂科研软件或者修改hosts\n注册完成以后登录TMDB，点击首页右上角的头像→帐户设置。\n点击左侧列表的API，然后点击请求API秘钥下面的 click here 再点击 开发者（developer） 同意协议后，继续填写\n简介的地方填写选择 个人 名称“家用” 地址，写一个内网地址，10.0.0.1 简介Meet personalized needs, enrich website interfaces and functions\n会马上生气申请成功，API 密钥 (v3 auth) 里面的内容就是我们需要的TMDB API Key 继续配置媒体部分设置 输入上面获取到TMDB API Key TMDB域名 选择你不挂梯子能打开的 ， 默认文件转移方式 我这里是rclone挂载的阿里云盘 就选择 rclone移动，如你的是物理硬盘或者 nas 自行选择其他方法。\n准备和配置豆瓣 豆瓣id 暂时先只配置豆瓣id ，注册一个豆瓣账号，点个人中心 个人主页 地址栏地址 类似 https://www.douban.com/people/88888/?_i=99999 其中888 就是我们的豆瓣id\n都把cookies 随便打开一个豆瓣内容页 例如https://movie.douban.com/subject/35197639/ 按F12键(chrome类浏览器)，弹出如图所示的开发页面。点击Network\n首先点击左上角一个灰色的圈圈，把下面东西的清除一下\n刷新这个页面，你可以点刷新按钮或者F5键\nNetwork页面开始弹出一些东西，不要怕，向上划找到 “35197639/”这一个 然后看右侧的 cookies，找到你的dbcl2，这是根据分号（;）分割的，你把dbcl2:xxx复制下来。（不要把分号复制进来）例：dbcl2=\u0026quot;8888888:AAAAAA\u0026quot;\n配置Nastools中的豆瓣id和cookies 打开nastools ，左侧 设置 豆瓣，分别输入对应的id 数字 和上面的 dbcl2=\u0026quot;8888888:AAAAAA\u0026quot; 其他也根据需要设置一下\n安装下载工具qBittorrent 我这里用qBittorrent ,并省略了config目录的映射\n1 2 3 4 5 6 7 8 9 docker run -d \\ --name=bt \\ -e WEBUI_PORT=50808 \\ -p 9821:6881 \\ -p 9821:6881/udp \\ -p 50808:50808 \\ -v /mnt/MediaVodCenter:/downloads \\ --restart unless-stopped \\ linuxserver/qbittorrent 配置qBittorrent 访问http://10.0.0.1:50808/ webUI 账户：admin 密码：adminadmin\n点 Tools -\u0026gt; options 打开设置窗口 选择 webui 设置用户名 密码 还有 语言简体\n配置Nastools的下载工具 http://10.0.0.1:50300/ 设置 下载器 选择 qBittorrent 地址输入 宿主地址 10.0.0.1 端口 上面的WEBUI_PORT 50808 输入上面设置的用户密码，测试成功\n安装媒体中心jellyfin 1 2 3 4 5 6 7 8 9 docker run -d \\ --name=jellyfin \\ -p 50096:8096 \\ -p 7359:7359/udp \\ -p 1900:1900/udp \\ -v /mnt/jellyfin_config:/config \\ -v /mnt/MediaVodCenter:/data \\ --restart unless-stopped \\ linuxserver/jellyfin 这个地方 需要注意 /config 目录会吃硬盘空间，某些情况下可能会高达几十个G 注意经常检查,这个是无法避免的\n硬解问题，稍后晚点配置.我的显示是N2600带的核显GMA3600，上古设备，那时候intel并未开源驱动，所以也就无法硬解。硬解问题，之后会挪到另外一台主机上进行处理。\n配置 jellyfin 打开 http://10.0.0.1:50096/ 按照提示设置，注意创建文件夹的时候 选择/data\n然后 点左侧 三个点 打开设置 控制台 高级 api 生成 记住这个 api\n再Nastools 配置jellyfin http://10.0.0.1:50300/ 设置 媒体服务器 选择jellyfin 地址输入上面 http://10.0.0.1:50096/ apikey 输入刚刚的生成的\n收工！ 结尾的话 N2600 性能堪忧，我最终 还是切换到了 i7 8代主机上\n","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/mediavodcenter/","title":"纯docker无盘打造个人媒体中心"},{"content":"优势：免去自己搭建环境，利用GitHub的带宽\n本次使用灯大的源,并借鉴KFERMercer的ci\nhttps://github.com/coolsnowwolf/lede https://github.com/KFERMercer/OpenWrt-CI 复制Fork coolsnowwolf的源 Fork Openwrt\nhttps://github.com/coolsnowwolf/lede/fork\n编辑action文件 复制 https://github.com/KFERMercer/OpenWrt-CI/blob/master/openwrt-ci.yml 的内容编辑\n放置到你fork的仓库的 .github/workflows/openwrt-ci.yml\n其中需要修改的 启动 on: push: branches: - master 改为手动执行\non: workflow_dispatch: 自定义包 找到你需要安装的包名，官方https://openwrt.org/packages/index/start Lean/coolsnowwolf 的软件包可以从 make defconfig 配置文件 .config 中找到 添加包到openwrt-ci.yml 中 cat \u0026raquo; .config \u0026laquo;EOF后面\n手动开始 先更新你的OpenWrt源-\u0026gt; Fetch upstream -\u0026gt; Fetch Merge\n手动开始编译 Action -\u0026gt; OpenWrt-CI -\u0026gt; Run workflow\n大概需要2-3小时，然后下载 ，下载OpenWrt_firmware即可\n初始内容 https://github.com/KFERMercer/OpenWrt-CI/blob/master/openwrt-ci.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 # # This is free software, lisence use MIT. # # Copyright (C) 2019 P3TERX \u0026lt;https://p3terx.com\u0026gt; # Copyright (C) 2020 KFERMercer \u0026lt;KFER.Mercer@gmail.com\u0026gt; # # \u0026lt;https://github.com/KFERMercer/OpenWrt-CI\u0026gt; # name: OpenWrt-CI on: push: branches: - master # schedule: # - cron: 0 20 * * * release: types: [published] jobs: build_openwrt: name: Build OpenWrt firmware runs-on: ubuntu-latest if: github.event.repository.owner.id == github.event.sender.id steps: - name: Checkout uses: actions/checkout@v2 with: ref: master - name: Space cleanup env: DEBIAN_FRONTEND: noninteractive run: | docker rmi `docker images -q` sudo rm -rf /usr/share/dotnet /etc/mysql /etc/php /etc/apt/sources.list.d /usr/local/lib/android sudo -E apt-get -y purge azure-cli ghc* zulu* hhvm llvm* firefox google* dotnet* powershell openjdk* adoptopenjdk* mysql* php* mongodb* dotnet* moby* snapd* || true sudo -E apt-get update sudo -E apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs gcc-multilib g++-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler antlr3 gperf swig libtinfo5 sudo -E apt-get -y autoremove --purge sudo -E apt-get clean # sudo mkdir -p -m 777 /mnt/openwrt/bin /mnt/openwrt/build_dir/host /mnt/openwrt/build_dir/hostpkg /mnt/openwrt/dl /mnt/openwrt/feeds /mnt/openwrt/staging_dir # ln -s /mnt/openwrt/bin ./bin # mkdir -p ./build_dir # ln -s -f /mnt/openwrt/build_dir/host ./build_dir/host # ln -s -f /mnt/openwrt/build_dir/hostpkg ./build_dir/hostpkg # ln -s /mnt/openwrt/dl ./dl # ln -s /mnt/openwrt/feeds ./feeds # ln -s /mnt/openwrt/staging_dir ./staging_dir df -h - name: Update feeds run: | ./scripts/feeds update -a ./scripts/feeds install -a - name: Generate configuration file run: | rm -f ./.config* touch ./.config # # 在 cat \u0026gt;\u0026gt; .config \u0026lt;\u0026lt;EOF 到 EOF 之间粘贴你的编译配置, 需注意缩进关系 # 例如: cat \u0026gt;\u0026gt; .config \u0026lt;\u0026lt;EOF CONFIG_TARGET_IMAGES_GZIP=y CONFIG_KERNEL_BUILD_USER=\u0026#34;OpenWrt-CI\u0026#34; CONFIG_KERNEL_BUILD_DOMAIN=\u0026#34;Azure\u0026#34; EOF # # =============================================================== # sed -i \u0026#39;s/^[ \\t]*//g\u0026#39; ./.config make defconfig - name: Make download run: | make download -j8 || make download -j1 V=s rm -rf $(find ./dl/ -size -1024c) df -h - name: Compile firmware run: | make -j$(nproc) || make -j1 V=s echo \u0026#34;=======================\u0026#34; echo \u0026#34;Space usage:\u0026#34; echo \u0026#34;=======================\u0026#34; df -h echo \u0026#34;=======================\u0026#34; du -h ./ --max-depth=1 du -h /mnt/openwrt/ --max-depth=1 || true - name: Prepare artifact run: | mkdir -p ./artifact/firmware mkdir -p ./artifact/package mkdir -p ./artifact/buildinfo rm -rf $(find ./bin/targets/ -type d -name \u0026#34;packages\u0026#34;) cp -rf $(find ./bin/targets/ -type f) ./artifact/firmware/ cp -rf $(find ./bin/packages/ -type f -name \u0026#34;*.ipk\u0026#34;) ./artifact/package/ cp -rf $(find ./bin/targets/ -type f -name \u0026#34;*.buildinfo\u0026#34; -o -name \u0026#34;*.manifest\u0026#34;) ./artifact/buildinfo/ - name: Deliver buildinfo uses: actions/upload-artifact@v2 with: name: OpenWrt_buildinfo path: ./artifact/buildinfo/ - name: Deliver package uses: actions/upload-artifact@v2 with: name: OpenWrt_package path: ./artifact/package/ - name: Deliver firmware uses: actions/upload-artifact@v2 with: name: OpenWrt_firmware path: ./bin/targets/ - name: Upload release asset if: github.event == \u0026#39;release\u0026#39; uses: svenstaro/upload-release-action@v2 with: repo_token: ${{ secrets.YOURTOKEN }} file: ./artifact/firmware/* tag: ${{ github.ref }} file_glob: true 一个例子 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 # # This is free software, lisence use MIT. # # Copyright (C) 2019 P3TERX \u0026lt;https://p3terx.com\u0026gt; # Copyright (C) 2020 KFERMercer \u0026lt;KFER.Mercer@gmail.com\u0026gt; # # \u0026lt;https://github.com/KFERMercer/OpenWrt-CI\u0026gt; # name: OpenWrt-CI on: workflow_dispatch: #push: # branches: # - master # schedule: # - cron: 0 20 * * * release: types: [published] jobs: build_openwrt: name: Build OpenWrt firmware runs-on: ubuntu-latest if: github.event.repository.owner.id == github.event.sender.id steps: - name: Checkout uses: actions/checkout@v2 with: ref: master - name: Space cleanup env: DEBIAN_FRONTEND: noninteractive run: | docker rmi `docker images -q` sudo rm -rf /usr/share/dotnet /etc/mysql /etc/php /etc/apt/sources.list.d /usr/local/lib/android sudo -E apt-get -y purge azure-cli ghc* zulu* hhvm llvm* firefox google* dotnet* powershell openjdk* adoptopenjdk* mysql* php* mongodb* dotnet* moby* snapd* || true sudo -E apt-get update sudo -E apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs gcc-multilib g++-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler antlr3 gperf swig libtinfo5 sudo -E apt-get -y autoremove --purge sudo -E apt-get clean # sudo mkdir -p -m 777 /mnt/openwrt/bin /mnt/openwrt/build_dir/host /mnt/openwrt/build_dir/hostpkg /mnt/openwrt/dl /mnt/openwrt/feeds /mnt/openwrt/staging_dir # ln -s /mnt/openwrt/bin ./bin # mkdir -p ./build_dir # ln -s -f /mnt/openwrt/build_dir/host ./build_dir/host # ln -s -f /mnt/openwrt/build_dir/hostpkg ./build_dir/hostpkg # ln -s /mnt/openwrt/dl ./dl # ln -s /mnt/openwrt/feeds ./feeds # ln -s /mnt/openwrt/staging_dir ./staging_dir df -h - name: Update feeds run: | echo \u0026#34;src-git helloworld https://github.com/fw876/helloworld.git\u0026#34; \u0026gt;\u0026gt; \u0026#34;feeds.conf.default\u0026#34; ./scripts/feeds update -a ./scripts/feeds install -a - name: Generate configuration file run: | rm -f ./.config* touch ./.config # # 在 cat \u0026gt;\u0026gt; .config \u0026lt;\u0026lt;EOF 到 EOF 之间粘贴你的编译配置, 需注意缩进关系 # 例如: cat \u0026gt;\u0026gt; .config \u0026lt;\u0026lt;EOF CONFIG_LUCI_LANG_en=y CONFIG_LUCI_LANG_zh-cn=y CONFIG_PACKAGE_luci-app-baidupcs-web=y CONFIG_PACKAGE_luci-app-cifs-mount=y CONFIG_PACKAGE_luci-app-wireguard=y CONFIG_PACKAGE_luci-app-https-dns-proxy=y CONFIG_PACKAGE_luci-app-netdata=y CONFIG_PACKAGE_luci-app-p910nd=y CONFIG_PACKAGE_luci-app-ssr-plus=y CONFIG_PACKAGE_luci-app-ssr-plus_INCLUDE_Hysteria=y CONFIG_PACKAGE_luci-app-ssr-plus_INCLUDE_IPT2Socks=y CONFIG_PACKAGE_luci-app-ssr-plus_INCLUDE_Trojan=y CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_DNSFORWARDER=y CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_DNSPROXY=y CONFIG_PACKAGE_luci-app-uugamebooster=y CONFIG_PACKAGE_luci-app-syncdial=y # CONFIG_PACKAGE_luci-app-unblockmusic is not set # CONFIG_PACKAGE_luci-app-ttyd is not set # CONFIG_PACKAGE_luci-app-xlnetacc is not set CONFIG_PACKAGE_luci-theme-argon=y CONFIG_PACKAGE_luci-theme-bootstrap=y CONFIG_PACKAGE_luci-theme-material=y CONFIG_PACKAGE_luci-theme-netgear=y CONFIG_PACKAGE_ddns-scripts_cloudflare.com-v4=y CONFIG_PACKAGE_ddns-scripts_no-ip_com=y CONFIG_PACKAGE_ddns-scripts_route53-v1=y CONFIG_PACKAGE_bind-dig=y CONFIG_PACKAGE_nano=y CONFIG_PACKAGE_qrencode=y CONFIG_PACKAGE_open-vm-tools=y CONFIG_PACKAGE_whois=y CONFIG_PACKAGE_nmap-ssl=y CONFIG_PACKAGE_ipv6helper=y EOF # # =============================================================== # sed -i \u0026#39;s/^[ \\t]*//g\u0026#39; ./.config make defconfig - name: Make download run: | make download -j8 || make download -j1 V=s rm -rf $(find ./dl/ -size -1024c) df -h - name: Compile firmware run: | make -j$(nproc) || make -j1 V=s echo \u0026#34;=======================\u0026#34; echo \u0026#34;Space usage:\u0026#34; echo \u0026#34;=======================\u0026#34; df -h echo \u0026#34;=======================\u0026#34; du -h ./ --max-depth=1 du -h /mnt/openwrt/ --max-depth=1 || true - name: Prepare artifact run: | mkdir -p ./artifact/firmware mkdir -p ./artifact/package mkdir -p ./artifact/buildinfo rm -rf $(find ./bin/targets/ -type d -name \u0026#34;packages\u0026#34;) cp -rf $(find ./bin/targets/ -type f) ./artifact/firmware/ cp -rf $(find ./bin/packages/ -type f -name \u0026#34;*.ipk\u0026#34;) ./artifact/package/ cp -rf $(find ./bin/targets/ -type f -name \u0026#34;*.buildinfo\u0026#34; -o -name \u0026#34;*.manifest\u0026#34;) ./artifact/buildinfo/ - name: Deliver buildinfo uses: actions/upload-artifact@v2 with: name: OpenWrt_buildinfo path: ./artifact/buildinfo/ - name: Deliver package uses: actions/upload-artifact@v2 with: name: OpenWrt_package path: ./artifact/package/ - name: Deliver firmware uses: actions/upload-artifact@v2 with: name: OpenWrt_firmware path: ./bin/targets/ - name: Upload release asset if: github.event == \u0026#39;release\u0026#39; uses: svenstaro/upload-release-action@v2 with: repo_token: ${{ secrets.YOURTOKEN }} file: ./artifact/firmware/* tag: ${{ github.ref }} file_glob: true 本文参考：https://github.com/P3TERX/Actions-OpenWrt\n","date":"2022-11-26T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/github-to-build/","title":"利用github的actions 编译openwrt"},{"content":"因为openwrt的网络问题，创建了一个host网络的docker，而后已经解决，详情查看\n其中一个docker 是给朋友使用，所以需要改动一下网络，并且顺带 限制一下 cpu 内存 和 磁盘空间\n用export导出，避免体积太大\ndocker stop alpine-mengzhong docker export -o alpine-mengzhong.tar alpine-mengzhong cat alpine-mengzhong.tar | docker import - my/alpine-mengzhong:v1 创建一个虚拟网络单独给朋友使用\ndocker network create --subnet=10.0.7.1/24 myfriend # 删除命令 docker network rm friend 启动容器，入口 依旧是 sh /autoboot.sh\ndocker run -itd --name alpine-mengzhong2 --network=myfriend --ip 10.0.7.2 --privileged=true --restart=always my/alpine-mengzhong:v1 sh /autoboot.sh 修改防火墙规则\nnano /etc/config/firewall 重启防火墙\n/etc/init.d/firewall restart 手机4G 链接测试，没问题\n控制台 进去看一下网卡 也没问题\n忘记限制cpu和内存还有硬盘\n1 2 docker stop alpine-mengzhong2 docker rm alpine-mengzhong2 因为分区是ext4 无法限制磁盘容量 只有xfs才可以哈，只能给他限制一下内存和cpu\ndocker run -itd --name alpine-mengzhong2 -m 256m --cpus=1 --cpu-shares=500 --network=myfriend --ip 10.0.7.2 --privileged=true --restart=always my/alpine-mengzhong:v1 sh /autoboot.sh ","date":"2022-11-25T22:27:20+08:00","permalink":"https://dev.leiyanhui.com/docker/edit-export-import/","title":"docker 修改网络配置 -导入导出法"},{"content":"这个好像也是openwrt的问题。。\n临时方法，用host网络解决 例如创建一个支持sshd的alpine\n1 docker run -i -t -d --name alpine-sshd --network host --privileged=true --restart=always alpine:sshd-autoboot.sh2222 sh /autoboot.sh 当然不能和宿主机的端口冲突。。。 这个问题不算彻底解决 ,用host的方式 如果多个容器使用同样的默认端口 就 gg了\n彻底解决 如果要彻底解决，还是要修改防火墙设置\n打开 openwrt的网络设置，Luci\u0026gt;网络\u0026gt;防火墙\u0026gt;Luci\u0026gt;网络\u0026gt;防火墙\u0026gt;转发：接受 （Forward：accept）http://**/cgi-bin/luci/admin/network/firewall\n然后 shell登录到openwrt 执行命令\niptables -t nat -A POSTROUTING -s 172.17.0.1/16 ! -o docker0 -j MASQUERADE 注意172.17.0.1要修改成的你自己的docker的桥接地址段\n查看方式\n1 2 docker network ls # 看一下 bridge 对的那一串id docker network inspect 1914ac9dc9c9 | grep Subnet # 1914ac9dc9c9 是上面对应的那一串id 最后需要重启一下docker\n/etc/init.d/dockerd restart 进阶 把docker作为内网的一台机器使用 因为没有系统的学习过docker，简单看了一下手册就用了多年，一直不知道docker的虚拟网络是怎么玩的，在一次使用路由器的国产垃圾固件爱快的时候发现了他默认的docekr网络模式，然后才去翻看手册\n可以实现，自定义docker的ip端， 并实现 网内机器互联，并可以在路由上直接转发对应的端口\ndocker network create --subnet=10.0.100.1/24 mynet # 删除命令 docker network rm mynet docker run -i -t -d --name alpine-188 --network=mynet --ip 10.0.100.188 --privileged=true --restart=always alpine:sshd-autoboot.sh2222 sh /autoboot.sh ","date":"2022-11-25T22:27:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/docker-cant-network/","title":"openwrt 的docker无法联网的问题"},{"content":"最近已经全部改为alist alist支持的网盘更一些，而且默认支持webdav。直接装到路由器上了。\n然后路由器安装了luci-app-rclone，运行rclone config --config /etc/rclone/rclone.conf 处理配置文件，添加一个节点 alist到 http://10.1.1.1:5244/dav 配置好帐号密码\n1 2 3 mkdir /alist rclone mount alist: /alist --allow-other --allow-non-empty --vfs-cache-mode writes --config /etc/rclone/rclone.conf 后面是原文 要想挂载阿里云盘，需要先把阿里云盘挂载到webdav\n阿里云盘的处理 先挂载阿里云盘到webdav openwrt 插件方法 虽然实际很稳定，但是不建议，能docker的不要做插件\n插件方式 参考 https://dev.leiyanhui.com/openwrt/openwrt-plus/\ndocker方法 docker run -d --name=aliyundrive-webdav --restart=unless-stopped -p 50082:8080 \\ -e REFRESH_TOKEN='48e136dc87ce4d44bf1af9ef8ff3987d' \\ -e WEBDAV_AUTH_USER=77777 \\ -e WEBDAV_AUTH_PASSWORD=88888888 \\ messense/aliyundrive-webdav docker的网络问题处理，请查看这里 https://dev.leiyanhui.com/openwrt/docker-cant-network\nrclone安装和使用 插件或者直接安装方式 插件安装方式 参考 https://dev.leiyanhui.com/openwrt/openwrt-plus/\n配置 运行rcone config 按照提示先创建一个挂载配置，选择webdav，然后 输入webdav的用户名密码，使用 Nextcloud WebDAV 模式，\n最后放到openwrt的计划任务里面，写到启动命令里面 ，有时候 无效\n/mnt/aliyunpan 是要挂载到本地的目录，提前mkdir /mnt/aliyunpan\n1 */1 * * * * rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime docker方式。 说实话 有点复制，因为要操作宿主机，还要配置。但是不是不可以实现。官网的解决方法 是宿主机配置config文件后映射进去 (问号脸，，宿主机不安装rclone怎么弄他配置文件嘛。。。) 另外还有权限问题 需要处理 要用用户信息 还有fuse的处理，\n如果你要弄的话，不在宿主机安装rclone 就需要docker运行多次后重新打包镜像。 我这里就不折腾rclone docker化了。 shell如下，官网说明 https://rclone.org/install/\n1 2 3 4 5 6 7 8 9 10 11 mkdir -p ~/data/mount docker run --rm \\ --volume ~/.config/rclone:/config/rclone \\ --volume ~/data:/data:shared \\ --user $(id -u):$(id -g) \\ --volume /etc/passwd:/etc/passwd:ro --volume /etc/group:/etc/group:ro \\ --device /dev/fuse --cap-add SYS_ADMIN --security-opt apparmor:unconfined \\ rclone/rclone \\ mount dropbox:Photos /data/mount \u0026amp; ls ~/data/mount kill %1 挂载其他网盘 如果是 google 或者 OneDrive国外版，需要全局科学上网。 其他都没啥问题，不用多说。\n","date":"2022-11-25T04:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/rclone/","title":"openwrt /linux下 使用rclone挂载 网络磁盘到本地：阿里云盘为例"},{"content":"插件尽量docker化，1是更新方便 2 是出问题 不会影响 主要功能。\ndocker 安装 opkg install docker dockerd luci-app-dockerman luci-i18n-dockerman-zh-cn docker 内容器无法联网的bug处理 这个应该是openwrt的默认设置问题，也可以说是bug,点这里查看\ndocker里面跑一个支持sshd的Linux系统的方法 因为docker 一般不建议多个服务在同一个容器里面，所以默认并没有提供类似的方法。 但是不建议，不是说不可以。 点这里查看，也可以用我打包好\ndocker里面运行一个桌面版Linux的方法 同样 也是可以实现的，甚至可以调用显卡加速。点这里查看\n网上教程没有告诉你的几个坑 限于多数openwrt的新玩家都是linux小白，难免会遇到很多坑\nopenwrt的docker默认无法访问外网的处理 部分容器内的时间错误：启动的时候加环境变量 -e TZ=Asia/Shanghai 容器自定义网段 本文文末 DDNS jeessy/ddns-go:latest 支持 阿里 腾讯 百度 华为 cf 等 几个国内常用的，但是不支持 3322 qmcgaw/ddns-updater 支持很多国内国外的，但是貌似也不支持3322\n但是 3322 可以直接 lynx -mime_header -auth=用户名:密码 \u0026ldquo;http://members.3322.net/dyndns/update?system=dyndns\u0026hostname=域名\u0026rdquo; 这样\n阿里云盘webdav messense/aliyundrive-webdav 因为 插件的这个 还不错，所以暂时没有docker化\n1 2 3 4 5 6 docker run -d --name=aliyundrive-webdav --restart=unless-stopped -p 50082:8080 \\ -v /etc/aliyundrive-webdav/:/etc/aliyundrive-webdav/ \\ -e REFRESH_TOKEN=\u0026#39;\u0026lt;your refresh token\u0026gt;\u0026#39; \\ -e WEBDAV_AUTH_USER=admin \\ -e WEBDAV_AUTH_PASSWORD=admin \\ messense/aliyundrive-webdav 精简一下\n1 2 3 4 5 docker run -d --name=aliyundrive-webdav --restart=unless-stopped -p 50082:8080 \\ -e REFRESH_TOKEN=\u0026#39;tttttttttttttt\u0026#39; \\ -e WEBDAV_AUTH_USER=uuuuuuuuuu \\ -e WEBDAV_AUTH_PASSWORD=ppppppppppppppp \\ messense/aliyundrive-webdav frps 内网穿透服务端 snowdreamtech/frpc 这个暂时用插件，没有docker化，懒得弄 kms mikolatero/vlmcsd opkg remove luci-app-vlmcsd rm -rf /etc/config/vlmcsd opkg remove vlmcsd docker run -d -p 1688:1688 --restart=always --name=\u0026quot;kms-vlmcsd\u0026quot; -e TZ=Asia/Shanghai mikolatero/vlmcsd 激活方法： https://hub.docker.com/r/mikolatero/vlmcsd/\nv2ray mzz2017/v2raya docker run -d --restart=always --privileged \\ --network=host \\ --name v2raya \\ -e TZ=Asia/Shanghai \\ -v /etc/resolv.conf:/etc/resolv.conf \\ mzz2017/v2raya 挂载 /etc/resolv.conf 是为了开透明代理，我测试发现 v2ray 里面 经常会导致 全局断网。。。有点坑 所以还是docker 来跑,并且还是不用host模式了 ，非host模式 不可以使用透明模式的全局代理，但是同样不会影响局域网内其他不需要科学学习的用户。\n1 2 3 4 5 6 docker run -d --restart=unless-stopped \\ -p 2017:2017 \\ -p 20170-20173:20170-20173 \\ --name v2raya \\ -e TZ=Asia/Shanghai \\ mzz2017/v2raya 文件管理 filebrowser 也是一个网盘工具\ndocker run -d \\ --name filebrowser \\ -v /CUSTOM_PATH:/srv \\ -v /PATH_OF_DATABASE/filebrowser.db:/database.db \\ --user $(id -u):$(id -g) \\ -p 8080:80 \\ -e TZ=Asia/Shanghai \\ --restart=unless-stopped \\ filebrowser/filebrowser 让他可以直接访问 openwrt的根目录 简化一下\ndocker run -d \\ --name filebrowser \\ -v /:/srv \\ --user $(id -u):$(id -g) \\ -p 50088:80 \\ -e TZ=Asia/Shanghai \\ --restart=unless-stopped \\ filebrowser/filebrowser 另外运行一个作为正经 网盘使用 docker run -d \\ --name filebrowser-netdisk \\ -v /mnt:/srv \\ --user $(id -u):$(id -g) \\ -p 50089:80 \\ -e TZ=Asia/Shanghai \\ --restart=unless-stopped \\ filebrowser/filebrowser 临时用是可以的，正经用，还是用nextcloud owncloud 之类的\n全docker搭建媒体中心 比较长，点击本文查看 https://dev.leiyanhui.com/docker/mediavodcenter/\ndocker搭建 rustdesk 私有中转服务器 以前有记录 https://dev.leiyanhui.com/docker/rustdesk-server/\n","date":"2022-11-25T04:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/docker-plus/","title":"openwrt 常用插件 的docker处理"},{"content":"准备安装 opkg update 软件包名称里面字带luci 都是可以再openwrt网页端管理的，安装后 都要重启一次openwrt后 网页端才可以显示出来。\n名字里面带 luci-i18n 都是网页端语言包\n下面常用的命令 wget 是下载 rm -rf *.ipk 是删除当前目录下的所有 ipk文件 opkg 前文解释过\n软件安装的原则和整个网络的部署 关于路由器的软件和插件的一个原则。\n如果你路由器磁盘工具不是特紧张，尽量用docker跑第三方插件。这样某一个插件挂了，也只会影响其中一个服务。能用docker跑的，就不要装单独的插件。这也是 我一直不推荐 使用第三方固件的一个原因。 同样，能用路由解决的，尽量不装到主路由上。 all in one 方案，因为经常折腾甚至重启，尽量不要把主路由的功能弄进来。 x86的主路由，虽然说不需要太高性能，但是还是尽量提一点点。哪怕cpu不好升级，内存尽可能高一点。那么做ramdisk 都比小的了。我们软路由用的都是古董级的平台，内存又不值钱。 主路由器上 尽量不折腾虚拟机，能用docker的不要用虚拟机。所以是否支持虚拟化真的不重要，有那个钱，不如加点内存和ssd 换一个好点的电源。省下钱，以后蹲万兆机器多好。除非你机器性能真的可以，而且还真的需要跑一个win。。另外docker里面可以套kvm的 性能也没啥损耗，自己慢慢研究 后面这些软件，都是我多年使用可以稳定运行 不会影响主路由器，也不出现乱七八糟幺蛾子的软件，所以我暂时直接安装，先跑起来，后续慢慢挪到docker\ndocker容器 opkg install docker dockerd luci-app-dockerman luci-i18n-dockerman-zh-cn frps 内网穿透服务端 你要装客户端 就是 frpc了，在openwrt 的software里面 网页端搜索 frpc 安装对应名称的三个包 就ok了\nopkg install frps luci-app-frps luci-i18n-frps-zh-cn 阿里云盘webdav 我这里wget命令后面多了https://ghproxy.com/ 这个地址，是为了给github加速的，目前最新版是1.10.3-1,如果你看到这个文章很久了，那么就去 https://github.com/messense/aliyundrive-webdav/ 作者主页看看哦，releases里面 找最新版 然后 show all 就可以看到 ipk的文件了，右键复制链接就好\nwget https://ghproxy.com/https://github.com/messense/aliyundrive-webdav/releases/download/v1.10.3/aliyundrive-webdav_1.10.3-1_x86_64.ipk wget https://ghproxy.com/https://github.com/messense/aliyundrive-webdav/releases/download/v1.10.3/luci-app-aliyundrive-webdav_1.10.3_all.ipk wget https://ghproxy.com/https://github.com/messense/aliyundrive-webdav/releases/download/v1.10.3/luci-i18n-aliyundrive-webdav-zh-cn_1.10.3-1_all.ipk opkg install aliyundrive-webdav_1.10.3-1_x86_64.ipk opkg install luci-app-aliyundrive-webdav_1.10.3_all.ipk opkg install luci-i18n-aliyundrive-webdav-zh-cn_1.10.3-1_all.ipk rm -rf *.ipk #清理 kms 那个啥啥啥你懂就好 wget https://op.supes.top/packages/x86_64/vlmcsd_svn1113-19_x86_64.ipk wget https://op.supes.top/packages/x86_64/luci-app-vlmcsd_git-23.326.49742-f588991_all.ipk opkg install vlmcsd_svn1113-19_x86_64.ipk opkg install luci-app-vlmcsd_git-23.326.49742-f588991_all.ipk rm -rf *.ipk #清理 v2raya 那个啥啥啥你懂就好 opkg install v2raya wget https://op.supes.top/packages/x86_64/luci-app-v2raya_git-23.326.49742-f588991_all.ipk opkg install luci-app-v2raya_git-23.326.49742-f588991_all.ipk rm -rf *.ipk #清理 ddns 动态dns opkg install luci-app-ddns opkg install luci-i18n-ddns-zh-cn doh dns over https 这个安装配置完成后，需要再次重启一次 才可以生效\nopkg install https-dns-proxy luci-app-https-dns-proxy luci-i18n-https-dns-proxy-zh-cn ping whoami.akamai.net # 测试doh rclone opkg install rclone wget https://op.supes.top/packages/x86_64/luci-app-rclone_git-23.298.65872-3ec93ac_all.ipk opkg install luci-app-rclone_git-23.298.65872-3ec93ac_all.ipk #依赖 rclone rclone-config rclone-webui-react rclone-ng. luci-app-rclone rclone 配置 测试了一下 rclone-webui-react rclone-ng 莫名其妙的一堆错误，懒得处理，还是直接命令行来搞\nrclone config 如果要挂载ali云盘的话 在 aliyundrive-webdav 要勾选 禁用重定向 也就是 \u0026ndash;no-redirec 参数， 后面也是以阿里云盘为例子 路径的写法 为 rclone配置名称:/远程路径 /本地路径\nmkdir /mnt/aliyunpan rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime 测试没问题问题后，把这个命令 放到 计划任务 cron 里面 或者 后面加 \u0026amp;写到 openwrt的开机启动\n","date":"2022-11-25T04:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/openwrt-plus/","title":"openwrt 常用插件安装"},{"content":"今天第一次弄x86的openwrt，遇到分区扩容的一个坑。网上太多太多的资料 都是坑。\n原因是原版的openwrt 有一个挂载的覆盖的bug，多数固件并未解决。我一开始用squashfs的固件，都没有搞定，最后换到ext4 解决。前后折腾2个多小时。 具体可以参考：https://github.com/openwrt/openwrt/issues/7352\n然后下午在群里，发现有人手把手教别人弄，最后还是出现和我一样的问题。\ndf -h 查看容量正常，但是网页端 software查看容量 并没有增加。装软件也会提示容量不足\n我的解决办法 就是用ext4模式安装，我用的官网的ext4固件。因为我设备是x86 并且没有很特殊的硬件，官网固件都是可以驱动的（N2600显卡除外，非efi模式启动黑屏）\n如果你也和我一样 是x86的路由，那么强烈建议你用最精简的官网固件,原因\n第三方固件，不安全，虽然说都号称没有后门，但是你有时间和精力 或者有能力去查找后门嘛？ 鉴于openwrt这个圈子的特殊性，与其相信第三方固件作者是用爱发电，我更多相信他是一个半吊子菜鸟一时的热忱 但openwrt圈内也确实有一些 完全开源甚至编译过程都开源的第三方固件，但是我们没有那么多时间去甄别，更没有那么多时间和经历 去折腾试用 openwrt 是一个完整的linux系统，官网固件只要能开机，能识别你的有线网卡，或者usb口，哪怕只能识别显示屏，那么剩下的都可以解决 openwrt 本身是一个很强壮 稳定高性能的 路由器系统，所有的问题 都出在第三方固件作者和 第三方插件上！！！看看那些第三方固件作者的声明 第三方作者的水平层次不齐，甚至论坛上下载过万的固件 哪怕他最精简的版本bug多到都无法完成最基本的路由功能！ 当然，如果你网卡不识别，并且还是linux小白，又不想学习，那么就冒险试用第三方，或者付费找人编译吧。能用钱和安全解决的 问题，都不是问题 哈哈。 如果有时间又能力去编译自定义固件，那么这个文章和这个观点也不适合你，自己忽略就好了。 今天群里还有人问 官网地址。。。 www.openwrt.org\n下载官网稳定版固件 下载地址： https://archive.openwrt.org/releases/ 选择版本 再选择 cpu平台 就可以了。我这里是x86 64位的 cpu，所以 依次点击 22.03.2 -\u0026gt; targets -\u0026gt; x86 -\u0026gt; 64 ，然后选择 generic-ext4-combined.img.gz 这个ext4分区的\n如果你机器只支持efi启动不支持传统bois启动，那就选generic-ext4-combined-efi.img.gz，如果同时支持，那么还是建议无脑选这个。如果你情况特殊非要用efi 那就选择 generic-ext4-combined-efi.img.gz 这个\n很多第三方固件是 squashfs-combined 的，如果制作者没有处理overlay的bug，那么肯定会遇到挂载问题，网上有资料说可以通过删除/etc 目录的方法来解决，但是我试过也不行。\n还有群友说看不懂英文的官网。。那么你就直接点我下面地址下载好了\n我最终选中的固件是截至目前最新的稳定版：https://archive.openwrt.org/releases/22.03.2/targets/x86/64/openwrt-22.03.2-x86-64-generic-ext4-combined.img.gz\n下载后 解压，不会解压或者你的解压工具出错，那么就直接用 winrar 解压他。 解压后是一个img文件\n刷入硬盘 如果你原来是squashfs 那么是无法从op的网页后台升级刷入ext4的固件的，需要重新硬刷。\n一般建议 是 吧上面的openwrt-22.03.2-x86-64-generic-ext4-combined.img.gz 解压后，从winpe下，或者linux live下 或者干脆把 硬盘挂到另外一个电脑，用balenaEtcher 或DD命令等 写盘工具写入到对应的磁盘\n这个经常折腾系统的，都会，就不用细说了。 不会刷的，就自己搜一下balenaEtcher 的教程，基本就是 选择磁盘文件*.img 选择磁盘，写入 等待写入 等待校验 ，就完事了。\n什么都不要动 直接去开机 网上很多教程，甚至是都一个文章抄出来的，说让你 在diskgen下调整分区，这个方法很不靠谱，且不说 diskgen对linux的分区支持不好，你可能压根操作不了，再说，diskgen可能会破坏UUID或者分区表兼容性，会导致 fstab和gurb出错。导致你的openwrt 压根启动不起来\nlinux下的文件系统，你尽量少用win下的软件去鼓捣。第三方的这些商业化软件 ，真的不靠谱。\n所以 如果你调整不了 或 调整后启动不起来 那么是正常的。 不要用diskgen调整分区！！！ 不要用diskgen调整分区！！！不要用diskgen调整分区！！！\n启动openwrt 电脑接入openwrt，可以网线直接插上，也可以接入下属ap设备的wifi。自动获取ip，获取到 192.168.1.XX的就对了。 官网版本默认网页地址是： http://192.168.1.1 用户名 root 密码 空的\n进入后，先拨号 联网，官网版本全英文界面 ，看不懂 自己手机翻译\n点击 NetWork \u0026gt; Interfaces\n编辑 edit wan口，接入方式 默认是dhcp 切换到 pppoe 会提示一次确认切换，然后输入 宽带用户密码，保存 应用保存(aplay save)\n或者干脆直接接到 你现在的路由下dhcp自动获取ip，然后在现在的路由器 的dhcp列表里面找到他的ip然后用对应的ip 打开网页 以及登录shell 正常就可以拨号成功了。\nshell登录openwrt 如果用putty 或者 其他工具比如MobaXterm fineshell 等等，甚至 win10以上电脑的cmd都可以。这里以简单的cmd命令好为例,win10、win11 下 win+R 快捷键，运行 cmd 在 cmd 窗口输入 执行 ssh root@192.168.1.1 第一次登录 会处理key的问题，输入yes 确认， 因为现在密码是空的不用输入密码 就可以了登录了。\n如果有提示known_hosts的错误，打开 C:\\Users\\你的用户名\\.ssh 这个隐藏文件夹，删除 known_hosts 文件，或者记事本打开编辑一下删除对应的行。\n后面多数操作都是基于shell下的openwrt 。虽然很多操作是可以在网页端完成的，只是点来点去麻烦\n准备安装软件 修改国内源（此步骤可以省略） 以修改清华源为例，执行以下命令sed正则替换downloads.openwrt.org为清华源的地址，如果你用其他源 找一下官网帮助，修改下面的命令就好\nsed -i 's_downloads.openwrt.org_mirrors.tuna.tsinghua.edu.cn/openwrt_' /etc/opkg/distfeeds.conf 或者你用vim /etc/opkg/distfeeds.conf 手动编辑也行。 执行完成后更新一次本地list，记得openwrt每次重启后，如果要安装软件，都需要在网页端更新一次list 或者 shell执行下面命令。这个是openwrt的机制，他把源的数据放内存去了。重启就就没有了。\nopkg update 安装常用的磁盘工具 op的官网版本 极度精简，精简到只有核心的基本功能，所以多数工具需要自己装。用过opwnwrt的都知道 ，约少的功能和插件，才越稳定。很多国内第三方固件，精简版，还要收费。。。真的 是坑小白。。。\nopkg install block-mount fdisk cfdisk lsblk 解释下opkg 是openwrt的包管理工具的安装,同其他linux发行版的 apk apt yum pacman 等命令一样道理 ，你可以理解成 Windows的 exe msi setup等可以直接双击安装的安装包\n安装：opkg install 在线软件包名称或者本地路径 卸载:先查看opkg list_installed 然后卸载opkg remove 软件包名（上一步找到的名称）\nblock-mount 是一个可以在openwrt网页端 操作挂载点的工具，这也是为什么你的openwrt菜单 系统下 没有挂载点这个按钮的原因 就是缺少这个包 fdisk 磁盘分区工具管理 同Windows下的fdisk 一样的 cfdisk 命令行可视化的磁盘分区工具，你可以理解为 这就是一个简化的linux版本 diskgen，或者fdisk的易用性工具 lsblk 磁盘分区和挂载点的一个查看工具 上面的 cfdisk lsblk 甚至block-mount 都不是必须软件，但是为了简单使用，还是建议你参考我教程 都装上，这些软件也都很小\nblock-mount 安装完成后 需要重启一下 openwrt ，才可以在网页端的 系统菜单 找到 mount/挂载点 这个按钮\n安装网页中文汉化包和主题（此步骤可以省略） opkg install luci-i18n-base-zh-cn luci-theme-material 解释\nluci-i18n-base-zh-cn 是网页端的中文语言包 luci-theme-material 是一个左右分栏，并且兼容手机等设备的openwrt网页界面主题，也可以不装，随便你。 中文语言包，虽然可以自动识别，但是部分软件 会显示中英文混杂的情况，所以最好 还是在 openwrt网页端的 system(系统) -\u0026gt; system(系统) -\u0026gt; lanuage and style(语言和主题) 选择一下 简体中文\n主题 可以选择前面安装的 material，也可用默认的\n开始之前 linux的磁盘管理的入门扫盲小知识 window 我们都知道 有C盘D盘什么的，但是linux 不存在这个，Linux下 一切皆为文件，包括硬件设备的：内存 硬盘 usb 甚至显卡 等等，这些都是文件，对应的 都是 Linux下 /dev下的文件。 我们所有的硬件的操作，都是对 /dev下的文件的操作。\n因为没有C D 盘符的概念，linux下完整的路径 都是以/xxx 开头的，而非Windows下 C:/ D:/ 这样开头的\n我们都知道 Windows可以修改盘符，比如 我可以把D盘从windows磁盘管理里面 分别E给他，他就同时可以用D和E 两个盘符了，删掉D 就变成E。 linux下就是用挂载和解除挂载的方式来解决不同分区的路径变化。。\n如果是临时的挂载，我们直接用 mount /dev/【磁盘名称】【分区编号】 /【挂载地址】 命令就可以了。如果是开机启动挂载，就需要修改/etc 目录的下的 fstab文件\n/etc这个目录，你可以理解成 Windows 的注册表 组策略。 几乎所有的软件和系统的配置项 都在这个目录里面。\n但是因为直接编辑 /etc/fstab 这个文本文件，需要处理uuid可能不太直观，而且可能还存在其他分区甚至U盘 sd卡等，所以我们在openwrt下借用 上面说的block-mount 这个软件包，可以可视化的在openwrt网页端来操作。后续管理u盘sd卡 或nas也方便\n处理分区和磁盘 cmd再次登录到openwrt的shell下，执行命令 fdisk -l 查看磁盘\nroot@OpenWrt:~# fdisk -l Disk /dev/sda: 29.5 GiB, 31675383808 bytes, 61865984 sectors Disk model: BIWIN SSD Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: C120D9F5-D6F9-D15B-05A7-0D348F8A4B00 Device Start End Sectors Size Type /dev/sda1 512 33279 32768 16M Linux filesystem /dev/sda2 33280 246271 212992 104M Linux filesystem /dev/sda128 34 511 478 239K BIOS boot Partition table entries are not in disk order. 我这里 就一个磁盘 磁盘名称是 sdaDisk /dev/sda: 29.5 GiB，有三个分区 sda1 sda2 sda128\nsda1 是他的基本启动文件 sda2 就是openwrt的系统分区，如果是overlay的openwrt固件情况还要复杂一些，如果你要用overlay,不妨去看一下overlay相关的文章。我这里是ext4的固件，所以简单很多。 如果你是efi的镜像，可能还多出来一个efi分区。 如果你要有多个磁盘，注意看 每一个磁盘的名字 还有 磁盘的编号。如果是nvme 磁盘的换，多数是/dev/nvmeXXX mmc磁盘的话/dev/mmcXXX 虚拟机的话根据虚拟平台不一样可能是/dev/vdXXXX /dev/vmXXX /dev/virXXX /dev/qemuXXX u盘或者sd卡的话，那么多数就usb 或者 sd开头的\n我们现在需要增加容量的磁盘上扩建空间，我这里 以我的/dev/sda 这个磁盘为例子，shell命令再次执行cfdisk /dev/sda（ 空格后面 指的要操作的磁盘 ）\n用键盘方向键操作，上下键盘，选择中绿色的部分 free space （空闲空间） 左右键 选择 New（新建）回车，输入新分区的容量。 你可以弄一个1-2G的给系统用，剩下一点分区给docker用（挂载到/opt）或者干脆简单简单的 全部空间 给到系统\n然后 会新建一个分区 /dev/sdaXXX 我 这里是/dev/sda3, 然后左右键 选择 保存（write）输入 yes确认 左右键选择退出（quit）\n这样我们就新建了一个分区\n格式化这个新分区 Windows下格式化命令 我们都知道 是format，Linux下用 mkfs.XXX, Linux常用的分区很多种，这里不展开说，但是这里肯定适合用NTFS exfat fat之类，不是说不能用，而是说稳定性和速度在linux下表现不好， 所以还是用linux的常用分区格式，我这里用传统的ext4 兼容性和稳定最好\nmkfs.ext4 /dev/sda3 不要关闭shell，回到openwrt网页端处理挂载 点 系统\u0026gt; 挂载点 生成配置 自动生成配置\n在挂载点那个位置，可以看到 多出来的一个分区/dev/sda3 他想自动挂载到/mnt/sda3上，我们编辑一下这条\nUUID 保持是这个分区的没错 我这里是xx-xx-xx /dev/sda3 29.38G\n挂载点选择 / 作为根目录使用\n然后看一下这行地方有一个提示 根目录准备，确保使用以下命令来复制根文件系统，后面几行命令，其中一行 mount /dev/sda1 /tmp/extroot\n这个地方 他的实例是处理的/dev/sda1 第一分区，需要改为你刚刚新建的分区 我这是/dev/sda3，最终命令和解释\n1 2 3 4 5 6 7 mkdir -p /tmp/introot #创建一个文件夹 mkdir -p /tmp/extroot #创建一个文件夹 mount --bind / /tmp/introot # 用临时屏蔽的方法 挂载/ 到introot这个目录 方便我们后面复制 mount /dev/sda3 /tmp/extroot # 这行需要编辑一下 把我们的新建的分区 临时挂载到extroot tar -C /tmp/introot -cvf - . | tar -C /tmp/extroot -xf - # 用tar的方式，把原来根分区的 文件 保留权限同步复制到extroot（/dev/sda3 就是新分区） 并打印出详细信息和进度 umount /tmp/introot # 取消挂载 umount /tmp/extroot # 取消挂载 先在网页的 保存挂载点的配置，然后删除 和sda2 之前的那个100M左右的分区的挂载。 然后应用保存。 再把上面的命令逐行 或者全部复制到 openwrt的shell 里面 执行\n注意顺序别搞错了。\n重启检查 重启路由器，启动完成后检查 shell运行df -h\nroot@OpenWrt:~# df -h Filesystem Size Used Available Use% Mounted on /dev/root 102.3M 20.5M 79.7M 20% /rom tmpfs 1.9G 572.0K 1.9G 0% /tmp /dev/sda3 28.8G 348.8M 26.9G 1% / /dev/sda1 16.0M 5.7M 10.2M 36% /boot /dev/sda1 16.0M 5.7M 10.2M 36% /boot tmpfs 512.0K 0 512.0K 0% /dev /dev/sda3 28.8G 348.8M 26.9G 1% /opt/docker shell运行lsblk\nroot@OpenWrt:~# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 0 29.5G 0 disk ├─sda1 8:1 0 16M 0 part /boot │ /boot ├─sda2 8:2 0 104M 0 part /rom ├─sda3 8:3 0 29.4G 0 part /opt/docker │ / └─sda128 259:0 0 239K 0 part 网页端依次点开 系统 Software 查看 Free space 30G 左右\n这就正常了\n后续- 安装常用插件 能用docker跑的，尽量用docker，能放到旁路路由的尽量不要放主路由\n安装方法和清单 https://dev.leiyanhui.com/openwrt/openwrt-plus/\n最后写在结尾的话 openwrt这个国内圈子有一点畸形，做固件的也不是什么大神，更多是一些linux一知半解的小白的做，可能比完全不懂linux的你好不到哪里去。甚至还有收费的第三方定制固件，甚至还有x86的精简固件收费。。有点匪夷所思。\nopenwrt群里，还一些人自己可以编译固件 沾沾自喜自诩为大神 甚至收费。。\n其实 openwrt 是一个完整的linux系统，只是官网没有出iso安装镜像，而且img格式的磁盘镜像。 大部分内容你甚至可以直接挂载img文件编辑后写入磁盘。。。\n最后，openwrt本身很强壮很稳定， 不稳定的是第三方插件。\n所以能不用第三方固件 就不要用，能用精简版 就不要用什么高大全，能修改img文件搞定的事情，就不要自己编译固件。折腾。\n如果是x86_64 尽量用ext4的方法安装，系统如果损坏有资料需要导出或者文件误删除 都好处理。overlay 系统恢复初始化简单一些。但是扩容这个地方需要自己编译固件，或者用第三方已经处理好的固件来弄。 完整编译一次固件，看网络和机器性能 差不多需要2-4小时时间，得不偿失。。\n","date":"2022-11-24T04:40:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/disk-part-bug/","title":"openwrt分区扩容的问题---多数openwrt固件的一个巨坑 保姆教程/ 顺带 linux和openwrt 扫盲 /常用扩展插件安装"},{"content":"创建一个容器 在爱快中添加一个 容器 \u0026lsquo;alpine-docker-cli-1\u0026rsquo; 使用镜像 alpine:latest 高级设置挂载目录 /var/run/docker.sock 到容器的/var/run/docker.sock\n配置容器 打开容器控制台\n修改源更新安装ssh 密钥 启动文件等 1 2 3 4 5 6 7 8 9 10 11 12 13 echo \u0026#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/main\u0026#34; \u0026gt; /etc/apk/repositories \u0026amp;\u0026amp; \\ echo \u0026#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/community\u0026#34; \u0026gt;\u0026gt; /etc/apk/repositories \u0026amp;\u0026amp; \\ apk update \u0026amp;\u0026amp; \\ apk add --no-cache openssh tzdata \u0026amp;\u0026amp; \\ cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \u0026amp;\u0026amp; \\ sed -i \u0026#34;s/#PermitRootLogin.*/PermitRootLogin yes/g\u0026#34; /etc/ssh/sshd_config \u0026amp;\u0026amp; \\ ssh-keygen -t dsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_dsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t rsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_rsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t ecdsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_ecdsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t ed25519 -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_ed25519_key \u0026amp;\u0026amp; \\ echo \u0026#34;root:admin\u0026#34; | chpasswd \u0026amp;\u0026amp; \\ echo \u0026#34;/usr/sbin/sshd -D\u0026#34; \u0026gt; /autoboot.sh \u0026amp;\u0026amp; \\ echo \u0026#34;tail -f /dev/null\u0026#34; \u0026gt; /autoboot.sh 上面的命令 是让我们能创建一个支持ssh的docker，但是还不是我们想要的\n进阶，用docker里面的cli 操作宿主的docker 也就是 添加一行apk add \u0026ndash;no-cache docker-cli\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 echo \u0026#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/main\u0026#34; \u0026gt; /etc/apk/repositories \u0026amp;\u0026amp; \\ echo \u0026#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/community\u0026#34; \u0026gt;\u0026gt; /etc/apk/repositories \u0026amp;\u0026amp; \\ apk update \u0026amp;\u0026amp; \\ apk add --no-cache docker-cli \u0026amp;\u0026amp; \\ apk add --no-cache openssh tzdata \u0026amp;\u0026amp; \\ cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \u0026amp;\u0026amp; \\ sed -i \u0026#34;s/#PermitRootLogin.*/PermitRootLogin yes/g\u0026#34; /etc/ssh/sshd_config \u0026amp;\u0026amp; \\ ssh-keygen -t dsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_dsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t rsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_rsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t ecdsa -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_ecdsa_key \u0026amp;\u0026amp; \\ ssh-keygen -t ed25519 -P \u0026#34;\u0026#34; -f /etc/ssh/ssh_host_ed25519_key \u0026amp;\u0026amp; \\ echo \u0026#34;root:admin\u0026#34; | chpasswd \u0026amp;\u0026amp; \\ echo \u0026#34;/usr/sbin/sshd -D\u0026#34; \u0026gt; /autoboot.sh \u0026amp;\u0026amp; \\ echo \u0026#34;tail -f /dev/null\u0026#34; \u0026gt;\u0026gt; /autoboot.sh 我打包了一个基础的docker镜像 只安装了 openssh tzdata 时区 nano 默认用户名 root 密码 root ssh端口2222 tar.gz格式的，你可以自己导入到镜像 使用命令参考\n1 cat alpine-sshd2222.tar.gz | docker import - alpine:sshd-autoboot.sh2222 1 docker run -i -t -d --name alpine-mengzhong --network host --privileged=true --restart=always alpine:sshd-autoboot.sh2222 sh /autoboot.sh 下载地址： https://github.com/joyanhui/file.leiyanhui.com/raw/main/pve-unraid-kvm/alpine-sshd2222.tar.gz\n以后可能也会打包一个debian的镜像，不过体积就比较大，可能会放到云盘\n本文参考 https://cloud.tencent.com/developer/article/1683604\n","date":"2022-11-22T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/alpine-sshd/","title":"docker的alpine中使用ssh的docker"},{"content":"爱快比较稳定，分流功能方便一些，安装也解决，所以我主路由n2600是用的爱快。\n但是爱快的扩展性 相对比较差，最新版虽然支持docker了，但是因为没有shell，只能从网页简单配置，很多参数加不上，还是比较麻烦。 我先是尝试使用 /var/run/docker.sock 的方法操作爱快的docker 发现找不到这个文件，而现在路由在使用中，不知道具体路径是哪里\n实在是懒得继续折腾，找到一个就路由器，配置好以后，先临时上网\n还是刷 openwrt\n","date":"2022-11-22T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/ikuai-docker-shell/","title":"爱快没有完整的shell无法正常使用docker的解决方法  docker嵌套"},{"content":" 之所以有这个奇葩的需求 是因为一个软路由 安装的是爱快系统，而考虑到不折腾的原则，没有去更换系统。 但是爱快的docker 因为没有完整的shell权限使用起来很奇葩.\n先在爱快docker运行一个alpine 修改密码 passwd 然后 修改源\netc/apk/repositorie ---- https://mirrors.ustc.edu.cn/alpine/latest-stable/main https://mirrors.ustc.edu.cn/alpine/latest-stable/community apk update 安装配置sshd apk add --no-cache openssh tzdata cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime sed -i \u0026quot;s/#PermitRootLogin.*/PermitRootLogin yes/g\u0026quot; /etc/ssh/sshd_config ssh-keygen -t dsa -P \u0026quot;\u0026quot; -f /etc/ssh/ssh_host_dsa_key ssh-keygen -t rsa -P \u0026quot;\u0026quot; -f /etc/ssh/ssh_host_rsa_key ssh-keygen -t ecdsa -P \u0026quot;\u0026quot; -f /etc/ssh/ssh_host_ecdsa_key ssh-keygen -t ed25519 -P \u0026quot;\u0026quot; -f /etc/ssh/ssh_host_ed25519_key 手动启动sshd /usr/sbin/sshd -D 安装docker apk add docker 配置自动启动 试了 openrc 和 busybox 都没弄好。。。。。。因为爱快 没有安装的shell 也就无法自己定义sh 。。。所以。。。直接换一个docker吧\n然后测试了一圈。。直接用openwrt的docker算了。。。 openwrtorg/rootfs:x86_64-openwrt-22.03\ndocker版本openwrt简单使用 我主要是套docker用，ssh登录到docker opwnwrt\n国内源 cp /etc/opkg/distfeeds.conf /etc/opkg/distfeeds.conf-bak vi /etc/opkg/distfeeds.conf #把里面的/etc/opkg/distfeeds.conf-bak替换为mirrors.aliyun.com/openwrt opkg update\n安装docker opkg install docker opkg install dockerd /etc/init.d/dockerd start ln -s /etc/init.d/dockerd /etc/rc.d/S100docker 测试一个docker docker run -d \u0026ndash;restart=always \u0026ndash;privileged -p 2017:2017 -p 20170-20173:20170-20173 \u0026ndash;name v2raya mzz2017/v2raya\n","date":"2022-11-22T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/docker-run-on-docker/","title":"在docker中运行一个完整的docker并再套娃docker"},{"content":"alpine 不单适合作为docker的基础包，也挺适合在部分场景下，作为docker的宿主系统、原因无它，体积小维护简单。\n当然 alpine最大的问题 依旧是 mult的兼容性，所以说 alpine 只适合部分场景下。\n我这里 用kvm运行了一个单独的虚拟机只用来在不污染宿主机的情况下折腾docker，所以宿主机很适合用alpine\n安装docker ssh 到alpine\n1 2 apk add nano nano /etc/apk/repositories 把 community 的那行注释去掉\n1 2 3 apk add docker rc-update add docker boot service docker start v2ray nano /mnt/hdd/kvm-bak/alpine-docker/start_nogpu.sh\n编辑 -netdev 这行，添加需要端口 2017(web管理界面) 20170（sockes） 20171（http不分流） 20172（分流） 20173（备用）\n1 hostfwd=tcp::2017-:2017,hostfwd=tcp::20170-:20170,hostfwd=tcp::20171-:20171,hostfwd=tcp::20172-:20172,hostfwd=tcp::20173-:20173 1 2 3 docker run -d --restart=always --privileged \\ --name v2raya -p 2017:2017 -p 20170-20173:20170-20173 \\ mzz2017/v2raya 配置访问 ： http://10.0.0.8:2017 打开 透明代理 ip转发 端口分享\n阿里云盘 webdav 用 messense/aliyundriver-webdav 这个镜像吧 10k star，教程很多，也比较简单，主要是获取refreshToken 就好了\n1 2 3 4 5 docker run -d --name=aliyunpan --restart=always -p 8080:8080 \\ -e REFRESH_TOKEN=\u0026#39;your refresh token\u0026#39; \\ -e WEBDAV_AUTH_USER=admin \\ -e WEBDAV_AUTH_PASSWORD=admin \\ messense/aliyundrive-webdav nginx 主要用于处理https代理 1 2 3 4 5 6 7 8 9 docker run -d -p 8081:80 \\ -p 8443:443 \\ --name nginxweb \\ --link answer-server:answerserver \\ -v /usr/local/docker/nginx/html:/usr/share/nginx/html \\ -v /usr/local/docker/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \\ -v /usr/local/docker/nginx/conf/conf.d:/etc/nginx/conf.d \\ -v /usr/local/docker/nginx/logs:/var/log/nginx \\ nginx mysql redis 略，可以 docker 直接泡一个宝塔\n","date":"2022-11-20T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/alpine/docker-s/","title":"alpine 运行几个常用的docker"},{"content":"rustdesk 有几个坑，主要是文档敷衍。。。\n本文停止更新，迁移到：https://dev.leiyanhui.com/openwrt/rustdesk\n官网实例：\nsudo docker image pull rustdesk/rustdesk-server sudo docker run --name hbbs -p 21115:21115 -p 21116:21116 -p 21116:21116/udp -p 21118:21118 -v `pwd`:/root -td --net=host rustdesk/rustdesk-server hbbs -r \u0026lt;relay-server-ip[:port]\u0026gt; sudo docker run --name hbbr -p 21117:21117 -p 21119:21119 -v `pwd`:/root -td --net=host rustdesk/rustdesk-server hbbr 我这里是linux系统直接用hots模式稍微改动一下\n1 2 3 mkdir -p /root/docker/rustdesk cd /root/docker/rustdesk nano docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 version: \u0026#39;3\u0026#39; networks: rustdesk-net: external: false services: hbbs: container_name: hbbs ports: - 21115:21115 - 21116:21116 - 21116:21116/udp - 21118:21118 image: rustdesk/rustdesk-server:latest command: hbbs -r localhost:21117 -k _ # localhost改成 公网地址 volumes: - ./hbbs:/root networks: - rustdesk-net depends_on: - hbbr restart: unless-stopped hbbr: container_name: hbbr ports: - 21117:21117 - 21119:21119 image: rustdesk/rustdesk-server:latest command: hbbr -k _ volumes: - ./hbbr:/root networks: - rustdesk-net restart: unless-stopped 大概说一下 localhost:21117 可以用ip 或者域名 ，或者直接局域网的地址 都是可以的 -k _ 这个参数是禁止没有key的用户链接，也就是可以作为私有的中转服务器用。 但我测试发现，这个参数没啥乱用，不加key也可以连接上 volumes 这段也不是必须的\n启动/更新 1 docker-compose up -d key 文件在 /root/data/docker_data/rustdesk/hbbs/id_ed25519 这个里面\n更新key 或docker 更新key： 1 2 3 rm -rf /root/data/docker_data/rustdesk/hbbs/id_ed25519 docker restart hbbs docker restart hbbr 1 2 3 4 docker stop hbbs docker stop hbbr docker rm hbbs docker rm hbbr https://rustdesk.com/docs/zh-cn/self-host/install/#key\n客户端设置 id中级服务器，只输入id服务器就好了剩下的客户端会自动适配\nopenwrt docker运行 rustdesk 1 2 3 4 docker run --name hbbs -p 21115:21115 -p 21116:21116 -p 21116:21116/udp -p 21118:21118 \\ -v /root/rustdesk:/root -td --net=host rustdesk/rustdesk-server hbbs -r yanhuijia.3322.org:21117 docker run --name hbbr -p 21117:21117 -p 21119:21119 -v `pwd`:/root -td --net=host rustdesk/rustdesk-server hbbr 查看key cat /root/rustdesk/id_ed25519.pub\n","date":"2022-11-20T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/rustdesk-server/","title":"docker 运行 一个 rustdesk中转服务器"},{"content":" Linux下可以用davfs2 挂载webdav，但是 rclone 还支持别的网盘协议，并且跨平台，所以我选用rclone\n安装rclone 1 2 mkdir /mnt/aliyunpan sudo pacman -S rclone 配置 sudo rclone config 记得用sudo 因为 我们最后需要做自动挂载 这里用 Nextcloud WebDAV 的模式挂载 阿里云盘的webdav 名称为aliyunpan\n挂载 1 sudo rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime 测试完成后 把上面代码 写到开机自动启动脚本里面\n1 2 sleep 180 sudo rclone mount aliyunpan:/ /mnt/aliyunpan --cache-dir /tmp --allow-other --vfs-cache-mode writes --allow-non-empty --no-update-modtime \u0026amp; ","date":"2022-11-20T19:14:20+08:00","permalink":"https://dev.leiyanhui.com/webdav/rclone/","title":"rclone 挂载webdav"},{"content":" 最近一直被安利 wayland，在kvm下核显直通的arch中尝试一下，刚好要做一个核显直通的kvm-arch\n安装基础包 1 2 3 sudo pacman -S \\ sway alacritty waybar wofi \\ xorg-xwayland xorg-xlsclients qt5-wayland glfw-wayland sway 是 wayland下的i3\nalacritty 是简单终端\nwaybar 是一个简单好用的自定义状态栏\nWofi 一个纯 GTK（也就是 Wayland）的可定制应用程序启动器。\nqt5-wayland 和 glfw-wayland 分别为 QT5 和 GLFW 提供 Wayland 兼容 API\n输入法和字体 sudo pacman -S ttf-dejavu wqy-zenhei sudo pacman -S fcitx-im fcitx-configtool fcitx-googlepinyin 配置文件 Sway 应该是完全兼容i3的配置文件的，不过这里还是 从头配置一个\n1 2 3 4 cd ~/.config mkdir sway cd sway cp /etc/sway/config . 这里不需要 .xinitrc 了\n显卡驱动 我这里直通的核显\n1 sudo pacman -S linux-firmware xf86-video-intel seatd的处理 sudo pacman -S seatd sudo systemctl enable seatd sudo systemctl start seatd sudo usermod -aG seat 你的用户名 ##启动命令\n1 sway 其他启动问题 提示 PRIME import not supported 显卡不支持，多是虚拟机里面运行的时候导致的。 如果是kvm 换 virtio gpu 就ok 了\n提示 failed to create dri2 screen/dri failed to create screen ","date":"2022-11-19T20:52:20+08:00","permalink":"https://dev.leiyanhui.com/arch/i3-wayland/","title":"archlinux 下 i3w 基于 wayland的实现"},{"content":"随着 systemctl 的出现，古老的开机自启动脚本 rc.local 从 archlinux 上消失了。 以后再使用就需要用systemctl\n这里尝试自己弄一个my-local 注册到systemctl\n创建systemctl service 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #/usr/lib/systemd/system/my-local.service [Unit] Description=\u0026#34;自定义启动脚本\u0026#34; [Service] Type=forking ExecStart=/etc/my-local.sh start #在这里你可以看到开机执行脚本的位置 TimeoutSec=0 StandardInput=tty RemainAfterExit=yes SysVStartPriority=99 [Install] WantedBy=multi-user.target 编写启动脚本 /etc/my-local.sh 1 2 3 4 #!/bin/sh sh /home/xxx/mount.sh exit 0 配置开机自动启动 1 2 sudo chmod u+x /etc/my-local.sh sudo systemctl enable my-local.service 远程登陆自动执行的脚本 直接编辑 用户的 .bashrc 例如\n# # ~/.bashrc # # If not running interactively, don't do anything [[ $- != *i* ]] \u0026amp;\u0026amp; return alias ls='ls --color=auto' PS1='[\\u@\\h \\W]\\$ ' neofetch cat /home/yanhui/readme.md fish ","date":"2022-11-18T20:10:20+08:00","permalink":"https://dev.leiyanhui.com/arch/autostar/","title":"archlinux开机自动启动自定义脚本"},{"content":"本文停更新，新版查看 ：https://dev.leiyanhui.com/arch/xrdp-all/\n本文基于kvm下的arch 核显直通 或者 lxc容器\n基本安装参考 https://dev.leiyanhui.com/arch/base-install/\n如果是容器的arch，如果pacman 不能用，记得 先 pcaman-key --init \u0026amp;\u0026amp; pacman-key --populate archlinux 另外 更新到最新版本 防止部分更新的问题sudo pacman -Syyu\n核显驱动 1 sudo pacman -S xf86-video-intel 其他显卡自己看一下驱动包，如果是kvm下的直接用 virtio-gpu 可以实现3D加速的，可能不需要这个\n先安装i3w 简单配置 1 2 3 4 5 6 7 sudo pacman -S xorg-server #xorg sudo pacman -S xorg-xinit # 登录器 sudo pacman -S ttf-dejavu wqy-microhei # wqy-zenhei #字体 sudo pacman -S fish #我喜欢的shell sudo pacman -S flameshot #我喜欢的截图工具 sudo pacman -S i3-gaps i3status # i3 sudo pacman -S feh picom dmenu # 壁纸和半透明 启动器 输入法 sudo pacman -S fcitx-im fcitx-configtool fcitx-googlepinyin #输入法 1) fcitx 在i3 要 在终端 sudo 执行一次 fcitx-configtool\n复制xinit 我没用sdm，直接用startx 或 xrdp 所以这里配置xinit\n1 2 3 4 5 6 7 8 9 10 cp /etc/X11/xinit/xinitrc ~/.xinitrc #复制一个过来 nano ~/.xinitrc #注释掉最后的几行-添加一行 export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=\\@im=fcitx fcitx \u0026amp; #输入法 flameshot \u0026amp; #截图工具 #nm-applet \u0026amp; #wifi系统托盘 exec i3 还要来点常用工具 1 2 3 4 5 6 sudo pacman -S firefox unzip wget # 远程到win的工具 sudo pacman -S remmina sudo pacman -S libvncserver sudo pacman -S spice-gtk sudo pacman -S freerdp 弄一下壁纸 1 2 3 4 5 6 cd wget -c https://github.com/joyanhui/file.leiyanhui.com/archive/refs/heads/dwm-wallpaper.zip unzip dwm-wallpaper.zip mv file.leiyanhui.com-dwm-wallpaper bg rm -rf dwm-wallpaper.zip rm -rf bg/README.md i3w配置文件 i3w的配置过程 是个大工程，参考我的 https://github.com/joyanhui/i3w\n准备xrdp 安装yay https://dev.leiyanhui.com/c/archlinux-install-yay/ yay 的使用，需要可能需要 patch autoconf automake pkg-config akeroot、binutils等包 建议直接安装 base-devel pacman -S base-devel 挂个v2代理 nano proxy.sh #然后 sh proxy.sh一下 内容\nexport http_proxy=\u0026quot;10.0.0.1:20172\u0026quot; export https_proxy=\u0026quot;10.0.0.1:20172\u0026quot; 安装xrdp 1 2 3 4 5 6 7 #yay -S xorgxrdp pacman -S base-devel yay -S xrdp yay -S xorgxrdp-glamor sudo pacman -S pulseaudio yay -S pulseaudio-module-xrdp # 有可能需要 sudo pacman -S sbc sudo pacman -S xorg-xrdb Xwrapper 1 2 3 sudo nano /etc/X11/Xwrapper.config ------ allowed_users=anybody 1 2 sudo systemctl enable xrdp sudo systemctl start xrdp 其他可选 dmenu 换一下dmenu为支持变暗、修改透明度、下划线（可选）\n1 2 sudo pacman -Rns dmenu yay -S dmenu2 其他可选 终端工具 sudo pacman -S alacritty alacritty的配置文件为：~/.config/alacritty/alacritty.yml\n一些零碎的软件包 i3lock # 锁屏 nm-applet # wifi信号 网络状态 系统托盘图标 ","date":"2022-11-18T04:40:20+08:00","permalink":"https://dev.leiyanhui.com/arch/xinitc-xrdp/","title":"archlinux 下安装xrdp和xinitrc  i3w共存"},{"content":"openwrt 防火墙 自定义规则\n192.168.100.1 是光猫地址\n1 2 3 4 5 6 7 MODEMIP=192.168.100.1 MODEM_NET=`echo $MODEMIP | cut -d \u0026#34;.\u0026#34; -f 1-3` ROUTER_WAN_PORT_IP=192.168.100.2 WAN_PORT=eth0.2 ifconfig $WAN_PORT $ROUTER_WAN_PORT_IP netmask 255.255.255.0 broadcast $MODEM_NET.255 iptables -A forwarding_rule -d $MODEMIP -j ACCEPT iptables -t nat -A postrouting_rule -d $MODEMIP -o $WAN_PORT -j MASQUERADE ","date":"2022-11-16T14:20:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/forwardlightcat/","title":"openwrt转发光猫"},{"content":"先安装arch 手动安装的 https://dev.leiyanhui.com/arch/base-install/\n然后安装图形界面 我之前一直用dwm环境，但是dwm桌面有一个小问题就是 每次修改配置 都需要重新重新编译，并且重启一次x 略微麻烦，这次我开始更换使用i3w\n显卡驱动 先安装linux-firmware,搞定基本的驱动\npacman -S linux-firmware 当然是显卡驱动 lspci | grep VGA $ sudo pacman -S 驱动包\n通用----------------------------------xf86-video-vesa intel----------------------------------xf86-video-intel Geforce7±-------------------------xf86-video-nouveau Geforce6/7-------------------------xf86-video-304xx virtualbox 需要另外处理 修改显存到256M（好像最大就是256M） VBoxManage modifyvm \u0026quot;archlinux\u0026quot; --vram 256 安装virtualbox驱动 启动虚拟机，vbox中 菜单点设备，安装增强功能 或者手动挂载VBoxGuestAdditions.iso 到虚拟机，arch中挂载虚拟光驱\nsudo mount /dev/cdrom /mnt /mnt/VBoxLinuxADXXX.run #tab 自动补全 kvm下的处理 kvm模式跑的arch 可以用 virio-gpu 的显卡，内核支持3D，不需要另外驱动。宿主要驱动。\n安装xorg sudo pacman -S xorg-server 安装点字体 sudo pacman -S ttf-dejavu wqy-microhei 安装sddm 或者用startx，我选startx sudo pacman -S xorg-xinit 安装桌面环境，我用i3wm，并且选gaps分支 sudo pacman -S i3-gaps 安装终端 sudo pacman -S alacritty #也可以用 mate-terminal 或者st 默认是 i3-sensible-terminal 菜单工具 sudo pacman -S dmenu 状态栏 sudo pacman -S i3status 输入法 sudo pacman -S fcitx-im fcitx-configtool fcitx-googlepinyin fcitx-cloudpinyin #不怕折腾 用 fcitx-rime 极度流畅，但是不支持 fcitx-cloudpinyin 浏览器，我用火狐，edge要aur哈 sudo pacman -S firefox 截图 系统托盘图标 sudo pacman -S flameshot nm-connection-editor network-manager-applet 配置wifi sudo nmcli device wifi connect wifi名称 password wifi密码 蓝牙相关 sudo pacmsn -S usbutils bluez bluez-utils sudo systemctl enable bluetooth sudo systemctl start bluetooth bluetoothctl qq和微信 sudo pacman -S base-devel sudo pacman -S dunst libnotify # 通知消息 yay -S electronic-wechat-uos-bin icalingua++ yay的安装参考：https://dev.leiyanhui.com/c/archlinux-install-yay/\n2024-03-7 已经有原生版微信，虽然目前之支持uos和麒麟等系统，实际上其他系统也可以用。\n2022年12月07日 腾讯已经发布新版linux qq 文件管理器 sudo pacman -S thunar 文本编辑器 sudo pacman -S xde # gedit 配置startx cp /etc/X11/xinit/xinitrc ~/.xinitrc #复制一个过来 nano ~/.xinitrc #注释掉最后的几行-添加几行 export GTK_IM_MODULE=fcitx export QT_IM_MODULE=fcitx export XMODIFIERS=\\@im=fcitx fcitx \u0026amp; flameshot \u0026amp; #截图工具 nm-applet \u0026amp; #wifi系统托盘 exec i3 输入法的配置最好加到 ~/.pam_environment ibus的话参考 [https://dev.leiyanhui.com/arch/base-install/]](https://dev.leiyanhui.com/arch/base-install/])\n启动i3 startx 壁纸 sudo pacman -S feh mkdir ~/wallpaper \u0026amp;\u0026amp; cd ~/wallpaper sudo pacman -S unzip wget # 解压和下载工具 ## 从我自己的仓库下载一点壁纸 wget -c https://github.com/joyanhui/file.leiyanhui.com/archive/refs/heads/dwm-wallpaper.zip unzip dwm-wallpaper.zip mv file.leiyanhui.com-dwm-wallpaper/*.jpg . rm -rf dwm-wallpaper.zip file.leiyanhui.com-dwm-wallpaper 半透明 sudo pacman -S picom 配置i3 + feh nano ~/.config/i3/config 找到对应的行编辑，或者添加\n#壁纸 exec_always --no-startup-id feh --randomize --bg-fill ~/wallpaper #半透明 exec_always --no-startup-id picom # start a terminal 终端 #bindsym $mod+Return exec i3-sensible-terminal bindsym $mod+Return exec alacritty i3w的配置 这里不展开了，自己看wiki $mod+shift+r 重载i3 $mod+d 允许 dmenu $mod+回车 打开终端\n设置分辨率\nxrandr --output Virtual-1 --mode 1920x1080 命i3w令和配置文件整理 https://github.com/joyanhui/i3w\n配额remmina 1 2 3 4 sudo pacman -S remmina sudo pacman -S libvncserver sudo pacman -S spice-gtk sudo pacman -S freerdp 支持 spice vnc sftp ssh rdp\n其他后续 安装rustdesk https://dev.leiyanhui.com/arch/rustdesk/\n","date":"2022-11-15T15:23:20+08:00","permalink":"https://dev.leiyanhui.com/arch/startx/","title":"archlinux 图形界面i3安装 到 正常可以用的工作机，包括输入法 浏览器 微信 qq等"},{"content":"picom 配置文件 mkdir ~/.config/picom/ cp /etc/xdg/picom.conf ~/.config/picom/picom.conf nano ~/.config/picom/picom.conf 非活动窗口透明度 在 Transparency / Opacity 这段的后面 inactive-opacity\nalacritty 配置文件 1 2 mkdir ~/.config/alacritty cp /usr/share/doc/alacritty/example/alacritty.yml ~/.config/alacritty/alacritty.yml 字体大小 直接用 ctrl 和 - + 可以调整\n或者 修改配置文件的 size 这个\n更换字体 修改 family 推荐用 monospace\n背景透明 旧版本 background_opacity: 0.7 新版\nwindow: opacity: 0.7 xorg下无法使用fcix输入法的问题 网上资料多wayland下的，我没找到问题，同时发现 i3-sensible-terminal 也存在问题。暂时 用 terminator\nterminator sudo pacman -S terminator 简单配置 1 2 3 4 5 6 7 8 9 10 11 12 mkdir ~/.config/terminator/ nano ~/.config/terminator/config [profiles] [[default]] background_color = \u0026#34;#002b36\u0026#34; background_darkness = 0.7 background_image = None background_type = transparent foreground_color = \u0026#34;#e0f0f1\u0026#34; show_titlebar = False use_system_font = yes 状态栏替换为polybar sudo pacman -S polybar 手动执行一次 polybar\n创建polybar的 sh nano ~/.config/polybar/launch.sh ---------- #!/bin/bash # Terminate already running bar instances killall -q polybar # Wait until the processes have been shut down while pgrep -u $UID -x polybar \u0026gt;/dev/null; do sleep 1; done # Launch Polybar, using default config location ~/.config/polybar/config polybar example] ----------- sudo chmod +x ~/.config/polybar/launch.sh 编辑i3配置文件改为 polybar nano ~/.config/i3/config 添加一行\nexec_always --no-startup-id $HOME/.config/polybar/launch.sh 配置文件 mkdir ~/.config/polybar cp //etc/polybar/config.ini ~/.config/polybar/ nano ~/.config/polybar/config.ini\n另外开一个终端 ip link show 查看网卡，我这里是pve环境只有有线网卡\n其他 默认中文化，防止部分软件打开是英文版 1 2 3 4 5 6 7 ## ~/.xprofile export LANG=\u0026#34;zh_CN.UTF-8\u0026#34; export LC_ALL=\u0026#34;zh_CN.UTF-8\u0026#34; #export GDK_SCALE=2 #export GDK_DPI_SCALE=0.5 #export QT_AUTO_SCREEN_SCALE_FACTOR= i3w主题 pacman -S arc-icon-theme adwaita-icon-theme lxappearance # 然后运行 lxappearance 可以简单配置 # adwaita-icon-theme 这个包我不太喜欢 emoji字体 我选择apple的 yay -S ttf-apple-emoji\n","date":"2022-11-15T15:23:20+08:00","permalink":"https://dev.leiyanhui.com/arch/i3w-picom-alacritty/","title":"i3w下picom办透明 以及alacritty 的简单配置"},{"content":"thunar 是一个轻量，简单易用的文件管理器。 简单易用不代表不强大。\n下面以arch为例\n安装 pacman -S thunar usb自动挂载 以及 smb 等挂载 pacman -S gvfs pacman -S gvfs-smb sshfs 重新打开 thunar 就可以啦 smb://, ftp://, ssh://, sftp://, davs:// 比如\n挂载 alist的webdav davs://地址:50443/dav/ 挂载路由器 sftp://10.0.0.8/ ssh：// = sftp:// 挂群晖 smb://10.0.0.8/sharemnt/ 如果自动挂在 手机或者其他需要 gvfs-mtp 这个包 也可能需要gvfs-backends gvfs-fuse 这两个包。\n其实rclone统一管理可能更方便一些\n配置右键 打开shell 点 edit -\u0026gt; custom actions 编辑 exo-open --working-directory %f --launch TerminalEmulator 我是用的 terminator，这里删掉输入 terminator就好啦。 其他的终端自己看看urxvt:urxvt -e bash\n右键配置 codeserver 略过，用火狐http到coderserver 就好\n文件关联什么的。。 我暂时没需求\u0026hellip;\n","date":"2022-11-15T15:23:20+08:00","permalink":"https://dev.leiyanhui.com/arch/thunar-config/","title":"linux最好用的thunar 文件管理器的简单使用 和配置"},{"content":"如果是小磁盘安装，默认是关闭预留空间，并且compcat的\n释放预留空间 dism /Online /Set-ReservedStorageState /State:Disabled NTFS的compact命令 compact /compactOS:always 第三方工具 dism++ 10.x 开专家模式 ，可以compact lzx\n","date":"2022-11-15T00:00:00Z","permalink":"https://dev.leiyanhui.com/win/compat/","title":"win10 win11的磁盘压缩"},{"content":"基本情况 硬盘占用 在 3-5G之间，开启compact的话 可以3G多一些。\n开机内存占用 560M\n.net 打印机 smb 等 都可以单独打开安装\n没有 应用市场，保留了截图 cmd powershell 远程桌面客户端 画图工具 记事本 写字板 等\n多数游戏没问题\n打印机可用，打印机共享不确定\n作者相关 作者推特：https://twitter.com/NTDEV_\n视频介绍：\nhttps://www.youtube.com/watch?v=4cF3UW5W980\n下载地址\nx64 - https://www.mediafire.com/file/jxyc8n25s1asati/tiny10_21H2_x64_2209.iso/file\nx86 - https://www.mediafire.com/file/9ed820whh14lfcb/tiny10_21H2_x86_2209.iso/file\n","date":"2022-11-15T00:00:00Z","permalink":"https://dev.leiyanhui.com/win/tiny10/","title":"国外大神NTDEV 的win10精简版，硬盘占用3-5G，开机500M的内存占用"},{"content":"很不喜欢用swap分区，不够灵活，file方式性能略差，但差距 在使用中感觉不到。 所以我习惯性用 文件swap\n1 2 3 4 5 6 7 8 9 10 sudo dd if=/dev/zero of=/swapfile bs=1M count=1024 status=progress #必须设置，不然是一个严重安全漏洞 sudo chmod 600 /swapfile # 格式化和启用 sudo mkswap /swapfile sudo swapon /swapfile # 自动挂载，添加一行 sudo nano /etc/fstab ------- /swapfile none swap defaults 0 0 ","date":"2022-11-01T22:07:20+08:00","permalink":"https://dev.leiyanhui.com/arch/swapfile/","title":"Linux设置swapfile archlinux"},{"content":"安装 alsa sudo pacman -S alsa-utils\n另外可能需要把当前用户加到audio 用户组 sudo gpasswd -a leiyanhui audio 查看组情况 id leiyanhui ，然后重新登录一次ssh。否则远程登录的用户是没有权限播放声音的\n尝试解决 先搞定ALSA 工具 sudo pacman -S alsa-utils 运行 alsamixer 把MM的按m键取消静音\n测试声音 speaker-test -c 2 测试没问题 保存 alsactl store\n如果aplay -l找不到声卡，那先看看有没有在kvm的把声卡id绑定到 vfio\n你也可以 aplay test.wav 找一个音频文件播放测试\n查看声卡 sudo aplay -l\n**** List of PLAYBACK Hardware Devices **** card 0: PCH [HDA Intel PCH], device 0: ALC887-VD Analog [ALC887-VD Analog] Subdevices: 1/1 Subdevice #0: subdevice #0 card 0: PCH [HDA Intel PCH], device 1: ALC887-VD Digital [ALC887-VD Digital] Subdevices: 1/1 Subdevice #0: subdevice #0 card 0: PCH [HDA Intel PCH], device 3: HDMI 0 [HDMI] Subdevices: 1/1 Subdevice #0: subdevice #0 先解除静音 sudo alsamixer 用左右键找到 MM的 所有设备 点一下M 然后上下 调一下音量。\n我这里是用板载声卡，而非HDMI 所以，在板载上直接插入耳机 即可\n测试声音 speaker-test -c 2\n如果有开kvm 或者 检查一下 /etc/modprobe.d/下的配置文件，有没有拉黑声卡驱动， 比如 blacklist.conf blacklist snd_hda_intel 要去掉，然后 重新生成initramfs sudo mkinitcpio -P\n本文参考：https://wiki.archlinux.org/title/Advanced_Linux_Sound_Architecture_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)\n","date":"2022-11-01T18:50:20+08:00","permalink":"https://dev.leiyanhui.com/arch/arch-sound/","title":"archLinux 命令行下alsa声卡的配置的和使用"},{"content":"alpine的优势不用多说， 轻量小巧，还有diskless\nkvm 也是linux 最好的虚拟机软件了，性能应该也是最好的。\n最终目标 是搭建一个轻量的linux 里面只跑docker和kvm\n可以直接使用QEMU来运行虚拟机，但是管理命令较为复杂，所以通常我们都会安装libvirt来帮助管理。\nalpine安装 略 安装完成 大概需要40M左右硬盘空间\n准备安装 处理源 nano /etc/apk/repositories 去掉community的那行的注释\n安装所需要的软件包 kvm 需要的 kvm 还是最好用qemu来管理，还有libvirt 为了方便最好再安装一个 virt-install\napk add libvirt-daemon qemu-img qemu-system-x86_64 qemu-modules apk add virt-install rc-update add libvirtd rc-service libvirtd start virsh list 如果diskless 还需要\nlbu ci 现在大概需要327M 硬盘\n再安装docker apk add docker 现在 546.6M\n远程kvm所需要的 apk add dbus polkit virt-manager terminus-font rc-update add dbus ","date":"2022-10-31T14:31:20+08:00","permalink":"https://dev.leiyanhui.com/alpine/install-kvm-docker-sys/","title":"Alpine Linux运行KVM虚拟化 和 docker"},{"content":" 这里假定你已经安装好了pve，并且有一定的linux和macos基本基础，本文基于最新版pve7.2-11 其次，pve折腾一个流畅好用的黑苹果是一个非常漫长的过程，很多参数和配置，别人的教程都是仅供你参考，尤其是硬件直通，还是很复杂，你要有时间研究折腾 我的pve 是 用ventoy启动的硬盘vhd文件放在exfat分区 所以后面一部分内容可能和ventoy有关，如果你是直接安装在硬盘上的 可以跳过这部分内容\n我的硬盘只有两块 - 第一块硬盘 nvme ssd 512G - 硬盘安装了ventoy - 三个分区\n- 第一分区 是放ventoy的启动文件也可以作为第二efi分区 分区大小800M左右fat32格式 - 第二分区是ventoyefi 32m fat16格式 ， - 第三分区我主要数据分区也是ventoy的保留分区实际大小465G，pve系统的虚拟磁盘文件也放在这里 - 第二硬盘 1T 古董盘 存放一些备份文件\n准备文件 macos的恢复镜像Ventura-recovery.img OSX-KVM 已经支持在linux下直接获取Ventura的恢复镜像了 opencore镜像，基于kvm优化过的OpenCore OpenCore-v19.iso https://github.com/thenickdude/KVM-Opencore/releases/ 可选：集成virtio的winpe，方便改错ocpencore后进pe修复， https://blog.csdn.net/flydream3618/article/details/47357895 可选：win10安装盘iso 以及Windows的virtio-win.iso 驱动 https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/ 可选：显卡直通需要的vbois文件 我的是uhd630 你如果是同款核显可以直接用 https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-unraid-kvm vbios_gvt_uefi.rom 都放到 机械盘的 iso目录里面\npve的准备工作 pve 删除 local-lvm（非必须，但是你是新手的话，建议删掉） lvremove pve/data lvextend -l +100%FREE -r pve/root 在数据中心-存储中删除local-lvm分区，并编辑local，在内容一项中勾选所有可选项\n更新国内源码 mkdir /root/bakfile cp /etc/apt/sources.list //root/bakfile/sources.list nano /etc/apt/sources.list ## deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free ## deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free ## deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free ## deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free cp /etc/apt/sources.list.d/pve-enterprise.list /root/bakfile/pve-enterprise.list nano /etc/apt/sources.list.d/pve-enterprise.list https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bullseye pve-no-subscription cp /usr/share/perl5/PVE/APLInfo.pm /root/bakfile/APLInfo.pm sed -i 's|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g' /usr/share/perl5/PVE/APLInfo.pm systemctl restart pvedaemon.service apt-get update \u0026amp;\u0026amp; apt upgrade 处理一下kve的一点小问题 这步骤非必须的，如果你的macos虚拟机一直无限重启，就要在kve执行\necho \u0026quot;options kvm ignore_msrs=Y\u0026quot; \u0026gt;\u0026gt; /etc/modprobe.d/kvm.conf \u0026amp;\u0026amp; update-initramfs -k all -u 提示No /etc/kernel/proxmox-boot-uuids found, skipping ESP sync. 没关系的，添加此行后 pve主机控制台会提示 一个 类似kvm [1219]: ignored 的信息，你如果感觉烦躁 你可以 修改成options kvm ignore_msrs=Y report_ignored_msrs=N 忽略这个提示\n重启pve 准备主要文件 opencore和macos的恢复镜像 下载 kvm-opencore，目前最新版是v19 1 2 3 cd /var/lib/vz/template/iso/ wget https://ghproxy.com/https://github.com/thenickdude/KVM-Opencore/releases/download/v19/OpenCore-v19.iso.gz gzip -d OpenCore-v19.iso.gz 或者自定下载后上传到pve的iso里面\n注意这个虽然后缀是iso，但是实际上是raw格式的img文件，后面优化macos的时候我们还要对他进行一些处理。\n获取 macos 13 ventura 恢复镜像 使用容器搭建一个编译环境 虽然pve也是一个完整的debian系统，但是本着各负其责的简单管理原则，尽量避免对pve本身进行太多的修改。所以建议从容器里面搞。你只要按照下面步骤操作 必定可以。\n获取一个ct容器的ubuntu镜像 修改源从 pve后台： local\u0026gt;CT模板，获取一个Ubuntu18的镜像\n或者直接下载后上传到pve\ncd /var/lib/vz/template/cache/ wget https://mirrors.tuna.tsinghua.edu.cn/proxmox/images/system/ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz 创建一个ubuntu18的CT容器 容器名称 ubuntu18 密码 记住 这个密码是容器的root密码 模板选ubuntu18这个 磁盘大小16G cpu 给几个 无所谓给4个 内存swap都给1024 网络dhcp 其他不用设置 控制台 用root 和上面的密码登录 更新一下这个CT容器 mv /etc/apt/sources.list /etc/apt/sources.list-bak nano /etc/apt/sources.list 换国内源,清华源 应该是已经停止了对ubuntu18 的支持，建议调用 中科大的源，阿里的也可以用，但是阿里云的源从今年3月开始抽风，经常限速非常慢\n#中科大源 deb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse 更新系统\napt update apt upgrade 安装工具包 sudo apt install qemu-utils make git 克隆 https://github.com/thenickdude/OSX-KVM.git cd ~ #我这里用了ghproxy的代理加速，你也可以挂梯子 或者找别的代理加速 git clone https://ghproxy.com/https://github.com/thenickdude/OSX-KVM.git 编译获取恢复镜像 cd ~/OSX-KVM/scripts/ventura make Ventura-recovery.dmg # 实际下载地址：http://oscdn.apple.com/content/downloads/29/26/071-09012/dt7dmh4ttm1v5ze5989bid4gkovavkykjz/RecoveryImage/BaseSystem.dmg 根据提示，他最后一部 有执行 qemu-img convert BaseSystem.dmg -O raw Ventura-recovery.dmg 那么这个最终的dmg其实已经是raw文件了\n拉到pve里面 pve 执行\npct pull 101 /root/OSX-KVM/scripts/ventura/Ventura-recovery.dmg /var/lib/vz/template/iso/Ventura-recovery.img 这样我们就拿到了Ventura-recovery.img\nubuntu18的 容器可以关掉，也可以删除了\n创建虚拟机 主要参数\n操作系统 ： other iso文件：就是那个 OpenCore-vXX.iso 下一步 显卡：Vmware兼容 Qemu代理：勾选 机器：q35 BIOS：UEFI UEFI下面：预注册密钥 去掉,efi储存到local 总线：VirtIO 缓存：Write Back（不安全）格式qcow2 容量 28G+,建议32G+ CPU核心: 是2的次幂 2 4 8 16 我12核心的,只能给8 ，不可以12 10 18 这样的核心数，类型：penryn Numa启用 内存 4G以上，我这里 8192 网络模型：virtIO 创建了虚拟主机 102（macos），102 ，你的可能是别的\n在硬件里面，添加以恶搞cdrom到Ventura-recovery.img\n开机之前手动编辑虚拟机配置 有两个地方需要修改 /etc/pve/qemu-server/虚拟机编号.conf\n前面挂载的opencoreXX.iso 以及 Ventura-recovery.img 改为硬盘模式\n添加kvm的args 硬件欺骗\nnano /etc/pve/qemu-server/102.conf 修改两个cdrom 找到前面opencoreXX.iso 以及 Ventura-recovery.img 两行，两个 media=cdrom删掉改为 cache=unsafe\n修改args参数 在第二行添加\nargs: -device isa-applesmc,osk=\u0026quot;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026quot; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -cpu host,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc 如果你是amd的cpu 写法不同\nargs: -device isa-applesmc,osk=\u0026quot;这里得自己找~\u0026quot; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -cpu Penryn,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc,+pcid,+ssse3,+sse4.2,+popcnt,+avx,+avx2,+aes,+fma,+fma4,+bmi1,+bmi2,+xsave,+xsaveopt,check osk 是白苹果的一个类似设备编号的代码，同型号的macos都有相同这个代码，你可以网上搜索一下其他的代码\n参考我的 点这里查看\n安装基本的macos 只所以说是基本的macos，是因为macos非常依赖显卡，这里暂时只搞到一个可以启动的macos13 动画部分会比较卡，也不支持硬件加速。\n安装过程中，第一次 启动选 macos base，然后格式硬盘 卷标输入自定义一个，比如我就输入的kvm，后面会重启多次，有 macos installer的时候 选macos install，有前面输入的卷标kvm的时候选择kvm 其他安装过程和白苹果一样，并不复杂，进mac桌面后，自己修改成中文 开机自动倒计时进macos的优化 看后面章节 核显直通和蓝牙直通接力 等 请看 后面的进阶教程\nmacos的简单优化 安装完成后，在pve里面删除 挂载的 Ventura-recovery.img\n中文化和时区 OSX-KVM拉回来的镜像是英文版的，\n点左上角苹果，system setting，搜索 lang，添加中文 删除英文。提示重启，重启一下\n重启后，右上角键盘位置 设置输入法，通用设置 时间日期 时区 输入上海，回车。 提示重启的时候，建议不重启直接关机\n可选操作：打开macos的远程桌面 方便不使用网页控制他 系统偏好设置，搜索 共享，打开共享设置， 打开远程管理（vnc+ard） 和远程登陆（ssh）\n可选：点击 远程管理 后面那个叹号 ，再点 电脑设置 设置一个vnc 密码\n点网络 以太网 查看一下ip，然后用vnc客户端远程，后面的操作用vnc客户端来操作，会比pve 的vnc网页控制台好用一些。\nopencore的简单优化 准备工作1：把opencore 到硬盘 方便后续修改 为了方便，强烈建议你 吧opencore复制到一个独立的虚拟硬盘。而不是和其他人的教程一样dd到macos所在的硬盘\n关机，删除前面挂载的Ventura-recovery.img 恢复镜像，我们已经用不到他了 pve添加一个硬盘 大小0.5 就好我这里用0.5 用来做efi分区。 建议 ide挂载，格式raw（文件不大，兼容性比qcow2好也方便其他软件修改编辑）。\nmacos 开始会提示 不能识别按照提示初始化，选择这个500M左右的硬盘 点抹掉 卷标 OPENCORE，格式fat，分区格式主引导记录。\n格式完成后，再方达里面推出 这个OPENCORE卷，不然没法进行下一步 打开macos的终端 diskutil list查看所有硬盘，可以看到 500多M这个硬盘是对应的硬盘编号是disk1 分区是 disk1s1 另外有一个 150M左右的 是我们前面的opencore的iso。 对应 disk0s1。我们用dd命令把oencore 弄到这个500M的虚拟磁盘上\nsudo dd if=/dev/disk0s1 of=/dev/disk1s1 DD会同时把卷标OPENCORE 改成disk0s1的卷标EFI这个不影响。关机，在pve中删除前面的opencoer.iso ，选项里面 启动启动顺序 只选中这个 500M的 raw ，再次开机 就ok了\n如果要编辑efi，在磁盘工具里面直接装载 这个硬盘即可。\n准备工作2：安装使用opencore configurator 用macos自带的safari 打开本站，然后在本站搜索本页面标题打开下面的地址下载 opencore configurator，或者你也可以用你喜欢的其他工具 比如 ProperTree也不错\nhttps://mackie100projects.altervista.org/download-opencore-configurator/\nsafari下载后会自动解压。双击运行，然后打开 ，提示安全性问题，新版macos 在设置的隐私与安全性 地方，滚动到下面 找到 对应名称的 仍要打开，输入密码打开。\n如果你前面和我一样的操作，opencore的那个虚拟磁盘，会自动挂载到 /Volumos/OPENCORE ,否则请点击工具 挂载efi\n文件打开 找到 efi目录 oc 下的 config.plist, 就可以进行一些配置编辑工作了\nopencore开机打印信息 开机不再显示白苹果进度条，而且跑代码显示操作，方便后续处理 opencore configurator依次找到\nNVRAM ，里面一般有三个，找到一个带 bootarge的，在他原来的选项后面 输入 空格-v ,新版 直接右键 选择 -v 就可以了\nopencore开机倒计时启动 opencore configurator依次找到\nMISC-\u0026gt;Security-\u0026gt;AllowSetDefault 勾选 Misc-\u0026gt;Boot-\u0026gt;Timeout 倒计时 时间 输入 5 文件 保存\n重启以后，选择 卷标 按 ctrl+回车 以后启动就会自动选择这个了。\n注意 倒计时 不会显示时间的，到时间 就会自动启动了\n修改前的文件备份 https://github.com/joyanhui/file.leiyanhui.com/blob/main/pve-unraid-kvm/config-1.plist\n修改后的 https://github.com/joyanhui/file.leiyanhui.com/blob/main/pve-unraid-kvm/config.2.plist\n备份 准备做硬件直通 查看 ：https://dev.leiyanhui.com/pve/mac-bak/\n进阶 板载声卡 板载wifi直通 usb设备直通 最新版pve7.2-11 直接添加pci设备 就可以了，不需要额外处理\nusb3.0设备 如果使用端口模式直通的话，需要在同一个端口上分别插入usb3 和usb1-2的设备，分别添加两次，如果基于供应商设备的直通，好像不可热拔插。\n显卡直通，并再HDMI口输出显示 显卡直通先完成win10下的直通 在macos这个主机上，添加一个16G左右的硬盘，挂载一个win10安装盘，设置好引导顺序安装一个win10进去，\n然后查看文章 https://dev.leiyanhui.com/pve/win-gpu/ 先搞定win10下可以点亮屏幕\n其他处理中\n只有一个usb控制器的情况下的pcie蓝牙直通 简单的方案 就是把唯一的一个usb控制器给到虚拟机，在硬件里面 添加pice 直接选中这个usb，就把所有usb口直通进去了。。。那就导致 你鼠标键盘 U盘 都无法在pve下宿主机使用。 。另外一个方案 就是增加硬件 另外价格pcieusb控制器 ，其他方案 可能会复杂很多 我选择直接 直通进去 查看usb控制器\nlspci -nn | grep USB 00:14.0 USB controller [0c03]: Intel Corporation 100 Series/C230 Series Chipset Family USB 3.0 xHCI Controller [8086:a12f] (rev 31) 本文参考文章 https://www.nicksherlock.com/2021/10/installing-macos-12-monterey-on-proxmox-7/\n","date":"2022-10-29T08:29:20+08:00","permalink":"https://dev.leiyanhui.com/pve/install-macos-ventura/","title":"在pve上直接安装macos13 Ventura 初步优化并直通显卡 蓝牙 wifi 声卡给macos"},{"content":"两个插件 Unassigned Devices 和 Unassigned Devices Plus\n","date":"2022-10-29T05:57:20+08:00","permalink":"https://dev.leiyanhui.com/unraid/mount_hdd_usb/","title":"unraid 自动挂载usb或者其他硬盘，exfat hdd等"},{"content":"基本安装 用Macinabox 插件就可以，需要提前安装 user script插件，然后 等容器执行完成后，再去 插件\u0026gt;user script 执行一次 1_macinabox_helper\n就自动创建虚拟机了。\n常见问题 编辑虚拟机配置后 无法启动 因为unraid的图形模式编辑macos的kvm配置文件，是会丢失一些配置的。所以 所有修改，都要切换到xml视图手动编辑。\n我这里有一个默认的xml的配置 点这里查看\n无限重启，开机五国代码错误 多是 macinabox 创建的opencore太旧了，macos有更新。下载最新的替换掉就好。\nhttps://github.com/thenickdude/KVM-Opencore/releases 注意： 下载回来的文件是iso后缀，但是其实是raw格式的img文件，自己重命名一下\nmacos13.0 的问题 你可以 创建一个docker 跑一个linux系统，然后直接获取 macos13的恢复镜像，并使用最新的 kvm-opencore 引导\n最后，经过我测试，pve下安装好的macos 其实可以直接copy到unraid之类启动的\n","date":"2022-10-29T05:14:20+08:00","permalink":"https://dev.leiyanhui.com/unraid/macos-install/","title":"unraid 安装macos的注意事项"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 docker run -d --name=\u0026#39;macinabox\u0026#39; --net=\u0026#39;bridge\u0026#39; --privileged=true -e TZ=\u0026#34;America/Los_Angeles\u0026#34; -e HOST_OS=\u0026#34;Unraid\u0026#34; -e HOST_HOSTNAME=\u0026#34;Tower\u0026#34; -e HOST_CONTAINERNAME=\u0026#34;macinabox\u0026#34; -e \u0026#39;flavour\u0026#39;=\u0026#39;Monterey\u0026#39; -e \u0026#39;vminstall\u0026#39;=\u0026#39;Auto install\u0026#39; -e \u0026#39;vdisksize\u0026#39;=\u0026#39;100G\u0026#39; -e \u0026#39;vdisktype\u0026#39;=\u0026#39;raw\u0026#39; -e \u0026#39;opencore\u0026#39;=\u0026#39;stock\u0026#39; -e \u0026#39;replaceopencore\u0026#39;=\u0026#39;no\u0026#39; -e \u0026#39;overridenic\u0026#39;=\u0026#39;no\u0026#39; -e \u0026#39;VMIMAGES\u0026#39;=\u0026#39;/mnt/user/domains/\u0026#39; -e \u0026#39;ISOIMAGES\u0026#39;=\u0026#39;/mnt/user/isos/\u0026#39; -e \u0026#39;injectfixxml\u0026#39;=\u0026#39;yes\u0026#39; -l net.unraid.docker.managed=dockerman -l net.unraid.docker.icon=\u0026#39;https://raw.githubusercontent.com/SpaceinvaderOne/Docker-Templates-Unraid/master/spaceinvaderone/docker_icons/Macinabox.png\u0026#39; -v \u0026#39;/mnt/user/domains/\u0026#39;:\u0026#39;/domains\u0026#39;:\u0026#39;rw\u0026#39; -v \u0026#39;/mnt/user/isos/\u0026#39;:\u0026#39;/isos\u0026#39;:\u0026#39;rw\u0026#39; -v \u0026#39;/mnt/user/appdata/macinabox\u0026#39;:\u0026#39;/config\u0026#39;:\u0026#39;rw\u0026#39; -v \u0026#39;/mnt/user/system/custom_ovmf/\u0026#39;:\u0026#39;/customovmf/\u0026#39;:\u0026#39;rw\u0026#39; -v \u0026#39;/boot/config/plugins/user.scripts/scripts\u0026#39;:\u0026#39;/userscripts\u0026#39;:\u0026#39;rw\u0026#39; \u0026#39;spaceinvaderone/macinabox\u0026#39; 在运行之前，最好先安装 user script 以及 vm_custom_icons 这两个插件\n创建的虚拟机 xml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 \u0026lt;?xml version=\u0026#39;1.0\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;domain type=\u0026#39;kvm\u0026#39; xmlns:qemu=\u0026#39;http://libvirt.org/schemas/domain/qemu/1.0\u0026#39;\u0026gt; \u0026lt;name\u0026gt;Macinabox Monterey\u0026lt;/name\u0026gt; \u0026lt;uuid\u0026gt;2ee88299-ee14-49ea-8510-608ab36bb911\u0026lt;/uuid\u0026gt; \u0026lt;description\u0026gt;MacOS Monterey\u0026lt;/description\u0026gt; \u0026lt;metadata\u0026gt; \u0026lt;vmtemplate xmlns=\u0026#34;unraid\u0026#34; name=\u0026#34;Windows 10\u0026#34; icon=\u0026#34;Monterey.png\u0026#34; os=\u0026#34;osx\u0026#34;/\u0026gt; \u0026lt;/metadata\u0026gt; \u0026lt;memory unit=\u0026#39;KiB\u0026#39;\u0026gt;4194304\u0026lt;/memory\u0026gt; \u0026lt;currentMemory unit=\u0026#39;KiB\u0026#39;\u0026gt;4194304\u0026lt;/currentMemory\u0026gt; \u0026lt;memoryBacking\u0026gt; \u0026lt;nosharepages/\u0026gt; \u0026lt;/memoryBacking\u0026gt; \u0026lt;vcpu placement=\u0026#39;static\u0026#39;\u0026gt;2\u0026lt;/vcpu\u0026gt; \u0026lt;cputune\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;0\u0026#39; cpuset=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;1\u0026#39; cpuset=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/cputune\u0026gt; \u0026lt;os\u0026gt; \u0026lt;type arch=\u0026#39;x86_64\u0026#39; machine=\u0026#39;pc-q35-4.2\u0026#39;\u0026gt;hvm\u0026lt;/type\u0026gt; \u0026lt;loader readonly=\u0026#39;yes\u0026#39; type=\u0026#39;pflash\u0026#39;\u0026gt;/mnt/user/system/custom_ovmf/Macinabox_CODE-pure-efi.fd\u0026lt;/loader\u0026gt; \u0026lt;nvram\u0026gt;/mnt/user/system/custom_ovmf/Macinabox_VARS-pure-efi.fd\u0026lt;/nvram\u0026gt; \u0026lt;/os\u0026gt; \u0026lt;features\u0026gt; \u0026lt;acpi/\u0026gt; \u0026lt;apic/\u0026gt; \u0026lt;/features\u0026gt; \u0026lt;cpu mode=\u0026#39;host-passthrough\u0026#39; check=\u0026#39;none\u0026#39; migratable=\u0026#39;on\u0026#39;\u0026gt; \u0026lt;topology sockets=\u0026#39;1\u0026#39; dies=\u0026#39;1\u0026#39; cores=\u0026#39;2\u0026#39; threads=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/cpu\u0026gt; \u0026lt;clock offset=\u0026#39;utc\u0026#39;\u0026gt; \u0026lt;timer name=\u0026#39;rtc\u0026#39; tickpolicy=\u0026#39;catchup\u0026#39;/\u0026gt; \u0026lt;timer name=\u0026#39;pit\u0026#39; tickpolicy=\u0026#39;delay\u0026#39;/\u0026gt; \u0026lt;timer name=\u0026#39;hpet\u0026#39; present=\u0026#39;no\u0026#39;/\u0026gt; \u0026lt;/clock\u0026gt; \u0026lt;on_poweroff\u0026gt;destroy\u0026lt;/on_poweroff\u0026gt; \u0026lt;on_reboot\u0026gt;restart\u0026lt;/on_reboot\u0026gt; \u0026lt;on_crash\u0026gt;restart\u0026lt;/on_crash\u0026gt; \u0026lt;devices\u0026gt; \u0026lt;emulator\u0026gt;/usr/local/sbin/qemu\u0026lt;/emulator\u0026gt; \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39; cache=\u0026#39;writeback\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/mnt/user/domains/Macinabox Monterey/Monterey-opencore.img\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hdc\u0026#39; bus=\u0026#39;sata\u0026#39;/\u0026gt; \u0026lt;boot order=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;2\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39; cache=\u0026#39;writeback\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/mnt/user/isos/Monterey-install.img\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hdd\u0026#39; bus=\u0026#39;sata\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;3\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39; cache=\u0026#39;writeback\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/mnt/user/domains/Macinabox Monterey/macos_disk.img\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hde\u0026#39; bus=\u0026#39;virtio\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x03\u0026#39; slot=\u0026#39;0x00\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-ehci1\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x7\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci1\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x0\u0026#39; multifunction=\u0026#39;on\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci2\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;2\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x1\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci3\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;4\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x2\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;sata\u0026#39; index=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x1f\u0026#39; function=\u0026#39;0x2\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;pcie-root\u0026#39;/\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;1\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;1\u0026#39; port=\u0026#39;0x10\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x0\u0026#39; multifunction=\u0026#39;on\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;2\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;2\u0026#39; port=\u0026#39;0x11\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x1\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;3\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;3\u0026#39; port=\u0026#39;0x12\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x2\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;4\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;4\u0026#39; port=\u0026#39;0x13\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x3\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;virtio-serial\u0026#39; index=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x02\u0026#39; slot=\u0026#39;0x00\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;interface type=\u0026#39;bridge\u0026#39;\u0026gt; \u0026lt;mac address=\u0026#39;52:54:00:56:c1:7b\u0026#39;/\u0026gt; \u0026lt;source bridge=\u0026#39;br0\u0026#39;/\u0026gt; \u0026lt;model type=\u0026#39;virtio\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x01\u0026#39; slot=\u0026#39;0x00\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/interface\u0026gt; \u0026lt;serial type=\u0026#39;pty\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;isa-serial\u0026#39; port=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;isa-serial\u0026#39;/\u0026gt; \u0026lt;/target\u0026gt; \u0026lt;/serial\u0026gt; \u0026lt;console type=\u0026#39;pty\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;serial\u0026#39; port=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;/console\u0026gt; \u0026lt;channel type=\u0026#39;unix\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;virtio\u0026#39; name=\u0026#39;org.qemu.guest_agent.0\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;virtio-serial\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; port=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/channel\u0026gt; \u0026lt;input type=\u0026#39;tablet\u0026#39; bus=\u0026#39;usb\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;usb\u0026#39; bus=\u0026#39;0\u0026#39; port=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/input\u0026gt; \u0026lt;input type=\u0026#39;mouse\u0026#39; bus=\u0026#39;ps2\u0026#39;/\u0026gt; \u0026lt;input type=\u0026#39;keyboard\u0026#39; bus=\u0026#39;ps2\u0026#39;/\u0026gt; \u0026lt;graphics type=\u0026#39;vnc\u0026#39; port=\u0026#39;-1\u0026#39; autoport=\u0026#39;yes\u0026#39; websocket=\u0026#39;-1\u0026#39; listen=\u0026#39;0.0.0.0\u0026#39; keymap=\u0026#39;en-us\u0026#39;\u0026gt; \u0026lt;listen type=\u0026#39;address\u0026#39; address=\u0026#39;0.0.0.0\u0026#39;/\u0026gt; \u0026lt;/graphics\u0026gt; \u0026lt;audio id=\u0026#39;1\u0026#39; type=\u0026#39;none\u0026#39;/\u0026gt; \u0026lt;video\u0026gt; \u0026lt;model type=\u0026#39;qxl\u0026#39; ram=\u0026#39;65536\u0026#39; vram=\u0026#39;65536\u0026#39; vgamem=\u0026#39;16384\u0026#39; heads=\u0026#39;1\u0026#39; primary=\u0026#39;yes\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x01\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/video\u0026gt; \u0026lt;memballoon model=\u0026#39;none\u0026#39;/\u0026gt; \u0026lt;/devices\u0026gt; \u0026lt;qemu:commandline\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-usb\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-device\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;usb-kbd,bus=usb-bus.0\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-device\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;isa-applesmc,osk=ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-smbios\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;type=2\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-cpu\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;Penryn,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc,+pcid,+ssse3,+sse4.2,+popcnt,+avx,+avx2,+aes,+fma,+fma4,+bmi1,+bmi2,+xsave,+xsaveopt,+rdrand,check\u0026#39;/\u0026gt; \u0026lt;/qemu:commandline\u0026gt; \u0026lt;/domain\u0026gt; 修改 内存 oc 还有系统路径 并叠加一个win 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 \u0026lt;?xml version=\u0026#39;1.0\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;domain type=\u0026#39;kvm\u0026#39; xmlns:qemu=\u0026#39;http://libvirt.org/schemas/domain/qemu/1.0\u0026#39;\u0026gt; \u0026lt;name\u0026gt;macos\u0026lt;/name\u0026gt; \u0026lt;uuid\u0026gt;2ee88299-ee14-49ea-8510-608ab36bb912\u0026lt;/uuid\u0026gt; \u0026lt;description\u0026gt;MacOS Monterey\u0026lt;/description\u0026gt; \u0026lt;metadata\u0026gt; \u0026lt;vmtemplate xmlns=\u0026#34;unraid\u0026#34; name=\u0026#34;Windows 10\u0026#34; icon=\u0026#34;Monterey.png\u0026#34; os=\u0026#34;osx\u0026#34;/\u0026gt; \u0026lt;/metadata\u0026gt; \u0026lt;memory unit=\u0026#39;KiB\u0026#39;\u0026gt;8388608\u0026lt;/memory\u0026gt; \u0026lt;currentMemory unit=\u0026#39;KiB\u0026#39;\u0026gt;8388608\u0026lt;/currentMemory\u0026gt; \u0026lt;memoryBacking\u0026gt; \u0026lt;nosharepages/\u0026gt; \u0026lt;/memoryBacking\u0026gt; \u0026lt;vcpu placement=\u0026#39;static\u0026#39;\u0026gt;2\u0026lt;/vcpu\u0026gt; \u0026lt;cputune\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;0\u0026#39; cpuset=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;1\u0026#39; cpuset=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/cputune\u0026gt; \u0026lt;os\u0026gt; \u0026lt;type arch=\u0026#39;x86_64\u0026#39; machine=\u0026#39;pc-q35-4.2\u0026#39;\u0026gt;hvm\u0026lt;/type\u0026gt; \u0026lt;loader readonly=\u0026#39;yes\u0026#39; type=\u0026#39;pflash\u0026#39;\u0026gt;/mnt/user/system/custom_ovmf/Macinabox_CODE-pure-efi.fd\u0026lt;/loader\u0026gt; \u0026lt;nvram\u0026gt;/mnt/user/system/custom_ovmf/Macinabox_VARS-pure-efi.fd\u0026lt;/nvram\u0026gt; \u0026lt;/os\u0026gt; \u0026lt;features\u0026gt; \u0026lt;acpi/\u0026gt; \u0026lt;apic/\u0026gt; \u0026lt;/features\u0026gt; \u0026lt;cpu mode=\u0026#39;host-passthrough\u0026#39; check=\u0026#39;none\u0026#39; migratable=\u0026#39;on\u0026#39;\u0026gt; \u0026lt;topology sockets=\u0026#39;1\u0026#39; dies=\u0026#39;1\u0026#39; cores=\u0026#39;2\u0026#39; threads=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/cpu\u0026gt; \u0026lt;clock offset=\u0026#39;utc\u0026#39;\u0026gt; \u0026lt;timer name=\u0026#39;rtc\u0026#39; tickpolicy=\u0026#39;catchup\u0026#39;/\u0026gt; \u0026lt;timer name=\u0026#39;pit\u0026#39; tickpolicy=\u0026#39;delay\u0026#39;/\u0026gt; \u0026lt;timer name=\u0026#39;hpet\u0026#39; present=\u0026#39;no\u0026#39;/\u0026gt; \u0026lt;/clock\u0026gt; \u0026lt;on_poweroff\u0026gt;destroy\u0026lt;/on_poweroff\u0026gt; \u0026lt;on_reboot\u0026gt;restart\u0026lt;/on_reboot\u0026gt; \u0026lt;on_crash\u0026gt;restart\u0026lt;/on_crash\u0026gt; \u0026lt;devices\u0026gt; \u0026lt;emulator\u0026gt;/usr/local/sbin/qemu\u0026lt;/emulator\u0026gt; \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;qcow2\u0026#39; cache=\u0026#39;writeback\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/mnt/user/domains/mac/opencore.qcow2\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hdc\u0026#39; bus=\u0026#39;sata\u0026#39;/\u0026gt; \u0026lt;boot order=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;2\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;qcow2\u0026#39; cache=\u0026#39;writeback\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/mnt/user/domains/mac/macos.qcow2\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hdd\u0026#39; bus=\u0026#39;virtio\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x03\u0026#39; slot=\u0026#39;0x00\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;qcow2\u0026#39; cache=\u0026#39;writeback\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/mnt/user/domains/mac/win.qcow2\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hde\u0026#39; bus=\u0026#39;virtio\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x04\u0026#39; slot=\u0026#39;0x00\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-ehci1\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x7\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci1\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x0\u0026#39; multifunction=\u0026#39;on\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci2\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;2\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x1\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci3\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;4\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x2\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;sata\u0026#39; index=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x1f\u0026#39; function=\u0026#39;0x2\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;pcie-root\u0026#39;/\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;1\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;1\u0026#39; port=\u0026#39;0x10\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x0\u0026#39; multifunction=\u0026#39;on\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;2\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;2\u0026#39; port=\u0026#39;0x11\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x1\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;3\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;3\u0026#39; port=\u0026#39;0x12\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x2\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;4\u0026#39; model=\u0026#39;pcie-root-port\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;pcie-root-port\u0026#39;/\u0026gt; \u0026lt;target chassis=\u0026#39;4\u0026#39; port=\u0026#39;0x13\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x3\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;virtio-serial\u0026#39; index=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x02\u0026#39; slot=\u0026#39;0x00\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;interface type=\u0026#39;bridge\u0026#39;\u0026gt; \u0026lt;mac address=\u0026#39;52:54:00:56:c1:7b\u0026#39;/\u0026gt; \u0026lt;source bridge=\u0026#39;br0\u0026#39;/\u0026gt; \u0026lt;model type=\u0026#39;virtio\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x01\u0026#39; slot=\u0026#39;0x00\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/interface\u0026gt; \u0026lt;serial type=\u0026#39;pty\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;isa-serial\u0026#39; port=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;isa-serial\u0026#39;/\u0026gt; \u0026lt;/target\u0026gt; \u0026lt;/serial\u0026gt; \u0026lt;console type=\u0026#39;pty\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;serial\u0026#39; port=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;/console\u0026gt; \u0026lt;channel type=\u0026#39;unix\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;virtio\u0026#39; name=\u0026#39;org.qemu.guest_agent.0\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;virtio-serial\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; port=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/channel\u0026gt; \u0026lt;input type=\u0026#39;tablet\u0026#39; bus=\u0026#39;usb\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;usb\u0026#39; bus=\u0026#39;0\u0026#39; port=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/input\u0026gt; \u0026lt;input type=\u0026#39;mouse\u0026#39; bus=\u0026#39;ps2\u0026#39;/\u0026gt; \u0026lt;input type=\u0026#39;keyboard\u0026#39; bus=\u0026#39;ps2\u0026#39;/\u0026gt; \u0026lt;graphics type=\u0026#39;vnc\u0026#39; port=\u0026#39;-1\u0026#39; autoport=\u0026#39;yes\u0026#39; websocket=\u0026#39;-1\u0026#39; listen=\u0026#39;0.0.0.0\u0026#39; keymap=\u0026#39;en-us\u0026#39;\u0026gt; \u0026lt;listen type=\u0026#39;address\u0026#39; address=\u0026#39;0.0.0.0\u0026#39;/\u0026gt; \u0026lt;/graphics\u0026gt; \u0026lt;audio id=\u0026#39;1\u0026#39; type=\u0026#39;none\u0026#39;/\u0026gt; \u0026lt;video\u0026gt; \u0026lt;model type=\u0026#39;qxl\u0026#39; ram=\u0026#39;65536\u0026#39; vram=\u0026#39;65536\u0026#39; vgamem=\u0026#39;16384\u0026#39; heads=\u0026#39;1\u0026#39; primary=\u0026#39;yes\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x01\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/video\u0026gt; \u0026lt;memballoon model=\u0026#39;none\u0026#39;/\u0026gt; \u0026lt;/devices\u0026gt; \u0026lt;qemu:commandline\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-usb\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-device\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;usb-kbd,bus=usb-bus.0\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-device\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;isa-applesmc,osk=ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-smbios\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;type=2\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;-cpu\u0026#39;/\u0026gt; \u0026lt;qemu:arg value=\u0026#39;Penryn,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc,+pcid,+ssse3,+sse4.2,+popcnt,+avx,+avx2,+aes,+fma,+fma4,+bmi1,+bmi2,+xsave,+xsaveopt,+rdrand,check\u0026#39;/\u0026gt; \u0026lt;/qemu:commandline\u0026gt; \u0026lt;/domain\u0026gt; ","date":"2022-10-29T05:14:20+08:00","permalink":"https://dev.leiyanhui.com/unraid/macinabox/","title":"unraid上macinabox插件自动创建docker命令"},{"content":"网上教程多数是基于clash的，颇为繁琐 并且还需要另外一个 yacd配合使用\n直接使用这个方法更简单一些\nv2rayA是V2Ray的一个Web客户端，前端使用Vue.js构建，后端使用Golang构建。\nclash也基于go的，功能更强大一些。\n但是 我只是需要github 还有google 偶尔看看视频。。。v2a真的 足够足够用了而且简单集成度高\n主要是解决unraid 商店打不开的问题，先运行一个docker\n1 2 3 4 5 6 7 docker run -d --restart=always --privileged \\ --network=host \\ --name v2raya \\ -v /etc/resolv.conf:/etc/resolv.conf \\ -v /mnt/user/appdata/v2raya:/etc/v2raya \\ -v /mnt/user/appdata/v2raya/modules:/lib/modules \\ mzz2017/v2raya 可以简化一下\n1 2 3 4 5 docker run -d --restart=always --privileged \\ --network=host \\ --name v2raya \\ -v /etc/resolv.conf:/etc/resolv.conf \\ mzz2017/v2raya http://你的ip:2017 打开配置页面，\nwin和macos下的docker好像不支持 host模式，自己做端口映射哦。 我是linux。不存在这个问题\n依次：\n导入订阅 点设置 里面 更新一下 GFWList 透明代理 GFWList\n左上角 启动\n你也可以开启端口转发 这样局域网内其他机器 都可以使用他做代理了。\n还有订阅是可以自动更新的，设置里面都有\nunraid 还需要在面板里面 添加一下这个容器的自动启动\n再处理一下一下商店的单独代理\n1 2 3 4 5 6 7 cd /boot/config/plugins/community.applications/ tee proxy.cfg \u0026lt;\u0026lt;-\u0026#39;EOF\u0026#39; port=20172 tunnel=1 proxy=http://10.0.0.8 EOF 你可能还需要处理一下 /boot/config/go 以便开机就能走代理\nhttp_proxy=http://10.0.0.8:20172 https_proxy=http://10.0.0.8:20172 /usr/local/sbin/emhttp \u0026amp; echo \u0026quot;export http_proxy=\u0026quot;http://10.0.0.8:20172\u0026quot;\u0026quot; \u0026gt;\u0026gt; /root/.bash_profile echo \u0026quot;export https_proxy=\u0026quot;http://10.0.0.8:20172\u0026quot;\u0026quot; \u0026gt;\u0026gt; /root/.bash_profile 可以再增加几行，更新github的hosts，以后 sh /github.sh 就可可以更新了\necho \u0026quot;cd /etc \u0026amp;\u0026amp; cp hosts hosts-bak \u0026amp;\u0026amp; rm -rf hosts\u0026quot; \u0026gt; /github.sh echo \u0026quot;wget -c https://gitlab.com/ineo6/hosts/-/raw/master/next-hosts\u0026quot; \u0026gt;\u0026gt; /github.sh echo \u0026quot;mv next-hosts hosts\u0026quot;\u0026gt;\u0026gt;/root/github.sh 火狐的话设置 http 和 https http://10.0.0.8 20172 SOCKS http://10.0.0.8 20170\n默认端口：\n2017: v2rayA后端端口\n20170: SOCKS协议\n20171: HTTP协议\n20172: 带分流规则的HTTP协议\n其他端口：\n32345: tproxy，透明代理所需\n32346: 插件协议端口，如trojan、ssr和pingtunnel\n20171 和 20172 这个两个端口 自己选择了，如果你要隐私向全部走代理 那就20171 如果要速度 只gfw的网站走代理，那就20172\n","date":"2022-10-29T04:37:20+08:00","permalink":"https://dev.leiyanhui.com/linux/docker-proxy/","title":"unraid docker最简单的搭建代理方法"},{"content":"先说适合我自己的all in one方案 首先，不建议主路由 挂这里。主路由还是独立出来，不然动则全家 全公司不能上网，被喷死\n所以 我路由器 还是独立的， 刷的 openwrt，但是因为flash容量的原因，无法在 路由上直接挂代理。 代理还是放到了all in one 主机的docker里面高\n功能的需求上\n需要 nas，做监控的储存，smb协议\n外网和局域网的文件共享，我才用webdav。我自己有用golang写了一个简单的跨平台的webdavgo 在这里\n外网访问的问题，因为我有公网ip所以，，这个不是问题。。。你如果没有 随便找一个穿透方案就好了。\n几种主流的系统对比 黑群晖 优点：简单易用 缺点： 毕竟是破解。。。不推荐 内核老 深度定制的linux 不适合折腾 挑网卡 不过可以打补丁 特殊硬件直通 相对困难很多 esxi 优点：简单易用，据说多数 缺点 并非linux docker 只能虚拟机跑 挑网卡，挑硬件 很多个人电脑网卡无法用，额外添加驱动时间成本很高 商业化软件，个人免费 unraid 优点：不占用硬盘，U盘使用，系统备份什么的都很方便 缺点： 必须依赖梯子 改hosts方案不稳定 收费，并不便宜 而且绑定U盘的 一年只可以换一次 破解版 有后门可能，有一些有挖矿代码 特殊情况的下在的直通 兼容性很差 web界面有时候抽风 很卡 反应迟钝 挑U盘，部分U盘没有唯一uuid的，没法用 虽然不怎么影响U盘寿命，但是很多人还是坏过U盘 pve 优点 基于debian11 可以玩性强，也可以 在debian上附加安装，并非深度定制的debian 基本不挑硬件 缺点 比上述所有系统都要复杂一点，需要有一点linux基础才可以玩的开心 docker 需要另外安装，或者lxc里面跑，也不算缺点 主要看你docker用多少 自己安装linux + kvm 优点 灵活可控 缺点 参考pve 需要你linux技术和kvm了解程度高一些 我的选择： 目前 ventoy 硬盘安装，pve 安装到vhd启动\n优点 可以和unraid一样方便备份 灵活 缺点 除了pve本身的缺点没法别的 未来 有时间 会单独弄一个 arch 或者 ubuntu 独立安装kvm\n","date":"2022-10-28T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/new/all-in-one-select/","title":"all in one 可以满足多数人的方案和选择 个人看法"},{"content":" 之前在kvm下折腾 显卡一直 黑屏，找人帮忙处理 也没搞定。所以 干脆直接换到unraid\n下面内容基于 unraid6.11.1 6.9以后的版本基本一样\n因为我没搞定q35的核显直通，而黑苹果最好还是q35，所以本文仅限Windows的efi模式的直通。\nmacos的直通 建议还是用pve 请查看kve安装macos13和设备直通\npve 并非很多半吊子大神说的 debian的深度定制。pve其实只是几个附加包而已。 同时pve 因基于debian11 ，而debian11 是支持 ventoy的虚拟磁盘启动的。你完全可以 把pve安装到 一个16-20G大小的vhd文件里面。然后用物理机启动。如果你要用虚拟机或者smb之类的 软连接处理就好 你甚至可以无痛更换到pve，只需要一个 FAT32/exFAT/NTFS/UDF/XFS/Ext2(3)(4) 分区，能放下pve的vhd文件就好，然后U盘启动ventoy就好（不挑U盘 sd卡也可以，不会有任何损害U盘的可能） 你如果数据备份好了，可以直接硬盘安装 ventoy ，比如500G硬盘，你可以只给ventoy 几十 几百M，然后剩下保留容量格式化到exfat 全平台都可以访问你数据。 pve没有自带docker的问题，其实很容易解决，直接 apt install docker 或者 lxc运行一个ubuntu，然后里面再跑docker 就好了，性能也没啥损耗 unraid 对梯子依赖，挑U盘\n1、环境准备 unraid 挂梯子，方便使用市场 （也可以处理，后面可以全部基于手动处理） unraid 里面安装一个windows10 （也可以用linuxlive盘替代，我图方便还是利用了现有的win，） efi模式的win10 也就是 ovmf i44fx-7.1, Hyper-V: Yes 这个win10 里面 要装好 win10里面需要安装virtio的驱动 ，并且接口除了虚拟cdrom之外都是 virtio 最好开启远程桌面 关闭休眠，防止后面屏幕没输出的时候 调试检查 2、获取显卡的vbois 因为黑macos必须要efi启动，所以需要拿到vbois文件 没有vbois的话就是黑屏状态，旧版本网上有教程可以不用vbois，新版没研究。\n这个网站有部分显卡vbois下载 https://www.techpowerup.com/vgabios/\n但是这个网站只有部分独显的vbois 没有核显的。核显的话需要你自己来提取修改。思路：做一个linux物理机系统 或者 livecd，然后git 自己编译，过程复杂\nvbois的提取相对比较复杂，我这里直接用别人已经已经提取好的\n经过我测试 是没问题的，没有积分或者账号的话，从我这里下载 https://github.com/joyanhui/file.leiyanhui.com/blob/main/pve-unraid-kvm/vbios_gvt_uefi.rom\n原始地址： https://download.csdn.net/download/engineerlzk/82233022\n放到 \\TOWER\\isos\n3、在win10下搞一下部分硬件的直通 unraid 设置 虚拟机\nPCIe ACS 覆盖:选择 禁用\nVFIO 允许不安全的中断:选择 是\n工具-系统设备 选择需要屏蔽的硬件 然后点击 引导时对VFIO选择绑定\n我这里屏蔽掉了\n[8086:3e9b] 00:02.0 VGA compatible controller: Intel Corporation CoffeeLake-H GT2 [UHD Graphics 630] [14e4:4353] 02:00.0 Network controller: Broadcom Inc. and subsidiaries BCM43224 802.11a/b/g/n (rev 01) [8086:a170] 00:1f.3 Audio device: Intel Corporation 100 Series/C230 Series Chipset Family HD Audio Controller (rev 31) 键盘鼠标 U盘等usb设备只要unraid没占用，在虚拟机管理里面 是可以直接添加上的。虚拟如果已经开机了，可以用Libvirt Hotplug USB, 这个插件可以动态插入usb到虚拟机，\nhttps://github.com/dlandon/libvirt.hotplug.usb/raw/master/libvirt.hotplug.usb.plg 如果你没有梯子 可以看这个文章 另外就是蓝牙的直通\n[8086:a12f] 00:14.0 USB controller: Intel Corporation 100 Series/C230 Series Chipset Family USB 3.0 xHCI Controller (rev 31) Bus 001 Device 001 Port 1-0\tID 1d6b:0002 Linux Foundation 2.0 root hub --- --- Bus 001 Device 004 Port 1-6\tID 0a5c:4500 Broadcom Corp. BCM2046B1 USB 2.0 Hub (part of BCM2046 Bluetooth) --- Bus 001 Device 008 Port 1-6.3\tID 05ac:821f Apple, Inc. Built-in Bluetooth 2.0+EDR HCI --- 声卡的 需要整组屏蔽的哦，没办法，他也会自动帮你全勾选上\n再在unraid里面 点击主界面 引导设备 flah 下面的 Syslinux 配置: 在unraid os 后面添加一行 video=efifb:off\n重启 unraid\nwin10 虚拟机关机，添加 显卡，或者修改vnc的显卡成uhd630 ，rom指定到 /mnt/disk1/isos/vbios_gvt_uefi.rom\n再添加 键盘和鼠标，要插上哦。以及声卡和蓝牙\nIntel 100 Series/C230 Series Chipset Family HD Audio Controller (00:1f.3) Apple Built-in Bluetooth 2.0+EDR HCI (05ac:821f) Pixart Imaging Optical Mouse (093a:2510) DAREU EK871 BT keyboard (260d:0013) 参考文章 ：\nhttps://post.smzdm.com/p/aooz38zn/ http://10.0.0.8/Settings/VMSettings https://post.smzdm.com/p/alx8k9ze/ https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87) 4、调试win10 虚拟机的直通， 首先你要确定你黑苹果是支持你的要直通的硬件的\n显卡是uhb630 核显 声卡 ALC887 + HDMI，我这里不打算用HDMI wifi和蓝牙 BCM943224 pcie bt2 博通 43224AG （这是我以前的一张固定卡了） win10关机\nq35的直通问题 未完待续==============\n参考：https://post.smzdm.com/p/aqxovxl2/\nmacos虚拟机删除的时候，如果一直删除失败，打开虚拟机配置 切换到xml视图，删掉 nvram 这行 就可以删除了\n清理清单\n1 2 3 4 5 6 7 8 /mnt/user/system/custom_ovmf/Macinabox_VARS-pure-efi.fd /mnt/user/domains/Macinabox Monterey/ /mnt/user/system/custom_ovmf/Macinabox* /mnt/user/system/custom_ovmf/readme.txt # 安装镜像 /mnt/user/isos/Monterey-install.img ","date":"2022-10-28T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/unraid/window-kvm-gpu-usb-audio/","title":"unraid 安装win 核显和usb 声卡直通"},{"content":" 本文假定，你已经装了一个系统，机型是 q35 efi启动。\n目标，再q35 机型上 用efi 启动win 以及 opencore efi 启动的macos 可以点亮HDMI\nmacos安装请查看在pve上直接安装macos13 Ventura 初步优化\n本文基于 efi grub pve7.2.11 更多环境参数查看 本文末尾\n首先搞定相对比较简单的win10的显卡直通，以便后续调试macos\n显卡直通 vbois文件 因为是efi启动，所以必须提取显卡的vbois，如果你是独立显卡可以去这里下载 https://www.techpowerup.com/vgabios/\n如果是核显，可以网上搜一下你的核显型号，看能不能找到可用的vbios，如果 依旧没有，就需要自己提取编译，具体网上搜一下教程我这里就不重复\n我的是uhd630 ， 网上找到了一份 在unraid下测试没问题的。https://github.com/joyanhui/file.leiyanhui.com/blob/main/pve-unraid-kvm/vbios_gvt_uefi.rom\n下载到pve里面 备用\ncd /usr/share/kvm/ wget https://file.leiyanhui.com/pve-unraid-kvm/vbios_gvt_uefi.rom 开启pve的显卡直通 grub的处理 开启IOMMU支持 cp /etc/default/grub /etc/default/grub-bak nano /etc/default/grub 修改GRUB_CMDLINE_LINUX_DEFAULT这行为\nGRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet intel_iommu=on\u0026quot; 如果是amd的cpu 前面intel_iommu=on改为 amd_iommu=on\n如果多显卡，可能还需要再这里做一下屏蔽处理 就是 羡慕的 =on 后面添加空格 video=efifb:off\nGRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet intel_iommu=on video=efifb:off\u0026quot; 解释：\niommu开启直通分组 efifb:off 禁用efi启动的显示设备 vesafb:off 禁用legacy启动的显示设备 modprobe的处理 VT-D功能的内核模块 cp /etc/modules /etc/modules-bak nano /etc/modules 添加\nvfio vfio_iommu_type1 vfio_pc vfio_virqfd 检查黑名单 因为pve启动时会尝试加载显卡驱动，为了避免pve占用显卡，需要阻止pve的显卡驱动加载。只有显卡直通才需要这个 模块（驱动）黑名单，即让GPU设备在下次系统启动之后不使用这些驱动，把设备腾出来给vfio驱动用： /etc/modprobe.d/pve-blacklist.conf 看看有没有下面的内容，如果你后面要用钩子函数，就需要删除下面的内容，不用的话，最好是添加进去\ncp /etc/modprobe.d/pve-blacklist.conf /etc/modprobe.d/pve-blacklist.conf-bak nano /etc/modprobe.d/pve-blacklist.conf 内容\nblacklist i915 blacklist snd_hda_intel blacklist snd_hda_codec_hdmi 其他显卡\n# block AMD driver blacklist radeon blacklist amdgpu # block NVIDIA driver blacklist nouveau blacklist nvidia blacklist nvidiafb 处理一个kvm的配置项，可以避免一些特殊问题 如果是N卡还需要加入下面的配置到kvm.conf（据老外说是避免一些莫名其妙的错误）,\n如果你要跑macos的话 最好也添加一下,据说也可以避免macos无限重启\necho \u0026quot;options kvm ignore_msrs=Y\u0026quot; \u0026gt; /etc/modprobe.d/kvm.conf 也有国外教程是\necho \u0026quot;options kvm ignore_msrs=1\u0026quot; \u0026gt; /etc/modprobe.d/kvm.conf 不清楚那个是最合适的，我用第一个，只添加这行的话，会却会导致pve的母鸡控制台刷屏kvm [2205]: vcpu0 ignored RDMSR: 0x1b8类似的代码，你如果觉得烦躁。 你可以 修改成 options kvm ignore_msrs=Y report_ignored_msrs=N\n重启生效，或者 echo 0 \u0026gt; /sys/module/kvm/parameters/report_ignored_msrs 强制生效\n允许不安全的中断 echo \u0026quot;options vfio_iommu_type1 allow_unsafe_interrupts=1\u0026quot; \u0026gt; /etc/modprobe.d/iommu_unsafe_interrupts.conf 添加显卡到直通设备中 写入vfio 查看pci设备 lspci -nn | grep 显卡名称 例如\nlspci -nn | grep UHD 00:02.0 VGA compatible controller [0300]: Intel Corporation CoffeeLake-H GT2 [UHD Graphics 630] [8086:3e9b] 记住前面和最后的地址 00:02 和 8086:3e9b\n由于我们需要让设备直通虚拟机, 那就不能让宿主机的驱动去接管这些硬件, 我们需要一个 dummy 驱动模块去接管这些要被直通的硬件. 找到你想要直通的设备的 ID, 并且注意每个设备所在组的其他设备(编辑文件 /etc/modprobe.d/vfio.conf.\necho \u0026quot;options vfio-pci ids=8086:3e9b\u0026quot; \u0026gt; /etc/modprobe.d/vfio.conf ps：执行此操作后可能无法输出到外接显示器，若出现此情况，请撤回该步骤\n另外有一个 参数 disable_vga=1 也可能会影响\necho \u0026quot;options vfio-pci ids=8086:3e9b disable_vga=1\u0026quot; \u0026gt; /etc/modprobe.d/vfio.conf 但是为了避免 initrd 引入的内核模块中 vfio 位于物理驱动的后面, 这里有两套方案： 根据 lspci \u0026ndash;nnk 的内容, 找到每个设备对应的驱动, 修改 （arch） /etc/blacklist.conf 或者（pve）/etc/modprobe.d/pve-blacklist.conf 我们前面已经处理过\n另外有一个usb控制器 可能后面也要用到\nlspci -nn | grep USB 00:14.0 USB controller [0c03]: Intel Corporation 100 Series/C230 Series Chipset Family USB 3.0 xHCI Controller [8086:a12f] (rev 31) 我主板只有一个usb控制器，直通其他usb设备没问题，pcie板载蓝牙的话，是不行的\n重启 重启之前 需要更新一下 grub和 update-initramfs -u\nupdate-grub update-initramfs -u 执行结果\nupdate-grub Generating grub configuration file ... Found linux image: /boot/vmlinuz-5.15.64-1-pve Found initrd image: /boot/initrd.img-5.15.64-1-pve Found linux image: /boot/vmlinuz-5.15.30-2-pve Found initrd image: /boot/initrd.img-5.15.30-2-pve Found memtest86+ image: /boot/memtest86+.bin Found memtest86+ multiboot image: /boot/memtest86+_multiboot.bin Adding boot menu entry for UEFI Firmware Settings ... done update-initramfs -u update-initramfs: Generating /boot/initrd.img-5.15.64-1-pve Running hook script 'zz-proxmox-boot'.. Re-executing '/etc/kernel/postinst.d/zz-proxmox-boot' in new private mount namespace.. No /etc/kernel/proxmox-boot-uuids found, skipping ESP sync. 如果你和我一样是 ventoy引导的pve 还需要执行一下，不然就启动不起来了\ncd /root/vtoyboot-1.0.24/ sh vtoyboot.sh 执行结果\n********************************************** vtoyboot 1.0.24 longpanda admin@ventoy.net https://www.ventoy.net ********************************************** Current system use initramfstool as initramfs tool updating the initramfs, please wait ... update-initramfs: Generating /boot/initrd.img-5.15.64-1-pve Running hook script 'zz-proxmox-boot'.. Re-executing '/etc/kernel/postinst.d/zz-proxmox-boot' in new private mount namespace.. No /etc/kernel/proxmox-boot-uuids found, skipping ESP sync. grub mkconfig ... PROBE_PATH=/usr/sbin/grub-probe MKCONFIG_PATH=/usr/sbin/grub-mkconfig /usr/sbin/grub-mkconfig -o /boot/grub/grub.cfg Generating grub configuration file ... Found linux image: /boot/vmlinuz-5.15.64-1-pve Found initrd image: /boot/initrd.img-5.15.64-1-pve Found linux image: /boot/vmlinuz-5.15.30-2-pve Found initrd image: /boot/initrd.img-5.15.30-2-pve Found memtest86+ image: /boot/memtest86+.bin Found memtest86+ multiboot image: /boot/memtest86+_multiboot.bin Adding boot menu entry for UEFI Firmware Settings ... done This is ventoy enviroment replace shim efi ... shimx64.efi no need 0 vtoyboot process successfully finished. 重启之前，检查一下每一个文件，可以参考我的结果\ncat /etc/default/grub\ncat /etc/modules\ncat /etc/modprobe.d/pve-blacklist.conf\ncat /etc/modprobe.d/kvm.conf\ncat /etc/modprobe.d/iommu_unsafe_interrupts.conf\ncat /etc/modprobe.d/vfio.conf\n我的检查 执行结果 cat /etc/default/grub # If you change this file, run 'update-grub' afterwards to update # /boot/grub/grub.cfg. # For full documentation of the options in this file, see: # info -f grub -n 'Simple configuration' GRUB_DEFAULT=0 GRUB_TIMEOUT=5 GRUB_DISTRIBUTOR=`lsb_release -i -s 2\u0026gt; /dev/null || echo Debian` GRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet intel_iommu=on\u0026quot; GRUB_CMDLINE_LINUX=\u0026quot;\u0026quot; # Uncomment to enable BadRAM filtering, modify to suit your needs # This works with Linux (no patch required) and with any kernel that obtains # the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...) #GRUB_BADRAM=\u0026quot;0x01234567,0xfefefefe,0x89abcdef,0xefefefef\u0026quot; # Uncomment to disable graphical terminal (grub-pc only) #GRUB_TERMINAL=console # The resolution used on graphical terminal # note that you can use only modes which your graphic card supports via VBE # you can see them in real GRUB with the command `vbeinfo' #GRUB_GFXMODE=640x480 # Uncomment if you don't want GRUB to pass \u0026quot;root=UUID=xxx\u0026quot; parameter to Linux #GRUB_DISABLE_LINUX_UUID=true # Uncomment to disable generation of recovery mode menu entries #GRUB_DISABLE_RECOVERY=\u0026quot;true\u0026quot; # Uncomment to get a beep at grub start #GRUB_INIT_TUNE=\u0026quot;480 440 1\u0026quot; ----------------------------------- cat /etc/modules # /etc/modules: kernel modules to load at boot time. # # This file contains the names of kernel modules that should be loaded # at boot time, one per line. Lines beginning with \u0026quot;#\u0026quot; are ignored. vfio vfio_iommu_type1 vfio_pc vfio_virqfd ----------------------------------- cat /etc/modprobe.d/pve-blacklist.conf # This file contains a list of modules which are not supported by Proxmox VE # nidiafb see bugreport https://bugzilla.proxmox.com/show_bug.cgi?id=701 blacklist nvidiafb blacklist i915 blacklist snd_hda_intel blacklist snd_hda_codec_hdmi ----------------------------------- cat /etc/modprobe.d/kvm.conf options kvm ignore_msrs=Y ----------------------------------- cat /etc/modprobe.d/iommu_unsafe_interrupts.conf options vfio_iommu_type1 allow_unsafe_interrupts=1 ----------------------------------- cat /etc/modprobe.d/vfio.conf cat: /etc/modprobe.d/vfio.conf: No such file or directory 检查没问题后 重启 reboot\n查看模块是否有问题 lsmod | grep vfio 结果\nvfio_virqfd 16384 0 vfio_iommu_type1 40960 0 vfio 45056 1 vfio_iommu_type1 虚拟机添加显卡 再这里可以直接在虚拟机里面添加硬件 选择这个显卡了。但是如果是efi启动的 虚拟机能找到设备，但是显卡输出黑屏的。 可以先进去win 用vnc或者 远程桌面 装好直通进去的显卡的驱动。 所以我们还需要手动处理一下虚拟配置文件。我要操作的虚拟机 是macos+win的这双系统主机 102。\ncp /etc/pve/qemu-server/102.conf /etc/pve/qemu-server/102.conf-bak nano /etc/pve/qemu-server/102.conf 在显卡那条hostpci的最后加上,romfile=vbios_gvt_uefi.rom ,如果其他显卡 前面的地址可能不太一样\nhostpci0: 0000:00:02.0,pcie=1,romfile=vbios_gvt_uefi.rom 如果上面的方法不行，那就删掉hostpci0那行，在文件最上面加上这行，并且把 显示 设置成 无，不加romfile有可能也能用，可以先试试\nargs: -device vfio-pci,host=00:02.0,addr=0x02,x-igd-gms=1,romfile=vbios_gvt_uefi.rom 还有一种写法 是\nargs: -device vfio-pci,host=00:02.0,addr=0x02,x-igd-opregion=on,romfile=vbios_gvt_uefi.rom 经过我的测试，后者写法可以再q35 efi模式下 顺利点亮，另外 虚拟显卡 可以保留，但是win10直通的鼠标不显示指针\n如果你和我一样 要装黑苹果，可能已经有args这行，那就大概改成 下面这样\nargs: -device vfio-pci,host=00:02.0,addr=0x02,x-igd-opregion=on,romfile=vbios_gvt_uefi.rom -device isa-applesmc,osk=\u0026quot;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026quot; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -global\u0026gt; 另外你可能需要把显示 设置成 无 多试试\n如果启动的时候，提示 failed to open /dev/vfio/1: No such file or directory 那是因为 我们用args的时候 系统没有自动将设备重新绑定到vfio-pci模块，\n就需要我们\n1、删除或注释/etc/modprobe.d中绑定显卡id到vfio-pci的操作，如#options vfio-pci ids=8086:3184,8086:3198\nrm -rf /etc/modprobe.d/vfio.conf 2、编辑/etc/default/grub 添加vfio-pci.ids=8086:3184 8086:3198到 GRUB_CMDLINE_LINUX= \u0026ldquo;\u0026quot;（添加到引号内，id就是显卡id，有时需要将声卡id一并加入）\nGRUB_CMDLINE_LINUX= \u0026quot;vfio-pci.ids=8086:3e9b\u0026quot; 3、更新重启\nupdate-grub 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 agent: 1 args: -device vfio-pci,host=00:02.0,addr=0x02,x-igd-opregion=on,romfile=vbios_gvt_uefi.rom -device isa-applesmc,osk=\u0026#34;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026#34; \u0026gt; bios: ovmf boot: order=virtio0 cores: 8 cpu: Penryn efidisk0: local:102/vm-102-disk-0.qcow2,efitype=4m,size=528K machine: q35 memory: 8192 meta: creation-qemu=7.0.0,ctime=1667039767 net0: virtio=EA:46:2B:E6:EF:5F,bridge=vmbr0,firewall=1 numa: 1 ostype: other sata1: none,media=cdrom scsihw: virtio-scsi-pci smbios1: uuid=cbc57782-404a-4a2c-8500-78d072f75125 sockets: 1 vga: vmware virtio0: local:102/vm-102-disk-2.raw,size=512M virtio1: local:102/vm-102-disk-1.qcow2,size=32G virtio3: local:102/vm-102-disk-3.qcow2,cache=unsafe,size=16G vmgenid: f216093f-9c67-4801-934e-0a6c31fbb4fe 其他设备的直通 声卡和USB的直通 pve7.2 目前已经可以直接直通进去，不需要任何额外操作 HDMI 声音的直通，参考上面显卡 的 蓝牙的直通，如果是外置的usb蓝牙简单，如果是类似笔记本 或者 黑苹果的wifi上的的蓝牙，可能不一定可以驱动，可以尝试吧整个usb控制器直通进去先试试，如果可以再想办法尝试 通过pcei usb扩展卡 或者其他方法解决\n参考： https://zhuanlan.zhihu.com/p/577161166 https://zyyme.com/pve-igpu-passthrough.html https://www.right.com.cn/forum/thread-4055200-1-1.html 一个比较简单的显卡vbois提取教程：https://www.jianshu.com/p/3ec6891ac5c8 一个比较易懂的kvm教程 https://zhuanlan.zhihu.com/p/60389508\n","date":"2022-10-28T17:14:20+08:00","permalink":"https://dev.leiyanhui.com/pve/win-gpu/","title":"在pve上 efi q35 直通显卡显示，以及声卡和蓝牙 wifi等的直通   win/macos"},{"content":"前面已经 初步安装了macos 在102上，现在准备做硬件直通，关机备份一下。。\n备份虚拟机 mount /dev/sda1 /mnt cp -r /var/lib/vz/images/102 /mnt/pve-maco-base 备份虚拟机配置文件 cp /etc/pve/qemu-server/102.conf /mnt/pve-maco-base/102.conf 备份改动过的一个配置项 cp /etc/modprobe.d/kvm.conf /mnt/pve-maco-base/kvm.conf 记录环境信息 #内核 cat /proc/version \u0026gt; /mnt/pve-maco-base/pveinfo.txt #版本 cat /etc/debian_version \u0026gt;\u0026gt; /mnt/pve-maco-base/pveinfo.txt # pve版本 pveversion -v \u0026gt;\u0026gt; /mnt/pve-maco-base/pveinfo.txt 我的最终环境信息 Linux version 5.15.64-1-pve (build@proxmox) (gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2) #1 SMP PVE 5.15.64-1 (Thu, 13 Oct 2022 10:30:34 +0200) debian 11.5 proxmox-ve: 7.2-1 (running kernel: 5.15.64-1-pve) pve-manager: 7.2-11 (running version: 7.2-11/b76d3178) pve-kernel-5.15: 7.2-13 pve-kernel-helper: 7.2-13 pve-kernel-5.15.64-1-pve: 5.15.64-1 pve-kernel-5.15.30-2-pve: 5.15.30-3 ceph-fuse: 15.2.16-pve1 corosync: 3.1.5-pve2 criu: 3.15-1+pve-1 glusterfs-client: 9.2-1 ifupdown2: 3.1.0-1+pmx3 ksm-control-daemon: 1.4-1 libjs-extjs: 7.0.0-1 libknet1: 1.24-pve1 libproxmox-acme-perl: 1.4.2 libproxmox-backup-qemu0: 1.3.1-1 libpve-access-control: 7.2-4 libpve-apiclient-perl: 3.2-1 libpve-common-perl: 7.2-3 libpve-guest-common-perl: 4.1-4 libpve-http-server-perl: 4.1-4 libpve-storage-perl: 7.2-10 libspice-server1: 0.14.3-2.1 lvm2: 2.03.11-2.1 lxc-pve: 5.0.0-3 lxcfs: 4.0.12-pve1 novnc-pve: 1.3.0-3 proxmox-backup-client: 2.2.7-1 proxmox-backup-file-restore: 2.2.7-1 proxmox-mini-journalreader: 1.3-1 proxmox-widget-toolkit: 3.5.1 pve-cluster: 7.2-2 pve-container: 4.2-3 pve-docs: 7.2-2 pve-edk2-firmware: 3.20220526-1 pve-firewall: 4.2-6 pve-firmware: 3.5-6 pve-ha-manager: 3.4.0 pve-i18n: 2.7-2 pve-qemu-kvm: 7.0.0-4 pve-xtermjs: 4.16.0-1 qemu-server: 7.2-4 smartmontools: 7.2-pve3 spiceterm: 3.2-2 swtpm: 0.7.1~bpo11+1 vncterm: 1.7-1 zfsutils-linux: 2.1.6-pve1 ","date":"2022-10-28T15:29:20+08:00","permalink":"https://dev.leiyanhui.com/pve/mac-bak/","title":"pve安装的macos简单备份"},{"content":"硬盘安装了ventoy，ventoy 使用了两个分区，一个是ventoy分区 大小几百M-几G 一个是 ventoyefi分区32M，后面的分区是保留分区。\n先用ventoy 启动硬盘保留分区的一个 win11.vhd 或者其他系统都可。\n安装 virtualbox 创建一个虚拟机debian11，挂pve7.2.iso 不创建硬盘\n系统设置里面 打开 efi，创建一个虚拟硬盘 固定大小的。virtualbox现在升级到6.1-7 按钮位置发生了变化注意一一点。 网络选择桥接\n这里注意三个点:\n必须打开efi 这是 ventoy 启动的要求 虚拟硬盘需要固定大小 虚拟硬盘尺寸不能太小，因为pve除了自己占用的3-4G空间之外，还有node需要保留一些空间。我粗略测试 12G不可以，20G可以。懒得继续测试，直接用20G的vhd固定大小安装 要在virtualbox这个虚拟机设置里面打开虚拟化嵌套的，不然装不上 安装完成后，虚拟机挂载 plugin_vtoyboot 的iso https://github.com/ventoy/vtoyboot/releases\n在pve里面 mount上，然后cp 里面的tar.gz 到 ~ tar解压 ，cd 进去 sh vtoyboot.sh\n在这之前，最好把pve的 debian源和pve源换到国内，然后更新一下pve系统，\n反正关机之前，要 sh vtoyboot.sh一下，以后系统升级后也执行一次。\n关机后，复制vhd文件出来，后缀修改 vhd.vtoy\n然后 用ventoy 自带的工具，创建一个 link到 ventoy分区，倒计时启动等，最重要的 是，要打开 VTOY_LINUX_REMOUNT 参考\n用用ventoy启动后，用root登录，然后修改网络配置 主要是修改ip 还有更换网卡，因为在虚拟机里面安装的虚拟网卡，在物理机没有这个网卡，\n注意 pve 是用vmbr0 这个网卡来转发实际网卡的数据的，不要把virtualbox的虚拟网卡和vmbr0搞混概念\n1 2 3 4 5 6 7 8 查看网卡设备，有线网卡一般是enXxx ip link show # 修改配置文件，把网卡改成新的名字 我的就是 enp0s3修改为 enp1s0 nano /etc/network/interfaces # 重启网络应用改动 systemctl restart networking 这是我修改前的\n1 2 3 4 5 6 7 8 9 10 11 12 13 cat /etc/network/interfaces-bak auto lo iface lo inet loopback iface enp0s3 inet manual auto vmbr0 iface vmbr0 inet static address 10.0.0.128/24 gateway 10.0.0.1 bridge-ports enp0s3 bridge-stp off bridge-fd 0 修改后的\n1 2 3 4 5 6 7 8 9 10 11 12 13 cat /etc/network/interfaces auto lo iface lo inet loopback iface enp1s0 inet manual auto vmbr0 iface vmbr0 inet static address 10.0.0.99/24 gateway 10.0.0.1 bridge-ports enp1s0 bridge-stp off bridge-fd 0 另外 /etc/issue 和 /etc/hosts 可以顺带修改一下，不修改也不影响\n网络正常后 处理自动挂载\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 blkid ---- /dev/nvme0n1p1: LABEL_FATBOOT=\u0026#34;EFI2\u0026#34; LABEL=\u0026#34;EFI2\u0026#34; UUID=\u0026#34;729A-FE81\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; PARTUUID=\u0026#34;7adb76ae-01\u0026#34; /dev/nvme0n1p2: SEC_TYPE=\u0026#34;msdos\u0026#34; LABEL_FATBOOT=\u0026#34;VTOYEFI\u0026#34; LABEL=\u0026#34;VTOYEFI\u0026#34; UUID=\u0026#34;ADC2-5F11\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; PARTUUID=\u0026#34;7adb76ae-02\u0026#34; /dev/nvme0n1p3: LABEL=\u0026#34;Exfat\u0026#34; UUID=\u0026#34;7F17-3D02\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;exfat\u0026#34; PARTUUID=\u0026#34;7adb76ae-03\u0026#34; /dev/sda1: LABEL=\u0026#34;HHD\u0026#34; UUID=\u0026#34;9D09-82A9\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;exfat\u0026#34; PARTUUID=\u0026#34;b1fb145f-01\u0026#34; /dev/mapper/ventoy2: UUID=\u0026#34;FF54-9C3A\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; /dev/mapper/ventoy3: UUID=\u0026#34;AGKBNe-Bw8e-Rg2H-YLtd-XCjp-x8SO-Yo52AW\u0026#34; TYPE=\u0026#34;LVM2_member\u0026#34; /dev/mapper/pve-swap: UUID=\u0026#34;b50aa774-310e-43af-87d2-4ef40e033910\u0026#34; TYPE=\u0026#34;swap\u0026#34; /dev/mapper/pve-root: UUID=\u0026#34;1637dd63-6dc3-4957-934a-2ff8c41f8f10\u0026#34; BLOCK_SIZE=\u0026#34;4096\u0026#34; TYPE=\u0026#34;ext4\u0026#34; /dev/mapper/ventoy: PTUUID=\u0026#34;00a161a2-67c0-4d79-815a-c7d23b5d727c\u0026#34; PTTYPE=\u0026#34;gpt\u0026#34; nano /etc/fstab ---- # \u0026lt;file system\u0026gt; \u0026lt;mount point\u0026gt; \u0026lt;type\u0026gt; \u0026lt;options\u0026gt; \u0026lt;dump\u0026gt; \u0026lt;pass\u0026gt; /dev/pve/root / ext4 errors=remount-ro 0 1 UUID=FF54-9C3A /boot/efi vfat defaults 0 1 /dev/pve/swap none swap sw 0 0 proc /proc proc defaults 0 0 UUID=729A-FE81 /mnt/efi2 vfat defaults 0 2 UUID=7F17-3D02 /mnt/exfat exfat defaults 0 2 UUID=9D09-82A9 /mnt/hdd exfat defaults 0 2 ","date":"2022-10-25T00:00:00Z","permalink":"https://dev.leiyanhui.com/linux/pve-vdisk/","title":"pve安装到硬盘的一个虚拟文件然后物理机启动的几个注意点"},{"content":"主力机系统和磁盘分配 双硬盘，机械盘 1T 2.5寸老盘，固态盘 512G 恺侠\n分区 第一分区 5G左右，fat32格式，存放特殊efi 和 winpe 以linux live盘镜像，以及 ventoy 的虚拟磁盘link文件\n第二分区 32M fat16格式 存放 ventoy的efi 并在bois设置为这个分区引导\n第三分区 exfat 存放 系统虚拟磁盘 和 虚拟机的硬盘 文件\nventoy 打开 VTOY_LINUX_REMOUNT =1 允许使用实验性的 挂载镜像所在分区\nVTOY_MENU_TIMEOUT =5 秒\nexfat分区 两个关键性目录\nos目录 放 pve的 vhd.vtoy win11 的vhd\nkvm目录 放 虚拟机的硬盘镜像 软连接到 pve内\n后期如果有时间，考虑 把pve 换成 arch 或者 apline之类的系统 手动管理kvm\n","date":"2022-10-25T00:00:00Z","permalink":"https://dev.leiyanhui.com/os/disk-os/","title":"主力机系统和磁盘分配"},{"content":"接近永久免费的vps-woiden woiden.id 和 hax.co.id都是同一家，不同的是 hax.co.id 提供的是免费的IPv6 VPS，而 woiden.id 则提供免费的 NAT VPS（自带一个 IPv6）。NAT VPS几乎与其他VP相似，但使用NAT（网络地址转换）方法，可以将单个IPv4共享给多个VP，然后为每个用户分配不同的端口。\nwoiden 可以单独申请共享的ipv4 会给10个端口\n如果要作站的话可以套cf 转换80 和 443端口\nVPS的配置是1核，750M内存，4G SSD，不限制流量。\n申请后 有效期7天，7天内登录一次官网 可以顺延7天\n可以在 github actions 设置自动登录验证\n支持IPv6+不咋稳定的IPv4。\n申请方法：首先得有telegram 添加 @HaxTG_bot，获取ID后， 这个id 就是你以后登录的id 可以单独设置密码 ，到网站输入后，填写TG返回的串码以绑定账号（TG会反馈网站上的操作成功信息）。\n注册成功后即可创建一个VPS了。具体看站点和TG的反馈就行。\n申请地址： woiden.id\n页面上有很多广告，注意别点错了\n申请和开通过程很简单，但是我这边遇到 开通的时候 过一会提示 please report via telegram\n","date":"2022-10-23T00:00:00Z","permalink":"https://dev.leiyanhui.com/linux/free-vps-woiden/","title":"接近永久免费的vps-woiden"},{"content":"hugo开启简单搜索功能 无论模板是否支持搜索都可以开启\n第一步： Config.toml 可能是/config/_default/Config.toml 添加或者修改\n[outputs] home = [\u0026quot;HTML\u0026quot;, \u0026quot;RSS\u0026quot;, \u0026quot;JSON\u0026quot;] 第二步：创建 layouts/_default/index.json 注：layouts/ 目录里保存的是 Hugo 的模板文件。layouts/ 是站点级别的模板， themes//layouts/ 是主题级别的模板，站点级别模板的设置优先于主题级别的模板。\n1 2 3 4 5 {{- $.Scratch.Add \u0026#34;index\u0026#34; slice -}} {{- range .Site.RegularPages -}} {{- $.Scratch.Add \u0026#34;index\u0026#34; (dict \u0026#34;title\u0026#34; .Title \u0026#34;tags\u0026#34; .Params.tags \u0026#34;categories\u0026#34; .Params.categories \u0026#34;contents\u0026#34; .Plain \u0026#34;permalink\u0026#34; .Permalink) -}} {{- end -}} {{- $.Scratch.Get \u0026#34;index\u0026#34; | jsonify -}} 完成后 可以在站点根目录生成一个 /index.json 的索引\n第三步： 创建搜索页面 创建 content/search.md 1 2 3 4 5 6 --- title: \u0026#34;Search Results\u0026#34; sitemap: priority : 0.1 layout: \u0026#34;search\u0026#34; --- 第四步骤，添加静态模板 layouts/_default/search.html 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 \u0026lt;section\u0026gt; \u0026lt;div\u0026gt; \u0026lt;form action=\u0026#34;{{ \u0026#34;search\u0026#34; | absURL }}\u0026#34;\u0026gt; \u0026lt;input id=\u0026#34;search-query\u0026#34; name=\u0026#34;s\u0026#34;/\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;div id=\u0026#34;search-results\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;Matching pages\u0026lt;/h3\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;script id=\u0026#34;search-result-template\u0026#34; type=\u0026#34;text/x-js-template\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;summary-${key}\u0026#34;\u0026gt; \u0026lt;h4\u0026gt;\u0026lt;a href=\u0026#34;${link}\u0026#34;\u0026gt;${title}\u0026lt;/a\u0026gt;\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;${snippet}\u0026lt;/p\u0026gt; ${ isset tags }\u0026lt;p\u0026gt;Tags: ${tags}\u0026lt;/p\u0026gt;${ end } ${ isset categories }\u0026lt;p\u0026gt;Categories: ${categories}\u0026lt;/p\u0026gt;${ end } \u0026lt;/div\u0026gt; \u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.3.1.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;{{ \u0026#34;js/search.js\u0026#34; | absURL }}\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 第五步 添加 创建 static/js/search.js 这是具体实现搜索功能的 JS 函数，search.html 中被引用，照抄即可。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 summaryInclude=60; var fuseOptions = { shouldSort: true, includeMatches: true, threshold: 0.0, tokenize:true, location: 0, distance: 100, maxPatternLength: 32, minMatchCharLength: 1, keys: [ {name:\u0026#34;title\u0026#34;,weight:0.8}, {name:\u0026#34;contents\u0026#34;,weight:0.5}, {name:\u0026#34;tags\u0026#34;,weight:0.3}, {name:\u0026#34;categories\u0026#34;,weight:0.3} ] }; var searchQuery = param(\u0026#34;s\u0026#34;); if(searchQuery){ $(\u0026#34;#search-query\u0026#34;).val(searchQuery); executeSearch(searchQuery); }else { $(\u0026#39;#search-results\u0026#39;).append(\u0026#34;\u0026lt;p\u0026gt;Please enter a word or phrase above\u0026lt;/p\u0026gt;\u0026#34;); } function executeSearch(searchQuery){ $.getJSON( \u0026#34;/index.json\u0026#34;, function( data ) { var pages = data; var fuse = new Fuse(pages, fuseOptions); var result = fuse.search(searchQuery); console.log({\u0026#34;matches\u0026#34;:result}); if(result.length \u0026gt; 0){ populateResults(result); }else{ $(\u0026#39;#search-results\u0026#39;).append(\u0026#34;\u0026lt;p\u0026gt;No matches found\u0026lt;/p\u0026gt;\u0026#34;); } }); } function populateResults(result){ $.each(result,function(key,value){ var contents= value.item.contents; var snippet = \u0026#34;\u0026#34;; var snippetHighlights=[]; var tags =[]; if( fuseOptions.tokenize ){ snippetHighlights.push(searchQuery); }else{ $.each(value.matches,function(matchKey,mvalue){ if(mvalue.key == \u0026#34;tags\u0026#34; || mvalue.key == \u0026#34;categories\u0026#34; ){ snippetHighlights.push(mvalue.value); }else if(mvalue.key == \u0026#34;contents\u0026#34;){ start = mvalue.indices[0][0]-summaryInclude\u0026gt;0?mvalue.indices[0][0]-summaryInclude:0; end = mvalue.indices[0][1]+summaryInclude\u0026lt;contents.length?mvalue.indices[0][1]+summaryInclude:contents.length; snippet += contents.substring(start,end); snippetHighlights.push(mvalue.value.substring(mvalue.indices[0][0],mvalue.indices[0][1]-mvalue.indices[0][0]+1)); } }); } if(snippet.length\u0026lt;1){ snippet += contents.substring(0,summaryInclude*2); } //pull template from hugo templarte definition var templateDefinition = $(\u0026#39;#search-result-template\u0026#39;).html(); //replace values var output = render(templateDefinition,{key:key,title:value.item.title,link:value.item.permalink,tags:value.item.tags,categories:value.item.categories,snippet:snippet}); $(\u0026#39;#search-results\u0026#39;).append(output); $.each(snippetHighlights,function(snipkey,snipvalue){ $(\u0026#34;#summary-\u0026#34;+key).mark(snipvalue); }); }); } function param(name) { return decodeURIComponent((location.search.split(name + \u0026#39;=\u0026#39;)[1] || \u0026#39;\u0026#39;).split(\u0026#39;\u0026amp;\u0026#39;)[0]).replace(/\\+/g, \u0026#39; \u0026#39;); } function render(templateString, data) { var conditionalMatches,conditionalPattern,copy; conditionalPattern = /\\$\\{\\s*isset ([a-zA-Z]*) \\s*\\}(.*)\\$\\{\\s*end\\s*}/g; //since loop below depends on re.lastInxdex, we use a copy to capture any manipulations whilst inside the loop copy = templateString; while ((conditionalMatches = conditionalPattern.exec(templateString)) !== null) { if(data[conditionalMatches[1]]){ //valid key, remove conditionals, leave contents. copy = copy.replace(conditionalMatches[0],conditionalMatches[2]); }else{ //not valid, remove entire section copy = copy.replace(conditionalMatches[0],\u0026#39;\u0026#39;); } } templateString = copy; //now any conditionals removed we can do simple substitution var key, find, re; for (key in data) { find = \u0026#39;\\\\$\\\\{\\\\s*\u0026#39; + key + \u0026#39;\\\\s*\\\\}\u0026#39;; re = new RegExp(find, \u0026#39;g\u0026#39;); templateString = templateString.replace(re, data[key]); } return templateString; } 最后 打开 http://你的网站/search 就有一个基本的站内搜索了\n部分模板自带了搜索功能\n你可以查看模板里面的 /exampleSite/content/search.md\n然后覆盖上面的/content/search.md内容\n","date":"2022-10-23T07:15:20+08:00","permalink":"https://dev.leiyanhui.com/mdbook/hugo-set-search/","title":"hugo开启简单的搜索"},{"content":"2022是否应该彻底抛弃gitee了 gitee 怎么这么恶心 屏蔽外链事件 之前gitee 突然无征兆屏蔽外链事件，可以理解为政策或者成本因素。可以理解。。。\n还有2019年的dns事件 虽然是阿里单方面屏蔽的，但是你和dns厂商就没有有效的沟通渠道吗\nmd文件链接强加前缀 现在 md文件 在线预览 链接地址 强制加前缀也是服了\nhttps://gitee.com/link?target=XXXXXX\ngitee的网页速度也开始变慢 不知为什么加载了那么一堆乱七八糟的东西，越来越卡\ngitee page 好像是玩具 其实没搞明白 他这个好像是需要手动刷新同步的。。。 和 github pages 压根两个概念\n并且也不不可以绑定独立域名，哪怕已经备案的\n我的选择 其实阿里codeup和腾讯的codeing 也不错\n我的选择，私有库 codeup，开源库github（gitee只做镜像） 私有库=\u0026gt; pages 阿里云oss 开源库=\u0026gt; pages github=\u0026gt;国内cdn（境外回源）\n其他选择 cdsn家的 https://gitcode.net/\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/gitee-drop/","title":"2022是否应该彻底抛弃gitee了"},{"content":"archlinux 安装宝塔记录 安装arch 下载 archlinux-2022.10.01-x86_64.iso 挂到主机 启动后 archinstall 自动安装\narch安装一些基本包 1 2 3 4 5 6 7 8 9 10 11 12 pacman -S openssh systemctl enable sshd systemctl start sshd sudo pacman -S wget unzip sudo pacman -S make sudo pacman -S core/gcc sudo pacman -S cmake sudo pacman -S pkg-config #php需要一些依赖 sudo pacman -S libsodium sqlite oniguruma libwebp libvpx openssl sudo pacman -Syu gtk4 sudo pacman -S autoconf 可能需要 创建 /etc/bt.local\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/archlinux-install-bt/","title":"archlinux 安装宝塔记录"},{"content":"coding自动推送的到github 持续集成，创建构建计划，然后添加 pipeline { agent any stages { stage('检出') { steps { checkout([ $class: 'GitSCM', branches: [[name: env.GIT_BUILD_REF]], userRemoteConfigs: [[url: env.GIT_REPO_URL, credentialsId: env.CREDENTIALS_ID]] ]) } } stage('推送部署') { steps { echo '正在推送文件...' sh 'git fetch https://joyanhui:你的token令牌@github.com/joyanhui/dev.leiyanhui.com-src.git' sh 'git push -f https://joyanhui:你的token令牌@github.com/joyanhui/dev.leiyanhui.com-src.git HEAD:main' echo '已完成文件推送.' } } } } coding的编辑地址是类似 这样的格式\nhttps://xxx.coding.net/p/xxxxx.com/d/xxxxx/git/tree/main/src/SUMMARY.md?tab=file\nbook.toml 修改编辑地址\nhttps://xxx.coding.net/p/xxxx/d/xxxx/git/tree/main/{path}?tab=file\n然后打开后 还需要再次 点一下编辑\n最后\ncoding的 持续集成执行时间 已经是第三次 还是第四次 被优化到了 300分钟每月\u0026hellip;\ncoding的在线md编辑器不怎么好用，页面复杂 加载项目多，页面加载速度甚至不如只修改hosts的 github快。。。\n还经常 弹出。。。。 保存失败：不存在 最新版本 请自行保存\n如果是做无主机 博客的话，不建议用coding做为国内镜像。。。垃圾中的战斗机\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/coding-to-github/","title":"coding自动推送的到github"},{"content":"docker运行的clash自动更新订阅 我们用两个容器 实现了 基于docker的可视化clash\n1 2 docker run --restart=always -p 7880:80 -d --name clash-web haishanh/yacd docker run -d --name=clash -v \u0026#34;/www/wwwroot/clash.config.yaml:/root/.config/clash/config.yaml\u0026#34; -p \u0026#34;7890:7890\u0026#34; -p \u0026#34;7891:7891\u0026#34; -p \u0026#34;9090:9090\u0026#34; --restart=unless-stopped dreamacro/clash-premium clash.config.yaml 这个文件 是我们从 某些订阅平台拿到的。但是里面的一些配置项目 ，比如 没有打开 局域网访问，还有9090 端口 只允许本机链接等 就是下面两个\n1 2 allow-lan: true external-controller: \u0026#39;0.0.0.0:9090\u0026#39; 先找一个在线订阅转化工具 百度搜有很多，比如 https://ppc.linshenkx.cn/ 也可以自己搭建 https://github.com/qier222/proxy-provider-converter\n自己搭建转化服务 我这里直接使用 tindy2013/subconverter 查看官网文档 https://github.com/tindy2013/subconverter/blob/master/README-cn.md\n1 docker run -d --restart=always -p 25500:25500 tindy2013/subconverter:latest http://你的ip:25500/sub?target=clash\u0026amp;url=订阅地址URLEncode\n可以直接拿到一个可用的修改好的.yaml\n剩下的就简单了\n在容器外部添加一个定时任务shell\n1 2 3 4 cd /www/wwwroot/ curl -o new.clash.yaml \u0026#39;http://10.0.0.9:25500/sub?target=clash\u0026amp;url=https%3A%2F%2Fxn--xxxxx.com%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%xxx\u0026#39; rm -rf clash.config.yaml mv new.clash.yaml clash.config.yaml ","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/docker-clash-autoupdate/","title":"docker运行的clash自动更新订阅"},{"content":"mdbook 解决搜索引擎收录的问题 手动提交 1 2 3 4 https://ziyuan.baidu.com/linksubmit/url/ http://google.com/ping?sitemap=你需要提交的网页地址、或是URL列表页地址 ","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/mdbook-sitemap/","title":"mdbook 解决搜索引擎收录的问题"},{"content":"或许真的到了放弃centos7的时间了。 今天折腾mdBook Rust，然后发现竟然不支持centos7 原因是GLIBC太老了 但是GLIBC 和系统核心相关，升级的话 还是非常麻烦\n只好尝试升级到Centos Stream 8\n其实很想用archlinux，但\n安装epel-relase、yum-utils和rpmconf 1 2 yum install yum-utils epel-release -y yum install rpmconf -y 安装前检查 1 2 3 rpmconf -a package-cleanup --leaves package-cleanup --orphans 安装dnf 并执行更新 1 2 3 4 5 yum install dnf -y dnf remove yum yum-metadata-parser -y \u0026amp;\u0026amp; rm -rf /etc/yum dnf upgrade -y dnf upgrade https://mirrors.bfsu.edu.cn/centos-vault/8.0.1905/BaseOS/x86_64/os/Packages/centos-release-8.0-0.1905.0.9.el8.x86_64.rpm -y dnf upgrade https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm -y 删除无用文件、CentOS 7的内核、更换Vault源和移除无法升级的包并安装CentOS 8的内核 1 2 3 4 5 6 7 8 9 10 11 dnf clean all rpm -e `rpm -q kernel` rpm -e --nodeps sysvinit-tools minorver=8.0.1905 sudo sed -e \u0026#34;s|^mirrorlist=|#mirrorlist=|g\u0026#34; \\ -e \u0026#34;s|^#baseurl=http://mirror.centos.org/\\$contentdir/\\$releasever|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-vault/$minorver|g\u0026#34; \\ -i.bak \\ /etc/yum.repos.d/CentOS-*.repo dnf remove python36-rpmconf -y dnf --releasever=8 --allowerasing --setopt=deltarpm=false distro-sync -y dnf groupupdate \u0026#34;Core\u0026#34; \u0026#34;Minimal Install\u0026#34; -y 升级到Centos Stream 8 1 2 3 4 5 6 dnf install \\ http://mirror.centos.org/centos/8-stream/BaseOS/x86_64/os/Packages/centos-stream-repos-8-4.el8.noarch.rpm \\ http://mirror.centos.org/centos/8-stream/BaseOS/x86_64/os/Packages/centos-stream-release-8.6-1.el8.noarch.rpm \\ http://mirror.centos.org/centos/8-stream/BaseOS/x86_64/os/Packages/centos-gpg-keys-8-4.el8.noarch.rpm \\ -y dnf distro-sync --allowerasing -y 最后清理dnf 然后更新 1 2 dnf clean packages reboot 进入系统后 再更新一次 1 dnf update 后面还需要大量工作要处理，如果不是非常必要，建议直接重装\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/centos7-is-die/","title":"或许真的到了放弃centos7的时间了"},{"content":"几种常用的 静态网站生产工具的选择 基本要求：\n支持自动部署，本地不要做环境 可以简单支持中文搜索 生成速度快一点 模板可选多一些 进阶要求：\n不要 node.js 的，因为我不用这东西，然后本地还要装一堆包 gitbook 本地版本 基于 nodehjs ，在线版 需要梯子，另外有一个在线调用的js 还需要二次处理\nmdbook 目前在用的，中文搜索 难度大\n模板比较少\nvuepress 这玩意 号称生成速度很快，，\n但是实际测试发现 一般而已\npeach 看起来不错 但是配置繁琐\ngohugo+git book theme 看主题挺多的，而且也是二进制 编译\n在github上快速部署一个基于hugu的个人博客\n参考文章：https://blog.csdn.net/bigwhite20xx/article/details/107011017\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/md-pages-select/","title":"几种常用的 静态网站生产工具的选择"},{"content":"本文迁移到 新地址\n使用hugo 搭建一个多语言文档站 请先查看文档 在github上快速部署一个基于hugo的个人博客\nhugo new site doc cd doc ls 找一个自己喜欢的主题 https://dev.leiyanhui.com/\n选中了 这个 https://github.com/thegeeklab/hugo-geekdoc\nmkdir -p themes/hugo-geekdoc/ curl -L https://github.com/thegeeklab/hugo-geekdoc/releases/latest/download/hugo-geekdoc.tar.gz | tar -xz -C themes/hugo-geekdoc/ \u0026ndash;strip-components=1\nrm -rf config.toml\n创建文件 nano config.toml 按照官方提示 https://geekdocs.de/usage/getting-started/ 输入\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 baseURL = \u0026#34;http://localhost\u0026#34; title = \u0026#34;Geekdocs\u0026#34; theme = \u0026#34;hugo-geekdoc\u0026#34; pluralizeListTitles = false # Geekdoc required configuration pygmentsUseClasses = true pygmentsCodeFences = true disablePathToLower = true # Required if you want to render robots.txt template enableRobotsTXT = true # Needed for mermaid shortcodes [markup] [markup.goldmark.renderer] # Needed for mermaid shortcode unsafe = true [markup.tableOfContents] startLevel = 1 endLevel = 9 [taxonomies] tag = \u0026#34;tags\u0026#34; 本地先测试 hugo server 可以运行了，剩下的不管直接推送到github上 新建一个公开库 https://github.com/joyanhui/doc-hugo 稍后设置为私有 git init git add -A git commit -m \u0026ldquo;first commit\u0026rdquo; git branch -M main git remote add origin https://github.com/joyanhui/doc-hugo.git git push -u origin main\n在线编辑 config.toml 把里面的域名 修改成\nhttp://joyanhui.github.io/doc-hugo/ 在github 设置的 pages打开，定位到gh-pages分支不用绑定域名\n新建一个md文件 content/test.md 内容\n1 2 3 4 5 6 7 8 9 --- title: \u0026#39;测试md\u0026#39; date: 2022-10-22 tag: - test - hugo --- # 测试md 测试一下 等待actions执行完成后直接打开域名测试 https://joyanhui.github.io/doc-hugo/test/ 已经可以看到 在github上创建文件 .github/workflows/gh-pages.yml 内容参考在github上快速部署一个基于hugo的个人博客\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/hugo-doc/","title":"使用hugo 搭建一个多语言文档站"},{"content":"域名ssl和caa记录等知识记录整理 域名CAA记录 简单的说 CAA记录 就是只允许域名从指定的 证书签发机构申请证书.\n作用 对日常操作来说 其实就是因为 签发机构可能会检查caa记录.\n理论上从2017年之后，所有证书签发机构都是要强制检查caa记录的，但是实际\u0026hellip;.\n从安全角度来说，就你可以限制，只有指定的 证书机构可以给你 域名颁发证书\nCAA记录作用域 @ 作用到全局\nsubdomain.leiyanhui.com 就只作用到subdomain.leiyanhui.com 这个域名 和这个域名的下级域\n但是部分签发机构会审核子域名的caa记录,就需要手动添加了\n常用记录 1 2 3 4 5 6 0 issue \u0026#34;trust-provider.com\u0026#34; 0 issue \u0026#34;letsencrypt.org\u0026#34; example.com. CAA 0 issue \u0026#34;quovadisglobal.com\u0026#34; example.com. CAA 0 issuewild \u0026#34;quovadisglobal.com\u0026#34; example.com. CAA 0 iodef \u0026#34;mailto:cert-admin@example.com\u0026#34; 通知邮箱\n1 0 iodef \u0026#34;mailto:joyanhui@qq.com\u0026#34; 常用免费ssl证书 letsencrypt 可以简单用脚本续签，支持泛域名（有效期三个月） ，对老设备 旧浏览器 兼容性差一些\n续签是需要重新部署的哦.\n国内很多地方都可以在线申请,宝塔也内置了申请和自动续签,以及自动部署的脚本\n适合自有服务器环境，适合泛域名环境。github的pages 是使用他家的\nDigiCert 阿里云可以申请 一个账号只可以申请20个，单一域名，有效期一年，对老设备 旧浏览器 兼容性几乎是最好的。 DigiCert 虽然很高大上,但是免费版现在好像没有用国内cdn了.\n申请网站：阿里云、华为云\nTrustAsia TrustAsia 据说是DigiCert的代理商,免费版貌似也是没有国内cdn的\n自2022年03月03日22:00:00起，TrustAsia 根证书签发由 Digicert 根证书变更为 Sectigo 根证书。\n有效期1年，www.xxx.com 会送 xxx.com ，无法续签，重新申请。对老设备 旧浏览器 兼容性几乎是最好的。 部分网站支持 3个月的通配符 域名申请\n适合cdn用 自己记得每年重新申请就好。 腾讯云 一个账号 可以申请20个. 申请网站：腾讯云，又拍云，七牛云 https://freessl.cn/\ncloudflare 有效期15年, 只适合cf代理的站点,不怎么适合国内使用\nSectigo letsencrypt 一样 3个月，其他不明 没用过\n同一个域名允许多个caa颁发机构 重复添加多条记录就可以了. 一开始我以为用什么特殊符号分割的。实际不是\n其他一些别名的问题 子域名caa 部分厂商下发ssl 会同时检查 根域名和子域名的caa记录, 需要添加\ncname 和 caa冲突的问题 先暂停cname记录,然后ping一下ip 获得ip后 添加A记录先\n然后添加对应记录的caa,然后申请,证书下发后,删除A记录 恢复 cname\n相关资源 通常在nginx 宝塔之类 环境下,我们用的都是 pem crt格式,如果部署到 iis tomcat 需要 PFX/PKCS jks 格式\n在线格式转化 https://www.sslaaa.com/tools/crt_to_jks\n强烈建议自己转化。。。\n自动帮你生成记录值内容 https://sslmate.com/caa/\n在线查询CAA记录值 https://www.myssl.cn/tools/caa.html\n常用caa记录 1 2 3 4 5 6 SecureSite\t0 issue \u0026#34;digicert.com\u0026#34;\t0 issuewild \u0026#34;digicert.com\u0026#34; GeoTrust\t0 issue \u0026#34;digicert.com\u0026#34;\t0 issuewild \u0026#34;digicert.com\u0026#34; TrustAsia\t0 issue \u0026#34;trust-provider.com\u0026#34;\t0 issuewild \u0026#34;trust-provider.com\u0026#34; GlobalSign\t0 issue \u0026#34;globalsign.com\u0026#34;\t0 issuewild \u0026#34;globalsign.com\u0026#34; WoTrus\t0 issue \u0026#34;wotrus.com\u0026#34;\t0 issuewild \u0026#34; wotrus.com\u0026#34; DNSPod（国密标准（SM2））\t0 issue \u0026#34;wotrus.com\u0026#34;\t0 issuewild \u0026#34; wotrus.com\u0026#34; 推荐 dnspods 小泽的 https://r2wind.cn/articles/20221006.html https://r2wind.cn/articles/20220808.html\nssl详细查询\nhttps://www.racent.com/ssl-check?domain=www.leiyanhui.com\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/domian-ssl-caa/","title":"域名ssl和caa记录等知识记录整理"},{"content":"在github上快速部署一个基于hugo的个人博客 直接在github上搭建一个博客\n第一次还是需要 本地装一次 hugo，我用的archlinux\nyay -S hugo hugo new site myblog ls myblog 找一个自己喜欢的主题\n网站：https://themes.gohugo.io/ 或者github 搜索 hugo theme 有些 theme-demo 文件夹中会有 demo 或 example 目录，文件结构与新建的 Hugo 项目的文件结构几乎是一样的，这样设置是为了用户的配置可以覆盖掉主题的配置。\n我选中了一个主题，下载到 themes文件夹里面\ncd myblog git clone https://github.com/chipzoller/hugo-clarity.git themes/hugo-clarity cp -rf themes/hugo-clarity/exampleSite/* . #\\cp -rf themes/hugo-clarity/exampleSite/* . 把 myblog 里面的文件 上传到\n新建一个 公开库 hugo\n在 github上新建文件 如果复制出错 查看官方手册\n.github/workflows/gh-pages.yml 可以从我这里复制 https://github.com/joyanhui/file.leiyanhui.com/blob/main/github-actions/hugo/public-to-gh-pages.yml\n等待一会 github 执行完成后 会 自动创建一个 gh-pages 分支 里面是静态 文件，开启pages服务就好了\n打开 https://joyanhui.github.io/hugo/ 查看\n如果想要从一个私有库自动推送到一个共有库，先参考 之前的文章配置 ssh key 和变量，在修改\n如果你复制出错，可以参考我的一个备份\nhttps://github.com/joyanhui/file.leiyanhui.com/blob/main/github-actions/hugo/Private-to-public.yml\n","date":"2022-10-22T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/hugo-install-nolocal/","title":"在github上快速部署一个基于hugo的个人博客"},{"content":"输入法的选择 输入法的选择 先说结论 rime为主，独立帐号的百度输入法 辅助\n本文最后一次更新2022年11月29日。 win linux 已经 全部切换到 rime。安卓有客户端，但是研究过怎么用，我安卓是备用电话机。。 ios 暂时还是用的百度输入法。 美区有iRime (没开源国区下架了)1.99刀，可以用。 linux下偶尔也用fcitx-googlepinyin 比较轻量\n优点:\n流畅 非常非常流畅，哪怕momo7w这种N年前都百元平板上都可以流畅输入 无隐私问题 字库可以自己git 或者 坚果云 备份 除了ios之外所有平台可用 皮肤可以自定义 可以自行配置 扩展性很强 开源 快平台 标准词库格式 缺点：\n新人初次上手难度大 需要设置的地方多 部分配置需要自行修改配置文件 没有云输入，也就是新鲜热词词库是没有的 linux不支持fcitx-cloudpinyin 官网地址：https://rime.im 下载链接：https://rime.im/download/ win下叫做 小狼毫 linux下可选 fcitx-rime(第三方) 或者 ibus-rime ===========以下是旧文章================\n再说原因 win mac ios 安卓 部分Linux桌面版可以用 词库过得去 ios下基本完美 语音识别准确率过得去\n不选择其他的原因 · QQ拼音 不支持非Linux 和mac 不考虑 · 搜狗拼音且不说广告【百度拼音可以说没有】，ios下频繁消失的问题频繁出现 · 讯飞 mac和linux支持不好 · 搜狗 另外在多数linux发行版上面没有词库同步\n#再说缺点\n· 李彦宏家的 这货\u0026hellip; 隐私问题 独立账号登陆吧 · 设置同步 好像有逻辑问题，比如候选词9个，就不行 · 有时候按错键莫名其妙插入emjo表情，在一些在线编辑器就成了上传图片 · 没有错键识别纠正，比如 jiuzheng 我如果按成kiuzheng 不会自动纠正\n","date":"2022-10-22T06:14:20+08:00","permalink":"https://dev.leiyanhui.com/c/inputexe/","title":"输入法的选择，win linux macos 安卓 ios "},{"content":"Linux挂代理 Linux 临时挂代理 之前写过\n1 2 export http_proxy=\u0026#34;代理ip:代理端口\u0026#34; export https_proxy=\u0026#34;代理ip:代理端口\u0026#34; 可以在 一个windows 或docker 上跑一个允许lan的clash 就好了\n1 2 export http_proxy=\u0026#34;10.0.0.200:7890\u0026#34; export https_proxy=\u0026#34;10.0.0.200:7890\u0026#34; 另外一个代理\n1 2 export http_proxy=\u0026#34;10.0.0.9:7890\u0026#34; export https_proxy=\u0026#34;10.0.0.9:7890\u0026#34; 临时取消代理 1 2 unset http_proxy unset https_proxy 全局代理 1 2 3 4 5 6 7 8 9 10 11 12 nano /etc/profile export http_proxy=\u0026#34;http://10.0.0.200:7890/\u0026#34; export https_proxy=\u0026#34;http://10.0.0.200:7890/\u0026#34; export ftp_proxy=\u0026#34;http://10.0.0.200:7890/\u0026#34; export no_proxy=\u0026#34;localhost,127.0.0.1,10.0.0.1/255.255.255.0,*.leiyanhui.com, ::1\u0026#34; source /etc/profile ","date":"2022-10-18T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/linux-proxy/","title":"Linux 临时挂代理"},{"content":"nginx反代cf gitbook的502和403错误 需要手动编辑代理部分的配置文件,添加内容\n1 2 proxy_ssl_name www.leiyanhui.com; proxy_ssl_server_name on; ","date":"2022-10-18T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/nginx-proxy_pass-502/","title":"nginx反代cf gitbook的502和403错误"},{"content":"pve kvm 等usb 设备直通 需要注意是，pvm直通usb到虚拟机 常用的两种方式\n针对设备 无论设备插到那个端口都可以转到虚拟机，但是需要重启一次虚拟机才可以。 针对usb口 指定的usb口分给虚拟机 要先插到usb口 再添加 针对usb3口，如果想usb2和usb3 都可以用 需要分别插入两种设备，逐个添加。否则不认识。 ","date":"2022-10-18T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/kvm-usb/","title":"pve kvm 等usb 设备直通"},{"content":"kvm、pve、unraid 压缩磁盘 pve虚拟的磁盘 在\n/var/lib/vz/images/102#\n1 2 3 4 5 6 cd /var/lib/vz/images/102 ls -lh total 7.8G -rw-r----- 1 root root 33G Oct 9 11:12 vm-102-disk-0.qcow2 #转化 就是压缩，但是并不会压缩太多，因为虚拟机内的操作系统删除的文件只是标识删除并没有写0 qemu-img convert -c -O qcow2 vm-102-disk-0.qcow2 vm-102-disk-0-compact.qcow2 虚拟机机内部压缩虚拟磁盘 下面操作在虚拟机进行\nlinux虚拟主机 禁用swap并清零 以archlinux为例\n1 swapon -s partition 1010172 0 100 临时禁用 swap 文件并清零：\n1 2 3 4 swapoff /some/swap/file dd if=/dev/zero of=/some/swap/file bs=1M count=1024 sync mkswap /some/swap/file 我这个明显是分区，所以\n临时禁用 swap 分区并清零：\n1 2 3 4 swapoff /dev/zram0 dd if=/dev/zero of=/dev/zram0 sync mkswap /dev/zram0 提示 No space left on device 就是ok了\n清理缓存文件 arch 的主要是 pacman有一点\n1 pacman -Scc fdisk -l 查看一下分区 df -h 查看挂载情况 然后用空白文件逐个填充,我这里 其实就一个分区\nsync 命令保证文件内容真正写到磁盘上而不是被缓存。\n1 2 3 4 dd if=/dev/zero of=/bigfile sync rm /bigfile sync 另外一个centos7的主机\n1 2 3 4 5 6 7 8 9 swapon -s # /www/swap /dev/dm-1 swapoff /www/swap dd if=/dev/zero of=/www/swap bs=1M count=1024 swapoff /dev/dm-1 dd if=/dev/zero of=/dev/dm-1 sync dd if=/dev/zero of=/bigfile rm /bigfile sync 关机\nwindows虚拟主机 1、dism++ 删除多余的appx文件，清理 2、关闭虚拟内存 重启 3、磁盘整理，磁盘管理压缩分区 4、关机\n最后执行前面的 转化命令 就ok了\n1 2 3 4 5 6 qemu-img convert -c -O qcow2 vm-102-disk-0.qcow2 vm-102-disk-0-compact.qcow2 cp vm-102-disk-0-compact.qcow2 /mnt/hdd/kvm-bak/archlinux-vm-102-disk-0.qcow2 mv vm-102-disk-0.qcow2 vm-102-disk-0.qcow2-bak mv vm-102-disk-0-compact.qcow2 vm-102-disk-0.qcow2 一个安装了 xrdp 搜狗输入法 微软全部字体 火狐 edge 和 kde完整桌面 以及一些基本工具的磁盘 大小 只有3.2G\n","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/kvm-pve-unraid-compact-vdisk/","title":"kvm、pve、unraid 压缩磁盘"},{"content":"maccms 修改采集标题栏，让浏览器标签可以显示采集进度 /application/admin/controller/Collect.php\npublic function vod($param)\n函数 最后一段 280行\n1 model(\u0026#39;Collect\u0026#39;)-\u0026gt;vod_data($param,$res ); 在这行代码之前添加\n1 mac_echo(\u0026#39;\u0026lt;title\u0026gt;\u0026#39;.$param[\u0026#39;page\u0026#39;].\u0026#39;/\u0026#39;.$res[\u0026#39;page\u0026#39;][\u0026#39;pagecount\u0026#39;].\u0026#39;\u0026lt;/title\u0026gt;\u0026#39;); 已经反馈给作者，作者在新版已经采纳\n","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/c/70/","title":"maccms 修改采集标题栏，让浏览器标签可以显示采集进度"},{"content":"pve unraid 等kvm手动安装黑苹果 本文迁移到 pve unraid 等kvm手动安装黑苹果\n","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/pve-kvm-macos/","title":"pve unraid 等kvm手动安装黑苹果"},{"content":"pve、kvm安装的macos 基本优化：opencore 迁移到虚拟硬盘 并进行基本操作 请查看新版：在pve上直接安装macos13Ventura 初步优化并直通显卡 蓝牙 wifi 声卡给macos\n前面 已经完成的 在pve的kvm平台上手动安装macos12 并完成了基本设置，\n因为后面需要macos能自动启动 不需每次选启动盘，并还需要给它添加一下驱动，以便能使用我们的显卡和蓝牙wifi等。所以必须要把opencore迁移到虚拟磁盘上，方便修改。而不是iso文件\n分离 Monterey-recovery.img 首先从 pve中 分离前面挂载的 Monterey-recovery.img 这个是系统恢复镜像，现在已经用不到了\n然后 启动macos\n用pve的vnc或者 用第三方工具连接已经打开屏幕共享的macos，打开mcaos的终端\ndd opencore到虚拟硬盘 查看分区情况\n1 diskutil list disk1 是macos主盘，disk2 是opencore 的iso模拟的硬盘 disk1 是macos的引导\n用DD命令吧opencore 分区拷贝到 disk1\n1 sudo dd if=/dev/disk2s1 of=/dev/disk0s1 然后关机 pve 里面删除 opencore的iso，启动测试\n如果跳转到了 efi命令行，检查一下 pve里面虚拟机设置 选择 引导顺序 选中 VirtIO 对应虚拟磁盘\nopencore 自动选择 虚拟硬盘启动 需要用第三方工具 我这里选择 https://github.com/ic005k/OCAuxiliaryTools/releases\n从macos里面 用safari下载\n1 https://ghproxy.com/https://github.com/ic005k/OCAuxiliaryTools/releases/download/20220235/OCAT_Mac.dmg dmg下载后 把 OCAuxiliaryTools 拖到访达的应用程序里面 后面会经常用的\n打开 OCAuxiliaryTools，编辑 挂载 esp分区，打开配置文件\nOCAuxiliaryTools 会报错，还是用 ProperTree\nProperTree下载 可以直接用我的 https://github.com/joyanhui/file.leiyanhui.com/blob/main/pve-unraid-kvm/ProperTree.app.zip ，或自己编辑 https://github.com/corpnewt/ProperTree\n直接zip下载回来\n安装Python3.10 macOS https://www.python.org/downloads/release/python-3100/\n这个下载速度也很拉胯,建议挂一下代理 macos的代理设置 在 系统偏好设置 网络 高级 代理\n编译ProperTree 打开访达 找到下载的 ProperTree/Scripts/buildapp-select.comm 运行 信任 仍旧打开\n提示选择Python 版本 选择 3.10 ，自动编译到上级目录。 拖动到 访达的应用程序\n打开 opencore配置文件 改为自动跳过 直接用OCAuxiliaryTools 挂载efi 或者用 终端挂载 Misc-\u0026gt;Boot-\u0026gt;showpicker 改为 false\n就是关闭 选 由opencore 自动判断\n或者 改为 倒计时\nopencore 倒计时启动 前面的 showpicker 不修改，保持是 true Misc-\u0026gt;Boot-\u0026gt;Timeout 改为3-5秒的数字，\nMISC-\u0026gt;Security-\u0026gt;AllowSetDefault 改为ture\n菜单栏 file 保存\n在pve 重启macos 引导界面的时候 选中 启动硬盘，然后按下ctrl+回车 就会记住，以后会倒计时后自动使用这个硬盘\n注意 opencore 是不显示倒计时时间的，具体怎么显示\n另外 macos里面的引导磁盘的设置 容易导致混乱也不建议使用\n参考资料 和 进阶 pve、kvm手动安装macos\npve、kvm安装的macos 基本优化：opencore 迁移到虚拟硬盘\npve、kvm安装的macos 基本优化：显卡直通到macos\npve、kvm安装的macos 基本优化：蓝牙和wifi直通到macos\npve usb设备和端口直通\n1 2 3 4 5 6 7 流程图 https://www.processon.com/view/link/61b325221e08534ef3f1658d https://www.mfpud.com/topics/8076/ github上的OSX-KVM，几乎可以在任何的linux系统下虚拟化安装黑苹果:https://github.com/kholia/OSX-KVM pve：https://pve.proxmox.com/wiki/Downloads 一个英文参考教程：https://www.nicksherlock.com/2021/10/installing-macos-12-monterey-on-proxmox-7/ 一个视频教程：https://www.bilibili.com/video/BV1uq4y1g7ui 这个视频教程的第二部分：https://www.bilibili.com/video/BV1ML411E7eH/ ","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/macos/kvm-macos-opencore-to-disk/","title":"pve、kvm安装的macos 基本优化：opencore 迁移到虚拟硬盘 并进行基本操作"},{"content":"win11 下 设置自定义分辨率 方便远程适配的方法 intel核显 windows远程桌面 可以通过编辑 rdp文件的方法 随意设置分辨率 并且也支持缩放，不存在这个文件。但是在如下使用场景，比如 WindowsHello 某些3D加速程序，，因为Windows 远程桌面 某些功能不支持 所以需要使用第三方远程桌面软件 比如 todesk 向日葵等。但是全屏的话 和 控制机之间交互不方便，不全品的话 分辨率 太低 用起来别扭。 https://www.intel.cn/content/www/cn/zh/download-center/home.html 搜索显卡型号 6代以上 直接 下载 https://www.intel.cn/content/www/cn/zh/download/19344/intel-graphics-windows-dch-drivers.html?wapkw=%E8%8B%B1%E7%89%B9%E5%B0%94%20uhd%20630%20%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8 安装完成后重启电脑，开始菜单 找到 intel显卡控制中心，找到左侧 显示屏的图标，然后 右侧点击添加分辨率 用截图工具先在 todesk远程窗口 查看一下窗口大小 大概是 1920x1015 添加分辨率\n定时模式 cvt 宽度1920 高度1000 刷新率60 各行扫码 打开 欠扫描备份率0 试过 1920x1015 不行，暂时就用1920x1000了 其他分辨率 自己 多测试一下， 方法 就是 宽高先用 就近的目标分辨率，调试后 在 从附近的数组 凑整数 后发现 直接从todesk调低分辨率 更简单 平时还是用 rdp协议 所以，删除此文\n","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/c/62/","title":"win11 下 设置自定义分辨率 方便远程适配的方法 intel核显"},{"content":"非macos系统 浏览器的选择 除了safari 哪个浏览器是我们的主浏览器？ 最简单的 莫过于 在win下 用edge/chrome 在mac ios下 用safari+edge/chrome 但是书签 历时记录(跨屏浏览)和用户密码的同步 一直是一个麻烦。 safari 在ios 和 mac下的深度同步，确实爱不释手。但是 win和linux下 无法使用。 但是 icloud最近的更新支持了密码的 同步（需要hello id 可以管理，但是可以单向同步） 书签同步却不支持 edge， 其实 书签的问题 好解决，无非就是手动导入导出，但是密码的问题 缺很麻烦。 iCloud 密码 • 在“iCloud 密码” App 中查看和管理 Windows PC 上的密码。 • 在 Chrome 或 Edge 中使用 iCloud 密码扩展保存密码并在设备和 PC 之间同步。 iCloud 邮件、通讯录、日历和书签 • 使邮件、通讯录和日历在您的所有设备（包括 PC）之间保持最新。 • 与其他 iCloud 用户共享日历。 • Internet Explorer、Firefox 和 Google Chrome 书签自动在 Safari 浏览器中保持最新。\nedge 优点 系统自带 免翻墙 没国产那些浏览器的广告 和隐私问题 可以 从mac下同步密码到这边 缺点 无法和safari 书签同步 偶尔会出现无法登录 挂全局代理也不行 重启 都无效 \u0026gt; 经过测试，可以解决 https://dev.leiyanhui.com/c/60 chrome 没国产那些浏览器的广告 和隐私问题 其他不用说了 缺点 唯一一个 也是最致命的！ 需要挂梯子同步 我的最终选择 firefox 因为完全开源，多数linux系统不需要第三方库 就可以使用\n不需要更新系统到最新版 就可以登录同步（edge有这个问题）\nlinux 下很容易打开硬件加速\n","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/c/59/","title":"非macos系统 浏览器的选择 除了safari 哪个浏览器是我们的主浏览器"},{"content":"蓝牙和wifi 直通 参考资料 和 进阶 pve、kvm手动安装macos\npve、kvm安装的macos 基本优化：opencore 迁移到虚拟硬盘\npve、kvm安装的macos 基本优化：显卡直通到macos\npve、kvm安装的macos 基本优化：蓝牙和wifi直通到macos\npve usb设备和端口直通\n1 2 3 4 5 6 7 流程图 https://www.processon.com/view/link/61b325221e08534ef3f1658d https://www.mfpud.com/topics/8076/ github上的OSX-KVM，几乎可以在任何的linux系统下虚拟化安装黑苹果:https://github.com/kholia/OSX-KVM pve：https://pve.proxmox.com/wiki/Downloads 一个英文参考教程：https://www.nicksherlock.com/2021/10/installing-macos-12-monterey-on-proxmox-7/ 一个视频教程：https://www.bilibili.com/video/BV1uq4y1g7ui 这个视频教程的第二部分：https://www.bilibili.com/video/BV1ML411E7eH/ ","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/macos/kvm-macos-wifi-bluetooth/","title":"蓝牙和wifi 直通"},{"content":"无服务器0费用部署mdbook 搭建个人博客 mdbook简单易用，但是模板和扩展较少，已经逐步升级到hugo上\n思路 利用 github的Actions，实现自动编译 使用github的pages，部署静态网站 使用域名dns的解析\n优点 不需要另外弄服务器，几乎可以说是完全免维护 ，这条就覆盖了所有缺点了\n缺点 几乎没有 Actions 执行速度 有点慢 一开始弄错了脚本差不多需要8分钟才能更新 后续重新处理了一下 把Actions速度压缩到8-10秒左右，另外，，github pages的自动更新大概需要45-48秒，速度已经很可观了\n国内访问速度慢 可以dns分区域解析 国内备案后套cdn来解决\n国内编辑速度也有点慢 解决方法 本地编辑挂代理推送 使用gitee目前免费的镜像同步功能，自动推送到github ，gitee默认大概30分钟左右同步提交一次 也可以 用其他的支持deops的git自动提交给github 当然，直接挂梯子简单又靠谱\n开始搞 打开 github 创建一个库\n内容部分 至少需要一个文件 /src/SUMMARY.md 内容要符合mdbook的标准。\n1 2 3 # Table of contents - [首页](README.md) 另外 简单弄一个首页文件 /src/README.md 内容随意\n再创建自动化文件 github默认使用这个文件夹下的文件来执行 .github/workflows/mdbook.yml 内容\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 name: mdbook on: push: branches: - main jobs: mdbook_build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 with: fetch-depth: 0 - name: 安装 mdbook run: | mkdir mdbook curl -sSL https://github.com/rust-lang/mdBook/releases/download/v0.4.14/mdbook-v0.4.14-x86_64-unknown-linux-gnu.tar.gz | tar -xz --directory=./mdbook echo `pwd`/mdbook \u0026gt;\u0026gt; $GITHUB_PATH - name: 编译 mdbook run: | mdbook build - name: 文件处理 run: | git worktree add gh-pages #mkdir gh-pages cd gh-pages echo \u0026#34;删除 ref 以避免保留历史记录\u0026#34; rm -rf * mv ../book/* . echo \u0026#34;处理独立域名的绑定 CNAME文件\u0026#34; echo \u0026#34;dev.leiyanhui.com\u0026#34; \u0026gt;\u0026gt; CNAME - name: 部署 run: | git config user.name \u0026#34;joyanhui\u0026#34; git config user.email \u0026#34;joyanhui@qq.com\u0026#34; git init #git checkout -b main git add -A git commit -m \u0026#34;自动生成 $GITHUB_SHA to gh-pages\u0026#34; echo \u0026#34;推送 \u0026#34; git push origin gh-pages -f -q 然后打开 https://github.com/你的用户/仓库名/actions\n查看 这个ci运行情况\n前面需要编译一些东西，所以速度很慢 耐心等待\n上面 会自动创建一个分支 branch: gh-pages 里面是html文件\n然后 pages 定位到这个分支 就可以了\n进阶 使用私有库保护源码 github的私有库开通pages 是收费的\n点击这里查看私有库免费pages方法\n国内访问和管理加速 点击自动部署在github上的 mdbook 或者 hexo等 国内访问加速的方法\n其他问题 一些错误 1 Error: The deploy step encountered an error: The process \u0026#39;/usr/bin/git\u0026#39; failed with exit code 128 如果绑定独立域名的话 还需要 在/book/ 里面创建一个CNAME文件，内容 就是域名，不然每次会自动删除\n在前面的 mv ../book/* . 之前添加一行\n1 echo \u0026#34;dev.leiyanhui.com\u0026#34; \u0026gt;\u0026gt; ../book/CNAME 参考：https://github.com/rust-lang/mdBook/wiki/Automated-Deployment:-GitHub-Actions\n","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/auto-github/","title":"无服务器0费用部署mdbook 搭建个人博客 "},{"content":"自动部署在github上的 mdbook 或者 hexo等 国内访问加速的方法 国内访问加速 如果是备案的域名 用国内cdn 加速就好了，没备案。。。那就香港主机反代，套cf\ndnspod 境内cname指向到cdn 境外直接到 xxx.github.io\n这个不用具体说\n国内md源文件在线管理加速方法 github 挂梯子当然可以，但是不是所的环境都有梯子的，所以 利用国内镜像\ngitee 目前镜像是免费的，但是 gitee 真的很懒，只是他起步比较早 私有库的话真的无所谓他家的\n在线编辑 md文件 压根没有代码高亮，真不知道gitee咋想的！\nmd文件里面的外联 会被gitee 套前缀地址 这个倒是优化的停积极的！\n另外 gitee 自动推送到 github的速度很慢，一个小的修改 有时候很快2-3分钟，有时候可能要10分钟\ngitee 之前的不通知 直接取消pages外联事件 就更别提了，当然 Gitee禁图床不应当是“差评”它的理由，但是你三天两头故障，连个恢复进度也没有，社区反馈你让去qq群，qq群管理员装死，连个公告也没有\n还有 动则 政策限制违规文件。。。\n下载一个小文件，你突然没通知 不提醒，突然有一天就给一个html登录页\n功能该来该去，原有的功能 突然就无通知直接割掉\ngitcode 虽然 很多人 烦csdn，但是gitcode 真的还不错，界面清爽，目前也支持镜像功能，但是我配置很久一直是授权错误。\n无论用ssh 还是 http令牌，随之放弃\ncoding 可以用 devop自动推送，但是。。自从被腾讯收购后。。。。\n另外 coding 从 github 直接clone的话 有概率失败，网络不稳定\n执行时间，也从以前的 每个月 3000分钟，逐步 被腾讯优化到 1000分钟，现在又变成300分钟了。。。\n不过300分钟 勉强也够用。。 但是coding的在线编辑也有诸多问题，与github天差地别，堪称垃圾\n如果你觉得还好，可以参考这个文章配置 coding自动同步到github\ncodeup 阿里收购后，看的迷糊。。。 不会用他的自动同步。。。\n","date":"2022-10-09T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/github-cdn-and-mirror/","title":"自动部署在github上的 mdbook 或者 hexo hugo 等 国内访问加速的方法"},{"content":"pve unraid 等kvm手动安装黑苹果 如果你pve 可以直接查看最新版程 直接安装macos13的教 unraid市场有插件可以直接用docker安装黑苹果，但是因为收费 以及 神烦的网络问题，我换到了pve，同样都是基于kvm的使用方法 大同小异\n首先知道 kvm安装黑苹果需要的两个东西 1、opencore 引导盘 2、macos 安装盘 其次，要知道 一个关键的显卡问题，确定你显卡支持macos ，另外pve 最好是uefi启动的，不然后面显卡直通会问题。\n我这里 是 qnct的CPU是魔改U 核显是u630\n基本流程 获取最新opencore \u0026gt; 用lxc容器获取macos恢复镜像 -\u0026gt; 创建虚拟机 -\u0026gt; 安装macos -\u0026gt; 优化 opencore硬盘化 显卡直通等\n先解决 基本的 opencore 放到pve目录的iso目录，unraid的话放到 放到isos目录就好\n1 2 3 cd /var/lib/vz/template/iso/ wget https://ghproxy.com/https://github.com/thenickdude/KVM-Opencore/releases/download/v19/OpenCore-v19.iso.gz gzip -d OpenCore-v19.iso.gz 这个iso文件其实是一个硬盘镜像，只是后缀名 是iso。不过为了方便，后期我们最好还是把他挪到单独的一个磁盘镜像文件里面\n然后获取macos安装镜像 有几个方法， 1 是用GitHub的OSX-KVM https://github.com/thenickdude/OSX-KVM.git 2 是用 Install\\ macOS\\ Ventura\\ beta.app 自己做 ， 3 是从小兵 远景 sysin 等直接拖 推荐 sysin 的，免费更新快 4 直接下载苹果的dmg文件\n使用 OSX-KVM 获取安装镜像 先搞一下lxc ，用lxc是为了避免影响pve宿主系统\n1、下载容器模板 pve local CT模板 模板 搜索 ubuntu 找到 ubuntu18.04 下载 手动下载地址：http://download.proxmox.com/images/system/ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz 或者 修改 CT Templates (LXC 容器) 源# 将 /usr/share/perl5/PVE/APLInfo.pm 文件中默认的源地址 http://download.proxmox.com/images 替换为 https://mirrors.tuna.tsinghua.edu.cn/proxmox/images 即可。 也可以\n1 2 cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back sed -i \u0026#39;s|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g\u0026#39; /usr/share/perl5/PVE/APLInfo.pm 重启\n1 systemctl restart pvedaemon.service 然后重新下载即可\n2、创建一个lxc\n容器名称 ubuntu18 密码 记住 这个密码是容器的root密码\n模板选ubuntu18这个\n磁盘大小16G\ncpu 给几个 无所谓给4个\n内存swap都给1024\n网络dhcp 就和我 启动这个容器\n控制台 用root 和上面的密码登录\n3、处理这个ubuntu系统\n更换国内源\n1 2 3 4 5 6 7 8 9 10 11 12 13 # nano /etc/apt/sources.list deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse #apt update #apt upgrade 清华源,好像已经停止 18.04的支持 暂时用阿里的吧 安装 需要的软件\n1 sudo apt install qemu-utils make git 4、克隆 如果克隆不了，自己想办法挂一下代理 linux挂代理方法\n1 2 cd ~ git clone https://github.com/thenickdude/OSX-KVM.git 5、获取恢复镜像\nmonterey macos 12\n1 2 3 4 5 unset http_proxy #取消代理 unset https_proxy #取消代理 cd ~/OSX-KVM/scripts/monterey make Monterey-recovery.img # 实际下载地址是 http://oscdn.apple.com/content/downloads/36/25/012-40515/f7fz3ubbup5g6lr4yj1x36xydr0fuwomkl/RecoveryImage/BaseSystem.dmg 6、拖动img 到pve 登录pve ssh\n1 2 pct pull 105 /root/OSX-KVM/scripts/monterey/Monterey-recovery.img /var/lib/vz/template/iso/Monterey-recovery.img # 关掉ubuntu 105 是ubuntu容器编号\n官网下载地址 Monterey http://oscdn.apple.com/content/downloads/36/25/012-40515/f7fz3ubbup5g6lr4yj1x36xydr0fuwomkl/RecoveryImage/BaseSystem.dmg Ventura Beta 10 https://swcdn.apple.com/content/downloads/02/20/012-83064-A_ITH2OUJKVC/dxpszsfokj0cxhpk0vndqs18fjiejer3sf/InstallAssistant.pkg\n非Ventura的版本，网上都可以找到官网的dmg链接 自己转换成img即可\n1 2 3 qemu-img convert BaseSystem.dmg -O raw BaseSystem.img #移动到iso里面备用 mv BaseSystem.img /var/lib/vz/template/iso/Monterey-install.img 创建一个虚拟机 以kvm说明 操作系统 ： other iso文件：就是那个 OpenCore-v18.iso\n显卡：Vmware兼容 Qemu代理：勾选 BIOS：UEFI UEFI下面：预注册密钥 去掉 机器：q35\n总线：VirtIO 缓存：Write Back（不安全） 100G\nCPU核心: 是2的次幂 2 4 8 16 我12核心的,只能给8 类型：penryn Numa启用\n网络模型：virtIO\n创建了一个虚拟机103\n添加一个cdrom 到 Monterey-install.img\n修改配置文件 还需要修改一下pve 据说是防止重复引导的\n1 echo \u0026#34;options kvm ignore_msrs=Y\u0026#34; \u0026gt;\u0026gt; /etc/modprobe.d/kvm.conf \u0026amp;\u0026amp; update-initramfs -k all -u 1 nano /etc/pve/qemu-server/103.conf 在第二行添加\n1 2 3 4 5 6 7 8 9 10 11 12 intel: args: -device isa-applesmc,osk=\u0026#34;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026#34; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -cpu host,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc # 我的 参考 https://www.nicksherlock.com/2021/10/installing-macos-12-monterey-on-proxmox-7/ args: -device isa-applesmc,osk=\u0026#34;THE-OSK-YOU-EXTRACTED-GOES-HERE\u0026#34; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -global ICH9-LPC.acpi-pci-hotplug-with-bridge-support=off args: -device isa-applesmc,osk=\u0026#34;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026#34; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -global ICH9-LPC.acpi-pci-hotplug-with-bridge-support=off -cpu host,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc AMD: args: -device isa-applesmc,osk=\u0026#34;这里得自己找~\u0026#34; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -cpu Penryn,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc,+pcid,+ssse3,+sse4.2,+popcnt,+avx,+avx2,+aes,+fma,+fma4,+bmi1,+bmi2,+xsave,+xsaveopt,check 我的配置文件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 agent: 1 args: -device isa-applesmc,osk=\u0026#34;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026#34; -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -global ICH9-LPC.acpi-pci-hotplug-with-bridge-support=off -cpu host,kvm=on,vendor=GenuineIntel,+kvm_pv_unhalt,+kvm_pv_eoi,+hypervisor,+invtsc bios: ovmf boot: order=ide2;ide0 cores: 8 cpu: Penryn efidisk0: local:103/vm-103-disk-0.qcow2,efitype=4m,size=528K ide0: local:iso/Monterey-recovery.img,cache=unsafe,size=3144712K ide2: local:iso/OpenCore-v18.iso,cache=unsafe,size=150M machine: q35 memory: 8196 meta: creation-qemu=6.2.0,ctime=1665305756 name: macos net0: virtio=C6:73:64:FE:9A:61,bridge=vmbr0,firewall=1 numa: 1 ostype: l26 scsihw: virtio-scsi-pci smbios1: uuid=12a3b6e3-0fd3-41b0-942d-0a9591ca7f86 sockets: 1 vga: vmware virtio1: local:103/vm-103-disk-1.qcow2,cache=unsafe,size=100G vmgenid: d20a41e9-6bc5-4995-b785-f70a905fa727 然后下面的cdrom 两个 media=cdrom 删掉改为 cache=unsafe\n安装 先格式磁盘，然后安装，重启过程中一直选择 macos install，指导没有 macos install之后，选之前分区的时候 设置的盘符\n进去系统设置 中文，修改时区和时间\n更改电脑的名称或本地主机名\n更新一下系统，主要是 Safari更新到16， 安装一个第三方远程工具，我这里选择todesk ，打开 共享 远程管理，添加管理员账户，给全部权限，然后再 电脑设置里面 开启vnc 输入一个密码。 用另外一个电脑测试vnc是否可以连接，如果可以 关机。就好了\n进阶 先备份一下 虚拟磁盘 vm-103-disk-1.qcow2 可以压缩一下 kvm磁盘管理 cd /var/lib/vz/images/103#\n后面需要把opencore弄到虚拟磁盘，方便进一步编辑处理（加驱动之类的），以及显卡直通 wifi蓝牙直通\n常见问题 白苹果logo: 核心数 或者前面args参数有问题 lxc镜像下载失败:挂代理或者参考前面修改lxc的源 github clone失败:挂代理 参考资料 和 进阶 pve、kvm手动安装macos\n请查看新版：在pve上直接安装macos13Ventura 初步优化并直通显卡 蓝牙 wifi 声卡给macos\npve、kvm安装的macos 基本优化：opencore 迁移到虚拟硬盘\npve、kvm安装的macos 基本优化：显卡直通到macos\npve、kvm安装的macos 基本优化：蓝牙和wifi直通到macos\npve usb设备和端口直通\n1 2 3 4 5 6 7 流程图 https://www.processon.com/view/link/61b325221e08534ef3f1658d https://www.mfpud.com/topics/8076/ github上的OSX-KVM，几乎可以在任何的linux系统下虚拟化安装黑苹果:https://github.com/kholia/OSX-KVM pve：https://pve.proxmox.com/wiki/Downloads 一个英文参考教程：https://www.nicksherlock.com/2021/10/installing-macos-12-monterey-on-proxmox-7/ 一个视频教程：https://www.bilibili.com/video/BV1uq4y1g7ui 这个视频教程的第二部分：https://www.bilibili.com/video/BV1ML411E7eH/ ","date":"2022-10-08T00:00:00Z","permalink":"https://dev.leiyanhui.com/macos/kvm-macos-install/","title":"pve unraid 等kvm手动安装黑苹果"},{"content":"vhd转换给pve 并挂载给虚拟机 find / -name vm-100-disk*\n知道了路径 /var/lib/vz/images/100/\n1 2 #开始转换 hdd是机械盘，需要一点时间 qemu-img convert -p -f vpc -O qcow2 /mnt/hdd/system-vhd-bak/SOFT.vhd /var/lib/vz/images/soft.qcow2 导入硬盘\n我这里导入给 100这个虚拟机\n1 2 3 #qm importdisk 300 /root/test.img local-lvm --format raw qm importdisk 100 /var/lib/vz/images/soft.qcow2 local --format qcow2 上面的命令 会把 soft.qcow2 导入到 /var/lib/vz/images/100/vm-100-disk-3.qcow2 不是我想要的结果\n在pve面板中 添加一个虚拟磁盘，容量默认 VirtIO Block 也是在 /var/lib/vz/images/100/vm-100-disk-3.qcow2\n然后点分离,删除这个虚拟磁盘，然后做软连接\n1 2 rm /var/lib/vz/images/100/vm-100-disk-3.qcow2 ln -s /var/lib/vz/images/soft.qcow2 /var/lib/vz/images/100/vm-100-disk-3.qcow2 然后双击 未使用的磁盘 vm-100-disk-3.qcow2 添加一个虚拟磁盘 ，虚拟机中就可以看到了\n依次处理\n1 2 3 4 5 6 qemu-img convert -p -f vpc -O qcow2 /mnt/hdd/system-vhd-bak/Win-Setup.vhd /mnt/hdd/system-vhd-bak/Win-Setup.qcow2 rm /var/lib/vz/images/100/vm-100-disk-4.qcow2 ln -s /mnt/hdd/system-vhd-bak/Win-Setup.qcow2 /var/lib/vz/images/100/vm-100-disk-4.qcow2 给 soft.qcow2 扩容一下\n先分离 最好直接关机 qm stop 100 #关机 开机状态弄 有概率无法分离或者损耗镜像 qemu-img resize /var/lib/vz/images/soft.qcow2 +10G\n","date":"2022-10-08T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/vhd-pve/","title":"vhd转换给pve 并挂载给虚拟机"},{"content":"用vuepress和宝塔创建带搜索功能的静态文档站 已经全部换到基于github的 hugo\nvuepress 官网的文档很全了不在说明\n我这里用 vuepress-theme-hope主题来搞\n1 2 3 4 mkdir fish_doc cd fish_doc pnpm create vuepress-theme-hope@next docs 没有 pnpm的话先安装 pnpm\n可以选择中文，然后有一个博客主题 一个 docs主题，选择后者 最后一部 提示 是否查看 选 yes 打开 http://10.0.0.9:8080/\n基本搜索功能 /docs/src/.vuepress/config.ts import { searchPlugin } from \u0026lsquo;@vuepress/plugin-search\u0026rsquo;\nsearchPlugin({ \u0026lsquo;/\u0026rsquo;: { placeholder: \u0026lsquo;搜索\u0026rsquo;, isSearchable: (page) =\u0026gt; page.path !== \u0026lsquo;/\u0026rsquo;, }, }),\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import { defineUserConfig } from \u0026#34;vuepress\u0026#34;; import theme from \u0026#34;./theme.js\u0026#34;; import { searchPlugin } from \u0026#39;@vuepress/plugin-search\u0026#39; export default defineUserConfig({ base: \u0026#34;/\u0026#34;, title: \u0026#34;xxx\u0026#34;, description: \u0026#34;just so so ..\u0026#34;, port:\u0026#34;8902\u0026#34;, theme, plugins: [ searchPlugin({ \u0026#39;/\u0026#39;: { placeholder: \u0026#39;搜索\u0026#39;, isSearchable: (page) =\u0026gt; page.path !== \u0026#39;/\u0026#39;, }, }), ], shouldPrefetch: false, }); ","date":"2022-10-07T00:00:00Z","permalink":"https://dev.leiyanhui.com/new/vuepress-doc/","title":"用vuepress和宝塔创建带搜索功能的静态文档站"},{"content":"github 私有库 创建pages的 最简单的保姆级教程 本站 使用的mdbook ，其他 hexo 或者gitbook 都一样 一样\n2022-10-22 最终放弃简单易用的mdbook 换到 golang开发的 hugo上，\n关于 hugo私有库存 部署脚本 请查看 在github上快速部署一个基于hugo的个人博客\n首先第一步 是 创建一个 私有库，用来存放md文件 dev.leiyanhui.com-src 分支也只需要一个main\n再创建一个公开库 dev.leiyanhui.com-page 用来存放 生成后的html\n这两个库 可以在不同的帐号下，后面你自己替换这两个库名称，还有邮箱和用户名\n原理 在 dev.leiyanhui.com-page 打开github page 服务\n在 dev.leiyanhui.com-src 用 github actions 自动生成html并推送到 dev.leiyanhui.com-src\n首先你可能需要先搞定自动生产 先搞定 md到html的静态生成，无论是mdbook 还是 hexo，文章末尾 有提供 mdbook的 自动脚本 mdbook-公开库自己部署到自己.yml 放到 dev.leiyanhui.com-src/.github/workflows/ 文件后缀为yml 文件名无所谓\n本文默认 你已经会弄这个，如果不明白查看这个文章\n然后准备自动推送相关的 经过我测试https 推送 目前是存在问题的，还是建议 使用ssh推送\n在本机 先弄一套密钥 ssh-keygen -t rsa -C \u0026quot;joyanhui@qq.com\u0026quot; cd ~/.ssh cat id_rsa #这是私钥 记好 cat id_rsa.pub #这是公钥 记好 win环境下自己搞定\n再公开库 添加公钥 打开 公开库 dev.leiyanhui.com-page setting Deploy keys\n链接： https://github.com/joyanhui/dev.leiyanhui.com-page/settings/keys\n添加一个 Add new ，把前面 公钥 id_rsa.pub 的内容粘贴进来 名称随意\n在私有库 添加一个环境变量 存 私钥 打开 私有库 dev.leiyanhui.com-page setting secrets actions\n链接： https://github.com/joyanhui/dev.leiyanhui.com-src/settings/secrets/actions\n添加一个 New repository secret 大概意思 就是 加密变量\n名称随意，我这里使用 名称 FOR_PAGE_SSHKEY 内容填写 私钥id_rsa的内容\n修改私有库的自动部署actions workflows文件 编辑 私有库 mdbook-共有库自己部署到自己.yml 文件 在 env:添加 一个环境变量\nFOR_PAGE_SSHKEY: ${{ secrets.FOR_PAGE_SSHKEY }} 在 git commit 后面添加几行命令 自动部署私钥\nmkdir -p ~/.ssh/ echo \u0026quot;$FOR_PAGE_SSHKEY\u0026quot; \u0026gt; ~/.ssh/id_rsa chmod 600 ~/.ssh/id_rsa ssh-keyscan github.com \u0026gt;\u0026gt; ~/.ssh/known_hosts 在 git push origin 前面添加一个远程git\ngit remote rm origin git remote add origin git@github.com:joyanhui/dev.leiyanhui.com-page.git 这就可以了\n在合适的位置 还要 添加一个 删除 rm -rf .github 不然 公开库 也自动执行这个yml了，然后肯定会失败\n完整的配置文件 参考文末 mdbook-私有库自动部署到公开库pages.yml\n进阶 提升国内网访问 网站访问\n我用的dnspods 境外解析到 xxx.github.com 境内解析到 国内cdn cdn再指向xxx.github.com src文件在线编辑和上传 gitcode 也有 DevOps 可以用 gitee 自动推送到 github gitee默认提供 同步功能，目前还是免费的，但是gitee的md编辑器有点难用！ coding 自动推送到 github coding 有集成服务Jenkins 并且有香港和美国服务器让你运行集成服务代码，每个提供免费300分钟的执行时间，出发你一天24小时都在写都在提交 不然其实也够用。 hugo的自动部署 查看这里\n我在用的 github/workflows actions 脚本 dev.leiyanhui.com-src/.github/workflows/mdbook-公开库自己部署到自己.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 name: mdbook on: push: branches: - main jobs: mdbook_build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 with: fetch-depth: 0 - name: 安装 mdbook run: | mkdir mdbook curl -sSL https://github.com/rust-lang/mdBook/releases/download/v0.4.14/mdbook-v0.4.14-x86_64-unknown-linux-gnu.tar.gz | tar -xz --directory=./mdbook echo `pwd`/mdbook \u0026gt;\u0026gt; $GITHUB_PATH - name: 编译 mdbook run: | echo \u0026#34;编译\u0026#34; mdbook build echo \u0026#34;分支到 gh-pages\u0026#34; git worktree add gh-pages #mkdir gh-pages cd gh-pages echo \u0026#34;删除 ref 以避免保留历史记录\u0026#34; git update-ref -d refs/heads/gh-pages rm -rf * mv ../book/* . echo \u0026#34;处理独立域名的绑定 CNAME文件\u0026#34; echo \u0026#34;dev.leiyanhui.com\u0026#34; \u0026gt;\u0026gt; CNAME echo \u0026#34;推送到分支\u0026#34; git config user.name \u0026#34;joyanhui\u0026#34; git config user.email \u0026#34;joyanhui@qq.com\u0026#34; git init #git checkout -b main git add -A git commit -m \u0026#34;自动生成 $GITHUB_SHA to gh-pages\u0026#34; echo \u0026#34;推送 \u0026#34; git push origin gh-pages -f -q dev.leiyanhui.com-src/.github/workflows/mdbook-私有库自动部署到公开库pages.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 name: mdbook on: push: branches: - main jobs: mdbook_build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 with: fetch-depth: 0 - name: 安装 mdbook run: | mkdir mdbook curl -sSL https://github.com/rust-lang/mdBook/releases/download/v0.4.14/mdbook-v0.4.14-x86_64-unknown-linux-gnu.tar.gz | tar -xz --directory=./mdbook echo `pwd`/mdbook \u0026gt;\u0026gt; $GITHUB_PATH - name: 编译 mdbook env: FOR_PAGE_SSHKEY: ${{ secrets.FOR_PAGE_SSHKEY }} run: | echo \u0026#34;编译\u0026#34; mdbook build echo \u0026#34;分支到 gh-pages\u0026#34; git worktree add gh-pages #mkdir gh-pages cd gh-pages echo \u0026#34;删除 ref 以避免保留历史记录\u0026#34; git update-ref -d refs/heads/gh-pages rm -rf * mv ../book/* . echo \u0026#34;处理独立域名的绑定 CNAME文件\u0026#34; echo \u0026#34;dev.leiyanhui.com\u0026#34; \u0026gt;\u0026gt; CNAME echo \u0026#34;推送到分支\u0026#34; git config user.name \u0026#34;joyanhui\u0026#34; git config user.email \u0026#34;joyanhui@qq.com\u0026#34; git init #git checkout -b main git add -A git commit -m \u0026#34;自动生成 $GITHUB_SHA to gh-pages\u0026#34; echo \u0026#34;远程\u0026#34; mkdir -p ~/.ssh/ echo \u0026#34;$FOR_PAGE_SSHKEY\u0026#34; \u0026gt; ~/.ssh/id_rsa chmod 600 ~/.ssh/id_rsa ssh-keyscan github.com \u0026gt;\u0026gt; ~/.ssh/known_hosts git remote rm origin git remote add origin git@github.com:joyanhui/dev.leiyanhui.com-page.git #推送 git push origin gh-pages:main -f -q ","date":"2022-09-12T00:00:00Z","permalink":"https://dev.leiyanhui.com/mdbook/siyou/","title":"github 私有库 创建pages的 最简单的保姆级教程"},{"content":"deepin 安装 vscode server 服务器版 Code Server 并配置ssl加密 以及nginx反代 https://github.com/coder/code-server/releases\n加速 下载 https://gh.api.99988866.xyz/https://github.com/coder/code-server/releases/download/v4.5.0/code-server_4.5.0_amd64.deb\n双击安装 或者dkpg安装 然后启动 systemctl \u0026ndash;user start code-server systemctl \u0026ndash;user enable code-server vi ~/.config/code-server/config.yaml 修改密码 systemctl \u0026ndash;user restart code-server 内容：\nlocation / { proxy_pass http://127.0.0.1:8080; proxy_http_version 1.1; proxy_redirect off; proxy_set_header Host http://code.leiyanhui.com; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026quot;Upgrade\u0026quot;; proxy_connect_timeout 60; proxy_send_timeout 90; proxy_read_timeout 90; proxy_buffer_size 4k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; a dd_header X-Cache $upstream_cache_status; add_header Cache-Control no-cache; } 然后试着用http房屋 没问题了 了 再正常配置 ssl 就可以了 配置 开机自动启动 https://dev.leiyanhui.com/c/73\n","date":"2022-09-10T00:00:00Z","permalink":"https://dev.leiyanhui.com/c/72/","title":"deepin 安装 vscode server 服务器版 Code Server 并配置ssl加密 以及nginx反代"},{"content":"本文停止更新， 新地址：https://dev.leiyanhui.com/docker/docker-linux-desktop/\ndocker运行桌面linux系统，unraid 一开始 是打算自己弄的，后来发现还是挺麻烦的。。。\n于是看到这个 linuxserver/webtop - Docker Image | Docker Hub\ndocker原则上一个容器只允许一个服务。所以运行一个完整桌面系统，理论上符合原则，但是实际上可行，而且非常方便和舒服。\n1 https://hub.docker.com/r/linuxserver/webtop 支持x64 和arm 包含 alpine fedora arch ubuntu，桌面系统有 xfce i3 kde mate openbox icewm 2022-10-1 查看 6天之前刚刚更新\n远程自带的web-vnc（Web Desktop GUI） xrdp\n先试试 arch-kde\n1 docker pull linuxserver/webtop:arch-kde 我的宿主机 是unraid ，提前建立文件夹\n1 mkdir -p /mnt/disk1/appdata/webtop/config_data docker run -d\n--name=arch\n--security-opt seccomp=unconfined #optional\n-e PUID=1000\n-e PGID=1000\n-e TZ=Europe/London\n-e SUBFOLDER=/ #optional\n-e KEYBOARD=en-us-qwerty #optional\n-p 10100:3000\n-p 10101:3389\n-p 10102:22\n-v /mnt/disk1/appdata/webtop/config_data:/config\n-v /mnt/disk1/appdata/webtop/docker.sock:/var/run/docker.sock #optional\n--device /dev/dri:/dev/dri #optional\n--restart unless-stopped\nlinuxserver/webtop:arch-kde\n1 2 3 自带的用户名是 abc 密码也是abc 可以进去桌面修改密码，或者 在宿主机 docker exec -it arch passwd abc\n1 其他选项 #自动启动图形界面 -e GUIAUTOSTART=true #自动启动登录密码 -e PASSWORD=yourpassword #禁止 浏览器界面自动登录 -e AUTO_LOGIN=false\n这个是为了部分ui的兼容性 必须加上 --security-opt seccomp=unconfined\n硬件加速 只有里面的ubuntu镜像支持 --device=/dev/dri:/dev/dri\n1 鉴于硬件加速只有ubuntu支持 和arch的熟悉度，最后 我决定也尝试一下ubuntu kde docker pull linuxserver/webtop:ubuntu-kde mkdir -p /mnt/disk1/appdata/webtop-ubuntu-kde/config_data\ndocker run -d\n--name=ubuntu\n--security-opt seccomp=unconfined #optional\n-e PUID=1000\n-e PGID=1000\n-e TZ=Europe/London\n-e SUBFOLDER=/ #optional\n-e KEYBOARD=en-us-qwerty #optional\n-p 10100:3000\n-p 10101:3389\n-p 10102:22\n-v /mnt/disk1/appdata/webtop-ubuntu-kde/config_data:/config\n-v /mnt/disk1/appdata/webtop-ubuntu-kde/docker.sock:/var/run/docker.sock #optional\n--device /dev/dri:/dev/dri #optional\n-e FILE__PASSWORD=/mnt/disk1/appdata/webtop-ubuntu-kde/mysecretpassword\n-e AUTO_LOGIN=false\n--restart unless-stopped\nlinuxserver/webtop:ubuntu-kde\n1 进去后 换源，更新系统，安装中文字体 ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/docker-linux-desktop/","title":" docker运行桌面linux系统，unraid"},{"content":"golang json字符串和map转化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // json 转化为map func JsonToMap(str string) map[string]interface{} { var tempMap map[string]interface{} err := json.Unmarshal([]byte(str), \u0026amp;tempMap) if err != nil { fmt.Println(err) } return tempMap } // json arr 转化为map func JsonArrToMap(str string) []map[string]interface{} { tempMap := make([]map[string]interface{}, 0) err := json.Unmarshal([]byte(str), \u0026amp;tempMap) if err != nil { fmt.Println(err) } return tempMap } 使用举例\n1 2 3 4 5 6 json_row := redis_get(redis_key) // get_user_token := JsonArrToMap(json_row) if user_token == get_user_token[0][\u0026#34;user_token\u0026#34;] { //fmt.Println(\u0026#34;redis 获取到\u0026#34;) return true } ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/golang-json-map/","title":" golang json字符串和map转化"},{"content":"hello-world 抛弃typecho转换到wordpress wordpress -\u0026gt; typecho -\u0026gt; hexo -\u0026gt; typecho -\u0026gt; wordpress -\u0026gt; php makedown -\u0026gt; vuepress\n关于typecho typecho 不可否认 是一个非常轻量 简单 且优秀的开源软件 但是 用户基数太少，遇到一些小问题的时候，往往没有相关资料支持，需要自己找原因。\n关于typecho比wordpress 优秀的地方 · 原生支持sqlite 更适合更简单的环境 · 体积更小 适合迁移 · 目录名可以任意重命名 之需要修改配置文件即可 · 后台速度更快 · 整体占用资源更低\ntypecho 有它自己的适应场景\n本站再次迁回wordpress的原因 个人博客页经历了 wordpress -\u0026gt; typecho -\u0026gt; hexo -\u0026gt; typecho 个人博客其实无非看重的是 前台界面自由 撰写方便。 除非运行环境很恶劣，否则还是老老实实用wordpress的好 #本人维护的typecho1.2分支 将停止维护\ntypecho 新版对sqlite的支持有一些bug，模板也经常出现莫名其妙无法打开的情况，排查起来非常麻烦无趣，小bug太多。\n换到wordpress了，但是wordpress 有域名绑定的问题\n在非80端口环境下使用，再套cdn 会导致多次重定向 导致后台无法登录\n虽然修改源码可以解决。最终还是弃用了。wordpress 代码庞大 还是不太适合我。\n目前换到 自己开发的 makedown转html \u0026mdash; 2022年9月20日\n数据导出后使用了 https://github.com/palaniraja/blog2md 来转换\n2022-10-7\n重复轮子太累 暂时使用 hugo 了\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/hello-world/","title":" hello-world"},{"content":"在docker跑macos 可能吗 在docker跑macos 可能吗 原理 docker 中运行kvm 而后 opencore 后 macos 由于是半虚拟化 应该还过得去\n尝试一下\n1 http://github.com/sickcodes/Docker-OSX docker pull sickcodes/docker-osx:latest\ndocker run -it\n--name=macos\n--device /dev/kvm\n--device /dev/snd\n-p 50922:10022\n-v /tmp/.X11-unix:/tmp/.X11-unix\n-e \u0026ldquo;DISPLAY=${DISPLAY:-:0.0}\u0026rdquo;\nsickcodes/docker-osx:latest\nturn on SSH after you\u0026rsquo;ve installed OS X in the \u0026ldquo;Sharing\u0026rdquo; settings. ssh user@localhost -p 50922\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/docker-exec-macos/","title":" 在docker跑macos 可能吗"},{"content":"alpine/linux 下快速搭建可以随意整体迁移的宝塔面板 这里以alpine为例，安装后占用50M左右硬盘的一个完整linux系统\n下载iso 安装 https://dl-cdn.alpinelinux.org/alpine/v3.16/releases/x86_64/alpine-virt-3.16.2-x86_64.iso\n安装过程使用国内neusoft镜像,用的虚拟机镜像联网安装，安装后就是最新版\n重启后登录：vi /etc/apk/repositories 去掉稳定版的community注释\n1 2 3 apk add docker #安装docker rc-update add docker boot #开机自动启动 service docker start #启动 重启一下，启动过程中可以看到dhcp的ip，启动后 ip a 也可以看到，路由器里面dhcp绑定一下ip。\nssh登录 修改docker源 文件不存在 会自动新建\n1 vi /etc/docker/daemon.json { \u0026ldquo;registry-mirrors\u0026rdquo;: [ \u0026ldquo;https://hub-mirror.c.163.com\u0026rdquo;, \u0026ldquo;https://ustc-edu-cn.mirror.aliyuncs.com\u0026rdquo;, \u0026ldquo;https://docker.mirrors.ustc.edu.cn\u0026rdquo; ] }\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 service docker restart # 然后虚拟机关机，整机备份 ``` **容器的选择**， 宝塔支持 是 Centos7.x \u0026gt; Debian10 \u0026gt; Ubuntu 20.04 \u0026gt; Centos8 stream \u0026gt; Ubuntu 18.04 \u0026gt; 其它系统 这几个系统的最后支持时间 centos7（2024-6-30）debian10 （2019年7月发布也差不多2024-7）ubuntu20.04(2025-4) Ubuntu 22.04.1 LTS 安全更新至2027年4月 debian11（2026 年 12 月）尽量选择前三个系统，1是因为在debian系下多数组件是编译安装的 2是宝塔最近小bug非常多，centos下会好一些 安装docker centos 和 宝塔 ``` docker pull centos:7 docker images # 启动容器 # 目录不映射出来，因为这里需要做一个全部都在docker的可迁移的 # 先把端口考虑好，后续修改麻烦 宝塔面板的两个 80 和 443 mysql MongoDB Redis PgSQL # 1122:22 算是备用的，另外需要预留几个golang用的端口 数字80开头的 docker run -i -t -d --name baota -p 8888:8888 -p 180:80 -p 1122:22 -p 1443:443 -p 13306:3306 -p 888:888 -p 16379:6379 -p 27017:27017 -p 27018:27018 -p 27019:27019 -p 28017:28017 -p 5432:5432 -p 8180-8199:8180-8199 --privileged=true --restart=always centos:7 /bin/bash #开始安装宝塔 docker exec -it baota /bin/bash #安装脚本 yum install -y wget \u0026amp;\u0026amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh \u0026amp;\u0026amp; sh install.sh ed8484bec ``` 登录宝塔面板 修改面板入口地址 安装 nginx mysql5.7 php7.4 redis7 php alioss打开常用扩展，因为版本的原因，均为编译安装，速度非常慢，耐心等待，选centos7的话就没有这个问题 配置好dnspod 的key 方便续签域名证书 宝塔 7.9.4 的alioss 有配置错误，经过测试又是一个小bug，导致它无论什么系统无法配置。 vi /www/server/panel/data/aliossAS.conf ``` {\u0026#34;access_key\u0026#34;: \u0026#34;XXXXX\u0026#34;, \u0026#34;secret_key\u0026#34;: \u0026#34;XXXX\u0026#34;, \u0026#34;bucket_name\u0026#34;: \u0026#34;XXXX\u0026#34;, \u0026#34;bucket_domain\u0026#34;: \u0026#34;XXXX.oss-cn-qingdao.aliyuncs.com\u0026#34;, \u0026#34;backup_path\u0026#34;: \u0026#34;/bt_backup/\u0026#34;} ``` 可以正常用了 下载我的开源项目webdavgo 把/www目录映射出来到webdav ``` #https://dev.leiyanhui.com/c/webdavgo/ cd /www wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1.1/webdav chmod -x ./webdav #wget -c https://gitee.com/joyanhui/webdavgo/releases/download/1.1/webdavgo.json ``` 编辑配置文件 关闭文件服务，webdav定位到 /www vim webdavgo.json ``` { \u0026#34;server_port\u0026#34;:8189, \u0026#34;webdav_user_name\u0026#34;:\u0026#34;admin\u0026#34;, \u0026#34;webdav_user_psw\u0026#34;:\u0026#34;12345\u0026#34;, \u0026#34;webdav_file_path\u0026#34;:\u0026#34;/www\u0026#34;, \u0026#34;list_server_path\u0026#34;:\u0026#34;\u0026#34;, \u0026#34;list_file_path\u0026#34;:\u0026#34;\u0026#34; } ``` 宝塔新建一个go项目 站点 端口输入上面的端口后，可执行文件 /www/webdav 剩下的不在说明 这样 /www 可以在外网通过webdav访问 测试完成后，修改server\\_port端口为没有映射过的端口，nginx开启ssl 同时在自己的域名控制面板里面 添加几个指向本地的子域名，免得测试项目老修改hosts文件 1.host.leiyanhui.com 到10.0.0.1 10.host.leiyanhui.com 到10.0.0.10 \\*.10.host.leiyanhui.com 到10.0.0.10 127.host.leiyanhui.com 到 127.0.0.1 \\*.127.host.leiyanhui.com 到127.0.0.1 配置docker里面的宝塔自动启动 在容器内新建文件 vi /www/wwwroot/bt.sh ``` ## 宝塔 在容器内自动启动 /etc/init.d/bt start /etc/init.d/redis start /etc/init.d/php-fpm-74 start /etc/init.d/mongodb start /etc/init.d/pgsql start /etc/init.d/mysqld start /etc/init.d/memcached start /etc/init.d/nginx start crond seelp 5 /etc/init.d/mysqld stop /etc/init.d/mysqld start /etc/init.d/redis stop /etc/init.d/redis start crond ``` 推出容器，在宿主系统中添加开机启动项，这里以apline为例子 ``` cd /etc/local.d vi bt.start # 添加内容 docker exec -it baota sh /www/wwwroot/bt.sh chmod +x bt.start rc-update add local ``` 备份容器 到tar ``` docker export baota\u0026gt; baota.tar gzip baota.tar #简化一下 事实证明没啥用 其实还是tar宝 docker export -o baota.tar.gz baota ``` 这个压缩包迁移到其他主机上 或 阿里docker服务 ``` # 导入到 镜像 baota:v1 docker import baota.tar.gz baota:v1 ``` docker重启后 要执行一次 ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/docker-baota/","title":"alpine/linux 下快速搭建可以随意整体迁移的宝塔面板"},{"content":"alpine搭建smb共享 在虚拟机中运行了一个 alpine 然后运行了docker宝塔 遇到一个问题 就是 使用sftp挂载文件到本地硬盘的时候，经常出现一些莫名其妙的权限问题SFTPDrive.exe\n这个软件 在win下也不是很稳定，经常莫名其妙卡死 所以 干脆还是 在虚拟机的 alpine下 共享 wwwroot目录出来 更省事一些\n参考 https://wiki.alpinelinux.org/wiki/Setting_up_a_samba-server\n差不多要用掉300M硬盘 另外 也可以在宝塔里面安装ftp来解决\n或者使用 rclone\n我后来单独做了一个基于 golang的 webdav 可以从这里下载 https://github.com/joyanhui/webdavgo\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/alpine-smb/","title":"alpine搭建smb共享"},{"content":"archlinux 安装搜狗 百度 输入法 1、先安装 yay arch安装yay最简单的办法 - 小类随手记 (leiyanhui.com)\n可选操作 arch安装xrdp，方便win和ipad远程控制 - 小类随手记 (leiyanhui.com)\n可选操作 Linux的shell命令行等临时挂代理 - 小类随手记 (leiyanhui.com)\n2、安装中文字体 archlinux安装中文字体，微软字体和搜狗拼音 百度输入法 - 小类随手记 (leiyanhui.com)\n3、安装中文输入法\n我这里用搜狗，因为 百度出现过 频繁崩溃的情况。 两个都不支持词库同步。\n1 2 3 4 5 6 7 #先安装 fcitx 输入法管理器 sudo pacman -S fcitx # 还需要一点别的组件 也快不用 # configtool也不是必须的，是一个图形界面的配置程序，不安装到话直接修改配置文件也是可以的 sudo pacman -S fcitx-configtool #非必需的 其他网上教程让安装的，其实可以不用 # sudo pacman -S fcitx-gtk2 fcitx-gtk3 fcitx-qt5 安装搜狗 或者 百度\n1 2 3 4 5 6 yay -S fcitx-sogoupinyin yay -S fcitx-baidupinyin #不推荐，好像有点问题，会卡死，甚至会连带其他输入法无法使用 #卸载 yay -Rsn fcitx-baidupinyin #谷歌输入法 sudo pacman -S fcitx-googlepinyin #这个轻量依赖少，但是没词库，是安卓迁移的 因为我用的kde桌面，主流桌面会自动启动fcitx ，但是一个程序之间的通讯问题可能需要设置一下环境变量 非必须的操作，不添加的话 部分软件 不支持中文输入\n1 2 3 4 5 nano ~/.pam_environment #添加 GTK_IM_MODULE DEFAULT=fcitx QT_IM_MODULE DEFAULT=fcitx XMODIFIERS DEFAULT=\\@im=fcitx 注销登录的kde 桌面，重新登录会自动打开fcitx在系统托盘位置，右键小键盘 点config配置\n或者 开始菜单 setting里面 有 fcitx config的配置程序\n添加输入法，搜索 sogou baidu 即可添加\nctrl+空格 即可调出输入法，如果有问题，那就是前面没配置好\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/archlinux-cninputu-sogou-baidu/","title":"archlinux 安装搜狗 百度 输入法"},{"content":"archlinux安装edge浏览器 和 chrome 1、先安装 yay arch安装yay最简单的办法 - 小类随手记 (leiyanhui.com)\n可选操作 arch安装xrdp，方便win和ipad远程控制 - 小类随手记 (leiyanhui.com)\n可选操作 Linux的shell命令行等临时挂代理 - 小类随手记 (leiyanhui.com)\n2、安装中文字体 archlinux安装中文字体，微软字体和搜狗拼音 百度输入法 - 小类随手记 (leiyanhui.com)\n3、安装中文输入法 archlinux 安装搜狗 百度 输入法 - 小类随手记 (leiyanhui.com)\n4、挂代理防止卡 也可以不用 Linux的shell命令行等临时挂代理 - 小类随手记 (leiyanhui.com)\n5、安装edge浏览器\nedge浏览器 是 aur源的， 需要先安装第一步的 yay，另外还需要安装中文字体，不然中文网页打开乱码\n1 2 3 4 5 yay -S microsoft-edge-stable-bin #:: Remove make dependencies after install? [y/N] y #==\u0026gt; [N]one [A]ll [Ab]ort [I]nstalled [No]tInstalled or (1 2 3, 1-3, ^4) # N yay 部分文件从境外下载，可能会中断，ctrl+c 取消重新来就好了。或者挂梯子\n其他浏览器 开源的 在pacman 非完全开源的 用yay\n1 2 yay -S google-chrome sudo pacman -S firefox ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/archlinux-install-edge/","title":"archlinux安装edge浏览器 和 chrome"},{"content":"archlinux安装中文字体，微软字体和搜狗拼音 百度输入法 1、先安装 yay arch安装yay最简单的办法 - 小类随手记 (leiyanhui.com)\n可选操作 arch安装xrdp，方便win和ipad远程控制 - 小类随手记 (leiyanhui.com)\n2、安装中文字体\n随便安装一个就可以显示中文了\n1 2 3 4 pacman -S wqy-zenhei # remove # pacman -Rs wqy-zenhei wine 乱码的话 也需要安装几个中文字体，具体忘记，回头记录\n3、安装windows字体\n从另外一个电脑的 C盘 windows font目录复制出来字体，然后打包 下载到arch 或者下载我在github上的，\n1 2 3 4 5 6 7 8 9 10 11 su - #切换到root mkdir /usr/share/fonts/WindowsFonts cd /usr/share/fonts/WindowsFonts #这两个还是装一下，常用 pacman -S wget unzip wget -c http://10.0.0.200/windows-fonts.zip unzip windows-fonts.zip rm windows-fonts.zip chmod 644 /usr/share/fonts/WindowsFonts/* #刷新字体缓存 fc-cache -f 我在github上的 一份windows字体包 基于win11的\ngit clone -b windows_font https://github.com/joyanhui/file.leiyanhui.com.git # wget -c https://github.com/joyanhui/file.leiyanhui.com/archive/refs/heads/windows_font.zip # wget -c https://ghproxy.com/https://github.com/joyanhui/file.leiyanhui.com/archive/refs/heads/windows_font.zip 4、kde 设置中文，在开始菜单 搜索 lang 添加中文即可（不建议 还是英文舒服。中文界面很丑，而且会出现 部分界面中英混的情况）\n5、安装百度 搜狗 等中文 输入法 archlinux 安装搜狗 百度 输入法 - 小类随手记 (leiyanhui.com)\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/archlinux-cn-font-input/","title":"archlinux安装中文字体，微软字体和搜狗拼音 百度输入法"},{"content":"archlinx下开启xrdp没有声音的问题 我的是unraid下用kvm运行的archlinux\n首选需要安装 pulseaudio 与 pulseaudio-module-xrdp 模块。\n1 2 3 4 5 6 yay -S xrdp sudo pacman -S xorgxrdp #将 allowed_users=anybody 添加到 /etc/X11/Xwrapper.config 以允许任何人启动 X 服务器。 sudo nano /etc/X11/Xwrapper.config sudo pacman -S pulseaudio yay -S pulseaudio-module-xrdp 重启xrdp\n1 sudo systemctl restart xrdp 如果没有声音或者声音设备\n1 2 #尝试注释掉 /etc/pam.d/system-auth 中对 systemd-home 的所有引用。 sudo nano /etc/pam.d/system-auth 我的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 [yanhui@archlinux ~]$ cat /etc/pam.d/system-auth #%PAM-1.0 auth required pam_faillock.so preauth # Optionally use requisite above if you do not want to prompt for the password # on locked accounts. -auth [success=2 default=ignore] #pam_systemd_home.so auth [success=1 default=bad] pam_unix.so try_first_pass nullok auth [default=die] pam_faillock.so authfail auth optional pam_permit.so auth required pam_env.so auth required pam_faillock.so authsucc # If you drop the above call to pam_faillock.so the lock will be done also # on non-consecutive authentication failures. -account [success=1 default=ignore] #pam_systemd_home.so account required pam_unix.so account optional pam_permit.so account required pam_time.so -password [success=1 default=ignore] #pam_systemd_home.so password required pam_unix.so try_first_pass nullok shadow sha512 password optional pam_permit.so -session optional #pam_systemd_home.so session required pam_limits.so session required pam_unix.so session optional pam_permit.so sudo systemctl restart xrdp 重启xrdp后 如果不行，如果手动运行 pulseaudio 后有声音 还一个方法\n就是在 ~/.xinitrc 添加\n1 2 nano ~/.xinitrc pulseaudio \u0026amp; 两个方法 二选一 或者都试试\n官方wifi说明\n1 2 3 4 5 6 7 没有声音 这可能是 loginctl 问题的征兆，因此请尝试以 以上内容修复。系统journal可能会遇到以下错误： Failed to load module \u0026#34;module-x11-publish\u0026#34; (argument: \u0026#34;display=:10.0 xauthority=\u0026#34;): initialization failed. 这是 systemd 不正确地启动 PulseAudio 的结果。一种解决方法是为您自己的用户或所有用户 禁用 user unit 文件 pulseaudio.service 和 pulseaudio.socket，然后启动 PulseAudio需要时通过在 /etc/pulse/client.conf 中将 autospawn 设置为 yes。 如果仍然没有声音，请尝试使用 ~/.xinitrc 中的 pulseaudio \u0026amp; 手动启动 PulseAudio。 我的~/.xinitrc\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 [yanhui@archlinux system]$ cat ~/.xinitrc #!/bin/sh userresources=$HOME/.Xresources usermodmap=$HOME/.Xmodmap sysresources=/etc/X11/xinit/.Xresources sysmodmap=/etc/X11/xinit/.Xmodmap # merge in defaults and keymaps if [ -f $sysresources ]; then xrdb -merge $sysresources fi if [ -f $sysmodmap ]; then xmodmap $sysmodmap fi if [ -f \u0026#34;$userresources\u0026#34; ]; then xrdb -merge \u0026#34;$userresources\u0026#34; fi if [ -f \u0026#34;$usermodmap\u0026#34; ]; then xmodmap \u0026#34;$usermodmap\u0026#34; fi # start some nice programs if [ -d /etc/X11/xinit/xinitrc.d ] ; then for f in /etc/X11/xinit/xinitrc.d/?*.sh ; do [ -x \u0026#34;$f\u0026#34; ] \u0026amp;\u0026amp; . \u0026#34;$f\u0026#34; done unset f fi #twm \u0026amp; #xclock -geometry 50x50-1+1 \u0026amp; #xterm -geometry 80x50+494+51 \u0026amp; #xterm -geometry 80x20+494-0 \u0026amp; #exec xterm -geometry 80x66+0+0 -name login pulseaudio \u0026amp; export DESKTOP_SESSION=plasma /usr/lib/plasma-dbus-run-session-if-needed startplasma-x11 ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/archlinux-xrdp-audio/","title":"archlinx下开启xrdp没有声音的问题"},{"content":"arch安装yay最简单的办法 网上的多不靠谱，目前2022/9/30 最新的安装方法：\n新装的arch\n使用方法：在 /etc/pacman.conf 文件末尾添加以下两行：\n1 2 3 4 5 6 7 #sudo nano /etc/pacman.conf [archlinuxcn] Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch #其他的 和mirrorlist不同archlinuxcn 只能选一个 ## Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch ## Server = https://mirrors.aliyun.com/archlinuxcn/$arch 之后安装 archlinuxcn-keyring 包导入 GPG key。\n1 2 3 4 sudo pacman -Sy #更新一下 sudo pacman -S archlinuxcn-keyring #可能需要 sudo pacman-key --init 安装\n1 sudo pacman -S yay arch的源 经常出现不稳定的情况，导致软件安装失败。\n1 sudo nano /etc/pacman.d/mirrorlist 把测试稳定的源 挪到前面\n阿里云 最近抽风，慎用\n另外 临时挂一下代理 也可以 https://dev.leiyanhui.com/c/linux-shell-proxy/\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/archlinux-install-yay/","title":"arch安装yay最简单的办法"},{"content":"arch自动安装脚本archintsall扫描镜像缓慢的解决方法 #arch自动安装脚本archintsall扫描镜像缓慢的解决方法\nvim /etc/pacman.d/mirrorlist 这个文件的内容经常变化，甚至同一个镜像同一个时间段 内容都不一样 如果里面存在大量的镜像地址，那么找到中国相关的 用vim的 指令 dG 删除光标后面的 dgg 删除前面的，保留1-2个中国的镜像即可 如果没有中国的镜像就 ggdG 删除所有内容 添加一行 一行就好了\n1 2 3 4 5 6 7 8 9 10 11 12 Server = http://mirrors.163.com/archlinux/$repo/os/$arch Server = https://mirrors.dgut.edu.cn/archlinux/$repo/os/$arch Server = https://mirrors.nju.edu.cn/archlinux/$repo/os/$arch Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch Server = https://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch Server = http://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch Server = http://mirrors.zju.edu.cn/archlinux/$repo/os/$arch Server = http://mirrors.nju.edu.cn/archlinux/$repo/os/$arch Server = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch Server = https://mirrors.sjtug.sjtu.edu.cn/archlinux/$repo/os/$arch Server = http://mirrors.dgut.edu.cn/archlinux/$repo/os/$arch Server = rsync://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch 其他按照向导操作即可 最终安装完成大概有2G多一些 pacman -S nano nano /etc/ssh/sshd_config 找到 PermitRootLogin 去掉注释修改为 yes PermitRootLogin yes 重启sshd systemctl enable sshd.service systemctl restart sshd.service\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/arch-install-mirrorlist/","title":"arch自动安装脚本archintsall扫描镜像缓慢的解决方法"},{"content":"centos7安装最新版git 自带的版本\n1 2 [root@0ef053b03825 ~]# git --version git version 1.8.3.1 太旧了，有时候会有一些小问题\n目前最新版是 edge-git-2.9.5 或者 git-scm2.38.0 （2022-10-04）\n1 2 3 https://mirrors.edge.kernel.org/pub/software/scm/git/ 或者 https://github.com/git/git/releases/tag/v2.38.0 我这里用 mirrors.edge.kernel.org的２.９.５版本 因为2.38有一个依赖还在测试版的ｃ９９的问题处理起来麻烦\n1 2 #安装编译和运行新版git的依赖 yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc gcc perl-ExtUtils-MakeMaker 1 2 3 4 5 6 7 8 9 10 yum remove git #卸载自带的git cd /usr/local/src/ wget -c https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.9.5.tar.gz tar -zxvf git-* cd git-* make prefix=/opt/git all make prefix=/opt/git install echo \u0026#34;export PATH=$PATH:/opt/git/bin\u0026#34; \u0026gt;\u0026gt; /etc/profile　#如果还有其他自定义ｐａｔｈ，最好是自己修改一下　/etc/profile source /etc/profile　更新 git \u0026ndash;version　查看是否生效\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/centos7-install-new-git/","title":"centos7安装最新版git"},{"content":"centos下安装go最新版本 yum install golang 的版本 是 1.17版本，最新版是 1.19.1\n下载 https://golang.google.cn/dl/\n1 2 3 4 5 6 wget -c https://golang.google.cn/dl/go1.19.1.linux-amd64.tar.gz tar -zxf go1.19.1.linux-amd64.tar.gz -C /opt/ ls /opt/ mkdir /opt/gopath 环境变量\n1 nano /etc/profile 在最后添加\n1 2 3 4 export GO111MODULE=on export GOROOT=/opt/go export GOPATH=/opt/gopath export PATH=$PATH:$GOROOT/bin:$GOPATH/bin 更新生效 设置代理\n1 2 3 4 source /etc/profile go version go version go1.19.1 linux/amd64 [root@0ef053b03825 opt]# go env -w GOPROXY=https://goproxy.cn,direct 关于go的代理\n慎选择 阿里的，很多404不说，竞厂的sdk 阿里是不会让你下载的。真感觉好用，用逗号分割就好\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/centos-go/","title":"centos下安装go最新版本"},{"content":"cname和mx记录冲突的解决方法 看了很多资料 目前最靠谱的解决方法 比如 leiyanhui.com 域名托管在 dnspod leiyanhui.com mx记录到腾讯企业邮箱 leiyanhui.com url转发到 www.leiyanhui.com 会自动A记到腾讯的url转发服务器 如果dns在cloudflare那就简单，直接做cname 就可以，cloudflare会自动拉平成A记录 另外一个解决方法 就是 域名 使用 user@mail.leiyanhui.com 这样的方式 也可以避免冲突 网上说是那些ALIAS 记录 目前 多数dns不支持 不太靠谱\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/108/","title":"cname和mx记录冲突的解决方法"},{"content":"deepin下用VirtualBox安装macos Monterey 12 /bigsur 11 VMware下安装macos应该都会了，就是用解除限制的工具 让VMware支持macos即可。 但是Linux下VMware的挺难用，不支持无缝模式 要么全屏 要么一堆工具在哪里。 VirtualBox下就好很多，vbox在6.1.30版本的时候 说只支持了macos 11 和12 于是尝试一下。 https://www.virtualbox.org/wiki/Changelog (bug #20636) 安装好VirtualBox之后，一定记得要再下载 VirtualBox 6.1.34 Oracle VM VirtualBox Extension Pack 这个下载后 直接双击deepin下的 vbox会识别到 ，其他发行版自己看看怎么导入 新建虚拟机 MacOS 路径 /media/YanHui/Data/VirtualBox/MacOS 系统选择 macos 64 内存8G 最小4G吧 硬盘 动态vdi 给到50G 这个好像必须用固定大小的，用动态的会在倒计时15分左右的时候 自动重启 CPU给2个，这个地方应该是必须2核，不然无法进去安装界面 显示 显存给 128M USB忘记用什么了 给2.0吧 网络链接先去掉 光盘随便选一个 macos镜像，我这里 选择 macOS.Big.Sur.11.6.5.20G527 我试过 https://sysin.org/blog/macOS-Monterey/ 这个Install_macOS_Monterey_12.4_21F79.iso 需要再启动的时候 自行找一下 efi，后续 也非常卡。仍一晚上没管 也没装好，所以放弃 点设置，启动顺序去掉软驱 关闭VirtualBox 终端命令\n1 VBoxManage modifyvm \u0026#34;MacOS\u0026#34; --cpuidset 00000001 000106e5 00100800 0098e3fd bfebfbff VBoxManage setextradata \u0026#34;MacOS\u0026#34; \u0026#34;VBoxInternal/Devices/efi/0/Config/DmiSystemProduct\u0026#34; \u0026#34;iMac19,1\u0026#34; VBoxManage setextradata \u0026#34;MacOS\u0026#34; \u0026#34;VBoxInternal/Devices/efi/0/Config/DmiSystemVersion\u0026#34; \u0026#34;1.0\u0026#34; VBoxManage setextradata \u0026#34;MacOS\u0026#34; \u0026#34;VBoxInternal/Devices/efi/0/Config/DmiBoardProduct\u0026#34; \u0026#34;Mac-AA95B1DDAB278B95\u0026#34; VBoxManage setextradata \u0026#34;MacOS\u0026#34; \u0026#34;VBoxInternal/Devices/smc/0/Config/DeviceKey\u0026#34; \u0026#34;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\u0026#34; VBoxManage setextradata \u0026#34;MacOS\u0026#34; \u0026#34;VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC\u0026#34; 1 VBoxManage setextradata \u0026#34;MacOS\u0026#34; \u0026#34;VBoxInternal2/EfiGraphicsResolution\u0026#34; \u0026#34;1440x900\u0026#34; 开VirtualBox，运行虚拟机,启动后 如果没有出现苹果启动画面 那么 会出现efi shell 的命令行，输入 exit退出 然后在 一个类似bios的界面 选择 Boot Maintenance Manager → Boot From File 然后选择 第一个 HFS+这个 这个不要选错了 然后再找 到 这几个目录 依次选\n1 \u0026lt;System\u0026gt;→\u0026lt;Library\u0026gt;→\u0026lt;CoreServices\u0026gt;→boot.efi 然后耐心等待字符滚动，后面的操作 和 正常安装macos一样 双核 超慢超慢，耐心等待 过一会就进来了 先用磁盘工具抹掉 vox这个磁盘 剩下过程不用再说了 我之前再VMware下遇到的一个大坑 就是 大概倒计时15分钟的时候 卡死 甚至五国，最后发现 是因为我把虚拟机文件放到了ntfs分区。 一定记得Linux下的ntfs还是挺坑的 安装完成后自动重启\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/26/","title":"deepin下用VirtualBox安装macos Monterey 12 /bigsur 11"},{"content":"docker运行宝塔的几个问题：开启不自启动，计划任务无法运行等 前言 我宝塔运行在 unraid+kvm \u0026gt; alpine+docker里面 为什么不直接 unraid+docker 是因为 我对性能的损耗不怎么在意，物理机性能嗷嗷的 虚拟机的隔离 还有整机备份更加方便。 为什么非要用docker跑宝塔？因为docker配合阿里云免费私有库 整机备份和迁移也方便。 我可以docker stop baota之后 用export和import备份整个容器到新镜像，然后push到阿里云私有库上。在其他机器上直接运行。而不需要重复环境。 alpine 作为一个安装后之占用几十m硬盘的Linux系统非常适合何种虚拟机运行，而且官网有提供适合虚拟机的iso\ndocker运行宝塔的几个问题 主要是物理机开机启动后，宝塔不能自动运行 。这里以alpine+docker+centos7+宝塔 为例 在/www/wwwroot新建文件 bt.sh 给运行权限 代码如下/etc/init.d/bt start /etc/init.d/redis start /etc/init.d/php-fpm-74 start /etc/init.d/mongodb start /etc/init.d/mysqld start /etc/init.d/nginx start crond /etc/init.d/mysqld start #再启动一次，有时候 一次启动不起来 其他版本 和宝塔环境可以ls /etc/init.d/ 执行权限 docker exec -it baota chmod +x /www/wwwroot/bt.sh 然后把这个 /www/wwwroot/bt.sh 这个脚本添加到宿主机的开机启动启动里面（Windows 也可以） 以alpine3.6.1为例,在宿主机 新建一个local启动服务脚本 运行刚刚新建的bt.sh 必须以start作为后缀 vi /etc/local.d/bt.start docker exec -it baota sh /www/wwwroot/bt.sh 执行权限 chmod +x /etc/local.d/bt.start 更新和添加local启动项 rc-update add local 重启机器测试，发现都可以正常启动了 crond 这个 是解决宝塔的计划任务不能自动执行的\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/docker-baota-cn/","title":"docker运行宝塔的几个问题：开启不自启动，计划任务无法运行等"},{"content":"golang 常用数据类型转化，字符串，字节，int，float，map[string]interface{}，json，sql查询结果 其他类型转化为字符串 可以使用strconv包的方法，也可以用fmt，如果数据本身是interface的话就只能用fmt\n1 2 3 4 5 6 7 8 9 10 11 **interface string转化string：** fmt.Sprintf(\u0026#34;%s\u0026#34;, v) **int转化string：** fmt.Sprintf(\u0026#34;%d\u0026#34;, v) 或 string := strconv.Itoa(int) string := strconv.FormatInt(int64,10) **case float64:** var km = 9900.10 strKm := strconv.FormatFloat(km, \u0026#39;f\u0026#39;, 1, 64) 或 fmt.Sprintf(\u0026#34;%f\u0026#34;, v) **case byte:** string(v) 32 byte转字符串 1 2 3 passwordSHA := sha256.Sum256([]byte(new_password)) password_hash := hex.EncodeToString(passwordSHA[:]) fmt.Println(password_hash) 字符串转byte byte转字符串\n1 2 3 s1 := \u0026#34;hello\u0026#34; b := []byte(s1) C:=string(b) 字符串转化为其他类型\n1 2 int64, err := strconv.ParseInt(string, 10, 64) int, err := strconv.Atoi(string) 字符串转化float64 float32\n1 2 3 float,err := strconv.ParseFloat(string,64) float,err := strconv.ParseFloat(string,32) #ParseFloat 只能返回float64，指定了32 也会返回float64非要用32 需要再次转化 float64转化int\n1 2 3 4 5 var x float64 = 5.7 var y int = int(x) var i float32 = 10.1 var n int32 = int32(i) int转化float\n1 2 v1 := 99 v2 := float64(v2). int和int64互转\n1 2 int64_ := int64(1234) int64转int 先转字符串 再转int time转int\n1 2 3 timestamp := time.Now().Unix() fmt.Println(timestamp) fmt.Sprintf(\u0026#34;%d\u0026#34;, v) map[string]interface{} 的一个数字转化为int 需要三步\n1 2 3 4 5 user_id_string := fmt.Sprintf(\u0026#34;%f\u0026#34;, json_row_map[0][\u0026#34;user_id\u0026#34;]) user_id_float64, _ := strconv.ParseFloat(user_id_string , 64) user_id_int := int(user_id_float64) 如果要拼接到sql 还需要再转到string user_id_sql_string:=strconv.Itoa(user_id_int) json 和 map互转\nmap转化json字符串\n1 2 3 4 5 func MapToJson(param map[string]interface{}) string { dataType, _ := json.Marshal(param) dataString := string(dataType) return dataString } json 字符串 转化为map\n使用encoding/json库，性能比github.com/buger/jsonparser 要差一些 jsonparser 不知怎么转换\n不带数组格式的json转map\n1 2 3 4 5 6 7 8 func JsonToMap(str string) map[string]interface{} { var tempMap map[string]interface{} err := json.Unmarshal([]byte(str), \u0026amp;tempMap) if err != nil { fmt.Println(err) } return tempMap } 数组格式的json转map\n1 2 3 4 5 6 7 8 func JsonArrToMap(str string) []map[string]interface{} { tempMap := make([]map[string]interface{}, 0) err := json.Unmarshal([]byte(str), \u0026amp;tempMap) if err != nil { fmt.Println(err) } return tempMap } Sql查询结果转json字符串\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 //db_r 是全局变量 var db_r *sql.DB func sql_to_json(sqlString string) (string, error) { stmt, err := db_r.Prepare(sqlString) if err != nil { return \u0026#34;\u0026#34;, err } defer stmt.Close() rows, err := stmt.Query() if err != nil { return \u0026#34;\u0026#34;, err } defer rows.Close() columns, err := rows.Columns() if err != nil { return \u0026#34;\u0026#34;, err } count := len(columns) tableData := make([]map[string]interface{}, 0) values := make([]interface{}, count) valuePtrs := make([]interface{}, count) for rows.Next() { for i := 0; i \u0026lt; count; i++ { valuePtrs[i] = \u0026amp;values[i] } rows.Scan(valuePtrs...) entry := make(map[string]interface{}) for i, col := range columns { var v interface{} val := values[i] b, ok := val.([]byte) if ok { v = string(b) } else { v = val } entry[col] = v } tableData = append(tableData, entry) } jsonData, err := json.Marshal(tableData) if err != nil { return \u0026#34;\u0026#34;, err } //fmt.Println(string(jsonData)) return string(jsonData), nil } ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/golang-string-byte-int-float-map-json/","title":"golang 常用数据类型转化，字符串，字节，int，float，map\\[string]interface{}，json，sql查询结果"},{"content":"hyper-v 开启虚拟化嵌套，套娃pve 为了虚拟化黑苹果 因为最终一些原因，舍弃了黑macos 做主力系统（远程很卡https://dev.leiyanhui.com/c/94） 切换到win下，有因为使用了docker 需要打开wsl和hyper-v，而这时候 vmware的显卡性能会大幅度下滑，所以尝试 套娃虚拟机跑macos 终端运行 查看列表 Get-VM 查看配置 ExposeVirtualizationExtensions 默认是false Get-VMProcessor -VMName PVE | fl 打开虚拟化套娃 Set-VMProcessor -ExposeVirtualizationExtensions $true -VMName PVE 查看配置 ExposeVirtualizationExtensions 默认是应该变成 true Get-VMProcessor -VMName PVE | fl 完毕 正常安装pve 最后，迁移到unraid 上了\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/99/","title":"hyper-v 开启虚拟化嵌套，套娃pve 为了虚拟化黑苹果"},{"content":"hyper-v 虚拟机主机添加显卡（分配一部分显卡性能给他） $vm = \u0026ldquo;Win11dev\u0026rdquo; 或者 $vm = \u0026ldquo;PVE\u0026rdquo; 引号里面是虚拟机名称\nAdd-VMGpuPartitionAdapter -VMName $vm Set-VMGpuPartitionAdapter -VMName $vm -MinPartitionVRAM 80000000 -MaxPartitionVRAM 100000000 -OptimalPartitionVRAM 100000000 -MinPartitionEncode 80000000 -MaxPartitionEncode 100000000 -OptimalPartitionEncode 100000000 -MinPartitionDecode 80000000 -MaxPartitionDecode 100000000 -OptimalPartitionDecode 100000000 -MinPartitionCompute 80000000 -MaxPartitionCompute 100000000 -OptimalPartitionCompute 100000000 Set-VM -GuestControlledCacheTypes $true -VMName $vm Set-VM -LowMemoryMappedIoSpace 1Gb -VMName $vm Set-VM -HighMemoryMappedIoSpace 32GB -VMName $vm 虚拟机开机，\n从主机上复制C:\\Windows\\System32\\DriverStore\\FileRepository目录到虚拟机C:\\Windows\\System32\\HostDriverStore\\ 此时虚拟机上看到是这样的目录结构：C:\\Windows\\System32\\HostDriverStore\\FileRepository 备注：HostDriverStore这个目录要自己创建， FileRepository里面本质上只要有主机显卡驱动就可以了，这里偷懒直接复制整个目录（文件挺大），如果只想复制主机显卡驱动目录，可以通过设备管理器查看主机的显卡驱动 驱动详细信息 查看显卡的驱动目录 比如 我的是 C:\\Windows\\System32\\DriverStore\\FileRepository\\iigd_dch.inf_amd64_518f2921ba495409 也有900M 复制到虚拟机的\nC:\\Windows\\System32\\HostDriverStore\\FileRepository\\iigd_dch.inf_amd64_518f2921ba495409 我这里是核显，如果是其他网卡 可能还需要几个dll 具体 搜索引擎 重启虚拟机，查看虚拟机设备管理器显卡，运行dxdiag查看显卡特性 成功\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/98/","title":"hyper-v 虚拟机主机添加显卡（分配一部分显卡性能给他）"},{"content":"iOS开发申请组播广播权限 iOS14以后，使用组播广播功能需要申请权限。 1、申请地址： https://developer.apple.com/contact/request/networking-multicast； 1\n、申请地址 2、填写相应的App Information，提交了等待审核； appleid app 这个地方 应该是填写 appstoreconnect里面的app信息的appid app catagory填写 分类的英文:tools,live 3、等待几天（有时候 几小时），审核通过了会给你发邮件：Your request to use Multicast Networking was approved. You can now add the Multicast Networking entitlement with your Provisioning Profile. 4、登录开发者账号，身份管理Identifiers界面，点开对应的app的设置 在AppID的配置界面，会增加对应权限：Additional Capabilities中，把Multicast Networking给勾上； 5、重新生成Profiles里对应的证书；开发和发布的证书都重新生成。 如果是uniapp开发就直接添加对应的插件就好了。如果原生开发 继续下一步 6、在工程里配置.entitlements文件，增加一项。Key：com.apple.developer.networking.multicast　type：boolean　Value：YES 7、在Info.plist文件中，添加本地网络使用权限：Privacy - Local Network Usage Description 权限问题解决完毕，组播广播功能可以正常开发使用了。\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/31/","title":"iOS开发申请组播广播权限"},{"content":"Linux的shell命令行等临时挂代理 1 2 export http_proxy=\u0026#34;代理ip:代理端口\u0026#34; export https_proxy=\u0026#34;代理ip:代理端口\u0026#34; 可以在 一个windows 或docker 上跑一个允许lan的clash 就好了\n1 2 export http_proxy=\u0026#34;10.0.0.200:7890\u0026#34; export https_proxy=\u0026#34;10.0.0.200:7890\u0026#34; my docker clase\n1 2 export http_proxy=\u0026#34;10.0.0.9:7890\u0026#34; export https_proxy=\u0026#34;10.0.0.9:7890\u0026#34; ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/linux-shell-proxy/","title":"Linux的shell命令行等临时挂代理"},{"content":"mysql 内存表替代redis的完整方案记录 内存表替代redis的完整方案记\nredis很强很轻量，但是对于结构化数据 mysql具有天然优势。\n这里只记录 使用mysql内存表替代redis的一个方案，只适用于某些特殊情况\n但是 mysql 内存表有几个天然缺陷 Memory不支持行锁只支持表锁，只有InnoDB支持行锁。这就导致了大并发的时候，尤其是并发写入的时候 mysql的Memory引擎效率并不高\n另外Memory不支持持久化储存，在宕机重启的情况下，虽然可以导入新数据。但是如果配置了主从同步会出现更多复杂问题。\n为了规避这些问题，可以在以下场景式 使用。\n最后采取的理想方式：\n1、分库处理，库A 所有表使用InnoDB，配置好主从同步并用户储存所有数据。库B 只有部分表从库A复制的表，且全部是内存表，不进行主从同步。\n2、mysql启动的时，库A部分表数据 完整复制到库B，或者应用端在查询不到数据的时候，自动复制数据过来。\n3、定时同步库B数据到库A 以持久化保存\n其他要注意的：\n1、频繁写入的数据，依旧还是使用redis，这是redis的天然优势\n2、关闭库B的 查询缓存（没有太大必要使用）\n3、大量数据非经常查询的数据，放在\n先看一个创建一个表 和复制一个表的基本语法\n另外一个简单的解决方法 是使用 ramdisk (tmpfs)，然后使用InnoDB 或者 MyISAM即可\n然后定时备份 ramdisk（最好关停mysql后备份）\n1 2 3 4 5 6 7 8 CREATE TABLE `fish_api`.`mem` ( `mem` INT NOT NULL ) ENGINE = MEMORY; CREATE TABLE targetTable LIKE sourceTable; INSERT INTO targetTable SELECT * FROM sourceTable; #完整代码 #DROP TABLE user_mem; CREATE TABLE user_mem LIKE user ; ALTER TABLE user_mem ENGINE = MEMORY; INSERT INTO user_mem SELECT * FROM user ; 其实需要的是 优化mysql\n频繁查询 较少写入的表的查询操作 开启查询缓存 这个比较好理解\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/mysql-cp-memory-innodb/","title":"mysql 内存表替代redis的完整方案记录"},{"content":"nginx 和 php 跨域配置 如果可以在php里面搞定，尽量不弄nginx的，以免影响迁移 nginx配置\n1 2 3 add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods \u0026#39;GET,POST,PUT,DELETE,PATCH,OPTIONS\u0026#39;; add_header Access-Control-Allow-Headers \u0026#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#39;; php\n1 2 3 4 5 6 7 8 9 // 设置允许其他域名访问 header(\u0026#39;Access-Control-Allow-Origin:*\u0026#39;); //header(\u0026#39;Access-Control-Allow-Origin: \u0026#39;.$_SERVER[\u0026#39;HTTP_ORIGIN\u0026#39;].\u0026#39;\u0026#39;); // 设置允许的响应类型 header(\u0026#39;Access-Control-Allow-Methods:POST, GET,OPTIONS, PUT, DELETE\u0026#39;); // 设置允许的响应头 header(\u0026#39;Access-Control-Allow-Headers:x-requested-with,content-type,Origin, Accept, Authorization\u0026#39;); thinkphp 直接放到 应用的index.php 就可以了\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/109/","title":"nginx 和 php 跨域配置"},{"content":"nginx下单独配置js文件过期时间，解决maccms每次修改播放器后都要用户清理缓存才有效的问题 利用expires 指令 原来代码\nlocation \\~ .\\*.(js|css)?$ { expires 12h; error\\_log /dev/null; access\\_log /dev/null; } 改为 location \\~ ._.(css)?$ { expires 12h; error\\_log /dev/null; access\\_log /dev/null; } location \\~ ._.(js)?$ { expires -1; error\\_log /dev/null; access\\_log /dev/null; } ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/nginx-expires/","title":"nginx下单独配置js文件过期时间，解决maccms每次修改播放器后都要用户清理缓存才有效的问题"},{"content":"php8的性能竟比php7.4提升了接近一倍 php终于支持jit了，而1996年java已经支持jit\nphp8.0 默认情况下 和php7.4性能基本接近，但是开启jit后 在cpu密集计算的情况下可以提升92%左右的性能，比php5 性能提升5-7倍\nPHP 8 的 JIT（Just In Time）编译器将作为扩展集成到 php 中 Opcache 扩展 用于运行时将某些操作码直接转换为从 cpu 指令，大概来说就是之前版本的Opcache 可以跳过编译解释直接机器码到zend，而jit跳过zend 直接到cpu指令 。PHP 的 JIT 使用了名为** DynASM (Dynamic Assembler) 的库**，该库将一种特定格式的一组 CPU 指令映射为许多不同 CPU 类型的汇编代码。 因此，编译器只需要使用 DynASM 就可以将 Opcodes 转换为特定结构体的机器码。\nJIT编译原理\n1、检查opcodes是否缓存\n2、zend compiler编译器进行编译生成opcodes\n3、optimizer优化器生成优化后的opcodes\n4、把优化后的opcodes放入opcodes cache缓存\n5、jit编译器把optimized opcodes再次编译成汇编机器码machine codes\n6、进入zend vm虚拟前先检查是否开启jit引擎\n7、如果已经开启了jit引擎则直接读取机器码中的jit buffer代码片段\n8、送入x86 cpu架构进行执行\n其他要明白的\n1、Opcache会做opcode层面的优化，比如图中的两条opcode合并为一条\n2、PHP8的JIT目前是在Opcache之中提供的\n3、JIT在Opcache优化之后的基础上，结合Runtime的信息再次优化，直接生成机器码\n4、JIT不是原来Opcache优化的替代，是增强\n5、目前PHP8只支持x86架构的CPU arm还要等着\n当然如果php只是处理一些io操作，那么你用php5 还是php8 都差不多，因为性能瓶颈在io上而不是cpu上。如果是IO 密集型操作的 应用，开启jit反而可能会有10%左右的性能消耗 ，尤其是Laravel。\n在密集计算的情况下，对比php7.4 和 未开机jit的php8 性能提升差不多是92%-120% ，也就是1倍左右。\n当然 即便是开启了 jit，在密集计算上，php的性能依旧被 node.js java C# go C++ 吊打\n至于为什么使用php 这个各取所需的话题没啥可说的 所以还是尽快升级到php8\n刚刚在宝塔中查看，已经支持到8.1.9 性能再提升4%左右 新项目不用考虑 直接上了。\n在php.ini 中看到\nopcache.jit_buffer_size=128m\nopcache.jit=1205\n宝塔默认帮开启了，opcache.jit这个配置由4个独立的数字组成，分别代表\n是否使用AVX指令 寄存器分配策略 JIT触发策略 JIT优化策略 具体查看php8手册\n值得注意的时php8.1.9下 部分扩展可能尚未支持\nlibssh2 【依赖关系如下：PECL/ssh2 –\u0026gt; libssh2 –\u0026gt; openssl】\nsg11\n常用的扩展 swoole redis之类的肯定都是没问题的\n最终使用一段时间后，发现jit虽然提升了性能，但是再io频繁的情况下，没有任何感觉\nphp8 虽然已经很不错了，但是依旧是吃性能离谱，考虑到每日的用户暴涨和服务器费用，最终选择用golang重写，彻底抛弃php\n以后 加上本博客最近也从wordpress 迁移到了 vuepress静态生成，以后用php的地方 可能就只是几个小动态页和maccms看看电影了\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/php8-jit/","title":"php8的性能竟比php7.4提升了接近一倍"},{"content":"php递归获取目录名和子文件名 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 //递归获取所有文件和文件夹 function get_dirs($dir_path) { $res = array(); $res_lists = array(); foreach(glob(\u0026#34;$dir_path/*\u0026#34;) as $item) { if(is_dir($item)) { $folder = end(explode(\u0026#39;/\u0026#39;, $item)); $res[$folder] =get_dirs($item); continue; } $res[] = basename($item); } return $res ; } echo \u0026#34;\u0026lt;pre\u0026gt;\u0026#34;; print_r ( get_dirs( dirname(__FILE__).\u0026#34;/md-file\u0026#34;) ); echo \u0026#34;\u0026lt;/pre\u0026gt;\u0026#34;; Array ( [0-index] =\u0026gt; Array ( [0] =\u0026gt; Hans.md )\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 [1-tds] =\u0026gt; Array ( ) [77-list1] =\u0026gt; Array ( [1-list2] =\u0026gt; Array ( [1-list3] =\u0026gt; Array ( ) ) ) [88-robotnote] =\u0026gt; Array ( [0] =\u0026gt; Hans.md ) [99-contact] =\u0026gt; Array ( [0] =\u0026gt; Hans.md [1] =\u0026gt; Hant.md [2] =\u0026gt; en.md ) )\n1 只要文件夹 //递归获取 只要文件夹 function get_dirs($dir_path) { $res = array(); $res_lists = array();\n1 2 3 4 5 6 7 8 9 foreach(glob(\u0026#34;$dir_path/*\u0026#34;) as $item) { if(is_dir($item)) { $folder = end(explode(\u0026#39;/\u0026#39;, $item)); $res[$folder] =get_dirs($item); continue; } } return $res ; }\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 Array ( [0-index] =\u0026gt; Array ( ) [1-tds] =\u0026gt; Array ( ) [77-list1] =\u0026gt; Array ( [1-list2] =\u0026gt; Array ( [1-list3] =\u0026gt; Array ( ) ) ) [88-robotnote] =\u0026gt; Array ( ) [99-contact] =\u0026gt; Array ( ) ) ``` ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/php-get_dirs/","title":"php递归获取目录名和子文件名"},{"content":"Syncthing解决 两台电脑完全一直到同步 + iPhone + ipad 完全同步 使用场景如下： 渔场有一台电脑 台式机，性能比较好，一台廉价笔记本平时多远程到这个台式机工作。但是偶尔会因为网络问题连接不好。加上自己喜欢折腾，考虑搭建一个同步盘。实现两个电脑的文件完全同步。 之前折腾了一圈 没有实现 参考 https://dev.leiyanhui.com/c/56 现在找到一个 基于p2p 软件 Syncthing 实现的功能：只有一台电脑开机情况下，文件和代码 和 iPhone 双向同步 两台电脑都开机的情况的下，四设备同步 官网地址 https://syncthing.net/ git加速下载 https://github.com/syncthing/syncthing/releases/download/v1.20.2/syncthing-windows-amd64-v1.20.2.zip 安装非常简单，绿色软件，双击exe后 一个黑窗，弹出一个网页 http://127.0.0.1:8384/# 网页界面 有中文 添加一个文件夹\nD:\\Syncthing\\ 文件夹id Syncthing 文件夹标签写 主机1 我这里写 B150M 在另外一台电脑上 也安装Syncthing 同样 在D盘新建文件夹 Syncthing 在另外一台电脑上 的网页端添加 远程设备， 在第一台计算机的 当前设备 二维码哪个地方可以看到 名字 类似 75XXXX-XXXXXX-XXXX-XXXX-HFN5IYV-PDIY5TC-XXXX-XXXX 的字符串 添加到 第二台设备上，然后 在第一台设备上 点同意 或者 添加 之类意义的 按钮 具体名称忘记 在第一台设备 上 编辑文件夹 (B150M) 在第二台设备 上 B150M 想要共享 \u0026ldquo;B150M\u0026rdquo; (Syncthing) 文件夹给您。 添加新文件夹？ 点击添加 位置到 D:\\Syncthing\\ 两台电脑分布往这个文件夹添加文件 测试 都可以 同步（握手走的Syncthing 服务器，文件同步 走的局域网 如果是公网 应该速度会差一些 穿透方法 晚点处理） 测试添加一个 软 链接 mklink /D \u0026ldquo;D:\\Syncthing\\Code_Space\u0026rdquo; D:\\Code_Space 经过测试不可以 暂时没有找到 解决方法。所以只能把文件 移动过来，然后软连接回原来的位置了。 同时 可以弄一个 ios客户端 作为随身设备 直接在appstore搜索 Syncthing 找到 Möbius Sync https://apps.apple.com/us/app/mobiussync/id1539203216?ign-itscg=30200\u0026amp;ign-itsct=apps_box#?platform=iphone 就可以了 iphone分别扫描两个电脑的 识别 二维码 添加上 然后两台电脑 都分享 文件 给 iPhone。因为文件夹id 都一样 iPhone不会多出来一个额外的文件夹 iPhone 的客户端 只能同步20M 超过后 是收费的 30人民币， 值得\n进阶操作 实现 1、 开机启动启动 https://dev.leiyanhui.com/c/58 2、 解决外网速度 可以自建握手服务器，但是太麻烦了。我的解决方法 是付费7天的百度会员，完成首次同步。 百度会员同步空间 支持 软连接的，只是价格。。有点。每个月15块钱 在套餐里面的工作套餐。而且他这个只是备份工具 无法进行删除操作\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/57/","title":"Syncthing解决 两台电脑完全一直到同步 + iPhone + ipad 完全同步"},{"content":"Ubuntu 22.04 LTS：截图 的使用，可以直接拖拽到 wine的微信 经过测试 区域截图快捷键 PrSc 【对应我的键盘是 Fn+y】 全屏截图快捷键 shift PrSc\n【对应我的键盘是 Fn+shift+y】 当前窗口截图快捷键 alt PrSc【对应我的键盘是 Fn+shift+y】 截图后的文件自动保持到 ~/Pictures/截图 截图可以直接拖拽到 优麒麟的wine 微信 https://dev.leiyanhui.com/c/8\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/9/","title":"Ubuntu 22.04 LTS：截图 的使用，可以直接拖拽到 wine的微信"},{"content":"Ubuntu22.04LTS常用win软件的wine免维护和使用说明 QQ 微信 photoshop 自己折腾wine有多麻烦，懂的人都知道。 我这里选择 优麒麟 作为主要源 deepin作为替代 ## 使用优麒麟 配置好的软件 先去\nhttp://archive.ubuntukylin.com/ubuntukylin/pool/main/k/kylin-software-keyring/\n下载最新的 2022-03-31 17:52 sudo dpkg -i kylin-software-keyring_2022.03.30_all.deb\n然后打开 https://archive.ubuntukylin.com/ubuntukylin/pool/partner/ 先搜索 ukylin-wine 找到 ukylin-wine_70.6.3.25_amd64.deb sudo dpkg -i ukylin-wine_70.6.3.25_amd64.deb 搜索查找，weixin 还有一个 wechat 不清楚干嘛的，但是这个 weixin是 一直更新维护的 这个微信的 收发图片没问题 也没有乱码 支持发送文件，启动时候 没有wine那个进度条 存在的问题是 截图 功能不能使用 系统托盘没提示 好友列表的搜索功能不能使用 退出一次，再次打开无法打开 另外还有 wxwork photoshop-cs6 企业微信测试 发送文件的时候，选择框 是原生的wine，找文件费劲点 卸载方法``` dpkg -l | grep ukylin #查找 sudo dpkg -r ukylin-ps6 sudo dpkg \u0026ndash;purge ukylin-ps6\n\\## 使用deepinx 用这个源，注意安装后要注销一次才能加载出来图标\nwget -O- https://deepin-wine.i-m.dev/setup.sh | sh `sudo apt-get install com.qq.weixin.deepin` 安装其他软件 `````` https://deepin-wine.i-m.dev/\n经过我的测试，这个微信可以好友搜索 可以不用扫描，直接在手机确认后登录，但是存在几个问题 文件发送经常会导致整个崩溃 截图不能用 部分文字乱码 好友名称带特殊符号的乱码，启动有时候很慢 图片拖拽到聊天窗口 会作为文件发送 ### 卸载 sudo apt-get remove com.qq.im.deepin sudo apt-get remove com.qq.weixin.deepin sudo apt-get remove com.taobao.aliclient.qianniu.deepin 考虑到 系统托盘 已经m 原文参考 https://blog.csdn.net/hinmer/article/details/125246865\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/7-2/","title":"Ubuntu22.04LTS常用win软件的wine免维护和使用说明 QQ 微信 photoshop"},{"content":"ubuntu安装Arduino IDE 试试 用原生arduino 打开 https://www.arduino.cn/thread-5838-1-1.html\n下载回来后解压到 /MyData/Soft cd /MyData/Soft/arduino-1.8.19 sudo ./install.sh 卸载 就是 sudo ./uninstall.sh 然后再删除文件 其他和win下操作和使用完全一样\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/11/","title":"ubuntu安装Arduino IDE"},{"content":"Ubuntu一条命令更换源 以20.04LTS为例 Ubuntu一条命令更换源 以20.04LTS为例\n​​ 默认源 的速度 就那样 , 又不想使用第三方的sh文件, 其实可以直接替换默认文件 命令在文末 我们先备份(也可以跳过)\nsudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\n默认内容 如果没备份 并搞丢了 记得恢复默认内容 ​ 一行命令 正则替换 成阿里云\nsudo sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list 一行命令 正则替换 成 清华源 sudo sed -i \u0026rsquo;s/archive.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g\u0026rsquo; /etc/apt/sources.list\n其他源 自己改一下 地址的域名 就好了\ncat /etc/apt/sources.list ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/7/","title":"Ubuntu一条命令更换源 以20.04LTS为例"},{"content":"uniapp使用hex颜色自定义原生标题栏导航栏半透明 hex颜色支持半透明，文末 对照表 颜色格式 #FFFFFFBA FFFFFF对应颜色白色 BA半透明 73% 在 pages.json \u0026ldquo;globalStyle\u0026rdquo;: { \u0026ldquo;navigationBarTextStyle\u0026rdquo;: \u0026ldquo;black\u0026rdquo;, \u0026ldquo;navigationBarTitleText\u0026rdquo;: \u0026ldquo;uni-app\u0026rdquo;, \u0026ldquo;navigationBarBackgroundColor\u0026rdquo;: \u0026ldquo;#F8F8F8BA\u0026rdquo;, \u0026ldquo;backgroundColor\u0026rdquo;: \u0026ldquo;#F8F8F8\u0026rdquo; } navigationBarBackgroundColor 后面的BA 对照 73% \u0026ldquo;tabBar\u0026rdquo;: { \u0026ldquo;color\u0026rdquo;: \u0026ldquo;#7A7E83\u0026rdquo;, \u0026ldquo;selectedColor\u0026rdquo;: \u0026ldquo;#007AFF\u0026rdquo;, \u0026ldquo;borderStyle\u0026rdquo;: \u0026ldquo;black\u0026rdquo;, \u0026ldquo;backgroundColor\u0026rdquo;: \u0026ldquo;#F8F8F8BA\u0026rdquo;, \u0026ldquo;list\u0026rdquo;: [ **** ] }, backgroundColor 后门的BA 同样 hex颜色对照表\n\u0026lsquo;1.00\u0026rsquo;:\u0026lsquo;FF\u0026rsquo;, \u0026lsquo;0.99\u0026rsquo;:\u0026lsquo;FC\u0026rsquo;, \u0026lsquo;0.98\u0026rsquo;:\u0026lsquo;FA\u0026rsquo;, \u0026lsquo;0.97\u0026rsquo;:\u0026lsquo;F7\u0026rsquo;, \u0026lsquo;0.96\u0026rsquo;:\u0026lsquo;F5\u0026rsquo;, \u0026lsquo;0.95\u0026rsquo;:\u0026lsquo;F2\u0026rsquo;, \u0026lsquo;0.94\u0026rsquo;:\u0026lsquo;F0\u0026rsquo;, \u0026lsquo;0.93\u0026rsquo;:\u0026lsquo;ED\u0026rsquo;, \u0026lsquo;0.92\u0026rsquo;:\u0026lsquo;EB\u0026rsquo;, \u0026lsquo;0.91\u0026rsquo;:\u0026lsquo;E8\u0026rsquo;, \u0026lsquo;0.90\u0026rsquo;:\u0026lsquo;E6\u0026rsquo;, \u0026lsquo;0.89\u0026rsquo;:\u0026lsquo;E3\u0026rsquo;, \u0026lsquo;0.88\u0026rsquo;:\u0026lsquo;E0\u0026rsquo;, \u0026lsquo;0.87\u0026rsquo;:\u0026lsquo;DE\u0026rsquo;, \u0026lsquo;0.86\u0026rsquo;:\u0026lsquo;DB\u0026rsquo;, \u0026lsquo;0.85\u0026rsquo;:\u0026lsquo;D9\u0026rsquo;, \u0026lsquo;0.84\u0026rsquo;:\u0026lsquo;D6\u0026rsquo;, \u0026lsquo;0.83\u0026rsquo;:\u0026lsquo;D4\u0026rsquo;, \u0026lsquo;0.82\u0026rsquo;:\u0026lsquo;D1\u0026rsquo;, \u0026lsquo;0.81\u0026rsquo;:\u0026lsquo;CF\u0026rsquo;, \u0026lsquo;0.80\u0026rsquo;:\u0026lsquo;CC\u0026rsquo;, \u0026lsquo;0.79\u0026rsquo;:\u0026lsquo;C9\u0026rsquo;, \u0026lsquo;0.78\u0026rsquo;:\u0026lsquo;C7\u0026rsquo;, \u0026lsquo;0.77\u0026rsquo;:\u0026lsquo;C4\u0026rsquo;, \u0026lsquo;0.76\u0026rsquo;:\u0026lsquo;C2\u0026rsquo;, \u0026lsquo;0.75\u0026rsquo;:\u0026lsquo;BF\u0026rsquo;, \u0026lsquo;0.74\u0026rsquo;:\u0026lsquo;BD\u0026rsquo;, \u0026lsquo;0.73\u0026rsquo;:\u0026lsquo;BA\u0026rsquo;, \u0026lsquo;0.72\u0026rsquo;:\u0026lsquo;B8\u0026rsquo;, \u0026lsquo;0.71\u0026rsquo;:\u0026lsquo;B5\u0026rsquo;, \u0026lsquo;0.70\u0026rsquo;:\u0026lsquo;B3\u0026rsquo;, \u0026lsquo;0.69\u0026rsquo;:\u0026lsquo;B0\u0026rsquo;, \u0026lsquo;0.68\u0026rsquo;:\u0026lsquo;AD\u0026rsquo;, \u0026lsquo;0.67\u0026rsquo;:\u0026lsquo;AB\u0026rsquo;, \u0026lsquo;0.66\u0026rsquo;:\u0026lsquo;A8\u0026rsquo;, \u0026lsquo;0.65\u0026rsquo;:\u0026lsquo;A6\u0026rsquo;, \u0026lsquo;0.64\u0026rsquo;:\u0026lsquo;A3\u0026rsquo;, \u0026lsquo;0.63\u0026rsquo;:\u0026lsquo;A1\u0026rsquo;, \u0026lsquo;0.62\u0026rsquo;:\u0026lsquo;9E\u0026rsquo;, \u0026lsquo;0.61\u0026rsquo;:\u0026lsquo;9C\u0026rsquo;, \u0026lsquo;0.60\u0026rsquo;:\u0026lsquo;99\u0026rsquo;, \u0026lsquo;0.59\u0026rsquo;:\u0026lsquo;96\u0026rsquo;, \u0026lsquo;0.58\u0026rsquo;:\u0026lsquo;94\u0026rsquo;, \u0026lsquo;0.57\u0026rsquo;:\u0026lsquo;91\u0026rsquo;, \u0026lsquo;0.56\u0026rsquo;:\u0026lsquo;8F\u0026rsquo;, \u0026lsquo;0.55\u0026rsquo;:\u0026lsquo;8C\u0026rsquo;, \u0026lsquo;0.54\u0026rsquo;:\u0026lsquo;8A\u0026rsquo;, \u0026lsquo;0.53\u0026rsquo;:\u0026lsquo;87\u0026rsquo;, \u0026lsquo;0.52\u0026rsquo;:\u0026lsquo;85\u0026rsquo;, \u0026lsquo;0.51\u0026rsquo;:\u0026lsquo;82\u0026rsquo;, \u0026lsquo;0.50\u0026rsquo;:\u0026lsquo;80\u0026rsquo;, \u0026lsquo;0.49\u0026rsquo;:\u0026lsquo;7D\u0026rsquo;, \u0026lsquo;0.48\u0026rsquo;:\u0026lsquo;7A\u0026rsquo;, \u0026lsquo;0.47\u0026rsquo;:\u0026lsquo;78\u0026rsquo;, \u0026lsquo;0.46\u0026rsquo;:\u0026lsquo;75\u0026rsquo;, \u0026lsquo;0.45\u0026rsquo;:\u0026lsquo;73\u0026rsquo;, \u0026lsquo;0.44\u0026rsquo;:\u0026lsquo;70\u0026rsquo;, \u0026lsquo;0.43\u0026rsquo;:\u0026lsquo;6E\u0026rsquo;, \u0026lsquo;0.42\u0026rsquo;:\u0026lsquo;6B\u0026rsquo;, \u0026lsquo;0.41\u0026rsquo;:\u0026lsquo;69\u0026rsquo;, \u0026lsquo;0.40\u0026rsquo;:\u0026lsquo;66\u0026rsquo;, \u0026lsquo;0.39\u0026rsquo;:\u0026lsquo;63\u0026rsquo;, \u0026lsquo;0.38\u0026rsquo;:\u0026lsquo;61\u0026rsquo;, \u0026lsquo;0.37\u0026rsquo;:\u0026lsquo;5E\u0026rsquo;, \u0026lsquo;0.36\u0026rsquo;:\u0026lsquo;5C\u0026rsquo;, \u0026lsquo;0.35\u0026rsquo;:\u0026lsquo;59\u0026rsquo;, \u0026lsquo;0.34\u0026rsquo;:\u0026lsquo;57\u0026rsquo;, \u0026lsquo;0.33\u0026rsquo;:\u0026lsquo;54\u0026rsquo;, \u0026lsquo;0.32\u0026rsquo;:\u0026lsquo;52\u0026rsquo;, \u0026lsquo;0.31\u0026rsquo;:\u0026lsquo;4F\u0026rsquo;, \u0026lsquo;0.30\u0026rsquo;:\u0026lsquo;4D\u0026rsquo;, \u0026lsquo;0.29\u0026rsquo;:\u0026lsquo;4A\u0026rsquo;, \u0026lsquo;0.28\u0026rsquo;:\u0026lsquo;47\u0026rsquo;, \u0026lsquo;0.27\u0026rsquo;:\u0026lsquo;45\u0026rsquo;, \u0026lsquo;0.26\u0026rsquo;:\u0026lsquo;42\u0026rsquo;, \u0026lsquo;0.25\u0026rsquo;:\u0026lsquo;40\u0026rsquo;, \u0026lsquo;0.24\u0026rsquo;:\u0026lsquo;3D\u0026rsquo;, \u0026lsquo;0.23\u0026rsquo;:\u0026lsquo;3B\u0026rsquo;, \u0026lsquo;0.22\u0026rsquo;:\u0026lsquo;38\u0026rsquo;, \u0026lsquo;0.21\u0026rsquo;:\u0026lsquo;36\u0026rsquo;, \u0026lsquo;0.20\u0026rsquo;:\u0026lsquo;33\u0026rsquo;, \u0026lsquo;0.19\u0026rsquo;:\u0026lsquo;30\u0026rsquo;, \u0026lsquo;0.18\u0026rsquo;:\u0026lsquo;2E\u0026rsquo;, \u0026lsquo;0.17\u0026rsquo;:\u0026lsquo;2B\u0026rsquo;, \u0026lsquo;0.16\u0026rsquo;:\u0026lsquo;29\u0026rsquo;, \u0026lsquo;0.15\u0026rsquo;:\u0026lsquo;26\u0026rsquo;, \u0026lsquo;0.14\u0026rsquo;:\u0026lsquo;24\u0026rsquo;, \u0026lsquo;0.13\u0026rsquo;:\u0026lsquo;21\u0026rsquo;, \u0026lsquo;0.12\u0026rsquo;:\u0026lsquo;1F\u0026rsquo;, \u0026lsquo;0.11\u0026rsquo;:\u0026lsquo;1C\u0026rsquo;, \u0026lsquo;0.10\u0026rsquo;:\u0026lsquo;1A\u0026rsquo;, \u0026lsquo;0.09\u0026rsquo;:\u0026lsquo;17\u0026rsquo;, \u0026lsquo;0.08\u0026rsquo;:\u0026lsquo;14\u0026rsquo;, \u0026lsquo;0.07\u0026rsquo;:\u0026lsquo;12\u0026rsquo;, \u0026lsquo;0.06\u0026rsquo;:\u0026lsquo;0F\u0026rsquo;, \u0026lsquo;0.05\u0026rsquo;:\u0026lsquo;0D\u0026rsquo;, \u0026lsquo;0.04\u0026rsquo;:\u0026lsquo;0A\u0026rsquo;, \u0026lsquo;0.03\u0026rsquo;:\u0026lsquo;08\u0026rsquo;, \u0026lsquo;0.02\u0026rsquo;:\u0026lsquo;05\u0026rsquo;, \u0026lsquo;0.01\u0026rsquo;:\u0026lsquo;03\u0026rsquo;, \u0026lsquo;0.00\u0026rsquo;:\u0026lsquo;00\u0026rsquo;,\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/uniapp-hex-title-bar/","title":"uniapp使用hex颜色自定义原生标题栏导航栏半透明"},{"content":"uniapp字符串截取bug substr()和substring()无效\n这也不算是bug\n1 2 3 str_substr(str1,lenInt){ return str1.substr(0, lenInt) } 附加一个空字符串 就好了\n1 2 3 4 5 str_substr1(str1, ii) { str1=str1+\u0026#34;\u0026#34; return str1.substr(0, ii) } ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/uniapp-bug-substr-substring/","title":"uniapp字符串截取bug"},{"content":"unraid 安装 macos 12 Monterey 以及实现核显 win和macos 共享的方法 目的 一个能用得起的macos 并且可以通过 win虚拟机 本机转发macos的vnc 实现低带宽带宽下的远程访问\n环境 我这里基于 unraid 6.9.2 物理机 是 I7 8850H 的样子，魔改cpu qnct 核显是 UHD630 没有独显 大概就是6h12线 睿频2.8G左右 内存8x2=16G 硬盘一块nvme 512G 一块古董 2.5村1T机械盘 网卡和蓝牙是bcm924xx忘记了具体型号了。 #其他前置需求 ##梯子或者hosts https://dev.leiyanhui.com/c/133 尽量梯子吧 速度好一点 然后安装好 unraid 的最新应用市场和中文包 ##提前配置docker的国内镜像\n应用市场安装辅助工具 直接在应用市场搜索 Macinabox Macinabox 简单说明\n就是一个工具，帮你自动下载黑苹果用的oc 镜像等，以及自动帮你创建虚拟机。是基于docker挂载物理机目录的方式实现的\n安装完成后 会提示创建容器 Operating System Version: Monterey VM Images Location:和VM Images Location AGAIN !!!: 修改成ssd的路径 /mnt/disk1/domains/ Isos Share Location: 修改为机械硬盘 /mnt/disk2/isos/ appdata修改为 /mnt/disk1/appdata/macinabox custom ovmf location:修改 /mnt/disk1/system/custom_ovmf/ 点应用 等待 拉取镜像: spaceinvaderone/macinabox:lates 最后自动创建了容器root@localhost:# /usr/local/emhttp/plugins/dynamix.docker.manager/scripts/docker run -d --name='macinabox' --net='bridge' --privileged=true -e TZ=\u0026quot;Asia/Shanghai\u0026quot; -e HOST_OS=\u0026quot;Unraid\u0026quot; -e 'flavour'='Monterey' -e 'vminstall'='Auto install' -e 'vdisksize'='100G' -e 'vdisktype'='raw' -e 'opencore'='stock' -e 'replaceopencore'='no' -e 'overridenic'='no' -e 'VMIMAGES'='/mnt/disk1/domains/' -e 'ISOIMAGES'='/mnt/disk2/isos/' -e 'injectfixxml'='yes' -v '/mnt/disk1/domains/':'/domains':'rw' -v '/mnt/disk2/isos/':'/isos':'rw' -v '/mnt/disk1/appdata/macinabox':'/config':'rw' -v '/mnt/disk1/system/custom_ovmf/':'/customovmf/':'rw' -v '/boot/config/plugins/user.scripts/scripts':'/userscripts':'rw' 'spaceinvaderone/macinabox' 75e8a2253e687b88fd0ca13cfadbe7928916ecd32e957deb74e0f9f665b041f6 可以看到 上面我们配置的路径 都在这里搞定了 ##查看 Macinabox 结果 到容器里面 点Macinabox 查看日志 如果没有问题的话 会提示你对应的镜像文件配置文件 都给你弄好了。位置也说明了。 #搞脚本 user scripts 这个已经不是必须的了 看看上面日志 A copy of the macinabox helper user script was placed in /mnt/user/appdata/macinabox shell直接执行``` sh /mnt/user/appdata/macinabox/macinabox_helper_userscript.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 检查配置虚拟机Macinabox Monterey ========================= 先检查磁盘位置 是我们想要的，三个磁盘 一个opencore 一个install 一个系统磁盘 没有其他需要修改的项目 直接启动 链接vnc ========== opencore 自动加到到引导界面 选第一个硬盘 ，鼠标暂时不能用不能，等苹果进度条 因为我把 Monterey-install.img 放到了hhd的原因吧，启动比正常的VMware虚拟机的苹果安装程序还要慢 后面就是正常苹果安装步骤，先格式硬盘再安装。 我第一次选择错了硬盘，把oc给格式掉了。需要彻底删除重新弄。删除方法 看文末 等待安装完成 ====== 重启后 选择启动的时候，要注意 选择位置 简单配置一下 ，性能肯定是拉跨的，主要是显卡 显卡直通 wifi卡 蓝牙卡 直通 ================= 这些操作除了unraid的操作，主要还是黑苹果的驱动问题。慢慢折腾中.. 未完待续 ==== 彻底删除方法 ------ virsh destroy \u0026ldquo;Macinabox Monterey\u0026rdquo; virsh undefine \u0026ldquo;Macinabox Monterey\u0026rdquo; \u0026ndash;nvram docker stop macinabox docker rm macinabox rm -rf /mnt/disk2/isos/Monterey-install.img rm -rf /mnt/user/appdata/macinabox rm -rf /mnt/user/system/custom_ovmf rm -rf /mnt/user/domains/Macinabox*\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraid-install-macos-12-monterey/","title":"unraid 安装 macos 12 Monterey 以及实现核显 win和macos 共享的方法"},{"content":"unraid安装Intel GVT g 实现一个核显给多个虚拟机使用，目的 让虚拟机可以调用显卡实现远程加速 视频点播 虚拟群晖视频转码等等 unraid免梯子解决多数插件问题 - 小类随手记 (leiyanhui.com) 插件市场直接搜索 Intel GVT-G 有可能需要 提示等待的时候 一定要耐心等待 最后提示 plugin: intel-gvt-g.plg installed 才算完成 重启 unraid 打开设置 /Settings/intel-gvt-g-main 可以看到``` Following modes are available: i915-GVTg_V5_4 i915-GVTg_V5_8\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraid-intel-gvt-g/","title":"unraid安装Intel GVT g 实现一个核显给多个虚拟机使用，目的 让虚拟机可以调用显卡实现远程加速 视频点播 虚拟群晖视频转码等等"},{"content":"unraid安装插件或升级之类的，遇到GitHub被墙 最简单的解决方法 免梯子 免机场 试着用clash 弄半天 虽然可以用，但是没明白怎么自动更新配置文件，其他系统 都可以 就unraid的插件市场 一直提示 首先先去找在线hosts 源 找到源hosts后 先同网络的电脑修改 host试试，也可以用SwitchHosts 在本地试 看看可否打开 https://raw.githubusercontent.com/Squidly271/community.applications/master/plugins/community.applications.plg 如果可以打开基本上就可以了。 然后去修改unraid的hosts ，修改完 不用重启，也不用更新缓存，注意：重启就无效了。 如果要一直有效 就加到开机命令里面，不过没必要，又不是天天折腾插件什么的``` cd /etc mv hosts hosts-bak wget https://gitlab.com/ineo6/hosts/-/raw/master/next-hosts mv next-hosts hosts cat hosts\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraid-github/","title":"unraid安装插件或升级之类的，遇到GitHub被墙 最简单的解决方法 免梯子 免机场"},{"content":"unraid部署clash和可视化界面 建议用 v2rayA 更简单 https://dev.leiyanhui.com/linux/docker-proxy/\n先安装可视化界面\n1 2 3 4 5 docker pull haishanh/yacd docker run -p 1234:80 -d haishanh/yacd #1234端口是你访问clash可视化界面的端口 改一下 docker run --name clashx -p 1234:80 --restart=always -d haishanh/yacd 打开 http://unraidip:1234 可以访问了，但是不可以操作 有提示要添加一个9090的服务，先不管，我们继续\n去拿到 config.yaml 这个文件自己想办法。自己想办法解决节点问题。如果是机场有支持windows clash x的，订阅到windows后 本地会有这个文件 。这玩意收费的，不可能白嫖的。如果你没有地方买，可以找我拿邀请链接，会送你我一点流量。\n把文件放到 /mnt/disk1/appdata/clash/config.yaml\n1 2 C:\\Users\\你的用户名\\.config\\clash\\profiles 注意 是在 profiles 目录 继续安装docker\n1 2 docker pull dreamacro/clash docker run --name clash -d -v /mnt/disk1/appdata/clash/config.yaml:/root/.config/clash/config.yaml --privileged -p 7890:7890 -p 9090:9090 dreamacro/clash 然后发现 yacd 一直连不上 这边，最后改为host模式 就可以了。\nunriad启用http代理 修改U盘config目录下的go文件，增加如下代码，注意 加粗部分修改为你自己的IP和端口\nhttp_proxy=http://192.168.1.2:7890 https_proxy=http://192.168.1.2:7890 /usr/local/sbin/emhttp \u0026amp;\necho \u0026ldquo;export http_proxy=\u0026rdquo;http://192.168.1.2:7890\u0026quot;\u0026quot; \u0026raquo; /root/.bash_profile\necho \u0026ldquo;export https_proxy=\u0026rdquo;http://192.168.1.2:7890\u0026quot;\u0026quot; \u0026raquo; /root/.bash_profile\n修改U盘/config/plugins/community.applications目录下的proxy.cfg文件（没有的话自己手动创建）\n同样注意加粗部分修改成自己的\nport=7890\ntunnel=2\nproxy=http://192.168.1.2\nproxy=socks5://192.168.1.2\n下面给一个config.yaml 的范本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 mixed-port: 7890 #必须 allow-lan: true #必须的 bind-address: \u0026#39;*\u0026#39; #必须 mode: rule #必须 log-level: silent #必须 external-controller: \u0026#39;:9090\u0026#39; #必须 dns: enable: true ipv6: false default-nameserver: [223.5.5.5, 119.29.29.29] enhanced-mode: redir-host fake-ip-range: 198.18.0.1/16 use-hosts: true nameserver: [\u0026#39;https://doh.pub/dns-query\u0026#39;, \u0026#39;https://dns.alidns.com/dns-query\u0026#39;] fallback: [\u0026#39;https://doh.dns.sb/dns-query\u0026#39;, \u0026#39;https://dns.cloudflare.com/dns-query\u0026#39;, \u0026#39;https://dns.twnic.tw/dns-query\u0026#39;, \u0026#39;tls://8.8.4.4:853\u0026#39;] fallback-filter: { geoip: true, ipcidr: [240.0.0.0/4, 0.0.0.0/32] } proxies: - 更多内容 参考后 ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraid-clash/","title":"unraid部署clash和可视化界面"},{"content":"unraid离线安装官网中文语言包，免梯子的方法 unraid离线安装官网中文语言包，免梯子的方法\n6.9.2为例子 打开 https://github.com/unraid/lang-zh_CN zip下载 如果 github都打不开 那就找一个git加速网站 例如 https://ghproxy.com/https://github.com/unraid/lang-zh_CN/archive/refs/heads/master.zip 下载回来的zip不要解压 在unraid 的页面中点 tools 然后找到 http://xxxxxx/Tools/Language 重点来了，右侧 有一个 user 和 develop 切换按钮，点 user 切换到develop模式 Select language: 选择中文 Select language file: 点 Browse 选择刚刚的zip包 upload上传 刷新一下 页面 然后打开 /Settings/DisplaySettings 选择中文就可以了 也可以在 屏幕右上角 有一个 两个剪头组成的方框位置 切换语言 这个方法 修改的中文语言，重启后会失效。 如果 要一直有效，还是需要解决 GitHub污染问题，后安装最新版本 apps 市场，然后在市场里面直接安装 免梯子直接搞定的方法 unraid免梯子解决多数插件问题 - 小类随手记 (leiyanhui.com)\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraid-cn/","title":"unraid离线安装官网中文语言包，免梯子的方法"},{"content":"unraid免梯子解决多数插件问题 unraid大量依赖github，docker 跑clash的方法也可以，需要改三处地方。\n但是 大部分机场的配置文件 都是基于win的 需要手动转换，或者写脚本自动转换，真的很麻烦。\n那是改hosts了，next hosts 是一个稳定多年的host维护了\n1 2 3 4 5 6 7 #!/bin/bash #更新hosts cd /etc cp hosts hosts-bak rm -rf hosts wget -c https://gitlab.com/ineo6/hosts/-/raw/master/next-hosts mv next-hosts hosts 这个脚本 执行后，建议访问unraid的电脑也弄一下，或者挂梯子\n以后每次要装插件之前 执行一次 或者，干脆装一个 user script插件 添加到脚本里面\n然后custom，设定5分钟执行一次\n1 */5 * * * * ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraid-auto-hosts/","title":"unraid免梯子解决多数插件问题"},{"content":"unraid下kvm虚拟机创建和热拔插一个虚拟硬盘 创建\n1 2 3 cd /mnt/disk1/domains qemu-img create -f qcow2 win_soft.qcow2 40G virsh 附加到虚拟机\n1 virsh attach-disk Win2022 /mnt/disk1/domains/win_soft.qcow2 vdb --cache writeback --subdriver qcow2 --config --live windows2022 是虚拟机名称 vdb 是挂载序号\n还可以不关机直接改容量\n删除 ，添加容量，附加硬盘\n1 2 3 virsh detach-disk Win2022 vdb--persistent qemu-img resize /mnt/disk1/domains/win_soft.qcow2 +1G virsh attach-disk Win2022 /mnt/disk1/domains/win_soft.qcow2 vdb --cache writeback --subdriver qcow2 --config --live ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraid-kvm-add-disk/","title":"unraid下kvm虚拟机创建和热拔插一个虚拟硬盘"},{"content":"unraid虚拟机运行Windows 2022的配置文件 unraid破解版安装Windows10 ltc 2021的时候遇到花屏问题 没时间研究解决方法 尝试了windows server 2022 没问题 记录一下配置文件 先贴xml 后贴截图\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 \u0026lt;?xml version=\u0026#39;1.0\u0026#39; encoding=\u0026#39;UTF-8\u0026#39;?\u0026gt; \u0026lt;domain type=\u0026#39;kvm\u0026#39;\u0026gt; \u0026lt;name\u0026gt;Win2022\u0026lt;/name\u0026gt; \u0026lt;uuid\u0026gt;1ac2ae0c-a1df-1110-5b63-14d758344a6b\u0026lt;/uuid\u0026gt; \u0026lt;metadata\u0026gt; \u0026lt;vmtemplate xmlns=\u0026#34;unraid\u0026#34; name=\u0026#34;Windows 10\u0026#34; icon=\u0026#34;windows.png\u0026#34; os=\u0026#34;windows10\u0026#34;/\u0026gt; \u0026lt;/metadata\u0026gt; \u0026lt;memory unit=\u0026#39;KiB\u0026#39;\u0026gt;8388608\u0026lt;/memory\u0026gt; \u0026lt;currentMemory unit=\u0026#39;KiB\u0026#39;\u0026gt;8388608\u0026lt;/currentMemory\u0026gt; \u0026lt;memoryBacking\u0026gt; \u0026lt;nosharepages/\u0026gt; \u0026lt;/memoryBacking\u0026gt; \u0026lt;vcpu placement=\u0026#39;static\u0026#39;\u0026gt;12\u0026lt;/vcpu\u0026gt; \u0026lt;cputune\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;0\u0026#39; cpuset=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;1\u0026#39; cpuset=\u0026#39;6\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;2\u0026#39; cpuset=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;3\u0026#39; cpuset=\u0026#39;7\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;4\u0026#39; cpuset=\u0026#39;2\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;5\u0026#39; cpuset=\u0026#39;8\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;6\u0026#39; cpuset=\u0026#39;3\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;7\u0026#39; cpuset=\u0026#39;9\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;8\u0026#39; cpuset=\u0026#39;4\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;9\u0026#39; cpuset=\u0026#39;10\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;10\u0026#39; cpuset=\u0026#39;5\u0026#39;/\u0026gt; \u0026lt;vcpupin vcpu=\u0026#39;11\u0026#39; cpuset=\u0026#39;11\u0026#39;/\u0026gt; \u0026lt;/cputune\u0026gt; \u0026lt;os\u0026gt; \u0026lt;type arch=\u0026#39;x86_64\u0026#39; machine=\u0026#39;pc-i440fx-5.1\u0026#39;\u0026gt;hvm\u0026lt;/type\u0026gt; \u0026lt;/os\u0026gt; \u0026lt;features\u0026gt; \u0026lt;acpi/\u0026gt; \u0026lt;apic/\u0026gt; \u0026lt;hyperv\u0026gt; \u0026lt;relaxed state=\u0026#39;on\u0026#39;/\u0026gt; \u0026lt;vapic state=\u0026#39;on\u0026#39;/\u0026gt; \u0026lt;spinlocks state=\u0026#39;on\u0026#39; retries=\u0026#39;8191\u0026#39;/\u0026gt; \u0026lt;vendor_id state=\u0026#39;on\u0026#39; value=\u0026#39;none\u0026#39;/\u0026gt; \u0026lt;/hyperv\u0026gt; \u0026lt;/features\u0026gt; \u0026lt;cpu mode=\u0026#39;host-passthrough\u0026#39; check=\u0026#39;none\u0026#39; migratable=\u0026#39;on\u0026#39;\u0026gt; \u0026lt;topology sockets=\u0026#39;1\u0026#39; dies=\u0026#39;1\u0026#39; cores=\u0026#39;6\u0026#39; threads=\u0026#39;2\u0026#39;/\u0026gt; \u0026lt;cache mode=\u0026#39;passthrough\u0026#39;/\u0026gt; \u0026lt;/cpu\u0026gt; \u0026lt;clock offset=\u0026#39;localtime\u0026#39;\u0026gt; \u0026lt;timer name=\u0026#39;hypervclock\u0026#39; present=\u0026#39;yes\u0026#39;/\u0026gt; \u0026lt;timer name=\u0026#39;hpet\u0026#39; present=\u0026#39;no\u0026#39;/\u0026gt; \u0026lt;/clock\u0026gt; \u0026lt;on_poweroff\u0026gt;destroy\u0026lt;/on_poweroff\u0026gt; \u0026lt;on_reboot\u0026gt;restart\u0026lt;/on_reboot\u0026gt; \u0026lt;on_crash\u0026gt;restart\u0026lt;/on_crash\u0026gt; \u0026lt;devices\u0026gt; \u0026lt;emulator\u0026gt;/usr/local/sbin/qemu\u0026lt;/emulator\u0026gt; \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39; cache=\u0026#39;writeback\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/mnt/user/domains/Win2022/vdisk1.img\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hdc\u0026#39; bus=\u0026#39;virtio\u0026#39;/\u0026gt; \u0026lt;boot order=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x05\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; \u0026lt;controller type=\u0026#39;pci\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;pci-root\u0026#39;/\u0026gt; \u0026lt;controller type=\u0026#39;ide\u0026#39; index=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x01\u0026#39; function=\u0026#39;0x1\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;virtio-serial\u0026#39; index=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x04\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-ehci1\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x7\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci1\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x0\u0026#39; multifunction=\u0026#39;on\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci2\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;2\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x1\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;controller type=\u0026#39;usb\u0026#39; index=\u0026#39;0\u0026#39; model=\u0026#39;ich9-uhci3\u0026#39;\u0026gt; \u0026lt;master startport=\u0026#39;4\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x07\u0026#39; function=\u0026#39;0x2\u0026#39;/\u0026gt; \u0026lt;/controller\u0026gt; \u0026lt;interface type=\u0026#39;bridge\u0026#39;\u0026gt; \u0026lt;mac address=\u0026#39;52:54:00:cc:4c:19\u0026#39;/\u0026gt; \u0026lt;source bridge=\u0026#39;br0\u0026#39;/\u0026gt; \u0026lt;model type=\u0026#39;virtio-net\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x03\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/interface\u0026gt; \u0026lt;serial type=\u0026#39;pty\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;isa-serial\u0026#39; port=\u0026#39;0\u0026#39;\u0026gt; \u0026lt;model name=\u0026#39;isa-serial\u0026#39;/\u0026gt; \u0026lt;/target\u0026gt; \u0026lt;/serial\u0026gt; \u0026lt;console type=\u0026#39;pty\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;serial\u0026#39; port=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;/console\u0026gt; \u0026lt;channel type=\u0026#39;unix\u0026#39;\u0026gt; \u0026lt;target type=\u0026#39;virtio\u0026#39; name=\u0026#39;org.qemu.guest_agent.0\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;virtio-serial\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; port=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/channel\u0026gt; \u0026lt;input type=\u0026#39;tablet\u0026#39; bus=\u0026#39;usb\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;usb\u0026#39; bus=\u0026#39;0\u0026#39; port=\u0026#39;1\u0026#39;/\u0026gt; \u0026lt;/input\u0026gt; \u0026lt;input type=\u0026#39;mouse\u0026#39; bus=\u0026#39;ps2\u0026#39;/\u0026gt; \u0026lt;input type=\u0026#39;keyboard\u0026#39; bus=\u0026#39;ps2\u0026#39;/\u0026gt; \u0026lt;graphics type=\u0026#39;vnc\u0026#39; port=\u0026#39;-1\u0026#39; autoport=\u0026#39;yes\u0026#39; websocket=\u0026#39;-1\u0026#39; listen=\u0026#39;0.0.0.0\u0026#39; keymap=\u0026#39;en-us\u0026#39;\u0026gt; \u0026lt;listen type=\u0026#39;address\u0026#39; address=\u0026#39;0.0.0.0\u0026#39;/\u0026gt; \u0026lt;/graphics\u0026gt; \u0026lt;video\u0026gt; \u0026lt;model type=\u0026#39;qxl\u0026#39; ram=\u0026#39;65536\u0026#39; vram=\u0026#39;65536\u0026#39; vgamem=\u0026#39;16384\u0026#39; heads=\u0026#39;1\u0026#39; primary=\u0026#39;yes\u0026#39;/\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x02\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/video\u0026gt; \u0026lt;memballoon model=\u0026#39;virtio\u0026#39;\u0026gt; \u0026lt;address type=\u0026#39;pci\u0026#39; domain=\u0026#39;0x0000\u0026#39; bus=\u0026#39;0x00\u0026#39; slot=\u0026#39;0x06\u0026#39; function=\u0026#39;0x0\u0026#39;/\u0026gt; \u0026lt;/memballoon\u0026gt; \u0026lt;/devices\u0026gt; \u0026lt;/domain\u0026gt; ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/unraidwindows-2022/","title":"unraid虚拟机运行Windows 2022的配置文件"},{"content":"virtualbox 迁移到kvm 考虑到硬件直通的问题\n物理机 换到 unraid，原来在virtualbox运行的docker直接挂到了unraid\n剩下win虚拟机的软件磁盘（vhd vhdx） 还是需要迁移qcow2\n第一种方案 最简单，创建一个 qcow2 把vhdx文件直接通过nas 复制qcow2分区即可，也可以直接挂载vhd后复制文件\n第二种方案\n1 2 3 4 5 6 7 8 9 10 11 12 13 #blkdebug blklogwrites blkverify bochs cloop compress copy-before-write copy-on-read dmg file ftp ftps host_cdrom host_device http https luks nbd null-aio null-co nvme parallels preallocate qcow qcow2 qed quorum raw replication ssh throttle vdi vhdx vmdk vpc vvfat 、qed # vpc 就是 vhd cd /mnt/disk1/domains cp /mnt/disks/HHD/system-vhd-bak/Win-Soft-Data/SOFT.vhd ./ cp /mnt/disks/HHD/system-vhd-bak/Win-Soft-Data/IDEs.vhdx ./ qemu-img convert -p -f vpc -O qcow2 SOFT.vhd soft.qcow2 qemu-img convert -p -f vhdx -O qcow2 IDEs.vhdx ide.qcow2 有错误，先 qemu-img check -r all \u0026#39;IDEs.vhdx\u0026#39; 再转换 就ok了 然后挂载到虚拟机 unraid下kvm虚拟机创建和热拔插一个虚拟硬盘 - 小类随手记 (leiyanhui.com)\n1 2 3 4 5 6 7 8 9 10 11 virsh detach-disk Win2022 vdb --persistent virsh attach-disk Win2022 /mnt/disk1/domains/soft.qcow2 vdb --cache writeback --subdriver qcow2 --config --live virsh attach-disk Win2022 /mnt/disk1/domains/ide.qcow2 vdc --cache writeback --subdriver qcow2 --config --live error: Failed to attach disk error: internal error: unable to execute QEMU command \u0026#39;device_add\u0026#39;: Duplicate device ID \u0026#39;virtio-disk2\u0026#39; 检查发现 是 vdc 被占用了，不知道 改成 vdd 就可以了 ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/virtualbox-kvm/","title":"virtualbox 迁移到kvm"},{"content":"VirtualBox的优势和为什么选择VirtualBox 1、VirtualBox 免费开源 2、cpu 内存 和 硬盘 性能并不比vmware差 3、支持vdi vhd vmdk分区格式，自带命令行版本万能转化工具 4、轻巧 5、支持macos 可以支持到13版本[2022-08-29] 6、支持usb 7、VirtualBox 做的vhd或者vdi 可以在物理机直接启动 8、VirtualBox 在多数情况下 运行linux 或者win 在不需要3d的情况下，不管直接运行还是docker 并不比vmware性能差，VirtualBox +linux+docker 的性能，也只是略逊于 wsl+docker Windows vhd的话用BOOTICE.exe之类的的工具直接附加到bcd即可 也可以用ventoy 启动 linux的话 可以用ventoy 启动 详情参考ventoy官网\n比vmware 或者 hyper-v差的地方 1、教程较少 如果是玩特殊系统新手上手难度较大，比如 最新版黑群晖的教程 就几乎没有，虽然不难，但是新手可能懵逼 2、3d性能比vmware拉胯，当然比hyper-v更拉跨 3、不支持硬件直通，vmware也不支持，exsi pve unraid之类的支持 hyper-v也可以支持\n什么情况下选择 hyper-v？ hyper-v不支持usb这是很多人 感觉最蛋疼的，可以用 USB Over Network 解决这个问题，其他情况下 hyper-v 性能最优，而且支持vgpu 但是 hyper-v 安装黑苹果 非常麻烦：大致流程是 开启vgpu 或者硬件直通后，以及嵌套虚拟化后 在hv 安装pve 或者unraid 再行安装黑苹果。unraid app市场带一个自动安装工具不过只支持双核cpu\n什么情况下选择hyper-v 有正版Windows、对性能要求高，完全不玩虚拟macos、不喜欢在虚拟机跑docker 什么情况下选择vmware 完全不玩vhd 可以接受vmware player 或 盗版sn 对VirtualBox不感冒，对3d要求略高一些 什么情况下选择VirtualBox 不会在虚拟机里面打游戏，对3D性能要求不太高，有能力搞定一些特殊的需求 我选择 VirtualBox + vmware 是因为我需要使用vmware跑黑苹果，另外一些商用服务器性质的内容丢到VirtualBox 运行，和hyper-v 以及物理机 之间来回迁移方便。\n2022年10-07 已经全部迁移到 换kvm了\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/virtualbox-superiority/","title":"VirtualBox的优势和为什么选择VirtualBox"},{"content":"windows server 2022 开机自动登录 因我的windows server 2022 运行在kvm上，不存在安全问题，所以配置一下，开机自动登录 第一是 开机 ctrl+alt+del 的问题 注册表 win+r regedit\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\PasswordLess\\Device]\nDevicePasswordLessBuildVersion 改为1 或者保存为reg 双击导入\n1 2 3 Windows Registry Editor Version 5.00 [HKEY\\_LOCAL\\_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\PasswordLess\\Device] \u0026#34;DevicePasswordLessBuildVersion\u0026#34;=dword:00000000 ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/win2022-autologin/","title":"windows server 2022 开机自动登录"},{"content":"Windows访问btrfs文件系统 群晖磁盘使用btrfs文件格式 Windows下不容易访问 简单方法 就是安装一个驱动 https://github.com/maharmstone/btrfs\n解压后 右键 btrfs.inf 安装 如果系统开了 安全启动 驱动会无法加载 需要改一下注册表\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CI\\Policy\n新建一个 DWORD value called UpgradedSystem and set to 1\n然后重启 另外一个软件 UFS Explorer，但是网上破解版 基本都是假的 有文件大小限制。\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/btrfs-win/","title":"Windows访问btrfs文件系统"},{"content":"windows通过sftp挂载linux分区的方法 方法很多 rclone sshfs-win 都可以，但是图形界面并且配置简单的 还是 sFTPDrive\n免费版本 不支持命令行，只支持手动绑定，重启也需要手动启动一次，但是其实也足够了。\nhttps://www.nsoftware.com/sftp/drive/download.aspx\n也可以使用rclone\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/windows-sftp-linux/","title":"windows通过sftp挂载linux分区的方法"},{"content":"宝塔面板自身y以及phpmyadmin开启ssl，并自动续签的方法。 实现方法：把宝塔面板自身的ssl证书文件软连接到网站的ssl证书文件 而网站自己的ssl是可以通过宝塔自带的计划任务续签的。 首先知道两边文件的路径 面板和phpmyadmin默认使用的文件从 /www/server/panel/vhost/nginx/phpmyadmin.conf 可以看到 路径分别是 /www/server/panel/ssl/certificate.pem; /www/server/panel/ssl/privateKey.pem; 网站的ssl证书文件是 /www/server/panel/vhost/cert/forssl.jia.leiyanhui.com/fullchain.pem; /www/server/panel/vhost/cert/forssl.jia.leiyanhui.com/privkey.pem; 准备软连接 ln -s 源文件 目标文件 然后在面板和phpmyadmin位置分别打开ssl 就可以了。 因为我这里了二级域名 jia.leiyanhui.com 和三级域名 *.jia.leiyanhui.com 三级域名的证书不可以使用 *.leiyanhui.com的证书，所以单独申请\n1 2 3 4 rm -rf /www/server/panel/ssl/certificate.pem rm -rf /www/server/panel/ssl/privateKey.pem ln -s /www/server/panel/vhost/cert/forssl.jia.leiyanhui.com/fullchain.pem /www/server/panel/ssl/certificate.pem ln -s /www/server/panel/vhost/cert/forssl.jia.leiyanhui.com/privkey.pem /www/server/panel/ssl/privateKey.pem 需要更新一下本地浏览器缓存\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/106/","title":"宝塔面板自身y以及phpmyadmin开启ssl，并自动续签的方法。"},{"content":"宝塔中运行多个mysql的方法 docker 再跑一个mysql 是最简单的了哈\n1 2 3 4 5 6 7 8 9 docker pull mysql:latest docker run -itd --name mysql -p 3307:3306 -e MYSQL\\_ROOT\\_PASSWORD=123456 mysql 如果还要自定义配置文件的话 用-v mkdir /www/wwwroot/leiyanhui.com/docker-mysql-cnf docker run -itd --name mysql -v /www/wwwroot/leiyanhui.com/docker-mysql-cnf:/etc/mysql/conf.d -p 3307:3306 -e MYSQL\\_ROOT\\_PASSWORD=123456 mysql 然后在宝塔面板 添加远程服务器 ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/baota-2mysql/","title":"宝塔中运行多个mysql的方法"},{"content":"宝塔自动备份ssl域名证书文件到oss 路径 /www/server/panel/vhost/ssl 可以添加到目录里面 也可以直接 cp到wwwroot 然后 ln -s 回去\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/baota-ssl-to-oss/","title":"宝塔自动备份ssl域名证书文件到oss"},{"content":" 本文实际写于 2017年，到现在2023年初需求已经发生很多变化。\nhttps://dev.leiyanhui.com/all-in-one/my-netdisk\n搭建私有网盘的一些需求和想法 日常使用环境\nwin8 win11 + ubuntu linux desktop+ ios设备 vbox 虚拟机已经在跑ubuntu+宝塔 多远程环境使用，笔记本性能拉胯 需求：\n自动备份 桌面环境下 某些文件 [只要能挂载 sysnc之类的软件可以简单搞定] 标准目录储存 ios 只要求能访问 ES文件浏览器 支持 smb ftp sftp webdav 等多环境 不是问题 文件实际保存在 windows NTFS分区 ，方便管理维护 可以自动同步到 公用云 阿里云盘 百度云 可以加密储存 视频文件可绕过公用云的 ai 原因你懂的哈 支持在线视频音乐播放 文本文件编辑，md文件编辑 尽可能的替代群晖 抛弃的方案：\n群晖：确实好用，但是 无法使用物理机的文件系统作为数据目录，另外黑群晖也存在不稳定的情况 seafile nextcloud 等私有盘系统，过于繁琐，且免费版限制较多 unraid ： 也不错，但是多数功能还是需要自行解决，在不嵌套虚拟机docker的情况下，同样没太大意义 最终方案\n用来运行宝塔的虚拟机，通过ftp或者smb挂载物理机目录到虚拟机内 基于php+文件系统的 私有云方案 可道云 nextcloud phpEasyVCS 等 虚拟机 linux中挂载本地硬盘 并映射到 虚拟机的指定目录 阿里云 webdav容器+百度云 两种方式 可道云相关功能\nkodbox支持 sqlite 支持 mysql 也有一个版本[KodExplorer]可以无数据库运行，但是不支持webdav[可以用phpEasyVCS 解决] kodbox的redis 不支持密码连接 [小事情] 自己用访问量不大，也可以用文件缓存 或者Memcached 免费版本 除了用户数限制之外，定时备份不支持文件备份[可以用linux shell 解决] 支持在线编辑md 文本 没找到 文件加密储存方法， 视频文件可以用自定义后缀名绕过公用云 机密文件 自行用zip加密算了 经过简单测试 KodExplorer 可以保持原目录结构保持文件 KodBox拆分日期保存。 也就是 KodBox 反而集合了seafile的缺点，还自带了owncloud 和nexcloud的php低效缺点 。不符合我需求，KodExplorer 不错，但是不支持 oss和百度云云挂载，也不支持webdev 不过这些都可以解决。KodExplorer 更像是一个加强版的在线文件管理器。KodExplorer完全开源，版权可以修改，但是会有一个修改提示。 中间的\n在线文件关联 简单编辑 音影视频播放 KodExplorer webdav 使用php 或者apache/nginx功能搞定 手机ios访问，es文件管理器 用sftp 或webdav Windows系统访问，sftp挂载 或者 webdav挂载 公用云备份功能：阿里云盘目前可以用webdav暂时先用，百度云盘也尽量搞定防止阿里云盘失效，坚果云虽支持webdav但是免费版限制太多，收费版速度一般般，阿里oss 储存其他一些文件 远程下载功能：远程桌面直接迅雷，后期单独搭建一个Aria 公有云备份功能1：宝塔自带的备份到oss功能 公有云备份功能2：rclone挂载 最终的选择 自己用golang写了一个 webdav，部分环境用nginx做webdav\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/privatecloud/","title":"搭建私有网盘的一些需求和想法"},{"content":"大量小文件在smb中传输的一个不具有广泛适用性的解决方法 大量小文件在smb中传输的一个不具有广泛适用性的解决方法\n环境：unraid自带的smb共享 + Windows server 2022 常用软件 我放到了 \\10.0.0.8\\SharpYanhui 映射到Z盘，但是发现诸多问题。 首先 软件打开的 时候 会频繁提示 安全问题，再次 就是部分软件安装不到 过来，有权限问题。比如 腾讯 tim 另外就是 一些小文件的写入 会非常慢。 为了解决这个问题想到一个简单的方法。 在 \\10.0.0.8\\SharpYanhui 创建一个vhd 文件，然后挂载到 win物理机 搞定。 文件复制到 挂载路径 就可以了 缺点：不适合其他操作系统，同一时间 只能有一个机器挂载这个vhd文件。 所以 只适合 少数场景\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/smb-sharp-vhd/","title":"大量小文件在smb中传输的一个不具有广泛适用性的解决方法"},{"content":"导出几个自己常用的虚拟机镜像 1、win7 64 俄罗斯精简版 没有优化，直接上传\n2、win10 64 20h2 企业 官网版\n正常安装，然后\n关闭休眠powercfg -h off.和虚拟内存 系统还原（如果需要自行打开），\n并安装 vbox的驱动 用wepe工具箱的iso文件启动，打开dism 空间回收全选 关闭自动安装推荐应用 进去win10 下载一个dism++ 用dism 删除已经安装的appx 和预安装的dism++ 保留应用商店相关，随手可恢复 删除一些无用的 可选功能 正常可以压缩的4G左右 Windows hello face 中文补充字体《还是保留吧》 Chinese prc hand xx 手写输入 wmp 播放器 再次启动的winpe 删除休眠文件和交换文件 实际占用空间 5.39G 关机，移除winpe碟片 导出 上传百度云 和 阿里云 3、xp 本来打算用deepinxp sp3的 结果找不到了 于是先用官网母盘\ned2k://|file|zh-hans\\_windows\\_xp\\_professional\\_with\\_service\\_pack\\_3\\_x86\\_cd\\_vl\\_x14-74070.iso|630237184|EC51916C9D9B8B931195EE0D6EE9B40E|/ 弄了一个 只装驱动 没优化 然后又找到 deepinxp sp3 重新做了一个 \u0026gt; DeepinXPsp3 是deepxp的最后一个版本，后来他就转型洗白了，现在的deepin linux 也是他们做的。这个版本日常使用没有任何问题，偶尔提示找不到dll什么的 ，需要挂一下winxpsp3的原盘 (多数可以挂他自己)解决，iis被精简掉了，网上有恢复包。因为我不用iis6 所以也不打算找了。要用自己找一下吧\n下载地址：链接: https://pan.baidu.com/s/1-S-gBDFfiZSc4pLyDygfKw 提取码: havg\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/6/","title":"导出几个自己常用的虚拟机镜像"},{"content":"很开心maccms作者采取了我的建议，在采集页面增加了进度提示 maccms是一个优秀的电影网站管理程序 一直以来很受灰产欢迎哈，但是它也确实很优秀。 我是通过maccms开始深入了解到thinkphp。更是基于maccms二开过几个小项目。 至今也自行维护了一个盗版电影网站 供自己和好友观看\n这个小建议 没想到会获得作者的认可 issues： https://github.com/magicblack/maccms10/issues/934 update： https://github.com/magicblack/maccms10/releases/tag/v2022.1000.3032\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/maccms-my-issues/","title":"很开心maccms作者采取了我的建议，在采集页面增加了进度提示"},{"content":"解决 vscode 链接ssh后 每次都输入密码的问题 简单的说 就是 用ssh-keygen 创建 私钥和公钥，公钥内容 添加到 /root/.ssh/authorized_keys\n然后配置ssh 使用这个私钥 打开cmd 输入\nssh-keygen -t rsa -C \u0026ldquo;你的@qq.com(你的邮箱)\u0026rdquo; -C 后面是备注\n一直回车 生产了一个\nC:\\Users\\你的/.ssh/id_rsa.pub 到要登录的用户的 根目录 创建一个文件夹 .ssh 目录如果是root用户 一般是 /root其他用户 应该是/home/你的 的 .ssh目录 并重命名为 authorized_keys 如果已经有这个文件 在下面添加一行 内容就是 id_rsa.pub 的内容 类似 ssh-rsa XXXX 在修改权限 重启一下 sshd chmod 600 authorized_keys sshd restart 然后在vscode中键入ctrl+shift+p 搜索sshconfig 也就是 在user下面增加一行 IdentityFile \u0026ldquo;\u0026ldquo;C:\\Users\\你的.ssh\\id_rsa\u0026rdquo;\u0026rdquo;\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/51/","title":"解决 vscode 链接ssh后 每次都输入密码的问题"},{"content":"两台电脑完全同步的可能性和方法，Codeup 和 oneDrive 天翼网盘 icloud教育 自建nextcloud 几个尝试 使用场景如下： 渔场有一台电脑 台式机，性能比较好，一台廉价笔记本平时多远程到这个台式机工作。但是偶尔会因为网络问题连接不好。加上自己喜欢折腾，考虑搭建一个同步盘。实现两个电脑的文件完全同步。\n先考虑了一下 Codeup ， 目前是单库容量5G LFS容量不限，我其实要同步的文件 只有几个G左右，但是软件差不多10G+ 。 不是说不可以，但是实现起来有一些麻烦。 优点是速度很快，而且Linux下完美访问，缺点1 单个库的容量只有5G 另外每次用完电脑需要手动提交 克隆 推送什么的。 ##再次 考虑 oneDrive 同济 有1T空间，足够用了。缺点是 分享功能 仅限同济大学组织内分享，不可外部分享。优点容量足够，速度尚可。还有一个小缺点是 同济大学的管理员 也可看到文件。所以敏感信息 最好还是加密一下。 我的主账号 因为没有使用onedrive 导致 开机一直提示 无法登录 打开 https://onedrive.live.com/ 又被墙了。。。挂上梯子 继续 个人主账号 被冻结了 需要 24小时解除，解除冻结后，可以用了。 但是添加账号的时候 一直没有反应，不知道原因。猜测是需要更新Windows 更新win11 到最新版，重启电脑 尝试添加账号，成功，修改路径 到 【D:\\OneDrive - 同济大学】 去掉 桌面 文档 图片 的自动同步，不然 多电脑的时候 会偶尔混乱 我没有喜欢在桌面和文档里面 访东西，所以不用同步他们。 PS：个人账号，可以通过邀请的方式 拿到15G空间，如果文件不是特别多的话 也沟通了。不过个人的od服务器在新加坡，速度略慢。\n在原始主机上 开始创建 软链接到 OneDrive 在 OneDrive 创建文件夹 D:\\OneDrive - 同济大学\\D_disk 统一管理 管理员权限 运行cmd （因为文件名中有空格，所以目标路径用双引号） mklink /D \u0026ldquo;D:\\OneDrive - 同济大学\\D_disk\\Code_Space\u0026rdquo; D:\\Code_Space mklink /D \u0026ldquo;D:\\OneDrive - 同济大学\\D_disk\\Soft\u0026rdquo; D:\\Soft Code_Space 这个目录 因为只有1100多个文件，很快就同步上去了。 Soft 里面 97,903 个文件，15,346 个文件夹 10G 左右，结果一直提示 查找更改，耐心等了一晚上没有同步成功。于是尝试少量多次手动复制到 OneDrive目录，然后再软连接回原目录 经过测试 上传速度可以跑满 1.5M 下载速度只有200K，好像是索引在境外服务器上导致的 暂时无解 放弃\n尝试 天翼网盘 免费版本 有30G D:\\TianYi mklink /D \u0026ldquo;D:\\TianYi\\D_disk\\Code_Space\u0026rdquo; D:\\Code_Space 经过测试 同步上传速度 小文件很慢，客户端 需要1-2秒时间 读取 然后再用几秒的时间 上传，另外下载速度也一般情况，要花费2-3秒的时间 显示 正在获取下载信息。最为致命的是，她的不可以选择性同步，是需要整个目录 完全同步下来 才可以开始使用。 国产垃圾 哈哈\n更换 icloud教育 云贵版 试试 https://support.apple.com/zh-cn/HT204283 好吧 教育版 不可以登录 icloud 免费版只有 5G 不靠谱\n自建 nextcloud 测试 性能很一般 而且不可以选择性同步\n360云盘 测试 实际上是备份功能，只能添加和修改的时候自动上传到360 并非同步功能\n最后 还是 选择 oneDrive 世纪互联（同济） 折腾到现在 目前暂时 只有 oneDrive 可用。考虑到速度确实不理想 而且一次性同步多个文件的时候 卡一晚上不动 只能慢慢同步。\n其他几个小问题 偶尔会出现 正在查找更改 这个如果是文件太多导致的，基本无解。如果不是 可以重置一下 关闭 onedrive 然后cmd 运行 %localappdata%\\Microsoft\\OneDrive\\onedrive.exe /reset %localappdata%\\Microsoft\\OneDrive\\onedrive.exe\n上传速度问题 有一个修改线程的方法 可以解决，我这边是慢速10M =\u0026gt; 1.1M 不需要处理\n下载速度问题 实际测试 发现是 寨本wifi速率 太低导致的，世纪互联 实际有1M 以上。 更换usb网卡后 临时解决 最后 尝试 Syncthing 完美实现 https://dev.leiyanhui.com/c/57\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/56/","title":"两台电脑完全同步的可能性和方法，Codeup 和 oneDrive 天翼网盘 icloud教育 自建nextcloud 几个尝试"},{"content":"批处理 处理wifi掉线问题 win10-win11 下无线网卡 偶尔掉线问题 批处理文件\n@echo off %1\nmshta vbscript:CreateObject(\u0026ldquo;Shell.Application\u0026rdquo;).ShellExecute(\u0026ldquo;cmd.exe\u0026rdquo;,\u0026quot;/c %~s0 ::\u0026quot;,\u0026quot;\u0026quot;,\u0026ldquo;runas\u0026rdquo;,1)(window.close)\u0026amp;\u0026amp;exit :Begin ping www.baidu.com if errorlevel 1 goto Reboot if errorlevel 0 goto Continue :Continue goto Begin: :Reboot netsh interface set interface WLAN disabled netsh interface set interface WLAN enable echo %date:~0,4%%date:~5,2%%date:~8,2%%time:~0,2%%time:~3,2%%time:~6,2% 断网已重启,等待延时8秒\u0026hellip;\u0026raquo;log.txt\n:设置延时等待\nping -n 8 127.0.0.1 \u0026gt;nul\ngoto Begin\n打开任务计划程序（taskschd.msc） 创建基本计划任务 触发器 选 计算机启动时 最后选择 不管用户是否登录 使用最高权限 在条件里面 关闭 只有使用交流电 这个 设置里面 关掉三天什么的\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/49/","title":"批处理 处理wifi掉线问题 win10-win11 下无线网卡 偶尔掉线问题"},{"content":"批处理修改系统环境变量，以使用golang绿色版本 :: 用户变量 :: GOPATH C:\\Users\\Yanhui\\go G:\\Go_lang\\C_go_path\\go :: Path 添加 C:\\Users\\Yanhui\\go\\bin G:\\Go_lang\\C_go_path\\go\\bin :: 系统变量 :: Path 添加 :: C:\\Program Files\\Go\\bin G:\\Go_lang\\go_bin\\bin :: C:\\Program Files\\Git\\cmd G:\\Go_lang\\Git\\cmd @ echo off %1 %2 ver|find \u0026ldquo;5.\u0026quot;\u0026gt;nul\u0026amp;\u0026amp;goto :Admin mshta vbscript:createobject(\u0026ldquo;shell.application\u0026rdquo;).shellexecute(\u0026rdquo;%~s0\u0026quot;,\u0026ldquo;goto :Admin\u0026rdquo;,\u0026quot;\u0026quot;,\u0026ldquo;runas\u0026rdquo;,1)(window.close)\u0026amp;goto :eof :Admin set mypath=%~dp0 echo %mypath% :: 在你的bat开头加上上面的命令即可 :: 下面是你需要执行的命令 setx GOPATH \u0026ldquo;%mypath%C_go_path\\go\u0026rdquo; :: C:\\Windows;C:\\Windows\\System32 setx PATH %PATH%;\u0026quot;%mypath%Git\\cmd\u0026quot;;\u0026quot;%mypath%go_bin\\bin\u0026quot; /m ECHO 按任意键继续\u0026hellip; PAUSE \u0026gt;nul\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/syetem-path-golang/","title":"批处理修改系统环境变量，以使用golang绿色版本"},{"content":"容器 自动备份自己整个容器 使用sshpass 或者 key登录宿主机，然后执行docker备份命令\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 sshpass -p 密码 ssh root@10.0.0.8 -tt \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026lt;\u0026lt; remotessh #远程登录 echo 准备导出docker... backupdir=\u0026#34;/mnt/disks/HHD/docker-bak/\u0026#34; echo 导出到 ${backupdir} datename=$(date +%Y%m%d-%H%M%S) command -v pigz \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; { echo \u0026#34;pigz 命令存在 用tgz输出 \u0026#34; docker export baota | pigz -p 12 \u0026gt; ${backupdir}baota${datename}.tgz } || { echo \u0026#34;pigz 命令不存在，用tar gz\u0026#34; docker export baota | gzip\u0026gt;${backupdir}baota${datename}.tar.gz } echo 结束 exit remotessh ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/docker-backup-from-docker/","title":"容器自动备份自己整个容器"},{"content":"少量数据大并发的mysql优化 除去用ramdisk redis 内存表等方法，比较靠谱的方案 还是 仔细优化mysql\n手动缓存mysql 查询 query_cache_type有3个值 0代表关闭查询缓存OFF，1代表开启ON，2（DEMAND）代表当sql语句中有SQL_CACHE关键词时才缓存 建议用 2\nselect SQL_CACHE user_name from users where user_id = \u0026lsquo;100\u0026rsquo;;\nquery_cache_size = 64M ，不宜设置过大，否则在数据更新的时候，会有较大的性能开支用于标注失效。 每个表 创建一个 InnoDB FILE： innodb_file_per_table=1 ，为了防止 ibdata1 过大失控 ibdata1 想要瘦身，最好的办法，还是重建表，即为，复制表\u0026gt;删除原表\u0026gt;新表改名 innodb_buffer_pool_size 最好和目标数据库内容差不多大，这样 就可以完全从内存中读取数据\n另外innodb_buffer_pool_size 在mysql启动的时候，里面没有数据的，需要查询一下常用记录以便预热，在整库备份之前，最好也预热一下，以免占用太多时间。如果数据较少，这步骤也可以忽略。 修改硬盘写入频率：innodb_flush_log_at_trx_commit，默认1代表实时写入，0 是1秒一次 2也是1秒一次。\n修改0 就好。当然非正常关闭的情况下有概率会丢失1秒的数据 打开慢查询日志，记录查询超过1秒的数据【生产服务器，注意硬盘】\nlong_query_time=1\nlog-slow-queries=/var/log/mysql/log-slow-queries.log 关闭服务器端 SWAP 所有查询 最后还是要 LIMIT ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/mysql-config/","title":"少量数据大并发的mysql优化"},{"content":"使用golang快速开发一个webdav网盘和web目录文件浏览 昨天突然想把docker的某几个目录映射出来，然后又不想使用-v 或者sftp的方式。\n于是想到使用webdav，php下webdav工具一大把，但docker里面明显可能没有php环境。所以想到用golang自己写一个。因为golang没有那么多依赖要处理哈。\n顺带一起做了 静态文件浏览，方便共享一些文件。以及密码认证 配置文件 等等\n成品发布到了\ngitee：https://gitee.com/joyanhui/webdavgo/\ngithub：https://github.com/joyanhui/webdavgo/\n初始版本代码如下 最新版请去gitee 查看\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 package main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;golang.org/x/net/webdav\u0026#34; ) var webDavConfig map[string]interface{} var fs_webdav = \u0026amp;webdav.Handler{} var webdav_port_string string func init() { ConfigData, err := os.ReadFile(\u0026#34;config.json\u0026#34;) // 读取文件 var settingCfg string if err == nil { settingCfg = string(ConfigData) } else { //无配置文件的情况 settingCfg = \u0026#34;{\\\u0026#34;wevdav_user_name\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;wevdav_user_psw\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;webdav_server_port\\\u0026#34;:18123,\\\u0026#34;wevdav_file_path\\\u0026#34;:\\\u0026#34;.\\\u0026#34;,\\\u0026#34;list_server_path\\\u0026#34;:\\\u0026#34;/list/\\\u0026#34;,\\\u0026#34;list_file_path\\\u0026#34;:\\\u0026#34;.\\\u0026#34;}\u0026#34; fmt.Println(\u0026#34;无配置文件使用默认\u0026#34;) fmt.Println(\u0026#34;settingCfg\u0026#34;, settingCfg) } json.Unmarshal([]byte(settingCfg), \u0026amp;webDavConfig) //转化到map } func main() { port_float64, _ := strconv.ParseFloat(fmt.Sprintf(\u0026#34;%f\u0026#34;, webDavConfig[\u0026#34;webdav_server_port\u0026#34;]), 64) //从interface转化到float64 再到int 再到port_str webdav_port_string = fmt.Sprintf(\u0026#34;%d\u0026#34;, int(port_float64)) http.HandleFunc(\u0026#34;/\u0026#34;, web_dav) //启动webdav fmt.Println(\u0026#34;webdav url: http://localhost:\u0026#34; + webdav_port_string + \u0026#34;/ file pach:\u0026#34; + fmt.Sprintf(\u0026#34;%s\u0026#34;, webDavConfig[\u0026#34;wevdav_file_path\u0026#34;])) if webDavConfig[\u0026#34;wevdav_user_name\u0026#34;] != \u0026#34;\u0026#34; { fmt.Println(\u0026#34;wevdav_user_name=\u0026#34;, webDavConfig[\u0026#34;wevdav_user_name\u0026#34;], \u0026#34;, wevdav_user_psw=\u0026#34;, webDavConfig[\u0026#34;wevdav_user_psw\u0026#34;]) } //http.HandleFunc(\u0026#34;/list2/\u0026#34;, http_list1) list_server_path := fmt.Sprintf(\u0026#34;%s\u0026#34;, webDavConfig[\u0026#34;list_server_path\u0026#34;]) list_file_path := fmt.Sprintf(\u0026#34;%s\u0026#34;, webDavConfig[\u0026#34;list_file_path\u0026#34;]) if list_server_path != \u0026#34;\u0026#34; { http.Handle(list_server_path, http.StripPrefix(list_server_path, http.FileServer(http.Dir(list_file_path)))) fmt.Println(\u0026#34;weblist url: http://localhost:\u0026#34; + webdav_port_string + list_server_path + \u0026#34; file pach:\u0026#34; + list_file_path) } http.ListenAndServe(\u0026#34;:\u0026#34;+webdav_port_string, nil) } /* webdav */ func web_dav(w http.ResponseWriter, req *http.Request) { if webDavConfig[\u0026#34;wevdav_user_name\u0026#34;] != \u0026#34;\u0026#34; { // 获取用户名/密码 wevdav_user_name, wevdav_user_psw, ok := req.BasicAuth() if !ok { w.Header().Set(\u0026#34;WWW-Authenticate\u0026#34;, `Basic realm=\u0026#34;Restricted\u0026#34;`) w.WriteHeader(http.StatusUnauthorized) return } // 验证用户名/密码 if wevdav_user_name != fmt.Sprintf(\u0026#34;%s\u0026#34;, webDavConfig[\u0026#34;wevdav_user_name\u0026#34;]) || wevdav_user_psw != fmt.Sprintf(\u0026#34;%s\u0026#34;, webDavConfig[\u0026#34;wevdav_user_psw\u0026#34;]) { http.Error(w, \u0026#34;WebDAV: need authorized!\u0026#34;, http.StatusUnauthorized) return } } fs_webdav = \u0026amp;webdav.Handler{ FileSystem: webdav.Dir(fmt.Sprintf(\u0026#34;%s\u0026#34;, webDavConfig[\u0026#34;wevdav_file_path\u0026#34;])), //路径 LockSystem: webdav.NewMemLS(), } fs_webdav.ServeHTTP(w, req) } ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/webdavgo/","title":"使用golang快速开发一个webdav网盘和web目录文件浏览"},{"content":"私有css和js包括少量图片应该如何托管到cdn，免费替代jsdelivr的方案 2021年之前，这个不用想，肯定是无脑 jsdelivr+github 现在，很多人选择了 阿里云或者腾讯的对象储存+cdn 不是说不行吧。只是还是有一点小费用产生。 境外的话，肯定直接 GitHub+cf 就好了。 境内 unicloud 选择阿里云的 纯免费的，基本上对中小项目没啥限制 打开静态网页托管，可以绑定自己的域名。默认就使用阿里的cdn 前端网页部署限制为最大存储空间用量2GB 单文件最大限制为50MB 禁止做图床的，偶尔有几个小图片没事 最终实现方案 为避免滥用，内容删除\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/12/","title":"私有css和js包括少量图片应该如何托管到cdn，免费替代jsdelivr的方案"},{"content":"修改宝塔浏览器标签默认图标 因为经常操作两个宝塔面板，为了方便区分 修改一下 浏览的 /www/server/panel/BTPanel/static/favicon.ico ps 调调色 随便弄弄\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/112/","title":"修改宝塔浏览器标签默认图标"},{"content":"一个免费的php空间 ，速度不错，但是需要每个月续费一次 #一个免费的php空间 ，速度不错，但是需要每个月续费一次\nhttps://www.yun316.net/\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/1123/","title":"一个免费的php空间 ，速度不错，但是需要每个月续费一次"},{"content":"一键备份几个重要文件到sshdfs的Ubuntu 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 @echo on\u0026amp;cls\u0026amp;mode con cols=50 lines=30 \u0026amp;color 0a title=复制 xcopy I:\\other_need_back_to_oss U:\\BTdata\\wwwroot\\other_need_back_to_oss /y /e xcopy I:\\ssh_rsa U:\\BTdata\\wwwroot\\ssh_rsa /y /e xcopy \u0026#34;I:\\备份重要文件到ubuntu再到oss.bat\u0026#34; \u0026#34;U:\\BTdata\\wwwroot\\备份重要文件到ubuntu再到oss.bat\u0026#34; /y /e echo \u0026#34;修改权限\u0026#34; pause ssh bt \u0026#34;chmod -R 777 /BTdata/wwwroot/;chown -R www:www chmod -R 777 /BTdata/wwwroot/ \u0026#34; pause ","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/89/","title":"一键备份几个重要文件到sshdfs的Ubuntu"},{"content":"隐私政策 我们是谁 推荐的文本： 我们的站点地址是：https://wp.leiyanhui.com。\n评论 推荐的文本： 当访客留下评论时，我们会收集评论表单所显示的数据，和访客的IP地址及浏览器的user agent字符串来帮助检查垃圾评论。\n由您的电子邮箱地址所生成的匿名化字符串（又称为哈希）可能会被提供给Gravatar服务确认您是否有使用该服务。Gravatar服务的隐私政策在此：https://automattic.com/privacy/。在您的评论获批准后，您的资料图片将在您的评论旁公开展示。\n媒体 推荐的文本： 如果您向此网站上传图片，您应当避免上传那些有嵌入地理位置信息（EXIF GPS）的图片。此网站的访客将可以下载并提取此网站的图片中的位置信息。\nCookies 推荐的文本： 如果您在我们的站点上留下评论，您可以选择用cookies保存您的名字、电子邮箱地址和网站地址。这是通过让您可以不用在评论时再次填写相关内容而向您提供方便。这些cookies会保留一年。\n如果您访问我们的登录页，我们会设置一个临时的cookie来确认您的浏览器是否接受cookies。此cookie不包含个人数据，且会在您关闭浏览器时被丢弃。\n当您登录时，我们也会设置多个cookies来保存您的登录信息及屏幕显示选项。登录cookies会保留两天，而屏幕显示选项cookies会保留一年。如果您选择了“记住我”，您的登录状态则会保留两周。如果您注销登陆了您的账户，用于登录的cookies将会被移除。\n如果您编辑或发布文章，我们会在您的浏览器中保存一个额外的cookie。这个cookie不包含个人数据而只记录了您刚才编辑的文章的ID。这个cookie会保留一天。\n来自其他网站的嵌入内容 推荐的文本： 此站点上的文章可能会包含嵌入的内容（如视频、图片、文章等）。来自其他站点的嵌入内容的行为和您直接访问这些其他站点没有区别。\n这些站点可能会收集关于您的数据、使用cookies、嵌入额外的第三方跟踪程序及监视您与这些嵌入内容的交互，包括在您有这些站点的账户并登录了这些站点时，跟踪您与嵌入内容的交互。\n我们与谁共享您的信息 推荐的文本： 若您请求重置密码，您的IP地址将包含于密码重置邮件中。\n我们保留多久您的信息 推荐的文本： 如果您留下评论，评论和其元数据将被无限期保存。我们这样做以便能识别并自动批准任何后续评论，而不用将这些后续评论加入待审队列。\n对于本网站的注册用户，我们也会保存用户在个人资料中提供的个人信息。所有用户可以在任何时候查看、编辑或删除他们的个人信息（除了不能变更用户名外）、站点管理员也可以查看及编辑那些信息。\n您对您的信息有什么权利 推荐的文本： 如果您有此站点的账户，或曾经留下评论，您可以请求我们提供我们所拥有的您的个人数据的导出文件，这也包括了所有您提供给我们的数据。您也可以要求我们抹除所有关于您的个人数据。这不包括我们因管理、法规或安全需要而必须保留的数据。\nWhere your data is sent 推荐的文本： 访客评论可能会被自动垃圾评论监测服务检查。\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/privacy-policy/","title":"隐私政策"},{"content":"用户和api操作的限制 用户身份 IP 设备序号 用户id 用户手机设备cid 可伪造 不用于识别用户\n硬件设备 根据ip限制 单ip 单位分钟只可以查询 N次数据库 单i 单位时间内 只可以查询N次 redis \u0026lt;\u0026gt; 包括上传数据\n根据mac限制 即便是有效的mac 单位时间内只可以操作N次redis\n用户app 根据IP 单ip 单位时间内 只可以查询N次数据库检查用户密码 单ip 单位时间内 只可以查询N次redis检查用户密码\n根据用户id 单用户 单位时间内只可以查N次redis 单用户 单位时间内只可以查N次redis\n根据设备和app区分 设备上报日志 获取返回值 查询redis 根据ip 限制 1分钟内400次 limit.dev.redis.ip.xxx.m. 根据mac 限制 1分钟内40次 limit.dev.redis.mac.xxx.m. 查询数据库 根据ip限制 1分钟内60次 limit.dev.mysql.ip.xxx.m. 根据mac 限制 1分钟内1次 limit.dev.mysql.mac.xxx.m.\nAPP = \u0026gt; 登录 和 用id token检查登录 查询redis 根据ip 限制 1分钟内120次 limit.app.login.redis.ip.xxx.m. 查询数据库 根据ip限制 1分钟内100次 limit.app.login.mysql.ip.xxx.m.\nAPP =\u0026gt; 获取手机验证码 手机号要先存在\n查询数据库 根据ip 限制 1分钟内120次 limit.app.sms.mysql.ip.xxx.m. 发送SMS\n1分钟内1次 limit.app.sms.phone.xxx.m. 1天3次 limit.app.sms.phone.xxx.day.\nApp =\u0026gt; 获取设备日志 根据IP 查询用户日志 1分钟限制600次 limit.app.getlog.redis.ip.xxx.m. 1小时限制3600次 limit.app.getlog.redis.ip.xxx.hour. 根据用户id 1分钟限制600次 limit.app.getlog.redis.userid.xxx.m.\nApp =\u0026gt; 常规操作 根据IP 查询操作redis\n1分钟600次 limit.other.redis.ip.xxx.m. 1小时3600次 limit.other.redis.ip.xxx.hour. 查询操作数据库 1分钟600次 limit.other.mysql.ip.xxx.m. 1小时3600次 limit.other.mysql.ip.xxx.m.\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/114/","title":"用户和api操作的限制"},{"content":"远程操作com口，然后进行单片机开发方法 网络情况： A电脑 笔记本电脑，没有开发环境 usb转接com口 到单片机 win11系统 B电脑 24小时开机低功耗台式机 win8.1\n路由器： OpenWrt k2p 有公网ip 经过测试是不需要第三方软件，只需要 在远程桌面 本地资源 勾选上 端口 即可。\n但是在B电脑的设备管理器 里面看不到 用第三方串口工具可以看到 在 vmware 也可以看到[即com口可以直接在vmware的ard里面操作] 还一个方法 是用 usb over network 可以把usb转com的设备 共享出去\n次方法应该也适用与 xrdp\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/create-tcp-ip-serial-port/","title":"远程操作com口，然后进行单片机开发方法"},{"content":"再议 VirtualBox 与 VMware 对比，VirtualBox 没有你想的那么不堪 以截止到2022.9.22最新的VirtualBox 6.1.38 和 VMware VMware Workstation Pro16.2.4 对比\n首先 如果是linux主机 ，首选 kvm 没有之一 kvm下一切都是渣\n价格：VirtualBox 首选， VirtualBox 免费开源，VMware player免费但是仅限非商业用途，VMware WorkStation 不便宜（接近2k）。这点是很大的影响决策的因素。当然你用盗版VMware或者VMware player，或者非商业 也没啥。 轻量：VirtualBox是首选，VirtualBox安装后也就战役红260M硬盘 VMware 1G起步 多系统支持：Linux macos Windows都支持 另外VirtualBox支持无图形界面的Linux使用，也有一个基于php的web管理工具phpvirtualbox，VMware不清楚是否有。macos下vmware fusion player也是免费的，但也仅限非商业。 虚拟机文件管理：VirtualBox 就三个文件 vdi(虚拟磁盘) vbox(配置文件) prev（vbox的备份），VMware一堆 虚拟机磁盘管理：VirtualBox 的注册机制麻烦，自行复制虚拟磁盘后，会uuid冲突需要去修改一次。VMware不存在这问题。好像只有VirtualBox 存在虚拟机介质注册这个机制，而且还会检测uuid冲突 虚拟机磁盘格式支持：VirtualBox 支持 vdi vhd vmdk，并自带这三个之外的数种常见磁盘格式的转换。VirtualBox 只支持 vdi磁盘的整理压缩，vhd还是用Windows来。VMware只支持 vmdk但是也其他磁盘格式到vmdk的转换。VirtualBox 对vhd的完美支持，在Windows下管理更方便 共享目录：都支持 2D性能：Windows下VirtualBox 比kvm和VMware的2D性能更强。有物理机的50% 3D性能，VMware性能不错，VirtualBox 凑合。但是VirtualBox 的显卡内存不是网上其他博文说的只可以128M 命令行模式 可以随意改 ，也没有那么不堪。但是VMware的3D性能可以接近物理机60%左右 cpu、内存和硬盘性能： 都一样，所有的虚拟机系统基本上都差不多的性能。 黑苹果：VMware需要unlock后安装，VirtualBox 需要命令行修改后才可以装最新的 maos11-13。VirtualBox 的macos不支持两个核心以上的macos 会出现一些文件。VMware的不存在这个问题。安装后的macos 都是 半斤八两，应急用没啥问题，做吃力的工作都不现实。尤其3D性能都垃圾。 usb3 的支持，都支持。VirtualBox 有一个扩展包，大概几十m，是一个独立在VirtualBox 的扩展包和主版本一起更新。并不存在什么 麻烦的。安装挂载也简单 tpm支持：都支持，VirtualBox 支持tpm直通，VMware支持模拟的，是否可以直通不知。只是安装win11的话，这个没差，都可以绕过 硬盘直通：都支持，VirtualBox 需要做一个vmdk文件映射物理盘 虚拟化嵌套：VirtualBox 支持，VMware应该是不支持的，未测试过。这就导致了虚拟的Windows下 基于hyper-v的wsl docker会有问题吧。 半虚拟化：VirtualBox 支持，VMware应该是不支持的，未测试过。另外 kvm hyper-v xen都支持半虚拟化，性能损耗更少 软虚拟：VirtualBox 支持，VMware应该是不支持的，未测试过。VirtualBox 可以运行arm的安卓。VMware好像是不可以的。网上大量的安卓模拟器都是内置VirtualBox 最新版黑群晖支持：都支持，都一样弄。不存在新版在VirtualBox 装不上的问题，自己弄引导就好了。 动态磁盘：都支持 网络支持：都支持 桥接 nat ，没差别。 命令行启动，注册为Server：都支持 动态内存管理：就是可以释放没占用的内存，hyper-v的很秀，VMware支持 ,VirtualBox 也 技术文章和第三方支持广泛性：国内VMware的文章更多，某一些特殊系统的安装VMware的教程更多。国内企业选择VMware的也更多。培训和教程也多以VMware为主。VirtualBox 通常被说成一种问题多性能差功能少的 其他虚拟机系统缺点\nkvm，仅适用于Linux，模拟的Windows 3D 2D都拉跨，但是可以用显卡直通和vgpu来提升。非常适合Linux老手使用。Linux的不二选择。也是unraid pve等系统的默认虚拟机系统，群晖也是 hyper-v，接近免费，支持 vgpu 支持显卡直通，vgpu。可惜usb支持不佳。如果不是大吞吐量usb设备可以用第三方软件，或者 rdp等解决。 ecxi 和基于kvm的unraid pve 群晖等 不在对比之列 可以看到VirtualBox 对VMware相比缺点有：\n3D性能VirtualBox 仅支持到DirectX9以及OpenGL3.0，DirectX 11 和 OpenGL 4.1 3D 加速图形支持 虚拟最新黑苹果，不支持2个以上核心，不过VMware的macos性能也很拉跨，半斤八两。 VirtualBox 对比kvm和hyper-v的缺点：\n不支持显卡直通和vgpu 怎么选\nmacos下运行win和macos，不用想 肯定首选是pd虚拟机。如果不玩游戏 自然也可以 VirtualBox 或者vmware fusion Linux下 性能考虑首选kvm，如果不习惯，就选VirtualBox 或者vmware 。无 图形界面的Linux不需要太多3d性能的话，首选VirtualBox win/Linux 需要虚拟化macos，首选VMware，VMware player其实就够了。 需要3D性能，显卡直通，那就 kvm hyper-v，exci unraid pve等 不需要直通，需要vgpu那就 hyper-v kvm 只是需要基本的3D性能，那就VMware 次选VirtualBox macos下运行win，首选Parallels Desktop Linux server下 首选kvm 和VirtualBox win下和Linux 混合商业用途，想省钱，那就首选VirtualBox 了。尤其是运行 不需要3D性能的服务的时候，图形化界面，多格式虚拟磁盘支持。不用usb 还许需要 正版window 不需要usb，或者只是简单u盘 rs232之类的，且不需要VMware的情况下（VMware和hyper共存的情况下，VMware性能超级拉跨），首选hyper-v 我的选择：宿主系统也用来工作，因主要使用的软件不支持Linux winpe后性能拉跨，所以宿主机是Windows。偶尔用macos处理ios签名等问题。有一个Linux server 开发环境但是一直开机的，方便和主linux server 同步以及开发版调试。偶尔替代主力server使用，这个server上有一些敏感内容，且商用。\n也就是 最终就1-3个虚拟机而已，而且除了macos均没有3d需求，所以VirtualBox 成了首选\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/vm-platform-selection/","title":"再议 VirtualBox 与 VMware 对比，VirtualBox 没有你想的那么不堪"},{"content":"终于完成了php-\u0026gt;go的转移工作 原型产品使用的 thinkphp+mysql+redis开发的 纯api，由于并发太大，php吃资源离谱。基于节约成本考虑，直接用go重写 。数据库 依旧是原来数据库。\n总共30几个接口，历时一个月从零开始学习go并完成迁移工作。先重写大并发接口，而后逐个线上替换。\ngo主要用的库\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import ( \u0026#34;context\u0026#34; \u0026#34;crypto/md5\u0026#34; \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/buger/jsonparser\u0026#34; _ \u0026#34;github.com/go-sql-driver/mysql\u0026#34; \u0026#34;github.com/valyala/fasthttp\u0026#34; ) jsonparser 是一个json处理库，比自带的encoding/json速度要快，但encoding/json更灵活一些，所以都使用了\nfasthttp 是一个更加高性能的web服务，在多并发的时候 线程复用更强大\n但是 依旧使用了 net/http 来处理一些 第三方sdk\n感受和优势\n1、vscode自带代码校验，大错误小错误都会提示，代码低级失误较少。代码自动格式化\n2、不需要搭建环境，golang官方直接下载 安装即可，zip的话添加一个系统变量即可使用\n3、可以不依赖nginx，当然基于ssl gzip 日志 等需求，前端还是套一个nginx 简单一些\n4、编译速度很快，在vscode可以简单重新编译调试，4秒左右\n5、直接导出二进制文件，不用担心源码泄露 尤其是源码里面的一些密码部分。比如md5的二次加密密钥等\n6、计划任务 定时任务，可以直接单开一个线程处理，不依赖前台php文件唤起（当然 shell php也可以）go处理起来 很简单只需要一行 go cron_tab() //并发任务 即可\n7、宝塔自带守护进程，不需要自己另外守护\n8、fmt.Println fmt.Fprint(ctx, \u0026ldquo;{}\u0026rdquo;) 的日志输出，开发过程中监控运行状态更简单\n9、跨平台 依旧有高性能，win linux mac arm均可以搞定\n10、可以开发简单的 客户端软件。同语言 搞起来省心\n11、包管理和源码文件 管理，没有php方便 ，需要用go mod 或者第三方框架\n12、go和php相比，强类型需要时间适应，另外很多函数需要自己复写。go的异常处理 较为啰嗦，原生开发go的话，需要自己写大量简单的函数来封装 以便主流程代码简洁比如 md5 函数\n1 2 3 4 5 6 func MD5(str string) string { data := []byte(str + \u0026#34;xxxxxxxx\u0026#34;) //附加密码 has := md5.Sum(data) md5str := fmt.Sprintf(\u0026#34;%x\u0026#34;, has) return md5str } 还有 json和map互转 等等\n13、字符类型转化 很啰嗦，甚至 int int8 int16 之间转化 代码啰嗦，不过按需使用 可以做到更快的运行速度和极限的更低的资源占用\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/php-to-go-1st/","title":"终于完成了php-\u003ego的转移工作"},{"content":"主系统的选择，winxp win7 win8 win11 和黑mac和Linux，unraid、pve、ESXi等 先说黑苹果，软件多，主流软件均可使用。但是如果不是一直需要ios调试开发，不太适合我。因为长期使用远程工作，客户端有win ipad 安卓pad等情况，苹果的adr协议客户端很有限，而且多数不怎么好用，有一些不能全屏 有一些右键有问题。xrdp协议 算是阉割版的rdp协议，和真正的xrdp相比不实用\n其次说桌面 Linux，输入法的词库问题可以忍。但是hbuilderx wine后功能不全不说（真机调试困难），存在nodejs.exe大量吃cpu的问题\nunraid 功能 和性能 以及硬件直通 等 都没问题，以及U盘启动可以方便备份 等优点。而且只需要一个512M的u盘就可以了。（最好是好点的，杂牌U盘自己做好备份）\nunraid 还有以一个优势就是有一个成熟的apps市场，常见的插件甚至黑果自动安装脚本都有。缺点就是非常依赖github，需要自行解决墙或者hosts的问题,unraid 本身有很多xx版，用的好的话 就去买一个正版硬盘少的话并不贵。\n作为主系统而不是nas使用的缺陷有一个硬盘分区格式，以及文件管理的混乱（主要是值得*映射文件，当然做nas的这都不是问题）。以及虚拟磁盘格式 只有img个qcow2 两种，而且qcow2转换后 很多启动问题。\npve 基本上就是unraid 的缺点他都有，而且只自带LXC，优点是 免费\nESXi 个人版免费，因时间有限而且unraid 足够优秀，所以没用使用过。\n还一个方案 是linux+虚拟机的方案。\n关于虚拟机的选择，我更倾向于virtualbox作为主虚拟机管理，简单方便。cpu和内存 硬盘 对VMware hyper-v等对比更不差，只是显卡直通 和 3d性能孱弱。kvm也是一个好选择，但是既然主系统因为部分常用软件的问题无法做日常使用，又何必。。。\n剩下的系统 就只能是Windows了\nwindowxp 优点：磁盘体积小，几乎不占用多少硬盘。适当精简一下就可以控制到几百M，缺点:\n主流软件已经不支持，如果日常系统用虚拟机系统的话，这个不是啥问题 远程桌面不支持3D，ps：virtualbox支持Windows NT 2000 xp win7-11 部分驱动可能有问题 不支持vhd启动，可以用Grub4dos+winvblock解决 Windows 2000 同 WindowsXP ，当年在 xp大行其道的时候，Windows 2000 server做桌面端 别提有多爽，坏念青葱岁月了。\nwin7 win8 因为支持compact均可控制到8G左右硬盘占用 部分软件已经不支持win7\nwin10 win11 没啥太大差异，win8 以后系统 可以做主系统使用 也可以做虚拟机server使用\n最后的选择\nunraid win2000/xp win11 三选一\nunraid 也不能说过于折腾吧。只是先有几个虚拟机 还在vbox下 懒得迁移\nwin2000/xp 驱动问题也懒得弄\n还是 win11 来搞，精简压缩一下就好了。不过不精简 也可以轻松控制到12G以内\n但是windows作为宿主机 性能损耗还是有一些。2022年选择了unraid\n2022-10-07\nunraid 最版本6.11.1 试用版 经历几次莫名其妙的死机，弃用 加上github的依赖麻烦，还需要维护clash梯子，麻烦 最终弃用，数据备份后迁移到pve\n以后有时间 会尝试一下 ventoy + pve vhd的方式\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/main-os/","title":"主系统的选择，winxp win7 win8 win11 和黑mac和Linux，unraid、pve、ESXi等"},{"content":"做了一次瑞文iq。。。135+ 以为自己老了，不行了。 还好。。\nWed, 17 Aug 2022 12:01:09 +0000\n","date":"2022-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/iq-ruiwen/","title":"做了一次瑞文iq。。。135+"},{"content":"windows下VMware开机自动启动并自动处理解锁问题 批处理启动vm虚拟机的方法 很简单 新建一个bat文件：启动虚拟机.bat``` \u0026ldquo;C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun.exe\u0026rdquo; start \u0026ldquo;E:\\VM\\Alpine-BT\\Alpine-BT.vmx\u0026rdquo; nogui\n\u0026ldquo;C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun.exe\u0026rdquo; start \u0026ldquo;E:\\VM\\Alpine-DP\\Alpine-DP.vmx\u0026rdquo; nogui 添加到 任务计划 并，不管用户是否登录都要运行 实际操作用发现，偶尔会出现虚拟机被锁死。也就是 目录下出现.lck目录的问题 批处理删除文件夹的命令 是 rd /s /q = linux的rm -rf 但是 rd命令不支持通配符，所以加到循环里面，最终 for /d %%G in (\u0026ldquo;E:\\VM\\Alpine-BT*.lck\u0026rdquo;) do rd /s /q \u0026ldquo;%%~G\u0026rdquo; \u0026ldquo;C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun.exe\u0026rdquo; start \u0026ldquo;E:\\VM\\Alpine-BT\\Alpine-BT.vmx\u0026rdquo; nogui\nfor /d %%G in (\u0026ldquo;E:\\VM\\Alpine-DP*.lck\u0026rdquo;) do rd /s /q \u0026ldquo;%%~G\u0026rdquo;\n\u0026ldquo;C:\\Program Files (x86)\\VMware\\VMware Workstation\\vmrun.exe\u0026rdquo; start \u0026ldquo;E:\\VM\\Alpine-DP\\Alpine-DP.vmx\u0026rdquo; nogui\n","date":"2022-08-08T10:07:44Z","permalink":"https://dev.leiyanhui.com/c/windows-autostart-vmware/","title":"windows下VMware开机自动启动并自动处理解锁问题"},{"content":"偶尔还是要用ps 做几个文件，但是Photoshop的的wine 太难搞了，虚拟机下的又难受 今天尝试 用GIMP sudo apt install gimp 也可以在软件中心搜索 gimp 然后安装 GNU Image Manipulation Program （推荐） 同时卸载掉 之前装ps cs6 dpkg -l | grep ukylin sudo dpkg -r ukylin-ps6 sudo dpkg \u0026ndash;purge ukylin-ps6\n","date":"2022-08-06T00:00:00Z","permalink":"https://dev.leiyanhui.com/c/10/","title":"关于GIMP的记录，用于替代Photoshop"},{"content":"find shell比较好用的一个，还是国产的。 但是缓慢的启动速度 以及 作者的一些态度，真的无语 最早大概是2017年2018年左右 之前因为他强制升级 而且升级缓慢的问题，邮件反馈一次，高高在上 侮辱性回复。 还有新版本升级 不兼容旧版数据。。。 win自带ssh ，也可以通过bat的方式管理多个 但指纹 和证书 是绑定到 C盘 C:\\Users\\ 下的 懒得折腾，还是选择用putty 在只有10来个服务器端的时候 还是很好用。而且也支持命令行 但是putty有一个两个缺陷，1是配置文件是保存到注册表的 2是不可以保存密码 2 不是大问题，证书登录 可以解决 配置文件的备份 那就只能是导出注册表了 在 putty.exe 的同目录下 新建一个 “备份putty到注册表文件.bat” 内容\n1 2 reg export \u0026#34;HKEY_CURRENT_USER\\Software\\SimonTatham\\PuTTY\u0026#34; putty-session.reg pause 要管理的主机不是太多的话，也可以选择 MobaXterm\n免费版支持12个回话，自带x11转发和 x11server 支持多种协议\n国内代理商卖的终身版价格\u0026lt;100 元\n","date":"2022-08-03T22:46:28Z","permalink":"https://dev.leiyanhui.com/c/windows-ssh-putty-exe/","title":"Windows ssh客户端工具的选择 依旧是经典的putty.exe"},{"content":"去掉 Windows server 2022以及部分软件提示internet安全配置以及 打开共享文件的exe的安全提醒 是因为作为服务器系统 他的默认internet安全配置太高 点开始菜单 windows附件 打开 ie浏览器 ，忽略那些错误 然后 设置 internet选项 或者直接 运行 inetcpl.cpl 安全 区域： internet 去掉 启用保护模式 自定义级别 修改 修改项目 比较多，主要的有两个看文末截图即可 这个主要是解决 部分软件 提示 internet错误，要你添加一个网址到信任里面。 部分软件添加后 其实也不能用。还是需要降低这个设置。 另外那个 提示 我们无法缺点是谁创建了文件的提示 此文件位于你网络之外的位置 也是在 这配置。安全 区域 本地 站点，添加上 共享服务器 的地址就行了 可以直接输入ip ","date":"2022-08-03T22:23:01Z","permalink":"https://dev.leiyanhui.com/c/windows-server-2022-internetsafe/","title":"去掉 Windows server 2022以及部分软件提示internet安全配置以及 打开共享文件的exe的安全提醒，"},{"content":"arch 配置网络 笔记本的网卡损坏，使用的一个淘宝杂牌usb网卡\niwd 一直找不到网卡 不知道为什么\n最后 还是用 networkmanage 弄好\n安装的时候 用的iphone usb共享网络，chroot到系统后 需要安装两个包\n一个是 usbmuxd 一个是 dhcpcd\ndhcpd 记得用 systemctl 启用 并启动\n只有前者 iphone会提示设备访问 但是无法共享网络过来 只有后者 不用说了。\n安卓不清楚 没研究过\n我装了图形界面 dwm\n所以也顺带安装了 networkmanager 和 network-manager-applet 提供系统托盘图标（nm-applet）\n在 ～/。xinitr添加一行\n1 exec nm-applet \u0026amp; 在 exec dwm之前\n如果 dwm安装了系统托盘扩展的话，参考本文，就可以在下次重启的之后 在系统托盘看到信号 并可以配置了\n官网wiki参考 ：https://wiki.archlinux.org/title/NetworkManager_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-network-wifi/","title":"arch 配置网络"},{"content":"arch 上安装32位支持，以便支持wine等软件 启用multilib 多库\n1 2 3 4 5 sudo nano /etc/pacman.conf --------------- [multilib] Include = /etc/pacman.d/mirrorlist 然后更新\n1 sudo pacman -Sy 如果只是 需要 wine qq 微信之类的，就什么都不用做了\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-32bit-for-wine/","title":"arch 上安装32位支持，以便支持wine等软件"},{"content":"arch 系统清理和瘦身 节省磁盘空间\n1 2 3 pacman -Sc # 清理未安装软件包 pacman -Scc # 清理缓存中所有内容 yay -Scc # 如果安装了yay 直接用yay清理就好 查看所有已经安装的包，看需求删除\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 列出所有本地软件包（-Q,query查询本地；-q省略版本号） sudo pacman -Qq 列出所有显式安装（-e,explicitly显式安装；-n忽略外部包AUR） sudo pacman -Qqe sudo pacman -Qqen 列出自动安装的包（-d,depends作为依赖项） sudo pacman -Qqd 列出孤立的包（-t不再被依赖的\u0026#34;作为依赖项安装的包\u0026#34;） sudo pacman -Qqdt pacman -Qg: 列出本地已经安装的软件包组和子包 删掉不需要的\n1 2 3 4 5 6 7 sudo pacman -Rns ttf-nerd-fonts-symbols-2048-em sudo pacman -Rns neofetch sudo pacman -R $(pacman -Qdtq) #删掉所有独立的包 慎用，最好先 pacman -Qqdt 一下 #只删除包和它自己的独立需要的依赖 保留配置的话 sudo pacman -Rs firefox 限制一下日志大小\n1 sudo journalctl --vacuum-size=10M ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-disk-clean/","title":"arch 系统清理和瘦身"},{"content":"archlinux 删除kde 最近爱上平铺桌面，暂时用的的dwm，所以清理掉kde\n1 2 sudo pacman -Rsc plasma sudo pacman -Rsc kde-applications qingli\n1 2 3 4 5 6 sudo paccache -r # 清理缓存,仅包含最近的三个版本 sudo paccache -rk1 # 清理缓存,仅包含最近的1个版本 sudo pacman -Sc # 清理未安装软件包 sudo pacman -Scc # 清理缓存中所有内容 yay -Scc yay -S gnome-shell-extension-kimpanel-git\n1 2 3 4 5 6 7 yay -Rsn fcitx-sogoupinyin sudo pacman -Rsn fcitx-im fcitx-configtool sudo pacman -S fcitx-configtool fcitx-qt5 yay -S fcitx-qt4 yay -S fcitx-sogoupinyin ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-del-kde/","title":"archlinux  删除kde"},{"content":"archlinux 安装 dwm桌面 一直被人案例 i3w 和 dwm桌面，号称 开机20m内存额外占用\n需要安装x 和 驱动 1 pacman -S xorg 安装yay 查看本文\n1 yay -S dwm 这好像就完了，会自动帮你一起安装 dwm ，当然没有定制功能，定制看后面编译安装\n修改 或者新建\n1 nano .xinitrc 添加一行\n1 exec dwm 因为dwm 很多地方的修改都需要重新编译，所以 长时间使用 还是建议用编译安装 alt（win） +shift + q 退出 x\n然后删掉yay安装的dwm\n1 yay -Rn dwm 单独建立 一个目录 在 ～ 下 因为以后使用可能还有一些补丁 和资源 等 需要处理\n1 2 3 4 5 6 mkdir ~/dwmfile git clone git://git.suckless.org/dwm cd dwm ls #有一个config.def.h 是我们可以自定义的，也可不修改 make make install dwm修改主快捷键和默认快捷键配置\ndwm添加补丁-系统托盘\n用yay 或者编译安装后\n输入 startx 直接就启动了\nalt+shift+回车 启动终端\n安装一个火狐浏览器 alt+p 输入firefox 会自动提示，回车 启动火狐。。。。\n还可以自动换壁纸\nfeh\n哈可以半透明\ncompton\n输入法 有点问题 搜狗好像不行 但是 谷歌输入法 没问题\n开机到登录桌面 全部内存汗用120M 左右。。。\n是有点香喷喷的\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-install-dwm/","title":"archlinux 安装 dwm桌面"},{"content":"archlinux 安装GNOME 桌面环境 我一个笔记的arch是用的archinstall 装的kde桌面 [已经全面切换到平铺桌面]\n现在想试是gnome\n1 pacman -S gnome gnome-extra gnome-tweak-tool 或者\n1 sudo pacman -S --needed gnome gnome-tweaks nautilus-sendto gnome-nettool gnome-usage gnome multi-writer adwaita-icon-theme chrome-gnome-shell xdg-user-dirs-gtk fwupd arc-gtk-theme seahosrse gdm 需要简单优化一下 终端闪烁的问题，在终端设置里面 配置一下 背景颜色 就ok了 先去弄扩展\n1 2 sudo pacman -S gnome-browser-connector sudo pacman -S gnome-tweaks 我用的火狐 还需要装一个扩展\nhttps://addons.mozilla.org/en-US/firefox/addon/gnome-shell-integration/\n然后打开\nhttps://extensions.gnome.org/\n就可以装插件了 在插件页面 点击 on off 就可以了 appindicator 系统托盘程序哦，gnome默认关闭的 不安装的话你用微信qq之类的 没有提醒托盘图标 https://extensions.gnome.org/extension/615/appindicator-support/\n这个tray-icons-reloaded 也可以 一样用 https://extensions.gnome.org/extension/2890/tray-icons-reloaded/\ndash-to-dock是可以 吧dock 固定到屏幕上，类似 Windows 任务栏 macos 的dock 一样的 https://extensions.gnome.org/extension/307/dash-to-dock/\nTransparent Shell 通知栏 或者 dock 搜索条 透明，可以单独设置\nhttps://extensions.gnome.org/extension/3518/transparent-shell/\nCoverflow Alt-Tab 更漂亮的 Alt-Tab 带预览 不吃性能 https://extensions.gnome.org/extension/97/coverflow-alt-tab/\nClipboard Indicator 剪切板管理\nhttps://extensions.gnome.org/extension/779/clipboard-indicator/\nDesktop Icons NG (DING) 可以在桌面创建快捷方式 新版gnome 移除这个功能了，装这个扩展就ok了\nhttps://extensions.gnome.org/extension/2087/desktop-icons-ng-ding/\nApplication Volume Mixer 可以显示每个用声音的程序\nhttps://extensions.gnome.org/extension/3499/application-volume-mixer/\nExtension List 插件管理程序，不用每次都去网站卸载 这个没啥用，可以在启动里面找到extension直接管理 打开后 屏幕右上角 可以管理插件 https://extensions.gnome.org/extension/3088/extension-list/\n天气预报 https://extensions.gnome.org/extension/750/openweather/\n其他的\nBlur my shell。它可以使得我们在切换工作区时背景不那么单调。（操作基本同上）\nArcMenu。它默认会在桌面左上角生成一个小图标，点击其会分栏列出应用等 就是一个开始菜单。（操作基本同上）\nVitals。它默认会在桌面右上角生成计算机的温度、风扇转速、以及cpu、内存等信息。（操作基本同上） https://extensions.gnome.org/extension/1460/vitals/\njust perfection。它可以自主显示和关闭某些UI元素。（操作基本同上）\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-install-gnome/","title":"archlinux 安装GNOME 桌面环境"},{"content":"archlinux 截图工具 我是 kde桌面 测试了几个软件后 感觉 spectacle 不错\n1 sudo pacman -S spectacle 安装完成 会自动在kde 快捷键设置里面 添加快捷键，也可以自己手动配置 或者 修改\nwechat-uos 这个包 截图的话 要用 scrot 但是 经过测试是没法用的。有新的wechat的uos 第三方包，可以用其他截图工具\n后经过测试 Flamesshot 兼容性不错，体积也不大\n1 sudo pacman -S dlamesshot ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-kde-jietu/","title":"archlinux 截图工具"},{"content":"archlinux 双蓝牙 配置 我这个本 板载蓝牙有问题，有时候 莫名其妙 会找不到，也连不上ek的键盘 罗技的鼠标 可以链接\n加了一个usb蓝牙使用\n所以 我不单需要安装蓝牙 还要处理 双蓝牙的切换，在archinstall安装的kde上 很简单，有自带的工具包\n现在用的 dwm 就需要自己来搞定。1是驱动和管理程序 2 是系统托盘\n安装 bluez，这个软件包提供蓝牙协议栈。 安装 bluez-utils，这个软件包 bluetoothctl 实用程序。另外，也可以安装 bluez-utils-compat(yay) 来获得#弃用的 BlueZ 工具。 通用蓝牙驱动是 btusb 内核模块。检查模块是否已加载。如果还没有，先加载模块。 systemctl enable bluetooth systemctl start bluetooth 先检查蓝牙设备\nrfkill list ------ 0: hci0: Bluetooth Soft blocked: no Hard blocked: no 1: hci1: Bluetooth Soft blocked: no Hard blocked: no 两个蓝牙都启用状态 rfkill命令参考\n为了方便期间 我先拔下usb蓝牙，禁用板载蓝牙\nrfkill block 0 rfkill list ------ 0: hci0: Bluetooth Soft blocked: yes Hard blocked: no Soft blocked: yes 就是禁用了哦\n启用的话\nrfkill unblock 0 插入usb蓝牙，对应 1\nsudo pacman -S blueberry 先测试了一下 blueberry 60多M 可以使用，在dwm下也有系统托盘 blueberry-tray 但是不知道怎么添加 搜索设备。。。\n再 试试 bluesman 和 blueberry 要么太大了 要么不能用 需要一堆依赖的\n算了 直接使用 bluez自带的 bluetoothctl 吧，执行 bluetoothctl 进去交互\n#bluetoothctl $ bluetoothctl 进入蓝牙管理工具环境 [bluetooth]# power on 打开蓝牙 [bluetooth]# agent on 开启代理 [bluetooth]# scan on 扫描蓝牙设备 [bluetooth]# pair xx:xx:xx:... 配对该设备 [bluetooth]# trust xx:xx:xx:... 信任该设备 [bluetooth]# connect xx:xx:... 连接该设备 [bluetooth]# disconnect xx:xx:... 断开蓝牙 这里以链接我的ez键盘为例子 bluetoothctl \u0026mdash;\u0026mdash; Agent registered [CHG] Controller A0:9F:10:10:99:1F Pairable: yes [CHG] Controller 04:7F:0E:14:6A:53 Pairable: yes\nscan on #等一会儿 等显示出来设备名称 # [NEW] Device DC:2C:26:F5:19:A6 EK871 BT keyboard # 先删除 #disconnect DC:2C:26:F5:19:A6 pair DC:2C:26:F5:19:A6 trust DC:2C:26:F5:19:A6 connect DC:2C:26:F5:19:A6 # 这样就搞定了 后发现 重启好哦usb蓝牙有概率连不上\n新建一个sh文件\n# /bin/bash sudo rfkill list sudo rfkill block 1 sudo rfkill list sudo rfkill unblock 1 sudo rfkill block 0 sudo rfkill list sudo rfkill unblock 0 sudo rfkill #bluetoothctl # scan no echo \u0026quot;重新插拔一下 再执行\u0026quot; 官网wiki ： https://wiki.archlinux.org/title/Bluetooth_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-bluez/","title":"archlinux 双蓝牙 配置"},{"content":"archlinux 一键备份 考虑到兼容性 用的ext4 分区，不方便用快照功能备份。驱动弄完后，就用tar备份一下系统\ntar备份和Windows的 ghost备份其实差不多，甚至更加灵活方便。\n先看 arch的根目录\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 bin boot dev etc home lib lib64 lost+found mnt opt proc root run sbin srv sys tmp usr var 准备打包，先安装 pigz,因为支持多核压缩 也可以不用直接用gz也行\n1 sudo pacman -S pigz 要排除的目录\n1 2 3 4 5 6 7 8 9 10 11 12 /dev/* 设备指向 /sys/* /tmp/* 临时目录 /mnt/* 默认挂载 /media/* 新版已经把这个目录挪到了 /run/media /run/* 运行中的程序 /var/lock/* 一些程序锁定 /var/run/* 和run目录有啥区别不明 /var/lib/pacman/* /var/cache/pacman/pkg/* pacman的缓存 /proc 内存proc 文件系统， /lost+found 回收站 其他一些\n1 2 3 4 5 /run/media 自动挂载的盘 usb和cd等 /boot efi分区 /home/yanhui/.cache /home/yanhui/.mozilla /home/yanhui/.local/share/wallpapers/ 建议 切换到\n打包压缩命令 pigz 打包，这个需要live环境有安装才可以\n1 sudo tar --use-compress-program=pigz -cvpf /arch-backup.tgz --exclude=/arch-backup.* --exclude=/dev/* --exclude=/sys/* --exclude=/tmp/* --exclude=/mnt/* --exclude=/media/* --exclude=/run/* --exclude=/var/lock/* --exclude=/var/run/* --exclude=/var/lib/pacman/* --exclude=/var/cache/pacman/pkg/* --exclude=/proc/* --exclude=/lost+found --exclude=/home/yanhui/.cache/* --exclude=/home/yanhui/.mozilla/* / 单线程打包到tar.gz\n1 tar -zcvf /arch-backup.tar.gz --exclude=/arch-backup.* --exclude=/dev/* --exclude=/sys/* --exclude=/tmp/* --exclude=/mnt/* --exclude=/media/* --exclude=/run/* --exclude=/var/lock/* --exclude=/var/run/* --exclude=/var/lib/pacman/* --exclude=/var/cache/pacman/pkg/* --exclude=/proc/* --exclude=/lost+found --exclude=/home/yanhui/.cache/* --exclude=/home/yanhui/.mozilla/* / 恢复 live盘启动 需要先 fdisk -l 和 mount 命令 挂载分区 至少两个分区 efi和根分区\n1 2 3 4 5 6 7 fdisk -l #查看分区 mkdir /temp_for_backup mount /dev/sdb3 /temp_for_backup # 挂载分区sdb3到 temp_for_backup mkdir /temp_for_backup/boot mount /dev/sda1 /temp_for_backup/boot # 挂载分区efi分区到 /temp_for_backup/boot rm -rf /temp_for_backup/* #可选 tar --use-compress-program=pigz -xvpf /f/sysbackup/arch-backup-20160331.tgz -C /mnt ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-backup/","title":"archlinux 一键备份"},{"content":"分别这两个音频驱动包 sudo pacman -S sof-firmware sudo pacman -S alsa-ucm-conf\n先装几个包\n1 2 3 4 5 6 sudo pacman -S alsa-utils sudo pacman -S alsa-plugins sudo pacman -S pulseaudio-alsa sudo pacman -S pavucontrol-qt sudo pacman -S pavucontrol sudo pacman -S pasystray 启用：amixer sset Master unmute 命令行设置：alsamixer UI设置：pavucontrol\nalsamixer\n声道下方标有 MM 表示其已经静音，而标有 00 表示已经启用。 使用 ← 和 → 键滚动到 Master 和 PCM 声道，按下 m 键解除静音。\n使用 ↑ 键增加音量，获得0dB的增益。增益值可在左上方 Item: 字段旁边看到。 注意： 若增益高于0 dB，可能会听到失真。\n是一个系统托盘小程序 可以和pavucontrol 配合\n测试声音\nspeaker-test -c 2 但是 依旧没声音\naplay -l aplay: device_list:275: no soundcards found\u0026hellip; 找不到声卡\n在 /etc/modprobe.d/alsa-base.conf 添加一行\noptions snd-hda-intel dmic_detect=0\n重启后 可以识别hdmi声卡了。但是。。主板集成的声卡 还是不行\n我有win系统，所以先去win下看一下声卡型号 essx8336 好吧，搜了一下 暂时无解，有提供驱动包的，但是网盘已经打不开\n在 https://www.alsa-project.org/wiki/Changes_v1.2.6.3_v1.2.7 官网 搜索到\n1 2 3 4 5 ucm2: sof-essx8336: use the right mixers for speaker/headphone ucm2: sof-essx8336: drop conditional control settings ucm2: sof-essx8336: Add a boot sequence ucm2: sof-essx8336: Fix location of HiFi.conf ucm2: sof-essx8336: Fill in SectionVerb session at HiFi.conf 先装上一堆\n1 2 3 4 5 rm -rf /etc/modprobe.d/alsa-base.conf sudo pacman -S alsa-firmware sudo pacman -S alsa-utils sudo pacman -S alsa-plugins sudo pacman -S alsa-tools aplay -l\n1 2 3 4 5 6 7 8 9 10 11 12 13 **** List of PLAYBACK Hardware Devices **** card 0: sofessx8336 [sof-essx8336], device 0: ES8336 (*) [] Subdevices: 0/1 Subdevice #0: subdevice #0 card 0: sofessx8336 [sof-essx8336], device 5: HDMI 1 (*) [] Subdevices: 1/1 Subdevice #0: subdevice #0 card 0: sofessx8336 [sof-essx8336], device 6: HDMI 2 (*) [] Subdevices: 1/1 Subdevice #0: subdevice #0 card 0: sofessx8336 [sof-essx8336], device 7: HDMI 3 (*) [] Subdevices: 1/1 Subdevice #0: subdevice #0 参考 https://wiki.archlinux.org/title/Advanced_Linux_Sound_Architecture_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%AE%89%E8%A3%85\nhttps://wiki.archlinux.org/title/PulseAudio_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%AE%89%E8%A3%85\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-alsa/","title":"archlinux没声音，检查声音，dwm系统系统托盘声音"},{"content":"archlinux上安装微信 qq 企业微信 十数年来，linux桌面系统 两大困扰 输入法 和 腾讯系\n输入法 目前 百度 和 搜狗都已经可以安装(不支持词库同步)\n剩下就是 腾讯系 如果要用完整功能，只能wine跑（但是新版 也多少有一些问题，比如 摄像头 截图等）\n前言 目前最简单可靠的 并且可以满足日常使用的方法 首先安装 yay yay -S electronic-wechat-uos-bin yay -S icalingua++ # yay -S linuxqq #官方QQ 其实也还好 能用就行 微信用 electronic 封装的 （uos也是同样的，但是uos没有托盘）\nqq 用 icalingua++ （也是electronic封装，模拟 安卓 apad ipad的客户端 ）\n截图用第三方，我用flameshot\n不推荐用 wine 1是要装一堆 32位的东西，另外就是 性能拉跨\n先感谢 deepin\n首先安装 yay 微信 可选的有很多\n截止目前 2022-10-18 win版本的目前是 3.7.6.44\ncom.qq.weixin.deepin 3.2.1.154_14-2\ncom.qq.weixin.spark 3.7.6.44spark0-1\ndeepin-wine-wechat 3.7.6.44-1\nwechat-uos 这个是uos的原生版本 基于electric的 功能少，但是可能最稳定和流畅 使用 bubblewrap 替换 os-release 和 lsb-release，在没有修改其分发的二进制文件的前提下，实现模拟 UOS 专业版运行环境，\nelectronic-wechat-uos-bin 第三方的uos版本\n还有一种docker运行方法，但是 已经有人封号了\n在使用wine之前 需要处理32位的问题，因为wine目前还是基于32位的 查看这里，打开32位支持\n选择前三个 需要装一大堆32位的包，确保磁盘容量够用。我一开始只给arch分配了10G 已经不够了。 给linux系统扩建容量\ndeepin-wine-wechat 2024-03-7 已经有原生版微信，虽然目前之支持uos和麒麟等系统，实际上其他系统也可以用。\n2022年12月07日 腾讯已经发布新版linux qq 1 2 3 4 yay -S deepin-wine-wechat #卸载 yay -Rsn deepin-wine-wechat rm -rf /home/yanhui/.deepinwine/Deepin-WeChat/ 截图也是黑屏，但是其他截图工具可以粘贴过来。 缺点和 com.qq.weixin.spark 一样 都是卡\n输入法的 如果不能输入 需要处理一下 参考这里我之前的纪录\n系统托盘图标的问题，注销一下kde 重新登录 重新开微信就ok了\n有可能会报错\nerror: could not set install reason for package lib32-at-spi2-atk (could not find or read package)\n不用管 ，重新运行即可\nkde桌面环境 可能还需要处理一下 和 deepin wine的问题 参考这里\ncom.qq.weixin.spark 我这边提示有一个 spark-dwine-helper 依赖找不到，随放弃\nwechat-uos 1 2 sudo pacman -S scrot # 截图需要另外安装scrot yay -S wechat-uos 缺点很多：\n没有群折叠功能，\n没有朋友圈 小程序\n没系统托盘提醒\n也没有关闭和退出\n彻底关闭需要kill electron\n1 killall electron meiyou sousuo\n另外每次登录都需要扫码一次\n如果第一次打开卡，注销掉桌面系统 或者 kill 掉electron 重新开 就会好很多\n虽然有很多缺点，但是这个几乎是最流程稳定了一个版本\n如果截图黑屏的话，可以用spectacle 截图后文件后 发送文件。。暂时。。没别的好办法\n安装QQ TIM：com.qq.office.deepin ，若想使用较新的可选： com.qq.tim.spark或deepin-wine-tim。\n还有一个简单版本 基于 vscode插件的 在插件市场直接走走\n1 2 yay -S deepin-wine-tim sudo pacman -S xsettingsd 把 /usr/bin/xsettingsd 弄到自动启动项\n我是 xorg 所以直接修改\n1 2 3 4 5 ~/.xinitrc 或者 /etc/X11/xinit/xinitrc # 在 twm \u0026amp; 之前添加 /usr/bin/xsettingsd \u0026amp; kde桌面环境 可能还需要处理一下 和 deepin wine的问题 参考这里\n完全不用wine方法 微信用 wechat-uos QQ 用 icalingua++\n1 2 3 #yay -S wechat-uos yay -S electronic-wechat-uos-bin yay -S icalingua++ wechat-uos 的缺点前面都说很多，主要是功能不全，但是稳定轻量 electronic-wechat-uos-bin 更好用一些\nicalingua 速度嗷嗷的好，也支持群文件，重启kde 或者 dwm后就支持系统托盘了 ，和其他截图工具配合可以支持截图\n彻底清理deepin wine版本\n1 2 3 yay -Rsn deepin-wine-wechat rm -rf /home/yanhui/.deepinwine/Deepin-WeChat rm -rf /home/yanhui/Documents/WeChat\\ Files/ 1 2 3 4 5 yay -Rsn deepin-wine-tim rm -rf /home/yanhui/.deepinwine/Deepin-TIM rm -rf /home/yanhui/.deepinwine 小插曲 关于 electronic-wechat-uos-bin 这个包 First Submitted: 2022-10-19 09:18 (UTC) Last Updated: 2022-10-19 10:10 (UTC)\n今天是 2022-10-29 18：35\n官网wiki\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-weixin-qq/","title":"archlinux上安装微信 qq 企业微信"},{"content":"dwm 扩展 安装方法 首先用 卸载yay安装的版本，用编译方式安装的dwm\n创建目录 用于存补丁\n1 2 3 mkdir ~/dwmfiles/patches/ #没有安装wget也安装一下 sudo pacman -S wget 获取补丁\n官网地址 https://dwm.suckless.org/patches/\n类似一个应用市场\n找到 https://dwm.suckless.org/patches/systray/\n我现在的是最新版本 6.3版 所以就下载他对应的补丁\n1 wget https://dwm.suckless.org/patches/systray/dwm-systray-6.3.diff 到dwm源码目录\n1 mkdir ~/dwmfiles/dwm/ 如果么有配置git 用户的话配置一下，\n1 2 git config --global user.name \u0026#34;leiyanhui\u0026#34; git config --global user.email \u0026#34;leiyanhui@xxx.com\u0026#34; 打补丁，重新提交commit 编译\n1 2 3 4 patch \u0026lt; ~/dwmfiles/patches/dwm-systray-6.3.diff git commit -am \u0026#34;systray\u0026#34; rm -rf config.h # 这个文件是每次编译的使用 那个 config.ref.h自动生成的 sudo make clean install #重新安装 ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-install-dwm-pacher/","title":"dwm 扩展 安装方法"},{"content":"dwm 使用快捷键 打开程序 比如 win+E 打开文件管理器Thunar\ncd dwmfiles/dwm/ nano config.def.h 在\nstatic const Key keys[] = { 增加一行\n{ MODKEY, XK_e, spawn, SHCMD(\u0026quot;thunar\u0026quot;)}, 重新编译\nrm -rf config.h make sudo make clean install 再比如 截图 flameshot 或者 spectacle\n先获取 prt Scr的对照\nxev # 看 keycode 的值 是107 不过我喜欢习惯了用 alt+a来截图\n// 截图 { Mod1Mask, XK_a, spawn, SHCMD(\u0026quot;flameshot\u0026quot;)}, 不过这里只是一个例子 flameshot 丢到后台启动更好一些吧\n增加一个 win+R 的启动dmenucmd程序，类似windows的\n// Win+r 运行 { Mod4Mask, XK_r, spawn, {.v = dmenucmd } }, 参考 https://blog.csdn.net/weixin_43889478/article/details/108937727\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-install-dwm-diykey/","title":"dwm 使用快捷键 打开程序"},{"content":"dwm修改主快捷键和默认快捷键配置 dwm默认的主快捷键/功能按键是Alt,也就是说如果要使用快捷键来完成一些便捷操作的话，基本上我们都要按一下Alt键。因为dwm是窗口管理器嘛，用键盘上的Windows键来完成与窗口相关的操作更合理一下，也防止很多软件冲突。找到配置文件的当中的#define MODKEY,把后面的内容调整为Mod4Mask，这样后面所有用到MODKEY的快捷键就都按Windows键就可以了。\n修改主快捷键 需要 自行编译 完整的编译命令\n1 2 3 4 git clone git://git.suckless.org/dwm cd dwm make make install 在make之前\n1 nano config.def.h 找到 #define MODKEY 改为 #define MODKEY Mod4Mask\n然后 make make install\n进阶 快捷键启动指定程序\n桌面模式\n全屏 [2] 平铺 []= 浮动全屏模式 [3] 常用快捷键\n当前窗口全屏 Mod + m 返回方法 mod + 空格 或者 mod + t 当前窗口全屏 mod + 空格 浮动全屏模式 当前窗口 移动到别的工作区域 mod shift 1-9 然后需要手动 在 mod 1-9 切换到对用工作去，有 pathc可以搞定自动跟随切换 切换焦点（类似鼠标点击窗口） 当前窗口作为主窗口（左侧或者右侧主区域） mod + 回车 平铺模式 mod + t 两种模式 横向和竖向 其中分别还有3种小模式，所以 书香排列切换到横小排列，你或许 需要 mod +d 再 + d 连续按多次d 窗口横向排列 mod +d 调整横向分割大小 mod + h mod + L 窗口竖向排列 mod + i 默认快捷键对照\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 Alt + shift + Enter # 打开新窗口 Alt + shift + C # 关闭当前窗口 Alt + D # 窗口横向排列 Alt + I # 窗口竖向排列 Alt + Enter # 窗口位置互换 Alt + num # 切换标签页 Alt + shift + num # 移动窗口至某标签页 Alt + T # 平铺模式（tiling) Alt + M # 单窗口模式 Alt + F # 浮动模式（float) # 在窗口间切换 Alt + J Alt + K # 改变窗口的长度/比例 Alt + H Alt + L # 窗口模式切换 Alt + Space Alt + shift + Space 在主副屏之间移动焦点 Mod + \u0026lt; # 移动焦点至左边屏幕 Mod + \u0026gt; # 移动焦点至右边屏幕 在主副屏之间移动窗口 Mod + shift + \u0026lt; # 移动窗口至左边屏幕 Mod + shift + \u0026gt; # 移动窗口至右边屏幕 Mod + 鼠标右键 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 Basic ===== [Shift]+[Mod]+[Enter] - launch terminal. [Mod]+[b] - 隐藏和显示顶部栏目 [Mod]+[p] - dmenu 搜索和启动程序 [Mod]+[Enter] - 切换窗口布局push acive window from stack to master, or pulls last used window from stack onto master. [Mod] + [j / k] - 移动鼠标焦点 focus on next/previous window in current tag. [Mod] + [h / l] - 修改窗口左右横列宽度 increases / decreases master size. Navigation ========== [Mod]+[2] - moves your focus to tag 2. [Shift]+[Mod]+[2] - 把窗口一定移动到2号桌面 move active window to the 2 tag. [Mod] + [i / d] - 横竖布局 increases / decreases number of windows on master [Mod] + [, / .] - move focus between screens (multi monitor setup) [Shift]+[Mod]+[, / .] - move active window to different screen. [Mod]+[0] - view all windows on screen. [Shift]+[Mod]+[0] - make focused window appear on all tags. [Shift]+[Mod]+[c] - kill active window. [Shift]+[Mod]+[q] - quit dwm cleanly. Layout ====== [Mod]+[t] - tiled mode. []= [Mod]+[f] - floating mode. \u0026gt;\u0026lt;\u0026gt; [Mod]+[m] - monocle mode. [M] (single window fullscreen) Floating ======== [Mod]+[R M B] - to resize the floating window. [Mod]+[L M B] - to move the floating window around. [Mod]+[Space] - toggles to the previous layout mode. [Mod]+[Shift]+[Space] - to make an individual window float. [Mod]+[M M B] - to make an individual window un-float. ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-install-dwm-hotkey/","title":"dwm修改主快捷键和默认快捷键配置"},{"content":"~/bin/startdwm\n1 2 3 4 5 6 while true; do # Log stderror to a file dwm 2\u0026gt; ~/.dwm.log # No error logging #dwm \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 done ~/.xinitrc\nexec startdwm\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-dwm-restart/","title":"dwm重启，但是不重启xorg"},{"content":"linux 下常用的轻量好用的图形界面程序 终端：kitty, alacritty, termite（前两个有GPU加速） 护眼：redshift-gtk 程序启动器：dmenu, rofi Shell：fish, zsh 壁纸设置器：feh, nitrogen 音乐播放器：mpd\u0026amp;ncmpcpp（基于终端）, deadbeaf-git 特效合成器：picom-jonaburg-git, picom 文件管理器：thunar, nemo 电源管理器：xfce4-power-manager 截图工具：flameshot, scrot 主题设置器：lxappearance\u0026amp;qt5ct\u0026amp;xsettingsd 输入法：fcitx5 科学上网工具：qv2ray 剪切板管理器：copyq 云同步工具：nutstore（坚果云）, dropbox 通知管理器：dunst 锁屏管理器：betterlockscreen, xautolock（用于自动锁屏） pdf 阅读器：zathura（vim风格）, atril（没有gnome依赖的evince） 文本编辑器：nano nvim, doom emacs(可选)，(vs)code 屏幕亮度调节器：light ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/linux-soft/","title":"inux 下常用的轻量好用的图形界面程序"},{"content":"linux下 可视化文件管理器 我选择以来最少，也最轻量的 Thunar\nsudo pacman -S thunar 自带基本的图片查看\ndwm ： win +p thunar\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/linux-file-manager/","title":"linux下 可视化文件管理器"},{"content":"Linux下远程控制win以及remoteapp的rdp客户端的尝试 简单使用 1 2 3 4 sudo pacman -S remmina sudo pacman -S freerdp # rdp协议支持 sudo pacman -S libvncserver # vnc协议 sudo pacman -S spice-gtk # spice协议 总结，暂时没法没找到 linux下支持 remoteapp的办法\n尝试记录 环境 arch 2022-10-18\n先尝试 安装一个图形界面的远程管理工具吧。我这里选择 Remmina\n1 sudo pacman -S remmina 默认 只支持 ssh x2go\n如果你需要 RDP 支持，还要选择安装 freerdp 或 remmina-plugin-rdesktop(AUR)。\n1 2 3 yay -S remmina-plugin-rdesktop # 关闭remmina killall remmina 测试后 发现好像连不上\n1 2 yay -Rs remmina-plugin-rdesktop sudo pacman -Rs rdesktop 试试 freerdp\n1 2 sudo pacman -S freerdp killall 再次使用 可以正常链接Windows了\nrdp文件也可以自动关联到remmina\n但是 remotapp 依旧不知道应该如何支持\narch wifi\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/rdp-win/","title":"linux下 可视化文件管理器"},{"content":"pve、kvm安装的macos 基本优化：显卡直通到macos macos 在虚拟机下最要命的问题 就是 显卡性能，所以务必直通显卡或者vgpu给它。不然真的卡到崩溃\n首先 bios要开启 VT-D\n配置 pve 打开直通 1 nano /etc/default/grub 修改\n1 GRUB_CMDLINE_LINUX_DEFAULT=\u0026#34;quiet intel_iommu=on\u0026#34; 更新grub引导\n1 update-grub 修改 /etc/modules\n1 2 3 4 5 6 #nano /etc/modules #添加 vfio vfio_iommu_type1 vfio_pc vfio_virqfd 检查黑名单 /etc/modprobe.d/pve-blacklist.conf\n1 2 3 4 5 # nano /etc/modprobe.d/pve-blacklist.conf # 删除下面的内容 blacklist i915 blacklist snd_hda_intel blacklist snd_hda_codec_hdmi 如果您此前将核显和声卡ID添加到vfio，请删除/etc/modprobe.d/vfio.conf\n运行命令刷新initramfs，使以上修改生效\n1 update-initramfs -u -k all oc中添加核显驱动 要先添加驱动，不然开机就五国了\n先安装 hackintool 参考 http://www.imacosx.cn/6546.html\npve中 添加核显到 macos虚拟机 添加pci设备 选择uhd630 所有功能。其他不勾选\n进阶 添加钩子 ，虚拟关机后返回硬件到宿主机 https://gitee.com/hellozhing/pvevm-hooks 相关说明 查看作者说明\n参考资料 和 进阶 pve、kvm手动安装macos\n请查看新版：在pve上直接安装macos13Ventura 初步优化并直通显卡 蓝牙 wifi 声卡给macos\npve、kvm安装的macos 基本优化：opencore 迁移到虚拟硬盘\npve、kvm安装的macos 基本优化：显卡直通到macos\npve、kvm安装的macos 基本优化：蓝牙和wifi直通到macos\npve usb设备和端口直通\n1 2 3 4 5 6 7 流程图 https://www.processon.com/view/link/61b325221e08534ef3f1658d https://www.mfpud.com/topics/8076/ github上的OSX-KVM，几乎可以在任何的linux系统下虚拟化安装黑苹果:https://github.com/kholia/OSX-KVM pve：https://pve.proxmox.com/wiki/Downloads 一个英文参考教程：https://www.nicksherlock.com/2021/10/installing-macos-12-monterey-on-proxmox-7/ 一个视频教程：https://www.bilibili.com/video/BV1uq4y1g7ui 这个视频教程的第二部分：https://www.bilibili.com/video/BV1ML411E7eH/ ","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/macos/kvm-macos-gpu/","title":"linux下 可视化文件管理器"},{"content":"linux下分区无损扩容 1 2 3 sudo fdisk -l sudo cfdisk /dev/XXXXXX 然后添加容量即可\n当然后面必须要有空余容量\n使用winpe diskgen 会出现一下其他错误，不建议使用\n另外 cfdisk 减小容量 哪怕是减小到大于目前容量 也会导致部分文件丢失，慎用！\n容量扩展后，df -h 查看容量没有增加，fdisk -l 查看容量已经增加\n这时候 需要重设一下分区大小，以ext4为例\n1 sudo resize2fs /dev/mmcblk0p2 再次df -h 查看 已经正常\n最后经过测试\n使用archinstall 全盘安装的系统，可以用diskgen 收缩分区容量，且不会破坏引导，但是速度很慢，而且仅限ext4分区格式\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/linux-diskpartion-add/","title":"linux下分区无损扩容"},{"content":"linux下用fish作为默认shell fish 更加漂亮 好用一些\n官网 http://fishshell.com/\ndebian/deepin 发行版可直接 sudo apt install fish\narch\nsudo pacman -S fish\n其他发行版在官网找到对应的安装方法，安装完成后执行\n1 chsh -s /usr/bin/fish 就可设置fish为默认shell了，\n需要退出终端再进一次即可生效\n但是仅供远程ssh的时候使用\n经过测试 还需要配置一下 konsole\n先检查\n1 2 3 4 5 6 chsh -l #/bin/sh #/bin/bash #/usr/bin/git-shell #/usr/bin/fish #/bin/fish 打开 konsole\nsetting\u0026gt; manage Profiles \u0026gt;\n添加一个配置文件 名字就叫 fish就好了\n然后修改 bin/bash 为 /bin/fish\n发现有bug，关闭重启后 就丢了\n1 cd ~/.local/share/konsole/ nano fish.profile\n1 2 3 4 [General] Command=/bin/fish Name=fish Parent=FALLBACK/ 或者 手动多建立几个 也可以\narch官网wiki\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/fish-install/","title":"linux下用fish作为默认shell"},{"content":"为什么选择arch 已经使用arch作为工作系统5年多，主要是go php java ardruino的开发环境使用\n桌面系统 首先是因为可定制，其次是因为arch还是比较适合做桌面系统的，主要原因还是官方源的驱动比较全比较新\n和多数人一样，都是从redhat开始 centos Fedora debian Ubuntu Slackware Gentoo Mandrake deepin uos\nUbuntu 的各个衍生版 应该是我用的最多最久的\n期间一度迷恋alpine，很早之前就知道arch但是尝试安装Manjaro后 也感觉，直到群里有大神再次推荐。于是尝试几次后 开始一发不可收拾。。\n先说缺点吧\n缺点 安装难度略大 其实 现在有archinstall 自动脚本后已经很简单了 只是想体验的话 有 https://hub.docker.com/r/linuxserver/webtop 这个docker的桌面系统 滚动更新 有很小的概率升级的时候搞挂 不是服务器的话没影响 优点 很新 很新 其他发行版本 也不能说有问题 只是会带来一些额外的工作量 驱动支持的广泛 无论是古董机器，还是低配机器，还是最新顶配 基本上都可以搞定 包管理的方便 第三方包很丰富并且更新频繁 中文wifi 以及国内众多使用者 一些特殊软件，尤其是 微信 qq之类的 都比较容易解决 总的来说arch 就是新\n服务器系统 目前还是Ubuntu20.04 和 21.04 ， 因为习惯用宝塔，所以还是在 Debian 和 redhat系 来回使用。\n作为一个业余玩家，服务器一直使用vps，好像即便是选择arch 哪怕升级挂了 也不是大问题。\narch一键备份 在这里整理和更新\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/linux/arch-why/","title":"为什么选择arch"},{"content":"选择Windows server2022 作为主开发系统 并运行在unraid上 all in one 的理由，优势和原因 前言 个人癖好喜欢折腾操作系统，并未为之付出很多时间和精力\n选择unraid的原因 为什么选择all in one · 我喜欢折腾系统，经常尝试重装各种系统，所以虚拟机是少不了的 · 为什么不桌面系统跑vmware或者hyper-v 因为宿主桌面系统也容易被我折腾 · 最后一个主要原因\n· 我经常外出，主力机是diy机， · 家境贫寒，便携机配置很烂或者只是ipad · 即便是主力机接显示器键鼠等，硬件直通也可以搞定\n为什么选择unraid · 首先硬件不特殊，所以pve对我来说没优势 · 黑果更简单 · 硬件直通和vgpu也简单 · 不牵扯硬盘，不用操心硬盘分区什么的什么的。 · 备份简单，只备份U盘文件就好了 几百M · 破解也不难 安装更简单 · 其他几个all in one 对我来说的缺点有：\n· pve 硬盘安装webui复杂 唯独集成的虚拟机模板功能还不错，不原生支持docker 不自带文件共享 · 群晖 白的玩不起，黑的遭遇一次莫名其妙无法启动的 因为人在外地无法处理，回来后就直接格式掉了。以后应该只会玩虚拟群晖了，毕竟群晖的移动app还是挺不错的 · ESXI 威联通Nas系统 没玩过\n以后可能会选择全盘exfat分区，然后ventoy+alpine.vhd 的方式，不过眼下没还没精力玩耍。因为unraid的黑果实在太方便了。懒得折腾了。正版也就59美元400块钱\nunraid劝退理由 · 有两台电脑，或至少一个pad · 有一个容量256M以上容量的闲置U盘【带uuid的】最好是1G以上的，目前还没有硬盘安装方法，要一直插在上面 · 能接受盗版软件或者舍得买正版\n小补充：关于U盘的问题 · 主机上一直插着一个U盘 没你想的那么难受。如果是笔记本可以买小巧一点的。 · U盘真心不用太好的，因为就开机和修改配置的时候会读写U盘，而且你可以在开机状态下拔下备份。或者直接tar 或者 在虚拟机里面访问到U盘 自己备份到云或者什么都可以。 · 只要是用过一段时间段的U盘 都是可以的，别是用都没用过的杂牌，两天就坏了那就得不偿失了。我现在用的是 路边卖车载U的地方买的杂牌。 · 更换U盘重新破解并不难，正版换授权也不难 · 但是真的不要长期用读卡器+sd方式 这个方式真的很玄，临时玩玩是绝对没问题的。等玩舒服了，再换一个靠谱的U盘就是了\n选择Windows server2022原因 和非win的系统对比 · 远程控制功能 win的rdp独步天下，硬件加速 视频压缩 音频传输，这是Linux mac均没有的。 · 上手难度低\n和win11 · 用过几个月win11 实在不知眼下选择他 不选win10的理由是什么 · 右键菜单一项 就可以去掉他了。 · slc的问题，虽然可以绕过，但是麻烦\n和 win10 以及win10 ltc · 只一个原因 kvm 安装win10的时候 花屏 没法继续\n和win7 · 虽然日常软件使用没问题，但是偶尔遇到假死 还是兼容性有一些问题 · 另外一些软件一直不支持了。\nWindows server 2022 作为桌面系统使用需要处理的几个问题 去掉开机ctrl+alt+del物理按键和自动登录 https://dev.leiyanhui.com/c/win2022-autologin/\nWindows Server 2022 Datacenter 无法访问unraid的smb共享的问题 https://dev.leiyanhui.com/c/windows-server-2022-datacenter-smb/\n去掉 Windows server 2022打开共享文件的exe的安全提醒，以及部分软件提示internet安全配置 https://dev.leiyanhui.com/c/windows-server-2022-internetsafe/\n输入法 https://dev.leiyanhui.com/c/inputexe/\n","date":"2022-08-03T21:38:29Z","permalink":"https://dev.leiyanhui.com/c/windows-server2022-to-main-os/","title":"选择Windows server2022 作为主开发系统  并运行在unraid上 all in one 的理由，优势和原因"},{"content":"Windows Server 2022 Datacenter 无法访问unraid的smb共享的问题 直接 资源管理右键 映射网络驱动器 \\10.0.0.8\\SharpYanhui 勾选上 使用其他凭据\n","date":"2022-08-03T18:55:48Z","permalink":"https://dev.leiyanhui.com/c/windows-server-2022-datacenter-smb/","title":"Windows Server 2022 Datacenter 无法访问unraid的smb共享的问题"},{"content":"ubuntu22.04.1LTS安装golang最新版本 其他linux系统通用 不建议 直接用自带的包管理器安装，后续维护会麻烦一点点\n获取最新版本golang https://golang.google.cn/dl/\n截止2022.10.11 最新稳定版本是 1.9.2 截止2022.12.01 最新稳定版本是 1.9.3\n1 2 3 4 5 6 7 8 cd ~ wget -c https://golang.google.cn/dl/go1.19.3.linux-amd64.tar.gz tar -zxf go1.*.tar.gz -C /opt/ rm go1.*linux-amd64.tar.gz cd /opt/ mkdir /opt/gopath # 修改环境变量 nano /etc/profile #或者 ~/.profile 在文末添加\n1 2 3 4 5 6 7 export GO111MODULE=on export GOROOT=/opt/go export GOPATH=/opt/gopath #export GOPROXY=https://goproxy.io,direct #export GOPROXY=https://proxy.golang.com.cn,direct export GOPROXY=https://goproxy.cn export PATH=$PATH:$GOROOT/bin:$GOPATH/bin 更新生效 查看go情况\n1 2 source /etc/profile go env 其他问题 source会提示 /etc/profile (line 5): Unsupported use of '='. In fish, please use 'set PATH \u0026quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026quot;'. 这个是 fish的问题，用bash 就好了\n相关内容 1、安装 vscode online codeserver 2、codeserver配置go开发环境的错误\n3、code Server url参数 打开指定的工作区或者文件夹\n4、 ubuntu22.04.1LTS安装golang最新版本\n","date":"2022-08-02T23:25:41Z","permalink":"https://dev.leiyanhui.com/c/ubuntu-install-golang/","title":"ubuntu22.04.1LTS/debian11安装golang最新版本 其他linux系统通用"},{"content":"一个通用的网站添加密码的.php 除了nginx apache自带的方法，这里加一个php的。那个php需要控制用户使用，那个php 里面包含一下\n1 require \u0026#34;inc_index_psw.php\u0026#34;; 代码\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 \u0026lt;?php /* * 在首页中 // include \u0026#34;inc_index_psw.php\u0026#34;; 可以强制输入密码cd */ $My_agent = $_SERVER[\u0026#39;HTTP_USER_AGENT\u0026#39;]; // 先判断 if(strpos($_SERVER[\u0026#39;HTTP_CF_WORKER\u0026#39;],\u0026#39;yanhui.com\u0026#39;) ==false \u0026amp;\u0026amp; strpos($My_agent,\u0026#39;mirror\u0026#39;) ==false) { //判断是qq或者微信打开的嘛 if(strpos($My_agent, \u0026#39;QQ/\u0026#39;)||strpos($My_agent, \u0026#39;MicroMessenger\u0026#39;)!==false){ html_browser(); die; } //获取登录状态 $my_is_logined=0; if(isset($_COOKIE[\u0026#39;my_is_logined\u0026#39;]) ){ $my_is_logined=(int)$_COOKIE[\u0026#39;my_is_logined\u0026#39;]; } // 未登录 if($my_is_logined!=1){ //开始判断和验证登录 $my_chk_login=0; if(isset($_POST[\u0026#39;my_chk_login\u0026#39;]) ){ $my_chk_login=(int)$_POST[\u0026#39;my_chk_login\u0026#39;]; } if($my_chk_login==1){ //验证登录信息和密码 if(trim($_POST[\u0026#39;my_psw\u0026#39;])==\u0026#34;admin\u0026#34; || trim($_POST[\u0026#39;my_psw\u0026#39;])==\u0026#34;123456\u0026#34; || trim($_POST[\u0026#39;my_psw\u0026#39;])==\u0026#34;123\u0026#34; || trim($_POST[\u0026#39;my_psw\u0026#39;])==\u0026#34;abc\u0026#34;){ //登录成功 setcookie(\u0026#39;my_is_logined\u0026#39;,\u0026#39;1\u0026#39;,time()+365*24*60*60,\u0026#39;/\u0026#39;); //一年有效 die (\u0026#34;\u0026lt;script language=JavaScript\u0026gt; location.replace(location.href);\u0026lt;/script\u0026gt;\u0026#34;); }else{ die(\u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;密码错误\u0026#39;);history.go(-1)\u0026lt;/script\u0026gt;\u0026#34;); } }else{ //输出登录界面 html_login(); } die; } } function html_browser(){ ?\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;使用浏览器打开\u0026lt;/title\u0026gt; \u0026lt;meta content=\u0026#34;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\u0026#34; name=\u0026#34;viewport\u0026#34;\u0026gt; \u0026lt;meta content=\u0026#34;yes\u0026#34; name=\u0026#34;apple-mobile-web-app-capable\u0026#34;\u0026gt; \u0026lt;meta content=\u0026#34;black\u0026#34; name=\u0026#34;apple-mobile-web-app-status-bar-style\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;format-detection\u0026#34; content=\u0026#34;telephone=no\u0026#34;\u0026gt; \u0026lt;meta content=\u0026#34;false\u0026#34; name=\u0026#34;twcClient\u0026#34; id=\u0026#34;twcClient\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;aplus-touch\u0026#34; content=\u0026#34;1\u0026#34;\u0026gt; \u0026lt;style\u0026gt; body,html{width:100%;height:100%} *{margin:0;padding:0} body{background-color:#fff} #browser img{ width:50px; } #browser{ margin: 0px 10px; text-align:center; } #contens{ font-weight: bold; margin:-285px 0px 10px; text-align:center; font-size:20px; margin-bottom: 125px; } .top-bar-guidance{font-size:15px;color:#fff;height:60%;line-height:1.8;padding-left:20px;padding-top:20px;background:url(//gw.alicdn.com/tfs/TB1eSZaNFXXXXb.XXXXXXXXXXXX-750-234.png) center top/contain no-repeat} .top-bar-guidance .icon-safari{width:25px;height:25px;vertical-align:middle;margin:0 .2em} .app-download-tip{margin:0 auto;width:290px;text-align:center;font-size:15px;color:#2466f4;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAcAQMAAACak0ePAAAABlBMVEUAAAAdYfh+GakkAAAAAXRSTlMAQObYZgAAAA5JREFUCNdjwA8acEkAAAy4AIE4hQq/AAAAAElFTkSuQmCC) left center/auto 15px repeat-x} .app-download-tip .guidance-desc{background-color:#fff;padding:0 5px} .app-download-btn{display:block;width:214px;height:40px;line-height:40px;margin:18px auto 0 auto;text-align:center;font-size:18px;color:#2466f4;border-radius:20px;border:.5px #2466f4 solid;text-decoration:none} \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;top-bar-guidance\u0026#34;\u0026gt; \u0026lt;p\u0026gt;点击右上角\u0026lt;img src=\u0026#34;//gw.alicdn.com/tfs/TB1xwiUNpXXXXaIXXXXXXXXXXXX-55-55.png\u0026#34; class=\u0026#34;icon-safari\u0026#34;\u0026gt; \u0026lt;span id=\u0026#34;openm\u0026#34;\u0026gt;Safari打开\u0026lt;/span\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;可以继续浏览本站哦~\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;a style=\u0026#34;display: none;\u0026#34; href=\u0026#34;\u0026#34; id=\u0026#34;vurl\u0026#34; rel=\u0026#34;noreferrer\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;div id=\u0026#34;browser\u0026#34;\u0026gt; \u0026lt;p\u0026gt;避免微信和QQ屏蔽本站网址，请理解支持！\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;app-download-tip\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;guidance-desc\u0026#34;\u0026gt;点击右上角或复制网址自行打开\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;link href=\u0026#34;/static/layui/css/modules/layer/default/layer.css\u0026#34; rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; /\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.bootcdn.net/ajax/libs/jquery/1.9.1/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;/static/js/jquery.clipboard.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;/static/layui/lay/modules/layer.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;a data-clipboard-text=\u0026#34;\u0026lt;?php echo curPageURL(); ?\u0026gt;\u0026#34; class=\u0026#34;app-download-btn\u0026#34;\u0026gt;点此复制本站网址\u0026lt;/a\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; new ClipboardJS(\u0026#34;.app-download-btn\u0026#34;); $(\u0026#34;.app-download-btn\u0026#34;).click(function() { layer.tips(\u0026#34;复制成功，么么哒\u0026#34;, \u0026#34;.app-download-btn\u0026#34;, { tips: [3, \u0026#34;rgb(38,111,250)\u0026#34;], time:500 });}) \u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; function openu(u){ document.getElementById(\u0026#34;vurl\u0026#34;).href= u; document.getElementById(\u0026#34;vurl\u0026#34;).click(); } var url = window.location.href; if(navigator.userAgent.indexOf(\u0026#34;QQ/\u0026#34;)\u0026gt; -1){ openu(\u0026#34;ucbrowser://\u0026#34;+url); openu(\u0026#34;mttbrowser://url=\u0026#34;+url); openu(\u0026#34;baiduboxapp://browse?url=\u0026#34;+url); openu(\u0026#34;googlechrome://browse?url=\u0026#34;+url); openu(\u0026#34;mibrowser:\u0026#34;+url); openu(\u0026#34;taobao://\u0026#34;+url.split(\u0026#34;://\u0026#34;)[1]); openu(\u0026#34;alipays://platformapi/startapp?appId=20000067\u0026amp;url=\u0026#34;+url); $(\u0026#34;html\u0026#34;).on(\u0026#34;click\u0026#34;,function(){ openu(\u0026#34;ucbrowser://\u0026#34;+url); openu(\u0026#34;mttbrowser://url=\u0026#34;+url); openu(\u0026#34;baiduboxapp://browse?url=\u0026#34;+url); openu(\u0026#34;googlechrome://browse?url=\u0026#34;+url); openu(\u0026#34;mibrowser:\u0026#34;+url); openu(\u0026#34;taobao://\u0026#34;+url.split(\u0026#34;://\u0026#34;)[1]); openu(\u0026#34;alipays://platformapi/startapp?appId=20000067\u0026amp;url=\u0026#34;+url); }); }else if(navigator.userAgent.indexOf(\u0026#34;MicroMessenger\u0026#34;) \u0026gt; -1){ if(navigator.userAgent.indexOf(\u0026#34;Android\u0026#34;) \u0026gt; -1){ var iframe = document.createElement(\u0026#34;iframe\u0026#34;); iframe.style.display = \u0026#34;none\u0026#34;; document.body.appendChild(iframe); }else{ } } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;?php } // 说明：获取完整URL function curPageURL() { $pageURL = \u0026#39;http\u0026#39;; if ($_SERVER[\u0026#34;HTTPS\u0026#34;] == \u0026#34;on\u0026#34;) { $pageURL .= \u0026#34;s\u0026#34;; } $pageURL .= \u0026#34;://\u0026#34;; if ($_SERVER[\u0026#34;SERVER_PORT\u0026#34;] != \u0026#34;80\u0026#34;) { $pageURL .= $_SERVER[\u0026#34;SERVER_NAME\u0026#34;] . \u0026#34;:\u0026#34; . $_SERVER[\u0026#34;SERVER_PORT\u0026#34;] . $_SERVER[\u0026#34;REQUEST_URI\u0026#34;]; } else { $pageURL .= $_SERVER[\u0026#34;SERVER_NAME\u0026#34;] . $_SERVER[\u0026#34;REQUEST_URI\u0026#34;]; } return $pageURL; } function html_login(){ ?\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;zh-cn\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Wellcome,亲爱的 请进行访问权限确认 \u0026lt;/title\u0026gt; \u0026lt;link href=\u0026#34;https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\u0026#34; rel=\u0026#34;stylesheet\u0026#34;\u0026gt; \u0026lt;style\u0026gt; * { box-sizing: border-box; } body { margin: 0; padding: 0; background: #494A5F; font-weight: 500; font-family: \u0026#34;Microsoft YaHei\u0026#34;,\u0026#34;宋体\u0026#34;,\u0026#34;Segoe UI\u0026#34;, \u0026#34;Lucida Grande\u0026#34;, Helvetica, Arial,sans-serif, FreeSans, Arimo; } #container { margin: 0 auto; } div.search {padding: 30px 0;} form { position: relative; width: 300px; margin: 0 auto; } input, button { border: none; outline: none; } input { width: 100%; height: 42px; padding-left: 13px; } button { height: 42px; width: 42px; cursor: pointer; position: absolute; } /*搜索框6*/ .bar6 {} .bar6 input { border: 2px solid #c5464a; border-radius: 5px; background: #CCC; top: 0; right: 0; } .bar6 button { background: #c5464a; border-radius: 0 5px 5px 0; width: 60px; top: 0; right: 0; } .bar6 button:before { content: \u0026#34;登录\u0026#34;; font-size: 13px; color: #F9F0DA; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;search bar6\u0026#34;\u0026gt; \u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt; \u0026lt;form action=\u0026#34;\u0026#34; method=\u0026#34;POST\u0026#34; id=\u0026#34;myform\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;my_chk_login\u0026#34; value=\u0026#34;1\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;my_psw\u0026#34; placeholder=\u0026#34;请输入密码...\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div style=\u0026#34;font-size: 10px; text-align: center; color: #AAA; \u0026#34;\u0026gt; 密码 均为 数字1开头 或者 字母a开头 \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;?php } ?\u0026gt; ","date":"2022-08-02T23:25:41Z","permalink":"https://dev.leiyanhui.com/c/128/","title":"一个通用的网站添加密码的.php"},{"content":"php免费反代google 搭建自己的搜索引擎 #引言 因为cf work反代发现一点问题，所以还是换成 #申请免费php空间 暂时用 https://www.yun316.net/ 免费一个月，每个月要去免费续费一次，也可以支付5元 1年免续费 偶尔会出现503错误的哈，但是免费的没啥说的。 #配置环境 php版本 5.5 #伪静态规则[在ftp文件规则下面]\n1 2 3 4 5 6 7 8 \u0026lt;IfModule mod_rewrite.c\u0026gt; RewriteEngine on RewriteBase / RewriteRule ^index\\.php$ - [L] RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule . /index.php [L] \u0026lt;/IfModule\u0026gt; #下载一个7ghost，配置一下 上传到ftp #为了避免被墙，首页 index.php 添加代码 require \u0026ldquo;inc_index_psw.php\u0026rdquo;; inc_index_psw.php 文件内容\nhttps://dev.leiyanhui.com/c/128 也可 使用yun316后台的http认证功能\nssl访问 免费空间不支持ssl 总不能明文搜索一些 吧。 所以 套上cf 或者 cdn\n","date":"2022-08-02T23:24:44Z","permalink":"https://dev.leiyanhui.com/c/127/","title":"php免费反代google  搭建自己的搜索引擎"},{"content":"typecho 后台新文章默认关闭自定义字段 展示（不展开） 因为某些模板有自定义字段，导致自定义字段 一直展开状态 ，发布按钮 就到了第二页 导致使用起来不方便 admin目录下 custom-fields.php 第7行\n1 2 \u0026lt;section id=\u0026#34;custom-field\u0026#34; class=\u0026#34;typecho-post-option\u0026lt;?php if (empty($defaultFields) \u0026amp;\u0026amp; empty($fields)): ?\u0026gt; fold\u0026lt;?php endif; ?\u0026gt;\u0026#34;\u0026gt; 修改为\n1 2 \u0026lt;section id=\u0026#34;custom-field\u0026#34; class=\u0026#34;typecho-post-option fold\u0026#34;\u0026gt; 或者 (条件里面 加一个 11 )\n1 2 \u0026lt;section id=\u0026#34;custom-field\u0026#34; class=\u0026#34;typecho-post-option\u0026lt;?php if (empty($defaultFields) \u0026amp;\u0026amp; empty($fields) || 1==1) : ?\u0026gt; fold\u0026lt;?php endif; ?\u0026gt;\u0026#34;\u0026gt; ","date":"2022-08-02T23:23:52Z","permalink":"https://dev.leiyanhui.com/c/121/","title":"typecho 后台新文章默认关闭自定义字段 展示（不展开）"},{"content":"这个 应该是 LTSC的系统bug ，微软也好像没有打算修复的意思 这个看名称 是应用商店相关的进程，但是 LTSC哪里来的商店。 网上搜搜很多资料后 发现 这个确实是 微软自己的bug 而解决方法 很奇葩，竟然是和输入法有关系 这是因为在 LTSC 2021 中，微软删除了 Windows 功能体验包的依赖组件，AppXSVC 和 ClipSVC 这俩兄弟是 Microsoft Store 负责安装、部署和更新 UWP 应用的两个服务，经常性后台扫描升级占用 CPU，正常系统只要关闭 Microsoft Store 自动更新卡那么一阵就好了。导致系统服务在尝试部署 Windows 功能体验包更新时卡住或陷入死循环。与此同时新版的中文输入法也依赖于 Windows 功能体验包。 解决方法 https://download.csdn.net/download/joyanhui/86263686 关闭杀毒软件，然后执行，再从任务栏结束掉 wsappx 就好了。\n","date":"2022-08-02T23:22:02Z","permalink":"https://dev.leiyanhui.com/c/120/","title":"Win10 LTSC  有一个wsappx appxsvc 进程吃cpu和性能问题"},{"content":"windows下上传软件到appstore https://www.yunedit.com/update/appstore/list、 上传专用密码 https://www.yunedit.com/xueyuan/jx/zuanyongpwd 密码记录保存好\n","date":"2022-08-02T23:12:32Z","permalink":"https://dev.leiyanhui.com/c/windows-to-ppstore/","title":"windows下上传软件到appstore"},{"content":"Ubuntu切换到deepin折腾记录：微信 qq Photoshop登录 前面说的更换的原因 上一篇记录：https://dev.leiyanhui.com/c/18 不过粗略看了一下 官方维护的应用商店，好像不少坑。比如edge 无法登录，smartconfig失效。。。 这些使用强度高，并且不需要wine的软件 还是自己去官网动手下载\n2024-03-7 已经有原生版微信，虽然目前之支持uos和麒麟等系统，实际上其他系统也可以用。\n2022年12月07日 腾讯已经发布新版linux qq wine 微信 基本舒服 截图可以用，文件发送可以用，系统托盘正常，个别表情和好有名称乱码 不影响，启动略微慢 可以接受\nwine 企业微信 基本舒服 企业微信 我主要是聊天交流用，其他功能没需求 但是测试了一下 企业切换功能正常 截图和文件功能也都正常\nwine qq 可以用 现在不怎么用qq了，所以没有仔细研究，就修改一下qq的设置，关闭按钮到系统托盘\nwine Photoshop 可用 提示过期，点继续试用 可以用 第二次打开 就 提示要注册了 打开 home/你的用户名/.deepinwine/Deepin-CS6/drive_c/Program Files/Adobe/Adobe Photoshop 找到一个激活文件替换到 amtlib.dll 要 32位的 下载链接：https://pan.baidu.com/s/1EbLxsN84ElXoB2rXTVhh-A 提取码: tc69 如果分享时效，就自己另外找一个 经过测试 微信截图 的图片 也可以直接贴到这里来，可以说相当完美了 把第三方字体拷贝到 ~/.deepinwine/Deepin-CS6/drive_c/windows/Fonts ps里面也可使用字体了\nwine 淘宝旺旺 这个。。没找到。。。暂时用网页版：https://market.m.taobao.com/app/im/chat/index.html?#/\nwine HBuilderX 也没找到\n自己折腾 https://dev.leiyanhui.com/c/20\n搜狗输入法 依旧也是不支持用户词库同步，皮肤 什么的都可以使用，当然很有限的选择。 中间发生过 自己崩溃了，没有输入，不知怎么情况。重新打开设置里面的键盘 输入法 又重新出现。基本没别的问题\n字体 启动器里面 有一个字体管理器 点+ 就可以安装第三方字体了，同时 wine 的字体要 去 ~/.deepinwine/XXXXXXX/drive_c/windows/Fonts\nonedrive 因为的有一个5T的 校友账号，所以，晚点用 rclone弄一下\n用官网版的软件 都尽量用官网版本 vscode edge smartgit 百度网盘 wps QQ音乐 等\n使用apk 安卓的软件 微信 只聊天用\n苹果音乐 本来是想装apk的，发现deepin的安卓应用只能装自家商店，还需要用其他方案才可以，还是用edge 打开，然后点三个点 应用将此网站作为应用。再点应用管理 再创建快捷方式到桌面 和 应用程序 菜单，完美解决 https://music.apple.com/cn/listen-now ##卸载多余软件\nlibreoffice 1 sudo apt-get remove --purge libreoffice* 自带的浏览器 1 sudo apt remove org.deepin.browser 相机等 在左侧启动器 类似开始菜单的地方，右键点击 卸载\n其他未解决问题 蓝牙键盘鼠标 不显示电量\n","date":"2022-08-02T22:51:31Z","permalink":"https://dev.leiyanhui.com/c/19/","title":"Ubuntu切换到deepin折腾记录：微信 qq Photoshop登录"},{"content":"Ubuntu22.04 desktop从体验到格式化 已经更换掉 一直以来想用Linux替代win做主力系统，一直未能行动，前几天选择了Ubuntu22.04 首先是选的版本 太新了哈。很多软件都各种依赖不符合。加上wine微信 各种难受，最后虚拟机装了一个 deepin 20.5 对应的内核 cat /etc/debian_version 10.10 大概体验了一下 不错 记录一下https://dev.leiyanhui.com/c/19 其实放弃的原因还有很多，因为我在linux下用的软件 主要还是 宝塔、vscode、edge、smartgit，这几个软件用什么系统都一样 需要wine 的软件 微信、企业微信、qq、photoshop、旺旺 当然是要看那边wine方便了，不用想肯定是deepin了 还有就是 很多莫名其妙的卡顿 也烦躁了。 图形界面 按照deb包的时候，等待时间 也漫长 其实主要是 wine 太折腾 没有deepin方便 最后因为linux的远程vnc吃带宽，也启用 说白了 没有黑果方便 也没有win的远程桌面好用\n","date":"2022-08-02T22:50:23Z","permalink":"https://dev.leiyanhui.com/c/18/","title":"Ubuntu22.04 desktop从体验到格式化 已经更换掉"},{"content":"ubuntu下虚拟机选择VMware还是virtuabox？ 先说 virtuabox 安装最新的macos11-13 我没搞定，虽然官网说 支持，但是我一直没明白 连iso都不能启动 怎么继续下去。\n然后我不得不去用了VMware 解锁后安装macos12，过程很艰辛但是总算搞定了。 virtuabox 的linux版本 对win的无缝模式支持。。。好像只有win7 可以，其他版本 win10 win11 没法稳定使用 VMware的无缝模式 直接没有打开 ctrl+shift+u 也没用 其实，。。。如果不跑macos的话 还是 qemu 上文初写于2021年后2022年8月02日 最近发现其实 qemu 完全可以跑macos 已经全部迁移到unraid\n","date":"2022-08-02T22:47:28Z","permalink":"https://dev.leiyanhui.com/c/14/","title":"ubuntu下虚拟机选择VMware还是virtuabox？"},{"content":"UNRAID打开ssl访问 和 宝塔配合自动续签等 在设置里面 http：//xxxxx /Settings/ManagementAccess 输入域名 启用 打开u盘的flash文件 修改 \\MY-UNRAID\\flash\\config\\ssl\\certs 把宝塔证书的内容 合并到 config/ssl/certs/\u0026lt;主机名称\u0026gt;_unraid_bundle.pem 删除 config/ssl/certs/certificate_bundle.pem 重载unraid的web服务 nginx -s reload 后面 配合宝塔自动续签 方法 宝塔内添加一个脚本自动cp 文件内容到 共享 就好了 具体操作 都是基本操作了 不再记录\n","date":"2022-08-02T22:47:28Z","permalink":"https://dev.leiyanhui.com/c/unraid-ssl/","title":"ubuntu下虚拟机选择VMware还是virtuabox？"},{"content":"相关 redis 命令中文手册 https://redis.com.cn/commands.html\nredis hash list set zset 的对比和使用 https://dev.leiyanhui.com/web/redis-hash-set-list/ golang 常用数据类型转换 https://dev.leiyanhui.com/c/golang-string-byte-int-float-map-json/\ngo redis客户端手册【没啥可看的】 https://redis.uptrace.dev/zh/guide/\ngo中文手册 还不错 http://c.biancheng.net/golang/intro/\n英文手册 实例不全，但是细节都有 https://pkg.go.dev/github.com/redis/go-redis/v9@v9.0.2\n本文主要内容转载自 https://www.cnblogs.com/itbsl/p/14198111.htm 感谢 itbsl，另外增加了一部分内容\n项目初始化 这里用redis/go-redis/v9\n1 2 go mod init demo go get github.com/redis/go-redis/v9 连接redis 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/go-redis/redis/v8\u0026#34; ) //Background返回一个非空的Context。 它永远不会被取消，没有值，也没有期限。 //它通常在main函数，初始化和测试时使用，并用作传入请求的顶级上下文。 var ctx = context.Background() func main() { rdb := redis.NewClient(\u0026amp;redis.Options{ Addr: \u0026#34;172.16.147.128:6379\u0026#34;, Password: \u0026#34;\u0026#34;, DB: 0, }) pong, err := rdb.Ping(ctx).Result() if err != nil { fmt.Printf(\u0026#34;连接redis出错，错误信息：%v\u0026#34;, err) } fmt.Println(\u0026#34;成功连接redis\u0026#34;) } 基本指令 Keys():根据正则获取keys 1 2 3 //*表示获取所有的key keys, err := rdb.Keys(ctx, \u0026#34;*\u0026#34;).Result() } Rename RenameNX 重命名key Redis Renamenx 命令用于在新的 key 不存在时修改 key 的名称 。若 key 不存在返回错误。\nRedis RENAME 命令用于修改 key 的名字为 newkey 。若key 不存在返回错误。如果newkey存在 将会被覆盖。\n1 2 func (c Client) Rename(ctx context.Context, key, newkey string) *StatusCmd func (c Client) RenameNX(ctx context.Context, key, newkey string) *BoolCmd Type():获取key对应值得类型 1 vType, err := rdb.Type(ctx, \u0026#34;key\u0026#34;).Result() del 删除key 1 2 n, err := rdb.Del(ctx, \u0026#34;key1\u0026#34;, \u0026#34;key2\u0026#34;).Result() fmt.Printf(\u0026#34;成功删除了 %v 个\\n\u0026#34;, n) Exists():检测缓存项是否存在 注：Exists()方法可以传入多个key,返回的第一个结果表示存在的key的数量,不过工作中我们一般不同时判断多个key是否存在，一般就判断一个key,所以判断是否大于0即可，如果判断判断传入的多个key是否都存在，则返回的结果的值要和传入的key的数量相等\n1 2 3 4 5 6 n, err := rdb.Exists(ctx, \u0026#34;key1\u0026#34;).Result() if n \u0026gt; 0 { fmt.Println(\u0026#34;存在\u0026#34;) } else { fmt.Println(\u0026#34;不存在\u0026#34;) } Expire(),ExpireAt():设置有效期 需要在设置好了缓存项后，再设置有效期 Expire()方法是设置某个时间段(time.Duration)后过期，ExpireAt()方法是在某个时间点(time.Time)过期失效\n1 2 3 4 5 6 7 8 9 10 11 12 res, err := rdb.Expire(ctx, \u0026#34;key\u0026#34;, time.Minute * 2).Result() if res { fmt.Println(\u0026#34;设置成功\u0026#34;) } else { fmt.Println(\u0026#34;设置失败\u0026#34;) } res, err = rdb.ExpireAt(ctx, \u0026#34;key2\u0026#34;, time.Now()).Result() if res { fmt.Println(\u0026#34;设置成功\u0026#34;) } else { fmt.Println(\u0026#34;设置失败\u0026#34;) } TTL(),PTTL():获取有效期 1 2 3 4 5 6 7 8 //设置一分钟的有效期 rdb.Expire(ctx, \u0026#34;key\u0026#34;, time.Minute) //获取剩余有效期,单位:秒(s) ttl, err := rdb.TTL(ctx, \u0026#34;key\u0026#34;).Result() fmt.Println(ttl) //获取剩余有效期,单位:毫秒(ms) pttl, err := rdb.PTTL(ctx, \u0026#34;key\u0026#34;).Result() fmt.Println(pttl) DBSize():查看当前数据库key的数量 1 2 num, err := rdb.DBSize(ctx).Result() fmt.Printf(\u0026#34;数据库有 %v 个缓存项\\n\u0026#34;, num) FlushDB():清空当前数据 1 2 3 //清空当前数据库，因为连接的是索引为0的数据库，所以清空的就是0号数据库 res, err := rdb.FlushDB(ctx).Result() fmt.Println(res)//OK FlushAll():清空所有数据库 1 2 res, err := rdb.FlushAll(ctx).Result() fmt.Println(res)//OK 字符串(string)类型 Set():设置 仅仅支持字符串(包含数字)操作，不支持内置数据编码功能。如果需要存储Go的非字符串类型，需要提前手动序列化，获取时再反序列化。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 _, err := rdb.Ping(ctx).Result() //fmt.Println(pong, err) if err != nil { fmt.Printf(\u0026#34;连接redis出错，错误信息：%v\u0026#34;, err) return } //Set方法的最后一个参数表示过期时间，0表示永不过期 err = rdb.Set(ctx, \u0026#34;key1\u0026#34;, \u0026#34;value1\u0026#34;, 0).Err() if err != nil { panic(err) } //key2将会在两分钟后过期失效 err = rdb.Set(ctx, \u0026#34;key2\u0026#34;, \u0026#34;value2\u0026#34;, time.Minute * 2).Err() if err != nil { panic(err) } SetEX():设置并指定过期时间 设置键的同时，设置过期时间\n1 2 3 4 err := rdb.SetEX(ctx, \u0026#34;key\u0026#34;, \u0026#34;value\u0026#34;, time.Hour * 2).Err() if err != nil { panic(err) } SetNX():设置并指定过期时间 注：SetNX()与SetEX()的区别是，SexNX()仅当key不存在的时候才设置，如果key已经存在则不做任何操作，而SetEX()方法不管该key是否已经存在缓存中直接覆盖\n介绍了SetNX()与SetEX()的区别后，还有一点需要注意的时候，如果我们想知道我们调用SetNX()是否设置成功了，可以接着调用Result()方法，返回的第一个值表示是否设置成功了，如果返回false,说明缓存Key已经存在，此次操作虽然没有错误，但是是没有起任何效果的。如果返回true，表示在此之前key是不存在缓存中的，操作是成功的\n1 2 3 4 5 6 res, err := rdb.SetNX(ctx, \u0026#34;key\u0026#34;, \u0026#34;value\u0026#34;, time.Minute).Result() if res { fmt.Println(\u0026#34;设置成功\u0026#34;) } else { fmt.Printf(\u0026#34;key已经存在缓存中，设置失败\u0026#34;) } get 如果要获取的key在缓存中并不存在，Get()方法将会返回redis.Nil\n1 2 3 4 5 6 7 8 9 10 11 err := rdb.Set(ctx, \u0026#34;key\u0026#34;, \u0026#34;value\u0026#34;, 0).Err() val, err := rdb.Get(ctx, \u0026#34;key\u0026#34;).Result() fmt.Printf(\u0026#34;key: %v\\n\u0026#34;, val) val2, err := rdb.Get(ctx, \u0026#34;key-not-exist\u0026#34;).Result() if err == redis.Nil { fmt.Println(\u0026#34;key不存在\u0026#34;) } else if err != nil { panic(err) } else { fmt.Printf(\u0026#34;值为: %v\\n\u0026#34;, val2) } GetRange():字符串截取 GetRange()方法可以用来截取字符串的部分内容,第二个参数是下标索引的开始位置，第三个参数是下标索引的结束位置(不是要截取的长度) 注：即使key不存在，调用GetRange()也不会报错，只是返回的截取结果是空\u0026quot;\u0026quot;,可以使用fmt.Printf(\u0026quot;%q\\n\u0026quot;, val)来打印测试\n1 2 3 4 5 6 err := rdb.Set(ctx, \u0026#34;key\u0026#34;, \u0026#34;Hello World!\u0026#34;, 0).Err() if err != nil { panic(err) } val, err := rdb.GetRange(ctx, \u0026#34;key\u0026#34;, 1, 4).Result() fmt.Printf(\u0026#34;key: %v\\n\u0026#34;, val) //截取到的内容为: ello Incr():增加+1 Incr()、IncrBy()都是操作数字，对数字进行增加的操作，incr是执行原子加1操作，incrBy是增加指定的数\n所谓原子操作是指不会被线程调度机制打断的操作：这种操作一旦开始，就一直运行到结束，中间不会有任何context witch(切换到另一个线程).\n(1)在单线程中，能够在单条指令中完成的操作都可以认为是“原子操作”，因为中断只能发生于指令之间。\n(2)在多线程中，不能被其它进程(线程)打算的操作叫原子操作。\nRedis单命令的原子性主要得益于Redis的单线程\n1 2 val, err := rdb.Incr(ctx, \u0026#34;number\u0026#34;).Result() fmt.Printf(\u0026#34;key当前的值为: %v\\n\u0026#34;, val) IncrBy():按指定步长增加 1 2 val, err := rdb.IncrBy(ctx, \u0026#34;number\u0026#34;, 12).Result() fmt.Printf(\u0026#34;key当前的值为: %v\\n\u0026#34;, val) Decr():减少-1 Decr()和DecrBy()方法是对数字进行减的操作，和Incr正好相反\n1 2 val, err := rdb.Decr(ctx, \u0026#34;number\u0026#34;).Result() fmt.Printf(\u0026#34;key当前的值为: %v\\n\u0026#34;, val) DecrBy():按指定步长减少 1 2 val, err := rdb.DecrBy(ctx, \u0026#34;number\u0026#34;, 12).Result() fmt.Printf(\u0026#34;key当前的值为: %v\\n\u0026#34;, val) Append():追加 Append()表示往字符串后面追加元素，返回值是字符串的总长度\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 err := rdb.Set(ctx, \u0026#34;key\u0026#34;, \u0026#34;hello\u0026#34;, 0).Err() if err != nil { panic(err) } length, err := rdb.Append(ctx, \u0026#34;key\u0026#34;, \u0026#34; world!\u0026#34;).Result() if err != nil { panic(err) } fmt.Printf(\u0026#34;当前缓存key的长度为: %v\\n\u0026#34;, length) //12 val, err := rdb.Get(ctx, \u0026#34;key\u0026#34;).Result() if err != nil { panic(err) } fmt.Printf(\u0026#34;当前缓存key的值为: %v\\n\u0026#34;, val) //hello world! StrLen():获取长度 StrLen()方法可以获取字符串的长度\n1 2 3 4 5 6 7 8 9 err := rdb.Set(ctx, \u0026#34;key\u0026#34;, \u0026#34;hello world!\u0026#34;, 0).Err() if err != nil { panic(err) } length, err := rdb.StrLen(ctx, \u0026#34;key\u0026#34;).Result() if err != nil { panic(err) } fmt.Printf(\u0026#34;当前缓存key的长度为: %v\\n\u0026#34;, length) //12 更多 如上所述都是常用的字符串操作，此外，字符串(string)类型还有MGet()、Mset()、MSetNX()等同时操作多个key的方法，详见：https://pkg.go.dev/github.com/go-redis/redis/v9\n列表(list)类型 LPush():将元素压入链表 可以使用LPush()方法将数据从左侧压入链表,也可以从右侧压如链表，对应的方法是RPush()\n1 2 3 4 5 6 //返回值是当前列表元素的数量 n, err := rdb.LPush(ctx, \u0026#34;list\u0026#34;, 1, 2, 3).Result() if err != nil { panic(err) } fmt.Println(n) LInsert():在某个位置插入新元素 位置的判断，是根据相对的参考元素判断.\n注：即使key列表里有多个值为100的元素，也只会在第一个值为100的元素前面插入123，并不会在所有值为100的前面插入123,客户端还提供了从前面插入和从后面插入的LInsertBefore()和LInsertAfer()方法\n1 2 3 4 5 //在名为key的缓存项值为100的元素前面插入一个值，值为123 err := rdb.LInsert(ctx, \u0026#34;key\u0026#34;, \u0026#34;before\u0026#34;, \u0026#34;100\u0026#34;, 123).Err() if err != nil { panic(err) } LSet():设置某个元素的值 1 2 //下标是从0开始的 err := rdb.LSet(ctx, \u0026#34;list\u0026#34;, 1, 100).Err() LLen():获取链表元素个数 1 2 length, err := rdb.LLen(ctx, \u0026#34;list\u0026#34;).Result() fmt.Printf(\u0026#34;当前链表的长度为: %v\\n\u0026#34;, length) LIndex():获取链表下标对应的元素 1 2 val, err := rdb.LIndex(ctx, \u0026#34;list\u0026#34;, 0).Result() fmt.Printf(\u0026#34;下标为0的值为: %v\\n\u0026#34;, val) LRange():获取某个选定范围的元素集 1 2 vals, err := rdb.LRange(ctx, \u0026#34;list\u0026#34;, 0, 2).Result() fmt.Printf(\u0026#34;从下标0到下标2的值: %v\\n\u0026#34;, vals) LPop从链表左侧弹出数据 1 2 val, err := rdb.LPop(ctx, \u0026#34;list\u0026#34;).Result() fmt.Printf(\u0026#34;移除的元素为: %v\\n\u0026#34;, val) LRem():根据值移除元素 1 2 n, err := rdb.LRem(ctx, \u0026#34;list\u0026#34;, 2, \u0026#34;100\u0026#34;).Result() fmt.Printf(\u0026#34;移除了: %v 个\\n\u0026#34;, n) 集合(set)类型 Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的接口，这是也是list所不能提供了。\nRedis的Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加、删除、查找的复杂度都是O(1)。\n集合数据的特征：\n元素不能重复，保持唯一性\n元素无序，不能使用索引(下标)操作\n更多内容参考 redis hash list set zset 的对比和使用 https://dev.leiyanhui.com/web/redis-hash-set-list/\nSAdd():添加元素 1 2 3 rdb.SAdd(ctx, \u0026#34;team\u0026#34;, \u0026#34;kobe\u0026#34;, \u0026#34;jordan\u0026#34;) rdb.SAdd(ctx, \u0026#34;team\u0026#34;, \u0026#34;curry\u0026#34;) rdb.SAdd(ctx, \u0026#34;team\u0026#34;, \u0026#34;kobe\u0026#34;) //由于kobe已经被添加到team集合中，所以重复添加时无效的 SPop():随机获取一个元素 SPop()方法是从集合中随机取出元素的，如果想一次获取多个元素，可以使用SPopN()方法\n1 2 val, err := rdb.SPop(ctx, \u0026#34;team\u0026#34;).Result() fmt.Println(val) SRem():删除集合里指定的值 1 2 n, err := rdb.SRem(ctx, \u0026#34;team\u0026#34;, \u0026#34;kobe\u0026#34;, \u0026#34;v2\u0026#34;).Result() fmt.Println(n) SSMembers():获取所有成员 1 2 vals, err := rdb.SMembers(ctx, \u0026#34;team\u0026#34;).Result() fmt.Println(vals) SIsMember():判断元素是否在集合中 1 2 3 4 5 6 exists, err := rdb.SIsMember(ctx, \u0026#34;team\u0026#34;, \u0026#34;jordan\u0026#34;).Result() if exists { fmt.Println(\u0026#34;存在集合中\u0026#34;) } else { fmt.Println(\u0026#34;不存在集合中\u0026#34;) } SCard():获取集合元素个数 1 2 total, err := rdb.SCard(ctx, \u0026#34;team\u0026#34;).Result() fmt.Printf(\u0026#34;集合总共有 %v 个元素\\n\u0026#34;, total) SUnion():并集,SDiff():差集,SInter():交集 1 2 3 4 5 6 7 8 9 10 11 12 rdb.SAdd(ctx, \u0026#34;setA\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;) rdb.SAdd(ctx, \u0026#34;setB\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;, \u0026#34;f\u0026#34;) //并集 union, err := rdb.SUnion(ctx, \u0026#34;setA\u0026#34;, \u0026#34;setB\u0026#34;).Result() fmt.Println(union) //差集 diff, err := rdb.SDiff(ctx, \u0026#34;setA\u0026#34;, \u0026#34;setB\u0026#34;).Result() fmt.Println(diff) //交集 inter, err := rdb.SInter(ctx, \u0026#34;setA\u0026#34;, \u0026#34;setB\u0026#34;).Result() fmt.Println(inter) 有序集合(zset)类型 Redis 有序集合和集合一样也是string类型元素的集合,且不允许重复的成员。\n不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。\n有序集合的成员是唯一的,但分数(score)却可以重复。 集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。 集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。\nZAdd():添加元素 添加6个元素1~6,分值都是0\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 rdb.ZAdd(ctx, \u0026#34;zSet\u0026#34;, \u0026amp;redis.Z{ Score: 0, Member: 1, }) rdb.ZAdd(ctx, \u0026#34;zSet\u0026#34;, \u0026amp;redis.Z{ Score: 0, Member: 2, }) rdb.ZAdd(ctx, \u0026#34;zSet\u0026#34;, \u0026amp;redis.Z{ Score: 0, Member: 3, }) rdb.ZAdd(ctx, \u0026#34;zSet\u0026#34;, \u0026amp;redis.Z{ Score: 0, Member: 4, }) rdb.ZAdd(ctx, \u0026#34;zSet\u0026#34;, \u0026amp;redis.Z{ Score: 0, Member: 5, }) rdb.ZAdd(ctx, \u0026#34;zSet\u0026#34;, \u0026amp;redis.Z{ Score: 0, Member: 6, }) ZIncrBy():增加元素分值 分值可以为负数，表示递减\n1 2 3 4 5 6 rdb.ZIncrBy(ctx, \u0026#34;zSet\u0026#34;, float64(rand.Intn(100)), \u0026#34;1\u0026#34;) rdb.ZIncrBy(ctx, \u0026#34;zSet\u0026#34;, float64(rand.Intn(100)), \u0026#34;2\u0026#34;) rdb.ZIncrBy(ctx, \u0026#34;zSet\u0026#34;, float64(rand.Intn(100)), \u0026#34;3\u0026#34;) rdb.ZIncrBy(ctx, \u0026#34;zSet\u0026#34;, float64(rand.Intn(100)), \u0026#34;4\u0026#34;) rdb.ZIncrBy(ctx, \u0026#34;zSet\u0026#34;, float64(rand.Intn(100)), \u0026#34;5\u0026#34;) rdb.ZIncrBy(ctx, \u0026#34;zSet\u0026#34;, float64(rand.Intn(100)), \u0026#34;6\u0026#34;) ZRange()、ZRevRange():获取根据score排序后的数据段 根据分值排序后的，升序和降序的列表获取\n1 2 3 //获取排行榜 //获取分值(点击率)前三的文章ID列表 res, err := rdb.ZRevRange(ctx, \u0026#34;zSet\u0026#34;, 0, 2).Result() ZRangeByScore()、ZRevRangeByScore():获取score过滤后排序的数据段 根据分值过滤之后的列表,需要提供分值区间\n1 2 3 4 res, err := rdb.ZRangeByScore(ctx, \u0026#34;zSet\u0026#34;, \u0026amp;redis.ZRangeBy{ Min: \u0026#34;40\u0026#34;, Max: \u0026#34;85\u0026#34;, }).Result() ZCard():获取元素个数 1 count, err := rdb.ZCard(ctx, \u0026#34;zSet\u0026#34;).Result() ZCount():获取区间内元素个数 获取分值在[40, 85]的元素的数量\n1 n, err := rdb.ZCount(ctx, \u0026#34;zSet\u0026#34;, \u0026#34;40\u0026#34;, \u0026#34;85\u0026#34;).Result() ZScore():获取元素的score 1 score, err := rdb.ZScore(ctx, \u0026#34;zSet\u0026#34;, \u0026#34;5\u0026#34;).Result() ZRank()、ZRevRank():获取某个元素在集合中的排名 ZRank()方法是返回元素在集合中的升序排名情况，从0开始。ZRevRank()正好相反\n1 res, err := rdb.ZRevRank(ctx, \u0026#34;zSet\u0026#34;, \u0026#34;2\u0026#34;).Result() ZRem():删除元素 1 res, err := rdb.ZRem(ctx, \u0026#34;zSet\u0026#34;, \u0026#34;2\u0026#34;).Result() ZRemRangeByRank():根据排名来删除 1 2 //按照升序排序删除第一个和第二个元素 res, err := rdb.ZRemRangeByRank(ctx, \u0026#34;zSet\u0026#34;, 0, 1).Result() ZRemRangeByScore():根据分值区间来删除 1 2 //删除score在[40, 70]之间的元素 res, err := rdb.ZRemRangeByScore(ctx, \u0026#34;zSet\u0026#34;, \u0026#34;40\u0026#34;, \u0026#34;70\u0026#34;).Result() 哈希(hash)类型 Redis hash 是一个 string 类型的 field（字段） 和 value（值） 的映射表，hash 特别适合用于存储对象。\nRedis 中每个 hash 可以存储 232 - 1 键值对（40多亿）。\n当前服务器一般都是将用户登录信息保存到Redis中，这里存储用户登录信息就比较适合用hash表。hash表比string更合适，如果我们选择使用string类型来存储用户的信息的时候，我们每次存储的时候就得先序列化(json_encode()、serialize())成字符串才能存储redis,\n从redis拿到用户信息后又得反序列化(UnMarshal()、Marshal())成数组或对象，这样开销比较大。如果使用hash的话我们通过key(用户ID)+field(属性标签)就可以操作对应属性数据了，既不需要重复存储数据，也不会带来序列化和并发修改控制的问题。\nHSet():设置 1 2 3 rdb.HSet(ctx, \u0026#34;user\u0026#34;, \u0026#34;key1\u0026#34;, \u0026#34;value1\u0026#34;, \u0026#34;key2\u0026#34;, \u0026#34;value2\u0026#34;) rdb.HSet(ctx, \u0026#34;user\u0026#34;, []string{\u0026#34;key3\u0026#34;, \u0026#34;value3\u0026#34;, \u0026#34;key4\u0026#34;, \u0026#34;value4\u0026#34;}) rdb.HSet(ctx, \u0026#34;user\u0026#34;, map[string]interface{}{\u0026#34;key5\u0026#34;: \u0026#34;value5\u0026#34;, \u0026#34;key6\u0026#34;: \u0026#34;value6\u0026#34;}) HMset():批量设置 1 2 rdb.Del(ctx, \u0026#34;user\u0026#34;) rdb.HMSet(ctx, \u0026#34;user\u0026#34;, map[string]interface{}{\u0026#34;name\u0026#34;:\u0026#34;kevin\u0026#34;, \u0026#34;age\u0026#34;: 27, \u0026#34;address\u0026#34;:\u0026#34;北京\u0026#34;}) HGet():获取某个元素 1 address, err := rdb.HGet(ctx, \u0026#34;user\u0026#34;, \u0026#34;address\u0026#34;).Result() HGetAll():获取全部元素 1 user, err := rdb.HGetAll(ctx, \u0026#34;user\u0026#34;).Result() HDel():删除某个元素 HDel():删除某个元素\n1 res, err := rdb.HDel(ctx, \u0026#34;user\u0026#34;, \u0026#34;name\u0026#34;, \u0026#34;age\u0026#34;).Result() HExists():判断元素是否存在 1 res, err := rdb.HExists(ctx, \u0026#34;user\u0026#34;, \u0026#34;address\u0026#34;).Result() HLen():获取长度 1 2 res, err := rdb.HLen(ctx, \u0026#34;user\u0026#34;).Result() ```本文转自：https://www.cnblogs.com/itbsl/p/14198111.html ","date":"2022-03-24T08:14:20+08:00","permalink":"https://dev.leiyanhui.com/golang/redis/","title":"golang 操作redis大全"},{"content":"rustdesk 是一个免费开源的远程桌面控制软件。但是官方默认提供的中转服务器速度较慢。\n如果你有公网ip可以自己搭建一个中转服务器。\n以下基于openwrt x86_64 ，使用docker安装,root登录openwrt shell 执行下面命令\n安装和启动 我这里禁止了没有key的用户链接，防止被滥用 就是hbbr加参数 -k _。\n1 2 3 4 5 6 7 8 9 10 docker image pull rustdesk/rustdesk-server rm -rf /v/rustdesk docker stop hbbs \u0026amp;\u0026amp; docker rm hbbs \u0026amp;\u0026amp; docker stop hbbr \u0026amp;\u0026amp; docker rm hbbr docker run -itd --restart=always --name=hbbs --hostname hbbs \\ --net=host \\ -v /v/rustdesk:/root rustdesk/rustdesk-server hbbs -r 外网IP或者DDNS域名 -k docker run -itd --restart=always --name=hbbr --hostname hbbr \\ --net=host \\ -v /v/rustdesk:/root rustdesk/rustdesk-server hbbr -k _ 官方文档没说明\n防火墙 然后需要在openwrt下防火墙开放对应的端口。 我这里是用的Socat,添加对应的 21115-21119 端口到路由器自己即可\n客户端链接 客户端只需要修改 id服务器地址，然后输入key即可。 需要 控制端 和被控端 都要添加！\n有偿提供上行500M的国内中转，支持ipv6 ，加密链接，支持2k 60帧。35元一年，联系 joyanhui@qq.com\n查看key 1 cat /root/id_ed25519.pub 重置key 以及删除 中转服务 1 2 rm -rf /v/rustdesk docker stop hbbs \u0026amp;\u0026amp; docker rm hbbs \u0026amp;\u0026amp; docker stop hbbr \u0026amp;\u0026amp; docker rm hbbr 删除后重新创建 即可\n更新 1 2 3 4 5 docker stop hbbs docker stop hbbr docker pull rustdesk/rustdesk-server docker start hbbs docker start hbbr ","date":"2022-01-27T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/rustdesk/","title":"openwrt上搭建rustdesk中转服务器"},{"content":"需求 备份 书签 密码，一些脚本 配置文件等。支持webdav sftp smb 等，支持手机照片视频备份。还有在线编辑md文件 sh文件等。\n为什么要搭建私有网盘 穷，但是有公网宽带，以及本身就有一个24小时的开机的pc server 国内网盘审查太严，lsp都懂 国内网盘功能阉割太离谱，比如 webdav sftp等协议都不要想了。 唯一一个支持webdav的网盘 很坑 自主可控，部分文件可以推送到github备份一次 私有网盘适合储存什么东西 私密文件（不是说的自拍视频），还有一些 一些脚本，代码 等。\nlsp应该选什么网盘 自建nas可能是最适合的，没条件的可以选择 115 pikpak，而不是我这个方案\n私有网盘的选择 选择用户群相对较多的 nextcloud\n照片和视频的处理 因为openwrt上没有那么多磁盘工具，所有照片和视频 用Nextcloud 加密后，储存到本地挂载的其他网盘（阿里云盘 123pan）\n代码和脚本的备份 集成到docker内部\n为什么要docker弄 为了方便备份 ，op折腾挂了，不会有问题。可以从别的机器上秒启动。\n最后说 All in one 和群晖 我之前 一直是k2p 刷的op 用了好像10多年，但是随着宽带的升级，越来越力不从心。 后来尝试更换到 以N2600 做主路由，k2p 做AP 使用，再加上一个 i7 8代 的all in one。。而后发现一个问题。。\n最后说某果云 之前一直用 某果云 用 作为floccus的同步空间。 先不说价格，问题是他付费后速度也很拉跨，而且不可以退款！！！ 免费版说是有1G流量，帐号一直显示只用30M的时候，客户端停止工作。。。\n","date":"2022-01-27T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/docker/my-net-disk/","title":"openwrt上搭建私有网盘 和 私有网盘的备份"},{"content":"简单的说 基于supes.top的定制固件\n1、防火墙选nftables\n2、安装软件包socat 包名称luci-app-socat\n可以解决的问题 1、 ipv6 和ipv4 一起转发给内网ipv4\n2、 解决 openwrt 不能自己访问 公网地址：自己转发的端口 3、luci-app-ipsec-server 的一些莫名其妙问题，比如无法链接，链接上缺无法访问内网 或者无法访问外网 无法走梯子 等等\n第二个问题 是多数固件都存在的问题，如果你想在openwrt上作一个转发内网的服务 并用公网地址访问的就麻烦\n","date":"2022-01-12T07:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/ipv6-v4-port/","title":"openwrt端口转发 包括ipv6"},{"content":"使用acme.sh 自动管理申请证书，并在openwrt上的luci（nginx）上使用。\n由于家用宽带没有80 443端口，所以内网访问到 https://你的域名 自动跳转到 https://你的域名:10443\nop上套ssl 在openwrt上安装acme.sh 直接安装 luci-app-acme 这个包，依赖会自动安装上。 配置\n如果是x86路由，建议docker运行nginx-proxy-manage 或 nginxWebUi等工具，他们自带了acme.sh。支持反向代理什么的。 luci-app-acme 界面有一点怪。\n新增 Certificate config 名称随便输入不能用特殊符号 配置，输入 Domain names，如果要泛域名 一起输入，例如 dev.leiyanhui.com 和 *.dev.leiyanhui.com\nChallenge Validation 这里设置一下\nValidation method 验证模式，在沒有80 443端口的情況下，要實現自動續簽只能使用dns验证的哈 DNS API 接口，我这里用dnspods的，输入dns_dp DNS API credentials: 这里输入 你dnspods的 token id 和密码 例如：DP_Id=\u0026quot;123456\u0026quot; 再加一行DP_Key=\u0026quot;XXXXXXXX\u0026quot;\nnginx 的那个勾选上\n高级设置里面，Days until renewal 输入一个时间，就是续签时间证书的有窍时间，输入一个小于90的数字\n稍后会自动申请ssl下来，证书目录 在\n1 /etc/acme/你的域名/ 简单处理openwrt的nginx证书 openwrt的配置文件 /etc/nginx/uci.conf 但这个文件实际是tmp目录ln过来的修改后无效\n如果你不需要443自动重定向端口功能，可以直接用ls方法 替换证书文件，可以跳过下面的操作继续看后面\n1 2 3 4 5 mv /etc/nginx/conf.d/_lan.crt /etc/nginx/conf.d/_lan.crt.bak mv /etc/nginx/conf.d/_lan.key /etc/nginx/conf.d/_lan.key.bak ln -s /etc/acme/你的域名/fullchain.cer /etc/nginx/conf.d/_lan.crt ln -s /etc/acme/你的域名/你的域名.key /etc/nginx/conf.d/_lan.key 重启nginx 1 /etc/init.d/nginx restart 完毕\n配置443 自动转发到10443 因为在openwrt搭建了nginxWebUI 用来套内网的服务，并且使用了非标准端口。为了避免麻烦，所以加一个自动跳转\n可以使用插件luci-app-nginx-manager ，或者自己在shell里面编辑 文件/etc/config/nginx (可以替换证书)\n我这里用luci-app-nginx-manager 新增一个配置文件web_jump 路径/etc/nginx/conf.d/web_jump.conf 内容如下\n1 2 3 4 5 6 7 8 9 10 11 server { listen 80; listen [::]:80; listen 443 ssl http2; listen [::]:443 ssl http2; server_name 你的域名; ssl_certificate /etc/acme/你的域名/fullchain.cer; ssl_certificate_key /etc/acme/你的域名/你的域名.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; return 301 https://$host:10443$request_uri; } 注意，如果自己在其他地方反代http（s）://路由器内网ip，请不要传递host，不然这里会定位 这里站点造成死循环多次跳转 就打不开了。\nnginxWebUI的双acme.sh 另外 如果 和 nginxWebUI 配合的话，可以不用在op上另外安装acme.sh，改为计划任务定时从 nginxWebUI容器cp证书出来。当然也可以挂载出来。\n为了方便docker的备份（阿里云提供免费容器镜像），这种轻量的docker一般不建议挂载目录出来。\n1 0 13 * * * rm -rf /etc/acme.sh \u0026amp;\u0026amp; docker cp nginxwebui:/home/nginxWebUI/.acme.sh /etc/acme.sh 同时也要修改上面的nginx的配置文件里面的路径和域名地址即可,example\n1 2 3 4 5 6 7 8 9 10 11 server { listen 80; listen [::]:80; listen 443 ssl http2; listen [::]:443 ssl http2; server_name jia.leiyanhui.com *.jia.leiyanhui.com; ssl_certificate /etc/acme.sh/*.jia.leiyanhui.com/fullchain.cer; ssl_certificate_key /etc/acme.sh/*.jia.leiyanhui.com/*.jia.leiyanhui.com.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; return 301 https://$host:10443$request_uri; } ","date":"2022-01-10T20:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/acme-ssl/","title":"openwrt 内网套ssl，以及内网标准端口自动跳转非标端口的方法"},{"content":"docker run -d -v /mnt/sdb1/tiantang:/mnt/data/ttnode -v /var/run/docker.sock:/var/run/docker.sock -v /proc:/host/proc:ro \u0026ndash;name ttnode \u0026ndash;hostname ttnode \u0026ndash;privileged \u0026ndash;net=host \u0026ndash;restart=always registry.cn-hangzhou.aliyuncs.com/tiptime/ttnode:latest\n启动完成后 过一会 从app 绑定即可\n","date":"2022-01-09T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/ttnode/","title":"openwrt部署甜糖"},{"content":"为什么要做完整备份 因为一个完全适合自己的软路由器系统，实际上是需要配置和折腾很多东西的。有时候一个不小心 能会影响某一些功能的使用。\n另外也是为了无缝升级配置\n电报群里网友帮忙从op.supes.top 大神那边定制了一个固件。包含了一些我常用的一些功能。\n但是实际使用的使用，还是发现很多问题：\n主要是几个小问题\n1、ipv6的转发问题（我ipv6 80 443 等端口都是封的，无法使用，所以还是干脆和ipv4一起从路由上转发后统一管理方便一些）\n2、防火墙的一点小问题：op自己不能访问 外网+自己转发的端口。\n3、vpn（ipsec）的一点问题，什么都不如自己随时连接到内网爽。\n4、vpn访问外网和内网 以及梯子分流等\n解决这些问题在朋友帮助下依旧花费了一个下午去调试。 为了防止后面搞坏，除了在luci界面备份一份etc之外，还是全盘备份一下比较安心。\n原始img文件分区 为 2个分区 一个efi（/dev/sda1） 一个5G根（/dev/sda2），实际硬盘是32G msata\n我这里挂上一个1T机械盘（/dev/sdb1）会自动挂载到 /mnt/sdb1\nDD备份方法 备份整个分区 1 2 3 4 5 6 7 # 创建备份目录 mkdir /mnt/sdb1/openwrt # 直接备份 dd if=/dev/sda2 of=/mnt/sdb1/openwrt/backup-20230110-overlay.img # 压缩备份 dd if=/dev/sda1 | gzip \u0026gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-efi.img.gz dd if=/dev/sda2 | gzip \u0026gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay.img.gz 还原 1 gzip -dc /mnt/sdb1/openwrt/backup-XXXX.img.gz | dd of=/dev/sda2 记得 已经挂载的分区 是不可以还原的，需要先卸载后还原，但是肯定是无法从op里面直接卸载的。所以还原需要从另外一个系统里面操作 ，还是不太方便。\ntar备份方法 备份 efi备份（没太大必要）\n1 tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-efi.tar.gz /boot overlay备份 openwrt的精髓\n1 tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay 单独备份/etc （没太大必要）\n1 tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay-etc.tar.gz /overlay/upper/etc 还原 1 2 3 rm -rvf /overlay/* cd / tar -xzvf /mnt/sdb1/openwrt/backup-XXXX-overlay.tar.gz 备份软件列表 方便自己后期查看管理\n1 opkg list-installed \u0026gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-soft-list.txt 关于自动备份 把上面命令 选择性 添加到计划任务 吧。也可以使用rclone等方法定时同步到云盘。自己折腾吧。\n例如 每周2、周五 早上9点33 和50分 备份overlay 和软件列表\n1 2 0 33 9 * * 2,5 * tar -czvf /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-overlay.tar.gz /overlay 0 53 9 * * 2,5 * opkg list-installed \u0026gt; /mnt/sdb1/openwrt/backup-$(date +%Y-%m-%d_%H)-soft-list.txt 优化的自动备份脚本 1 nano /etc/auto_backup.sh 内容\n1 2 3 4 5 6 7 8 9 backupfilename=$(date +%Y%m%d_%H%M%S) backuppath1=\u0026#34;/opt/openwrt-backup\u0026#34; # mkdir /opt/openwrt-backup tar -czvf $backuppath1/$backupfilename-overlay.tar.gz /overlay opkg list-installed \u0026gt; $backuppath1/$backupfilename-soft-list.txt # rm -rvf /overlay/* # cd / # tar -xzvf /mnt/sdb1/openwrt/backup-XXXX-overlay.tar.gz 添加计划任务 每天6点12点18点23点分别备份一次\n等折腾顺利，就不用这样频繁备份了\n1 32 6,12,18,23 * * * sh /etc/auto_backup.sh 参考文章：https://zhzhzhy.github.io/2022/03/20/2022/openwrt-bakcup-step\n","date":"2022-01-09T23:14:20+08:00","permalink":"https://dev.leiyanhui.com/openwrt/backup/","title":"openwrt全盘系统备份"},{"content":"macos+win10切换到ubuntu的全记录 前言 这些年一直想把系统切换到的ubuntu 但因为某些事情制约一直未能实现。最近在作一个物联网设备的全套（设备 硬件 api app ）开发，实在是眼红linux，趁着第一版app 在苹果审核，这几天没有特殊的事情要做，尽快切换以下系统 # 分区规划和系统规划 主力系统切换到ubuntu，但是以及无法离开macos和win10,鉴于macos只是临时用xcode和appstore上传工具，所以 删掉了硬盘上的黑苹果。保留 vhd 的win10 单独放到 一个分区，同时这个分区也作为 两个系统文件交换的 分区。\n安装ubuntu 版本当然是选择ubuntu22.04LTS，这是毋庸置疑的，在实践中发现安装的时候 如果选择最小安装，在设置的共享里面 就没有 remote desktop选项，所以这里选择经典推荐。\n简单配置 添加蓝牙键盘鼠标 设置 外观 dock 修改到底部，并关闭panel mode\n安装xunlei 链接: https://pan.baidu.com/s/1y5ulhPD5YY-TwsBlJ0CMgA 密码: 1b4l 下載後直接\ndpkg -i com.xunlei.download\\_1.0.0.1\\_amd64.deb 安装motrix 这个是直接在商店安装\n安装edge https://www.microsoft.com/zh-cn/edge\n安装百度网盘 https://pan.baidu.com/download\n卸载没必要的软件 sudo apt remove LibreOffice AisleRiot Transmission sudo apt autoremove 安装 Visual Studio Code https://code.visualstudio.com/docs/?dv=linux64_deb\n设置语言 点设置 区域和语言 管理已经安装的语言，提示 语言支持没有安装完整，点安装 等待\n安装搜狗输入法 现在好像不能同步词库了，晚些时候再研究， https://shurufa.sogou.com/linux?r=pinyin https://shurufa.sogou.com/linux/guide\nsudo apt-get install fcitx sudo cp /usr/share/applications/fcitx.desktop /etc/xdg/autostart/ cd 下载/ sudo dpkg -i sogoupinyin\\_4.0.1.2123\\_amd64.deb sudo apt install libqt5qml5 libqt5quick5 libqt5quickwidgets5 qml-module-qtquick2 sudo apt install libgsettings-qt1 重启电脑 ``` ## ubuntu 用户目录改为英文 ``` export LANG=en_US xdg-user-dirs-gtk-update ``` ## 安装VMware 以及win10 macos等 下载 ：https://sysin.org/blog/vmware-workstation-16-linux-slic/ 镜像也使用sysion的 经过我的测试 因为目前还买有macos13 VMwaretools 所以最好还是 macOS Monterey 12.4 (21F79) 或者 11.6 这个记得破解 然后尽可能分配cpu和内存给macos 不要安装到ntfs 或者fat分区 就可以里。ntfs的坑我一整天 ``` yanhui@B150M:/media/yanhui/HDD-NTFS/迅雷下载$ sudo ./VMware-Workstation-Full-16.2.3-19376536.x86_64.bundle ``` VMware对​macos的支持解锁可以用sysin的也推荐这个 https://github.com/DrDonk/unlocker/releases 破解后打开VMware，提示 unable to install all modules ```bash cd /MyData/vmware sudo apt-get install git git clone https://github.com/mkubecek/vmware-host-modules.git cd vmware-host-modules git checkout workstation-16.2.3 #（查看自己下载的安装包或者在终端下敲vmware -v） sudo make #（如果终端提示没有这个命令，只要安装以下就好，其他类似提示没有啥命令就直接安装，sudo apt-get install make） sudo make install ``` 重启电脑，再次打开VMware 首次使用引导，一定记得 关掉自动更新。 顺带找一个key激活 我用的最后一个 可用 下载macos镜像，经过我的测试 macos13 卡顿比较严重，即便是安装了vmtools依旧卡顿的离谱。 因为本着凑合能用就行的态度，我这里选择了 11.6 并尝试12.4（安装的时候VMware重启,后来再次尝试） 安装的时候，注意 自定配置 单cpu 6核（至少2个核心 最大和你实际核心数量一样）内存给到蓝色推荐的上限，不使用网络（有概率导致无法启动）其他默认推荐 安装完成后，安装VMware tools，然后关机添加网卡，我这里选择桥接，方便路由器映射（即 和 主机以及路由器上其他设备都在在一个网段） macos的具体使用xcode 之类的这里不在记录 ## Ubuntu22 打开ssh远程 ## Ubuntu22 远程桌面配置，使用微软远程桌面协议 打开设置 共享 打开就可以了，如果连不上可以重启一下 systemctl \u0026ndash;user restart gnome-remote-desktop.service 值得注意的是，这里的密码和Ubuntu的系统的密码不同.并且需要Ubuntu本身是登录状态才可以用.如果Ubuntu不能自动登录 或者锁定后，就连不上了。 我选择关闭这个，另外安装 sudo apt install xrdp sudo systemctl start xrdp sudo systemctl enable xrdp #systemctl status xrdp 这种方式链接 有时候是黑屏，后来经过测试 是需要注销当前用户，或者用其他用户登录。 但是没有Dock 需要安装 sudo apt install gnome-tweaks 打开 tweaks 或者 优化 【优化】-【外观】-【应用程序】选择 Ambiance 【优化】-【外观】-【图标】选择 Humanity 或者 Humanity-Dark ## 安装钉钉 https://alidocs.dingtalk.com/i/p/nb9XJlJ7QbxN8GyA/docs/ROGpvEna5YQWmaPgQ156W4ykmK3zoB27 ## 安装微信 参考 https://dev.leiyanhui.com/c/8 ## 安装todesk http://www.hellodesk.cn/ ## 尝试virtualbox 无缝模式 使用 微信和QQ等 分别安装 win10 和 win7 都选择企业版 测试win7 无缝模式凑合可以用 win10 无缝模式 无法使用。 ## 安装xDroid 直接运行安卓软件 https://www.linzhuotech.com/Product/download 解压后，直接运行 然后重启电脑 参考文章 http://www.manongjc.com/detail/18-omuajacfhhkmlia.html ubuntu下解决Vmware\u0026ndash;unable to install all modules问题_nice_muyu的博客-CSDN博客https://blog.csdn.net/nice_muyu/article/details/124399888 如何在 Mac 和虚拟机上安装 macOS Big Sur、Monterey 和 Ventura - sysin | SYStem INside | 数据中心系统内幕 Running a Mac OS 12 Monterey VM in Virtualbox VMware 15 上Mac虚拟机卡顿情况的优化_铁锤妹妹头发多的博客-CSDN博客_虚拟机mac如何超级流畅 ​\n","date":"2021-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/5/","title":"macos+win10切换到ubuntu的全记录"},{"content":"edge打开多线程下载 新版Edge，输入edge://flags， 在右上角搜索框搜索Parallel downloading，选择Enable，然后重启edge\n","date":"2020-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/edge/","title":" edge打开多线程下载"},{"content":"宝塔内安装code-server并配置ssl 1、下载 和解压\n我挂了 代理\n1 wget https://ghproxy.com/https://github.com/coder/code-server/releases/download/v4.7.1/code-server-4.7.1-linux-amd64.tar.gz mkdir /opt/ tar -zxvf code-server* -C /opt/ cd /opt mv code-server* code-server\n1 2、基本配置 cd /opt/code-server mkdir data extensions nano config.yaml\n1 内容 bind-addr: 0.0.0.0:8485 # 最好改为 127.0.0.1 仅限nginx反代访问 auth: password password: 123456 cert: false user-data-dir: /opt/code-server/data/ extensions-dir: /opt/code-server/extensions/\n1 3、启动测试 ./bin/code-server \u0026ndash;config /opt/code-server/config.yaml 最新版本在 bin目录下 提示下面信息 就ok，如果有条件可以打开 http://你的ip:8485/ 试试，因为我这里是没有权限访问8485这个端口的。所以 直接跳过，ctrl+c 取消运行 ，去宝塔 继续操作 2022-10-04T04:02:39.307Z] info code-server 4.7.1 77bbed48315a7cc275dc05a53d197197928f4b88 [2022-10-04T04:02:39.308Z] info Using user-data-dir /opt/code-server/data [2022-10-04T04:02:39.333Z] info Using config file /opt/code-server/config.yaml [2022-10-04T04:02:39.333Z] info HTTP server listening on http://0.0.0.0:8485/ [2022-10-04T04:02:39.333Z] info - Authentication is enabled [2022-10-04T04:02:39.333Z] info - Using password from /opt/code-server/config.yaml [2022-10-04T04:02:39.333Z] info - Not serving HTTPS\n1 2 3 4 5 4、宝塔中的配置 为什么要用宝塔，首先是因为这个服务器带着宝塔环境，其次是因为，宝塔有ssl证书自动续签。走ssl的的code-server 就是闹着玩的 登录宝塔》网站》go项目，添加一个 可执行文件：/opt/code-server/bin/code-server 端口：8485 和前面一样 命令：/opt/code-server/bin/code-server \u0026ndash;config /opt/code-server/config.yaml 运行用户：建议选择root 域名选一个输入，可以带端口\n1 2 3 4 5 6 7 8 9 创建完成后，从宝塔正常部署ssl 5、配置 插件搜索 zh-cn 安装简体中文 其他和本地vscode 一样操作 如果还需要更新git 查看 文章：[https://dev.leiyanhui.com/c/centos7-install-new-git/](https://dev.leiyanhui.com/c/centos7-install-new-git/) ","date":"2020-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/bt-code-server-ssl/","title":"宝塔内安装code-server并配置ssl"},{"content":"ubuntu 的virtuabox下安装win8.1 enterprise 体验测试 先去下载\ned2k://|file|cn_windows_8.1_enterprise_with_update_x64_dvd_6050374.iso|4317065216|AC8215A13817CC0EC4EA42E5C92E88B7|/\n安装测试 ，主要是测试无缝模式 测试无缝模式 还好，但是 edge 出现 无法登录的情况 随后 删除\n后来发现 edge无法登录是因为系统更新的问题，更新后可以登录\nwin8.1 目前支持基本上所有的 win10 win11的软件，如果设备比较老，并且有win8的驱动的话，不需要应用商店的那些东西 还是建议用win8\n","date":"2019-09-09T13:14:20+08:00","permalink":"https://dev.leiyanhui.com/c/15/","title":"ubuntu 的virtuabox下安装win8.1 enterprise 体验测试"},{"content":"ubuntu下可视化git工具安装和使用 试过一堆以后 最终选择smartgit 试试gitkraken 三平台可用免费，好像也挺漂亮 https://www.gitkraken.com/download/linux-deb 界面挺漂亮，启动带一个启动画面 有点慢， 汉化 至于汉化，使用 Github 上的 k-skye/gitkraken-chinese 这个仓库即可完成。 方法很简单，安装好之后，使用汉化语言包替换原有的语言包即可。`首先备份官方语言包\n1 sudo mv /usr/share/gitkraken/resources/app.asar.unpacked/src/strings.json /usr/share/gitkraken/resources/app.asar.unpacked/src/strings.json.bk 从github拉取资源并替换\n1 sudo wget https://github.com/k-skye/gitkraken-chinese/raw/master/strings.json -O /usr/share/gitkraken/resources/app.asar.unpacked/src/strings.json 如果在国内访问 github 有困难\n可使用 ghproxy 提供的 github 国内镜像拉取\n1 sudo wget https://ghproxy.com/https://raw.githubusercontent.com/k-skye/gitkraken-chinese/master/strings_8.1.1.json -O /usr/share/gitkraken/resources/app.asar.unpacked/src/strings.json 重启 gitkraken 然后 发现 使用私有仓库功能 是收费的 。。。。 卸载 sudo dpkg -r gitkraken sudo dpkg --purge gitkraken 另外还有一个 giteye 同样是三平台\n1 https://www.collab.net/downloads/giteye#Linux 官网网速很感人 依靠java 抛弃 再尝试一下 https://aurees.com/ https://aurees.com/download/AureesSetup-linux.deb\n1 sudo dpkg -i 软件包(deb)本地地址 提示要安装 gtk-sharp2 libgconf2-4 明显不支持 最后尝试smartgit个人免费，但是每次打开 有1分钟左右不让用，让你确认是不是个人非盈利\n1 https://www.syntevo.com/smartgit/download/ 卸载 dpkg -l | grep smartgit sudo dpkg -r smartgit sudo dpkg --purge smartgit 使用方法 先注册，选择在家，升级那个去掉勾选，就可以免费申请 邮箱收到 一个 smartgit.lic 点帮助 注册需要 选择这个lic文件\n","date":"2019-09-09T13:14:20+08:00","permalink":"https://dev.leiyanhui.com/c/13/","title":"ubuntu下可视化git工具安装和使用 试过一堆以后 最终选择smartgit"},{"content":"aliyun-webdav 阿里云盘 依旧没有封掉webdav的访问（2022-08-20），而且不限速（其实也只有区区几M），比起百度云真的好的不是一点半点。 2020年内测的时候，我在百度云充了一个周卡 花了几天时间 把数据全部拉回本地，同时上传到阿里云。但是一直没有搭建阿里云的webdav，是因为担心内测结束后阿里云随时会封掉接口，白忙活一场。目前阿里云盘已经推出了收费服务。不过他家的同步盘真心是难用的很，所以不打算付费。还是自己搭一个webdav白嫖吧。 首先浏览器访问 https://www.aliyundrive.com/ 登录 F12 拿到 refresh_token 这个令牌 在登录管理里面 如果不删除这个浏览器的话，可以一直有效（需要定时刷新） https://github.com/messense/aliyundrive-webdav#docker-%E8%BF%90%E8%A1%8C 还是用这个吧，直接docker 就好了 windows运行也可以 https://github.com/messense/aliyundrive-webdav/releases/download/v1.10.1/aliyundrive-webdav-v1.10.1.aarch64-pc-windows-msvc.zip 解压得到exe 命令行用法 作者主页有 我把exe放到 F:\\GreenSoft\\Server\\aliyunpan\\aliyundrive-webdav.exe 在同目录下 新建文件 aliyunpan.bat 代码如下 aliyundrive-webdav.exe \u0026ndash;port 8098 \u0026ndash;refresh-token XXXXXXX \u0026ndash;no-redirect \u0026ndash;prefer-http-download \u0026ndash;auto-index \u0026ndash;auth-user admin \u0026ndash;auth-password admin bat 添加到开机自动启动 就可以了。 本机打开 http://localhost:8098 可以访问就ok 其他信息很简单 自己看着修改就ok了 在宝塔或者其他地方 弄一个反代，然后就可以开启https 比较简单不再重复\n","date":"2018-08-20T10:57:59Z","permalink":"https://dev.leiyanhui.com/c/aliyun-webdav/","title":"把阿里云盘挂载到webdav"},{"content":"VirtualBox 下linux访问物理机windows文件的方法 先在linux下安装增强工具，虚拟机\u0026gt;设备\u0026gt;安装增强功能\n没有自动挂载cdrom，手动挂载一下 mount /dev/cdrom /home/centos/rom 然后cd /home/centos/rom 再运行 sh VBoxLinuxAdditions.run 可能要提前安装一些依赖 apt install kernel sources kernel-devel gcc 或者 yum安装 然后添加共享 选择挂载位置，重启虚拟机主机 就可以了\n文件权限 是 770 root所有 ，貌似无法修改\n","date":"2017-09-07T19:56:11Z","permalink":"https://dev.leiyanhui.com/c/virtualbox-linux-windows/","title":"VirtualBox 下linux访问物理机windows文件的方法"},{"content":"typecho修改文字类型默认为私密 关闭默认评论等 私密 文章只有登录后才可以看到、\n打开 admincp/write-post.php\n把\n|| !$post-\u0026gt;status 挪到私密 这行\n同时把\u0026lt;?php if ($post-\u0026gt;allow('feed')): ?\u0026gt;checked=\u0026quot;true\u0026quot;\u0026lt;?php endif; ?\u0026gt; 删掉，也不会出现在聚合里面\n","date":"2014-09-09T13:14:20+08:00","permalink":"https://dev.leiyanhui.com/c/4/","title":"typecho修改文字类型默认为私密 关闭默认评论等"},{"content":"邮箱：joyanhui@qq.com leiyanhui@gmail.com\n","date":"2004-09-09T13:14:20+08:00","permalink":"https://dev.leiyanhui.com/c/1/","title":"联系小类"}]