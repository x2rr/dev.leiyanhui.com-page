<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Dockers on 小类随手记</title><link>https://dev.leiyanhui.com/docker/</link><description>Recent content in Dockers on 小类随手记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 19 Nov 2023 07:14:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>docker swarm 集群debian基础镜像</title><link>https://dev.leiyanhui.com/docker/debian-fishbase/</link><pubDate>Sun, 19 Nov 2023 07:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-fishbase/</guid><description>&lt;h2 id="场景">场景
&lt;/h2>&lt;p>之前服务都是基于 rust和golang 所以一直使用公用镜像。但是在使用对象储存的时候发现缺少ssl支持。&lt;br>
不得不&lt;/p>
&lt;h2 id="准备文件">准备文件
&lt;/h2>&lt;ul>
&lt;li>sources.list （服务器上 没科学工具）&lt;/li>
&lt;li>zsh 配置文件（偶尔需要在容器内部操作所以还是加上）&lt;/li>
&lt;/ul>
&lt;h3 id="sourecelist">sourece.list
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># deb-src http://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="zsh-配置文件">zsh 配置文件
&lt;/h3>&lt;p>&lt;a class="link" href="https://github.com/joyanhui/oh-my-zsh" target="_blank" rel="noopener"
>https://github.com/joyanhui/oh-my-zsh&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm -rf .oh-my-zsh yhZsh.zip .zshrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -L -e &amp;#39;; auto&amp;#39; -o yhZsh.zip https://mirror.ghproxy.com/https://github.com/joyanhui/oh-my-zsh/archive/refs/heads/main.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unzip yhZsh.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv oh-my-zsh-main/.oh-my-zsh . &amp;amp;&amp;amp; cp oh-my-zsh-main/.zshrc .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf yhZsh.zip oh-my-zsh-main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>适当删除一些没用的插件和主题&lt;/p>
&lt;h2 id="dockerfile">Dockerfile
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> debian:stable-20231120-slim&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">MAINTAINER&lt;/span>&lt;span class="s"> author &amp;#34;leiyanhui@gmail.com&amp;#34;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ADD&lt;/span> sources.list /etc/apt/&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ADD&lt;/span> .zshrc /root/&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> .oh-my-zsh /root/.oh-my-zsh&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c">#ADD rclone /usr/bin/&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> rm -rf /etc/apt/sources.list.d/debian.sources &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y apt-transport-https ca-certificates gnupg lsb-release &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get install -y psmisc wget curl unzip zip fuse zsh ntp iftop openssh-server &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt autoremove &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get clean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get autoclean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>WORKDIR /root&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">EXPOSE&lt;/span>&lt;span class="s"> 22&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">CMD&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;/usr/sbin/sshd&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;-D&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="容器服务">容器服务
&lt;/h2>&lt;p>因为更新较少，所以使用阿里云的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo docker login --username&lt;span class="o">=&lt;/span>&amp;lt;用户名&amp;gt; registry.cn-shanghai.aliyuncs.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">nowTime&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>date &lt;span class="s2">&amp;#34;+%Y%m%d%H%M%S&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker build -t registry.cn-shanghai.aliyuncs.com/fish/debian:base-&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">nowTime&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker tag registry.cn-shanghai.aliyuncs.com/fish/debian:base-&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">nowTime&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> registry.cn-shanghai.aliyuncs.com/fish/debian:base-latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker push registry.cn-shanghai.aliyuncs.com/fish/debian:base-&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">nowTime&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker push registry.cn-shanghai.aliyuncs.com/fish/debian:base-latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="swarm集群部署">swarm集群部署
&lt;/h2>&lt;p>在集群上分别登陆
然后&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">docker pull registry.cn-shanghai.aliyuncs.com/fish/debian:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker 创建redis 集群 以及tls等</title><link>https://dev.leiyanhui.com/docker/redis/</link><pubDate>Fri, 08 Sep 2023 21:15:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/redis/</guid><description>&lt;p>需要2个文件 一个 shell(redis_docker_start.sh) 一个 redis.conf 模板 (redis_docker_tpl.conf)&lt;br>
如果需要配置tls 需要用redis自带的工具创建一下自签名证书，或者购买证书。&lt;/p>
&lt;p>redis自带的证书创建 ： &lt;a class="link" href="https://github.com/redis/redis/blob/unstable/utils/gen-test-certs.sh" target="_blank" rel="noopener"
>https://github.com/redis/redis/blob/unstable/utils/gen-test-certs.sh&lt;/a> 可以自己修改一下，最后会创建11个文件。&lt;/p>
&lt;p>因为在公网异地集群，我这里只记录tls的集群&lt;/p>
&lt;h2 id="创建一个节点">创建一个节点
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">bash redis_docker_start.sh &lt;span class="m">6078&lt;/span> &lt;span class="m">6079&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="连接到节点">连接到节点
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">redis-cli --tls &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --cacert /home/xxx/tls/ca.crt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -a XXXXX &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -h 10.1.1.75 -p &lt;span class="m">6079&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>只需要指定ca.crt即可&lt;/p>
&lt;h2 id="redis_docker_startsh">redis_docker_start.sh
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">BASH_VERSION&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;请使用 bash 命令执行该脚本&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ 创建证书文件 函数 #################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> creatTLS_file &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/ca.crt &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/ca.key &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/ca.txt &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/client.crt &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/client.key &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/openssl.cnf &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/redis.crt &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/redis.dh &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/redis.key &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/server.crt&lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; &lt;span class="nv">$redisFile&lt;/span>/tls/server.key&lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">XXXXX
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 主程序 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;tcp端口参数 \$1 不存在 无法继续&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$2&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;tls端口参数 \$2 不存在 无法继续&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;tcp端口:&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2"> tls端口:&lt;/span>&lt;span class="nv">$2&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 相关文件 配置###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">redisFile&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/redis_docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> “创建目录和日志文件到：&lt;span class="nv">$redisFile&lt;/span>”
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/data &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf &lt;span class="nv">$redisFile&lt;/span>/tls &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/log/redis.log &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> touch &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/log/redis.log &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> chmod -R &lt;span class="m">777&lt;/span> &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod -R &lt;span class="m">777&lt;/span> &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 创建 acl 这个不是必须的###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> “创建acl文件 &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/users.acl”
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;user default on #XXXXXX ~* &amp;amp;* +@all&amp;#34;&lt;/span>&amp;gt;&lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf/users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 复制配置文件 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> “创建配置文件 &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf/redis.conf”
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf/redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp redis_docker_tpl.conf &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf/redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 复制配置文件 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tcp 端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s2">&amp;#34;s/{port}/&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">/g&amp;#34;&lt;/span> &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf/redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls 端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s2">&amp;#34;s/{tlsPort}/&lt;/span>&lt;span class="nv">$2&lt;/span>&lt;span class="s2">/g&amp;#34;&lt;/span> &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf/redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s2">&amp;#34;s/{password}/XXXXX/g&amp;#34;&lt;/span> &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf/redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 创建证书文件 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> “创建证书文件到目录 &lt;span class="nv">$redisFile&lt;/span>/tls“
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">creatTLS_file &lt;span class="c1"># 创建证书文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 启动docker ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;删除旧容器 redis_&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2"> ....&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker stop redis_&lt;span class="nv">$1&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span>sudo docker rm redis_&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;创建新容器 redis_&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2"> ....&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker run -itd --name redis_&lt;span class="nv">$1&lt;/span> --hostname redis_&lt;span class="nv">$1&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --restart&lt;span class="o">=&lt;/span>always --net&lt;span class="o">=&lt;/span>host &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/cnf:/cnf &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/data:/var/lib/redis &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v &lt;span class="nv">$redisFile&lt;/span>/&lt;span class="nv">$1&lt;/span>/log:/var/log/redis &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v &lt;span class="nv">$redisFile&lt;/span>/tls:/etc/ssl/certs &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -d redis:7.2.1-alpine3.18 redis-server /cnf/redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker ps -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo docker logs -f redis_&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls 测试&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -d redis:7.2.1-alpine3.18 redis-server /volume/cnf/redis.conf &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># docker run --name test redis:7.2.1-alpine3.18&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="redis_docker_tplconf">redis_docker_tpl.conf
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt"> 100
&lt;/span>&lt;span class="lnt"> 101
&lt;/span>&lt;span class="lnt"> 102
&lt;/span>&lt;span class="lnt"> 103
&lt;/span>&lt;span class="lnt"> 104
&lt;/span>&lt;span class="lnt"> 105
&lt;/span>&lt;span class="lnt"> 106
&lt;/span>&lt;span class="lnt"> 107
&lt;/span>&lt;span class="lnt"> 108
&lt;/span>&lt;span class="lnt"> 109
&lt;/span>&lt;span class="lnt"> 110
&lt;/span>&lt;span class="lnt"> 111
&lt;/span>&lt;span class="lnt"> 112
&lt;/span>&lt;span class="lnt"> 113
&lt;/span>&lt;span class="lnt"> 114
&lt;/span>&lt;span class="lnt"> 115
&lt;/span>&lt;span class="lnt"> 116
&lt;/span>&lt;span class="lnt"> 117
&lt;/span>&lt;span class="lnt"> 118
&lt;/span>&lt;span class="lnt"> 119
&lt;/span>&lt;span class="lnt"> 120
&lt;/span>&lt;span class="lnt"> 121
&lt;/span>&lt;span class="lnt"> 122
&lt;/span>&lt;span class="lnt"> 123
&lt;/span>&lt;span class="lnt"> 124
&lt;/span>&lt;span class="lnt"> 125
&lt;/span>&lt;span class="lnt"> 126
&lt;/span>&lt;span class="lnt"> 127
&lt;/span>&lt;span class="lnt"> 128
&lt;/span>&lt;span class="lnt"> 129
&lt;/span>&lt;span class="lnt"> 130
&lt;/span>&lt;span class="lnt"> 131
&lt;/span>&lt;span class="lnt"> 132
&lt;/span>&lt;span class="lnt"> 133
&lt;/span>&lt;span class="lnt"> 134
&lt;/span>&lt;span class="lnt"> 135
&lt;/span>&lt;span class="lnt"> 136
&lt;/span>&lt;span class="lnt"> 137
&lt;/span>&lt;span class="lnt"> 138
&lt;/span>&lt;span class="lnt"> 139
&lt;/span>&lt;span class="lnt"> 140
&lt;/span>&lt;span class="lnt"> 141
&lt;/span>&lt;span class="lnt"> 142
&lt;/span>&lt;span class="lnt"> 143
&lt;/span>&lt;span class="lnt"> 144
&lt;/span>&lt;span class="lnt"> 145
&lt;/span>&lt;span class="lnt"> 146
&lt;/span>&lt;span class="lnt"> 147
&lt;/span>&lt;span class="lnt"> 148
&lt;/span>&lt;span class="lnt"> 149
&lt;/span>&lt;span class="lnt"> 150
&lt;/span>&lt;span class="lnt"> 151
&lt;/span>&lt;span class="lnt"> 152
&lt;/span>&lt;span class="lnt"> 153
&lt;/span>&lt;span class="lnt"> 154
&lt;/span>&lt;span class="lnt"> 155
&lt;/span>&lt;span class="lnt"> 156
&lt;/span>&lt;span class="lnt"> 157
&lt;/span>&lt;span class="lnt"> 158
&lt;/span>&lt;span class="lnt"> 159
&lt;/span>&lt;span class="lnt"> 160
&lt;/span>&lt;span class="lnt"> 161
&lt;/span>&lt;span class="lnt"> 162
&lt;/span>&lt;span class="lnt"> 163
&lt;/span>&lt;span class="lnt"> 164
&lt;/span>&lt;span class="lnt"> 165
&lt;/span>&lt;span class="lnt"> 166
&lt;/span>&lt;span class="lnt"> 167
&lt;/span>&lt;span class="lnt"> 168
&lt;/span>&lt;span class="lnt"> 169
&lt;/span>&lt;span class="lnt"> 170
&lt;/span>&lt;span class="lnt"> 171
&lt;/span>&lt;span class="lnt"> 172
&lt;/span>&lt;span class="lnt"> 173
&lt;/span>&lt;span class="lnt"> 174
&lt;/span>&lt;span class="lnt"> 175
&lt;/span>&lt;span class="lnt"> 176
&lt;/span>&lt;span class="lnt"> 177
&lt;/span>&lt;span class="lnt"> 178
&lt;/span>&lt;span class="lnt"> 179
&lt;/span>&lt;span class="lnt"> 180
&lt;/span>&lt;span class="lnt"> 181
&lt;/span>&lt;span class="lnt"> 182
&lt;/span>&lt;span class="lnt"> 183
&lt;/span>&lt;span class="lnt"> 184
&lt;/span>&lt;span class="lnt"> 185
&lt;/span>&lt;span class="lnt"> 186
&lt;/span>&lt;span class="lnt"> 187
&lt;/span>&lt;span class="lnt"> 188
&lt;/span>&lt;span class="lnt"> 189
&lt;/span>&lt;span class="lnt"> 190
&lt;/span>&lt;span class="lnt"> 191
&lt;/span>&lt;span class="lnt"> 192
&lt;/span>&lt;span class="lnt"> 193
&lt;/span>&lt;span class="lnt"> 194
&lt;/span>&lt;span class="lnt"> 195
&lt;/span>&lt;span class="lnt"> 196
&lt;/span>&lt;span class="lnt"> 197
&lt;/span>&lt;span class="lnt"> 198
&lt;/span>&lt;span class="lnt"> 199
&lt;/span>&lt;span class="lnt"> 200
&lt;/span>&lt;span class="lnt"> 201
&lt;/span>&lt;span class="lnt"> 202
&lt;/span>&lt;span class="lnt"> 203
&lt;/span>&lt;span class="lnt"> 204
&lt;/span>&lt;span class="lnt"> 205
&lt;/span>&lt;span class="lnt"> 206
&lt;/span>&lt;span class="lnt"> 207
&lt;/span>&lt;span class="lnt"> 208
&lt;/span>&lt;span class="lnt"> 209
&lt;/span>&lt;span class="lnt"> 210
&lt;/span>&lt;span class="lnt"> 211
&lt;/span>&lt;span class="lnt"> 212
&lt;/span>&lt;span class="lnt"> 213
&lt;/span>&lt;span class="lnt"> 214
&lt;/span>&lt;span class="lnt"> 215
&lt;/span>&lt;span class="lnt"> 216
&lt;/span>&lt;span class="lnt"> 217
&lt;/span>&lt;span class="lnt"> 218
&lt;/span>&lt;span class="lnt"> 219
&lt;/span>&lt;span class="lnt"> 220
&lt;/span>&lt;span class="lnt"> 221
&lt;/span>&lt;span class="lnt"> 222
&lt;/span>&lt;span class="lnt"> 223
&lt;/span>&lt;span class="lnt"> 224
&lt;/span>&lt;span class="lnt"> 225
&lt;/span>&lt;span class="lnt"> 226
&lt;/span>&lt;span class="lnt"> 227
&lt;/span>&lt;span class="lnt"> 228
&lt;/span>&lt;span class="lnt"> 229
&lt;/span>&lt;span class="lnt"> 230
&lt;/span>&lt;span class="lnt"> 231
&lt;/span>&lt;span class="lnt"> 232
&lt;/span>&lt;span class="lnt"> 233
&lt;/span>&lt;span class="lnt"> 234
&lt;/span>&lt;span class="lnt"> 235
&lt;/span>&lt;span class="lnt"> 236
&lt;/span>&lt;span class="lnt"> 237
&lt;/span>&lt;span class="lnt"> 238
&lt;/span>&lt;span class="lnt"> 239
&lt;/span>&lt;span class="lnt"> 240
&lt;/span>&lt;span class="lnt"> 241
&lt;/span>&lt;span class="lnt"> 242
&lt;/span>&lt;span class="lnt"> 243
&lt;/span>&lt;span class="lnt"> 244
&lt;/span>&lt;span class="lnt"> 245
&lt;/span>&lt;span class="lnt"> 246
&lt;/span>&lt;span class="lnt"> 247
&lt;/span>&lt;span class="lnt"> 248
&lt;/span>&lt;span class="lnt"> 249
&lt;/span>&lt;span class="lnt"> 250
&lt;/span>&lt;span class="lnt"> 251
&lt;/span>&lt;span class="lnt"> 252
&lt;/span>&lt;span class="lnt"> 253
&lt;/span>&lt;span class="lnt"> 254
&lt;/span>&lt;span class="lnt"> 255
&lt;/span>&lt;span class="lnt"> 256
&lt;/span>&lt;span class="lnt"> 257
&lt;/span>&lt;span class="lnt"> 258
&lt;/span>&lt;span class="lnt"> 259
&lt;/span>&lt;span class="lnt"> 260
&lt;/span>&lt;span class="lnt"> 261
&lt;/span>&lt;span class="lnt"> 262
&lt;/span>&lt;span class="lnt"> 263
&lt;/span>&lt;span class="lnt"> 264
&lt;/span>&lt;span class="lnt"> 265
&lt;/span>&lt;span class="lnt"> 266
&lt;/span>&lt;span class="lnt"> 267
&lt;/span>&lt;span class="lnt"> 268
&lt;/span>&lt;span class="lnt"> 269
&lt;/span>&lt;span class="lnt"> 270
&lt;/span>&lt;span class="lnt"> 271
&lt;/span>&lt;span class="lnt"> 272
&lt;/span>&lt;span class="lnt"> 273
&lt;/span>&lt;span class="lnt"> 274
&lt;/span>&lt;span class="lnt"> 275
&lt;/span>&lt;span class="lnt"> 276
&lt;/span>&lt;span class="lnt"> 277
&lt;/span>&lt;span class="lnt"> 278
&lt;/span>&lt;span class="lnt"> 279
&lt;/span>&lt;span class="lnt"> 280
&lt;/span>&lt;span class="lnt"> 281
&lt;/span>&lt;span class="lnt"> 282
&lt;/span>&lt;span class="lnt"> 283
&lt;/span>&lt;span class="lnt"> 284
&lt;/span>&lt;span class="lnt"> 285
&lt;/span>&lt;span class="lnt"> 286
&lt;/span>&lt;span class="lnt"> 287
&lt;/span>&lt;span class="lnt"> 288
&lt;/span>&lt;span class="lnt"> 289
&lt;/span>&lt;span class="lnt"> 290
&lt;/span>&lt;span class="lnt"> 291
&lt;/span>&lt;span class="lnt"> 292
&lt;/span>&lt;span class="lnt"> 293
&lt;/span>&lt;span class="lnt"> 294
&lt;/span>&lt;span class="lnt"> 295
&lt;/span>&lt;span class="lnt"> 296
&lt;/span>&lt;span class="lnt"> 297
&lt;/span>&lt;span class="lnt"> 298
&lt;/span>&lt;span class="lnt"> 299
&lt;/span>&lt;span class="lnt"> 300
&lt;/span>&lt;span class="lnt"> 301
&lt;/span>&lt;span class="lnt"> 302
&lt;/span>&lt;span class="lnt"> 303
&lt;/span>&lt;span class="lnt"> 304
&lt;/span>&lt;span class="lnt"> 305
&lt;/span>&lt;span class="lnt"> 306
&lt;/span>&lt;span class="lnt"> 307
&lt;/span>&lt;span class="lnt"> 308
&lt;/span>&lt;span class="lnt"> 309
&lt;/span>&lt;span class="lnt"> 310
&lt;/span>&lt;span class="lnt"> 311
&lt;/span>&lt;span class="lnt"> 312
&lt;/span>&lt;span class="lnt"> 313
&lt;/span>&lt;span class="lnt"> 314
&lt;/span>&lt;span class="lnt"> 315
&lt;/span>&lt;span class="lnt"> 316
&lt;/span>&lt;span class="lnt"> 317
&lt;/span>&lt;span class="lnt"> 318
&lt;/span>&lt;span class="lnt"> 319
&lt;/span>&lt;span class="lnt"> 320
&lt;/span>&lt;span class="lnt"> 321
&lt;/span>&lt;span class="lnt"> 322
&lt;/span>&lt;span class="lnt"> 323
&lt;/span>&lt;span class="lnt"> 324
&lt;/span>&lt;span class="lnt"> 325
&lt;/span>&lt;span class="lnt"> 326
&lt;/span>&lt;span class="lnt"> 327
&lt;/span>&lt;span class="lnt"> 328
&lt;/span>&lt;span class="lnt"> 329
&lt;/span>&lt;span class="lnt"> 330
&lt;/span>&lt;span class="lnt"> 331
&lt;/span>&lt;span class="lnt"> 332
&lt;/span>&lt;span class="lnt"> 333
&lt;/span>&lt;span class="lnt"> 334
&lt;/span>&lt;span class="lnt"> 335
&lt;/span>&lt;span class="lnt"> 336
&lt;/span>&lt;span class="lnt"> 337
&lt;/span>&lt;span class="lnt"> 338
&lt;/span>&lt;span class="lnt"> 339
&lt;/span>&lt;span class="lnt"> 340
&lt;/span>&lt;span class="lnt"> 341
&lt;/span>&lt;span class="lnt"> 342
&lt;/span>&lt;span class="lnt"> 343
&lt;/span>&lt;span class="lnt"> 344
&lt;/span>&lt;span class="lnt"> 345
&lt;/span>&lt;span class="lnt"> 346
&lt;/span>&lt;span class="lnt"> 347
&lt;/span>&lt;span class="lnt"> 348
&lt;/span>&lt;span class="lnt"> 349
&lt;/span>&lt;span class="lnt"> 350
&lt;/span>&lt;span class="lnt"> 351
&lt;/span>&lt;span class="lnt"> 352
&lt;/span>&lt;span class="lnt"> 353
&lt;/span>&lt;span class="lnt"> 354
&lt;/span>&lt;span class="lnt"> 355
&lt;/span>&lt;span class="lnt"> 356
&lt;/span>&lt;span class="lnt"> 357
&lt;/span>&lt;span class="lnt"> 358
&lt;/span>&lt;span class="lnt"> 359
&lt;/span>&lt;span class="lnt"> 360
&lt;/span>&lt;span class="lnt"> 361
&lt;/span>&lt;span class="lnt"> 362
&lt;/span>&lt;span class="lnt"> 363
&lt;/span>&lt;span class="lnt"> 364
&lt;/span>&lt;span class="lnt"> 365
&lt;/span>&lt;span class="lnt"> 366
&lt;/span>&lt;span class="lnt"> 367
&lt;/span>&lt;span class="lnt"> 368
&lt;/span>&lt;span class="lnt"> 369
&lt;/span>&lt;span class="lnt"> 370
&lt;/span>&lt;span class="lnt"> 371
&lt;/span>&lt;span class="lnt"> 372
&lt;/span>&lt;span class="lnt"> 373
&lt;/span>&lt;span class="lnt"> 374
&lt;/span>&lt;span class="lnt"> 375
&lt;/span>&lt;span class="lnt"> 376
&lt;/span>&lt;span class="lnt"> 377
&lt;/span>&lt;span class="lnt"> 378
&lt;/span>&lt;span class="lnt"> 379
&lt;/span>&lt;span class="lnt"> 380
&lt;/span>&lt;span class="lnt"> 381
&lt;/span>&lt;span class="lnt"> 382
&lt;/span>&lt;span class="lnt"> 383
&lt;/span>&lt;span class="lnt"> 384
&lt;/span>&lt;span class="lnt"> 385
&lt;/span>&lt;span class="lnt"> 386
&lt;/span>&lt;span class="lnt"> 387
&lt;/span>&lt;span class="lnt"> 388
&lt;/span>&lt;span class="lnt"> 389
&lt;/span>&lt;span class="lnt"> 390
&lt;/span>&lt;span class="lnt"> 391
&lt;/span>&lt;span class="lnt"> 392
&lt;/span>&lt;span class="lnt"> 393
&lt;/span>&lt;span class="lnt"> 394
&lt;/span>&lt;span class="lnt"> 395
&lt;/span>&lt;span class="lnt"> 396
&lt;/span>&lt;span class="lnt"> 397
&lt;/span>&lt;span class="lnt"> 398
&lt;/span>&lt;span class="lnt"> 399
&lt;/span>&lt;span class="lnt"> 400
&lt;/span>&lt;span class="lnt"> 401
&lt;/span>&lt;span class="lnt"> 402
&lt;/span>&lt;span class="lnt"> 403
&lt;/span>&lt;span class="lnt"> 404
&lt;/span>&lt;span class="lnt"> 405
&lt;/span>&lt;span class="lnt"> 406
&lt;/span>&lt;span class="lnt"> 407
&lt;/span>&lt;span class="lnt"> 408
&lt;/span>&lt;span class="lnt"> 409
&lt;/span>&lt;span class="lnt"> 410
&lt;/span>&lt;span class="lnt"> 411
&lt;/span>&lt;span class="lnt"> 412
&lt;/span>&lt;span class="lnt"> 413
&lt;/span>&lt;span class="lnt"> 414
&lt;/span>&lt;span class="lnt"> 415
&lt;/span>&lt;span class="lnt"> 416
&lt;/span>&lt;span class="lnt"> 417
&lt;/span>&lt;span class="lnt"> 418
&lt;/span>&lt;span class="lnt"> 419
&lt;/span>&lt;span class="lnt"> 420
&lt;/span>&lt;span class="lnt"> 421
&lt;/span>&lt;span class="lnt"> 422
&lt;/span>&lt;span class="lnt"> 423
&lt;/span>&lt;span class="lnt"> 424
&lt;/span>&lt;span class="lnt"> 425
&lt;/span>&lt;span class="lnt"> 426
&lt;/span>&lt;span class="lnt"> 427
&lt;/span>&lt;span class="lnt"> 428
&lt;/span>&lt;span class="lnt"> 429
&lt;/span>&lt;span class="lnt"> 430
&lt;/span>&lt;span class="lnt"> 431
&lt;/span>&lt;span class="lnt"> 432
&lt;/span>&lt;span class="lnt"> 433
&lt;/span>&lt;span class="lnt"> 434
&lt;/span>&lt;span class="lnt"> 435
&lt;/span>&lt;span class="lnt"> 436
&lt;/span>&lt;span class="lnt"> 437
&lt;/span>&lt;span class="lnt"> 438
&lt;/span>&lt;span class="lnt"> 439
&lt;/span>&lt;span class="lnt"> 440
&lt;/span>&lt;span class="lnt"> 441
&lt;/span>&lt;span class="lnt"> 442
&lt;/span>&lt;span class="lnt"> 443
&lt;/span>&lt;span class="lnt"> 444
&lt;/span>&lt;span class="lnt"> 445
&lt;/span>&lt;span class="lnt"> 446
&lt;/span>&lt;span class="lnt"> 447
&lt;/span>&lt;span class="lnt"> 448
&lt;/span>&lt;span class="lnt"> 449
&lt;/span>&lt;span class="lnt"> 450
&lt;/span>&lt;span class="lnt"> 451
&lt;/span>&lt;span class="lnt"> 452
&lt;/span>&lt;span class="lnt"> 453
&lt;/span>&lt;span class="lnt"> 454
&lt;/span>&lt;span class="lnt"> 455
&lt;/span>&lt;span class="lnt"> 456
&lt;/span>&lt;span class="lnt"> 457
&lt;/span>&lt;span class="lnt"> 458
&lt;/span>&lt;span class="lnt"> 459
&lt;/span>&lt;span class="lnt"> 460
&lt;/span>&lt;span class="lnt"> 461
&lt;/span>&lt;span class="lnt"> 462
&lt;/span>&lt;span class="lnt"> 463
&lt;/span>&lt;span class="lnt"> 464
&lt;/span>&lt;span class="lnt"> 465
&lt;/span>&lt;span class="lnt"> 466
&lt;/span>&lt;span class="lnt"> 467
&lt;/span>&lt;span class="lnt"> 468
&lt;/span>&lt;span class="lnt"> 469
&lt;/span>&lt;span class="lnt"> 470
&lt;/span>&lt;span class="lnt"> 471
&lt;/span>&lt;span class="lnt"> 472
&lt;/span>&lt;span class="lnt"> 473
&lt;/span>&lt;span class="lnt"> 474
&lt;/span>&lt;span class="lnt"> 475
&lt;/span>&lt;span class="lnt"> 476
&lt;/span>&lt;span class="lnt"> 477
&lt;/span>&lt;span class="lnt"> 478
&lt;/span>&lt;span class="lnt"> 479
&lt;/span>&lt;span class="lnt"> 480
&lt;/span>&lt;span class="lnt"> 481
&lt;/span>&lt;span class="lnt"> 482
&lt;/span>&lt;span class="lnt"> 483
&lt;/span>&lt;span class="lnt"> 484
&lt;/span>&lt;span class="lnt"> 485
&lt;/span>&lt;span class="lnt"> 486
&lt;/span>&lt;span class="lnt"> 487
&lt;/span>&lt;span class="lnt"> 488
&lt;/span>&lt;span class="lnt"> 489
&lt;/span>&lt;span class="lnt"> 490
&lt;/span>&lt;span class="lnt"> 491
&lt;/span>&lt;span class="lnt"> 492
&lt;/span>&lt;span class="lnt"> 493
&lt;/span>&lt;span class="lnt"> 494
&lt;/span>&lt;span class="lnt"> 495
&lt;/span>&lt;span class="lnt"> 496
&lt;/span>&lt;span class="lnt"> 497
&lt;/span>&lt;span class="lnt"> 498
&lt;/span>&lt;span class="lnt"> 499
&lt;/span>&lt;span class="lnt"> 500
&lt;/span>&lt;span class="lnt"> 501
&lt;/span>&lt;span class="lnt"> 502
&lt;/span>&lt;span class="lnt"> 503
&lt;/span>&lt;span class="lnt"> 504
&lt;/span>&lt;span class="lnt"> 505
&lt;/span>&lt;span class="lnt"> 506
&lt;/span>&lt;span class="lnt"> 507
&lt;/span>&lt;span class="lnt"> 508
&lt;/span>&lt;span class="lnt"> 509
&lt;/span>&lt;span class="lnt"> 510
&lt;/span>&lt;span class="lnt"> 511
&lt;/span>&lt;span class="lnt"> 512
&lt;/span>&lt;span class="lnt"> 513
&lt;/span>&lt;span class="lnt"> 514
&lt;/span>&lt;span class="lnt"> 515
&lt;/span>&lt;span class="lnt"> 516
&lt;/span>&lt;span class="lnt"> 517
&lt;/span>&lt;span class="lnt"> 518
&lt;/span>&lt;span class="lnt"> 519
&lt;/span>&lt;span class="lnt"> 520
&lt;/span>&lt;span class="lnt"> 521
&lt;/span>&lt;span class="lnt"> 522
&lt;/span>&lt;span class="lnt"> 523
&lt;/span>&lt;span class="lnt"> 524
&lt;/span>&lt;span class="lnt"> 525
&lt;/span>&lt;span class="lnt"> 526
&lt;/span>&lt;span class="lnt"> 527
&lt;/span>&lt;span class="lnt"> 528
&lt;/span>&lt;span class="lnt"> 529
&lt;/span>&lt;span class="lnt"> 530
&lt;/span>&lt;span class="lnt"> 531
&lt;/span>&lt;span class="lnt"> 532
&lt;/span>&lt;span class="lnt"> 533
&lt;/span>&lt;span class="lnt"> 534
&lt;/span>&lt;span class="lnt"> 535
&lt;/span>&lt;span class="lnt"> 536
&lt;/span>&lt;span class="lnt"> 537
&lt;/span>&lt;span class="lnt"> 538
&lt;/span>&lt;span class="lnt"> 539
&lt;/span>&lt;span class="lnt"> 540
&lt;/span>&lt;span class="lnt"> 541
&lt;/span>&lt;span class="lnt"> 542
&lt;/span>&lt;span class="lnt"> 543
&lt;/span>&lt;span class="lnt"> 544
&lt;/span>&lt;span class="lnt"> 545
&lt;/span>&lt;span class="lnt"> 546
&lt;/span>&lt;span class="lnt"> 547
&lt;/span>&lt;span class="lnt"> 548
&lt;/span>&lt;span class="lnt"> 549
&lt;/span>&lt;span class="lnt"> 550
&lt;/span>&lt;span class="lnt"> 551
&lt;/span>&lt;span class="lnt"> 552
&lt;/span>&lt;span class="lnt"> 553
&lt;/span>&lt;span class="lnt"> 554
&lt;/span>&lt;span class="lnt"> 555
&lt;/span>&lt;span class="lnt"> 556
&lt;/span>&lt;span class="lnt"> 557
&lt;/span>&lt;span class="lnt"> 558
&lt;/span>&lt;span class="lnt"> 559
&lt;/span>&lt;span class="lnt"> 560
&lt;/span>&lt;span class="lnt"> 561
&lt;/span>&lt;span class="lnt"> 562
&lt;/span>&lt;span class="lnt"> 563
&lt;/span>&lt;span class="lnt"> 564
&lt;/span>&lt;span class="lnt"> 565
&lt;/span>&lt;span class="lnt"> 566
&lt;/span>&lt;span class="lnt"> 567
&lt;/span>&lt;span class="lnt"> 568
&lt;/span>&lt;span class="lnt"> 569
&lt;/span>&lt;span class="lnt"> 570
&lt;/span>&lt;span class="lnt"> 571
&lt;/span>&lt;span class="lnt"> 572
&lt;/span>&lt;span class="lnt"> 573
&lt;/span>&lt;span class="lnt"> 574
&lt;/span>&lt;span class="lnt"> 575
&lt;/span>&lt;span class="lnt"> 576
&lt;/span>&lt;span class="lnt"> 577
&lt;/span>&lt;span class="lnt"> 578
&lt;/span>&lt;span class="lnt"> 579
&lt;/span>&lt;span class="lnt"> 580
&lt;/span>&lt;span class="lnt"> 581
&lt;/span>&lt;span class="lnt"> 582
&lt;/span>&lt;span class="lnt"> 583
&lt;/span>&lt;span class="lnt"> 584
&lt;/span>&lt;span class="lnt"> 585
&lt;/span>&lt;span class="lnt"> 586
&lt;/span>&lt;span class="lnt"> 587
&lt;/span>&lt;span class="lnt"> 588
&lt;/span>&lt;span class="lnt"> 589
&lt;/span>&lt;span class="lnt"> 590
&lt;/span>&lt;span class="lnt"> 591
&lt;/span>&lt;span class="lnt"> 592
&lt;/span>&lt;span class="lnt"> 593
&lt;/span>&lt;span class="lnt"> 594
&lt;/span>&lt;span class="lnt"> 595
&lt;/span>&lt;span class="lnt"> 596
&lt;/span>&lt;span class="lnt"> 597
&lt;/span>&lt;span class="lnt"> 598
&lt;/span>&lt;span class="lnt"> 599
&lt;/span>&lt;span class="lnt"> 600
&lt;/span>&lt;span class="lnt"> 601
&lt;/span>&lt;span class="lnt"> 602
&lt;/span>&lt;span class="lnt"> 603
&lt;/span>&lt;span class="lnt"> 604
&lt;/span>&lt;span class="lnt"> 605
&lt;/span>&lt;span class="lnt"> 606
&lt;/span>&lt;span class="lnt"> 607
&lt;/span>&lt;span class="lnt"> 608
&lt;/span>&lt;span class="lnt"> 609
&lt;/span>&lt;span class="lnt"> 610
&lt;/span>&lt;span class="lnt"> 611
&lt;/span>&lt;span class="lnt"> 612
&lt;/span>&lt;span class="lnt"> 613
&lt;/span>&lt;span class="lnt"> 614
&lt;/span>&lt;span class="lnt"> 615
&lt;/span>&lt;span class="lnt"> 616
&lt;/span>&lt;span class="lnt"> 617
&lt;/span>&lt;span class="lnt"> 618
&lt;/span>&lt;span class="lnt"> 619
&lt;/span>&lt;span class="lnt"> 620
&lt;/span>&lt;span class="lnt"> 621
&lt;/span>&lt;span class="lnt"> 622
&lt;/span>&lt;span class="lnt"> 623
&lt;/span>&lt;span class="lnt"> 624
&lt;/span>&lt;span class="lnt"> 625
&lt;/span>&lt;span class="lnt"> 626
&lt;/span>&lt;span class="lnt"> 627
&lt;/span>&lt;span class="lnt"> 628
&lt;/span>&lt;span class="lnt"> 629
&lt;/span>&lt;span class="lnt"> 630
&lt;/span>&lt;span class="lnt"> 631
&lt;/span>&lt;span class="lnt"> 632
&lt;/span>&lt;span class="lnt"> 633
&lt;/span>&lt;span class="lnt"> 634
&lt;/span>&lt;span class="lnt"> 635
&lt;/span>&lt;span class="lnt"> 636
&lt;/span>&lt;span class="lnt"> 637
&lt;/span>&lt;span class="lnt"> 638
&lt;/span>&lt;span class="lnt"> 639
&lt;/span>&lt;span class="lnt"> 640
&lt;/span>&lt;span class="lnt"> 641
&lt;/span>&lt;span class="lnt"> 642
&lt;/span>&lt;span class="lnt"> 643
&lt;/span>&lt;span class="lnt"> 644
&lt;/span>&lt;span class="lnt"> 645
&lt;/span>&lt;span class="lnt"> 646
&lt;/span>&lt;span class="lnt"> 647
&lt;/span>&lt;span class="lnt"> 648
&lt;/span>&lt;span class="lnt"> 649
&lt;/span>&lt;span class="lnt"> 650
&lt;/span>&lt;span class="lnt"> 651
&lt;/span>&lt;span class="lnt"> 652
&lt;/span>&lt;span class="lnt"> 653
&lt;/span>&lt;span class="lnt"> 654
&lt;/span>&lt;span class="lnt"> 655
&lt;/span>&lt;span class="lnt"> 656
&lt;/span>&lt;span class="lnt"> 657
&lt;/span>&lt;span class="lnt"> 658
&lt;/span>&lt;span class="lnt"> 659
&lt;/span>&lt;span class="lnt"> 660
&lt;/span>&lt;span class="lnt"> 661
&lt;/span>&lt;span class="lnt"> 662
&lt;/span>&lt;span class="lnt"> 663
&lt;/span>&lt;span class="lnt"> 664
&lt;/span>&lt;span class="lnt"> 665
&lt;/span>&lt;span class="lnt"> 666
&lt;/span>&lt;span class="lnt"> 667
&lt;/span>&lt;span class="lnt"> 668
&lt;/span>&lt;span class="lnt"> 669
&lt;/span>&lt;span class="lnt"> 670
&lt;/span>&lt;span class="lnt"> 671
&lt;/span>&lt;span class="lnt"> 672
&lt;/span>&lt;span class="lnt"> 673
&lt;/span>&lt;span class="lnt"> 674
&lt;/span>&lt;span class="lnt"> 675
&lt;/span>&lt;span class="lnt"> 676
&lt;/span>&lt;span class="lnt"> 677
&lt;/span>&lt;span class="lnt"> 678
&lt;/span>&lt;span class="lnt"> 679
&lt;/span>&lt;span class="lnt"> 680
&lt;/span>&lt;span class="lnt"> 681
&lt;/span>&lt;span class="lnt"> 682
&lt;/span>&lt;span class="lnt"> 683
&lt;/span>&lt;span class="lnt"> 684
&lt;/span>&lt;span class="lnt"> 685
&lt;/span>&lt;span class="lnt"> 686
&lt;/span>&lt;span class="lnt"> 687
&lt;/span>&lt;span class="lnt"> 688
&lt;/span>&lt;span class="lnt"> 689
&lt;/span>&lt;span class="lnt"> 690
&lt;/span>&lt;span class="lnt"> 691
&lt;/span>&lt;span class="lnt"> 692
&lt;/span>&lt;span class="lnt"> 693
&lt;/span>&lt;span class="lnt"> 694
&lt;/span>&lt;span class="lnt"> 695
&lt;/span>&lt;span class="lnt"> 696
&lt;/span>&lt;span class="lnt"> 697
&lt;/span>&lt;span class="lnt"> 698
&lt;/span>&lt;span class="lnt"> 699
&lt;/span>&lt;span class="lnt"> 700
&lt;/span>&lt;span class="lnt"> 701
&lt;/span>&lt;span class="lnt"> 702
&lt;/span>&lt;span class="lnt"> 703
&lt;/span>&lt;span class="lnt"> 704
&lt;/span>&lt;span class="lnt"> 705
&lt;/span>&lt;span class="lnt"> 706
&lt;/span>&lt;span class="lnt"> 707
&lt;/span>&lt;span class="lnt"> 708
&lt;/span>&lt;span class="lnt"> 709
&lt;/span>&lt;span class="lnt"> 710
&lt;/span>&lt;span class="lnt"> 711
&lt;/span>&lt;span class="lnt"> 712
&lt;/span>&lt;span class="lnt"> 713
&lt;/span>&lt;span class="lnt"> 714
&lt;/span>&lt;span class="lnt"> 715
&lt;/span>&lt;span class="lnt"> 716
&lt;/span>&lt;span class="lnt"> 717
&lt;/span>&lt;span class="lnt"> 718
&lt;/span>&lt;span class="lnt"> 719
&lt;/span>&lt;span class="lnt"> 720
&lt;/span>&lt;span class="lnt"> 721
&lt;/span>&lt;span class="lnt"> 722
&lt;/span>&lt;span class="lnt"> 723
&lt;/span>&lt;span class="lnt"> 724
&lt;/span>&lt;span class="lnt"> 725
&lt;/span>&lt;span class="lnt"> 726
&lt;/span>&lt;span class="lnt"> 727
&lt;/span>&lt;span class="lnt"> 728
&lt;/span>&lt;span class="lnt"> 729
&lt;/span>&lt;span class="lnt"> 730
&lt;/span>&lt;span class="lnt"> 731
&lt;/span>&lt;span class="lnt"> 732
&lt;/span>&lt;span class="lnt"> 733
&lt;/span>&lt;span class="lnt"> 734
&lt;/span>&lt;span class="lnt"> 735
&lt;/span>&lt;span class="lnt"> 736
&lt;/span>&lt;span class="lnt"> 737
&lt;/span>&lt;span class="lnt"> 738
&lt;/span>&lt;span class="lnt"> 739
&lt;/span>&lt;span class="lnt"> 740
&lt;/span>&lt;span class="lnt"> 741
&lt;/span>&lt;span class="lnt"> 742
&lt;/span>&lt;span class="lnt"> 743
&lt;/span>&lt;span class="lnt"> 744
&lt;/span>&lt;span class="lnt"> 745
&lt;/span>&lt;span class="lnt"> 746
&lt;/span>&lt;span class="lnt"> 747
&lt;/span>&lt;span class="lnt"> 748
&lt;/span>&lt;span class="lnt"> 749
&lt;/span>&lt;span class="lnt"> 750
&lt;/span>&lt;span class="lnt"> 751
&lt;/span>&lt;span class="lnt"> 752
&lt;/span>&lt;span class="lnt"> 753
&lt;/span>&lt;span class="lnt"> 754
&lt;/span>&lt;span class="lnt"> 755
&lt;/span>&lt;span class="lnt"> 756
&lt;/span>&lt;span class="lnt"> 757
&lt;/span>&lt;span class="lnt"> 758
&lt;/span>&lt;span class="lnt"> 759
&lt;/span>&lt;span class="lnt"> 760
&lt;/span>&lt;span class="lnt"> 761
&lt;/span>&lt;span class="lnt"> 762
&lt;/span>&lt;span class="lnt"> 763
&lt;/span>&lt;span class="lnt"> 764
&lt;/span>&lt;span class="lnt"> 765
&lt;/span>&lt;span class="lnt"> 766
&lt;/span>&lt;span class="lnt"> 767
&lt;/span>&lt;span class="lnt"> 768
&lt;/span>&lt;span class="lnt"> 769
&lt;/span>&lt;span class="lnt"> 770
&lt;/span>&lt;span class="lnt"> 771
&lt;/span>&lt;span class="lnt"> 772
&lt;/span>&lt;span class="lnt"> 773
&lt;/span>&lt;span class="lnt"> 774
&lt;/span>&lt;span class="lnt"> 775
&lt;/span>&lt;span class="lnt"> 776
&lt;/span>&lt;span class="lnt"> 777
&lt;/span>&lt;span class="lnt"> 778
&lt;/span>&lt;span class="lnt"> 779
&lt;/span>&lt;span class="lnt"> 780
&lt;/span>&lt;span class="lnt"> 781
&lt;/span>&lt;span class="lnt"> 782
&lt;/span>&lt;span class="lnt"> 783
&lt;/span>&lt;span class="lnt"> 784
&lt;/span>&lt;span class="lnt"> 785
&lt;/span>&lt;span class="lnt"> 786
&lt;/span>&lt;span class="lnt"> 787
&lt;/span>&lt;span class="lnt"> 788
&lt;/span>&lt;span class="lnt"> 789
&lt;/span>&lt;span class="lnt"> 790
&lt;/span>&lt;span class="lnt"> 791
&lt;/span>&lt;span class="lnt"> 792
&lt;/span>&lt;span class="lnt"> 793
&lt;/span>&lt;span class="lnt"> 794
&lt;/span>&lt;span class="lnt"> 795
&lt;/span>&lt;span class="lnt"> 796
&lt;/span>&lt;span class="lnt"> 797
&lt;/span>&lt;span class="lnt"> 798
&lt;/span>&lt;span class="lnt"> 799
&lt;/span>&lt;span class="lnt"> 800
&lt;/span>&lt;span class="lnt"> 801
&lt;/span>&lt;span class="lnt"> 802
&lt;/span>&lt;span class="lnt"> 803
&lt;/span>&lt;span class="lnt"> 804
&lt;/span>&lt;span class="lnt"> 805
&lt;/span>&lt;span class="lnt"> 806
&lt;/span>&lt;span class="lnt"> 807
&lt;/span>&lt;span class="lnt"> 808
&lt;/span>&lt;span class="lnt"> 809
&lt;/span>&lt;span class="lnt"> 810
&lt;/span>&lt;span class="lnt"> 811
&lt;/span>&lt;span class="lnt"> 812
&lt;/span>&lt;span class="lnt"> 813
&lt;/span>&lt;span class="lnt"> 814
&lt;/span>&lt;span class="lnt"> 815
&lt;/span>&lt;span class="lnt"> 816
&lt;/span>&lt;span class="lnt"> 817
&lt;/span>&lt;span class="lnt"> 818
&lt;/span>&lt;span class="lnt"> 819
&lt;/span>&lt;span class="lnt"> 820
&lt;/span>&lt;span class="lnt"> 821
&lt;/span>&lt;span class="lnt"> 822
&lt;/span>&lt;span class="lnt"> 823
&lt;/span>&lt;span class="lnt"> 824
&lt;/span>&lt;span class="lnt"> 825
&lt;/span>&lt;span class="lnt"> 826
&lt;/span>&lt;span class="lnt"> 827
&lt;/span>&lt;span class="lnt"> 828
&lt;/span>&lt;span class="lnt"> 829
&lt;/span>&lt;span class="lnt"> 830
&lt;/span>&lt;span class="lnt"> 831
&lt;/span>&lt;span class="lnt"> 832
&lt;/span>&lt;span class="lnt"> 833
&lt;/span>&lt;span class="lnt"> 834
&lt;/span>&lt;span class="lnt"> 835
&lt;/span>&lt;span class="lnt"> 836
&lt;/span>&lt;span class="lnt"> 837
&lt;/span>&lt;span class="lnt"> 838
&lt;/span>&lt;span class="lnt"> 839
&lt;/span>&lt;span class="lnt"> 840
&lt;/span>&lt;span class="lnt"> 841
&lt;/span>&lt;span class="lnt"> 842
&lt;/span>&lt;span class="lnt"> 843
&lt;/span>&lt;span class="lnt"> 844
&lt;/span>&lt;span class="lnt"> 845
&lt;/span>&lt;span class="lnt"> 846
&lt;/span>&lt;span class="lnt"> 847
&lt;/span>&lt;span class="lnt"> 848
&lt;/span>&lt;span class="lnt"> 849
&lt;/span>&lt;span class="lnt"> 850
&lt;/span>&lt;span class="lnt"> 851
&lt;/span>&lt;span class="lnt"> 852
&lt;/span>&lt;span class="lnt"> 853
&lt;/span>&lt;span class="lnt"> 854
&lt;/span>&lt;span class="lnt"> 855
&lt;/span>&lt;span class="lnt"> 856
&lt;/span>&lt;span class="lnt"> 857
&lt;/span>&lt;span class="lnt"> 858
&lt;/span>&lt;span class="lnt"> 859
&lt;/span>&lt;span class="lnt"> 860
&lt;/span>&lt;span class="lnt"> 861
&lt;/span>&lt;span class="lnt"> 862
&lt;/span>&lt;span class="lnt"> 863
&lt;/span>&lt;span class="lnt"> 864
&lt;/span>&lt;span class="lnt"> 865
&lt;/span>&lt;span class="lnt"> 866
&lt;/span>&lt;span class="lnt"> 867
&lt;/span>&lt;span class="lnt"> 868
&lt;/span>&lt;span class="lnt"> 869
&lt;/span>&lt;span class="lnt"> 870
&lt;/span>&lt;span class="lnt"> 871
&lt;/span>&lt;span class="lnt"> 872
&lt;/span>&lt;span class="lnt"> 873
&lt;/span>&lt;span class="lnt"> 874
&lt;/span>&lt;span class="lnt"> 875
&lt;/span>&lt;span class="lnt"> 876
&lt;/span>&lt;span class="lnt"> 877
&lt;/span>&lt;span class="lnt"> 878
&lt;/span>&lt;span class="lnt"> 879
&lt;/span>&lt;span class="lnt"> 880
&lt;/span>&lt;span class="lnt"> 881
&lt;/span>&lt;span class="lnt"> 882
&lt;/span>&lt;span class="lnt"> 883
&lt;/span>&lt;span class="lnt"> 884
&lt;/span>&lt;span class="lnt"> 885
&lt;/span>&lt;span class="lnt"> 886
&lt;/span>&lt;span class="lnt"> 887
&lt;/span>&lt;span class="lnt"> 888
&lt;/span>&lt;span class="lnt"> 889
&lt;/span>&lt;span class="lnt"> 890
&lt;/span>&lt;span class="lnt"> 891
&lt;/span>&lt;span class="lnt"> 892
&lt;/span>&lt;span class="lnt"> 893
&lt;/span>&lt;span class="lnt"> 894
&lt;/span>&lt;span class="lnt"> 895
&lt;/span>&lt;span class="lnt"> 896
&lt;/span>&lt;span class="lnt"> 897
&lt;/span>&lt;span class="lnt"> 898
&lt;/span>&lt;span class="lnt"> 899
&lt;/span>&lt;span class="lnt"> 900
&lt;/span>&lt;span class="lnt"> 901
&lt;/span>&lt;span class="lnt"> 902
&lt;/span>&lt;span class="lnt"> 903
&lt;/span>&lt;span class="lnt"> 904
&lt;/span>&lt;span class="lnt"> 905
&lt;/span>&lt;span class="lnt"> 906
&lt;/span>&lt;span class="lnt"> 907
&lt;/span>&lt;span class="lnt"> 908
&lt;/span>&lt;span class="lnt"> 909
&lt;/span>&lt;span class="lnt"> 910
&lt;/span>&lt;span class="lnt"> 911
&lt;/span>&lt;span class="lnt"> 912
&lt;/span>&lt;span class="lnt"> 913
&lt;/span>&lt;span class="lnt"> 914
&lt;/span>&lt;span class="lnt"> 915
&lt;/span>&lt;span class="lnt"> 916
&lt;/span>&lt;span class="lnt"> 917
&lt;/span>&lt;span class="lnt"> 918
&lt;/span>&lt;span class="lnt"> 919
&lt;/span>&lt;span class="lnt"> 920
&lt;/span>&lt;span class="lnt"> 921
&lt;/span>&lt;span class="lnt"> 922
&lt;/span>&lt;span class="lnt"> 923
&lt;/span>&lt;span class="lnt"> 924
&lt;/span>&lt;span class="lnt"> 925
&lt;/span>&lt;span class="lnt"> 926
&lt;/span>&lt;span class="lnt"> 927
&lt;/span>&lt;span class="lnt"> 928
&lt;/span>&lt;span class="lnt"> 929
&lt;/span>&lt;span class="lnt"> 930
&lt;/span>&lt;span class="lnt"> 931
&lt;/span>&lt;span class="lnt"> 932
&lt;/span>&lt;span class="lnt"> 933
&lt;/span>&lt;span class="lnt"> 934
&lt;/span>&lt;span class="lnt"> 935
&lt;/span>&lt;span class="lnt"> 936
&lt;/span>&lt;span class="lnt"> 937
&lt;/span>&lt;span class="lnt"> 938
&lt;/span>&lt;span class="lnt"> 939
&lt;/span>&lt;span class="lnt"> 940
&lt;/span>&lt;span class="lnt"> 941
&lt;/span>&lt;span class="lnt"> 942
&lt;/span>&lt;span class="lnt"> 943
&lt;/span>&lt;span class="lnt"> 944
&lt;/span>&lt;span class="lnt"> 945
&lt;/span>&lt;span class="lnt"> 946
&lt;/span>&lt;span class="lnt"> 947
&lt;/span>&lt;span class="lnt"> 948
&lt;/span>&lt;span class="lnt"> 949
&lt;/span>&lt;span class="lnt"> 950
&lt;/span>&lt;span class="lnt"> 951
&lt;/span>&lt;span class="lnt"> 952
&lt;/span>&lt;span class="lnt"> 953
&lt;/span>&lt;span class="lnt"> 954
&lt;/span>&lt;span class="lnt"> 955
&lt;/span>&lt;span class="lnt"> 956
&lt;/span>&lt;span class="lnt"> 957
&lt;/span>&lt;span class="lnt"> 958
&lt;/span>&lt;span class="lnt"> 959
&lt;/span>&lt;span class="lnt"> 960
&lt;/span>&lt;span class="lnt"> 961
&lt;/span>&lt;span class="lnt"> 962
&lt;/span>&lt;span class="lnt"> 963
&lt;/span>&lt;span class="lnt"> 964
&lt;/span>&lt;span class="lnt"> 965
&lt;/span>&lt;span class="lnt"> 966
&lt;/span>&lt;span class="lnt"> 967
&lt;/span>&lt;span class="lnt"> 968
&lt;/span>&lt;span class="lnt"> 969
&lt;/span>&lt;span class="lnt"> 970
&lt;/span>&lt;span class="lnt"> 971
&lt;/span>&lt;span class="lnt"> 972
&lt;/span>&lt;span class="lnt"> 973
&lt;/span>&lt;span class="lnt"> 974
&lt;/span>&lt;span class="lnt"> 975
&lt;/span>&lt;span class="lnt"> 976
&lt;/span>&lt;span class="lnt"> 977
&lt;/span>&lt;span class="lnt"> 978
&lt;/span>&lt;span class="lnt"> 979
&lt;/span>&lt;span class="lnt"> 980
&lt;/span>&lt;span class="lnt"> 981
&lt;/span>&lt;span class="lnt"> 982
&lt;/span>&lt;span class="lnt"> 983
&lt;/span>&lt;span class="lnt"> 984
&lt;/span>&lt;span class="lnt"> 985
&lt;/span>&lt;span class="lnt"> 986
&lt;/span>&lt;span class="lnt"> 987
&lt;/span>&lt;span class="lnt"> 988
&lt;/span>&lt;span class="lnt"> 989
&lt;/span>&lt;span class="lnt"> 990
&lt;/span>&lt;span class="lnt"> 991
&lt;/span>&lt;span class="lnt"> 992
&lt;/span>&lt;span class="lnt"> 993
&lt;/span>&lt;span class="lnt"> 994
&lt;/span>&lt;span class="lnt"> 995
&lt;/span>&lt;span class="lnt"> 996
&lt;/span>&lt;span class="lnt"> 997
&lt;/span>&lt;span class="lnt"> 998
&lt;/span>&lt;span class="lnt"> 999
&lt;/span>&lt;span class="lnt">1000
&lt;/span>&lt;span class="lnt">1001
&lt;/span>&lt;span class="lnt">1002
&lt;/span>&lt;span class="lnt">1003
&lt;/span>&lt;span class="lnt">1004
&lt;/span>&lt;span class="lnt">1005
&lt;/span>&lt;span class="lnt">1006
&lt;/span>&lt;span class="lnt">1007
&lt;/span>&lt;span class="lnt">1008
&lt;/span>&lt;span class="lnt">1009
&lt;/span>&lt;span class="lnt">1010
&lt;/span>&lt;span class="lnt">1011
&lt;/span>&lt;span class="lnt">1012
&lt;/span>&lt;span class="lnt">1013
&lt;/span>&lt;span class="lnt">1014
&lt;/span>&lt;span class="lnt">1015
&lt;/span>&lt;span class="lnt">1016
&lt;/span>&lt;span class="lnt">1017
&lt;/span>&lt;span class="lnt">1018
&lt;/span>&lt;span class="lnt">1019
&lt;/span>&lt;span class="lnt">1020
&lt;/span>&lt;span class="lnt">1021
&lt;/span>&lt;span class="lnt">1022
&lt;/span>&lt;span class="lnt">1023
&lt;/span>&lt;span class="lnt">1024
&lt;/span>&lt;span class="lnt">1025
&lt;/span>&lt;span class="lnt">1026
&lt;/span>&lt;span class="lnt">1027
&lt;/span>&lt;span class="lnt">1028
&lt;/span>&lt;span class="lnt">1029
&lt;/span>&lt;span class="lnt">1030
&lt;/span>&lt;span class="lnt">1031
&lt;/span>&lt;span class="lnt">1032
&lt;/span>&lt;span class="lnt">1033
&lt;/span>&lt;span class="lnt">1034
&lt;/span>&lt;span class="lnt">1035
&lt;/span>&lt;span class="lnt">1036
&lt;/span>&lt;span class="lnt">1037
&lt;/span>&lt;span class="lnt">1038
&lt;/span>&lt;span class="lnt">1039
&lt;/span>&lt;span class="lnt">1040
&lt;/span>&lt;span class="lnt">1041
&lt;/span>&lt;span class="lnt">1042
&lt;/span>&lt;span class="lnt">1043
&lt;/span>&lt;span class="lnt">1044
&lt;/span>&lt;span class="lnt">1045
&lt;/span>&lt;span class="lnt">1046
&lt;/span>&lt;span class="lnt">1047
&lt;/span>&lt;span class="lnt">1048
&lt;/span>&lt;span class="lnt">1049
&lt;/span>&lt;span class="lnt">1050
&lt;/span>&lt;span class="lnt">1051
&lt;/span>&lt;span class="lnt">1052
&lt;/span>&lt;span class="lnt">1053
&lt;/span>&lt;span class="lnt">1054
&lt;/span>&lt;span class="lnt">1055
&lt;/span>&lt;span class="lnt">1056
&lt;/span>&lt;span class="lnt">1057
&lt;/span>&lt;span class="lnt">1058
&lt;/span>&lt;span class="lnt">1059
&lt;/span>&lt;span class="lnt">1060
&lt;/span>&lt;span class="lnt">1061
&lt;/span>&lt;span class="lnt">1062
&lt;/span>&lt;span class="lnt">1063
&lt;/span>&lt;span class="lnt">1064
&lt;/span>&lt;span class="lnt">1065
&lt;/span>&lt;span class="lnt">1066
&lt;/span>&lt;span class="lnt">1067
&lt;/span>&lt;span class="lnt">1068
&lt;/span>&lt;span class="lnt">1069
&lt;/span>&lt;span class="lnt">1070
&lt;/span>&lt;span class="lnt">1071
&lt;/span>&lt;span class="lnt">1072
&lt;/span>&lt;span class="lnt">1073
&lt;/span>&lt;span class="lnt">1074
&lt;/span>&lt;span class="lnt">1075
&lt;/span>&lt;span class="lnt">1076
&lt;/span>&lt;span class="lnt">1077
&lt;/span>&lt;span class="lnt">1078
&lt;/span>&lt;span class="lnt">1079
&lt;/span>&lt;span class="lnt">1080
&lt;/span>&lt;span class="lnt">1081
&lt;/span>&lt;span class="lnt">1082
&lt;/span>&lt;span class="lnt">1083
&lt;/span>&lt;span class="lnt">1084
&lt;/span>&lt;span class="lnt">1085
&lt;/span>&lt;span class="lnt">1086
&lt;/span>&lt;span class="lnt">1087
&lt;/span>&lt;span class="lnt">1088
&lt;/span>&lt;span class="lnt">1089
&lt;/span>&lt;span class="lnt">1090
&lt;/span>&lt;span class="lnt">1091
&lt;/span>&lt;span class="lnt">1092
&lt;/span>&lt;span class="lnt">1093
&lt;/span>&lt;span class="lnt">1094
&lt;/span>&lt;span class="lnt">1095
&lt;/span>&lt;span class="lnt">1096
&lt;/span>&lt;span class="lnt">1097
&lt;/span>&lt;span class="lnt">1098
&lt;/span>&lt;span class="lnt">1099
&lt;/span>&lt;span class="lnt">1100
&lt;/span>&lt;span class="lnt">1101
&lt;/span>&lt;span class="lnt">1102
&lt;/span>&lt;span class="lnt">1103
&lt;/span>&lt;span class="lnt">1104
&lt;/span>&lt;span class="lnt">1105
&lt;/span>&lt;span class="lnt">1106
&lt;/span>&lt;span class="lnt">1107
&lt;/span>&lt;span class="lnt">1108
&lt;/span>&lt;span class="lnt">1109
&lt;/span>&lt;span class="lnt">1110
&lt;/span>&lt;span class="lnt">1111
&lt;/span>&lt;span class="lnt">1112
&lt;/span>&lt;span class="lnt">1113
&lt;/span>&lt;span class="lnt">1114
&lt;/span>&lt;span class="lnt">1115
&lt;/span>&lt;span class="lnt">1116
&lt;/span>&lt;span class="lnt">1117
&lt;/span>&lt;span class="lnt">1118
&lt;/span>&lt;span class="lnt">1119
&lt;/span>&lt;span class="lnt">1120
&lt;/span>&lt;span class="lnt">1121
&lt;/span>&lt;span class="lnt">1122
&lt;/span>&lt;span class="lnt">1123
&lt;/span>&lt;span class="lnt">1124
&lt;/span>&lt;span class="lnt">1125
&lt;/span>&lt;span class="lnt">1126
&lt;/span>&lt;span class="lnt">1127
&lt;/span>&lt;span class="lnt">1128
&lt;/span>&lt;span class="lnt">1129
&lt;/span>&lt;span class="lnt">1130
&lt;/span>&lt;span class="lnt">1131
&lt;/span>&lt;span class="lnt">1132
&lt;/span>&lt;span class="lnt">1133
&lt;/span>&lt;span class="lnt">1134
&lt;/span>&lt;span class="lnt">1135
&lt;/span>&lt;span class="lnt">1136
&lt;/span>&lt;span class="lnt">1137
&lt;/span>&lt;span class="lnt">1138
&lt;/span>&lt;span class="lnt">1139
&lt;/span>&lt;span class="lnt">1140
&lt;/span>&lt;span class="lnt">1141
&lt;/span>&lt;span class="lnt">1142
&lt;/span>&lt;span class="lnt">1143
&lt;/span>&lt;span class="lnt">1144
&lt;/span>&lt;span class="lnt">1145
&lt;/span>&lt;span class="lnt">1146
&lt;/span>&lt;span class="lnt">1147
&lt;/span>&lt;span class="lnt">1148
&lt;/span>&lt;span class="lnt">1149
&lt;/span>&lt;span class="lnt">1150
&lt;/span>&lt;span class="lnt">1151
&lt;/span>&lt;span class="lnt">1152
&lt;/span>&lt;span class="lnt">1153
&lt;/span>&lt;span class="lnt">1154
&lt;/span>&lt;span class="lnt">1155
&lt;/span>&lt;span class="lnt">1156
&lt;/span>&lt;span class="lnt">1157
&lt;/span>&lt;span class="lnt">1158
&lt;/span>&lt;span class="lnt">1159
&lt;/span>&lt;span class="lnt">1160
&lt;/span>&lt;span class="lnt">1161
&lt;/span>&lt;span class="lnt">1162
&lt;/span>&lt;span class="lnt">1163
&lt;/span>&lt;span class="lnt">1164
&lt;/span>&lt;span class="lnt">1165
&lt;/span>&lt;span class="lnt">1166
&lt;/span>&lt;span class="lnt">1167
&lt;/span>&lt;span class="lnt">1168
&lt;/span>&lt;span class="lnt">1169
&lt;/span>&lt;span class="lnt">1170
&lt;/span>&lt;span class="lnt">1171
&lt;/span>&lt;span class="lnt">1172
&lt;/span>&lt;span class="lnt">1173
&lt;/span>&lt;span class="lnt">1174
&lt;/span>&lt;span class="lnt">1175
&lt;/span>&lt;span class="lnt">1176
&lt;/span>&lt;span class="lnt">1177
&lt;/span>&lt;span class="lnt">1178
&lt;/span>&lt;span class="lnt">1179
&lt;/span>&lt;span class="lnt">1180
&lt;/span>&lt;span class="lnt">1181
&lt;/span>&lt;span class="lnt">1182
&lt;/span>&lt;span class="lnt">1183
&lt;/span>&lt;span class="lnt">1184
&lt;/span>&lt;span class="lnt">1185
&lt;/span>&lt;span class="lnt">1186
&lt;/span>&lt;span class="lnt">1187
&lt;/span>&lt;span class="lnt">1188
&lt;/span>&lt;span class="lnt">1189
&lt;/span>&lt;span class="lnt">1190
&lt;/span>&lt;span class="lnt">1191
&lt;/span>&lt;span class="lnt">1192
&lt;/span>&lt;span class="lnt">1193
&lt;/span>&lt;span class="lnt">1194
&lt;/span>&lt;span class="lnt">1195
&lt;/span>&lt;span class="lnt">1196
&lt;/span>&lt;span class="lnt">1197
&lt;/span>&lt;span class="lnt">1198
&lt;/span>&lt;span class="lnt">1199
&lt;/span>&lt;span class="lnt">1200
&lt;/span>&lt;span class="lnt">1201
&lt;/span>&lt;span class="lnt">1202
&lt;/span>&lt;span class="lnt">1203
&lt;/span>&lt;span class="lnt">1204
&lt;/span>&lt;span class="lnt">1205
&lt;/span>&lt;span class="lnt">1206
&lt;/span>&lt;span class="lnt">1207
&lt;/span>&lt;span class="lnt">1208
&lt;/span>&lt;span class="lnt">1209
&lt;/span>&lt;span class="lnt">1210
&lt;/span>&lt;span class="lnt">1211
&lt;/span>&lt;span class="lnt">1212
&lt;/span>&lt;span class="lnt">1213
&lt;/span>&lt;span class="lnt">1214
&lt;/span>&lt;span class="lnt">1215
&lt;/span>&lt;span class="lnt">1216
&lt;/span>&lt;span class="lnt">1217
&lt;/span>&lt;span class="lnt">1218
&lt;/span>&lt;span class="lnt">1219
&lt;/span>&lt;span class="lnt">1220
&lt;/span>&lt;span class="lnt">1221
&lt;/span>&lt;span class="lnt">1222
&lt;/span>&lt;span class="lnt">1223
&lt;/span>&lt;span class="lnt">1224
&lt;/span>&lt;span class="lnt">1225
&lt;/span>&lt;span class="lnt">1226
&lt;/span>&lt;span class="lnt">1227
&lt;/span>&lt;span class="lnt">1228
&lt;/span>&lt;span class="lnt">1229
&lt;/span>&lt;span class="lnt">1230
&lt;/span>&lt;span class="lnt">1231
&lt;/span>&lt;span class="lnt">1232
&lt;/span>&lt;span class="lnt">1233
&lt;/span>&lt;span class="lnt">1234
&lt;/span>&lt;span class="lnt">1235
&lt;/span>&lt;span class="lnt">1236
&lt;/span>&lt;span class="lnt">1237
&lt;/span>&lt;span class="lnt">1238
&lt;/span>&lt;span class="lnt">1239
&lt;/span>&lt;span class="lnt">1240
&lt;/span>&lt;span class="lnt">1241
&lt;/span>&lt;span class="lnt">1242
&lt;/span>&lt;span class="lnt">1243
&lt;/span>&lt;span class="lnt">1244
&lt;/span>&lt;span class="lnt">1245
&lt;/span>&lt;span class="lnt">1246
&lt;/span>&lt;span class="lnt">1247
&lt;/span>&lt;span class="lnt">1248
&lt;/span>&lt;span class="lnt">1249
&lt;/span>&lt;span class="lnt">1250
&lt;/span>&lt;span class="lnt">1251
&lt;/span>&lt;span class="lnt">1252
&lt;/span>&lt;span class="lnt">1253
&lt;/span>&lt;span class="lnt">1254
&lt;/span>&lt;span class="lnt">1255
&lt;/span>&lt;span class="lnt">1256
&lt;/span>&lt;span class="lnt">1257
&lt;/span>&lt;span class="lnt">1258
&lt;/span>&lt;span class="lnt">1259
&lt;/span>&lt;span class="lnt">1260
&lt;/span>&lt;span class="lnt">1261
&lt;/span>&lt;span class="lnt">1262
&lt;/span>&lt;span class="lnt">1263
&lt;/span>&lt;span class="lnt">1264
&lt;/span>&lt;span class="lnt">1265
&lt;/span>&lt;span class="lnt">1266
&lt;/span>&lt;span class="lnt">1267
&lt;/span>&lt;span class="lnt">1268
&lt;/span>&lt;span class="lnt">1269
&lt;/span>&lt;span class="lnt">1270
&lt;/span>&lt;span class="lnt">1271
&lt;/span>&lt;span class="lnt">1272
&lt;/span>&lt;span class="lnt">1273
&lt;/span>&lt;span class="lnt">1274
&lt;/span>&lt;span class="lnt">1275
&lt;/span>&lt;span class="lnt">1276
&lt;/span>&lt;span class="lnt">1277
&lt;/span>&lt;span class="lnt">1278
&lt;/span>&lt;span class="lnt">1279
&lt;/span>&lt;span class="lnt">1280
&lt;/span>&lt;span class="lnt">1281
&lt;/span>&lt;span class="lnt">1282
&lt;/span>&lt;span class="lnt">1283
&lt;/span>&lt;span class="lnt">1284
&lt;/span>&lt;span class="lnt">1285
&lt;/span>&lt;span class="lnt">1286
&lt;/span>&lt;span class="lnt">1287
&lt;/span>&lt;span class="lnt">1288
&lt;/span>&lt;span class="lnt">1289
&lt;/span>&lt;span class="lnt">1290
&lt;/span>&lt;span class="lnt">1291
&lt;/span>&lt;span class="lnt">1292
&lt;/span>&lt;span class="lnt">1293
&lt;/span>&lt;span class="lnt">1294
&lt;/span>&lt;span class="lnt">1295
&lt;/span>&lt;span class="lnt">1296
&lt;/span>&lt;span class="lnt">1297
&lt;/span>&lt;span class="lnt">1298
&lt;/span>&lt;span class="lnt">1299
&lt;/span>&lt;span class="lnt">1300
&lt;/span>&lt;span class="lnt">1301
&lt;/span>&lt;span class="lnt">1302
&lt;/span>&lt;span class="lnt">1303
&lt;/span>&lt;span class="lnt">1304
&lt;/span>&lt;span class="lnt">1305
&lt;/span>&lt;span class="lnt">1306
&lt;/span>&lt;span class="lnt">1307
&lt;/span>&lt;span class="lnt">1308
&lt;/span>&lt;span class="lnt">1309
&lt;/span>&lt;span class="lnt">1310
&lt;/span>&lt;span class="lnt">1311
&lt;/span>&lt;span class="lnt">1312
&lt;/span>&lt;span class="lnt">1313
&lt;/span>&lt;span class="lnt">1314
&lt;/span>&lt;span class="lnt">1315
&lt;/span>&lt;span class="lnt">1316
&lt;/span>&lt;span class="lnt">1317
&lt;/span>&lt;span class="lnt">1318
&lt;/span>&lt;span class="lnt">1319
&lt;/span>&lt;span class="lnt">1320
&lt;/span>&lt;span class="lnt">1321
&lt;/span>&lt;span class="lnt">1322
&lt;/span>&lt;span class="lnt">1323
&lt;/span>&lt;span class="lnt">1324
&lt;/span>&lt;span class="lnt">1325
&lt;/span>&lt;span class="lnt">1326
&lt;/span>&lt;span class="lnt">1327
&lt;/span>&lt;span class="lnt">1328
&lt;/span>&lt;span class="lnt">1329
&lt;/span>&lt;span class="lnt">1330
&lt;/span>&lt;span class="lnt">1331
&lt;/span>&lt;span class="lnt">1332
&lt;/span>&lt;span class="lnt">1333
&lt;/span>&lt;span class="lnt">1334
&lt;/span>&lt;span class="lnt">1335
&lt;/span>&lt;span class="lnt">1336
&lt;/span>&lt;span class="lnt">1337
&lt;/span>&lt;span class="lnt">1338
&lt;/span>&lt;span class="lnt">1339
&lt;/span>&lt;span class="lnt">1340
&lt;/span>&lt;span class="lnt">1341
&lt;/span>&lt;span class="lnt">1342
&lt;/span>&lt;span class="lnt">1343
&lt;/span>&lt;span class="lnt">1344
&lt;/span>&lt;span class="lnt">1345
&lt;/span>&lt;span class="lnt">1346
&lt;/span>&lt;span class="lnt">1347
&lt;/span>&lt;span class="lnt">1348
&lt;/span>&lt;span class="lnt">1349
&lt;/span>&lt;span class="lnt">1350
&lt;/span>&lt;span class="lnt">1351
&lt;/span>&lt;span class="lnt">1352
&lt;/span>&lt;span class="lnt">1353
&lt;/span>&lt;span class="lnt">1354
&lt;/span>&lt;span class="lnt">1355
&lt;/span>&lt;span class="lnt">1356
&lt;/span>&lt;span class="lnt">1357
&lt;/span>&lt;span class="lnt">1358
&lt;/span>&lt;span class="lnt">1359
&lt;/span>&lt;span class="lnt">1360
&lt;/span>&lt;span class="lnt">1361
&lt;/span>&lt;span class="lnt">1362
&lt;/span>&lt;span class="lnt">1363
&lt;/span>&lt;span class="lnt">1364
&lt;/span>&lt;span class="lnt">1365
&lt;/span>&lt;span class="lnt">1366
&lt;/span>&lt;span class="lnt">1367
&lt;/span>&lt;span class="lnt">1368
&lt;/span>&lt;span class="lnt">1369
&lt;/span>&lt;span class="lnt">1370
&lt;/span>&lt;span class="lnt">1371
&lt;/span>&lt;span class="lnt">1372
&lt;/span>&lt;span class="lnt">1373
&lt;/span>&lt;span class="lnt">1374
&lt;/span>&lt;span class="lnt">1375
&lt;/span>&lt;span class="lnt">1376
&lt;/span>&lt;span class="lnt">1377
&lt;/span>&lt;span class="lnt">1378
&lt;/span>&lt;span class="lnt">1379
&lt;/span>&lt;span class="lnt">1380
&lt;/span>&lt;span class="lnt">1381
&lt;/span>&lt;span class="lnt">1382
&lt;/span>&lt;span class="lnt">1383
&lt;/span>&lt;span class="lnt">1384
&lt;/span>&lt;span class="lnt">1385
&lt;/span>&lt;span class="lnt">1386
&lt;/span>&lt;span class="lnt">1387
&lt;/span>&lt;span class="lnt">1388
&lt;/span>&lt;span class="lnt">1389
&lt;/span>&lt;span class="lnt">1390
&lt;/span>&lt;span class="lnt">1391
&lt;/span>&lt;span class="lnt">1392
&lt;/span>&lt;span class="lnt">1393
&lt;/span>&lt;span class="lnt">1394
&lt;/span>&lt;span class="lnt">1395
&lt;/span>&lt;span class="lnt">1396
&lt;/span>&lt;span class="lnt">1397
&lt;/span>&lt;span class="lnt">1398
&lt;/span>&lt;span class="lnt">1399
&lt;/span>&lt;span class="lnt">1400
&lt;/span>&lt;span class="lnt">1401
&lt;/span>&lt;span class="lnt">1402
&lt;/span>&lt;span class="lnt">1403
&lt;/span>&lt;span class="lnt">1404
&lt;/span>&lt;span class="lnt">1405
&lt;/span>&lt;span class="lnt">1406
&lt;/span>&lt;span class="lnt">1407
&lt;/span>&lt;span class="lnt">1408
&lt;/span>&lt;span class="lnt">1409
&lt;/span>&lt;span class="lnt">1410
&lt;/span>&lt;span class="lnt">1411
&lt;/span>&lt;span class="lnt">1412
&lt;/span>&lt;span class="lnt">1413
&lt;/span>&lt;span class="lnt">1414
&lt;/span>&lt;span class="lnt">1415
&lt;/span>&lt;span class="lnt">1416
&lt;/span>&lt;span class="lnt">1417
&lt;/span>&lt;span class="lnt">1418
&lt;/span>&lt;span class="lnt">1419
&lt;/span>&lt;span class="lnt">1420
&lt;/span>&lt;span class="lnt">1421
&lt;/span>&lt;span class="lnt">1422
&lt;/span>&lt;span class="lnt">1423
&lt;/span>&lt;span class="lnt">1424
&lt;/span>&lt;span class="lnt">1425
&lt;/span>&lt;span class="lnt">1426
&lt;/span>&lt;span class="lnt">1427
&lt;/span>&lt;span class="lnt">1428
&lt;/span>&lt;span class="lnt">1429
&lt;/span>&lt;span class="lnt">1430
&lt;/span>&lt;span class="lnt">1431
&lt;/span>&lt;span class="lnt">1432
&lt;/span>&lt;span class="lnt">1433
&lt;/span>&lt;span class="lnt">1434
&lt;/span>&lt;span class="lnt">1435
&lt;/span>&lt;span class="lnt">1436
&lt;/span>&lt;span class="lnt">1437
&lt;/span>&lt;span class="lnt">1438
&lt;/span>&lt;span class="lnt">1439
&lt;/span>&lt;span class="lnt">1440
&lt;/span>&lt;span class="lnt">1441
&lt;/span>&lt;span class="lnt">1442
&lt;/span>&lt;span class="lnt">1443
&lt;/span>&lt;span class="lnt">1444
&lt;/span>&lt;span class="lnt">1445
&lt;/span>&lt;span class="lnt">1446
&lt;/span>&lt;span class="lnt">1447
&lt;/span>&lt;span class="lnt">1448
&lt;/span>&lt;span class="lnt">1449
&lt;/span>&lt;span class="lnt">1450
&lt;/span>&lt;span class="lnt">1451
&lt;/span>&lt;span class="lnt">1452
&lt;/span>&lt;span class="lnt">1453
&lt;/span>&lt;span class="lnt">1454
&lt;/span>&lt;span class="lnt">1455
&lt;/span>&lt;span class="lnt">1456
&lt;/span>&lt;span class="lnt">1457
&lt;/span>&lt;span class="lnt">1458
&lt;/span>&lt;span class="lnt">1459
&lt;/span>&lt;span class="lnt">1460
&lt;/span>&lt;span class="lnt">1461
&lt;/span>&lt;span class="lnt">1462
&lt;/span>&lt;span class="lnt">1463
&lt;/span>&lt;span class="lnt">1464
&lt;/span>&lt;span class="lnt">1465
&lt;/span>&lt;span class="lnt">1466
&lt;/span>&lt;span class="lnt">1467
&lt;/span>&lt;span class="lnt">1468
&lt;/span>&lt;span class="lnt">1469
&lt;/span>&lt;span class="lnt">1470
&lt;/span>&lt;span class="lnt">1471
&lt;/span>&lt;span class="lnt">1472
&lt;/span>&lt;span class="lnt">1473
&lt;/span>&lt;span class="lnt">1474
&lt;/span>&lt;span class="lnt">1475
&lt;/span>&lt;span class="lnt">1476
&lt;/span>&lt;span class="lnt">1477
&lt;/span>&lt;span class="lnt">1478
&lt;/span>&lt;span class="lnt">1479
&lt;/span>&lt;span class="lnt">1480
&lt;/span>&lt;span class="lnt">1481
&lt;/span>&lt;span class="lnt">1482
&lt;/span>&lt;span class="lnt">1483
&lt;/span>&lt;span class="lnt">1484
&lt;/span>&lt;span class="lnt">1485
&lt;/span>&lt;span class="lnt">1486
&lt;/span>&lt;span class="lnt">1487
&lt;/span>&lt;span class="lnt">1488
&lt;/span>&lt;span class="lnt">1489
&lt;/span>&lt;span class="lnt">1490
&lt;/span>&lt;span class="lnt">1491
&lt;/span>&lt;span class="lnt">1492
&lt;/span>&lt;span class="lnt">1493
&lt;/span>&lt;span class="lnt">1494
&lt;/span>&lt;span class="lnt">1495
&lt;/span>&lt;span class="lnt">1496
&lt;/span>&lt;span class="lnt">1497
&lt;/span>&lt;span class="lnt">1498
&lt;/span>&lt;span class="lnt">1499
&lt;/span>&lt;span class="lnt">1500
&lt;/span>&lt;span class="lnt">1501
&lt;/span>&lt;span class="lnt">1502
&lt;/span>&lt;span class="lnt">1503
&lt;/span>&lt;span class="lnt">1504
&lt;/span>&lt;span class="lnt">1505
&lt;/span>&lt;span class="lnt">1506
&lt;/span>&lt;span class="lnt">1507
&lt;/span>&lt;span class="lnt">1508
&lt;/span>&lt;span class="lnt">1509
&lt;/span>&lt;span class="lnt">1510
&lt;/span>&lt;span class="lnt">1511
&lt;/span>&lt;span class="lnt">1512
&lt;/span>&lt;span class="lnt">1513
&lt;/span>&lt;span class="lnt">1514
&lt;/span>&lt;span class="lnt">1515
&lt;/span>&lt;span class="lnt">1516
&lt;/span>&lt;span class="lnt">1517
&lt;/span>&lt;span class="lnt">1518
&lt;/span>&lt;span class="lnt">1519
&lt;/span>&lt;span class="lnt">1520
&lt;/span>&lt;span class="lnt">1521
&lt;/span>&lt;span class="lnt">1522
&lt;/span>&lt;span class="lnt">1523
&lt;/span>&lt;span class="lnt">1524
&lt;/span>&lt;span class="lnt">1525
&lt;/span>&lt;span class="lnt">1526
&lt;/span>&lt;span class="lnt">1527
&lt;/span>&lt;span class="lnt">1528
&lt;/span>&lt;span class="lnt">1529
&lt;/span>&lt;span class="lnt">1530
&lt;/span>&lt;span class="lnt">1531
&lt;/span>&lt;span class="lnt">1532
&lt;/span>&lt;span class="lnt">1533
&lt;/span>&lt;span class="lnt">1534
&lt;/span>&lt;span class="lnt">1535
&lt;/span>&lt;span class="lnt">1536
&lt;/span>&lt;span class="lnt">1537
&lt;/span>&lt;span class="lnt">1538
&lt;/span>&lt;span class="lnt">1539
&lt;/span>&lt;span class="lnt">1540
&lt;/span>&lt;span class="lnt">1541
&lt;/span>&lt;span class="lnt">1542
&lt;/span>&lt;span class="lnt">1543
&lt;/span>&lt;span class="lnt">1544
&lt;/span>&lt;span class="lnt">1545
&lt;/span>&lt;span class="lnt">1546
&lt;/span>&lt;span class="lnt">1547
&lt;/span>&lt;span class="lnt">1548
&lt;/span>&lt;span class="lnt">1549
&lt;/span>&lt;span class="lnt">1550
&lt;/span>&lt;span class="lnt">1551
&lt;/span>&lt;span class="lnt">1552
&lt;/span>&lt;span class="lnt">1553
&lt;/span>&lt;span class="lnt">1554
&lt;/span>&lt;span class="lnt">1555
&lt;/span>&lt;span class="lnt">1556
&lt;/span>&lt;span class="lnt">1557
&lt;/span>&lt;span class="lnt">1558
&lt;/span>&lt;span class="lnt">1559
&lt;/span>&lt;span class="lnt">1560
&lt;/span>&lt;span class="lnt">1561
&lt;/span>&lt;span class="lnt">1562
&lt;/span>&lt;span class="lnt">1563
&lt;/span>&lt;span class="lnt">1564
&lt;/span>&lt;span class="lnt">1565
&lt;/span>&lt;span class="lnt">1566
&lt;/span>&lt;span class="lnt">1567
&lt;/span>&lt;span class="lnt">1568
&lt;/span>&lt;span class="lnt">1569
&lt;/span>&lt;span class="lnt">1570
&lt;/span>&lt;span class="lnt">1571
&lt;/span>&lt;span class="lnt">1572
&lt;/span>&lt;span class="lnt">1573
&lt;/span>&lt;span class="lnt">1574
&lt;/span>&lt;span class="lnt">1575
&lt;/span>&lt;span class="lnt">1576
&lt;/span>&lt;span class="lnt">1577
&lt;/span>&lt;span class="lnt">1578
&lt;/span>&lt;span class="lnt">1579
&lt;/span>&lt;span class="lnt">1580
&lt;/span>&lt;span class="lnt">1581
&lt;/span>&lt;span class="lnt">1582
&lt;/span>&lt;span class="lnt">1583
&lt;/span>&lt;span class="lnt">1584
&lt;/span>&lt;span class="lnt">1585
&lt;/span>&lt;span class="lnt">1586
&lt;/span>&lt;span class="lnt">1587
&lt;/span>&lt;span class="lnt">1588
&lt;/span>&lt;span class="lnt">1589
&lt;/span>&lt;span class="lnt">1590
&lt;/span>&lt;span class="lnt">1591
&lt;/span>&lt;span class="lnt">1592
&lt;/span>&lt;span class="lnt">1593
&lt;/span>&lt;span class="lnt">1594
&lt;/span>&lt;span class="lnt">1595
&lt;/span>&lt;span class="lnt">1596
&lt;/span>&lt;span class="lnt">1597
&lt;/span>&lt;span class="lnt">1598
&lt;/span>&lt;span class="lnt">1599
&lt;/span>&lt;span class="lnt">1600
&lt;/span>&lt;span class="lnt">1601
&lt;/span>&lt;span class="lnt">1602
&lt;/span>&lt;span class="lnt">1603
&lt;/span>&lt;span class="lnt">1604
&lt;/span>&lt;span class="lnt">1605
&lt;/span>&lt;span class="lnt">1606
&lt;/span>&lt;span class="lnt">1607
&lt;/span>&lt;span class="lnt">1608
&lt;/span>&lt;span class="lnt">1609
&lt;/span>&lt;span class="lnt">1610
&lt;/span>&lt;span class="lnt">1611
&lt;/span>&lt;span class="lnt">1612
&lt;/span>&lt;span class="lnt">1613
&lt;/span>&lt;span class="lnt">1614
&lt;/span>&lt;span class="lnt">1615
&lt;/span>&lt;span class="lnt">1616
&lt;/span>&lt;span class="lnt">1617
&lt;/span>&lt;span class="lnt">1618
&lt;/span>&lt;span class="lnt">1619
&lt;/span>&lt;span class="lnt">1620
&lt;/span>&lt;span class="lnt">1621
&lt;/span>&lt;span class="lnt">1622
&lt;/span>&lt;span class="lnt">1623
&lt;/span>&lt;span class="lnt">1624
&lt;/span>&lt;span class="lnt">1625
&lt;/span>&lt;span class="lnt">1626
&lt;/span>&lt;span class="lnt">1627
&lt;/span>&lt;span class="lnt">1628
&lt;/span>&lt;span class="lnt">1629
&lt;/span>&lt;span class="lnt">1630
&lt;/span>&lt;span class="lnt">1631
&lt;/span>&lt;span class="lnt">1632
&lt;/span>&lt;span class="lnt">1633
&lt;/span>&lt;span class="lnt">1634
&lt;/span>&lt;span class="lnt">1635
&lt;/span>&lt;span class="lnt">1636
&lt;/span>&lt;span class="lnt">1637
&lt;/span>&lt;span class="lnt">1638
&lt;/span>&lt;span class="lnt">1639
&lt;/span>&lt;span class="lnt">1640
&lt;/span>&lt;span class="lnt">1641
&lt;/span>&lt;span class="lnt">1642
&lt;/span>&lt;span class="lnt">1643
&lt;/span>&lt;span class="lnt">1644
&lt;/span>&lt;span class="lnt">1645
&lt;/span>&lt;span class="lnt">1646
&lt;/span>&lt;span class="lnt">1647
&lt;/span>&lt;span class="lnt">1648
&lt;/span>&lt;span class="lnt">1649
&lt;/span>&lt;span class="lnt">1650
&lt;/span>&lt;span class="lnt">1651
&lt;/span>&lt;span class="lnt">1652
&lt;/span>&lt;span class="lnt">1653
&lt;/span>&lt;span class="lnt">1654
&lt;/span>&lt;span class="lnt">1655
&lt;/span>&lt;span class="lnt">1656
&lt;/span>&lt;span class="lnt">1657
&lt;/span>&lt;span class="lnt">1658
&lt;/span>&lt;span class="lnt">1659
&lt;/span>&lt;span class="lnt">1660
&lt;/span>&lt;span class="lnt">1661
&lt;/span>&lt;span class="lnt">1662
&lt;/span>&lt;span class="lnt">1663
&lt;/span>&lt;span class="lnt">1664
&lt;/span>&lt;span class="lnt">1665
&lt;/span>&lt;span class="lnt">1666
&lt;/span>&lt;span class="lnt">1667
&lt;/span>&lt;span class="lnt">1668
&lt;/span>&lt;span class="lnt">1669
&lt;/span>&lt;span class="lnt">1670
&lt;/span>&lt;span class="lnt">1671
&lt;/span>&lt;span class="lnt">1672
&lt;/span>&lt;span class="lnt">1673
&lt;/span>&lt;span class="lnt">1674
&lt;/span>&lt;span class="lnt">1675
&lt;/span>&lt;span class="lnt">1676
&lt;/span>&lt;span class="lnt">1677
&lt;/span>&lt;span class="lnt">1678
&lt;/span>&lt;span class="lnt">1679
&lt;/span>&lt;span class="lnt">1680
&lt;/span>&lt;span class="lnt">1681
&lt;/span>&lt;span class="lnt">1682
&lt;/span>&lt;span class="lnt">1683
&lt;/span>&lt;span class="lnt">1684
&lt;/span>&lt;span class="lnt">1685
&lt;/span>&lt;span class="lnt">1686
&lt;/span>&lt;span class="lnt">1687
&lt;/span>&lt;span class="lnt">1688
&lt;/span>&lt;span class="lnt">1689
&lt;/span>&lt;span class="lnt">1690
&lt;/span>&lt;span class="lnt">1691
&lt;/span>&lt;span class="lnt">1692
&lt;/span>&lt;span class="lnt">1693
&lt;/span>&lt;span class="lnt">1694
&lt;/span>&lt;span class="lnt">1695
&lt;/span>&lt;span class="lnt">1696
&lt;/span>&lt;span class="lnt">1697
&lt;/span>&lt;span class="lnt">1698
&lt;/span>&lt;span class="lnt">1699
&lt;/span>&lt;span class="lnt">1700
&lt;/span>&lt;span class="lnt">1701
&lt;/span>&lt;span class="lnt">1702
&lt;/span>&lt;span class="lnt">1703
&lt;/span>&lt;span class="lnt">1704
&lt;/span>&lt;span class="lnt">1705
&lt;/span>&lt;span class="lnt">1706
&lt;/span>&lt;span class="lnt">1707
&lt;/span>&lt;span class="lnt">1708
&lt;/span>&lt;span class="lnt">1709
&lt;/span>&lt;span class="lnt">1710
&lt;/span>&lt;span class="lnt">1711
&lt;/span>&lt;span class="lnt">1712
&lt;/span>&lt;span class="lnt">1713
&lt;/span>&lt;span class="lnt">1714
&lt;/span>&lt;span class="lnt">1715
&lt;/span>&lt;span class="lnt">1716
&lt;/span>&lt;span class="lnt">1717
&lt;/span>&lt;span class="lnt">1718
&lt;/span>&lt;span class="lnt">1719
&lt;/span>&lt;span class="lnt">1720
&lt;/span>&lt;span class="lnt">1721
&lt;/span>&lt;span class="lnt">1722
&lt;/span>&lt;span class="lnt">1723
&lt;/span>&lt;span class="lnt">1724
&lt;/span>&lt;span class="lnt">1725
&lt;/span>&lt;span class="lnt">1726
&lt;/span>&lt;span class="lnt">1727
&lt;/span>&lt;span class="lnt">1728
&lt;/span>&lt;span class="lnt">1729
&lt;/span>&lt;span class="lnt">1730
&lt;/span>&lt;span class="lnt">1731
&lt;/span>&lt;span class="lnt">1732
&lt;/span>&lt;span class="lnt">1733
&lt;/span>&lt;span class="lnt">1734
&lt;/span>&lt;span class="lnt">1735
&lt;/span>&lt;span class="lnt">1736
&lt;/span>&lt;span class="lnt">1737
&lt;/span>&lt;span class="lnt">1738
&lt;/span>&lt;span class="lnt">1739
&lt;/span>&lt;span class="lnt">1740
&lt;/span>&lt;span class="lnt">1741
&lt;/span>&lt;span class="lnt">1742
&lt;/span>&lt;span class="lnt">1743
&lt;/span>&lt;span class="lnt">1744
&lt;/span>&lt;span class="lnt">1745
&lt;/span>&lt;span class="lnt">1746
&lt;/span>&lt;span class="lnt">1747
&lt;/span>&lt;span class="lnt">1748
&lt;/span>&lt;span class="lnt">1749
&lt;/span>&lt;span class="lnt">1750
&lt;/span>&lt;span class="lnt">1751
&lt;/span>&lt;span class="lnt">1752
&lt;/span>&lt;span class="lnt">1753
&lt;/span>&lt;span class="lnt">1754
&lt;/span>&lt;span class="lnt">1755
&lt;/span>&lt;span class="lnt">1756
&lt;/span>&lt;span class="lnt">1757
&lt;/span>&lt;span class="lnt">1758
&lt;/span>&lt;span class="lnt">1759
&lt;/span>&lt;span class="lnt">1760
&lt;/span>&lt;span class="lnt">1761
&lt;/span>&lt;span class="lnt">1762
&lt;/span>&lt;span class="lnt">1763
&lt;/span>&lt;span class="lnt">1764
&lt;/span>&lt;span class="lnt">1765
&lt;/span>&lt;span class="lnt">1766
&lt;/span>&lt;span class="lnt">1767
&lt;/span>&lt;span class="lnt">1768
&lt;/span>&lt;span class="lnt">1769
&lt;/span>&lt;span class="lnt">1770
&lt;/span>&lt;span class="lnt">1771
&lt;/span>&lt;span class="lnt">1772
&lt;/span>&lt;span class="lnt">1773
&lt;/span>&lt;span class="lnt">1774
&lt;/span>&lt;span class="lnt">1775
&lt;/span>&lt;span class="lnt">1776
&lt;/span>&lt;span class="lnt">1777
&lt;/span>&lt;span class="lnt">1778
&lt;/span>&lt;span class="lnt">1779
&lt;/span>&lt;span class="lnt">1780
&lt;/span>&lt;span class="lnt">1781
&lt;/span>&lt;span class="lnt">1782
&lt;/span>&lt;span class="lnt">1783
&lt;/span>&lt;span class="lnt">1784
&lt;/span>&lt;span class="lnt">1785
&lt;/span>&lt;span class="lnt">1786
&lt;/span>&lt;span class="lnt">1787
&lt;/span>&lt;span class="lnt">1788
&lt;/span>&lt;span class="lnt">1789
&lt;/span>&lt;span class="lnt">1790
&lt;/span>&lt;span class="lnt">1791
&lt;/span>&lt;span class="lnt">1792
&lt;/span>&lt;span class="lnt">1793
&lt;/span>&lt;span class="lnt">1794
&lt;/span>&lt;span class="lnt">1795
&lt;/span>&lt;span class="lnt">1796
&lt;/span>&lt;span class="lnt">1797
&lt;/span>&lt;span class="lnt">1798
&lt;/span>&lt;span class="lnt">1799
&lt;/span>&lt;span class="lnt">1800
&lt;/span>&lt;span class="lnt">1801
&lt;/span>&lt;span class="lnt">1802
&lt;/span>&lt;span class="lnt">1803
&lt;/span>&lt;span class="lnt">1804
&lt;/span>&lt;span class="lnt">1805
&lt;/span>&lt;span class="lnt">1806
&lt;/span>&lt;span class="lnt">1807
&lt;/span>&lt;span class="lnt">1808
&lt;/span>&lt;span class="lnt">1809
&lt;/span>&lt;span class="lnt">1810
&lt;/span>&lt;span class="lnt">1811
&lt;/span>&lt;span class="lnt">1812
&lt;/span>&lt;span class="lnt">1813
&lt;/span>&lt;span class="lnt">1814
&lt;/span>&lt;span class="lnt">1815
&lt;/span>&lt;span class="lnt">1816
&lt;/span>&lt;span class="lnt">1817
&lt;/span>&lt;span class="lnt">1818
&lt;/span>&lt;span class="lnt">1819
&lt;/span>&lt;span class="lnt">1820
&lt;/span>&lt;span class="lnt">1821
&lt;/span>&lt;span class="lnt">1822
&lt;/span>&lt;span class="lnt">1823
&lt;/span>&lt;span class="lnt">1824
&lt;/span>&lt;span class="lnt">1825
&lt;/span>&lt;span class="lnt">1826
&lt;/span>&lt;span class="lnt">1827
&lt;/span>&lt;span class="lnt">1828
&lt;/span>&lt;span class="lnt">1829
&lt;/span>&lt;span class="lnt">1830
&lt;/span>&lt;span class="lnt">1831
&lt;/span>&lt;span class="lnt">1832
&lt;/span>&lt;span class="lnt">1833
&lt;/span>&lt;span class="lnt">1834
&lt;/span>&lt;span class="lnt">1835
&lt;/span>&lt;span class="lnt">1836
&lt;/span>&lt;span class="lnt">1837
&lt;/span>&lt;span class="lnt">1838
&lt;/span>&lt;span class="lnt">1839
&lt;/span>&lt;span class="lnt">1840
&lt;/span>&lt;span class="lnt">1841
&lt;/span>&lt;span class="lnt">1842
&lt;/span>&lt;span class="lnt">1843
&lt;/span>&lt;span class="lnt">1844
&lt;/span>&lt;span class="lnt">1845
&lt;/span>&lt;span class="lnt">1846
&lt;/span>&lt;span class="lnt">1847
&lt;/span>&lt;span class="lnt">1848
&lt;/span>&lt;span class="lnt">1849
&lt;/span>&lt;span class="lnt">1850
&lt;/span>&lt;span class="lnt">1851
&lt;/span>&lt;span class="lnt">1852
&lt;/span>&lt;span class="lnt">1853
&lt;/span>&lt;span class="lnt">1854
&lt;/span>&lt;span class="lnt">1855
&lt;/span>&lt;span class="lnt">1856
&lt;/span>&lt;span class="lnt">1857
&lt;/span>&lt;span class="lnt">1858
&lt;/span>&lt;span class="lnt">1859
&lt;/span>&lt;span class="lnt">1860
&lt;/span>&lt;span class="lnt">1861
&lt;/span>&lt;span class="lnt">1862
&lt;/span>&lt;span class="lnt">1863
&lt;/span>&lt;span class="lnt">1864
&lt;/span>&lt;span class="lnt">1865
&lt;/span>&lt;span class="lnt">1866
&lt;/span>&lt;span class="lnt">1867
&lt;/span>&lt;span class="lnt">1868
&lt;/span>&lt;span class="lnt">1869
&lt;/span>&lt;span class="lnt">1870
&lt;/span>&lt;span class="lnt">1871
&lt;/span>&lt;span class="lnt">1872
&lt;/span>&lt;span class="lnt">1873
&lt;/span>&lt;span class="lnt">1874
&lt;/span>&lt;span class="lnt">1875
&lt;/span>&lt;span class="lnt">1876
&lt;/span>&lt;span class="lnt">1877
&lt;/span>&lt;span class="lnt">1878
&lt;/span>&lt;span class="lnt">1879
&lt;/span>&lt;span class="lnt">1880
&lt;/span>&lt;span class="lnt">1881
&lt;/span>&lt;span class="lnt">1882
&lt;/span>&lt;span class="lnt">1883
&lt;/span>&lt;span class="lnt">1884
&lt;/span>&lt;span class="lnt">1885
&lt;/span>&lt;span class="lnt">1886
&lt;/span>&lt;span class="lnt">1887
&lt;/span>&lt;span class="lnt">1888
&lt;/span>&lt;span class="lnt">1889
&lt;/span>&lt;span class="lnt">1890
&lt;/span>&lt;span class="lnt">1891
&lt;/span>&lt;span class="lnt">1892
&lt;/span>&lt;span class="lnt">1893
&lt;/span>&lt;span class="lnt">1894
&lt;/span>&lt;span class="lnt">1895
&lt;/span>&lt;span class="lnt">1896
&lt;/span>&lt;span class="lnt">1897
&lt;/span>&lt;span class="lnt">1898
&lt;/span>&lt;span class="lnt">1899
&lt;/span>&lt;span class="lnt">1900
&lt;/span>&lt;span class="lnt">1901
&lt;/span>&lt;span class="lnt">1902
&lt;/span>&lt;span class="lnt">1903
&lt;/span>&lt;span class="lnt">1904
&lt;/span>&lt;span class="lnt">1905
&lt;/span>&lt;span class="lnt">1906
&lt;/span>&lt;span class="lnt">1907
&lt;/span>&lt;span class="lnt">1908
&lt;/span>&lt;span class="lnt">1909
&lt;/span>&lt;span class="lnt">1910
&lt;/span>&lt;span class="lnt">1911
&lt;/span>&lt;span class="lnt">1912
&lt;/span>&lt;span class="lnt">1913
&lt;/span>&lt;span class="lnt">1914
&lt;/span>&lt;span class="lnt">1915
&lt;/span>&lt;span class="lnt">1916
&lt;/span>&lt;span class="lnt">1917
&lt;/span>&lt;span class="lnt">1918
&lt;/span>&lt;span class="lnt">1919
&lt;/span>&lt;span class="lnt">1920
&lt;/span>&lt;span class="lnt">1921
&lt;/span>&lt;span class="lnt">1922
&lt;/span>&lt;span class="lnt">1923
&lt;/span>&lt;span class="lnt">1924
&lt;/span>&lt;span class="lnt">1925
&lt;/span>&lt;span class="lnt">1926
&lt;/span>&lt;span class="lnt">1927
&lt;/span>&lt;span class="lnt">1928
&lt;/span>&lt;span class="lnt">1929
&lt;/span>&lt;span class="lnt">1930
&lt;/span>&lt;span class="lnt">1931
&lt;/span>&lt;span class="lnt">1932
&lt;/span>&lt;span class="lnt">1933
&lt;/span>&lt;span class="lnt">1934
&lt;/span>&lt;span class="lnt">1935
&lt;/span>&lt;span class="lnt">1936
&lt;/span>&lt;span class="lnt">1937
&lt;/span>&lt;span class="lnt">1938
&lt;/span>&lt;span class="lnt">1939
&lt;/span>&lt;span class="lnt">1940
&lt;/span>&lt;span class="lnt">1941
&lt;/span>&lt;span class="lnt">1942
&lt;/span>&lt;span class="lnt">1943
&lt;/span>&lt;span class="lnt">1944
&lt;/span>&lt;span class="lnt">1945
&lt;/span>&lt;span class="lnt">1946
&lt;/span>&lt;span class="lnt">1947
&lt;/span>&lt;span class="lnt">1948
&lt;/span>&lt;span class="lnt">1949
&lt;/span>&lt;span class="lnt">1950
&lt;/span>&lt;span class="lnt">1951
&lt;/span>&lt;span class="lnt">1952
&lt;/span>&lt;span class="lnt">1953
&lt;/span>&lt;span class="lnt">1954
&lt;/span>&lt;span class="lnt">1955
&lt;/span>&lt;span class="lnt">1956
&lt;/span>&lt;span class="lnt">1957
&lt;/span>&lt;span class="lnt">1958
&lt;/span>&lt;span class="lnt">1959
&lt;/span>&lt;span class="lnt">1960
&lt;/span>&lt;span class="lnt">1961
&lt;/span>&lt;span class="lnt">1962
&lt;/span>&lt;span class="lnt">1963
&lt;/span>&lt;span class="lnt">1964
&lt;/span>&lt;span class="lnt">1965
&lt;/span>&lt;span class="lnt">1966
&lt;/span>&lt;span class="lnt">1967
&lt;/span>&lt;span class="lnt">1968
&lt;/span>&lt;span class="lnt">1969
&lt;/span>&lt;span class="lnt">1970
&lt;/span>&lt;span class="lnt">1971
&lt;/span>&lt;span class="lnt">1972
&lt;/span>&lt;span class="lnt">1973
&lt;/span>&lt;span class="lnt">1974
&lt;/span>&lt;span class="lnt">1975
&lt;/span>&lt;span class="lnt">1976
&lt;/span>&lt;span class="lnt">1977
&lt;/span>&lt;span class="lnt">1978
&lt;/span>&lt;span class="lnt">1979
&lt;/span>&lt;span class="lnt">1980
&lt;/span>&lt;span class="lnt">1981
&lt;/span>&lt;span class="lnt">1982
&lt;/span>&lt;span class="lnt">1983
&lt;/span>&lt;span class="lnt">1984
&lt;/span>&lt;span class="lnt">1985
&lt;/span>&lt;span class="lnt">1986
&lt;/span>&lt;span class="lnt">1987
&lt;/span>&lt;span class="lnt">1988
&lt;/span>&lt;span class="lnt">1989
&lt;/span>&lt;span class="lnt">1990
&lt;/span>&lt;span class="lnt">1991
&lt;/span>&lt;span class="lnt">1992
&lt;/span>&lt;span class="lnt">1993
&lt;/span>&lt;span class="lnt">1994
&lt;/span>&lt;span class="lnt">1995
&lt;/span>&lt;span class="lnt">1996
&lt;/span>&lt;span class="lnt">1997
&lt;/span>&lt;span class="lnt">1998
&lt;/span>&lt;span class="lnt">1999
&lt;/span>&lt;span class="lnt">2000
&lt;/span>&lt;span class="lnt">2001
&lt;/span>&lt;span class="lnt">2002
&lt;/span>&lt;span class="lnt">2003
&lt;/span>&lt;span class="lnt">2004
&lt;/span>&lt;span class="lnt">2005
&lt;/span>&lt;span class="lnt">2006
&lt;/span>&lt;span class="lnt">2007
&lt;/span>&lt;span class="lnt">2008
&lt;/span>&lt;span class="lnt">2009
&lt;/span>&lt;span class="lnt">2010
&lt;/span>&lt;span class="lnt">2011
&lt;/span>&lt;span class="lnt">2012
&lt;/span>&lt;span class="lnt">2013
&lt;/span>&lt;span class="lnt">2014
&lt;/span>&lt;span class="lnt">2015
&lt;/span>&lt;span class="lnt">2016
&lt;/span>&lt;span class="lnt">2017
&lt;/span>&lt;span class="lnt">2018
&lt;/span>&lt;span class="lnt">2019
&lt;/span>&lt;span class="lnt">2020
&lt;/span>&lt;span class="lnt">2021
&lt;/span>&lt;span class="lnt">2022
&lt;/span>&lt;span class="lnt">2023
&lt;/span>&lt;span class="lnt">2024
&lt;/span>&lt;span class="lnt">2025
&lt;/span>&lt;span class="lnt">2026
&lt;/span>&lt;span class="lnt">2027
&lt;/span>&lt;span class="lnt">2028
&lt;/span>&lt;span class="lnt">2029
&lt;/span>&lt;span class="lnt">2030
&lt;/span>&lt;span class="lnt">2031
&lt;/span>&lt;span class="lnt">2032
&lt;/span>&lt;span class="lnt">2033
&lt;/span>&lt;span class="lnt">2034
&lt;/span>&lt;span class="lnt">2035
&lt;/span>&lt;span class="lnt">2036
&lt;/span>&lt;span class="lnt">2037
&lt;/span>&lt;span class="lnt">2038
&lt;/span>&lt;span class="lnt">2039
&lt;/span>&lt;span class="lnt">2040
&lt;/span>&lt;span class="lnt">2041
&lt;/span>&lt;span class="lnt">2042
&lt;/span>&lt;span class="lnt">2043
&lt;/span>&lt;span class="lnt">2044
&lt;/span>&lt;span class="lnt">2045
&lt;/span>&lt;span class="lnt">2046
&lt;/span>&lt;span class="lnt">2047
&lt;/span>&lt;span class="lnt">2048
&lt;/span>&lt;span class="lnt">2049
&lt;/span>&lt;span class="lnt">2050
&lt;/span>&lt;span class="lnt">2051
&lt;/span>&lt;span class="lnt">2052
&lt;/span>&lt;span class="lnt">2053
&lt;/span>&lt;span class="lnt">2054
&lt;/span>&lt;span class="lnt">2055
&lt;/span>&lt;span class="lnt">2056
&lt;/span>&lt;span class="lnt">2057
&lt;/span>&lt;span class="lnt">2058
&lt;/span>&lt;span class="lnt">2059
&lt;/span>&lt;span class="lnt">2060
&lt;/span>&lt;span class="lnt">2061
&lt;/span>&lt;span class="lnt">2062
&lt;/span>&lt;span class="lnt">2063
&lt;/span>&lt;span class="lnt">2064
&lt;/span>&lt;span class="lnt">2065
&lt;/span>&lt;span class="lnt">2066
&lt;/span>&lt;span class="lnt">2067
&lt;/span>&lt;span class="lnt">2068
&lt;/span>&lt;span class="lnt">2069
&lt;/span>&lt;span class="lnt">2070
&lt;/span>&lt;span class="lnt">2071
&lt;/span>&lt;span class="lnt">2072
&lt;/span>&lt;span class="lnt">2073
&lt;/span>&lt;span class="lnt">2074
&lt;/span>&lt;span class="lnt">2075
&lt;/span>&lt;span class="lnt">2076
&lt;/span>&lt;span class="lnt">2077
&lt;/span>&lt;span class="lnt">2078
&lt;/span>&lt;span class="lnt">2079
&lt;/span>&lt;span class="lnt">2080
&lt;/span>&lt;span class="lnt">2081
&lt;/span>&lt;span class="lnt">2082
&lt;/span>&lt;span class="lnt">2083
&lt;/span>&lt;span class="lnt">2084
&lt;/span>&lt;span class="lnt">2085
&lt;/span>&lt;span class="lnt">2086
&lt;/span>&lt;span class="lnt">2087
&lt;/span>&lt;span class="lnt">2088
&lt;/span>&lt;span class="lnt">2089
&lt;/span>&lt;span class="lnt">2090
&lt;/span>&lt;span class="lnt">2091
&lt;/span>&lt;span class="lnt">2092
&lt;/span>&lt;span class="lnt">2093
&lt;/span>&lt;span class="lnt">2094
&lt;/span>&lt;span class="lnt">2095
&lt;/span>&lt;span class="lnt">2096
&lt;/span>&lt;span class="lnt">2097
&lt;/span>&lt;span class="lnt">2098
&lt;/span>&lt;span class="lnt">2099
&lt;/span>&lt;span class="lnt">2100
&lt;/span>&lt;span class="lnt">2101
&lt;/span>&lt;span class="lnt">2102
&lt;/span>&lt;span class="lnt">2103
&lt;/span>&lt;span class="lnt">2104
&lt;/span>&lt;span class="lnt">2105
&lt;/span>&lt;span class="lnt">2106
&lt;/span>&lt;span class="lnt">2107
&lt;/span>&lt;span class="lnt">2108
&lt;/span>&lt;span class="lnt">2109
&lt;/span>&lt;span class="lnt">2110
&lt;/span>&lt;span class="lnt">2111
&lt;/span>&lt;span class="lnt">2112
&lt;/span>&lt;span class="lnt">2113
&lt;/span>&lt;span class="lnt">2114
&lt;/span>&lt;span class="lnt">2115
&lt;/span>&lt;span class="lnt">2116
&lt;/span>&lt;span class="lnt">2117
&lt;/span>&lt;span class="lnt">2118
&lt;/span>&lt;span class="lnt">2119
&lt;/span>&lt;span class="lnt">2120
&lt;/span>&lt;span class="lnt">2121
&lt;/span>&lt;span class="lnt">2122
&lt;/span>&lt;span class="lnt">2123
&lt;/span>&lt;span class="lnt">2124
&lt;/span>&lt;span class="lnt">2125
&lt;/span>&lt;span class="lnt">2126
&lt;/span>&lt;span class="lnt">2127
&lt;/span>&lt;span class="lnt">2128
&lt;/span>&lt;span class="lnt">2129
&lt;/span>&lt;span class="lnt">2130
&lt;/span>&lt;span class="lnt">2131
&lt;/span>&lt;span class="lnt">2132
&lt;/span>&lt;span class="lnt">2133
&lt;/span>&lt;span class="lnt">2134
&lt;/span>&lt;span class="lnt">2135
&lt;/span>&lt;span class="lnt">2136
&lt;/span>&lt;span class="lnt">2137
&lt;/span>&lt;span class="lnt">2138
&lt;/span>&lt;span class="lnt">2139
&lt;/span>&lt;span class="lnt">2140
&lt;/span>&lt;span class="lnt">2141
&lt;/span>&lt;span class="lnt">2142
&lt;/span>&lt;span class="lnt">2143
&lt;/span>&lt;span class="lnt">2144
&lt;/span>&lt;span class="lnt">2145
&lt;/span>&lt;span class="lnt">2146
&lt;/span>&lt;span class="lnt">2147
&lt;/span>&lt;span class="lnt">2148
&lt;/span>&lt;span class="lnt">2149
&lt;/span>&lt;span class="lnt">2150
&lt;/span>&lt;span class="lnt">2151
&lt;/span>&lt;span class="lnt">2152
&lt;/span>&lt;span class="lnt">2153
&lt;/span>&lt;span class="lnt">2154
&lt;/span>&lt;span class="lnt">2155
&lt;/span>&lt;span class="lnt">2156
&lt;/span>&lt;span class="lnt">2157
&lt;/span>&lt;span class="lnt">2158
&lt;/span>&lt;span class="lnt">2159
&lt;/span>&lt;span class="lnt">2160
&lt;/span>&lt;span class="lnt">2161
&lt;/span>&lt;span class="lnt">2162
&lt;/span>&lt;span class="lnt">2163
&lt;/span>&lt;span class="lnt">2164
&lt;/span>&lt;span class="lnt">2165
&lt;/span>&lt;span class="lnt">2166
&lt;/span>&lt;span class="lnt">2167
&lt;/span>&lt;span class="lnt">2168
&lt;/span>&lt;span class="lnt">2169
&lt;/span>&lt;span class="lnt">2170
&lt;/span>&lt;span class="lnt">2171
&lt;/span>&lt;span class="lnt">2172
&lt;/span>&lt;span class="lnt">2173
&lt;/span>&lt;span class="lnt">2174
&lt;/span>&lt;span class="lnt">2175
&lt;/span>&lt;span class="lnt">2176
&lt;/span>&lt;span class="lnt">2177
&lt;/span>&lt;span class="lnt">2178
&lt;/span>&lt;span class="lnt">2179
&lt;/span>&lt;span class="lnt">2180
&lt;/span>&lt;span class="lnt">2181
&lt;/span>&lt;span class="lnt">2182
&lt;/span>&lt;span class="lnt">2183
&lt;/span>&lt;span class="lnt">2184
&lt;/span>&lt;span class="lnt">2185
&lt;/span>&lt;span class="lnt">2186
&lt;/span>&lt;span class="lnt">2187
&lt;/span>&lt;span class="lnt">2188
&lt;/span>&lt;span class="lnt">2189
&lt;/span>&lt;span class="lnt">2190
&lt;/span>&lt;span class="lnt">2191
&lt;/span>&lt;span class="lnt">2192
&lt;/span>&lt;span class="lnt">2193
&lt;/span>&lt;span class="lnt">2194
&lt;/span>&lt;span class="lnt">2195
&lt;/span>&lt;span class="lnt">2196
&lt;/span>&lt;span class="lnt">2197
&lt;/span>&lt;span class="lnt">2198
&lt;/span>&lt;span class="lnt">2199
&lt;/span>&lt;span class="lnt">2200
&lt;/span>&lt;span class="lnt">2201
&lt;/span>&lt;span class="lnt">2202
&lt;/span>&lt;span class="lnt">2203
&lt;/span>&lt;span class="lnt">2204
&lt;/span>&lt;span class="lnt">2205
&lt;/span>&lt;span class="lnt">2206
&lt;/span>&lt;span class="lnt">2207
&lt;/span>&lt;span class="lnt">2208
&lt;/span>&lt;span class="lnt">2209
&lt;/span>&lt;span class="lnt">2210
&lt;/span>&lt;span class="lnt">2211
&lt;/span>&lt;span class="lnt">2212
&lt;/span>&lt;span class="lnt">2213
&lt;/span>&lt;span class="lnt">2214
&lt;/span>&lt;span class="lnt">2215
&lt;/span>&lt;span class="lnt">2216
&lt;/span>&lt;span class="lnt">2217
&lt;/span>&lt;span class="lnt">2218
&lt;/span>&lt;span class="lnt">2219
&lt;/span>&lt;span class="lnt">2220
&lt;/span>&lt;span class="lnt">2221
&lt;/span>&lt;span class="lnt">2222
&lt;/span>&lt;span class="lnt">2223
&lt;/span>&lt;span class="lnt">2224
&lt;/span>&lt;span class="lnt">2225
&lt;/span>&lt;span class="lnt">2226
&lt;/span>&lt;span class="lnt">2227
&lt;/span>&lt;span class="lnt">2228
&lt;/span>&lt;span class="lnt">2229
&lt;/span>&lt;span class="lnt">2230
&lt;/span>&lt;span class="lnt">2231
&lt;/span>&lt;span class="lnt">2232
&lt;/span>&lt;span class="lnt">2233
&lt;/span>&lt;span class="lnt">2234
&lt;/span>&lt;span class="lnt">2235
&lt;/span>&lt;span class="lnt">2236
&lt;/span>&lt;span class="lnt">2237
&lt;/span>&lt;span class="lnt">2238
&lt;/span>&lt;span class="lnt">2239
&lt;/span>&lt;span class="lnt">2240
&lt;/span>&lt;span class="lnt">2241
&lt;/span>&lt;span class="lnt">2242
&lt;/span>&lt;span class="lnt">2243
&lt;/span>&lt;span class="lnt">2244
&lt;/span>&lt;span class="lnt">2245
&lt;/span>&lt;span class="lnt">2246
&lt;/span>&lt;span class="lnt">2247
&lt;/span>&lt;span class="lnt">2248
&lt;/span>&lt;span class="lnt">2249
&lt;/span>&lt;span class="lnt">2250
&lt;/span>&lt;span class="lnt">2251
&lt;/span>&lt;span class="lnt">2252
&lt;/span>&lt;span class="lnt">2253
&lt;/span>&lt;span class="lnt">2254
&lt;/span>&lt;span class="lnt">2255
&lt;/span>&lt;span class="lnt">2256
&lt;/span>&lt;span class="lnt">2257
&lt;/span>&lt;span class="lnt">2258
&lt;/span>&lt;span class="lnt">2259
&lt;/span>&lt;span class="lnt">2260
&lt;/span>&lt;span class="lnt">2261
&lt;/span>&lt;span class="lnt">2262
&lt;/span>&lt;span class="lnt">2263
&lt;/span>&lt;span class="lnt">2264
&lt;/span>&lt;span class="lnt">2265
&lt;/span>&lt;span class="lnt">2266
&lt;/span>&lt;span class="lnt">2267
&lt;/span>&lt;span class="lnt">2268
&lt;/span>&lt;span class="lnt">2269
&lt;/span>&lt;span class="lnt">2270
&lt;/span>&lt;span class="lnt">2271
&lt;/span>&lt;span class="lnt">2272
&lt;/span>&lt;span class="lnt">2273
&lt;/span>&lt;span class="lnt">2274
&lt;/span>&lt;span class="lnt">2275
&lt;/span>&lt;span class="lnt">2276
&lt;/span>&lt;span class="lnt">2277
&lt;/span>&lt;span class="lnt">2278
&lt;/span>&lt;span class="lnt">2279
&lt;/span>&lt;span class="lnt">2280
&lt;/span>&lt;span class="lnt">2281
&lt;/span>&lt;span class="lnt">2282
&lt;/span>&lt;span class="lnt">2283
&lt;/span>&lt;span class="lnt">2284
&lt;/span>&lt;span class="lnt">2285
&lt;/span>&lt;span class="lnt">2286
&lt;/span>&lt;span class="lnt">2287
&lt;/span>&lt;span class="lnt">2288
&lt;/span>&lt;span class="lnt">2289
&lt;/span>&lt;span class="lnt">2290
&lt;/span>&lt;span class="lnt">2291
&lt;/span>&lt;span class="lnt">2292
&lt;/span>&lt;span class="lnt">2293
&lt;/span>&lt;span class="lnt">2294
&lt;/span>&lt;span class="lnt">2295
&lt;/span>&lt;span class="lnt">2296
&lt;/span>&lt;span class="lnt">2297
&lt;/span>&lt;span class="lnt">2298
&lt;/span>&lt;span class="lnt">2299
&lt;/span>&lt;span class="lnt">2300
&lt;/span>&lt;span class="lnt">2301
&lt;/span>&lt;span class="lnt">2302
&lt;/span>&lt;span class="lnt">2303
&lt;/span>&lt;span class="lnt">2304
&lt;/span>&lt;span class="lnt">2305
&lt;/span>&lt;span class="lnt">2306
&lt;/span>&lt;span class="lnt">2307
&lt;/span>&lt;span class="lnt">2308
&lt;/span>&lt;span class="lnt">2309
&lt;/span>&lt;span class="lnt">2310
&lt;/span>&lt;span class="lnt">2311
&lt;/span>&lt;span class="lnt">2312
&lt;/span>&lt;span class="lnt">2313
&lt;/span>&lt;span class="lnt">2314
&lt;/span>&lt;span class="lnt">2315
&lt;/span>&lt;span class="lnt">2316
&lt;/span>&lt;span class="lnt">2317
&lt;/span>&lt;span class="lnt">2318
&lt;/span>&lt;span class="lnt">2319
&lt;/span>&lt;span class="lnt">2320
&lt;/span>&lt;span class="lnt">2321
&lt;/span>&lt;span class="lnt">2322
&lt;/span>&lt;span class="lnt">2323
&lt;/span>&lt;span class="lnt">2324
&lt;/span>&lt;span class="lnt">2325
&lt;/span>&lt;span class="lnt">2326
&lt;/span>&lt;span class="lnt">2327
&lt;/span>&lt;span class="lnt">2328
&lt;/span>&lt;span class="lnt">2329
&lt;/span>&lt;span class="lnt">2330
&lt;/span>&lt;span class="lnt">2331
&lt;/span>&lt;span class="lnt">2332
&lt;/span>&lt;span class="lnt">2333
&lt;/span>&lt;span class="lnt">2334
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################# 不允许后台运行 docker 必须打开 #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">daemonize&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################# 基础网络相关 #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bind&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">port&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">port&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################# tls相关 #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果不启用注释掉下面即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">port&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">tlsPort&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">pass&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">secret&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cert&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dir&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">certs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">auth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">clients&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">auth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">clients&lt;/span> &lt;span class="n">optional&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">replication&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cluster&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">protocols&lt;/span> &lt;span class="s2">&amp;#34;TLSv1.2 TLSv1.3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ciphers&lt;/span> &lt;span class="n">DEFAULT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">MEDIUM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ciphersuites&lt;/span> &lt;span class="n">TLS_CHACHA20_POLY1305_SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">prefer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ciphers&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">caching&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="mi">5000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tls&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">timeout&lt;/span> &lt;span class="mi">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 安全认证相关 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 允许外网访问 no是允许&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">protected&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">requirepass&lt;/span> &lt;span class="s2">&amp;#34;{password}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 同步密码 和管理员密码配置一样的，不然同步容易出问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">masterauth&lt;/span> &lt;span class="s2">&amp;#34;{password}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 多线程 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">threads&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">do&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reads&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">io&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">threads&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 持久化 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 开启aof 其他不用配置用默认即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">appendonly&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">################################## 集 群 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 开启集群 如果不用 注释掉即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">enabled&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 节点配置 默认会在 data 目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="s2">&amp;#34;nodes.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#集群超时&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">timeout&lt;/span> &lt;span class="mi">5000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 可能需要的 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 限制内存 acl控制等&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## 后面是默认配置 ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis configuration file example.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that in order to read the configuration file, Redis must be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># started with the file path as first argument:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ./redis-server /path/to/redis.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note on units: when memory size is needed, it is possible to specify&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it in the usual form of 1k 5GB 4M and so forth:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1k =&amp;gt; 1000 bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1kb =&amp;gt; 1024 bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1m =&amp;gt; 1000000 bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1mb =&amp;gt; 1024*1024 bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1g =&amp;gt; 1000000000 bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1gb =&amp;gt; 1024*1024*1024 bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># units are case insensitive so 1GB 1Gb 1gB are all the same.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## INCLUDES ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Include one or more other config files here. This is useful if you&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># have a standard template that goes to all Redis servers but also need&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to customize a few per-server settings. Include files can include&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># other files, so use this wisely.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that option &amp;#34;include&amp;#34; won&amp;#39;t be rewritten by command &amp;#34;CONFIG REWRITE&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># from admin or Redis Sentinel. Since Redis always uses the last processed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># line as value of a configuration directive, you&amp;#39;d better put includes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># at the beginning of this file to avoid overwriting config change at runtime.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If instead you are interested in using includes to override configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># options, it is better to use include as the last line.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Included paths may contain wildcards. All files matching the wildcards will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># be included in alphabetical order.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that if an include path contains a wildcards but no files match it when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the server is started, the include statement will be ignored and no error will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># be emitted. It is safe, therefore, to include wildcard files from empty&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># directories.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># include /path/to/local.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># include /path/to/other.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># include /path/to/fragments/*.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## MODULES #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Load modules at startup. If the server is not able to load modules&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it will abort. It is possible to use multiple loadmodule directives.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># loadmodule /path/to/my_module.so&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># loadmodule /path/to/other_module.so&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## NETWORK #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, if no &amp;#34;bind&amp;#34; configuration directive is specified, Redis listens&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for connections from all available network interfaces on the host machine.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is possible to listen to just one or multiple selected interfaces using&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the &amp;#34;bind&amp;#34; configuration directive, followed by one or more IP addresses.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Each address can be prefixed by &amp;#34;-&amp;#34;, which means that redis will not fail to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># start if the address is not available. Being not available only refers to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># addresses that does not correspond to any network interface. Addresses that&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are already in use will always fail, and unsupported protocols will always BE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># silently skipped.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Examples:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bind 192.168.1.100 10.0.0.1 # listens on two specific IPv4 addresses&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bind 127.0.0.1 ::1 # listens on loopback IPv4 and IPv6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bind * -::* # like the default, all available interfaces&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># internet, binding to all the interfaces is dangerous and will expose the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># instance to everybody on the internet. So by default we uncomment the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># following bind directive, that will force Redis to listen only on the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IPv4 and IPv6 (if available) loopback interface addresses (this means Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will only be able to accept client connections from the same host that it is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># running on).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># COMMENT OUT THE FOLLOWING LINE.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># You will also need to set a password unless you explicitly disable protected&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mode.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-bind 127.0.0.1 -::1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, outgoing connections (from replica to master, from Sentinel to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># instances, cluster bus, etc.) are not bound to a specific local address. In&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># most cases, this means the operating system will handle that based on routing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and the interface through which the connection goes out.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Using bind-source-addr it is possible to configure a specific address to bind&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to, which may also affect how the connection gets routed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bind-source-addr 10.0.0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Protected mode is a layer of security protection, in order to avoid that&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis instances left open on the internet are accessed and exploited.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When protected mode is on and the default user has no password, the server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># only accepts local connections from the IPv4 address (127.0.0.1), IPv6 address&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (::1) or Unix domain sockets.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default protected mode is enabled. You should disable it only if&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># you are sure you want clients from other hosts to connect to Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># even if no authentication is configured.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-protected-mode yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis uses default hardened security configuration directives to reduce the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># attack surface on innocent users. Therefore, several sensitive configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># directives are immutable, and some potentially-dangerous commands are blocked.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configuration directives that control files that Redis writes to (e.g., &amp;#39;dir&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and &amp;#39;dbfilename&amp;#39;) and that aren&amp;#39;t usually modified during runtime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are protected by making them immutable.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Commands that can increase the attack surface of Redis and that aren&amp;#39;t usually&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># called by users are blocked by default.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># These can be exposed to either all connections or just local ones by setting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># each of the configs listed below to either of these values:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># no - Block for any connection (remain immutable)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># yes - Allow for any connection (no protection)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># local - Allow only for local connections. Ones originating from the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IPv4 address (127.0.0.1), IPv6 address (::1) or Unix domain sockets.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enable-protected-configs no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enable-debug-command no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enable-module-command no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Accept connections on the specified port, default is 6379 (IANA #815344).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If port 0 is specified Redis will not listen on a TCP socket.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-port 6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># TCP listen() backlog.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In high requests-per-second environments you need a high backlog in order&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to avoid slow clients connection issues. Note that the Linux kernel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to get the desired effect.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tcp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">backlog&lt;/span> &lt;span class="mi">511&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Unix socket.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specify the path for the Unix socket that will be used to listen for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># incoming connections. There is no default, so Redis will not listen&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on a unix socket when not specified.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unixsocket /run/redis/redis-server.sock&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unixsocketperm 700&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Close the connection after a client is idle for N seconds (0 to disable)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">timeout&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># TCP keepalive.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of communication. This is useful for two reasons:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) Detect dead peers.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) Force network equipment in the middle to consider the connection to be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># alive.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On Linux, the specified value (in seconds) is the period used to send ACKs.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that to close the connection the double of the time is needed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On other kernels the period depends on the kernel configuration.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A reasonable value for this option is 300 seconds, which is the new&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis default starting with Redis 3.2.1.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tcp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keepalive&lt;/span> &lt;span class="mi">300&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Apply OS-specific mechanism to mark the listening socket with the specified&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ID, to support advanced routing and filtering capabilities.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On Linux, the ID represents a connection mark.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On FreeBSD, the ID represents a socket cookie ID.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On OpenBSD, the ID represents a route table ID.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default value is 0, which implies no marking is required.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># socket-mark-id 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################# TLS/SSL #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, TLS/SSL is disabled. To enable it, the &amp;#34;tls-port&amp;#34; configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># directive can be used to define TLS-listening ports. To enable TLS on the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># default port, use:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># port 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-port 6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure a X.509 certificate and private key to use for authenticating the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server to connected clients, masters or cluster peers. These files should be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PEM formatted.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-cert-file redis.crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-key-file redis.key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the key file is encrypted using a passphrase, it can be included here&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># as well.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-key-file-pass secret&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Normally Redis uses the same certificate for both server functions (accepting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># connections) and client functions (replicating from a master, establishing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster bus connections, etc.).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sometimes certificates are issued with attributes that designate them as&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># client-only or server-only certificates. In that case it may be desired to use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># different certificates for incoming (server) and outgoing (client)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># connections. To do that, use the following directives:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-client-cert-file client.crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-client-key-file client.key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the key file is encrypted using a passphrase, it can be included here&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># as well.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-client-key-file-pass secret&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure a DH parameters file to enable Diffie-Hellman (DH) key exchange,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># required by older versions of OpenSSL (&amp;lt;3.0). Newer versions do not require&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this configuration and recommend against it.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-dh-params-file redis.dh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure a CA certificate(s) bundle or directory to authenticate TLS/SSL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># clients and peers. Redis requires an explicit configuration of at least one&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of these, and will not implicitly use the system wide configuration.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-ca-cert-file ca.crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-ca-cert-dir /etc/ssl/certs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, clients (including replica servers) on a TLS port are required&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to authenticate using valid client side certificates.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If &amp;#34;no&amp;#34; is specified, client certificates are not required and not accepted.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If &amp;#34;optional&amp;#34; is specified, client certificates are accepted and must be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># valid if provided, but are not required.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-auth-clients no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-auth-clients optional&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, a Redis replica does not attempt to establish a TLS connection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with its master.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Use the following directive to enable TLS on replication links.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-replication yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, the Redis Cluster bus uses a plain TCP connection. To enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># TLS for the bus protocol, use the following directive:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-cluster yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, only TLSv1.2 and TLSv1.3 are enabled and it is highly recommended&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that older formally deprecated versions are kept disabled to reduce the attack surface.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># You can explicitly specify TLS versions to support.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Allowed values are case insensitive and include &amp;#34;TLSv1&amp;#34;, &amp;#34;TLSv1.1&amp;#34;, &amp;#34;TLSv1.2&amp;#34;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;TLSv1.3&amp;#34; (OpenSSL &amp;gt;= 1.1.1) or any combination.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To enable only TLSv1.2 and TLSv1.3, use:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-protocols &amp;#34;TLSv1.2 TLSv1.3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure allowed ciphers. See the ciphers(1ssl) manpage for more information&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># about the syntax of this string.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note: this configuration applies only to &amp;lt;= TLSv1.2.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-ciphers DEFAULT:!MEDIUM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure allowed TLSv1.3 ciphersuites. See the ciphers(1ssl) manpage for more&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># information about the syntax of this string, and specifically for TLSv1.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ciphersuites.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-ciphersuites TLS_CHACHA20_POLY1305_SHA256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When choosing a cipher, use the server&amp;#39;s preference instead of the client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># preference. By default, the server follows the client&amp;#39;s preference.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-prefer-server-ciphers yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, TLS session caching is enabled to allow faster and less expensive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># reconnections by clients that support it. Use the following directive to disable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># caching.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-session-caching no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Change the default number of TLS sessions cached. A zero value sets the cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to unlimited size. The default size is 20480.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-session-cache-size 5000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Change the default timeout of cached TLS sessions. The default timeout is 300&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tls-session-cache-timeout 60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################# GENERAL #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default Redis does not run as a daemon. Use &amp;#39;yes&amp;#39; if you need it.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that Redis will write a pid file in /var/run/redis.pid when daemonized.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When Redis is supervised by upstart or systemd, this parameter has no impact.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-daemonize yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If you run Redis from upstart or systemd, Redis can interact with your&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supervision tree. Options:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supervised no - no supervision interaction&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supervised upstart - signal upstart by putting Redis into SIGSTOP mode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># requires &amp;#34;expect stop&amp;#34; in your upstart job config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on startup, and updating Redis status on a regular&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># basis.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supervised auto - detect upstart or systemd method based on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># UPSTART_JOB or NOTIFY_SOCKET environment variables&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note: these supervision methods only signal &amp;#34;process is ready.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># They do not enable continuous pings back to your supervisor.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default is &amp;#34;no&amp;#34;. To run under upstart/systemd, you can simply uncomment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the line below:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supervised auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If a pid file is specified, Redis writes it where specified at startup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and removes it at exit.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When the server runs non daemonized, no pid file is created if none is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># specified in the configuration. When the server is daemonized, the pid file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is used even if not specified, defaulting to &amp;#34;/var/run/redis.pid&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Creating a pid file is best effort: if Redis is not able to create it&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nothing bad happens, the server will start and run normally.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that on modern Linux systems &amp;#34;/run/redis.pid&amp;#34; is more conforming&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and should be used instead.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pidfile&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specify the server verbosity level.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This can be one of:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debug (a lot of information, useful for development/testing)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># verbose (many rarely useful info, but not a mess like the debug level)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># notice (moderately verbose, what you want in production probably)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># warning (only very important / critical messages are logged)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">loglevel&lt;/span> &lt;span class="n">notice&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specify the log file name. Also the empty string can be used to force&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis to log on the standard output. Note that if you use standard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># output for logging but daemonize, logs will be sent to /dev/null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logfile&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To enable logging to the system logger, just set &amp;#39;syslog-enabled&amp;#39; to yes,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and optionally update the other syslog parameters to suit your needs.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># syslog-enabled no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specify the syslog identity.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># syslog-ident redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># syslog-facility local0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To disable the built in crash log, which will possibly produce cleaner core&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dumps when they are needed, uncomment the following:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># crash-log-enabled no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To disable the fast memory check that&amp;#39;s run as part of the crash log, which&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will possibly let redis terminate sooner, uncomment the following:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># crash-memcheck-enabled no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set the number of databases. The default database is DB 0, you can select&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a different one on a per-connection basis using SELECT &amp;lt;dbid&amp;gt; where&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dbid is a number between 0 and &amp;#39;databases&amp;#39;-1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">databases&lt;/span> &lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default Redis shows an ASCII art logo only when started to log to the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># standard output and if the standard output is a TTY and syslog logging is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disabled. Basically this means that normally a logo is displayed only in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># interactive sessions.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># However it is possible to force the pre-4.0 behavior and always show a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ASCII art logo in startup logs by setting the following option to yes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">always&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">show&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">logo&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, Redis modifies the process title (as seen in &amp;#39;top&amp;#39; and &amp;#39;ps&amp;#39;) to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># provide some runtime information. It is possible to disable this and leave&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the process name as executed by setting the following to no.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">set&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">proc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">title&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When changing the process title, Redis uses the following template to construct&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the modified title.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Template variables are specified in curly brackets. The following variables are&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supported:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># {title} Name of process as executed if parent, or type of child process.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># {listen-addr} Bind address or &amp;#39;*&amp;#39; followed by TCP or TLS port listening on, or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Unix socket if only that&amp;#39;s available.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># {server-mode} Special mode, i.e. &amp;#34;[sentinel]&amp;#34; or &amp;#34;[cluster]&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># {port} TCP port listening on, or 0.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># {tls-port} TLS port listening on, or 0.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># {unixsocket} Unix domain socket listening on, or &amp;#34;&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># {config-file} Name of configuration file used.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">proc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">title&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">template&lt;/span> &lt;span class="s2">&amp;#34;{title} {listen-addr} {server-mode}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ SNAPSHOTTING ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Save the DB to disk.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># save &amp;lt;seconds&amp;gt; &amp;lt;changes&amp;gt; [&amp;lt;seconds&amp;gt; &amp;lt;changes&amp;gt; ...]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis will save the DB if the given number of seconds elapsed and it&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># surpassed the given number of write operations against the DB.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Snapshotting can be completely disabled with a single empty string argument&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># as in following example:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># save &amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Unless specified otherwise, by default Redis will save the DB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * After 3600 seconds (an hour) if at least 1 change was performed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * After 300 seconds (5 minutes) if at least 100 changes were performed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * After 60 seconds if at least 10000 changes were performed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># You can set these explicitly by uncommenting the following line.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># save 3600 1 300 100 60 10000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default Redis will stop accepting writes if RDB snapshots are enabled&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (at least one save point) and the latest background save failed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This will make the user aware (in a hard way) that data is not persisting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on disk properly, otherwise chances are that no one will notice and some&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disaster will happen.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the background saving process will start working again Redis will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># automatically allow writes again.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># However if you have setup your proper monitoring of the Redis server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and persistence, you may want to disable this feature so that Redis will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># continue to work as usual even if there are problems with disk,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># permissions, and so forth.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">writes&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bgsave&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">error&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Compress string objects using LZF when dump .rdb databases?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default compression is enabled as it&amp;#39;s almost always a win.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If you want to save some CPU in the saving child set it to &amp;#39;no&amp;#39; but&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the dataset will likely be bigger if you have compressible values or keys.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rdbcompression&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Since version 5 of RDB a CRC64 checksum is placed at the end of the file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This makes the format more resistant to corruption but there is a performance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># hit to pay (around 10%) when saving and loading RDB files, so you can disable it&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for maximum performances.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># RDB files created with checksum disabled have a checksum of zero that will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tell the loading code to skip the check.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rdbchecksum&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Enables or disables full sanitization checks for ziplist and listpack etc when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># loading an RDB or RESTORE payload. This reduces the chances of a assertion or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># crash later on while processing commands.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Options:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># no - Never perform full sanitization&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># yes - Always perform full sanitization&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># clients - Perform full sanitization only for user connections.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Excludes: RDB files, RESTORE commands received from the master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># connection, and client connections which have the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># skip-sanitize-payload ACL flag.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default should be &amp;#39;clients&amp;#39; but since it currently affects cluster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># resharding via MIGRATE, it is temporarily set to &amp;#39;no&amp;#39; by default.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sanitize-dump-payload no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The filename where to dump the DB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dbfilename&lt;/span> &lt;span class="n">dump&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rdb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Remove RDB files used by replication in instances without persistence&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enabled. By default this option is disabled, however there are environments&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># where for regulations or other security concerns, RDB files persisted on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disk by masters in order to feed replicas, or stored on disk by replicas&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to load them for the initial synchronization, should be deleted&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ASAP. Note that this option ONLY WORKS in instances that have both AOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and RDB persistence disabled, otherwise is completely ignored.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># An alternative (and sometimes better) way to obtain the same effect is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to use diskless replication on both master and replicas instances. However&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in the case of replicas, diskless is not always an option.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rdb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">del&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sync&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">files&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The working directory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The DB will be written inside this directory, with the filename specified&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># above using the &amp;#39;dbfilename&amp;#39; configuration directive.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The Append Only File will also be created inside this directory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that you must specify a directory here, not a file name.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dir&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################# REPLICATION #################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Master-Replica replication. Use replicaof to make a Redis instance a copy of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># another Redis server. A few things to understand ASAP about Redis replication.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +------------------+ +---------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># | Master | ---&amp;gt; | Replica |&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># | (receive writes) | | (exact copy) |&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +------------------+ +---------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) Redis replication is asynchronous, but you can configure a master to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># stop accepting writes if it appears to be not connected with at least&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a given number of replicas.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) Redis replicas are able to perform a partial resynchronization with the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master if the replication link is lost for a relatively small amount of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># time. You may want to configure the replication backlog size (see the next&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sections of this file) with a sensible value depending on your needs.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3) Replication is automatic and does not need user intervention. After a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># network partition replicas automatically try to reconnect to masters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and resynchronize with them.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replicaof &amp;lt;masterip&amp;gt; &amp;lt;masterport&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the master is password protected (using the &amp;#34;requirepass&amp;#34; configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># directive below) it is possible to tell the replica to authenticate before&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># starting the replication synchronization process, otherwise the master will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># refuse the replica request.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># masterauth &amp;lt;master-password&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># However this is not enough if you are using Redis ACLs (for Redis version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 6 or greater), and the default user is not capable of running the PSYNC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># command and/or other commands needed for replication. In this case it&amp;#39;s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># better to configure a special user to use with replication, and specify the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># masteruser configuration as such:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># masteruser &amp;lt;username&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When masteruser is specified, the replica will authenticate against its&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master using the new AUTH form: AUTH &amp;lt;username&amp;gt; &amp;lt;password&amp;gt;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When a replica loses its connection with the master, or when the replication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is still in progress, the replica can act in two different ways:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) if replica-serve-stale-data is set to &amp;#39;yes&amp;#39; (the default) the replica will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># still reply to client requests, possibly with out of date data, or the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># data set may just be empty if this is the first synchronization.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) If replica-serve-stale-data is set to &amp;#39;no&amp;#39; the replica will reply with error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;MASTERDOWN Link with MASTER is down and replica-serve-stale-data is set to &amp;#39;no&amp;#39;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to all data access commands, excluding commands such as:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># INFO, REPLICAOF, AUTH, SHUTDOWN, REPLCONF, ROLE, CONFIG, SUBSCRIBE,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB, COMMAND, POST,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># HOST and LATENCY.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">replica&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">serve&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stale&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">data&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># You can configure a replica instance to accept writes or not. Writing against&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a replica instance may be useful to store some ephemeral data (because data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># written on a replica will be easily deleted after resync with the master) but&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># may also cause problems if clients are writing to it because of a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># misconfiguration.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Since Redis 2.6 by default replicas are read-only.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note: read only replicas are not designed to be exposed to untrusted clients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on the internet. It&amp;#39;s just a protection layer against misuse of the instance.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Still a read only replica exports by default all the administrative commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># such as CONFIG, DEBUG, and so forth. To a limited extent you can improve&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># security of read only replicas using &amp;#39;rename-command&amp;#39; to shadow all the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># administrative / dangerous commands.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">replica&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">only&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Replication SYNC strategy: disk or socket.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># New replicas and reconnecting replicas that are not able to continue the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replication process just receiving differences, need to do what is called a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;full synchronization&amp;#34;. An RDB file is transmitted from the master to the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replicas.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The transmission can happen in two different ways:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) Disk-backed: The Redis master creates a new process that writes the RDB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># file on disk. Later the file is transferred by the parent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># process to the replicas incrementally.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) Diskless: The Redis master creates a new process that directly writes the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># RDB file to replica sockets, without touching the disk at all.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># With disk-backed replication, while the RDB file is generated, more replicas&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># can be queued and served with the RDB file as soon as the current child&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># producing the RDB file finishes its work. With diskless replication instead&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># once the transfer starts, new replicas arriving will be queued and a new&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># transfer will start when the current one terminates.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When diskless replication is used, the master waits a configurable amount of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># time (in seconds) before starting the transfer in the hope that multiple&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replicas will arrive and the transfer can be parallelized.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># With slow disks and fast (large bandwidth) networks, diskless replication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># works better.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">repl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">diskless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sync&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When diskless replication is enabled, it is possible to configure the delay&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the server waits in order to spawn the child that transfers the RDB via socket&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to the replicas.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is important since once the transfer starts, it is not possible to serve&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># new replicas arriving, that will be queued for the next RDB transfer, so the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server waits a delay in order to let more replicas arrive.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The delay is specified in seconds, and by default is 5 seconds. To disable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it entirely just set it to 0 seconds and the transfer will start ASAP.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">repl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">diskless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sync&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">delay&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When diskless replication is enabled with a delay, it is possible to let&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the replication start before the maximum delay is reached if the maximum&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># number of replicas expected have connected. Default of 0 means that the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maximum is not defined and Redis will wait the full delay.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">repl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">diskless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sync&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">replicas&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -----------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># WARNING: RDB diskless load is experimental. Since in this setup the replica&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># does not immediately store an RDB on disk, it may cause data loss during&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># failovers. RDB diskless load + Redis modules not handling I/O reads may also&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cause Redis to abort in case of I/O errors during the initial synchronization&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># stage with the master. Use only if you know what you are doing.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -----------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Replica can load the RDB it reads from the replication link directly from the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># socket, or store the RDB to a file and read that file after it was completely&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># received from the master.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In many cases the disk is slower than the network, and storing and loading&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the RDB file may increase replication time (and even increase the master&amp;#39;s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Copy on Write memory and replica buffers).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># However, parsing the RDB file directly from the socket may mean that we have&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to flush the contents of the current database before the full rdb was&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># received. For this reason we have the following options:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;disabled&amp;#34; - Don&amp;#39;t use diskless load (store the rdb file to the disk first)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;on-empty-db&amp;#34; - Use diskless load only when it is completely safe.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;swapdb&amp;#34; - Keep current db contents in RAM while parsing the data directly&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># from the socket. Replicas in this mode can keep serving current&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># data set while replication is in progress, except for cases where&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># they can&amp;#39;t recognize master as having a data set from same&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replication history.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that this requires sufficient memory, if you don&amp;#39;t have it,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># you risk an OOM kill.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">repl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">diskless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">load&lt;/span> &lt;span class="n">disabled&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Master send PINGs to its replicas in a predefined interval. It&amp;#39;s possible to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># change this interval with the repl_ping_replica_period option. The default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># value is 10 seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># repl-ping-replica-period 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The following option sets the replication timeout for:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) Bulk transfer I/O during SYNC, from the point of view of replica.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) Master timeout from the point of view of replicas (data, pings).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3) Replica timeout from the point of view of masters (REPLCONF ACK pings).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is important to make sure that this value is greater than the value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># specified for repl-ping-replica-period otherwise a timeout will be detected&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># every time there is low traffic between the master and the replica. The default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># value is 60 seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># repl-timeout 60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Disable TCP_NODELAY on the replica socket after SYNC?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If you select &amp;#34;yes&amp;#34; Redis will use a smaller number of TCP packets and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># less bandwidth to send data to replicas. But this can add a delay for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the data to appear on the replica side, up to 40 milliseconds with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Linux kernels using a default configuration.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If you select &amp;#34;no&amp;#34; the delay for data to appear on the replica side will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># be reduced but more bandwidth will be used for replication.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default we optimize for low latency, but in very high traffic conditions&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or when the master and replicas are many hops away, turning this to &amp;#34;yes&amp;#34; may&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># be a good idea.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">repl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">disable&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tcp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">nodelay&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set the replication backlog size. The backlog is a buffer that accumulates&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica data when replicas are disconnected for some time, so that when a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica wants to reconnect again, often a full resync is not needed, but a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># partial resync is enough, just passing the portion of data the replica&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># missed while disconnected.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The bigger the replication backlog, the longer the replica can endure the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disconnect and later be able to perform a partial resynchronization.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The backlog is only allocated if there is at least one replica connected.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># repl-backlog-size 1mb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># After a master has no connected replicas for some time, the backlog will be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># freed. The following option configures the amount of seconds that need to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># elapse, starting from the time the last replica disconnected, for the backlog&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># buffer to be freed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that replicas never free the backlog for timeout, since they may be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># promoted to masters later, and should be able to correctly &amp;#34;partially&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># resynchronize&amp;#34; with other replicas: hence they should always accumulate backlog.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A value of 0 means to never release the backlog.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># repl-backlog-ttl 3600&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The replica priority is an integer number published by Redis in the INFO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># output. It is used by Redis Sentinel in order to select a replica to promote&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># into a master if the master is no longer working correctly.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A replica with a low priority number is considered better for promotion, so&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for instance if there are three replicas with priority 10, 100, 25 Sentinel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will pick the one with priority 10, that is the lowest.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># However a special priority of 0 marks the replica as not able to perform the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># role of master, so a replica with priority of 0 will never be selected by&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis Sentinel for promotion.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default the priority is 100.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">replica&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">priority&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The propagation error behavior controls how Redis will behave when it is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unable to handle a command being processed in the replication stream from a master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or processed while reading from an AOF file. Errors that occur during propagation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are unexpected, and can cause data inconsistency. However, there are edge cases&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in earlier versions of Redis where it was possible for the server to replicate or persist&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># commands that would fail on future versions. For this reason the default behavior&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is to ignore such errors and continue processing commands.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If an application wants to ensure there is no data divergence, this configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># should be set to &amp;#39;panic&amp;#39; instead. The value can also be set to &amp;#39;panic-on-replicas&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to only panic when a replica encounters an error on the replication stream. One of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># these two panic values will become the default value in the future once there are&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sufficient safety mechanisms in place to prevent false positive crashes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># propagation-error-behavior ignore&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Replica ignore disk write errors controls the behavior of a replica when it is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unable to persist a write command received from its master to disk. By default,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this configuration is set to &amp;#39;no&amp;#39; and will crash the replica in this condition.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is not recommended to change this default, however in order to be compatible&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with older versions of Redis this config can be toggled to &amp;#39;yes&amp;#39; which will just&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># log a warning and execute the write command it got from the master.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica-ignore-disk-write-errors no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -----------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, Redis Sentinel includes all replicas in its reports. A replica&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># can be excluded from Redis Sentinel&amp;#39;s announcements. An unannounced replica&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will be ignored by the &amp;#39;sentinel replicas &amp;lt;master&amp;gt;&amp;#39; command and won&amp;#39;t be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># exposed to Redis Sentinel&amp;#39;s clients.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This option does not change the behavior of replica-priority. Even with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica-announced set to &amp;#39;no&amp;#39;, the replica can be promoted to master. To&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># prevent this behavior, set replica-priority to 0.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica-announced yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is possible for a master to stop accepting writes if there are less than&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># N replicas connected, having a lag less or equal than M seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The N replicas need to be in &amp;#34;online&amp;#34; state.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The lag in seconds, that must be &amp;lt;= the specified value, is calculated from&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the last ping received from the replica, that is usually sent every second.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This option does not GUARANTEE that N replicas will accept the write, but&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will limit the window of exposure for lost writes in case not enough replicas&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are available, to the specified number of seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For example to require at least 3 replicas with a lag &amp;lt;= 10 seconds use:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># min-replicas-to-write 3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># min-replicas-max-lag 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Setting one or the other to 0 disables the feature.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default min-replicas-to-write is set to 0 (feature disabled) and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># min-replicas-max-lag is set to 10.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A Redis master is able to list the address and port of the attached&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replicas in different ways. For example the &amp;#34;INFO replication&amp;#34; section&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># offers this information, which is used, among other tools, by&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis Sentinel in order to discover replica instances.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Another place where this info is available is in the output of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;ROLE&amp;#34; command of a master.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The listed IP address and port normally reported by a replica is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># obtained in the following way:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IP: The address is auto detected by checking the peer address&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of the socket used by the replica to connect with the master.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Port: The port is communicated by the replica during the replication&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># handshake, and is normally the port that the replica is using to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># listen for connections.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># However when port forwarding or Network Address Translation (NAT) is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># used, the replica may actually be reachable via different IP and port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># pairs. The following two options can be used by a replica in order to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># report to its master a specific set of IP and port, so that both INFO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and ROLE will report those values.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># There is no need to use both the options if you need to override just&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the port or the IP address.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica-announce-ip 5.5.5.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica-announce-port 1234&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">############################### KEYS TRACKING #################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis implements server assisted support for client side caching of values.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is implemented using an invalidation table that remembers, using&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a radix key indexed by key name, what clients have which keys. In turn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this is used in order to send invalidation messages to clients. Please&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># check this page to understand more about the feature:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://redis.io/topics/client-side-caching&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When tracking is enabled for a client, all the read only queries are assumed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to be cached: this will force Redis to store information in the invalidation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># table. When keys are modified, such information is flushed away, and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># invalidation messages are sent to the clients. However if the workload is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># heavily dominated by reads, Redis could use more and more memory in order&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to track the keys fetched by many clients.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For this reason it is possible to configure a maximum fill value for the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># invalidation table. By default it is set to 1M of keys, and once this limit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is reached, Redis will start to evict keys in the invalidation table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># even if they were not modified, just to reclaim memory: this will in turn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># force the clients to invalidate the cached values. Basically the table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maximum size is a trade off between the memory you want to spend server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># side to track information about who cached what, and the ability of clients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to retain cached objects in memory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If you set the value to 0, it means there are no limits, and Redis will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># retain as many keys as needed in the invalidation table.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In the &amp;#34;stats&amp;#34; INFO section, you can find information about the number of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># keys in the invalidation table at every given moment.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note: when key tracking is used in broadcasting mode, no memory is used&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in the server side so this setting is useless.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tracking-table-max-keys 1000000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## SECURITY ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Warning: since Redis is pretty fast, an outside user can try up to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1 million passwords per second against a modern box. This means that you&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># should use very strong passwords, otherwise they will be very easy to break.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that because the password is really a shared secret between the client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and the server, and should not be memorized by any human, the password&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># can be easily a long string from /dev/urandom or whatever, so by using a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># long and unguessable password no brute force attack will be possible.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis ACL users are defined in the following format:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user &amp;lt;username&amp;gt; ... acl rules ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For example:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user worker +@list +@connection ~jobs:* on &amp;gt;ffa9203c493aa99&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The special username &amp;#34;default&amp;#34; is used for new connections. If this user&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># has the &amp;#34;nopass&amp;#34; rule, then new connections will be immediately authenticated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># as the &amp;#34;default&amp;#34; user without the need of any password provided via the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># AUTH command. Otherwise if the &amp;#34;default&amp;#34; user is not flagged with &amp;#34;nopass&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the connections will start in not authenticated state, and will require&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># AUTH (or the HELLO command AUTH option) in order to be authenticated and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># start to work.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The ACL rules that describe what a user can do are the following:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on Enable the user: it is possible to authenticate as this user.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># off Disable the user: it&amp;#39;s no longer possible to authenticate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with this user, however the already authenticated connections&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will still work.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># skip-sanitize-payload RESTORE dump-payload sanitization is skipped.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sanitize-payload RESTORE dump-payload is sanitized (default).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +&amp;lt;command&amp;gt; Allow the execution of that command.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># May be used with `|` for allowing subcommands (e.g &amp;#34;+config|get&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -&amp;lt;command&amp;gt; Disallow the execution of that command.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># May be used with `|` for blocking subcommands (e.g &amp;#34;-config|set&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +@&amp;lt;category&amp;gt; Allow the execution of all the commands in such category&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with valid categories are like @admin, @set, @sortedset, ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and so forth, see the full list in the server.c file where&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the Redis command table is described and defined.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The special category @all means all the commands, but currently&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># present in the server, and that will be loaded in the future&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># via modules.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +&amp;lt;command&amp;gt;|first-arg Allow a specific first argument of an otherwise&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disabled command. It is only supported on commands with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># no sub-commands, and is not allowed as negative form&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># like -SELECT|1, only additive starting with &amp;#34;+&amp;#34;. This&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># feature is deprecated and may be removed in the future.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allcommands Alias for +@all. Note that it implies the ability to execute&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># all the future commands loaded via the modules system.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nocommands Alias for -@all.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ~&amp;lt;pattern&amp;gt; Add a pattern of keys that can be mentioned as part of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># commands. For instance ~* allows all the keys. The pattern&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is a glob-style pattern like the one of KEYS.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is possible to specify multiple patterns.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># %R~&amp;lt;pattern&amp;gt; Add key read pattern that specifies which keys can be read &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># from.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># %W~&amp;lt;pattern&amp;gt; Add key write pattern that specifies which keys can be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># written to. &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allkeys Alias for ~*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># resetkeys Flush the list of allowed keys patterns.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;amp;&amp;lt;pattern&amp;gt; Add a glob-style pattern of Pub/Sub channels that can be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># accessed by the user. It is possible to specify multiple channel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># patterns.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allchannels Alias for &amp;amp;*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># resetchannels Flush the list of allowed channel patterns.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;gt;&amp;lt;password&amp;gt; Add this password to the list of valid password for the user.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For example &amp;gt;mypass will add &amp;#34;mypass&amp;#34; to the list.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This directive clears the &amp;#34;nopass&amp;#34; flag (see later).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;lt;&amp;lt;password&amp;gt; Remove this password from the list of valid passwords.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nopass All the set passwords of the user are removed, and the user&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is flagged as requiring no password: it means that every&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># password will work against this user. If this directive is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># used for the default user, every new connection will be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># immediately authenticated with the default user without&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># any explicit AUTH command required. Note that the &amp;#34;resetpass&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># directive will clear this condition.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># resetpass Flush the list of allowed passwords. Moreover removes the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;nopass&amp;#34; status. After &amp;#34;resetpass&amp;#34; the user has no associated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># passwords and there is no way to authenticate without adding&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># some password (or setting it as &amp;#34;nopass&amp;#34; later).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># reset Performs the following actions: resetpass, resetkeys, off,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -@all. The user returns to the same state it has immediately&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># after its creation.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (&amp;lt;options&amp;gt;) Create a new selector with the options specified within the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># parentheses and attach it to the user. Each option should be &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># space separated. The first character must be ( and the last &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># character must be ).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># clearselectors Remove all of the currently attached selectors. &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note this does not change the &amp;#34;root&amp;#34; user permissions,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># which are the permissions directly applied onto the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user (outside the parentheses).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ACL rules can be specified in any order: for instance you can start with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># passwords, then flags, or key patterns. However note that the additive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and subtractive rules will CHANGE MEANING depending on the ordering.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For instance see the following example:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user alice on +@all -DEBUG ~* &amp;gt;somepassword&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This will allow &amp;#34;alice&amp;#34; to use all the commands with the exception of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># DEBUG command, since +@all added all the commands to the set of the commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># alice can use, and later DEBUG was removed. However if we invert the order&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of two ACL rules the result will be different:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user alice on -DEBUG +@all ~* &amp;gt;somepassword&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Now DEBUG was removed when alice had yet no commands in the set of allowed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># commands, later all the commands are added, so the user will be able to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># execute everything.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Basically ACL rules are processed left-to-right.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The following is a list of command categories and their meanings:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * keyspace - Writing or reading from keys, databases, or their metadata &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in a type agnostic way. Includes DEL, RESTORE, DUMP, RENAME, EXISTS, DBSIZE,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># KEYS, EXPIRE, TTL, FLUSHALL, etc. Commands that may modify the keyspace,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># key or metadata will also have `write` category. Commands that only read&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the keyspace, key or metadata will have the `read` category.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * read - Reading from keys (values or metadata). Note that commands that don&amp;#39;t&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># interact with keys, will not have either `read` or `write`.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * write - Writing to keys (values or metadata)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * admin - Administrative commands. Normal applications will never need to use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># these. Includes REPLICAOF, CONFIG, DEBUG, SAVE, MONITOR, ACL, SHUTDOWN, etc.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * dangerous - Potentially dangerous (each should be considered with care for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># various reasons). This includes FLUSHALL, MIGRATE, RESTORE, SORT, KEYS,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># CLIENT, DEBUG, INFO, CONFIG, SAVE, REPLICAOF, etc.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * connection - Commands affecting the connection or other connections.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This includes AUTH, SELECT, COMMAND, CLIENT, ECHO, PING, etc.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * blocking - Potentially blocking the connection until released by another&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># command.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * fast - Fast O(1) commands. May loop on the number of arguments, but not the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># number of elements in the key.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * slow - All commands that are not Fast.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * pubsub - PUBLISH / SUBSCRIBE related&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * transaction - WATCH / MULTI / EXEC related commands.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * scripting - Scripting related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * set - Data type: sets related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * sortedset - Data type: zsets related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * list - Data type: lists related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * hash - Data type: hashes related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * string - Data type: strings related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * bitmap - Data type: bitmaps related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * hyperloglog - Data type: hyperloglog related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * geo - Data type: geo related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * stream - Data type: streams related.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For more information about ACL configuration please refer to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the Redis web site at https://redis.io/topics/acl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ACL LOG&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The ACL Log tracks failed commands and authentication events associated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with ACLs. The ACL Log is useful to troubleshoot failed commands blocked&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># by ACLs. The ACL Log is stored in memory. You can reclaim memory with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ACL LOG RESET. Define the maximum entry length of the ACL Log below.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acllog&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">len&lt;/span> &lt;span class="mi">128&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Using an external ACL file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Instead of configuring users here in this file, it is possible to use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a stand-alone file just listing users. The two methods cannot be mixed:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># if you configure users here and at the same time you activate the external&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ACL file, the server will refuse to start.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The format of the external ACL user file is exactly the same as the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># format that is used inside redis.conf to describe users.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># aclfile /etc/redis/users.acl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IMPORTANT NOTE: starting with Redis 6 &amp;#34;requirepass&amp;#34; is just a compatibility&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># layer on top of the new ACL system. The option effect will be just setting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the password for the default user. Clients will still authenticate using&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># AUTH &amp;lt;password&amp;gt; as usually, or more explicitly with AUTH default &amp;lt;password&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># if they follow the new protocol: both will work.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The requirepass is not compatible with aclfile option and the ACL LOAD&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># command, these will cause requirepass to be ignored.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># requirepass foobared&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># New users are initialized with restrictive permissions by default, via the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># equivalent of this ACL rule &amp;#39;off resetkeys -@all&amp;#39;. Starting with Redis 6.2, it&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is possible to manage access to Pub/Sub channels with ACL rules as well. The&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># default Pub/Sub channels permission if new users is controlled by the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># acl-pubsub-default configuration directive, which accepts one of these values:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allchannels: grants access to all Pub/Sub channels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># resetchannels: revokes access to all Pub/Sub channels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># From Redis 7.0, acl-pubsub-default defaults to &amp;#39;resetchannels&amp;#39; permission.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># acl-pubsub-default resetchannels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Command renaming (DEPRECATED).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># WARNING: avoid using this option if possible. Instead use ACLs to remove&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># commands from the default user, and put them only in some admin user you&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># create for administrative purposes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is possible to change the name of dangerous commands in a shared&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># environment. For instance the CONFIG command may be renamed into something&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># hard to guess so that it will still be available for internal-use tools&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># but not available for general clients.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is also possible to completely kill a command by renaming it into&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># an empty string:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># rename-command CONFIG &amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Please note that changing the name of commands that are logged into the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># AOF file or transmitted to replicas may cause problems.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################### CLIENTS ####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set the max number of connected clients at the same time. By default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this limit is set to 10000 clients, however if the Redis server is not&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># able to configure the process file limit to allow for the specified limit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the max number of allowed clients is set to the current file limit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># minus 32 (as Redis reserves a few file descriptors for internal uses).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Once the limit is reached Redis will close all the new connections sending&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># an error &amp;#39;max number of clients reached&amp;#39;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># IMPORTANT: When Redis Cluster is used, the max number of connections is also&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># shared with the cluster bus: every node in the cluster will use two&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># connections, one incoming and another outgoing. It is important to size the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># limit accordingly in case of very large clusters.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maxclients 10000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">############################## MEMORY MANAGEMENT ################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set a memory usage limit to the specified amount of bytes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When the memory limit is reached Redis will try to remove keys&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># according to the eviction policy selected (see maxmemory-policy).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If Redis can&amp;#39;t remove keys according to the policy, or if the policy is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set to &amp;#39;noeviction&amp;#39;, Redis will start to reply with errors to commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that would use more memory, like SET, LPUSH, and so on, and will continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to reply to read-only commands like GET.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This option is usually useful when using Redis as an LRU or LFU cache, or to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set a hard memory limit for an instance (using the &amp;#39;noeviction&amp;#39; policy).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># WARNING: If you have replicas attached to an instance with maxmemory on,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the size of the output buffers needed to feed the replicas are subtracted&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># from the used memory count, so that network problems / resyncs will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># not trigger a loop where keys are evicted, and in turn the output&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># buffer of replicas is full with DELs of keys evicted triggering the deletion&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of more keys, and so forth until the database is completely emptied.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In short... if you have replicas attached it is suggested that you set a lower&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># limit for maxmemory so that there is some free RAM on the system for replica&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># output buffers (but this is not needed if the policy is &amp;#39;noeviction&amp;#39;).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maxmemory &amp;lt;bytes&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is reached. You can select one from the following behaviors:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># volatile-lru -&amp;gt; Evict using approximated LRU, only keys with an expire set.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allkeys-lru -&amp;gt; Evict any key using approximated LRU.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># volatile-lfu -&amp;gt; Evict using approximated LFU, only keys with an expire set.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allkeys-lfu -&amp;gt; Evict any key using approximated LFU.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># volatile-random -&amp;gt; Remove a random key having an expire set.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># allkeys-random -&amp;gt; Remove a random key, any key.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># volatile-ttl -&amp;gt; Remove the key with the nearest expire time (minor TTL)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># noeviction -&amp;gt; Don&amp;#39;t evict anything, just return an error on write operations.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># LRU means Least Recently Used&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># LFU means Least Frequently Used&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Both LRU, LFU and volatile-ttl are implemented using approximated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># randomized algorithms.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note: with any of the above policies, when there are no suitable keys for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># eviction, Redis will return an error on write operations that require&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># more memory. These are usually commands that create new keys, add data or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># modify existing keys. A few examples are: SET, INCR, HSET, LPUSH, SUNIONSTORE,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># SORT (due to the STORE argument), and EXEC (if the transaction includes any&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># command that requires memory).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default is:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maxmemory-policy noeviction&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># algorithms (in order to save memory), so you can tune it for speed or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># accuracy. By default Redis will check five keys and pick the one that was&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># used least recently, you can change the sample size using the following&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configuration directive.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default of 5 produces good enough results. 10 Approximates very closely&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># true LRU but costs more CPU. 3 is faster but not very accurate.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maxmemory-samples 5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Eviction processing is designed to function well with the default setting.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If there is an unusually large amount of write traffic, this value may need to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># be increased. Decreasing this value may reduce latency at the risk of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># eviction processing effectiveness&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 0 = minimum latency, 10 = default, 100 = process without regard to latency&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maxmemory-eviction-tenacity 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Starting from Redis 5, by default a replica will ignore its maxmemory setting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (unless it is promoted to master after a failover or manually). It means&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that the eviction of keys will be just handled by the master, sending the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># DEL commands to the replica as keys evict in the master side.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This behavior ensures that masters and replicas stay consistent, and is usually&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># what you want, however if your replica is writable, or you want the replica&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to have a different memory setting, and you are sure all the writes performed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to the replica are idempotent, then you may change this default (but be sure&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to understand what you are doing).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that since the replica by default does not evict, it may end using more&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># memory than the one set via maxmemory (there are certain buffers that may&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># be larger on the replica, or data structures may sometimes take more memory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and so forth). So make sure you monitor your replicas and make sure they&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># have enough memory to never hit a real out-of-memory condition before the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master hits the configured maxmemory setting.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica-ignore-maxmemory yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis reclaims expired keys in two ways: upon access when those keys are&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># found to be expired, and also in background, in what is called the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;active expire key&amp;#34;. The key space is slowly and interactively scanned&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># looking for expired keys to reclaim, so that it is possible to free memory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of keys that are expired and will never be accessed again in a short time.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default effort of the expire cycle will try to avoid having more than&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ten percent of expired keys still in memory, and will try to avoid consuming&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># more than 25% of total memory and to add latency to the system. However&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it is possible to increase the expire &amp;#34;effort&amp;#34; that is normally set to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;1&amp;#34;, to a greater value, up to the value &amp;#34;10&amp;#34;. At its maximum value the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># system will use more CPU, longer cycles (and technically may introduce&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># more latency), and will tolerate less already expired keys still present&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in the system. It&amp;#39;s a tradeoff between memory, CPU and latency.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># active-expire-effort 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">############################# LAZY FREEING ####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis has two primitives to delete keys. One is called DEL and is a blocking&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># deletion of the object. It means that the server stops processing new commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to reclaim all the memory associated with an object in a synchronous&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># way. If the key deleted is associated with a small object, the time needed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to execute the DEL command is very small and comparable to most other&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># O(1) or O(log_N) commands in Redis. However if the key is associated with an&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># aggregated value containing millions of elements, the server can block for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a long time (even seconds) in order to complete the operation.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For the above reasons Redis also offers non blocking deletion primitives&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># FLUSHDB commands, in order to reclaim memory in background. Those commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are executed in constant time. Another thread will incrementally free the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># object in the background as fast as possible.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It&amp;#39;s up to the design of the application to understand when it is a good&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># idea to use one or the other. However the Redis server sometimes has to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># delete keys or flush the whole database as a side effect of other operations.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specifically Redis deletes objects independently of a user call in the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># following scenarios:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) On eviction, because of the maxmemory and maxmemory policy configurations,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to make room for new data, without going over the specified&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># memory limit.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) Because of expire: when a key with an associated time to live (see the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># EXPIRE command) must be deleted from memory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3) Because of a side effect of a command that stores data on a key that may&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># already exist. For example the RENAME command may delete the old key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># content when it is replaced with another one. Similarly SUNIONSTORE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or SORT with STORE option may delete existing keys. The SET command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># itself removes any old content of the specified key in order to replace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it with the specified string.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4) During replication, when a replica performs a full resynchronization with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># its master, the content of the whole database is removed in order to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># load the RDB file just transferred.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In all the above cases the default is to delete objects in a blocking way,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># like if DEL was called. However you can configure each case specifically&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to instead release memory in a non-blocking way like if UNLINK&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># was called, using the following configuration directives.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lazyfree&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lazy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">eviction&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lazyfree&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lazy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">expire&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lazyfree&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lazy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">del&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">replica&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lazy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">flush&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is also possible, for the case when to replace the user code DEL calls&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with UNLINK calls is not easy, to modify the default behavior of the DEL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># command to act exactly like UNLINK, using the following configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># directive:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lazyfree&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lazy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">del&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># FLUSHDB, FLUSHALL, SCRIPT FLUSH and FUNCTION FLUSH support both asynchronous and synchronous&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># deletion, which can be controlled by passing the [SYNC|ASYNC] flags into the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># commands. When neither flag is passed, this directive will be used to determine&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># if the data should be deleted asynchronously.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lazyfree&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">lazy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">flush&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ THREADED I/O #################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis is mostly single threaded, however there are certain threaded&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># operations such as UNLINK, slow I/O accesses and other things that are&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># performed on side threads.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Now it is also possible to handle Redis clients socket reads and writes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in different I/O threads. Since especially writing is so slow, normally&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis users use pipelining in order to speed up the Redis performances per&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># core, and spawn multiple instances in order to scale more. Using I/O&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># threads it is possible to easily speedup two times Redis without resorting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to pipelining nor sharding of the instance.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default threading is disabled, we suggest enabling it only in machines&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that have at least 4 or more cores, leaving at least one spare core.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Using more than 8 threads is unlikely to help much. We also recommend using&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># threaded I/O only if you actually have performance problems, with Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># instances being able to use a quite big percentage of CPU time, otherwise&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># there is no point in using this feature.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># So for instance if you have a four cores boxes, try to use 2 or 3 I/O&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># threads, if you have a 8 cores, try to use 6 threads. In order to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enable I/O threads use the following configuration directive:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># io-threads 4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Setting io-threads to 1 will just use the main thread as usual.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When I/O threads are enabled, we only use threads for writes, that is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to thread the write(2) syscall and transfer the client buffers to the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># socket. However it is also possible to enable threading of reads and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># protocol parsing using the following configuration directive, by setting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it to yes:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># io-threads-do-reads no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Usually threading reads doesn&amp;#39;t help much.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NOTE 1: This configuration directive cannot be changed at runtime via&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># CONFIG SET. Also, this feature currently does not work when SSL is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enabled.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NOTE 2: If you want to test the Redis speedup using redis-benchmark, make&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sure you also run the benchmark itself in threaded mode, using the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --threads option to match the number of Redis threads, otherwise you&amp;#39;ll not&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># be able to notice the improvements.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">############################ KERNEL OOM CONTROL ##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># On Linux, it is possible to hint the kernel OOM killer on what processes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># should be killed first when out of memory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Enabling this feature makes Redis actively control the oom_score_adj value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for all its processes, depending on their role. The default scores will&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># attempt to have background child processes killed before all others, and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replicas killed before masters.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis supports these options:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># no: Don&amp;#39;t make changes to oom-score-adj (default).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># yes: Alias to &amp;#34;relative&amp;#34; see below.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># absolute: Values in oom-score-adj-values are written as is to the kernel.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># relative: Values are used relative to the initial value of oom_score_adj when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the server starts and are then clamped to a range of -1000 to 1000.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Because typically the initial value is 0, they will often match the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># absolute values.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">oom&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">score&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">adj&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When oom-score-adj is used, this directive controls the specific values used&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for master, replica and background child processes. Values range -2000 to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2000 (higher means more likely to be killed).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Unprivileged processes (not root, and without CAP_SYS_RESOURCE capabilities)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># can freely increase their value, but not decrease it below its initial&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># settings. This means that setting oom-score-adj to &amp;#34;relative&amp;#34; and setting the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># oom-score-adj-values to positive values will always succeed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">oom&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">score&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">adj&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">values&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="mi">800&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#################### KERNEL transparent hugepage CONTROL ######################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Usually the kernel Transparent Huge Pages control is set to &amp;#34;madvise&amp;#34; or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or &amp;#34;never&amp;#34; by default (/sys/kernel/mm/transparent_hugepage/enabled), in which&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># case this config has no effect. On systems in which it is set to &amp;#34;always&amp;#34;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># redis will attempt to disable it specifically for the redis process in order&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to avoid latency problems specifically with fork(2) and CoW.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If for some reason you prefer to keep it enabled, you can set this config to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;no&amp;#34; and the kernel global to &amp;#34;always&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">disable&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">thp&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">############################## APPEND ONLY MODE ###############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default Redis asynchronously dumps the dataset on disk. This mode is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># good enough in many applications, but an issue with the Redis process or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a power outage may result into a few minutes of writes lost (depending on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the configured save points).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The Append Only File is an alternative persistence mode that provides&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># much better durability. For instance using the default data fsync policy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (see later in the config file) Redis can lose just one second of writes in a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dramatic event like a server power outage, or a single write if something&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># wrong with the Redis process itself happens, but the operating system is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># still running correctly.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># AOF and RDB persistence can be enabled at the same time without problems.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the AOF is enabled on startup Redis will load the AOF, that is the file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># with the better durability guarantees.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Please check https://redis.io/topics/persistence for more information.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-appendonly no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The base name of the append only file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis 7 and newer use a set of append-only files to persist the dataset&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and changes applied to it. There are two basic types of files in use:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - Base files, which are a snapshot representing the complete state of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dataset at the time the file was created. Base files can be either in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the form of RDB (binary serialized) or AOF (textual commands).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - Incremental files, which contain additional commands that were applied&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to the dataset following the previous file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In addition, manifest files are used to track the files and the order in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># which they were created and should be applied.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Append-only file names are created by Redis following a specific pattern.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The file name&amp;#39;s prefix is based on the &amp;#39;appendfilename&amp;#39; configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># parameter, followed by additional information about the sequence and type.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For example, if appendfilename is set to appendonly.aof, the following file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># names could be derived:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - appendonly.aof.1.base.rdb as a base file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - appendonly.aof.1.incr.aof, appendonly.aof.2.incr.aof as incremental files.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - appendonly.aof.manifest as a manifest file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">appendfilename&lt;/span> &lt;span class="s2">&amp;#34;appendonly.aof&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For convenience, Redis stores all persistent append-only files in a dedicated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># directory. The name of the directory is determined by the appenddirname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configuration parameter.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">appenddirname&lt;/span> &lt;span class="s2">&amp;#34;appendonlydir&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The fsync() call tells the Operating System to actually write data on disk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># instead of waiting for more data in the output buffer. Some OS will really flush&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># data on disk, some other OS will just try to do it ASAP.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis supports three different modes:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># no: don&amp;#39;t fsync, just let the OS flush the data when it wants. Faster.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># always: fsync after every write to the append only log. Slow, Safest.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># everysec: fsync only one time every second. Compromise.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default is &amp;#34;everysec&amp;#34;, as that&amp;#39;s usually the right compromise between&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># speed and data safety. It&amp;#39;s up to you to understand if you can relax this to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;no&amp;#34; that will let the operating system flush the output buffer when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it wants, for better performances (but if you can live with the idea of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># some data loss consider the default persistence mode that&amp;#39;s snapshotting),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or on the contrary, use &amp;#34;always&amp;#34; that&amp;#39;s very slow but a bit safer than&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># everysec.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># More details please check the following article:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># http://antirez.com/post/redis-persistence-demystified.html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If unsure, use &amp;#34;everysec&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># appendfsync always&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">appendfsync&lt;/span> &lt;span class="n">everysec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># appendfsync no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When the AOF fsync policy is set to always or everysec, and a background&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># saving process (a background save or AOF log background rewriting) is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># performing a lot of I/O against the disk, in some Linux configurations&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis may block too long on the fsync() call. Note that there is no fix for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this currently, as even performing fsync in a different thread will block&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># our synchronous write(2) call.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In order to mitigate this problem it&amp;#39;s possible to use the following option&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that will prevent fsync() from being called in the main process while a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># BGSAVE or BGREWRITEAOF is in progress.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This means that while another child is saving, the durability of Redis is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the same as &amp;#34;appendfsync no&amp;#34;. In practical terms, this means that it is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># possible to lose up to 30 seconds of log in the worst scenario (with the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># default Linux settings).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If you have latency problems turn this to &amp;#34;yes&amp;#34;. Otherwise leave it as&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;no&amp;#34; that is the safest pick from the point of view of durability.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">appendfsync&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rewrite&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Automatic rewrite of the append only file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis is able to automatically rewrite the log file implicitly calling&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># BGREWRITEAOF when the AOF log size grows by the specified percentage.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is how it works: Redis remembers the size of the AOF file after the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># latest rewrite (if no rewrite has happened since the restart, the size of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the AOF at startup is used).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This base size is compared to the current size. If the current size is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bigger than the specified percentage, the rewrite is triggered. Also&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># you need to specify a minimal size for the AOF file to be rewritten, this&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is useful to avoid rewriting the AOF file even if the percentage increase&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is reached but it is still pretty small.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Specify a percentage of zero in order to disable the automatic AOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># rewrite feature.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">auto&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aof&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rewrite&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">percentage&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">auto&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aof&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rewrite&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">min&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="n">mb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># An AOF file may be found to be truncated at the end during the Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># startup process, when the AOF data gets loaded back into memory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This may happen when the system where Redis is running&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># crashes, especially when an ext4 filesystem is mounted without the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># data=ordered option (however this can&amp;#39;t happen when Redis itself&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># crashes or aborts but the operating system still works correctly).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis can either exit with an error when this happens, or load as much&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># data as possible (the default now) and start if the AOF file is found&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to be truncated at the end. The following option controls this behavior.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the Redis server starts emitting a log to inform the user of the event.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Otherwise if the option is set to no, the server aborts with an error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and refuses to start. When the option is set to no, the user requires&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to fix the AOF file using the &amp;#34;redis-check-aof&amp;#34; utility before to restart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the server.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that if the AOF file will be found to be corrupted in the middle&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the server will still exit with an error. This option only applies when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis will try to read more data from the AOF file but not enough bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will be found.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">aof&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">truncated&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis can create append-only base files in either RDB or AOF formats. Using&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the RDB format is always faster and more efficient, and disabling it is only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># supported for backward compatibility purposes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">aof&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">use&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rdb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">preamble&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis supports recording timestamp annotations in the AOF to support restoring&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the data from a specific point-in-time. However, using this capability changes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the AOF format in a way that may not be compatible with existing AOF parsers.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">aof&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">timestamp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">enabled&lt;/span> &lt;span class="n">no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ SHUTDOWN #####################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Maximum time to wait for replicas when shutting down, in seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># During shut down, a grace period allows any lagging replicas to catch up with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the latest replication offset before the master exists. This period can&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># prevent data loss, especially for deployments without configured disk backups.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The &amp;#39;shutdown-timeout&amp;#39; value is the grace period&amp;#39;s duration in seconds. It is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># only applicable when the instance has replicas. To disable the feature, set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the value to 0.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># shutdown-timeout 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When Redis receives a SIGINT or SIGTERM, shutdown is initiated and by default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># an RDB snapshot is written to disk in a blocking operation if save points are configured.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The options used on signaled shutdown can include the following values:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># default: Saves RDB snapshot only if save points are configured.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Waits for lagging replicas to catch up.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># save: Forces a DB saving operation even if no save points are configured.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nosave: Prevents DB saving operation even if one or more save points are configured.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># now: Skips waiting for lagging replicas.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># force: Ignores any errors that would normally prevent the server from exiting.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Any combination of values is allowed as long as &amp;#34;save&amp;#34; and &amp;#34;nosave&amp;#34; are not set simultaneously.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example: &amp;#34;nosave force now&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># shutdown-on-sigint default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># shutdown-on-sigterm default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################ NON-DETERMINISTIC LONG BLOCKING COMMANDS #####################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Maximum time in milliseconds for EVAL scripts, functions and in some cases&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># modules&amp;#39; commands before Redis can start processing or rejecting other clients.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the maximum execution time is reached Redis will start to reply to most&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># commands with a BUSY error.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In this state Redis will only allow a handful of commands to be executed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For instance, SCRIPT KILL, FUNCTION KILL, SHUTDOWN NOSAVE and possibly some&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># module specific &amp;#39;allow-busy&amp;#39; commands.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># SCRIPT KILL and FUNCTION KILL will only be able to stop a script that did not&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># yet call any write commands, so SHUTDOWN NOSAVE may be the only way to stop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the server in the case a write command was already issued by the script when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the user doesn&amp;#39;t want to wait for the natural termination of the script.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default is 5 seconds. It is possible to set it to 0 or a negative value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to disable this mechanism (uninterrupted execution). Note that in the past&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this config had a different name, which is now an alias, so both of these do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the same:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lua-time-limit 5000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># busy-reply-threshold 5000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ REDIS CLUSTER ###############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Normal Redis instances can&amp;#39;t be part of a Redis Cluster; only nodes that are&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># started as cluster nodes can. In order to start a Redis instance as a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster node enable the cluster support uncommenting the following:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-enabled yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Every cluster node has a cluster configuration file. This file is not&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># intended to be edited by hand. It is created and updated by Redis nodes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Every Redis Cluster node requires a different cluster configuration file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Make sure that instances running in the same system do not have&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># overlapping cluster configuration file names.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-config-file nodes-6379.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Cluster node timeout is the amount of milliseconds a node must be unreachable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for it to be considered in failure state.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Most other internal time limits are a multiple of the node timeout.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-node-timeout 15000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The cluster port is the port that the cluster bus will listen for inbound connections on. When set &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to the default value, 0, it will be bound to the command port + 10000. Setting this value requires &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># you to specify the cluster bus port when executing cluster meet.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-port 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A replica of a failing master will avoid to start a failover if its data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># looks too old.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># There is no simple way for a replica to actually have an exact measure of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># its &amp;#34;data age&amp;#34;, so the following two checks are performed:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) If there are multiple replicas able to failover, they exchange messages&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to try to give an advantage to the replica with the best&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replication offset (more data from the master processed).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Replicas will try to get their rank by offset, and apply to the start&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of the failover a delay proportional to their rank.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) Every single replica computes the time of the last interaction with&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># its master. This can be the last ping or command received (if the master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is still in the &amp;#34;connected&amp;#34; state), or the time that elapsed since the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disconnection with the master (if the replication link is currently down).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the last interaction is too old, the replica will not try to failover&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># at all.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The point &amp;#34;2&amp;#34; can be tuned by user. Specifically a replica will not perform&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the failover if, since the last interaction with the master, the time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># elapsed is greater than:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (node-timeout * cluster-replica-validity-factor) + repl-ping-replica-period&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># So for example if node-timeout is 30 seconds, and the cluster-replica-validity-factor&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is 10, and assuming a default repl-ping-replica-period of 10 seconds, the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica will not try to failover if it was not able to talk with the master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for longer than 310 seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A large cluster-replica-validity-factor may allow replicas with too old data to failover&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a master, while a too small value may prevent the cluster from being able to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># elect a replica at all.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For maximum availability, it is possible to set the cluster-replica-validity-factor&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to a value of 0, which means, that replicas will always try to failover the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master regardless of the last time they interacted with the master.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (However they&amp;#39;ll always try to apply a delay proportional to their&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># offset rank).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Zero is the only value able to guarantee that when all the partitions heal&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the cluster will always be able to continue.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-replica-validity-factor 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Cluster replicas are able to migrate to orphaned masters, that are masters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that are left without working replicas. This improves the cluster ability&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to resist to failures as otherwise an orphaned master can&amp;#39;t be failed over&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in case of failure if it has no working replicas.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Replicas migrate to orphaned masters only if there are still at least a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># given number of other working replicas for their old master. This number&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is the &amp;#34;migration barrier&amp;#34;. A migration barrier of 1 means that a replica&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will migrate only if there is at least 1 other working replica for its master&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and so forth. It usually reflects the number of replicas you want for every&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master in your cluster.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Default is 1 (replicas migrate only if their masters remain with at least&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># one replica). To disable migration just set it to a very large value or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set cluster-allow-replica-migration to &amp;#39;no&amp;#39;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A value of 0 can be set but is useful only for debugging and dangerous&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in production.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-migration-barrier 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Turning off this option allows to use less automatic cluster configuration.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It both disables migration to orphaned masters and migration from masters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that became empty.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Default is &amp;#39;yes&amp;#39; (allow automatic migrations).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-allow-replica-migration yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default Redis Cluster nodes stop accepting queries if they detect there&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is at least a hash slot uncovered (no available node is serving it).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This way if the cluster is partially down (for example a range of hash slots&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are no longer covered) all the cluster becomes, eventually, unavailable.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It automatically returns available as soon as all the slots are covered again.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># However sometimes you want the subset of the cluster which is working,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to continue to accept queries for the part of the key space that is still&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># covered. In order to do so, just set the cluster-require-full-coverage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># option to no.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-require-full-coverage yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This option, when set to yes, prevents replicas from trying to failover its&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master during master failures. However the replica can still perform a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># manual failover, if forced to do so.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is useful in different scenarios, especially in the case of multiple&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># data center operations, where we want one side to never be promoted if not&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in the case of a total DC failure.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-replica-no-failover no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This option, when set to yes, allows nodes to serve read traffic while the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster is in a down state, as long as it believes it owns the slots.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is useful for two cases. The first case is for when an application&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># doesn&amp;#39;t require consistency of data during node failures or network partitions.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># One example of this is a cache, where as long as the node has the data it&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># should be able to serve it.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The second use case is for configurations that don&amp;#39;t meet the recommended&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># three shards but want to enable cluster mode and scale later. A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master outage in a 1 or 2 shard configuration causes a read/write outage to the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># entire cluster without this option set, with it set there is only a write outage.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Without a quorum of masters, slot ownership will not change automatically.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-allow-reads-when-down no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This option, when set to yes, allows nodes to serve pubsub shard traffic while&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the cluster is in a down state, as long as it believes it owns the slots.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is useful if the application would like to use the pubsub feature even when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the cluster global stable state is not OK. If the application wants to make sure only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># one shard is serving a given channel, this feature should be kept as yes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-allow-pubsubshard-when-down yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Cluster link send buffer limit is the limit on the memory usage of an individual&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster bus link&amp;#39;s send buffer in bytes. Cluster links would be freed if they exceed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this limit. This is to primarily prevent send buffers from growing unbounded on links&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># toward slow peers (E.g. PubSub messages being piled up).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This limit is disabled by default. Enable this limit when &amp;#39;mem_cluster_links&amp;#39; INFO field&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and/or &amp;#39;send-buffer-allocated&amp;#39; entries in the &amp;#39;CLUSTER LINKS` command output continuously increase.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Minimum limit of 1gb is recommended so that cluster link buffer can fit in at least a single&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PubSub message by default. (client-query-buffer-limit default value is 1gb)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-link-sendbuf-limit 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Clusters can configure their announced hostname using this config. This is a common use case for &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># applications that need to use TLS Server Name Indication (SNI) or dealing with DNS based&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># routing. By default this value is only shown as additional metadata in the CLUSTER SLOTS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># command, but can be changed using &amp;#39;cluster-preferred-endpoint-type&amp;#39; config. This value is &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># communicated along the clusterbus to all nodes, setting it to an empty string will remove &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the hostname and also propagate the removal.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-announce-hostname &amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Clusters can advertise how clients should connect to them using either their IP address,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a user defined hostname, or by declaring they have no endpoint. Which endpoint is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># shown as the preferred endpoint is set by using the cluster-preferred-endpoint-type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># config with values &amp;#39;ip&amp;#39;, &amp;#39;hostname&amp;#39;, or &amp;#39;unknown-endpoint&amp;#39;. This value controls how&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the endpoint returned for MOVED/ASKING requests as well as the first field of CLUSTER SLOTS. &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the preferred endpoint type is set to hostname, but no announced hostname is set, a &amp;#39;?&amp;#39; &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will be returned instead.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When a cluster advertises itself as having an unknown endpoint, it&amp;#39;s indicating that&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the server doesn&amp;#39;t know how clients can reach the cluster. This can happen in certain &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># networking situations where there are multiple possible routes to the node, and the &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server doesn&amp;#39;t know which one the client took. In this case, the server is expecting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the client to reach out on the same endpoint it used for making the last request, but use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the port provided in the response.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-preferred-endpoint-type ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In order to setup your cluster make sure to read the documentation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># available at https://redis.io web site.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">########################## CLUSTER DOCKER/NAT support ########################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In certain deployments, Redis Cluster nodes address discovery fails, because&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># addresses are NAT-ted or because ports are forwarded (the typical case is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Docker and other containers).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In order to make Redis Cluster working in such environments, a static&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configuration where each node knows its public address is needed. The&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># following four options are used for this scope, and are:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * cluster-announce-ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * cluster-announce-port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * cluster-announce-tls-port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># * cluster-announce-bus-port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Each instructs the node about its address, client ports (for connections&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># without and with TLS) and cluster message bus port. The information is then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># published in the header of the bus packets so that other nodes will be able to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># correctly map the address of the node publishing the information.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If cluster-tls is set to yes and cluster-announce-tls-port is omitted or set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to zero, then cluster-announce-port refers to the TLS port. Note also that&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-announce-tls-port has no effect if cluster-tls is set to no.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If the above options are not used, the normal Redis Cluster auto-detection&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will be used instead.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that when remapped, the bus port may not be at the fixed offset of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># clients port + 10000, so you can specify any port and bus-port depending&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># on how they get remapped. If the bus-port is not set, a fixed offset of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 10000 will be used as usual.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-announce-ip 10.1.1.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-announce-tls-port 6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-announce-port 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cluster-announce-bus-port 6380&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################## SLOW LOG ###################################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The Redis Slow Log is a system to log queries that exceeded a specified&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># execution time. The execution time does not include the I/O operations&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># like talking with the client, sending the reply and so forth,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># but just the time needed to actually execute the command (this is the only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># stage of command execution where the thread is blocked and can not serve&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># other requests in the meantime).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># You can configure the slow log with two parameters: one tells Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># what is the execution time, in microseconds, to exceed in order for the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># command to get logged, and the other parameter is the length of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># slow log. When a new command is logged the oldest one is removed from the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># queue of logged commands.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The following time is expressed in microseconds, so 1000000 is equivalent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to one second. Note that a negative number disables the slow log, while&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a value of zero forces the logging of every command.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">slowlog&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">slower&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">than&lt;/span> &lt;span class="mi">10000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># There is no limit to this length. Just be aware that it will consume memory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># You can reclaim memory used by the slow log with SLOWLOG RESET.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">slowlog&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">len&lt;/span> &lt;span class="mi">128&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ LATENCY MONITOR ##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The Redis latency monitoring subsystem samples different operations&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># at runtime in order to collect data related to possible sources of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># latency of a Redis instance.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Via the LATENCY command this information is available to the user that can&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># print graphs and obtain reports.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The system only logs operations that were performed in a time equal or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># greater than the amount of milliseconds specified via the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># latency-monitor-threshold configuration directive. When its value is set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to zero, the latency monitor is turned off.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default latency monitoring is disabled since it is mostly not needed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># if you don&amp;#39;t have latency issues, and collecting data has a performance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># impact, that while very small, can be measured under big load. Latency&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># monitoring can easily be enabled at runtime using the command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># &amp;#34;CONFIG SET latency-monitor-threshold &amp;lt;milliseconds&amp;gt;&amp;#34; if needed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">latency&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">monitor&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">threshold&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">################################ LATENCY TRACKING ##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The Redis extended latency monitoring tracks the per command latencies and enables&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># exporting the percentile distribution via the INFO latencystats command,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and cumulative latency distributions (histograms) via the LATENCY command.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default, the extended latency monitoring is enabled since the overhead&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of keeping track of the command latency is very small.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># latency-tracking yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default the exported latency percentiles via the INFO latencystats command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are the p50, p99, and p999.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># latency-tracking-info-percentiles 50 99 99.9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">############################# EVENT NOTIFICATION ##############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis can notify Pub/Sub clients about events happening in the key space.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This feature is documented at https://redis.io/topics/notifications&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For instance if keyspace events notification is enabled, and a client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># performs a DEL operation on key &amp;#34;foo&amp;#34; stored in the Database 0, two&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># messages will be published via Pub/Sub:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PUBLISH __keyspace@0__:foo del&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PUBLISH __keyevent@0__:del foo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is possible to select the events that Redis will notify among a set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of classes. Every class is identified by a single character:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># K Keyspace events, published with __keyspace@&amp;lt;db&amp;gt;__ prefix.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># E Keyevent events, published with __keyevent@&amp;lt;db&amp;gt;__ prefix.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># g Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># $ String commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># l List commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># s Set commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># h Hash commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># z Sorted set commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># x Expired events (events generated every time a key expires)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># e Evicted events (events generated when a key is evicted for maxmemory)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># n New key events (Note: not included in the &amp;#39;A&amp;#39; class)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># t Stream commands&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># d Module key type events&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># m Key-miss events (Note: It is not included in the &amp;#39;A&amp;#39; class)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A Alias for g$lshzxetd, so that the &amp;#34;AKE&amp;#34; string means all the events&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (Except key-miss events which are excluded from &amp;#39;A&amp;#39; due to their&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># unique nature).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The &amp;#34;notify-keyspace-events&amp;#34; takes as argument a string that is composed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of zero or multiple characters. The empty string means that notifications&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are disabled.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example: to enable list and generic events, from the point of view of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># event name, use:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># notify-keyspace-events Elg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example 2: to get the stream of the expired keys subscribing to channel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># name __keyevent@0__:expired use:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># notify-keyspace-events Ex&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default all notifications are disabled because most users don&amp;#39;t need&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this feature and the feature has some overhead. Note that if you don&amp;#39;t&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># specify at least one of K or E, no events will be delivered.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">notify&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">keyspace&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">events&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">############################### ADVANCED CONFIG ###############################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Hashes are encoded using a memory efficient data structure when they have a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># small number of entries, and the biggest entry does not exceed a given&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># threshold. These thresholds can be configured using the following directives.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">listpack&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">entries&lt;/span> &lt;span class="mi">512&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">listpack&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="mi">64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Lists are also encoded in a special way to save a lot of space.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The number of entries allowed per internal list node can be specified&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># as a fixed maximum size or a maximum number of elements.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For a fixed maximum size, use -5 through -1, meaning:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -5: max size: 64 Kb &amp;lt;-- not recommended for normal workloads&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -4: max size: 32 Kb &amp;lt;-- not recommended&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -3: max size: 16 Kb &amp;lt;-- probably not recommended&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -2: max size: 8 Kb &amp;lt;-- good&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -1: max size: 4 Kb &amp;lt;-- good&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Positive numbers mean store up to _exactly_ that number of elements&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># per list node.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># but if your use case is unique, adjust the settings as necessary.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">listpack&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">size&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Lists may also be compressed.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Compress depth is the number of quicklist ziplist nodes from *each* side of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the list to *exclude* from compression. The head and tail of the list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># are always uncompressed for fast push/pop operations. Settings are:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 0: disable all list compression&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1: depth 1 means &amp;#34;don&amp;#39;t start compressing until after 1 node into the list,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># going from either the head or tail&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># So: [head]-&amp;gt;node-&amp;gt;node-&amp;gt;...-&amp;gt;node-&amp;gt;[tail]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># [head], [tail] will always be uncompressed; inner nodes will compress.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2: [head]-&amp;gt;[next]-&amp;gt;node-&amp;gt;node-&amp;gt;...-&amp;gt;node-&amp;gt;[prev]-&amp;gt;[tail]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2 here means: don&amp;#39;t compress head or head-&amp;gt;next or tail-&amp;gt;prev or tail,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># but compress all nodes between them.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3: [head]-&amp;gt;[next]-&amp;gt;[next]-&amp;gt;node-&amp;gt;node-&amp;gt;...-&amp;gt;node-&amp;gt;[prev]-&amp;gt;[prev]-&amp;gt;[tail]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># etc.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">compress&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">depth&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Sets have a special encoding in just one case: when a set is composed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of just strings that happen to be integers in radix 10 in the range&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of 64 bit signed integers.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The following configuration setting sets the limit in the size of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># set in order to use this special memory saving encoding.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">set&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intset&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">entries&lt;/span> &lt;span class="mi">512&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Similarly to hashes and lists, sorted sets are also specially encoded in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># order to save a lot of space. This encoding is only used when the length and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># elements of a sorted set are below the following limits:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zset&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">listpack&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">entries&lt;/span> &lt;span class="mi">128&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">zset&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">listpack&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="mi">64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># HyperLogLog sparse representation bytes limit. The limit includes the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 16 bytes header. When an HyperLogLog using the sparse representation crosses&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this limit, it is converted into the dense representation.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A value greater than 16000 is totally useless, since at that point the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dense representation is more memory efficient.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The suggested value is ~ 3000 in order to have the benefits of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the space efficient encoding without slowing down too much PFADD,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># which is O(N) with the sparse encoding. The value can be raised to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ~ 10000 when CPU is not a concern, but space is, and the data set is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># composed of many HyperLogLogs with cardinality in the 0 - 15000 range.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">hll&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sparse&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bytes&lt;/span> &lt;span class="mi">3000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Streams macro node max size / items. The stream data structure is a radix&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tree of big nodes that encode multiple items inside. Using this configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># it is possible to configure how big a single node can be in bytes, and the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maximum number of items it may contain before switching to a new node when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># appending new stream entries. If any of the following settings are set to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># zero, the limit is ignored, so for instance it is possible to set just a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># max entries limit by setting max-bytes to 0 and max-entries to the desired&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># value.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stream&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bytes&lt;/span> &lt;span class="mi">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">stream&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">entries&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># order to help rehashing the main Redis hash table (the one mapping top-level&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># keys to values). The hash table implementation Redis uses (see dict.c)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># performs a lazy rehashing: the more operation you run into a hash table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that is rehashing, the more rehashing &amp;#34;steps&amp;#34; are performed, so if the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server is idle the rehashing is never complete and some more memory is used&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># by the hash table.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default is to use this millisecond 10 times every second in order to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># actively rehash the main dictionaries, freeing memory when possible.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If unsure:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># use &amp;#34;activerehashing no&amp;#34; if you have hard latency requirements and it is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># not a good thing in your environment that Redis can reply from time to time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to queries with 2 milliseconds delay.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># use &amp;#34;activerehashing yes&amp;#34; if you don&amp;#39;t have such hard requirements but&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># want to free memory asap when possible.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">activerehashing&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The client output buffer limits can be used to force disconnection of clients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that are not reading data from the server fast enough for some reason (a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># common reason is that a Pub/Sub client can&amp;#39;t consume messages as fast as the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># publisher can produce them).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The limit can be set differently for the three different classes of clients:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># normal -&amp;gt; normal clients including MONITOR clients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># replica -&amp;gt; replica clients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># pubsub -&amp;gt; clients subscribed to at least one pubsub channel or pattern&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The syntax of every client-output-buffer-limit directive is the following:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># client-output-buffer-limit &amp;lt;class&amp;gt; &amp;lt;hard limit&amp;gt; &amp;lt;soft limit&amp;gt; &amp;lt;soft seconds&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A client is immediately disconnected once the hard limit is reached, or if&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the soft limit is reached and remains reached for the specified number of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># seconds (continuously).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># So for instance if the hard limit is 32 megabytes and the soft limit is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 16 megabytes / 10 seconds, the client will get disconnected immediately&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># if the size of the output buffers reach 32 megabytes, but will also get&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># disconnected if the client reaches 16 megabytes and continuously overcomes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the limit for 10 seconds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default normal clients are not limited because they don&amp;#39;t receive data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># without asking (in a push way), but just after a request, so only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># asynchronous clients may create a scenario where data is requested faster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># than it can read.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Instead there is a default limit for pubsub and replica clients, since&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># subscribers and replicas receive data in a push fashion.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Note that it doesn&amp;#39;t make sense to set the replica clients output buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># limit lower than the repl-backlog-size config (partial sync will succeed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and then replica will get disconnected).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Such a configuration is ignored (the size of repl-backlog-size will be used).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This doesn&amp;#39;t have memory consumption implications since the replica client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will share the backlog buffers memory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Both the hard or the soft limit can be disabled by setting them to zero.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">limit&lt;/span> &lt;span class="n">normal&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">limit&lt;/span> &lt;span class="n">replica&lt;/span> &lt;span class="mi">256&lt;/span>&lt;span class="n">mb&lt;/span> &lt;span class="mi">64&lt;/span>&lt;span class="n">mb&lt;/span> &lt;span class="mi">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">limit&lt;/span> &lt;span class="n">pubsub&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="n">mb&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="n">mb&lt;/span> &lt;span class="mi">60&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Client query buffers accumulate new commands. They are limited to a fixed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># amount by default in order to avoid that a protocol desynchronization (for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># instance due to a bug in the client) will lead to unbound memory usage in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the query buffer. However you can configure it here if you have very special&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># needs, such us huge multi/exec requests or alike.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># client-query-buffer-limit 1gb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In some scenarios client connections can hog up memory leading to OOM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># errors or data eviction. To avoid this we can cap the accumulated memory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># used by all client connections (all pubsub and normal clients). Once we&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># reach that limit connections will be dropped by the server freeing up&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># memory. The server will attempt to drop the connections using the most &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># memory first. We call this mechanism &amp;#34;client eviction&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Client eviction is configured using the maxmemory-clients setting as follows:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 0 - client eviction is disabled (default)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A memory value can be used for the client eviction threshold,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for example:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maxmemory-clients 1g&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A percentage value (between 1% and 100%) means the client eviction threshold&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is based on a percentage of the maxmemory setting. For example to set client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># eviction at 5% of maxmemory:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># maxmemory-clients 5%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In the Redis protocol, bulk requests, that are, elements representing single&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># strings, are normally limited to 512 mb. However you can change this limit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># here, but must be 1mb or greater&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># proto-max-bulk-len 512mb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis calls an internal function to perform many background tasks, like&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># closing connections of clients in timeout, purging expired keys that are&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># never requested, and so forth.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Not all tasks are performed with the same frequency, but Redis checks for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># tasks to perform according to the specified &amp;#34;hz&amp;#34; value.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># By default &amp;#34;hz&amp;#34; is set to 10. Raising the value will use more CPU when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis is idle, but at the same time will make Redis more responsive when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># there are many keys expiring at the same time, and timeouts may be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># handled with more precision.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The range is between 1 and 500, however a value over 100 is usually not&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a good idea. Most users should use the default of 10 and raise this up to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 100 only in environments where very low latency is required.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">hz&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Normally it is useful to have an HZ value which is proportional to the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># number of clients connected. This is useful in order, for instance, to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># avoid too many clients are processed for each background task invocation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to avoid latency spikes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Since the default HZ value by default is conservatively set to 10, Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># offers, and enables by default, the ability to use an adaptive HZ value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># which will temporarily raise when there are many connected clients.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When dynamic HZ is enabled, the actual configured HZ will be used&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># as a baseline, but multiples of the configured HZ value will be actually&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># used as needed once more clients are connected. In this way an idle&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># instance will use very little CPU time while a busy instance will be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># more responsive.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dynamic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hz&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When a child rewrites the AOF file, if the following option is enabled&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the file will be fsync-ed every 4 MB of data generated. This is useful&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to commit the file to the disk more incrementally and avoid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># big latency spikes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">aof&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rewrite&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">incremental&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fsync&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># When redis saves RDB file, if the following option is enabled&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the file will be fsync-ed every 4 MB of data generated. This is useful&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in order to commit the file to the disk more incrementally and avoid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># big latency spikes.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rdb&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">incremental&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fsync&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># idea to start with the default settings and only change them after investigating&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># how to improve the performances and how the keys LFU change over time, which&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># is possible to inspect via the OBJECT FREQ command.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># There are two tunable parameters in the Redis LFU implementation: the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># counter logarithm factor and the counter decay time. It is important to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># understand what the two parameters mean before changing them.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The LFU counter is just 8 bits per key, it&amp;#39;s maximum value is 255, so Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># uses a probabilistic increment with logarithmic behavior. Given the value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># of the old counter, when a key is accessed, the counter is incremented in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># this way:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1. A random number R between 0 and 1 is extracted.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3. The counter is incremented only if R &amp;lt; P.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default lfu-log-factor is 10. This is a table of how the frequency&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># counter changes with a different number of accesses with different&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># logarithmic factors:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +--------+------------+------------+------------+------------+------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># | factor | 100 hits | 1000 hits | 100K hits | 1M hits | 10M hits |&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +--------+------------+------------+------------+------------+------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># | 0 | 104 | 255 | 255 | 255 | 255 |&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +--------+------------+------------+------------+------------+------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># | 1 | 18 | 49 | 255 | 255 | 255 |&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +--------+------------+------------+------------+------------+------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># | 10 | 10 | 18 | 142 | 255 | 255 |&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +--------+------------+------------+------------+------------+------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># | 100 | 8 | 11 | 49 | 143 | 255 |&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># +--------+------------+------------+------------+------------+------------+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NOTE: The above table was obtained by running the following commands:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># redis-benchmark -n 1000000 incr foo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># redis-cli object freq foo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NOTE 2: The counter initial value is 5 in order to give new objects a chance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to accumulate hits.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The counter decay time is the time, in minutes, that must elapse in order&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># for the key counter to be divided by two (or decremented if it has a value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># less &amp;lt;= 10).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The default value for the lfu-decay-time is 1. A special value of 0 means to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># decay the counter every time it happens to be scanned.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lfu-log-factor 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lfu-decay-time 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">########################### ACTIVE DEFRAGMENTATION #######################&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># What is active defragmentation?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Active (online) defragmentation allows a Redis server to compact the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># spaces left between small allocations and deallocations of data in memory,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thus allowing to reclaim back memory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Fragmentation is a natural process that happens with every allocator (but&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># less so with Jemalloc, fortunately) and certain workloads. Normally a server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># restart is needed in order to lower the fragmentation, or at least to flush&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># away all the data and create it again. However thanks to this feature&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># implemented by Oran Agra for Redis 4.0 this process can happen at runtime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in a &amp;#34;hot&amp;#34; way, while the server is running.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Basically when the fragmentation is over a certain level (see the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configuration options below) Redis will start to create new copies of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># values in contiguous memory regions by exploiting certain specific Jemalloc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># features (in order to understand if an allocation is causing fragmentation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># and to allocate it in a better place), and at the same time, will release the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># old copies of the data. This process, repeated incrementally for all the keys&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># will cause the fragmentation to drop back to normal values.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Important things to understand:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1. This feature is disabled by default, and only works if you compiled Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to use the copy of Jemalloc we ship with the source code of Redis.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is the default with Linux builds.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2. You never need to enable this feature if you don&amp;#39;t have fragmentation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># issues.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3. Once you experience fragmentation, you can enable this feature when&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># needed with the command &amp;#34;CONFIG SET activedefrag yes&amp;#34;.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># The configuration parameters are able to fine tune the behavior of the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># defragmentation process. If you are not sure about what they mean it is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># a good idea to leave the defaults untouched.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Active defragmentation is disabled by default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># activedefrag no&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Minimum amount of fragmentation waste to start active defrag&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># active-defrag-ignore-bytes 100mb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Minimum percentage of fragmentation to start active defrag&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># active-defrag-threshold-lower 10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Maximum percentage of fragmentation at which we use maximum effort&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># active-defrag-threshold-upper 100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Minimal effort for defrag in CPU percentage, to be used when the lower&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># threshold is reached&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># active-defrag-cycle-min 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Maximal effort for defrag in CPU percentage, to be used when the upper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># threshold is reached&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># active-defrag-cycle-max 25&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Maximum number of set/hash/zset/list fields that will be processed from&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the main dictionary scan&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># active-defrag-max-scan-fields 1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Jemalloc background thread for purging will be enabled by default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">jemalloc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bg&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">thread&lt;/span> &lt;span class="n">yes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># It is possible to pin different threads and processes of Redis to specific&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># CPUs in your system, in order to maximize the performances of the server.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># This is useful both in order to pin different Redis threads in different&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># CPUs, but also in order to make sure that multiple Redis instances running&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># in the same host will be pinned to different CPUs.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Normally you can do this using the &amp;#34;taskset&amp;#34; command, however it is also&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># possible to this via Redis configuration directly, both in Linux and FreeBSD.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># You can pin the server/IO threads, bio threads, aof rewrite child process, and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the bgsave child process. The syntax to specify the cpu list is the same as&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the taskset command:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set redis server/io threads to cpu affinity 0,2,4,6:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server_cpulist 0-7:2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set bio threads to cpu affinity 1,3:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bio_cpulist 1,3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set aof rewrite child process to cpu affinity 8,9,10,11:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># aof_rewrite_cpulist 8-11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set bgsave child process to cpu affinity 1,10,11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># bgsave_cpulist 1,10-11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># In some cases redis will emit warnings and even refuse to start if it detects&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># that the system is in bad state, it is possible to suppress these warnings&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># by setting the following config which takes a space delimited list of warnings&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to suppress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ignore-warnings ARM64-COW-BUG&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc</title><link>https://dev.leiyanhui.com/docker/debian-desktop/</link><pubDate>Fri, 07 Jul 2023 11:02:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop/</guid><description>&lt;p>debian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp&lt;/p>
&lt;p>没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。&lt;/p>
&lt;h2 id="本文说明">本文说明
&lt;/h2>&lt;p>joyanhui/debian-i3-xrdp-novnc 使用docker 和 lxc/lxd ，本文可能会滞后最新，更多问题问题请查看docker和lxd的使用手册。&lt;br>
如果您没有使用过i3 openbox lxc等软件，务必仔细阅读本文，至少会让你熟悉了解相关操作。&lt;/p>
&lt;h2 id="特性">特性
&lt;/h2>&lt;p>轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。&lt;br>
是一个完整的操作系统，systemd可正常使用，甚至可以再次安装docker&lt;br>
vnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3 &lt;br>
采用docker 运行lxd的方法 alpine3.18.2 =&amp;gt; lxd &lt;br>
集成软件：&lt;/p>
&lt;ul>
&lt;li>debian 12 bookworm&lt;/li>
&lt;li>i3 openbox polybar rofi alacritty dunst zsh firefox-esr thunar gvfs gvfs-backends gvfs-fuse sshfs&lt;/li>
&lt;li>tigervnc&lt;/li>
&lt;li>novnc websockify&lt;/li>
&lt;li>ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji 微软雅黑&lt;/li>
&lt;li>服务管理支持：systemd supervisor&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-next/" target="_blank" rel="noopener"
>更新记录和计划&lt;/a> &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-exec/" target="_blank" rel="noopener"
>公开的搭建过程&lt;/a> &lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/" target="_blank" rel="noopener"
>如果你使用的旧版请查看旧版说明&lt;/a>&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name dt --hostname dt --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 3389:3389 -p 222:22 -p 2222:2222 -p 8080:8080 -p 5900-5905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> joyanhui/debian-i3-xrdp-novnc sh /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900 ，222 是alpine容器的ssh端口&lt;/p>
&lt;blockquote>
&lt;p>20230707 之前版本是纯docker实现，不包含浏览器和文件管理器，之后的版本是lxd lxc实现 并带firefox-esr 和thunar 网络挂载 并支持 systemd。&lt;/p>&lt;/blockquote>
&lt;h2 id="默认账号-以及相关用户名和密码">默认账号 以及相关用户名和密码
&lt;/h2>&lt;p>总共有三个密码：&lt;/p>
&lt;h3 id="debian的系统用户">debian的系统用户
&lt;/h3>&lt;p>用户名：yanhui 密码：1 （只有一个数字1）&lt;br>
这个用户名密码，同时对应debian的 ssh xrdp 的默认账号 对应默认端口：2222 和 3389
debian默认的root 没设置密码，禁止ssh登陆&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd yanhui
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="debian的vnc的密码">debian的vnc的密码
&lt;/h3>&lt;p>vnc 密码：111111（六个数字1）&lt;br>
此密码用于vnc 和novnc登陆 默认用户yanhui的桌面&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">su yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vncpasswd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="alpine的root账户">alpine的root账户
&lt;/h3>&lt;p>用户名 root 密码:1（只有一个数字1）&lt;br>
此密码同时左右 alpine的ssh登陆密码，对应默认端口：222&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>部署完毕后，务必第一时间修改密码！&lt;/p>&lt;/blockquote>
&lt;h2 id="为什么选择debian-而不是arch--nixos">为什么选择debian 而不是arch nixos
&lt;/h2>&lt;p>因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 &lt;br>
放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。&lt;br>
arch和nixos一些其他缺点这里不多说。&lt;br>
其实最主要的是 不折腾 稳如老狗，以及 个人喜好 以及和服务器端的环境一致性&lt;/p>
&lt;h2 id="为什么用docker-套lxd">为什么用docker 套lxd
&lt;/h2>&lt;p>不直接用lxd 是因为部分环境不支持，另外docker的分层commit 更方便。 更可以推送到自己的私有regditer&lt;br>
不直接用docker 是因为 docker 限制太多，不算是太完整的系统，lxc lxd 是一个完整的系统。&lt;br>
所以20230707版本以后 改为 docker运行alpine 然后在alpine内用lxd运行 debian12&lt;br>
alpine是一个只有3m大小的linux系统，在用lxd嵌套后，比旧方案多占用30-60M内存，80M硬盘，但是带来的是一个完整的linux体验，并且性能吊打虚拟机模式！&lt;/p>
&lt;h2 id="为什么选择i3-和openbox-怎么换其他桌面">为什么选择i3 和openbox 怎么换其他桌面
&lt;/h2>&lt;p>因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。
因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。&lt;br>
而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面&lt;/p>
&lt;h3 id="更换为其他桌面的方法">更换为其他桌面的方法
&lt;/h3>&lt;p>例如，要换成 xfce4首先安装&lt;code>sudo apt install xfce4&lt;/code> ,然后修改 &lt;code>~/.vnc/xstartup &lt;/code> 可以更换vnc和novnc的桌面。&lt;br>
修改用户目录下的 &lt;code>~/.xsession&lt;/code> 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:&lt;code>sudo apt purge i3&lt;/code> or &lt;code>sudo apt purge openbox&lt;/code>&lt;/p>
&lt;h2 id="novnc-vnc为什么是黑屏">novnc vnc为什么是黑屏
&lt;/h2>&lt;p>就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 也没有壁纸，右键 有惊喜！&lt;/p>
&lt;h2 id="怎么启动shell-和常见快捷键">怎么启动shell 和常见快捷键
&lt;/h2>&lt;p>基本是i3 的默认快捷键&lt;br>
点屏幕顶部的 Apps&amp;gt; 系统 &amp;gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）&lt;br>
如果是rdp远程桌面下，按下键盘 ： win+回车 &lt;br>
启动管理器（开始菜单） :win d&lt;br>
程序切换 alt+tab
修改窗口大小：按住win 再按住 鼠标右键 来回拖动&lt;br>
修改窗口位置：按住win 再按住 鼠标左键 来回拖动&lt;br>
关闭软件：win shift q&lt;br>
注销：win shift e&lt;br>
更多使用方法 自己看一下i3 使用说明&lt;/p>
&lt;h2 id="如何从宿主机器直接进去debian-shell">如何从宿主机器直接进去debian shell
&lt;/h2>&lt;p>两步&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 进入docker alpine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 进入lxc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 或者直接
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it dt lxc exec dt /bin/bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>第一个dt 是docker的容器名称，第二个 是lxc 的容器名称&lt;br>
你也可以在登陆 vnc/xrdp后直接运行&lt;/p>
&lt;h2 id="怎么装中文输入法">怎么装中文输入法
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-chinese-addons
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>openbox 需要右键手动加载，其他现代的桌面系统，包括i3。安装完成后，注销重新登录一次桌面，会自动加载，拼音输入法可导入搜狗细胞词库，具体自己研究。&lt;br>
默认中英文切换快捷键是 ctrl+空格 ，如果你在非全屏的xrdp 或novnc /vnc 下切换，注意和本地的输入法快捷键冲突问题。&lt;/p>
&lt;h2 id="怎么新建用户怎么删除默认用户">怎么新建用户怎么删除默认用户
&lt;/h2>&lt;h3 id="新建用户">新建用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo adduser YouName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -aG sudo YouName
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="新用户vnc密码">新用户vnc密码
&lt;/h4>&lt;p>ssh 或者 xrdp 登陆新用户后，运行 &lt;code>vncpasswd&lt;/code>&lt;/p>
&lt;h4 id="更新-vnc服务">更新 vnc服务
&lt;/h4>&lt;p>修改里面的用户名&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/systemd/system/vncserver@0.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/supervisor/conf.d/novnc.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除默认用户">删除默认用户
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo deluser yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="怎么修改密码">怎么修改密码
&lt;/h2>&lt;h3 id="用户密码">用户密码
&lt;/h3>&lt;p>命令：&lt;code>passwd&lt;/code>&lt;/p>
&lt;h3 id="vnc密码">vnc密码
&lt;/h3>&lt;p>命令：&lt;code>vncpasswd .vnc/passwd&lt;/code> ，需要重启vnc服务，查看 &lt;code> systemctrl restart vncserver@0&lt;/code>&lt;/p>
&lt;h2 id="x11转发模式如何使用输入法">x11转发模式如何使用输入法
&lt;/h2>&lt;p>修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 &lt;code>fcitx5&amp;amp;&lt;/code> 再执行对应的软件。&lt;/p>
&lt;h2 id="x11-转发模式部分软件很卡">x11 转发模式部分软件很卡
&lt;/h2>&lt;p>没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。&lt;/p>
&lt;h2 id="novnc默认地址">novnc默认地址
&lt;/h2>&lt;p>http://你的ip:8080/ 其中端口docker内部默认使用8080，外部端口是你自己映射的。&lt;/p>
&lt;h2 id="novnc如何走https">novnc如何走https
&lt;/h2>&lt;p>建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。&lt;/p>
&lt;h2 id="vnc连不上">vnc连不上
&lt;/h2>&lt;p>此问题只在 20230707之前版本存在&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm /tmp/.X0-lock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器&lt;/p>
&lt;h2 id="天气预报出错以及如何修改天气预报城市">天气预报出错以及如何修改天气预报城市
&lt;/h2>&lt;p>&lt;code>~/.config/polybar/weather-plugin.py&lt;/code> 这个文件
天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。&lt;br>
你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）&lt;br>
&lt;code>https://api.openweathermap.org/data/2.5/weather?id=1793724&amp;amp;appid=440b47a5ffbc5421e4a9befcbc4d635b&amp;amp;units=Metric&amp;amp;lang=zh_cn&lt;/code>&lt;br>
你如果不想用，直接在 polybar的配置文件里面删掉即可。&lt;/p>
&lt;h2 id="如何调音量">如何调音量
&lt;/h2>&lt;p>在i3配置文件里面修改&lt;br>
调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。&lt;br>
进阶用法，自己配置i3和polybar&lt;/p>
&lt;h2 id="vnc-和xrdp-桌面不同步">vnc 和xrdp 桌面不同步
&lt;/h2>&lt;p>是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。&lt;/p>
&lt;h2 id="novnc-网页访问按键失灵乱跳">noVNC 网页访问按键失灵乱跳
&lt;/h2>&lt;p>1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法&lt;br>
2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。&lt;/p>
&lt;h2 id="xrdp-登陆后桌面灰色无显示">xrdp 登陆后桌面灰色无显示
&lt;/h2>&lt;p>长期无操作后，锁屏了而已。依次盲输入密码然后按下回车 验证成功后 即可登入桌面。&lt;br>
如果你不需要锁屏功能，可以删掉 &lt;code>sudo apt purge i3lock&lt;/code>&lt;/p>
&lt;h2 id="没声音或者--顶部音量不显示">没声音或者 顶部音量不显示
&lt;/h2>&lt;h3 id="vnc-和x11-没声音">vnc 和x11 没声音
&lt;/h3>&lt;p>vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp&lt;/p>
&lt;h3 id="xrdp的polybar-偶尔不显示音量">xrdp的polybar 偶尔不显示音量
&lt;/h3>&lt;p>这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。&lt;br>
临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">killall pulseaudio &amp;amp;&amp;amp; pulseaudio &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh .config/polybar/polybar_run.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>20230707 以后的版本，可以在polybar顶部菜单用依次点击： APPS &amp;gt; polybar &amp;gt; 重启声音 APPS &amp;gt; polybar &amp;gt; 重载polybar&lt;/p>
&lt;h2 id="如何修改分辨率">如何修改分辨率
&lt;/h2>&lt;h3 id="vnc-novnc">vnc novnc
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/systemd/system/vncserver@0.service # geometry 后面的参数是vnc的分辨率
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="xrdp">xrdp
&lt;/h3>&lt;p>xrdp的分辨率 由你的客户端 发起的时候配置&lt;/p>
&lt;h2 id="openbox的壁纸点好多次才换一张">openbox的壁纸点好多次才换一张
&lt;/h2>&lt;p>壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。&lt;/p>
&lt;h2 id="安装常用软件">安装常用软件
&lt;/h2>&lt;p>点屏幕左上角 APPS &amp;gt; 系统 &amp;gt; 终端 输入 &lt;code>sudo apt install &amp;lt;包名&amp;gt;&lt;/code>命令；启动软件 APPS &amp;gt; 系统 &amp;gt; &lt;code>rofi-run&lt;/code> 选择软件或者输入软件名称&lt;br>
或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install firefox-esr # 火狐 20230707以后版本自带
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install nemo nautilus # 文件管理器 任选一个 20230707以后版本自带 thunar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># todesk 中文不显示 需要另外处理，这里不多说
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://newdl.todesk.com/linux/todesk-v4.3.1.0-amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install ./todesk-v4.3.1.0-amd64.deb #sudo apt purge todesk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 远程其他电脑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install freerdp2-x11 #xfreerdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install remmina # 可选包 remmina-plugin-x2go
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># neofetch 命令行装b工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install neofetch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># flameshot 截图工具
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install flameshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># linuxqq
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://dldir1.qq.com/qqfile/qq/QQNT/ad5b5393/linuxqq_3.1.2-13107_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install ./linuxqq_3.1.2-13107_amd64.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="如何访问文件">如何访问文件
&lt;/h2>&lt;h3 id="thunar--方式">thunar 方式
&lt;/h3>&lt;p>20230707以后版本集成了thunar 和smb sshfs webdav访问组件。
打开 thunar ，地址栏输入：&lt;code>smb://10.1.1.100&lt;/code> 或者&lt;code>dav://10.1.1.100&lt;/code> 即可&lt;/p>
&lt;h3 id="文件挂载">文件挂载
&lt;/h3>&lt;p>参考后文 目录映射 方法&lt;/p>
&lt;h2 id="不喜欢默认用户的shell">不喜欢默认用户的shell
&lt;/h2>&lt;p>默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 &lt;br>
然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可&lt;/p>
&lt;h2 id="pve-lxc-ct-或者docker宿主机-目录映射-端口-和显卡等">pve lxc ct 或者docker宿主机 目录映射 端口 和显卡等
&lt;/h2>&lt;h3 id="pve-硬盘到lxc">pve 硬盘到lxc
&lt;/h3>&lt;p>请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/&lt;/p>
&lt;h3 id="docker宿主机-目录映射">docker宿主机 目录映射
&lt;/h3>&lt;p>默认 映射 /mnt/sda1 到最终的debian12 &lt;br>
如果要映射其他目录，先映射到docker内，确保早docker内可以访问的情况下在docker内如下命令映射到 lxc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc config device add dt sda1 disk source=/mnt/sda1 path=/mnt/sda1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>更多使用方法，以及权限问题，请参考lxd手册&lt;/p>
&lt;h3 id="端口">端口
&lt;/h3>&lt;p>先映射端口到docker,而后在docker内 用如下命令映射到lxc&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc config device add dt demoName proxy listen=tcp:0.0.0.0:8888 connect=tcp:127.0.0.1:8888
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>更多使用方法，请参考lxd手册&lt;/p>
&lt;h3 id="如何使用显卡加速">如何使用显卡加速
&lt;/h3>&lt;p>以nvidia为例在创建docker的时候 把显卡挂进去即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run ....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia0:/dev/nvidia0 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidiactl:/dev/nvidiactl \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia-uvm:/dev/nvidia-uvm \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ....
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="pve-群晖--unraid-esxi-下的安装方式">pve 群晖 unraid esxi 下的安装方式
&lt;/h3>&lt;p>pve下，你可以用lxc/vm 运行docker的方式运行，也可以，从本镜像内提取lxc模板直接导入到 CT容器。
其他系统 建议直接docker运行&lt;/p>
&lt;h2 id="目录和文件说明">目录和文件说明
&lt;/h2>&lt;p>&lt;code>/boot.sh&lt;/code> 在docker内 其他文件在 debian内&lt;/p>
&lt;h3 id="启动文件">启动文件
&lt;/h3>&lt;h4 id="bootsh">boot.sh
&lt;/h4>&lt;p>&lt;code>/boot.sh&lt;/code> 在docker内 用于启动alpine的 ssh 和 lxd/lxc 的debian&lt;/p>
&lt;h4 id="systemd-和-supervisord">systemd 和 supervisord
&lt;/h4>&lt;p>systemd 和 supervisord 在 lxc的debian内&lt;br>
novnc使用supervisord启动:&lt;code>/etc/supervisor/conf.d/&lt;/code>，vnc和其他服务使用systemd启动：&lt;code>/etc/systemd/system/&lt;/code>&lt;/p>
&lt;h3 id="i3-配置文件">i3 配置文件
&lt;/h3>&lt;p>/home/yanhui/.config/i3/config&lt;/p>
&lt;h3 id="openbox配置文件">openbox配置文件
&lt;/h3>&lt;p>/home/yanhui/.config/openbox/menu.xml #右键菜单 &lt;br>
feh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本&lt;/p>
&lt;h3 id="壁纸目录">壁纸目录
&lt;/h3>&lt;p>i3配置文件调用feh随机选
/home/yanhui/.config/i3/bg/&lt;/p>
&lt;h3 id="polybar">polybar
&lt;/h3>&lt;ul>
&lt;li>/home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单&lt;/li>
&lt;li>/home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本&lt;/li>
&lt;li>/home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。&lt;/li>
&lt;/ul>
&lt;h3 id="rofi">rofi
&lt;/h3>&lt;p>/home/yanhui/.config/rofi/config.rasi&lt;/p>
&lt;h3 id="dunst">dunst
&lt;/h3>&lt;p>/home/yanhui/.config/dunst/dunstrc&lt;/p>
&lt;h3 id="alacritty">alacritty
&lt;/h3>&lt;p>/home/yanhui/.config/alacritty/alacritty.yml&lt;/p>
&lt;h3 id="zsh">zsh
&lt;/h3>&lt;p>/home/yanhui/.zshrc
/home/yanhui/.oh-my-zsh&lt;/p></description></item><item><title>joyanhui/debian-i3-xrdp-novnc 公开的搭建过程</title><link>https://dev.leiyanhui.com/docker/debian-desktop-exec/</link><pubDate>Fri, 07 Jul 2023 00:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-exec/</guid><description>&lt;p>未使用Dockerfile 是因为搭建过程略微复杂，如果另外打包出来rootfs 也没有什么意义。所以干脆公开过程。&lt;/p>
&lt;p>本文可能存在滞后，未经过严格整理和核对,所有历史命令，你在 下述文件中均可以看到&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /root/.bash_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /home/yanhui/.bash_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt lxc &lt;span class="nb">exec&lt;/span> dt cat /home/yanhui/.zsh_history
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it dt cat /root/.ash_history
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>宿主用alpine&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name &lt;span class="nb">test&lt;/span> --hostname &lt;span class="nb">test&lt;/span> --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 333:3389 -p 2221:2222 -p 2222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> alpine:3.18.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">exec&lt;/span> -it &lt;span class="nb">test&lt;/span> /bin/sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apk/repositories
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add tzdata
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Asia/Shanghai&amp;#34;&lt;/span> &amp;gt; /etc/timezone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk del tzdata
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add openssh lxd lxd-client lxcfs dbus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&amp;#39;&lt;/span> /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;session optional pam_cgfs.so -c freezer,memory,name=systemd,unified&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/pam.d/system-login
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc.idmap = u 0 100000 65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/lxc/default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc.idmap = g 0 100000 65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/lxc/default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:100000:65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/subuid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:100000:65536&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/subgid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;systemd_container=yes&amp;#34;&lt;/span>&amp;gt;&amp;gt; /etc/conf.d/lxc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理 启动文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;root:1&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> chpasswd &lt;span class="c1"># alpine的root密码改为1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lxc lxd lxcfs dbus&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;/usr/sbin/sshd -D&amp;#34;&lt;/span> &amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxd &amp;amp;&amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;lxc start dt &amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;tail -f /dev/null&amp;#34;&lt;/span> &amp;gt;&amp;gt; /boot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">lxd &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxd init &lt;span class="c1"># 全部默认 除了自动更新那个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc launch images:debian/12 dt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 这个错误不影响 ERROR [2023-07-06T21:40:35+08:00] balance: Unable to set cpuset err=&amp;#34;setting cgroup item for the container failed&amp;#34; name=dt value=&amp;#34;0,1,10,11,2,3,4,5,6,7,8,9&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config &lt;span class="nb">set&lt;/span> dt security.privileged &lt;span class="nb">true&lt;/span> &lt;span class="c1">#特权&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config get dt security.privileged &lt;span class="c1">#检查&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc info dt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理端口映射&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt xrdp proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:3389 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:3389
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sshd proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:22 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt novnc proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:8080 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt vnc0 proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:5900 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:5900
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt vnc1 proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:5901 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:5901
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sshd proxy &lt;span class="nv">listen&lt;/span>&lt;span class="o">=&lt;/span>tcp:0.0.0.0:2222 &lt;span class="nv">connect&lt;/span>&lt;span class="o">=&lt;/span>tcp:127.0.0.1:22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删除 lxc config device remove dt sshd&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 挂载目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc config device add dt sda1 disk &lt;span class="nv">source&lt;/span>&lt;span class="o">=&lt;/span>/mnt/sda1 &lt;span class="nv">path&lt;/span>&lt;span class="o">=&lt;/span>/mnt/sda1 &lt;span class="c1"># 挂载目录&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debian内处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc &lt;span class="nb">exec&lt;/span> dt /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sed -i &lt;span class="s1">&amp;#39;s/deb.debian.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt update&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>apt upgrade
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 基础&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y wget curl nano openssh-server unzip sudo zsh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 桌面&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install i3 openbox
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 错误不影响 Failed to try-restart systemd-binfmt.service: Unit systemd-binfmt.service is masked.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 字体&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install fonts-jetbrains-mono fonts-noto-color-emoji
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p /usr/share/fonts/WindowsFonts &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> /usr/share/fonts/WindowsFonts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget -c https://ghproxy.com/https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/windows_font/msyh.ttc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fc-cache -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg-reconfigure locales &lt;span class="c1"># zh_CN.UTF-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 常用组件 状态了 图片查看壁纸 终端 任务切换和运行 shell pythone的模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y polybar feh dunst alacritty rofi zsh python3-requests
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 浏览器和文件管理器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y firefox-esr thunar &lt;span class="c1"># 不需要可以自己删除 ，占用硬盘400多M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># thunar网络访问 nas所需要组件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y gvfs gvfs-backends gvfs-fuse sshfs &lt;span class="c1"># 占用硬盘61M openbox下无法使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 中文输入法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#apt install -y fcitx5-chinese-addons # 740M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 远程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y xrdp tigervnc-standalone-server novnc python3-websockify supervisor &lt;span class="c1"># 194M&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 编译 xrdp 声音&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y pulseaudio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y build-essential dpkg-dev libpulse-dev git autoconf libtool &lt;span class="c1"># 此部分组建谨慎删除&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install -y lsb-release doxygen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git clone https://github.com/neutrinolabs/pulseaudio-module-xrdp.git &lt;span class="c1"># 基于v0.7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> pulseaudio-module-xrdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scripts/install_pulseaudio_sources_apt.sh &lt;span class="c1"># debian12 用这，另外一个是scripts/install_pulseaudio_sources_apt_wrapper.sh 不兼容debian12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./bootstrap &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> ./configure &lt;span class="nv">PULSE_DIR&lt;/span>&lt;span class="o">=&lt;/span>~/pulseaudio.src
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 验证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ls &lt;span class="k">$(&lt;/span>pkg-config --variable&lt;span class="o">=&lt;/span>modlibexecdir libpulse&lt;span class="k">)&lt;/span> &lt;span class="p">|&lt;/span> grep xrdp &lt;span class="c1"># module-xrdp-sink.so 和 module-xrdp-source.so 就是成功了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">useradd -ms /bin/bash yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;yanhui:1&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> chpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">usermod -G sudo yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#loginctl enable-linger yanhui # 允许此用户推出登陆后 他的用户服务依旧执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 服务处理 vnc 和 novnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理用户 ======== start&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">su yanhui &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vnc 密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vncpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 默认shell 从 bash转zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;zsh&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.bashrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># xrdp 默认桌面&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> i3 &amp;gt;/home/yanhui/.xsession
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 壁纸 2张&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir ~/bg &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> ~/bg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/green.jpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/joyanhui/file.leiyanhui.com/dwm-wallpaper/bing-jurenzhilu.jpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># zsh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/joyanhui/oh-my-zsh/archive/refs/heads/main.zip -O main.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unzip main.zip &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> mv oh-my-zsh-main/.oh-my-zsh .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp oh-my-zsh-main/.zshrc .&lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm main.zip &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm -rf oh-my-zsh-main/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># i3 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># polybar 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dunst 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># alacritty 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># rofi 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># openbox 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># user-dirs.dirs 配置文件 参考：https://github.com/joyanhui/i3w&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;openbox&amp;#34;&lt;/span> &amp;gt; ~/.vnc/xstartup &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> chmod +x ~/.vnc/xstartup &lt;span class="c1"># 配置vnc桌面为openbox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 处理用户 ======== end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span> &lt;span class="c1"># 退回到root&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置vnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 参考 /lib/systemd/system/tigervncserver@.service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/systemd/system/vncserver@0.service &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Unit]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Description=Start TightVNC server at startup
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">After=syslog.target network.target
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Service]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Type=forking
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">User=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Group=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">WorkingDirectory=/home/yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">PIDFile=/home/yanhui/.vnc/%H:%i.pid
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStartPre=-/usr/bin/vncserver -kill :%i &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStart=/usr/bin/vncserver -geometry 1900x930 -localhost no :%i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStop=/usr/bin/vncserver -kill :%i
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Install]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">WantedBy=multi-user.target
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># novnc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/supervisor/conf.d/novnc.conf &lt;span class="s">&amp;lt;&amp;lt; \EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[program:novnc]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">command= /usr/bin/websockify -D --web=/usr/share/novnc/ 8080 localhost:5900
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">user=yanhui
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">autorestart=true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">priority=999
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">supervisorctl update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s /usr/share/novnc/vnc.html /usr/share/novnc/index.html &lt;span class="c1"># 首页&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> vncserver@0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 清理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /root/pulseaudio* &lt;span class="c1"># xrdp 历史文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /root/.bash_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /home/yanhui/.bash_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm /home/yanhui/.zsh_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt autoremove &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt autoclean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt clean
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>alpine 入口启动文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 清理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /var/cache/apk/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#rm -rf ~/.ash_history&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>‍&lt;/p>
&lt;p>备份 docker&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker stop test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">export&lt;/span> test2 &amp;gt; 3.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker import 1.tar test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker stop test2 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker rm test2 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker rmi test2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always --name test2 --hostname test2 --privileged&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 333:3389 -p 222:2222 -p 888:8080 -p 6900-6905:5900-5905 -v /mnt:/mnt &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> test2 sh /boot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>‍&lt;/p>
&lt;p>推送到 hub.docker.com&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker &lt;span class="nb">logout&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker login
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 推送到阿里云 容器镜像&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># docker login --username=你的用户邮箱 registry.cn-地区.aliyuncs.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">datename&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>date +%Y%m%d%H%M%S&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag test2 joyanhui/debian-i3-xrdp-novnc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag test2 joyanhui/debian-i3-xrdp-novnc:a-lxd-d-&lt;span class="k">$(&lt;/span>datename&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker push joyanhui/debian-i3-xrdp-novnc:a-lxd-d-&lt;span class="si">${&lt;/span>&lt;span class="nv">datename&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker push joyanhui/debian-i3-xrdp-novnc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker joyanhui/debian-i3-xrdp-novnc 更新记录和更新计划</title><link>https://dev.leiyanhui.com/docker/debian-desktop-next/</link><pubDate>Tue, 04 Jul 2023 00:15:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-next/</guid><description>&lt;h2 id="为什么不经常更新">为什么不经常更新
&lt;/h2>&lt;p>因为定位是 xrdp+vnc+novnc+远程声音转发 可用的一个尽可能小巧的稳定linux, 这个基本功能是绝对稳定强壮可用的。&lt;br>
除非 pulseaudio-module-xrdp 有大版本更新，不然joyanhui/debian-i3-xrdp-novnc 不会继续更新。&lt;br>
安全更新 自己 &lt;code>apt upgrade&lt;/code> 即可！&lt;/p>
&lt;h2 id="建议和需求">建议和需求
&lt;/h2>&lt;p>mailto: am95YW5odWkoYXQpcXEuY29t （解码后联系）&lt;/p>
&lt;h2 id="更新计划">更新计划
&lt;/h2>&lt;blockquote>
&lt;p>不代表一定会添加上可能是还在权衡&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>天气预报默认显示 提示修改key&lt;/li>
&lt;li>openbox 集成dock 或者 任务栏 默认壁纸等&lt;/li>
&lt;li>默认用户 yanhui 免密码sudo&lt;/li>
&lt;li>物理机可直接启动版&lt;/li>
&lt;/ul>
&lt;h2 id="已经完成的">已经完成的
&lt;/h2>&lt;h3 id="2023-0708">2023-0708
&lt;/h3>&lt;ul>
&lt;li>修复 vnc和 novnc 的自动启动&lt;/li>
&lt;li>openbox 右键菜单增加 thunar&lt;/li>
&lt;li>集成 inetutils-ping iproute2 方便使用ping , ip a 命令&lt;/li>
&lt;/ul>
&lt;h3 id="old">old
&lt;/h3>&lt;ul>
&lt;li>alacritty 字体修复【2023-0707】&lt;/li>
&lt;li>i3 自动隐藏firefox-esr浏览器边框【2023-0707】&lt;/li>
&lt;li>修复时区 错误 &lt;code>sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&lt;/code>【2023-0707】&lt;/li>
&lt;li>用雅黑字体替换zhenhei 【2023-0707】&lt;/li>
&lt;li>openbox 右键菜单 rofi的提示【2023-0707】&lt;/li>
&lt;li>polybar 菜单增加 退出 和重启 polybar 【2023-0707】&lt;/li>
&lt;li>polybar 兼容雅黑字体【2023-0707】&lt;/li>
&lt;li>集成 thunar gvfs gvfs-backends gvfs-fuse 【2023-0707】&lt;/li>
&lt;li>集成 compton 【已经完成】&lt;/li>
&lt;li>天气预报 默认调用 firefox-esr 打开网址 【已经完成】&lt;/li>
&lt;li>vnc 和xrdp重复调用pulseaudio 导致的冲突问题 【使用双桌面方案解决】&lt;/li>
&lt;li>默认桌面尝试 兼容 xrdp 和 vnc多显示器 vnc 可能会采用openbox 【已经完成】&lt;/li>
&lt;li>状态栏 多显示器 【因为双桌面系统 已经不需要，i3现有配置文件可以满足】&lt;/li>
&lt;/ul></description></item><item><title>docker运行debian桌面 包含i3 xrdp（带声音） x11 vnc novnc</title><link>https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/</link><pubDate>Tue, 04 Jul 2023 00:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-desktop-old-only-docker/</guid><description>&lt;p>本文为旧版本文档，新版文档在 ： &lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/debian-desktop/&lt;/a>&lt;/p>
&lt;p>debian12 i3 xrdp novnc X11Forwarding include pulseaudio-xrdp&lt;/p>
&lt;p>没多余的软件，内存占用200M左右，甚至浏览器都没有。 后文有详细的使用方法和 安装其他的软件的方法。&lt;/p>
&lt;h3 id="特性">特性
&lt;/h3>&lt;p>轻量 干净 基于i3 和 openbox 可以用xrdp novnc(webvnc) vnc x11 等方式运行。&lt;br>
vnc和novnc使用简洁的原生openbox xrdp使用依赖快捷键但是更高效的i3
集成软件：&lt;/p>
&lt;ul>
&lt;li>debian 12 bookworm&lt;/li>
&lt;li>i3 openbox polybar rofi alacritty dunst zsh&lt;/li>
&lt;li>supervisord 服务器管理 及python3&lt;/li>
&lt;li>tigervnc&lt;/li>
&lt;li>novnc websockify&lt;/li>
&lt;li>ttf-wqy-zhenhei fonts-jetbrains-mono fonts-noto-color-emoji&lt;br>
&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-desktop-next/" target="_blank" rel="noopener"
>更新记录和计划&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="安装">安装
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run -itd --restart&lt;span class="o">=&lt;/span>always &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name debian-i3 --hostname debian-i3 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 3389:3389 -p 2222:22 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -p 8080:8080 -p 5900-5905:5900-5905 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v /mnt:/disk &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -e &lt;span class="nv">TZ&lt;/span>&lt;span class="o">=&lt;/span>Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3389是xrdp端口 2222 是ssh x11端口 8080 是novnc 端口 5900-5905 是vnc端口默认用户是5900&lt;/p>
&lt;h3 id="默认用户名和密码">默认用户名和密码
&lt;/h3>&lt;p>xrdp x11 ssh 的默认用户名：yanhui 密码：1 （只有一个数字1）
vnc 密码：111111（六个数字1）&lt;/p>
&lt;h3 id="为什么选择debian">为什么选择debian
&lt;/h3>&lt;p>因为比Ubuntu干净，debian一直被诟病的包少的问题，debian12 增加了11089个包，总数量已经到了64419，部分官方仓库没有的软件，软件开发者自己一般提供源或者deb。 &lt;br>
放弃archlinux改debian 是因为有部分商业软件只有deb rpm包aur里面没有，自己解包太麻烦。 arch的 一些其他缺点这里不多说。&lt;br>
而且debian12 2年更新 5年安全，以后也可以平滑升级到更新版本。&lt;/p>
&lt;h3 id="为什么选择i3-和openbox-怎么换其他桌面">为什么选择i3 和openbox 怎么换其他桌面
&lt;/h3>&lt;p>因为轻量，以及个人习惯，你可以自由换成其他任意桌面系统。
因为i3的高效来自快捷键，但是在浏览器中会有大量快捷键冲突。所以新版本在novnc中使用了同样轻量的openbox。&lt;br>
而在xrdp中，因为全屏模式 和部分支持rdp的客户端软件 均可做到键盘映射，所以xrdp使用了i3桌面&lt;/p>
&lt;h4 id="更换为其他桌面的方法">更换为其他桌面的方法
&lt;/h4>&lt;p>例如，要换成 xfce4首先安装&lt;code>sudo apt install xfce4&lt;/code> ,然后修改 &lt;code>/autoStart.sh&lt;/code> 可以更换vnc和novnc的桌面。&lt;br>
修改用户目录下的 &lt;code>~/.xsession&lt;/code> 文件可以替换xrdp的桌面。然后卸载掉i3或者openbox即可:&lt;code>sudo apt purge i3&lt;/code> or &lt;code>sudo apt purge openbox&lt;/code>&lt;/p>
&lt;h3 id="novnc-vnc为什么是黑屏">novnc vnc为什么是黑屏
&lt;/h3>&lt;p>就是黑屏的，因为为了节省资源用的没有任何扩展的openbox。 右键 有惊喜！&lt;/p>
&lt;h3 id="怎么启动shell-和常见快捷键">怎么启动shell 和常见快捷键
&lt;/h3>&lt;p>基本是i3 的默认快捷键&lt;br>
点屏幕顶部的 Apps&amp;gt; 系统 &amp;gt;终端 （部分菜单无用，是因为没对应软件，你可以看一下polybar的配置文件 ）&lt;br>
如果是rdp远程桌面下，按下键盘 ： win+回车 &lt;br>
启动管理器（开始菜单） :win d&lt;br>
程序切换 alt+tab
修改窗口大小：按住win 再按住 鼠标右键 来回拖动&lt;br>
修改窗口位置：按住win 再按住 鼠标左键 来回拖动&lt;br>
关闭软件：win shift q&lt;br>
注销：win shift e&lt;br>
更多使用方法 自己看一下i3 使用说明&lt;/p>
&lt;h3 id="怎么装中文输入法">怎么装中文输入法
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-chinese-addons
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完成后，注销重新登录一次桌面，会自动加载，然后在托盘位置配置添加输入法即可，拼音输入法可导入搜狗细胞词库，具体自己研究。&lt;/p>
&lt;h3 id="怎么新建用户怎么删除默认用户">怎么新建用户怎么删除默认用户
&lt;/h3>&lt;h4 id="新建用户">新建用户
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo adduser YouName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -aG sudo YouName
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="新用户vnc密码">新用户vnc密码
&lt;/h5>&lt;p>ssh 或者 xrdp 登陆新用户后，运行 &lt;code>vncpasswd&lt;/code>&lt;/p>
&lt;h5 id="更新-vnc服务">更新 vnc服务
&lt;/h5>&lt;p>修改里面的用户名&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="删除默认用户">删除默认用户
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo deluser yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf /home/yanhui # 在确认用不到以后 再删除 为了不污染全局，桌面相关的配置文件都在这个目录里面
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="怎么修改密码">怎么修改密码
&lt;/h3>&lt;h4 id="用户密码">用户密码
&lt;/h4>&lt;p>命令：&lt;code>passwd&lt;/code>&lt;/p>
&lt;h4 id="vnc密码">vnc密码
&lt;/h4>&lt;p>命令：&lt;code>vncpasswd .vnc/passwd&lt;/code> ，需要重启vnc服务，命令查看 &lt;code>cat /autoStart.sh &lt;/code>&lt;/p>
&lt;h3 id="x11转发模式如何使用输入法">x11转发模式如何使用输入法
&lt;/h3>&lt;p>修改一下fcitx5的中英文切换快捷键，和你当前电脑的不能一样。然后先执行 &lt;code>fcitx5&amp;amp;&lt;/code> 再执行对应的软件。&lt;/p>
&lt;h3 id="x11-转发模式部分软件很卡">x11 转发模式部分软件很卡
&lt;/h3>&lt;p>没得办法，可以适当优化一下自己网上搜吧。另外 火狐在x11转发模式下默认配置要比chrome系更卡。&lt;/p>
&lt;h3 id="novnc默认地址">novnc默认地址
&lt;/h3>&lt;p>http://你的ip:8080/ 其中端口docker内部默认使用80，外部端口是你自己映射的。&lt;/p>
&lt;h3 id="novnc如何走https">novnc如何走https
&lt;/h3>&lt;p>建议用Nginx 统一反代一下，或带supervisor启动的时候带证书。&lt;/p>
&lt;h3 id="20230704版本vnc连不上">20230704版本vnc连不上
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm /tmp/.X0-lock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>把上面这行代码添加到 /autoStart.sh 第二行，然后重启整个容器&lt;/p>
&lt;h3 id="如何关掉vnc">如何关掉vnc
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo rm /etc/supervisor/conf.d/novnc.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt purge tigervnc-standalone-server novnc python3-websockify
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 注释掉 /autoStart.sh 的启动命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># su -c &amp;#34;/usr/bin/vncserver -xstartup /usr/bin/i3 -geometry 1900x930 -localhost no :0 &amp;#34; yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># sudo apt autoremove &amp;amp;&amp;amp; sudo apt autoclean &amp;amp;&amp;amp; sudo apt clean # 可选清理操作
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后卸载&lt;/p>
&lt;h3 id="天气预报出错以及如何修改天气预报城市">天气预报出错以及如何修改天气预报城市
&lt;/h3>&lt;p>&lt;code>~/.config/polybar/weather-plugin.py&lt;/code> 这个文件
天气预报接口 用的openweathermap,内置的我自己的接口，用的人多了会受限制无法使用。&lt;br>
你自己去注册一个账号，然后创建一个key。查询一下你所需要城市的id，然后修改里面的网址部分的 id（城市） appid（你自己的）&lt;br>
&lt;code>https://api.openweathermap.org/data/2.5/weather?id=1793724&amp;amp;appid=440b47a5ffbc5421e4a9befcbc4d635b&amp;amp;units=Metric&amp;amp;lang=zh_cn&lt;/code>&lt;br>
你如果不想用，直接在 polybar的配置文件里面删掉即可。&lt;/p>
&lt;h3 id="如何调音量">如何调音量
&lt;/h3>&lt;p>在i3配置文件里面修改&lt;br>
调整音量 快捷键：win ctrl ↑ 和 win ctrl ↓，（左右是静音）也可以鼠标移动到 polybar 音量图标位置滚轮调整。&lt;br>
进阶用法，自己配置i3和polybar&lt;/p>
&lt;h3 id="vnc-和xrdp-桌面不同步">vnc 和xrdp 桌面不同步
&lt;/h3>&lt;p>是的，这是两个虚拟显示，所以不同步。如果要显示同样的内容，可以在xrdp登陆的时候 选择登陆到vnc 而不是org 。&lt;/p>
&lt;h3 id="novnc-网页访问按键失灵乱跳">noVNC 网页访问按键失灵乱跳
&lt;/h3>&lt;p>1、关闭宿主的中文输入法，使用宿主机系统自带的英文输入法&lt;br>
2、更换浏览器，目前发现chrome edge之类的 在noVNC下兼容性不如新版火狐 火狐 96以后版本测试运行良好，safari 和 ios下的浏览器均不兼容的哈。&lt;/p>
&lt;h3 id="没声音或者--顶部音量不显示">没声音或者 顶部音量不显示
&lt;/h3>&lt;h4 id="vnc-和x11-没声音">vnc 和x11 没声音
&lt;/h4>&lt;p>vnc和x11 就是没声音的话，如果确实要，请用pulseaudio转发 或者换xrdp&lt;/p>
&lt;h4 id="xrdp的polybar-偶尔不显示音量">xrdp的polybar 偶尔不显示音量
&lt;/h4>&lt;p>这个是polybar 在 debian12下 和 pulseaudio-module-xrdp 之间的bug，已经提交过issue，等更新吧。&lt;br>
临时解决方法,在桌面登陆一会后 重启pulseaudio和polybar&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">killall pulseaudio &amp;amp;&amp;amp; pulseaudio &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh .config/polybar/polybar_run.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="如何修改分辨率">如何修改分辨率
&lt;/h3>&lt;h4 id="vnc-novnc">vnc novnc
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /autoStart.sh # geometry 后面的参数是vnc的分辨率
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="xrdp">xrdp
&lt;/h4>&lt;p>xrdp的分辨率 由你的客户端 发起的时候配置&lt;/p>
&lt;h3 id="openbox的壁纸点好多次才换一张">openbox的壁纸点好多次才换一张
&lt;/h3>&lt;p>壁纸是随机更换的默认就带了两张，所以会有50%概率不更换。&lt;/p>
&lt;h3 id="自己添加开机启动项">自己添加开机启动项
&lt;/h3>&lt;p>三个方法&lt;/p>
&lt;ul>
&lt;li>跟随 i3桌面启动的软件，可以添加到i3 配置文件中。例如截图软件，蓝牙托盘等等&lt;/li>
&lt;li>后台服务，可以添加到 /autoStart.sh&lt;/li>
&lt;li>需要守护的后台服务 添加到 supervisor中目录： /etc/supervisor/conf.d/&lt;/li>
&lt;/ul>
&lt;h3 id="安装常用软件">安装常用软件
&lt;/h3>&lt;p>点屏幕左上角 APPS &amp;gt; 系统 &amp;gt; 终端 输入 &lt;code>apt install &lt;/code>命令；启动软件 APPS &amp;gt; 系统 &amp;gt; &lt;code>rofi-run&lt;/code> 选择软件或者输入软件名称&lt;br>
或者xrdp全屏模式下 novnc 左侧快捷键也可： win+回车 win+d&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install firefox-esr # 火狐
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install chromium #chrome 开源版，闭源版本 去google下载deb 或者添加源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install thunar nemo nautilus # 任选一个 dolphin有依赖冲突哈 ，参考后面 libpulse-mainloop-glib0 错误的说明
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="libpulse-mainloop-glib0-错误">libpulse-mainloop-glib0 错误
&lt;/h4>&lt;p>libpulse-mainloop-glib0 : Depends: libpulse0 (= 16.1+dfsg1-2+b1) but 1:13.99.1-1ubuntu3.10 is to be installed
部分软件 例如 pavucontrol dolphin 需要新版 libpulse0，但是因为 考虑到pulseaudio-module-xrdp 稳定性，我用的旧版本。
你可以卸载掉，然后重新编译pulseaudio-module-xrdp。&lt;/p>
&lt;h3 id="不喜欢默认用户的shell">不喜欢默认用户的shell
&lt;/h3>&lt;p>默认用户 yanhui的 shell是 zsh 并用oh-my-zsh定制了一下，不喜欢 可以 直接输入exit 退出到bash。 &lt;br>
然后自己删掉 .bashrc 的最后一行 zsh 三个字母。最后卸载掉 zsh ，并删除 .oh-my-zsh 目录即可&lt;/p>
&lt;h3 id="pve-lxc-ct-或者docker宿主机-目录映射-和显卡等">pve lxc ct 或者docker宿主机 目录映射 和显卡等
&lt;/h3>&lt;h4 id="pve-硬盘到lxc">pve 硬盘到lxc
&lt;/h4>&lt;p>请看：https://dev.leiyanhui.com/pve/lxc-mount-dir/&lt;/p>
&lt;h4 id="docker宿主机-目录映射">docker宿主机 目录映射
&lt;/h4>&lt;p>docker 创建命令 里面的 &lt;code>-v /mnt:/disk &lt;/code> 就是把上层宿主的 /mnt 穿透到容器内部的/disk。
注意权限问题哈，可以用uid映射方法，权限要求不严格 也可以直接 &lt;code>chmod -R 777 /mnt&lt;/code>解决&lt;/p>
&lt;h4 id="如何使用显卡加速">如何使用显卡加速
&lt;/h4>&lt;p>以nvidia为例在创建docker的时候 把显卡挂进去即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --restart=always \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name debian-i3 --hostname debian-i3 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 3389:3389 -p 2222:22 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 8080:8080 -p 5900-5905:5900-5905 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /mnt:/disk \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia0:/dev/nvidia0 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidiactl:/dev/nvidiactl \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --device /dev/nvidia-uvm:/dev/nvidia-uvm \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e TZ=Asia/Shanghai joyanhui/debian-i3-xrdp-novnc /autoStart.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="目录和文件说明">目录和文件说明
&lt;/h3>&lt;h4 id="启动文件">启动文件
&lt;/h4>&lt;p>启动文件分两个&lt;/p>
&lt;ul>
&lt;li>/autoStart.sh 启动vnc 并启动supervisord&lt;/li>
&lt;li>/etc/supervisor/conf.d/ supervisord 服务目录&lt;/li>
&lt;/ul>
&lt;h4 id="i3-配置文件">i3 配置文件
&lt;/h4>&lt;p>/home/yanhui/.config/i3/config&lt;/p>
&lt;h4 id="openbox配置文件">openbox配置文件
&lt;/h4>&lt;p>/home/yanhui/.config/openbox/menu.xml #右键菜单&lt;br>
feh.sh rofi.sh #右键菜单对应 壁纸和rofi的的执行脚本&lt;/p>
&lt;h4 id="壁纸目录">壁纸目录
&lt;/h4>&lt;p>i3配置文件调用feh随机选
/home/yanhui/.config/i3/bg/&lt;/p>
&lt;h4 id="polybar">polybar
&lt;/h4>&lt;ul>
&lt;li>/home/yanhui/.config/polybar/config.ini # polybar的全部配置文件 包括左上角菜单&lt;/li>
&lt;li>/home/yanhui/.config/polybar/polybar_run.sh # 启动和重启polybar的脚本&lt;/li>
&lt;li>/home/yanhui/.config/polybar/weather-plugin.py # polybar 天气预报插件 用的 openweathermap.org的接口 内置key用的人多有可能失效，自己去注册一个换掉。&lt;/li>
&lt;/ul>
&lt;h4 id="rofi">rofi
&lt;/h4>&lt;p>/home/yanhui/.config/rofi/config.rasi&lt;/p>
&lt;h4 id="dunst">dunst
&lt;/h4>&lt;p>/home/yanhui/.config/dunst/dunstrc&lt;/p>
&lt;h4 id="alacritty">alacritty
&lt;/h4>&lt;p>/home/yanhui/.config/alacritty/alacritty.yml&lt;/p>
&lt;h4 id="zsh">zsh
&lt;/h4>&lt;p>/home/yanhui/.zshrc
/home/yanhui/.oh-my-zsh&lt;/p></description></item><item><title>阿里云docker私有镜像服务貌似限速了</title><link>https://dev.leiyanhui.com/docker/aliyundocker-limit/</link><pubDate>Mon, 20 Feb 2023 00:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/aliyundocker-limit/</guid><description>&lt;p>连续几天 上传速度只有可怜的 几百K&lt;/p></description></item><item><title>alpine中安装mysql/mariadb的一个小坑 无法远程访问的问题</title><link>https://dev.leiyanhui.com/docker/alpine-mysql-err/</link><pubDate>Sat, 18 Feb 2023 19:13:10 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/alpine-mysql-err/</guid><description>&lt;p>lxc容器运行的 alpine 里面单独装一个 mariadb。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apk/repositories
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk search mysql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk search mariadb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mariadb-server-utils-10.6.10-r0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add mariadb mariadb-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc-update add mariadb default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch /run/openrc/softlevel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/mariadb setup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc-service mariadb start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql -u root -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果要装 mysql5.7 需要官网去下载 二进制。 或者 套docker&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Welcome to the MariaDB monitor. Commands end with &lt;span class="p">;&lt;/span> or &lt;span class="se">\g&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your MariaDB connection id is &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Server version: 10.6.10-MariaDB MariaDB Server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看具体版本 记住&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mysql -V&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql Ver 15.1 Distrib 10.6.10-MariaDB, &lt;span class="k">for&lt;/span> Linux &lt;span class="o">(&lt;/span>x86_64&lt;span class="o">)&lt;/span> using readline 5.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="修改本地用户密码">修改本地用户密码
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysql -u root -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; ALTER USER &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;你的密码&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="打开远程访问">打开远程访问
&lt;/h3>&lt;h4 id="远程用户密码">远程用户密码
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mysql -u root -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; GRANT ALL PRIVILEGES ON *.* TO &lt;span class="s1">&amp;#39;root&amp;#39;&lt;/span>@&lt;span class="s1">&amp;#39;%&amp;#39;&lt;/span> IDENTIFIED BY &lt;span class="s1">&amp;#39;你的密码&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; use mysql&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; SELECT host,user,password from user&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; flush privileges&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置文件">配置文件
&lt;/h4>&lt;p>将 vi /etc/my.cnf.d/mariadb-server.cnf 中bind-address = XXXX 加# 注释掉 或者改为 bind-address = 0.0.0.0&lt;/p>
&lt;h5 id="小坑">小坑
&lt;/h5>&lt;p>此处有一个小坑，alpine的 mariadb默认skip-networking 就是不监听tcp，需要一起去掉注释&lt;/p>
&lt;h4 id="重启">重启
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rc-service mariadb restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="进阶">进阶
&lt;/h3>&lt;h4 id="清理-localhost-的root用户可选操作不太建议">清理 localhost 的root用户。可选操作，不太建议
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysql -u root -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; DROP USER &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; use mysql;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; SELECT host,user,password from user;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; flush privileges;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql&amp;gt; exit;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="修改端口">修改端口
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vi /etc/my.cnf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 在mysqlld节点下增加一行 port=端口号
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker和lxc的对比和选择</title><link>https://dev.leiyanhui.com/docker/docker-vs-lxc/</link><pubDate>Sun, 12 Feb 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/docker-vs-lxc/</guid><description>&lt;p>两者都是虚拟化容器，都和宿主之间隔离，并且有非常低的风险被绕过容器隔离。&lt;br>
都支持桥接物理网络，直接接入上级路由，或者类似虚拟机那种仅限主机的网络配置。&lt;br>
两者在性能上没差别 &lt;br>
都可以方便的备份和迁移 &lt;br>
两者都可以挂载目录，或者挂到 raw格式的虚拟磁盘内。 &lt;br>
内核都是使用宿主机内核&lt;/p>
&lt;p>docker： 定位为应用程序容器，docker 至少有一个程序在前端运行，不然docker会直接关掉退出。 一般情况下，原则上一个docker只跑一个服务，早期的docker 就是lxc ，docker文件分层，docker的更新是整个镜像更新，要保留的文件需要提前映射到目录外部。&lt;br>
docker的镜像超多 使用方便&lt;/p>
&lt;p>lxc：定位为系统容器，可以视作一个完整的操作系统，lxc的文件不分层 lxc没有镜像更新的概念他本身就是一个完整的操作系统，直接在系统内部升级对应的应用或者系统自身等即可。&lt;br>
lxc更为灵活，lxc因为是一个完整的系统，lxc内的是可以正常安装docker的 并且和lxc的宿主之间完全隔离 &lt;br>
lxc的镜像较少，一般只是几个常见发行版的镜像&lt;/p>
&lt;p>中小团队如何选择？&lt;/p>
&lt;p>pve平台的话，不用考虑 lxc 也可以 一个lxc 跑一个服务。 能不用docker的 就直接lxc即可。 需要docker的 可以lxc 里面安装docker&lt;/p>
&lt;p>如果所需服务不多，可以全部在一个lxc里面搞定&lt;/p>
&lt;blockquote>
&lt;p>lxc 的alpine+docker 磁盘占用，比裸的lxc debian要小&lt;/p>&lt;/blockquote></description></item><item><title>docker运行amh.sh 以及amh的体验</title><link>https://dev.leiyanhui.com/docker/amh-sh/</link><pubDate>Sun, 22 Jan 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/amh-sh/</guid><description>&lt;p>说起来amh就难免说到宝塔。曾经优秀的国产软件，沦落到现在&amp;hellip;&lt;/p>
&lt;p>先有强制绑定手机，后有接连爆出漏洞，最后又被实锤半夜上传数据&amp;hellip;&lt;/p>
&lt;p>逐步尝试用其他软件替代宝塔。今天尝试amh.sh&lt;br>
大概看了一下amh.sh 主要基于 bash脚本和php脚本实现的。（PS：为什么就没有一个用golang做的靠谱的面板）&lt;/p>
&lt;h2 id="基于debian11-创建">基于debian11 创建
&lt;/h2>&lt;p>使用我自己的镜像&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --name amh --hostname amh --privileged=true \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 50010:2222 -p 50011-50029:50011-50029 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">registry.cn-qingdao.aliyuncs.com/joyanhui/base-sh-debian:debian11-sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装">安装
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker exec -it amh /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install -y wget
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget http://dl.amh.sh/amh.sh &amp;amp;&amp;amp; bash amh.sh nginx-1.20,mysql-5.7,php-7.4 35546
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>依赖很多，安装需要一点时间，官网说的免编译安装，结果卡卡卡 全编译安装，查看了一下文档也没有说到底什么环境才是免编译的。未免对amh.sh大失所望。 还没装完已经想删除了。&lt;/p>
&lt;h2 id="简单配置">简单配置
&lt;/h2>&lt;p>修改端口 默认管理端口是 8888 9999 官网文档没有说明。。。我以为是可以自定义，看了下文档 也没有说明。。。&lt;/p>
&lt;h3 id="附加软件">附加软件
&lt;/h3>&lt;p>phpmyadmin amrewrite amdata&lt;/p>
&lt;p>鉴于 amh文档残缺 ，已经删除，不相信这玩意能好用到哪里去&lt;/p></description></item><item><title>docker运行amh.sh 以及amh的体验</title><link>https://dev.leiyanhui.com/docker/urlos/</link><pubDate>Sun, 22 Jan 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/urlos/</guid><description>&lt;p>说起来amh就难免说到宝塔。曾经优秀的国产软件，沦落到现在&amp;hellip;&lt;/p>
&lt;p>先有强制绑定手机，后有接连爆出漏洞，最后又被实锤半夜上传数据&amp;hellip;&lt;/p>
&lt;p>逐步尝试用其他软件替代宝塔。今天尝试 urlos&lt;/p>
&lt;p>docker run -itd &amp;ndash;name urlos &amp;ndash;restart always -p 9969:9969 -p 9968:9968 -p 9966:9966 urlos/urlos&lt;/p>
&lt;p>也是一个奇葩。。。 强制绑定手机号，然后手机号不可以直接注册，要先邮箱注册。。。然后。。不知后面还有什么套路。已经删掉&lt;/p></description></item><item><title>docker 一个可用的完整桌面系统</title><link>https://dev.leiyanhui.com/docker/docker-linux-desktop/</link><pubDate>Sun, 01 Jan 2023 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/docker-linux-desktop/</guid><description>&lt;p>选择 用 &lt;a class="link" href="https://hub.docker.com/r/linuxserver/webtop" target="_blank" rel="noopener"
>https://hub.docker.com/r/linuxserver/webtop&lt;/a>&lt;/p>
&lt;p>默认用户名：abc 密码：abc&lt;/p>
&lt;h2 id="3d加速-ubuntu">3D加速 Ubuntu
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">--device=/dev/dri:/dev/dri
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="fuse">fuse
&lt;/h2>&lt;p>宿主机要安装fuse&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> --privileged
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>另外一个方案 是&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">--device /dev/fuse \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --cap-add SYS_ADMIN \
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="端口">端口
&lt;/h2>&lt;p>3000 是web-vnc 3389 和22 不用多说&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">-p 10100:3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 10101:3389
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 10102:22
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ubuntu-3d">ubuntu 3D
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ubuntu&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">privileged&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">opt&lt;/span> &lt;span class="n">seccomp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">unconfined&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PGID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TZ&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">SUBFOLDER&lt;/span>&lt;span class="o">=/&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">KEYBOARD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">us&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qwerty&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TITLE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ubuntu&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10101&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3389&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10102&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span> &lt;span class="n">unless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stopped&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lscr&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linuxserver&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kde&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="输入法">输入法
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install fcitx5 fcitx5-rime
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>另外需要编辑 /init 实现自动启动&lt;/p>
&lt;h2 id="arch">arch
&lt;/h2>&lt;blockquote>
&lt;p>kde的镜像 有点问题，xrdp连不上&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">privileged&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">opt&lt;/span> &lt;span class="n">seccomp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">unconfined&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PGID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TZ&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">SUBFOLDER&lt;/span>&lt;span class="o">=/&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">KEYBOARD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">us&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qwerty&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TITLE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10101&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3389&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">10102&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">device&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span> &lt;span class="n">unless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stopped&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lscr&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linuxserver&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker镜像备份到阿里云容器服务</title><link>https://dev.leiyanhui.com/docker/img-to-aliyun/</link><pubDate>Tue, 13 Dec 2022 09:58:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/img-to-aliyun/</guid><description>&lt;h2 id="关于阿里云的镜像服务">关于阿里云的镜像服务
&lt;/h2>&lt;p>目前阿里云的docker镜像服务只限制并发数要求&amp;lt;10，并不限制容量和速度。 可以满足日常小团队使用。&lt;/p>
&lt;h2 id="配置阿里云容器服务">配置阿里云容器服务
&lt;/h2>&lt;p>打开 &lt;code>https://cr.console.aliyun.com/cn-qingdao/instances&lt;/code> 我这里选青岛节点&lt;/p>
&lt;p>创建个人版实例&lt;/p>
&lt;h2 id="弄一个公开的镜像">弄一个公开的镜像
&lt;/h2>&lt;p>创建一个镜像仓库 先弄一个公开的 仓库名称 ：base-sh-debian 选择本地仓库&lt;/p>
&lt;h3 id="推送镜像">推送镜像
&lt;/h3>&lt;pre>&lt;code>docker login --username=邮箱 registry.cn-qingdao.aliyuncs.com
# 用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。
docker docker images
# docker tag [ImageId] registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:[镜像版本号]
docker tag debian11:sshd-autoboot.sh2222 registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222
# docker push registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:[镜像版本号]
docker push registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222
&lt;/code>&lt;/pre>
&lt;h3 id="因为这个是公开的所以可以直接使用">因为这个是公开的，所以可以直接使用
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --name debian-go-codeserver-git --privileged=true \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 59010:2222 -p 59011-59019:59011-59019 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这镜像的详细使用 &lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-sshd/" target="_blank" rel="noopener"
>点击这里查看&lt;/a>&lt;/p>
&lt;h3 id="清理">清理
&lt;/h3>&lt;pre>&lt;code>docker rmi registry.cn-qingdao.aliyuncs.com/你的用户名/base-sh-debian:debian11-sshd-autoboot.sh2222
&lt;/code>&lt;/pre>
&lt;h2 id="私有镜像也就是只有有密码才可以获取的">私有镜像，也就是只有有密码才可以获取的
&lt;/h2>&lt;h3 id="创建一个私有仓库">创建一个私有仓库
&lt;/h3>&lt;p>过程略 名字就叫做 &lt;code>mydocker&lt;/code>&lt;/p>
&lt;h3 id="把正在使用的容器直接打包到镜像">把正在使用的容器直接打包到镜像
&lt;/h3>&lt;p>我这里不保留历史记录 所以不使用&lt;code>docker commit&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 导出&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">go&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">codeserver&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">git&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 打包压缩 这步可以跳过,因为这里还要本地储存一下&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">gzip&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 导入，这里直接导入到阿里云的格式 就不用再打一次标签。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cat&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">registry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qingdao&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">aliyuncs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">joyanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mydocker&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">coder&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">golang&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">git&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">autoboot&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sh2222&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2022&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1213&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 推送&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="n">registry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qingdao&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">aliyuncs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">joyanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mydocker&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">coder&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">golang&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">git&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">autoboot&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sh2222&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2022&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1213&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>清理&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker rmi registry.cn-qingdao.aliyuncs.com/joyanhui/mydocker:debian11-ssh-coder-golang-git-autoboot.sh2222-2022-1213
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="编写一个shell">编写一个shell
&lt;/h2>&lt;p>docker.sh&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 一键备份正在运行的docker到阿里云 并丢弃历史记录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 登录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># docker login --username=用户名 registry.cn-区域.aliyuncs.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 阿里云远程地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">remoturl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">registry&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qingdao&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">aliyuncs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">你的&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">你的仓库名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 要备份的容器名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dockername&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">go&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">codeserver&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">git&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 标签前缀&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tagname&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">coder&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">golang&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">git&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">autoboot&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sh2222&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 临时文件名前缀&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tarfilename&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">go&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">codeserver&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">git&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">datename&lt;/span>&lt;span class="o">=$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">date&lt;/span> &lt;span class="o">+%&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">-%&lt;/span>&lt;span class="n">H&lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="n">M&lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">当前时间&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">datename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">导出到&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">dockername&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">tarfilename&lt;/span>&lt;span class="o">-$&lt;/span>&lt;span class="n">datename&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">导出到&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="err">完毕&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="n">tar导入到镜像&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cat&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">tarfilename&lt;/span>&lt;span class="o">-$&lt;/span>&lt;span class="n">datename&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">remoturl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">tagname&lt;/span>&lt;span class="o">-$&lt;/span>&lt;span class="n">datename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="n">tar导入到镜像&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="err">完毕&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">推送镜像到阿里云青岛&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">push&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">remoturl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">tagname&lt;/span>&lt;span class="o">-$&lt;/span>&lt;span class="n">datename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">推送镜像到阿里云青岛&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="err">完毕&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">删除本地镜像&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">rmi&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">remoturl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">tagname&lt;/span>&lt;span class="o">-$&lt;/span>&lt;span class="n">datename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">删除本地文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">tarfilename&lt;/span>&lt;span class="o">-$&lt;/span>&lt;span class="n">datename&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">完毕&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="err">请打开&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">cr&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">console&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">aliyun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qingdao&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">repositories&lt;/span> &lt;span class="err">查看&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="加到计划任务每天一次">加到计划任务，每天一次
&lt;/h3>&lt;p>&lt;code>/var/spool/cron/crontabs/root&lt;/code> 或者 &lt;code>crontab -e&lt;/code> 查看状态&lt;code>service crond status&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cat&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">spool&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cron&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">crontabs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">root&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># do daily/weekly/monthly maintenance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># min hour day month weekday command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">*/&lt;/span>&lt;span class="mi">15&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">parts&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">periodic&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="nb">min&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">parts&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">periodic&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hourly&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">parts&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">periodic&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">daily&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">6&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">parts&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">periodic&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">weekly&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">parts&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">periodic&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">monthly&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">15&lt;/span> &lt;span class="mi">9&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">sh&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tom&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sh&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>docker运行一个可以使用usb和显卡加速的桌面linux</title><link>https://dev.leiyanhui.com/docker/run-deskto-gpu-usb/</link><pubDate>Tue, 13 Dec 2022 09:58:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/run-deskto-gpu-usb/</guid><description>&lt;h2 id="项目简介">项目简介
&lt;/h2>&lt;p>&lt;a class="link" href="https://hub.docker.com/r/linuxserver/" target="_blank" rel="noopener"
>https://hub.docker.com/r/linuxserver/&lt;/a>&lt;/p>
&lt;p>他是默认开了web vnc 和 xrdp的&lt;/p>
&lt;p>其中ubuntu的镜像是支持3d加速的。&lt;/p>
&lt;h2 id="准备工作">准备工作
&lt;/h2>&lt;p>先查看宿主机的显卡 &lt;code>ls /dev/dri&lt;/code>
usb设备 &lt;code>ls /dev/bus/usb&lt;/code>
可以用 usbutils 和 lspice 详细查看&lt;/p>
&lt;h2 id="选择-webtop-镜像">选择 webtop 镜像
&lt;/h2>&lt;p>没有gnome,我这里 选择 ubuntu-kde，&lt;/p>
&lt;h2 id="和常规docker不一样的地方">和常规docker不一样的地方
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>1、设备的映射&lt;/p>
&lt;pre>&lt;code>--device /dev/dri:/dev/dri \
--device /dev/fuse \
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;p>/dev/dri 显卡 /dev/fuse 就是fuse 宿主机要 &amp;lsquo;modprobe fuse&amp;rsquo;&lt;/p>
&lt;ul>
&lt;li>
&lt;p>2、docker嵌套&lt;/p>
&lt;pre>&lt;code>-v /var/run/docker.sock:/var/run/docker.sock \
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>3、权限&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">--device /dev/fuse \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--cap-add SYS_ADMIN \
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">--device /dev/fuse \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--cap-add SYS_ADMIN \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--security-opt apparmor:unconfined \
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>实在不行直接上 &lt;code>--privileged&lt;/code>&lt;/p>
&lt;h2 id="创建">创建
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kde&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kde&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kde&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">hostname&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">arch&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">privileged&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">opt&lt;/span> &lt;span class="n">seccomp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">unconfined&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PGID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TZ&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">SUBFOLDER&lt;/span>&lt;span class="o">=/&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">KEYBOARD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">us&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">qwerty&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">TITLE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Webtop&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">59030&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">59031&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3389&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">59032&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">59033&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">59039&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">59033&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">59039&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bus&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">usb&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bus&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">usb&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">device&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dri&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">cap&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">add&lt;/span> &lt;span class="n">SYS_ADMIN&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">cap&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">add&lt;/span> &lt;span class="n">MKNOD&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">device&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">fuse&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">mrw&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span> &lt;span class="n">unless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stopped&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">linuxserver&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webtop&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">arch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kde&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="中文和汉化">中文和汉化
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -Sy nano
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nano /etc/pacman.d/mirrorlist
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S wqy-microhei
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S wqy-zenhei
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S fcitx5-im fcitx5-rime
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="时区">时区
&lt;/h4>&lt;p>需要su
sudo passwd root
echo &amp;ldquo;Asia/Shanghai&amp;rdquo; &amp;gt; /etc/timezone
rm -rf /etc/localtime
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&lt;/p>
&lt;h3 id="输入法配置">输入法配置
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo nano /etc/environment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GTK_IM_MODULE=fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">QT_IM_MODULE=fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">XMODIFIERS=@im=fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SDL_IM_MODULE=fcitx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GLFW_IM_MODULE=ibus
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">source /etc/environment
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="yay">yay
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo nano /etc/pacman.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[archlinuxcn]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -Sy archlinuxcn-keyring
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S yay
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="其他常用工具">其他常用工具
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S wget unzip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="聊天软件">聊天软件
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S libnotify dunst #通知服务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yay -S electronic-wechat-uos-bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#kde还需要一个
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S xdg-desktop-portal-kde
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget -c https://dldir1.qq.com/qqfile/qq/QQNT/4691a571/QQ-v2.0.1-429_x64.AppImage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod u+x ./QQ-*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#AppImage依赖fuse，docker里面的fuse有一点小问题，启动测试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./QQ-v2.0.1-429_x64.AppImage --appimage-extract-and-run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S telegram-desktop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="宿主重启一下docker">宿主重启一下docker
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker restart webtop-arch-kde
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="最后结语">最后结语
&lt;/h2>&lt;p>因为docker的原因，后续一些小地方的处理会非常麻烦&lt;/p>
&lt;p>尝鲜 可以，或者只用几个简单的软件也没啥问题，日用还是有一些问题的。&lt;/p>
&lt;p>只用来跑一个几个软件 是不错的选择。&lt;/p></description></item><item><title>docker 配置一个支持sshd的debian</title><link>https://dev.leiyanhui.com/docker/debian-sshd/</link><pubDate>Tue, 29 Nov 2022 07:20:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-sshd/</guid><description>&lt;p>参考 &lt;a class="link" href="https://dev.leiyanhui.com/docker/alpine-sshd/" target="_blank" rel="noopener"
>docker中制作alpine+sshd的基础镜像&lt;/a>&lt;/p>
&lt;h2 id="选择基础系统镜像">选择基础系统镜像
&lt;/h2>&lt;p>还是考虑用debian系列，docker pull debian:bullseye-slim&lt;/p>
&lt;pre>&lt;code>docker run -itd --name debian-for-sshd -p 59010:2222 -p 59011:22 --privileged=true debian:bullseye-slim /bin/bash
docker exec -it debian-for-sshd /bin/bash
&lt;/code>&lt;/pre>
&lt;h2 id="安装sshd">安装sshd
&lt;/h2>&lt;h3 id="国内源更新安装sshd-nano-tzdata">国内源/更新/安装sshd nano tzdata
&lt;/h3>&lt;pre>&lt;code>sudo sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list
apt update
apt install openssh-server nano tzdata
cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/code>&lt;/pre>
&lt;h3 id="配置登录信息">配置登录信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sed -i &amp;#34;s/#PermitRootLogin.*/PermitRootLogin yes/g&amp;#34; /etc/ssh/sshd_config &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t dsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_dsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t rsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_rsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ecdsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ecdsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ed25519 -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ed25519_key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;root:root&amp;#34; | chpasswd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="打开sftp">打开sftp
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/pve/open-sftp/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/open-sftp/&lt;/a>&lt;/p>
&lt;h3 id="修改端口-为2222">修改端口 为2222
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nano /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/init.d/ssh restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="测试登录">测试登录
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ssh root@10.0.0.9 -p 59010
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置脚本自动启动">配置脚本自动启动
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;/etc/init.d/ssh start&amp;#34; &amp;gt; /autoboot.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;tail -f /dev/null&amp;#34; &amp;gt;&amp;gt; /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后这行是防止退出的&lt;/p>
&lt;h3 id="清理">清理
&lt;/h3>&lt;pre>&lt;code>apt clean
apt autoclean
&lt;/code>&lt;/pre>
&lt;h3 id="备份容器">备份容器
&lt;/h3>&lt;p>在宿主机运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 打包压缩&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">gzip&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#备份&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="n">debian11&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">smb&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删除旧的容器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sshd&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="创建新容器">创建新容器
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat debian11-for-sshd.tar.gz | docker import - debian11:sshd-autoboot.sh2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -itd --name debian-go-codeserver-git --privileged=true \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 59010:2222 -p 59011-59019:59011-59019 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">debian11:sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以直接用我放在阿里云上的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd --name debian-go-codeserver-git --privileged=true \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 59010:2222 -p 59011-59019:59011-59019 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">registry.cn-qingdao.aliyuncs.com/joyanhui/base-sh-debian:debian11-sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="搞其他的">搞其他的
&lt;/h3>&lt;p>ssh 连接上随便玩起来，如果要添加跟随容器启动的程序 就编辑 /autoboot.sh&lt;/p></description></item><item><title>docker部署vscode和golang git</title><link>https://dev.leiyanhui.com/docker/debian-go-codeserver-git/</link><pubDate>Tue, 29 Nov 2022 07:20:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/debian-go-codeserver-git/</guid><description>&lt;p>新版codeserver 依赖glibc已经不支持 在alpine上安装，尝试过用官网docker来处理 发现不符合我要求，而且存在权限问题。所以还是自己新建一个基本系统来处理。&lt;/p>
&lt;h3 id="docker-配置一个支持sshd的debian">docker 配置一个支持sshd的debian
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/docker/debian-sshd" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/debian-sshd&lt;/a>&lt;br>
因为这个docker还要迁移，所以我这里不打算映射任何目录 端口也固定分配&lt;/p>
&lt;pre>&lt;code>cat debian11-for-sshd.tar.gz | docker import - debian11:sshd-autoboot.sh2222
docker run -itd --name debian-go-codeserver-git --privileged=true \
-p 59010:2222 -p 59011-59019:59011-59019 \
debian11:sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/code>&lt;/pre>
&lt;h4 id="ssh登录到59010端口-挂一下学习工具">ssh登录到59010端口 挂一下学习工具
&lt;/h4>&lt;pre>&lt;code>export http_proxy=&amp;quot;10.0.0.1:20172&amp;quot;
export https_proxy=&amp;quot;10.0.0.1:20172&amp;quot;
&lt;/code>&lt;/pre>
&lt;h4 id="安装">安装
&lt;/h4>&lt;pre>&lt;code>apt install curl
curl -fsSL https://code-server.dev/install.sh | sh
&lt;/code>&lt;/pre>
&lt;h3 id="启动">启动
&lt;/h3>&lt;pre>&lt;code>code-server
&lt;/code>&lt;/pre>
&lt;h3 id="修改密码和端口">修改密码和端口
&lt;/h3>&lt;pre>&lt;code>nano ~/.config/code-server/config.yaml
&lt;/code>&lt;/pre>
&lt;p>内容&lt;/p>
&lt;pre>&lt;code>bind-addr: 0.0.0.0:59011
auth: password
password: cd89d839912d5d87cd7db6c7
cert: false
&lt;/code>&lt;/pre>
&lt;p>注意 每个冒号后面都有空格&lt;/p>
&lt;h3 id="自动启动">自动启动
&lt;/h3>&lt;pre>&lt;code>nano /autoboot.sh
&lt;/code>&lt;/pre>
&lt;p>内容&lt;/p>
&lt;pre>&lt;code>/etc/init.d/ssh start
/usr/bin/code-server &amp;amp;
tail -f /dev/null
&lt;/code>&lt;/pre>
&lt;h3 id="最后">最后。。
&lt;/h3>&lt;p>codesever 新版 依赖 glibc 已经无法安装，会麻烦很多。基础镜像还是建议用&lt;/p></description></item><item><title>docker部署vscode/codeserver和golang 可以迁移git开发环境</title><link>https://dev.leiyanhui.com/docker/codeserver/</link><pubDate>Tue, 29 Nov 2022 07:05:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/codeserver/</guid><description>&lt;h2 id="基本使用">基本使用
&lt;/h2>&lt;p>&lt;a class="link" href="https://coder.com/docs/code-server/latest/install#docker" target="_blank" rel="noopener"
>https://coder.com/docs/code-server/latest/install#docker&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir -p ~/.config/codeserver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run -it --name code-server -p 8080:8080 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v &amp;#34;$HOME/.config/codeserver:/home/coder/.config&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v &amp;#34;$PWD:/home/coder/project&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -u &amp;#34;$(id -u):$(id -g)&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -e &amp;#34;DOCKER_USER=$USER&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> codercom/code-server:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>要配置golang 就在codeserver的终端里面 安装就好了。
如果要做web开发 或者其他网络的开发 的话，你可能还需要多映射几个端口进去。&lt;/p>
&lt;h2 id="进阶-手动打造一个主机的golang--git-开发环境">进阶 手动打造一个主机的golang git 开发环境
&lt;/h2>&lt;p>点击这里 &lt;a class="link" href="https://dev.leiyanhui.com/docker/golang-codeserserver/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/golang-codeserserver/&lt;/a>&lt;/p></description></item><item><title>docker运行 官方宝塔</title><link>https://dev.leiyanhui.com/docker/baota/</link><pubDate>Sun, 27 Nov 2022 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/baota/</guid><description>&lt;p>宝塔 终于出官方docker了 基于&lt;code>CentOS 7.9.2009 x86_64&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://hub.docker.com/r/btpanel/baota" target="_blank" rel="noopener"
>https://hub.docker.com/r/btpanel/baota&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.bt.cn/bbs/thread-79499-1-1.html" target="_blank" rel="noopener"
>https://www.bt.cn/bbs/thread-79499-1-1.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>LNMP镜像大小大概 733.3MB 解压后大概3006.51MB 。。。没得办法，宝塔的依赖项真的是太多了。。。
在软路由上搞起来先&lt;/p>
&lt;h2 id="先整理端口">先整理端口
&lt;/h2>&lt;p>不打算映射数据出来，方便转移，并预留ssh 和常用端口&lt;/p>
&lt;pre>&lt;code>#宝塔面板 22 ssl http phpmyadmin
-p 51888:8888 -p 51022:22 -p 51443:443 -p 51080:80 -p 51188:888 \
# 路由器封80 443自定义web端口 以及22重复
-p 51081:51081 -p 51444:51444 -p 51000:22 \
# mysql
-p 51306:3306 \
# redis
-p 51379:6379 \
# pgsql
-p 51432:5432 \
# MongoDB
-p 51017:27017 \
# 备用端口
-p 51200-51299:51200-51299 \
&lt;/code>&lt;/pre>
&lt;p>你问我为啥开这么多端口。。我开心我乐意，反正外网又访问不到。。。&lt;/p>
&lt;h2 id="镜像和标签的选择">镜像和标签的选择
&lt;/h2>&lt;p>latest 标签拉取的是lib标签，安装了面板并且安装集成依赖包，安装每个软件都会快一点。&lt;br>
fresh 标签表示安装了面板但是没有安装集成依赖包，安装第一个软件会比较慢，因为需要装依赖包。&lt;br>
lib 标签表示安装了面板并且安装集成依赖包，安装每个软件都会快一点。&lt;br>
lnmp 标签表示安装了面板、集成包并且集成LNMP【Nginx1.22+MySQL5.7+PHP7.4】arm标签是MySQL5.6&lt;br>
lamp 标签表示安装了面板、集成包并且集成LAMP【Apache2.4+MySQL5.7+PHP7.4】arm标签是MySQL5.6&lt;br>
我这里选择&lt;code>lnmp&lt;/code> 经过测试发现，其实还集成了ftp&lt;/p>
&lt;h2 id="目录的挂载">目录的挂载
&lt;/h2>&lt;p>/www/server/data 数据库&lt;br>
/www/wwwroot 网站目录 或者说 静态文件目录&lt;br>
/www/server/panel/vhost 虚拟机主机配置文件&lt;br>
其他目录参考宝塔官网&lt;br>
我不打算映射出来，因为可以在宝塔内挂载oss之类的网盘自动备份。&lt;br>
而且不映射任何目录的话，docker的备份和迁移更为简单简单一些。&lt;/p>
&lt;h2 id="最终命令的整理">最终命令的整理
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --restart unless-stopped --name baota \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51888:8888 -p 51022:22 -p 51443:443 -p 51080:80 -p 51188:888 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51081:51081 -p 51444:51444 -p 51000:22 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51306:3306 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51379:6379 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51432:5432 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51017:27017 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p 51200-51299:51200-51299 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">btpanel/baota:lnmp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="默认账户名密码-和登录地址">默认账户名密码 和登录地址
&lt;/h2>&lt;p>现在，您可以在浏览器访问默认地址 http://您的ip地址:8888/btpanel 上的宝塔面板。
默认用户：btpanel
默认密码：btpaneldocker
默认SSH密码：用户名 root 密码 btpaneldocker&lt;/p>
&lt;p>默认用户：btpanel&lt;br>
默认密码：btpaneldocker&lt;br>
容器默认SSH密码：btpaneldocker&lt;/p>
&lt;h2 id="其他">其他
&lt;/h2>&lt;h3 id="容器内的服务处理">容器内的服务处理
&lt;/h3>&lt;p>是使用的&lt;code>/bt.sh&lt;/code> 这个文件，除了默认服务之外，其他服务需要自行添加默认内容&lt;/p>
&lt;pre>&lt;code>#!/bin/bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH
init_path=/etc/init.d
Root_Path=`cat /var/bt_setupPath.conf`
Setup_Path=$Root_Path/server/mysql
Data_Path=$Root_Path/server/data
soft_start(){
${init_path}/nginx start
${init_path}/php-fpm-74 start
${init_path}/pure-ftpd start
${init_path}/bt restart
pkill crond
/sbin/crond
/usr/sbin/sshd -D &amp;amp;
}
is_empty_Data(){
return `ls -A ${Data_Path}/|wc -w`
}
init_mysql(){
# initialize_mysql
if [ -f /init_mysql.sh ];then
sh /init_mysql.sh
rm -f /init_mysql.sh
fi
}
start_mysql(){
chown -R mysql:mysql ${Data_Path}
chgrp -R mysql ${Setup_Path}/.
${init_path}/mysqld start
rm -f /init_mysql.sh
}
soft_start &amp;gt; /dev/null
is_empty_Data &amp;gt; /dev/null
if [ $? == 0 ];then
init_mysql &amp;gt; /dev/null
else
start_mysql &amp;gt; /dev/null
fi
tail -f /dev/null
&lt;/code>&lt;/pre>
&lt;h3 id="计划任务的bug">计划任务的bug
&lt;/h3>&lt;p>宿主机运行&lt;/p>
&lt;pre>&lt;code> docker exec -it 容器名称baota bash
pkill crond &amp;amp;&amp;amp; /sbin/crond
&lt;/code>&lt;/pre>
&lt;p>然后重新添加计划任务&lt;/p>
&lt;h3 id="容器内的ssh的bug">容器内的ssh的bug
&lt;/h3>&lt;p>已经默认安装了openssh，但是可能还需要处理一下才可以连接，注意 复制的时候 要看一下宿主机的情况。如果不是host模式的话不存在这个问题&lt;/p>
&lt;pre>&lt;code>#获取容器ID
docker ps|awk 'NR &amp;gt; 1{print$1}'
#复制必要密钥文件到容器内
\cp -r /etc/ssh/ssh_host_* /home/
chmod 600 /home/ssh_host_*
docker cp /home/ssh_host_rsa_key 容器ID:/etc/ssh/
docker cp /home/ssh_host_ecdsa_key 容器ID:/etc/ssh/
docker cp /home/ssh_host_ed25519_key 容器ID:/etc/ssh/
#给容器设置一个root密码，qqwwee123替换成自己想要的密码
docker exec -it 容器ID /bin/bash -c &amp;quot;echo 'qqwwee123'|passwd --stdin root&amp;quot;
#让sshd运行起来
docker exec 容器ID /usr/sbin/sshd -D &amp;amp;
rm -rf /home/ssh_host_*
&lt;/code>&lt;/pre>
&lt;h2 id="问题和其他bug">问题和其他bug
&lt;/h2>&lt;ul>
&lt;li>docker版本更新滞后，也不算大事，宝塔新版问题更多哈哈&lt;/li>
&lt;li>web控制面板卡顿，web终端卡顿 甚至打不开，不缺点是宝塔新版的问题，还是软路由器性能问题&lt;/li>
&lt;li>宝塔内置系统防火墙不可用（docker的限制。不过确实没必要）&lt;/li>
&lt;li>ssl的证书夹在某些特定情况下 无法保存的问题。这个应该是宝塔自己的bug，月经bug 宝塔反反复复，经常间隔几个版本就出现一次 .重新登录一次面板，然后续签一次证书，或者重新部署一次。运气好的话 就好了，或者整个站点都删掉重新添加，运气不好的话，。。。。删了宝塔吧。。&lt;/li>
&lt;li>innodb_log_buffer_size 的bug，这个以及是宝塔本身的月经bug 反复出现，手动设置一下就好&lt;/li>
&lt;li>web面板 配置mysql的界面 mysql状态不显示，这个应该也是宝塔自己的bug，月经bug&lt;/li>
&lt;li>web面板 终端偶尔打不开 应该是xterm和bug，宝塔本身也或许有问题，退出重新登录就好，或者清理浏览器缓存 重新登录&lt;/li>
&lt;li>通知模块偶尔显示 名称：undefined xxx，无配置。。这个也是宝塔的月经bug&lt;/li>
&lt;li>不算是问题，但一定注意第一时间修改 面板用户名密码以及ssh的root密码&lt;/li>
&lt;/ul>
&lt;h2 id="题外话">题外话
&lt;/h2>&lt;p>其实已经很久没有新装过宝塔了，然后发现 现在的宝塔 是bug成堆。。。硬硬把用户当作实验台，略有能力的情况下能不用就不用了吧&lt;br>
以前会去宝塔论坛 认真截图 说复现步骤，反馈，然后论坛客服 除了一堆毫无意义的机械回复，也没啥，有时候反馈一个bug 竟然要回帖数次。。。
基本上 修补了上一个bug 然后出现新bug&lt;/p>
&lt;p>正经的生产环境，真的不怎么建议用宝塔。。。毕竟现在docker环境可选多部署一个新环境也不难&lt;/p></description></item><item><title>docker运行nginx 并反代内网的一些服务，</title><link>https://dev.leiyanhui.com/docker/nginx-proxy-manage/</link><pubDate>Sun, 27 Nov 2022 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/nginx-proxy-manage/</guid><description>&lt;p>本文停止更新，建议使用 nginxwebui ：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl&lt;/p>
&lt;p>支持中文，也支持静态站，甚至可以转发php之类的。&lt;/p>
&lt;p>&lt;code>nginx-proxy-manage&lt;/code> 是一个有web管理解决的 纯nginx管理工具，基于node开发的。类似宝塔。。自带了ssl证书管理（基于Let’s Encrypt的）&lt;/p>
&lt;p>适合 在轻量的主机上运行，例如 软路由。。。&lt;/p>
&lt;p>比宝塔来说优势有&lt;/p>
&lt;ul>
&lt;li>支持更多dns验证api，几乎支持所有的常见国内外域名和dns商，并且支持 acmedns_api&lt;/li>
&lt;li>更加轻量简单
缺点嘛，，就是没有别的功能了。只有nginx 和 ssl 。所以很适合 路由上使用&lt;/li>
&lt;/ul>
&lt;p>要求多的话，还是建议使用宝塔，&lt;a class="link" href="https://dev.leiyanhui.com/docker/baota" target="_blank" rel="noopener"
>现在宝塔官网已经发布docker&lt;/a>&lt;/p>
&lt;h2 id="基本命令">基本命令
&lt;/h2>&lt;p>参考：https://hub.docker.com/r/jlesage/nginx-proxy-manager
改动一下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name=nginx-proxy-manager \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50181:8181 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50080:8080 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50443:4443 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jlesage/nginx-proxy-manager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>web访问端口 是 50080:8080 ssl 50443:4443 管理端口 50181:8181
默认用户名密码 &lt;code>admin@example.com&lt;/code> &lt;code>changeme&lt;/code>&lt;/p>
&lt;h3 id="后续我发现真正的官网镜像实际不是这个">后续我发现真正的官网镜像实际不是这个！
&lt;/h3>&lt;p>而是 &lt;code>jc21/nginx-proxy-manager:latest&lt;/code> 文档地址：https://nginxproxymanager.com/setup/#using-mysql-mariadb-database
并且官网文档是明确支持ipv6的 只是默认禁用&lt;/p>
&lt;h2 id="基本使用">基本使用
&lt;/h2>&lt;h3 id="修改用户密码">修改用户密码
&lt;/h3>&lt;p>登录后就会自动提示修改，按照提示修改一下&lt;/p>
&lt;h3 id="试着申请个域名ssl">试着申请个域名ssl
&lt;/h3>&lt;p>很简单 不用多说，看不懂 自己开翻译软件（吐槽：软路由圈子 英语不好 还不肯开翻译软件的人。。多好。。）&lt;/p>
&lt;h2 id="这个工具存在的问题">这个工具存在的问题
&lt;/h2>&lt;ul>
&lt;li>只支持LE的证书，我本想和acme.sh的配合 使用，发现。。。这货好像把证书放在了数据库里面，，服了。。。然后自定义证书 也只能是上传。。。
&lt;ul>
&lt;li>后续发现存放到了/etc/letsencrypt ，但是格式和acme.sh 不能完全兼容。。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>dns api的配置记录不能自动保存，添加多个证书的时候 需要每次都输入一次 api接口的key信息&lt;/li>
&lt;li>下载回来的证书，只有nginx格式&lt;/li>
&lt;li>面板本身好像不可以直接启用ssl，应该需要sh进去改配置文件，或者自己代理自己一次&lt;/li>
&lt;li>没有中文界面&lt;/li>
&lt;li>镜像体积不小， 182.90MB 左右&lt;/li>
&lt;li>在主机列表页面直接打开对应的域名，是使用默认端口打开。不会帮你跳到&lt;code>50080:8080 ssl 50443:4443&lt;/code>,我node 水平一般也没有找打 队以ing的文件&lt;/li>
&lt;li>同时 在反代 pve 或 openwrt等应用的适合，会导致 vnc或者终端控制台打不开。（这个好像是 noVNC 以及xterm.js的问题）
&lt;ul>
&lt;li>pve可以用 /etc/pve/local/qemu-server/&lt;!-- raw HTML omitted -->.conf &lt;a class="link" href="https://pve.proxmox.com/wiki/VNC_Client_Access" target="_blank" rel="noopener"
>添加vnc配置的方法用客户端链接&lt;/a>&lt;/li>
&lt;li>oc的控制docker台 可以用shell登录后 &lt;code> docker exec -it 容器名 /bin/bash&lt;/code>&lt;/li>
&lt;li>或者docker 另外跑一个浏览器 来访问内网的这个web，然后nginx-proxy-manager再套上ssl 就可以了&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>其他暂未发现&lt;/li>
&lt;/ul>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>很适合要求不高的情况下使用，也适合小白。
其实 还是建议直接docker跑一个宝塔算了，自己用debian、centos基础做也行，现在宝塔官方也支持docker了&lt;/p>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/docker/baota" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/baota&lt;/a>&lt;/p>
&lt;h2 id="另外一个替代项目">另外一个替代项目
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.nginxwebui.cn/" target="_blank" rel="noopener"
>https://www.nginxwebui.cn/&lt;/a>&lt;/p>
&lt;p>简单看了一下 国产的，支持中文，支持负载均衡，但是证书虽然是用 acme.sh ,但是同样也是 只支持 LE的自动续期和申请。。&lt;/p>
&lt;p>使用说明 ：https://dev.leiyanhui.com/openwrt/nginx-proxy-ssl&lt;/p>
&lt;p>官网：https://github.com/cym1102/nginxWebUI#docker%E5%AE%89%E8%A3%85%E8%AF%B4%E6%98%8E&lt;/p></description></item><item><title>docker 图形管理工具portainer （web管理）</title><link>https://dev.leiyanhui.com/docker/portainer/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/portainer/</guid><description>&lt;p>安装官方版本portainer&lt;/p>
&lt;h2 id="安装docker">安装docker
&lt;/h2>&lt;p>此步骤不用多说。。。&lt;/p>
&lt;h3 id="创建一个portainer容器">创建一个portainer容器
&lt;/h3>&lt;p>核心就是挂载宿主的/var/run/docker.sock 以便和宿主机通信，当然也可以管理其他主机上的docker&lt;/p>
&lt;h4 id="执行">执行
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 标准命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">8000&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8000&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">9443&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9443&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">portainer&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">always&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">opt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">portainer&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">data&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">portainer&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">portainer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">latest&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ce是社区版 ee是商业版&lt;/p>
&lt;p>精简&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 标准命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">8000&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8000&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">9443&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9443&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">portainer&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">always&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">portainer&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">portainer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">latest&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置">配置
&lt;/h4>&lt;p>打开 http://ip:8000 就好了 9443 就是 https://ip:9443&lt;/p>
&lt;p>密码。。设置 要12位。。&lt;/p>
&lt;h2 id="关于汉化">关于汉化
&lt;/h2>&lt;p>如果需要汉化的话，需要把pubic目录映射出来，不建议。。因为这个就是web的前端目录，映射出来替换掉。。那就意味着。。你无法升级，除非汉化包一起升级。。。&lt;/p>
&lt;p>实在不会 开个翻译软件 啥都解决了。&lt;/p></description></item><item><title>docker 运行证书管理工具acme.sh</title><link>https://dev.leiyanhui.com/docker/acme-sh/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/acme-sh/</guid><description>&lt;p>支持在所有运行docker的设备上 linux系统 windows macos openwrt unraid pve等 自动申请签发证书（爱快这种畸形的除外）&lt;/p>
&lt;h2 id="简单的运行">简单的运行
&lt;/h2>&lt;pre>&lt;code>docker run --rm -itd \
-v &amp;quot;$(pwd)/out&amp;quot;:/acme.sh \
--net=host \
--name=acme.sh \
neilpang/acme.sh daemon
&lt;/code>&lt;/pre>
&lt;h2 id="使用方法">使用方法
&lt;/h2>&lt;pre>&lt;code>docker exec acme.sh --help
docker exec acme.sh --issue --dns dns_cf -d *.example.com -d example.com
&lt;/code>&lt;/pre>
&lt;h2 id="指定dns的api">指定dns的api
&lt;/h2>&lt;p>走dns验证的，例如cf家的&lt;/p>
&lt;pre>&lt;code>docker run --rm -itd \
-v &amp;quot;$(pwd)/ssl_out&amp;quot;:/acme.sh \
-e CF_Email=&amp;quot;example@example.com&amp;quot; \
-e CF_Key=&amp;quot;asasasasasadasasas&amp;quot; \
--net=host \
--name=acme.sh \
neilpang/acme.sh daemon
&lt;/code>&lt;/pre>
&lt;p>如果是 dnspod&lt;/p>
&lt;pre>&lt;code>export DP_Key=&amp;quot;sADDsdasdgdsf&amp;quot;
docker run --rm -itd \
-v &amp;quot;$(pwd)/ssl_out&amp;quot;:/acme.sh \
-e DP_Id=&amp;quot;1234&amp;quot; \
-e DP_Key=&amp;quot;sADDsdasdgdsf&amp;quot; \
--net=host \
--name=acme.sh \
neilpang/acme.sh daemon
&lt;/code>&lt;/pre>
&lt;p>其他的dns 的api参考 &lt;a class="link" href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi" target="_blank" rel="noopener"
>https://github.com/acmesh-official/acme.sh/wiki/dnsapi&lt;/a>&lt;/p>
&lt;p>如果不支持自动api的话，参考他官网的别名解析验证 &lt;a class="link" href="https://github.com/acmesh-official/acme.sh/wiki/DNS-alias-mode" target="_blank" rel="noopener"
>https://github.com/acmesh-official/acme.sh/wiki/DNS-alias-mode&lt;/a>&lt;/p>
&lt;h2 id="进阶">进阶
&lt;/h2>&lt;p>可以和其他容器 包括 宝塔 或者 nginx-proxy-manager 配合使用（这两个只支持LE的免费域名，兼容性极差）&lt;/p>
&lt;h2 id="其他资源">其他资源
&lt;/h2>&lt;p>支持180天的 （半年的）泛域名 以及 ip申请 ，应该 还是不支持内网ip的&lt;/p>
&lt;p>&lt;a class="link" href="https://hostloc.com/forum.php?mod=viewthread&amp;amp;tid=1050449" target="_blank" rel="noopener"
>https://hostloc.com/forum.php?mod=viewthread&amp;tid=1050449&lt;/a>&lt;/p>
&lt;p>作者主页：https://github.com/Neilpang&lt;/p></description></item><item><title>docker5.7</title><link>https://dev.leiyanhui.com/docker/mysql5-7/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/mysql5-7/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">mysql5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">3306&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3306&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">MYSQL_ROOT_PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">123456&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker_data&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker_data&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker_data&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">logs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysql&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mysql&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">5.7&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>纯docker无盘打造个人媒体中心</title><link>https://dev.leiyanhui.com/docker/mediavodcenter/</link><pubDate>Sat, 26 Nov 2022 06:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/mediavodcenter/</guid><description>&lt;p>博主 已经全部切换到 lxc 方案。暂时抛弃Nastools
2023-02-17 后使用的方案为：全lxc 每个lxc运行1-多个服务 分开管理&lt;/p>
&lt;ul>
&lt;li>lxc 10000 alpine 运行 cloudereve + rclone（挂载cr的webdav） + smb + sftp&lt;/li>
&lt;li>lxc 10001 alpine 运行 alist 挂网盘&lt;/li>
&lt;li>lxc 10002 alpine 运行 aria2+ariaNG 和 cloudereve 直通同一个硬盘 处理离线下载&lt;/li>
&lt;li>lxc 10003 alpine 运行 rclone +crontab 和 duplicati 同步 以及 加密备份文件 到 云盘&lt;/li>
&lt;li>lxc 10010 alpine 运行 nginx + docker版onlyoffice 和cloudereve配合处理在线文档&lt;/li>
&lt;li>其他 更多 查看原文：&lt;a class="link" href="https://dev.leiyanhui.com/pve/lxc-nas/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/lxc-nas/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="目标和环境">目标和环境
&lt;/h2>&lt;h3 id="环境">环境
&lt;/h3>&lt;p>在一个弱鸡电脑上（N2600+4G+32G）用纯docker搭建个人媒体中心&lt;/p>
&lt;p>并配合 阿里云盘 或者本地硬盘 实现大容量储存，&lt;/p>
&lt;h3 id="目标">目标
&lt;/h3>&lt;p>自动搜索下载自己在豆瓣或者微信标注的影片，并存储到阿里云盘，可以用emby或者阿里云盘客户端app播放。
进阶目标：自动清理删除许久为观看的电影 节省阿里云盘空间。我只有4T啊。。&lt;/p>
&lt;h2 id="前置准备工作">前置准备工作
&lt;/h2>&lt;p>docker 环境 【&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/openwrt-plus/" target="_blank" rel="noopener"
>openwrt下docker的和其他插件的安装&lt;/a>和&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/docker-cant-network/" target="_blank" rel="noopener"
>网络异常处理&lt;/a>】&lt;br>
豆瓣账号&lt;br>
我这里docker 就是路由器系统是openwrt,其他linux 操作一样。&lt;/p>
&lt;h2 id="准备储存">准备储存
&lt;/h2>&lt;p>我这里没有额外的多余硬盘做这个工作，所以直接使用阿里云盘了。&lt;br>
先把阿里云盘挂载到本地。具体方法查看： &lt;a class="link" href="https://dev.leiyanhui.com//openwrt/rclone/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com//openwrt/rclone/&lt;/a>&lt;br>
如果你有其他硬盘 最好格式好后自行挂载到宿主机。
我这里单独挂载一个 阿里云盘的目录 空白目录MediaVodCenter 到 &lt;code>/mnt/MediaVodCenter&lt;/code> 稍后会从云盘里面 移动之前的硬盘过来，也会测试下载功能，之所以单独创建一个目录，是为了避免误操作丢失文件&lt;/p>
&lt;blockquote>
&lt;p>使用阿里云盘 就要忍受 刷新延迟带来的麻烦哈。肯定没有本地磁盘来的反应速度快，这个是无论如何也解决不聊的。只能忍受了哦&lt;/p>&lt;/blockquote>
&lt;h2 id="安装配置nastools-媒体中心">安装配置Nastools 媒体中心
&lt;/h2>&lt;h3 id="docker安装nastools">docker安装Nastools
&lt;/h3>&lt;p>我这里是openwrt 直接用root用户，如果你用其他用户管理，自行查看Nastools文档 &lt;a class="link" href="https://github.com/jxxghp/nas-tools" target="_blank" rel="noopener"
>https://github.com/jxxghp/nas-tools&lt;/a>
Nastools 的配置项众多，而且可能会出现依赖变动无法更新的情况，所以单独创建一个目录储存系统配置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir /mnt/config_MediaVodCenter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">itd&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">hostname&lt;/span> &lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">50300&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MediaVodCenter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MediaVodCenter&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config_MediaVodCenter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">config&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">PGID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">UMASK&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">000&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">REPO_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">ghproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jxxghp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">git&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">NASTOOL_AUTO_UPDATE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jxxghp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nas&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">tools&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>http://IP:50300/ 去登录，这个docker启动略微慢，稍微等待 默认用户密码：admin/password&lt;/p>
&lt;h3 id="初步配置nastools">初步配置Nastools
&lt;/h3>&lt;p>修改账户名密码，配置。系统提示还要配置&lt;code>TMDB API Key &lt;/code> 下一步去申请&lt;/p>
&lt;h4 id="注册申请tmdb">注册申请TMDB
&lt;/h4>&lt;p>网址 ： &lt;a class="link" href="https://www.themoviedb.org/signup" target="_blank" rel="noopener"
>https://www.themoviedb.org/signup&lt;/a> 网站虽然是中文的，但是在境外，可能会打不开，挂科研软件或者修改hosts&lt;br>
注册完成以后登录TMDB，点击首页右上角的头像→帐户设置。&lt;br>
点击左侧列表的API，然后点击请求API秘钥下面的 click here 再点击 开发者（developer） 同意协议后，继续填写&lt;/p>
&lt;p>简介的地方填写选择 个人 名称“家用” 地址，写一个内网地址，&lt;code>10.0.0.1&lt;/code> 简介&lt;code>Meet personalized needs, enrich website interfaces and functions&lt;/code>&lt;/p>
&lt;p>会马上生气申请成功，&lt;code>API 密钥 (v3 auth)&lt;/code> 里面的内容就是我们需要的&lt;code>TMDB API Key &lt;/code>&lt;/p>
&lt;h4 id="继续配置媒体部分设置">继续配置媒体部分设置
&lt;/h4>&lt;p>输入上面获取到&lt;code>TMDB API Key &lt;/code> TMDB域名 选择你不挂梯子能打开的 ， 默认文件转移方式 我这里是rclone挂载的阿里云盘 就选择 rclone移动，如你的是物理硬盘或者 nas 自行选择其他方法。&lt;/p>
&lt;h4 id="准备和配置豆瓣">准备和配置豆瓣
&lt;/h4>&lt;h5 id="豆瓣id">豆瓣id
&lt;/h5>&lt;p>暂时先只配置豆瓣id ，注册一个豆瓣账号，点个人中心 个人主页 地址栏地址 类似 &lt;code>https://www.douban.com/people/88888/?_i=99999 &lt;/code> 其中888 就是我们的豆瓣id&lt;/p>
&lt;h5 id="都把cookies">都把cookies
&lt;/h5>&lt;p>随便打开一个豆瓣内容页 例如&lt;code>https://movie.douban.com/subject/35197639/&lt;/code> 按F12键(chrome类浏览器)，弹出如图所示的开发页面。点击Network&lt;/p>
&lt;p>首先点击左上角一个灰色的圈圈，把下面东西的清除一下&lt;/p>
&lt;p>刷新这个页面，你可以点刷新按钮或者F5键&lt;/p>
&lt;p>Network页面开始弹出一些东西，不要怕，向上划找到 “35197639/”这一个 然后看右侧的 cookies，找到你的dbcl2，这是根据分号（;）分割的，你把dbcl2:xxx复制下来。（不要把分号复制进来）例：&lt;code>dbcl2=&amp;quot;8888888:AAAAAA&amp;quot;&lt;/code>&lt;/p>
&lt;h6 id="配置nastools中的豆瓣id和cookies">配置Nastools中的豆瓣id和cookies
&lt;/h6>&lt;p>打开nastools ，左侧 设置 豆瓣，分别输入对应的id 数字 和上面的 &lt;code>dbcl2=&amp;quot;8888888:AAAAAA&amp;quot;&lt;/code> 其他也根据需要设置一下&lt;/p>
&lt;h3 id="安装下载工具qbittorrent">安装下载工具qBittorrent
&lt;/h3>&lt;p>我这里用qBittorrent ,并省略了config目录的映射&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">bt&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">WEBUI_PORT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">50808&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">9821&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6881&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">9821&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">6881&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">50808&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">50808&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">MediaVodCenter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">downloads&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span> &lt;span class="n">unless&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stopped&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">linuxserver&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">qbittorrent&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置qbittorrent">配置qBittorrent
&lt;/h3>&lt;p>访问&lt;code>http://10.0.0.1:50808/&lt;/code> webUI 账户：admin 密码：adminadmin&lt;br>
点 Tools -&amp;gt; options 打开设置窗口 选择 webui 设置用户名 密码 还有 语言简体&lt;/p>
&lt;h3 id="配置nastools的下载工具">配置Nastools的下载工具
&lt;/h3>&lt;p>http://10.0.0.1:50300/ 设置 下载器 选择 qBittorrent 地址输入 宿主地址 10.0.0.1 端口 上面的WEBUI_PORT 50808 输入上面设置的用户密码，测试成功&lt;/p>
&lt;h3 id="安装媒体中心jellyfin">安装媒体中心jellyfin
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name=jellyfin \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 50096:8096 \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 7359:7359/udp \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -p 1900:1900/udp \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /mnt/jellyfin_config:/config \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -v /mnt/MediaVodCenter:/data \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --restart unless-stopped \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> linuxserver/jellyfin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个地方 需要注意 /config 目录会吃硬盘空间，某些情况下可能会高达几十个G 注意经常检查,这个是无法避免的&lt;/p>
&lt;blockquote>
&lt;p>硬解问题，稍后晚点配置.我的显示是N2600带的核显GMA3600，上古设备，那时候intel并未开源驱动，所以也就无法硬解。硬解问题，之后会挪到另外一台主机上进行处理。&lt;/p>&lt;/blockquote>
&lt;h3 id="配置-jellyfin">配置 jellyfin
&lt;/h3>&lt;p>打开 &lt;code>http://10.0.0.1:50096/&lt;/code> 按照提示设置，注意创建文件夹的时候 选择/data&lt;/p>
&lt;p>然后 点左侧 三个点 打开设置 控制台 高级 api 生成 记住这个 api&lt;/p>
&lt;h3 id="再nastools-配置jellyfin">再Nastools 配置jellyfin
&lt;/h3>&lt;p>http://10.0.0.1:50300/ 设置 媒体服务器 选择jellyfin 地址输入上面 &lt;code>http://10.0.0.1:50096/&lt;/code> apikey 输入刚刚的生成的&lt;/p>
&lt;h3 id="收工">收工！
&lt;/h3>&lt;h3 id="结尾的话">结尾的话
&lt;/h3>&lt;p>N2600 性能堪忧，我最终 还是切换到了 i7 8代主机上&lt;/p></description></item><item><title>docker 修改网络配置 -导入导出法</title><link>https://dev.leiyanhui.com/docker/edit-export-import/</link><pubDate>Fri, 25 Nov 2022 22:27:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/edit-export-import/</guid><description>&lt;p>因为openwrt的网络问题，创建了一个host网络的docker，而后已经解决，&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/docker-cant-network/" target="_blank" rel="noopener"
>详情查看&lt;/a>&lt;/p>
&lt;p>其中一个docker 是给朋友使用，所以需要改动一下网络，并且顺带 限制一下 cpu 内存 和 磁盘空间&lt;/p>
&lt;p>用export导出，避免体积太大&lt;/p>
&lt;pre>&lt;code>docker stop alpine-mengzhong
docker export -o alpine-mengzhong.tar alpine-mengzhong
cat alpine-mengzhong.tar | docker import - my/alpine-mengzhong:v1
&lt;/code>&lt;/pre>
&lt;p>创建一个虚拟网络单独给朋友使用&lt;/p>
&lt;pre>&lt;code>docker network create --subnet=10.0.7.1/24 myfriend # 删除命令 docker network rm friend
&lt;/code>&lt;/pre>
&lt;p>启动容器，入口 依旧是 &lt;code>sh /autoboot.sh&lt;/code>&lt;/p>
&lt;pre>&lt;code>docker run -itd --name alpine-mengzhong2 --network=myfriend --ip 10.0.7.2 --privileged=true --restart=always my/alpine-mengzhong:v1 sh /autoboot.sh
&lt;/code>&lt;/pre>
&lt;p>修改防火墙规则&lt;/p>
&lt;pre>&lt;code>nano /etc/config/firewall
&lt;/code>&lt;/pre>
&lt;p>重启防火墙&lt;/p>
&lt;pre>&lt;code>/etc/init.d/firewall restart
&lt;/code>&lt;/pre>
&lt;p>手机4G 链接测试，没问题&lt;/p>
&lt;p>控制台 进去看一下网卡 也没问题&lt;/p>
&lt;p>忘记限制cpu和内存还有硬盘&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker stop alpine-mengzhong2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker rm alpine-mengzhong2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>因为分区是ext4 无法限制磁盘容量 只有xfs才可以哈，只能给他限制一下内存和cpu&lt;/p>
&lt;pre>&lt;code>docker run -itd --name alpine-mengzhong2 -m 256m --cpus=1 --cpu-shares=500 --network=myfriend --ip 10.0.7.2 --privileged=true --restart=always my/alpine-mengzhong:v1 sh /autoboot.sh
&lt;/code>&lt;/pre></description></item><item><title>docker的alpine中使用ssh的docker</title><link>https://dev.leiyanhui.com/docker/alpine-sshd/</link><pubDate>Tue, 22 Nov 2022 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/alpine-sshd/</guid><description>&lt;h2 id="创建一个容器">创建一个容器
&lt;/h2>&lt;p>在爱快中添加一个 容器 &amp;lsquo;alpine-docker-cli-1&amp;rsquo; 使用镜像 alpine:latest
高级设置挂载目录 &lt;code>/var/run/docker.sock&lt;/code> 到容器的&lt;code>/var/run/docker.sock&lt;/code>&lt;/p>
&lt;h2 id="配置容器">配置容器
&lt;/h2>&lt;p>打开容器控制台&lt;/p>
&lt;h3 id="修改源更新安装ssh-密钥-启动文件等">修改源更新安装ssh 密钥 启动文件等
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/main&amp;#34; &amp;gt; /etc/apk/repositories &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/community&amp;#34; &amp;gt;&amp;gt; /etc/apk/repositories &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk update &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add --no-cache openssh tzdata &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#34;s/#PermitRootLogin.*/PermitRootLogin yes/g&amp;#34; /etc/ssh/sshd_config &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t dsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_dsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t rsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_rsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ecdsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ecdsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ed25519 -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ed25519_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;root:admin&amp;#34; | chpasswd &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;/usr/sbin/sshd -D&amp;#34; &amp;gt; /autoboot.sh &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;tail -f /dev/null&amp;#34; &amp;gt; /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面的命令 是让我们能创建一个支持ssh的docker，但是还不是我们想要的&lt;/p>
&lt;h2 id="进阶用docker里面的cli-操作宿主的docker">进阶，用docker里面的cli 操作宿主的docker
&lt;/h2>&lt;p>也就是 添加一行apk add &amp;ndash;no-cache docker-cli&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/main&amp;#34; &amp;gt; /etc/apk/repositories &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;https://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/community&amp;#34; &amp;gt;&amp;gt; /etc/apk/repositories &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk update &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add --no-cache docker-cli &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apk add --no-cache openssh tzdata &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#34;s/#PermitRootLogin.*/PermitRootLogin yes/g&amp;#34; /etc/ssh/sshd_config &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t dsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_dsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t rsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_rsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ecdsa -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ecdsa_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t ed25519 -P &amp;#34;&amp;#34; -f /etc/ssh/ssh_host_ed25519_key &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;root:admin&amp;#34; | chpasswd &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;/usr/sbin/sshd -D&amp;#34; &amp;gt; /autoboot.sh &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;tail -f /dev/null&amp;#34; &amp;gt;&amp;gt; /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="我打包了一个基础的docker镜像">我打包了一个基础的docker镜像
&lt;/h2>&lt;p>只安装了 openssh tzdata 时区 nano
默认用户名 root 密码 root ssh端口2222
tar.gz格式的，你可以自己导入到镜像
使用命令参考&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat alpine-sshd2222.tar.gz | docker import - alpine:sshd-autoboot.sh2222
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -i -t -d --name alpine-mengzhong --network host --privileged=true --restart=always alpine:sshd-autoboot.sh2222 sh /autoboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下载地址： &lt;a class="link" href="https://github.com/joyanhui/file.leiyanhui.com/raw/main/pve-unraid-kvm/alpine-sshd2222.tar.gz" target="_blank" rel="noopener"
>https://github.com/joyanhui/file.leiyanhui.com/raw/main/pve-unraid-kvm/alpine-sshd2222.tar.gz&lt;/a>&lt;/p>
&lt;p>以后可能也会打包一个debian的镜像，不过体积就比较大，可能会放到云盘&lt;/p>
&lt;p>本文参考 &lt;a class="link" href="https://cloud.tencent.com/developer/article/1683604" target="_blank" rel="noopener"
>https://cloud.tencent.com/developer/article/1683604&lt;/a>&lt;/p></description></item><item><title>爱快没有完整的shell无法正常使用docker的解决方法 docker嵌套</title><link>https://dev.leiyanhui.com/docker/ikuai-docker-shell/</link><pubDate>Tue, 22 Nov 2022 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/ikuai-docker-shell/</guid><description>&lt;p>爱快比较稳定，分流功能方便一些，安装也解决，所以我主路由n2600是用的爱快。&lt;/p>
&lt;p>但是爱快的扩展性 相对比较差，最新版虽然支持docker了，但是因为没有shell，只能从网页简单配置，很多参数加不上，还是比较麻烦。
我先是尝试&lt;a class="link" href="https://dev.leiyanhui.com/docker/alpine-sshd/" target="_blank" rel="noopener"
>使用 /var/run/docker.sock 的方法操作爱快的docker&lt;/a> 发现找不到这个文件，而现在路由在使用中，不知道具体路径是哪里&lt;/p>
&lt;p>实在是懒得继续折腾，找到一个就路由器，配置好以后，先临时上网&lt;/p>
&lt;p>还是刷 openwrt&lt;/p></description></item><item><title>在docker中运行一个完整的docker并再套娃docker</title><link>https://dev.leiyanhui.com/docker/docker-run-on-docker/</link><pubDate>Tue, 22 Nov 2022 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/docker-run-on-docker/</guid><description>&lt;blockquote>
&lt;p>之所以有这个奇葩的需求 是因为一个软路由 安装的是爱快系统，而考虑到不折腾的原则，没有去更换系统。
但是爱快的docker 因为没有完整的shell权限使用起来很奇葩.&lt;/p>&lt;/blockquote>
&lt;h2 id="先在爱快docker运行一个alpine">先在爱快docker运行一个alpine
&lt;/h2>&lt;p>修改密码 passwd 然后 修改源&lt;/p>
&lt;pre>&lt;code>etc/apk/repositorie
----
https://mirrors.ustc.edu.cn/alpine/latest-stable/main
https://mirrors.ustc.edu.cn/alpine/latest-stable/community
apk update
&lt;/code>&lt;/pre>
&lt;h2 id="安装配置sshd">安装配置sshd
&lt;/h2>&lt;pre>&lt;code>apk add --no-cache openssh tzdata
cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
sed -i &amp;quot;s/#PermitRootLogin.*/PermitRootLogin yes/g&amp;quot; /etc/ssh/sshd_config
ssh-keygen -t dsa -P &amp;quot;&amp;quot; -f /etc/ssh/ssh_host_dsa_key
ssh-keygen -t rsa -P &amp;quot;&amp;quot; -f /etc/ssh/ssh_host_rsa_key
ssh-keygen -t ecdsa -P &amp;quot;&amp;quot; -f /etc/ssh/ssh_host_ecdsa_key
ssh-keygen -t ed25519 -P &amp;quot;&amp;quot; -f /etc/ssh/ssh_host_ed25519_key
&lt;/code>&lt;/pre>
&lt;h2 id="手动启动sshd">手动启动sshd
&lt;/h2>&lt;pre>&lt;code>/usr/sbin/sshd -D
&lt;/code>&lt;/pre>
&lt;h3 id="安装docker">安装docker
&lt;/h3>&lt;pre>&lt;code>apk add docker
&lt;/code>&lt;/pre>
&lt;h2 id="配置自动启动">配置自动启动
&lt;/h2>&lt;p>试了 openrc 和 busybox 都没弄好。。。。。。因为爱快 没有安装的shell 也就无法自己定义sh 。。。所以。。。直接换一个docker吧&lt;/p>
&lt;p>然后测试了一圈。。直接用openwrt的docker算了。。。 &lt;code>openwrtorg/rootfs:x86_64-openwrt-22.03&lt;/code>&lt;/p>
&lt;h2 id="docker版本openwrt简单使用">docker版本openwrt简单使用
&lt;/h2>&lt;p>我主要是套docker用，ssh登录到docker opwnwrt&lt;/p>
&lt;h3 id="国内源">国内源
&lt;/h3>&lt;p>cp /etc/opkg/distfeeds.conf /etc/opkg/distfeeds.conf-bak
vi /etc/opkg/distfeeds.conf #把里面的&lt;code>/etc/opkg/distfeeds.conf-bak&lt;/code>替换为&lt;code>mirrors.aliyun.com/openwrt&lt;/code>
opkg update&lt;/p>
&lt;h3 id="安装docker-1">安装docker
&lt;/h3>&lt;pre>&lt;code>opkg install docker
opkg install dockerd
/etc/init.d/dockerd start
ln -s /etc/init.d/dockerd /etc/rc.d/S100docker
&lt;/code>&lt;/pre>
&lt;h3 id="测试一个docker">测试一个docker
&lt;/h3>&lt;p>docker run -d &amp;ndash;restart=always &amp;ndash;privileged &lt;br>
-p 2017:2017 -p 20170-20173:20170-20173 &lt;br>
&amp;ndash;name v2raya &lt;br>
mzz2017/v2raya&lt;/p></description></item><item><title>docker 运行 一个 rustdesk中转服务器</title><link>https://dev.leiyanhui.com/docker/rustdesk-server/</link><pubDate>Sun, 20 Nov 2022 19:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/rustdesk-server/</guid><description>&lt;p>rustdesk 有几个坑，主要是文档敷衍。。。&lt;/p>
&lt;p>本文停止更新，迁移到：https://dev.leiyanhui.com/openwrt/rustdesk&lt;/p>
&lt;p>官网实例：&lt;/p>
&lt;pre>&lt;code>sudo docker image pull rustdesk/rustdesk-server
sudo docker run --name hbbs -p 21115:21115 -p 21116:21116 -p 21116:21116/udp -p 21118:21118 -v `pwd`:/root -td --net=host rustdesk/rustdesk-server hbbs -r &amp;lt;relay-server-ip[:port]&amp;gt;
sudo docker run --name hbbr -p 21117:21117 -p 21119:21119 -v `pwd`:/root -td --net=host rustdesk/rustdesk-server hbbr
&lt;/code>&lt;/pre>
&lt;p>我这里是linux系统直接用hots模式稍微改动一下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir -p /root/docker/rustdesk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd /root/docker/rustdesk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano docker-compose.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">version: &amp;#39;3&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">networks:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rustdesk-net:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> external: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">services:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hbbs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> container_name: hbbs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 21115:21115
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 21116:21116
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 21116:21116/udp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 21118:21118
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: rustdesk/rustdesk-server:latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: hbbs -r localhost:21117 -k _ # localhost改成 公网地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ./hbbs:/root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networks:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - rustdesk-net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> depends_on:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - hbbr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> restart: unless-stopped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hbbr:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> container_name: hbbr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 21117:21117
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 21119:21119
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: rustdesk/rustdesk-server:latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: hbbr -k _
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ./hbbr:/root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> networks:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - rustdesk-net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> restart: unless-stopped
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>大概说一下
&lt;code>localhost:21117&lt;/code> 可以用ip 或者域名 ，或者直接局域网的地址 都是可以的
&lt;code>-k _ &lt;/code> 这个参数是禁止没有key的用户链接，也就是可以作为私有的中转服务器用。 但我测试发现，这个参数没啥乱用，不加key也可以连接上
&lt;code>volumes&lt;/code> 这段也不是必须的&lt;/p>
&lt;h3 id="启动更新">启动/更新
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker-compose up -d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>key 文件在 /root/data/docker_data/rustdesk/hbbs/id_ed25519 这个里面&lt;/p>
&lt;h3 id="更新key-或docker">更新key 或docker
&lt;/h3>&lt;h4 id="更新key">更新key：
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rm -rf /root/data/docker_data/rustdesk/hbbs/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker restart hbbs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker restart hbbr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker stop hbbs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker stop hbbr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker rm hbbs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker rm hbbr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;a class="link" href="https://rustdesk.com/docs/zh-cn/self-host/install/#key" target="_blank" rel="noopener"
>https://rustdesk.com/docs/zh-cn/self-host/install/#key&lt;/a>&lt;/p>
&lt;h3 id="客户端设置">客户端设置
&lt;/h3>&lt;p>id中级服务器，只输入id服务器就好了剩下的客户端会自动适配&lt;/p>
&lt;h4 id="openwrt-docker运行-rustdesk">openwrt docker运行 rustdesk
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hbbs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21115&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21115&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21116&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21116&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21116&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21116&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">udp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21118&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21118&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rustdesk&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">td&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rustdesk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rustdesk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hbbs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">yanhuijia&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">3322&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21117&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hbbr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21117&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21117&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21119&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21119&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">pwd&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">td&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rustdesk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rustdesk&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hbbr&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看key">查看key
&lt;/h4>&lt;p>cat /root/rustdesk/id_ed25519.pub&lt;/p></description></item><item><title>openwrt上搭建私有网盘 和 私有网盘的备份</title><link>https://dev.leiyanhui.com/docker/my-net-disk/</link><pubDate>Thu, 27 Jan 2022 23:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/docker/my-net-disk/</guid><description>&lt;h2 id="需求">需求
&lt;/h2>&lt;p>备份 书签 密码，一些脚本 配置文件等。支持webdav sftp smb 等，支持手机照片视频备份。还有在线编辑md文件 sh文件等。&lt;/p>
&lt;h2 id="为什么要搭建私有网盘">为什么要搭建私有网盘
&lt;/h2>&lt;ul>
&lt;li>穷，但是有公网宽带，以及本身就有一个24小时的开机的pc server&lt;/li>
&lt;li>国内网盘审查太严，lsp都懂&lt;/li>
&lt;li>国内网盘功能阉割太离谱，比如 webdav sftp等协议都不要想了。&lt;/li>
&lt;li>唯一一个支持webdav的网盘 很坑&lt;/li>
&lt;li>自主可控，部分文件可以推送到github备份一次&lt;/li>
&lt;/ul>
&lt;h2 id="私有网盘适合储存什么东西">私有网盘适合储存什么东西
&lt;/h2>&lt;p>私密文件（不是说的自拍视频），还有一些 一些脚本，代码 等。&lt;/p>
&lt;h2 id="lsp应该选什么网盘">lsp应该选什么网盘
&lt;/h2>&lt;p>自建nas可能是最适合的，没条件的可以选择 115 pikpak，而不是我这个方案&lt;/p>
&lt;h2 id="私有网盘的选择">私有网盘的选择
&lt;/h2>&lt;p>选择用户群相对较多的 nextcloud&lt;/p>
&lt;h2 id="照片和视频的处理">照片和视频的处理
&lt;/h2>&lt;p>因为openwrt上没有那么多磁盘工具，所有照片和视频 用Nextcloud 加密后，储存到本地挂载的其他网盘（阿里云盘 123pan）&lt;/p>
&lt;h2 id="代码和脚本的备份">代码和脚本的备份
&lt;/h2>&lt;p>集成到docker内部&lt;/p>
&lt;h2 id="为什么要docker弄">为什么要docker弄
&lt;/h2>&lt;p>为了方便备份 ，op折腾挂了，不会有问题。可以从别的机器上秒启动。&lt;/p>
&lt;h2 id="最后说-all-in-one-和群晖">最后说 All in one 和群晖
&lt;/h2>&lt;p>我之前 一直是k2p 刷的op 用了好像10多年，但是随着宽带的升级，越来越力不从心。
后来尝试更换到 以N2600 做主路由，k2p 做AP 使用，再加上一个 i7 8代 的all in one。。而后发现一个问题。。&lt;/p>
&lt;h2 id="最后说某果云">最后说某果云
&lt;/h2>&lt;p>之前一直用 某果云 用 作为floccus的同步空间。
先不说价格，问题是他付费后速度也很拉跨，而且不可以退款！！！
免费版说是有1G流量，帐号一直显示只用30M的时候，客户端停止工作。。。&lt;/p></description></item></channel></rss>