<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>All-in-Ones on 小类随手记</title><link>https://dev.leiyanhui.com/all-in-one/</link><description>Recent content in All-in-Ones on 小类随手记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 10 Apr 2023 08:14:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/all-in-one/index.xml" rel="self" type="application/rss+xml"/><item><title>aio主机上的http统一管理</title><link>https://dev.leiyanhui.com/all-in-one/lxc-nginx-proxy-mananger/</link><pubDate>Mon, 10 Apr 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/lxc-nginx-proxy-mananger/</guid><description>&lt;h2 id="前言">前言
&lt;/h2>&lt;p>之前一直用 nginxWebUI 来管理，甚至在给作者反馈一些问题后，作者置之不理后，自己二开了一个版本。&lt;br>
但是nginxWebUI 因为不能手动编辑配置文件，使用起来还是略微麻烦。鼠标点来点去 很烦的哈。&lt;/p>
&lt;p>于是又拿起来Nginx-Proxy-Manager&lt;/p>
&lt;h2 id="环境">环境
&lt;/h2>&lt;p>pve lxc alpine 硬盘1G 内存 512M swap关闭 ip 10.1.1.51&lt;/p>
&lt;h2 id="准备">准备
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sed&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="s1">&amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">repositories&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">tzdata&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">zoneinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">localtime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;Asia/Shanghai&amp;#34;&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">timezone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">del&lt;/span> &lt;span class="n">tzdata&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apk&lt;/span>&lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装">安装
&lt;/h2>&lt;h3 id="docker安装">docker安装
&lt;/h3>&lt;p>一般情况推荐docker安装，但是我可能需要修改一些地方，所以手动装，官网有推荐一个第三方安装脚本。直接开开始&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget --no-cache -qO - https://raw.githubusercontent.com/ej52/proxmox/main/lxc/nginx-proxy-manager/setup.sh | sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>结果在安装到python的地方出错，算了 还是docker 套娃吧。（关于特权容器 安装docker的问题请群内搜索，如果没啥必要就用非特权容器） 顺带装上sshd&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apk add docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc-update add docker boot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service docker start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># cat /etc/docker/daemon.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/docker/daemon.json &amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;registry-mirrors&amp;#34;: [
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;http://hub-mirror.c.163.com&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;https://docker.mirrors.ustc.edu.cn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service docker restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apk add openssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc-update add sshd boot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&amp;#39; /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service sshd restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="创建">创建
&lt;/h3>&lt;p>因为这个lxc就运行这一个，所以host模式&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -itd \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name=nginx --hostname nginx \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --net=host \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> jc21/nginx-proxy-manager:2.10.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>因为要修改&lt;/p>
&lt;h3 id="基本配置">基本配置
&lt;/h3>&lt;p>http://10.1.1.51:81&lt;br>
Email: &lt;a class="link" href="mailto:admin@example.com" >admin@example.com&lt;/a>&lt;br>
Password: changeme&lt;/p>
&lt;h3 id="申请ssl证书的时候--zope-错误">申请ssl证书的时候 zope 错误
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker exec -it nginx /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip install zope
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参考：https://github.com/NginxProxyManager/nginx-proxy-manager/issues/2440&lt;/p>
&lt;h3 id="手动配置nginx配置文件">手动配置nginx配置文件
&lt;/h3>&lt;h4 id="证书目录">证书目录
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">certificate /etc/letsencrypt/live/npm-5/fullchain.pem;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssl_certificate_key /etc/letsencrypt/live/npm-5/privkey.pem;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果要定制一些特殊的 npm-X 这个需要自己记住&lt;/p>
&lt;h4 id="配置文件目录">配置文件目录
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/etc/nginx/conf.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/data/nginx/proxy_host/1.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="怎么用">怎么用
&lt;/h4>&lt;p>简单的代理 直接在web界面处理就行
需要定制的情况可以直接手写conf&lt;/p>
&lt;h3 id="最周">最周
&lt;/h3>&lt;p>其实 更加灵活的情况 还是 自己手写
后期如果有时间 打算自己做一个 类似功能。&lt;/p></description></item><item><title>nas的自动备份工具的选择 Restic rclone duplicati等</title><link>https://dev.leiyanhui.com/all-in-one/auto-back/</link><pubDate>Mon, 03 Apr 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/auto-back/</guid><description>&lt;h3 id="场景">场景
&lt;/h3>&lt;p>既然是nas 就需要做异地备份。&lt;/p>
&lt;h3 id="备份目的地">备份目的地
&lt;/h3>&lt;p>一般备份到网盘或对象储存比较划算。
如果数据量比较大，还是要备份到免费的网盘，比如阿里云盘 1-2T 123pan 2T，还有od gd等容量更大的选择。
用alist挂载后，只要不滥用，账号不会被封。&lt;br>
数据量不大话，尤其核心数据，可以备份到对象储存，比如 alioss也不贵 七牛还有免费的10G kodo&lt;br>
部分敏感数据需要加密储存。为了防止网盘删文件，尤其是小姐姐们，也需要加密储存。&lt;br>
部分数据 需要按照版本储存。&lt;br>
部分数据 需要按照原目录储存，方便在网盘可以直接访问。比如小姐姐们 可以直接存到pikpak&lt;/p>
&lt;h3 id="关于duplicati">关于duplicati
&lt;/h3>&lt;p>也是我第一个使用的备份程序&lt;br>
duplicati 是.net写的，可以装到pc 也可以装到服务器，支持linux(mono) ，也有docker版本&lt;br>
支持加密储存，支持增量，支持版本储存。&lt;br>
使用中发现的问题：&lt;/p>
&lt;ul>
&lt;li>不支持按照原始目录储存方式&lt;/li>
&lt;li>备份过程中会占用很大的本地硬盘空间&lt;/li>
&lt;li>虽然他是基于rclone的，但不算是一个轻量化工具&lt;/li>
&lt;/ul>
&lt;h3 id="关于rclone">关于rclone
&lt;/h3>&lt;p>可以用sysnc方式实现同步，可以不占用本地磁盘，但不支持的&lt;/p>
&lt;ul>
&lt;li>没有图形界面&lt;/li>
&lt;li>不支持按照版本保存&lt;/li>
&lt;/ul>
&lt;h3 id="restic">restic
&lt;/h3>&lt;p>支持常见的储存模式，也支持rclone挂载的储存。也就是alist挂载的网盘也没问题。
rclone是文件同步，也就是和大部分网盘软件一样，来源文件是什么样的，目的文件就是什么样的。restic是面向文件的专业备份工具，其在备份文件前将会先进行加密再传输，而且是增量备份，只备份变化的部分。&lt;br>
rclone并不记录文件版本，无法回溯特定时间点上的文件。restic会对每次备份生成一个快照，记录该时间点文件变化和存储结构，可以随时回溯到特定时间点的文件。&lt;/p>
&lt;h3 id="最终的考量">最终的考量
&lt;/h3>&lt;p>考虑到 我要备份的文件主要有以下几种&lt;/p>
&lt;ul>
&lt;li>文档类 修改频繁&lt;/li>
&lt;li>代码类 gitea+github处理，不需要nas备份&lt;/li>
&lt;li>minio 思源笔记 修改频繁&lt;/li>
&lt;li>影音视频 只需要同步&lt;/li>
&lt;li>不合规的影音视频 需要单独同步备份到 境外网盘 或者加密同步到境内网盘&lt;/li>
&lt;li>私人相册视频 加密同步到境内网盘
restic 不太熟悉需要时间看文档踩坑，最终决定 使用rclone+压缩包增量的方式，更底层 更轻量！&lt;/li>
&lt;/ul>
&lt;h3 id="最终">最终
&lt;/h3>&lt;p>单独一个lxc（pve）平台运行rclone，配置文件中挂载了包括alist 私有minio 阿里云对象储存 在内的我常用的储存&lt;br>
并把部分储存挂载到本地，
然后用crontab 定时处理 ，全手动管理&lt;/p>
&lt;h3 id="关于网盘的选择">关于网盘的选择
&lt;/h3>&lt;p>简单的说，核心文件 还是加密放到 收费的对象储存 。&lt;br>
无关紧要的文件 ，放到哪家网盘都一样。&lt;br>
免费的网盘的话，依旧是阿里云盘比较良心，而且官方已提供api不滥用的话是完全合规的。&lt;/p>
&lt;p>我这里也只有一个 904G 的账号，不存太多电影视频的话 足够用了。&lt;br>
百度网盘上传速度其实也还好，下载速度嘛没办法，如果需要取回的时候，开个会员就好。&lt;br>
123pan虽然有2T容量，但是实际测试 限制还是有一些。单个目录下文件数量不可以超过99个。&lt;/p>
&lt;h3 id="准备工作">准备工作
&lt;/h3>&lt;h4 id="宿主系统选择">宿主系统选择
&lt;/h4>&lt;p>alpine 够轻量，创建一个lxc 10009，去掉 非特权容器的勾号，选择 alpine镜像，磁盘空间，选择 默认 8G 。因为部分tar需要临时缓存&lt;br>
创建完成后 在选项 功能里面 勾选上 嵌套 NFS SMB fuse&lt;/p>
&lt;h5 id="修改源和时区">修改源和时区
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sed&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="s1">&amp;#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">repositories&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">tzdata&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">zoneinfo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Asia&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Shanghai&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">localtime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="s2">&amp;#34;Asia/Shanghai&amp;#34;&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">timezone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">del&lt;/span> &lt;span class="n">tzdata&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apk&lt;/span>&lt;span class="o">/*&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="安装ssh">安装ssh
&lt;/h4>&lt;p>这个不是必须的 不装了，要装的话&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apk add openssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rc-update add sshd boot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/g&amp;#39; /etc/ssh/sshd_config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service sshd restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="准备所需软件">准备所需软件
&lt;/h4>&lt;p>我考虑了一下，还是选择用 7zip作为增量备份工具，而不是xz ，因为不想学。。。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">p7zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">apk&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">wget&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">downloads&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rclone&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">62.2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">62.2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">7&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">*.&lt;/span>&lt;span class="n">zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">-*/&lt;/span>&lt;span class="n">rclone&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="c1">#复制到bin目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="准备rclone配置文件">准备rclone配置文件
&lt;/h3>&lt;p>可以直接用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone config --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置，也可以手写，配置文件可以存到自己的笔记里面。不再多说&lt;br>
这里要 rclone 挂载了 自己的nas，我这里用webdav挂载的 cloudreve
然后挂载 alist 阿里云 对象储存等&lt;/p>
&lt;h3 id="最终rclone内的节点如下">最终rclone内的节点如下
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Name Type
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">==== ====
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alist webdav #公网
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alist-local webdav #内网
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cloudreve webdav #公网
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cloudreve-local webdav #内网
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oss-qd s3 #公网
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oss-sh s3 #公网
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>*-local的是用内网链接的&lt;/p>
&lt;h4 id="测试">测试
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone lsd alist:/ --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd alist-local:/ --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd cloudreve:/ --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd cloudreve-local:/ --config /root/rclone.conf --no-check-certificate #忽略证书检查
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd minio:/note --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd minio-local:/note --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="关于minio的一点补充">关于minio的一点补充
&lt;/h3>&lt;p>Minio目前并不支持所有的S3特性。特别是它不支持MD5校验（ETag）或者是元数据。这就表示Rclone不能通过MD5SUMs进行校验或者保存最后修改时间。不过你可以用Rclone的—size-only flag。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone lsd minio: #查看储存桶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone mkdir minio:bucket #创建一个储存桶
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone --size-only copy /path/to/files minio:bucket #复制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone --size-only --dry-run sync /path/to/files minio:bucket #测试同步
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone --size-only sync /path/to/files minio:bucket #标准同步
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>rclone跳过证书检查</title><link>https://dev.leiyanhui.com/all-in-one/rclone-skip-ssl/</link><pubDate>Mon, 03 Apr 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/rclone-skip-ssl/</guid><description>&lt;h3 id="场景">场景
&lt;/h3>&lt;p>在内网挂载webdav的时候，直接用内网ip+端口挂载。但是对应端口上只提供了公网的ssl&lt;/p>
&lt;h3 id="解决方法">解决方法
&lt;/h3>&lt;p>通过chatgpt搜索的
修改rclone.conf文件 在对应节点上添加一行 insecure_skip_verify = true 实际测试没效果
最终解决方案 在命令后面 添加 &amp;ndash;no-check-certificate&lt;/p>
&lt;h3 id="测试">测试
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone lsd cloudreve-local:/ --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd cloudreve-local:/ --config /root/rclone.conf --no-check-certificate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="补充">补充
&lt;/h2>&lt;p>其实这个使用场景下，可以通过修改hosts文件来避免证书错误的问题，又可以绕过外网。&lt;/p>
&lt;p>参考：https://github.com/rclone/rclone/issues/168&lt;/p></description></item><item><title>rclone 常用命令 挂载 ls 临时url等</title><link>https://dev.leiyanhui.com/all-in-one/rclone-all/</link><pubDate>Sun, 02 Apr 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/rclone-all/</guid><description>&lt;p>rclone 是一个非常强大的 网络文件系统辅助工具！
支持并不限与以下功能&lt;/p>
&lt;ul>
&lt;li>挂载 对象储存&lt;/li>
&lt;li>挂载 多数正常的网盘（非国内阉割盘）&lt;/li>
&lt;li>sync同步&lt;/li>
&lt;li>文件复制 删除 ls&lt;/li>
&lt;li>临时获取url link等&lt;/li>
&lt;li>加密同步&lt;/li>
&lt;/ul>
&lt;p>下面整理记录常用命令&lt;/p>
&lt;h3 id="安装">安装
&lt;/h3>&lt;p>golang写的 直接解压即可 ，或者用linux自带的包管理器&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">downloads&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rclone&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">current&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">unzip&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">current&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">-*-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sda1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rf&lt;/span> &lt;span class="n">rclone&lt;/span>&lt;span class="o">-*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">chown&lt;/span> &lt;span class="n">root&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">root&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sda1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">chmod&lt;/span> &lt;span class="mi">755&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sda1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rclone&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置文件">配置文件
&lt;/h3>&lt;h4 id="向导模式">向导模式
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/mnt/sda1/rclone config # 默认路径在 ~/.config/rclone/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/mnt/sda1/rclone config --config /mnt/sda1/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="手动编辑">手动编辑
&lt;/h4>&lt;p>例子&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat &amp;gt;/mnt/sda1/rclone.conf &amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[cloudreve]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">type = webdav
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">url = https://cloudreve地址:5213/dav
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vendor = nextcloud
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user = 密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pass = 加密后的密码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[oss-sh]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">type = s3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">provider = Alibaba
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access_key_id = XXXXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret_access_key = XXXXXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">endpoint = oss-cn-shanghai.aliyuncs.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl = private
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">storage_class = STANDARD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bucket_acl = private
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="备份和恢复">备份和恢复
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone copy oss-qd:demo-docker-img-bak/emqx.5.0.17.tar.gz /demo/docker-img-bak/emqx.5.0.17.tar.gz --config /demo/etc/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone sync oss-qd:demo-serv-emqx-bak/ /demo/emqx --config /demo/etc/rclone.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone sync /demo/emqx oss-qd:demo-serv-emqx-bak/ --config /demo/etc/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>sysnc 和 copy 区别 等于 系统 sysnc 和 cp的区别&lt;/p>
&lt;h3 id="获取临时链接">获取临时链接
&lt;/h3>&lt;p>仅限部分储存可以用。有一些储存肯定是不可以的用的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/root/opt/rclone link --expire 1m oss-qd:demo-serv-bak/opt_serv1/main.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="检查-查询">检查 查询
&lt;/h3>&lt;p>ls 列出文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone ls 列出路径中的对象及其大小和路径。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd 列出路径中的所有目录/容器/桶。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsf 列出 remote:path 格式的目录和对象以供解析。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsjson 以 JSON 格式列出路径中的目录和对象。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsl 列出路径中的对象及其修改时间、大小和路径。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>例如&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone lsd cloudreve:/ --config /demo/etc/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="挂载命令">挂载命令
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">/mnt/sda1/rclone mount cloudreve:/ /mnt/dav --config /mnt/sda1/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果提示 &lt;code>fusermount3&lt;/code> 找不到，应该是缺少 fuse3 这个包 &lt;code>apk add fuse3&lt;/code>&lt;/p>
&lt;h3 id="其他常用">其他常用
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone copy - 复制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone move - 移动，如果要在移动后删除空源目录，请加上 --delete-empty-src-dirs 参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone sync - 同步：将源目录同步到目标目录，只更改目标目录。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone size - 查看网盘文件占用大小。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone delete - 删除路径下的文件内容。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone purge - 删除路径及其所有文件内容。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone mkdir - 创建目录。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone rmdir - 删除目录。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone rmdirs - 删除指定灵境下的空目录。如果加上 --leave-root 参数，则不会删除根目录。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone check - 检查源和目的地址数据是否匹配。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone ls - 列出指定路径下的所有的文件以及文件大小和路径。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsl - 比上面多一个显示上传时间。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsd 列出指定路径下的目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rclone lsf - 列出指定路径下的目录和文
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="常用参数">常用参数
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">-n = --dry-run - 测试运行，用来查看 rclone 在实际运行中会进行哪些操作。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-P = --progress - 显示实时传输进度，500mS 刷新一次，否则默认 1 分钟刷新一次。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--cache-chunk-size SizeSuffi - 块的大小，默认5M，理论上是越大上传速度越快，同时占用内存也越多。如果设置得太大，可能会导致进程中断。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--cache-chunk-total-size SizeSuffix - 块可以在本地磁盘上占用的总大小，默认10G。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--transfers=N - 并行文件数，默认为4。如果你cpu性能差，建议调低，但太低可能会影响多个文档同时传输的速度。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--config string - 指定配置文件路径，string为配置文件路径。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--ignore-errors - 跳过错误。比如 OneDrive 在传了某些特殊文件后会提示Failed to copy: failed to open source object: malwareDetected: Malware detected，这会导致后续的传输任务被终止掉，此时就可以加上这个参数跳过错误。但需要注意 RCLONE 的退出状态码不会为0。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--no-check-certificate 忽略证书检查
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--allow-other：允许非当前 rclone 用户外其它用户进行访问
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--attr-timeout 5m：文件属性缓存，（大小，修改时间等）的时间。如果 VPS 配置比较低，建议适当提高这个值，避免过多内核交互，降低资源占用。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-vfs-cache-mode full：开启 VFS 文件缓存，可减少 rclone 与 API 交互，同时可提高文件读写效率
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--vfs-cache-max-age 24h：VFS 文件缓存时间，这里设置 24 小时，如果文件很少更改，建议设置更长时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--vfs-cache-max-size 10G：VFS文件缓存上限大小，建议不超过当前空余磁盘的50%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vfs-read-chunk-size-limit 100M：分块读取大小，这里设置的是100M，可提高文件读的效率，比如1G的文件，大致分为10个块进行读取，但与此同时API请求次数也会增多
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--buffer-size 100M：内存缓存，如果您内存比较小，可降低此值，如果内存比较大，可适当提高
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--daemon：指后台方式运行
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--low-level-retries：该参数为传输文档没速度的时候重试次数，没速度的时候，单个会自动睡眠10ms起，然后再重试，不行，再睡眠更长一段时间，再重试，这样可以稍微加快文档上传进度。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">–transfers 4 表示文件并行数量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">–max-size 3G 传输的文件最大3G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">–min-size 3G 传输的文件最小3G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">–checkers 64 并行检查64个文件
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>关于读取部分的一些 参数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">--dir-cache-time 12h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--vfs-read-chunk-size 32M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--vfs-read-chunk-size-limit 1G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. --vfs-cache-mode off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 所有文件操作全部直接进行
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 失败无法自动重试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. --vfs-cache-mode minimal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 读写模式打开的文件将会首先缓冲到磁盘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 其他模式打开文件直接进行操作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 失败无法自动重试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. --vfs-cache-mode writes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 读写模式打开的文件将会首先缓冲到磁盘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 只写模式打开的文件将会首先缓冲到磁盘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 只读取模式打开的文件将会直接进行操作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 支持自动重试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. --vfs-cache-mode full
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 所有文件操作全部缓存
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - 读取会下载整个文件
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="日志">日志
&lt;/h4>&lt;p>rclone 有 4 个级别的日志记录，ERROR，NOTICE，INFO 和 DEBUG。默认情况下，rclone 将生成 ERROR 和 NOTICE 级别消息。
-q - rclone将仅生成 ERROR 消息。
-v - rclone将生成 ERROR，NOTICE 和 INFO 消息，推荐此项。
-vv - rclone 将生成 ERROR，NOTICE，INFO和 DEBUG 消息。
&amp;ndash;log-level LEVEL - 标志控制日志级别。
输出日志到文件
使用 &amp;ndash;log-file=FILE 选项，rclone 会将 Error，Info 和 Debug 消息以及标准错误重定向到 FILE，这里的 FILE 是你指定的日志文件路径。
另一种方法是使用系统的指向命令，比如：
rclone sync -v Onedrive:/DRIVEX Gdrive:/DRIVEX &amp;gt; &amp;ldquo;~/DRIVEX.log&amp;rdquo; 2&amp;gt;&amp;amp;1&lt;/p>
&lt;h4 id="文件过滤">文件过滤
&lt;/h4>&lt;p>&amp;ndash;exclude - 排除文件或目录。
&amp;ndash;include - 包含文件或目录。
&amp;ndash;filter - 文件过滤规则，相当于上面两个选项的其它使用方式。包含规则以 + 开头，排除规则以 - 开头。
文件类型过滤
比如 &amp;ndash;exclude &amp;ldquo;*.bak&amp;rdquo;、&amp;ndash;filter &amp;ldquo;- &lt;em>.bak&amp;rdquo;，排除所有 bak 文件。也可以写作。
比如 &amp;ndash;include &amp;ldquo;&lt;/em>.{png,jpg}&amp;quot;、&amp;ndash;filter &amp;ldquo;+ *.{png,jpg}&amp;quot;，包含所有 png 和 jpg 文件，排除其他文件。
&amp;ndash;delete-excluded 删除排除的文件。需配合过滤参数使用，否则无效。&lt;/p>
&lt;h5 id="目录过滤">目录过滤
&lt;/h5>&lt;p>目录过滤需要在目录名称后面加上 /，否则会被当做文件进行匹配。以 / 开头只会匹配根目录（指定目录下），否则匹配所目录。这同样适用于文件。
&amp;ndash;exclude &amp;ldquo;.git/&amp;rdquo; 排除所有目录下的.git 目录。
&amp;ndash;exclude &amp;ldquo;/.git/&amp;rdquo; 只排除根目录下的.git 目录。
&amp;ndash;exclude &amp;ldquo;{Video,Software}/&amp;rdquo; 排除所有目录下的 Video 和 Software 目录。
&amp;ndash;exclude &amp;ldquo;/{Video,Software}/&amp;rdquo; 只排除根目录下的 Video 和 Software 目录。
&amp;ndash;include &amp;ldquo;/{Video,Software}/**&amp;rdquo; 仅包含根目录下的 Video 和 Software 目录的所有内容。&lt;/p>
&lt;h4 id="文件大小过滤">文件大小过滤
&lt;/h4>&lt;p>默认大小单位为 kBytes ，但可以使用 k ，M 或 G 后缀。
&amp;ndash;min-size 过滤小于指定大小的文件。比如 &amp;ndash;min-size 50 表示不会传输小于 50k 的文件。
&amp;ndash;max-size 过滤大于指定大小的文件。比如 &amp;ndash;max-size 1G 表示不会传输大于 1G 的文件。
TIPS: 博主在实际使用中发现大小过滤两个选项不能同时使用。
过滤规则文件
&amp;ndash;filter-from &amp;lt;规则文件&amp;gt; 从文件添加包含 / 排除规则。比如 &amp;ndash;filter-from filter-file.txt。
过滤规则文件示例：&lt;/p>
&lt;ul>
&lt;li>secret*.jpg&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>*.jpg&lt;/li>
&lt;li>*.png&lt;/li>
&lt;li>file2.avi&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>/dir/Trash/**&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>/dir/**&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>
&lt;ul>
&lt;li>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="rclone创建webdav服务器">rclone创建webdav服务器
&lt;/h4>&lt;p>实例&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nohup rclone serve webdav gd:media --etag-hash MD5 --addr 127.0.0.1:8080 --user whackeralpha --pass Bush993475Xjt5621 --dir-cache-time 300s --cache-dir /root/webdav_cache --vfs-cache-mode writes -v &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nohup rclone serve webdav d:backup/appdata/KeePass --etag-hash MD5 --addr 127.0.0.1:8080 --user alpabete --pass C6keP2sr_pi8 --cache-dir /root/webdav_cache --vfs-cache-mode writes -v &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nohup rclone serve webdav gd:media --addr 127.0.0.1:8080 --user whackeralpha --pass Bush993475Xjt5621 --cache-dir /root/webdav_cache &amp;amp;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nohup rclone serve http g:media --addr 127.0.0.1:8080 --user whackeralpha --pass Bush993475Xjt5621 --cache-dir /root/http_cache -v &amp;amp;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里只举例比较常用和简单的一些过滤用法，更复杂和高端的用法可以查看官方文档。&lt;/p>
&lt;h4 id="环境变量">环境变量
&lt;/h4>&lt;p>rclone 中的每个选项都可以通过环境变量设置。环境变量的名称可以通过长选项名称进行转换，删除 &amp;ndash; 前缀，更改 - 为_，大写并添加前缀 RCLONE_。环境变量的优先级会低于命令行选项，即通过命令行追加相应的选项时会覆盖环境变量设定的值。
比如设置最小上传大小 &amp;ndash;min-size 50，使用环境变量是 RCLONE_MIN_SIZE=50。当环境变量设置后，在命令行中使用 &amp;ndash;min-size 100，那么此时环境变量的值就会被覆盖。
常用环境变量
RCLONE_CONFIG - 自定义配置文件路径
RCLONE_CONFIG_PASS - 若 rclone 进行了加密设置，把此环境变量设置为密码，可自动解密配置文件。
RCLONE_RETRIES - 上传失败重试次数，默认 3 次
RCLONE_RETRIES_SLEEP - 上传失败重试等待时间，默认禁用，单位s、m、h分别代表秒、分钟、小时。
CLONE_TRANSFERS - 并行上传文件数。
RCLONE_CACHE_CHUNK_SIZE - 块的大小，默认5M，理论上是越大上传速度越快，同时占用内存也越多。如果设置得太大，可能会导致进程中断。
RCLONE_CACHE_CHUNK_TOTAL_SIZE - 块可以在本地磁盘上占用的总大小，默认10G。
RCLONE_IGNORE_ERRORS=true - 跳过错误&lt;/p>
&lt;h3 id="其他">其他
&lt;/h3>&lt;h4 id="rclone-忽略证书错误">rclone 忽略证书错误
&lt;/h4>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/rclone-skip-ssl/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/rclone-skip-ssl/&lt;/a>&lt;/p>
&lt;h4 id="rclone-webui">rclone webui
&lt;/h4>&lt;p>可以实现 文件浏览 挂载等操作&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">rclone rcd --rc-web-gui --rc-addr :80 --config /root/rclone.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="rclone-跨平台浏览工具">rclone 跨平台浏览工具
&lt;/h4>&lt;p>Rclone Browser&lt;/p>
&lt;blockquote>
&lt;p>需要 指定rclone 和 rclone.conf 的位置&lt;br>
win下需要 winfsp 和 sshfs&lt;/p>&lt;/blockquote>
&lt;p>有几个小bug，&lt;/p>
&lt;ul>
&lt;li>sftp浏览和挂载不能离开home目录。&lt;/li>
&lt;li>win下系统托盘 的退出功能无效&lt;/li>
&lt;li>暗黑模式标题栏有点小问题&lt;/li>
&lt;/ul>
&lt;p>已经停止更新很久，但是免费开源体积也不大。&lt;/p></description></item><item><title>nginx 反向代理webdav的问题 无法创建续传 重命名 移动 等问题</title><link>https://dev.leiyanhui.com/all-in-one/nginx-proxy-webdav/</link><pubDate>Sun, 12 Feb 2023 08:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/nginx-proxy-webdav/</guid><description>&lt;p>简单说，是需要 more_set_headers 这个模块，一般情况下nginx没有自带&lt;br>
&lt;a class="link" href="https://github.com/openresty/headers-more-nginx-module" target="_blank" rel="noopener"
>https://github.com/openresty/headers-more-nginx-module&lt;/a>&lt;/p>
&lt;p>以alpine下载的nginx为例&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apk add nginx-mod-http-headers-more
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nginx -V
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>发现是动态加载的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">find / -name &amp;#34;*more*&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>找到了文件 &lt;code>/usr/lib/nginx/modules/ngx_http_headers_more_filter_module.so&lt;/code>&lt;br>
修改配置文件 &lt;code>nginx.conf&lt;/code>添加一行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">load_module&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ngx_http_headers_more_filter_module&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">so&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>nginx版本必须大于 1.9.11，否则需要自己编译了不能使用动态加载了&lt;/p>
&lt;blockquote>
&lt;p>新版alpine的nginx默认配置文件会自动加载 &lt;code>/etc/nginx/modules/&lt;/code> 这里的配置文件，不需要自己 load_module&lt;/p>&lt;/blockquote>
&lt;h2 id="解决中文文件夹重命名问题">解决中文文件夹重命名问题
&lt;/h2>&lt;p>将请求头Destination中的https替换为http，并解决webdav重命名中文文件夹的乱码问题：
修改配置文件 http部分&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> map $http_destination $webdav_dest {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ~*https://(.+) http://$1;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default $http_destination;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="上传文件大小限制问题">上传文件大小限制问题
&lt;/h2>&lt;p>这部分内容放到server，或者http部分&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改包大小上限避免上传错误
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">client_max_body_size 10G;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="其他的问题">其他的问题
&lt;/h2>&lt;p>这部分内容放到 location&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 解决webdav不能创建文件夹问题
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if ($request_method = MKCOL) { rewrite ^(.*[^/])$ $1/ break; }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 解决webdav不能重命名问题
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if (-d $request_filename) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rewrite ^(.*[^/])$ $1/;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set $webdav_dest $webdav_dest/;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> more_set_input_headers &amp;#39;Destination: $webdav_dest&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 解决webdav不能复制、移动文件问题
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">if ($request_method ~ (MOVE|COPY))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> more_set_input_headers &amp;#39;Destination: $webdav_dest&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="最终配置文件">最终配置文件
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">load_module&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ngx_stream_module&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">so&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load_module&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginx&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ngx_http_headers_more_filter_module&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">so&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">worker_processes&lt;/span> &lt;span class="n">auto&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">events&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worker_connections&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">accept_mutex&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">http&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include&lt;/span> &lt;span class="n">mime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">types&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default_type&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">octet&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">keepalive_timeout&lt;/span> &lt;span class="mi">75&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gzip&lt;/span> &lt;span class="n">on&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gzip_min_length&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gzip_comp_level&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client_max_body_size&lt;/span> &lt;span class="mi">1024&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client_header_buffer_size&lt;/span> &lt;span class="mi">32&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client_body_buffer_size&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server_names_hash_bucket_size&lt;/span> &lt;span class="mi">512&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_headers_hash_max_size&lt;/span> &lt;span class="mi">51200&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_headers_hash_bucket_size&lt;/span> &lt;span class="mi">6400&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gzip_types&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">javascript&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">javascript&lt;/span> &lt;span class="n">text&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">javascript&lt;/span> &lt;span class="n">text&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">css&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">json&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">xml&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">map&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">http_upgrade&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">connection_upgrade&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span> &lt;span class="n">upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span> &lt;span class="n">close&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">map&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">http_destination&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">webdav_dest&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">~*&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">.+&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//$&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">http_destination&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">server_name&lt;/span> &lt;span class="n">alist&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jia&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">leiyanhui&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span> &lt;span class="mi">50443&lt;/span> &lt;span class="n">ssl&lt;/span> &lt;span class="n">http2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ssl_certificate&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">/.&lt;/span>&lt;span class="n">acme&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sh&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jia&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">leiyanhui&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">fullchain&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cer&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ssl_certificate_key&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nginxWebUI&lt;/span>&lt;span class="o">/.&lt;/span>&lt;span class="n">acme&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sh&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jia&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">leiyanhui&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jia&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">leiyanhui&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ssl_protocols&lt;/span> &lt;span class="n">TLSv1&lt;/span> &lt;span class="n">TLSv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">TLSv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">TLSv1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">listen&lt;/span> &lt;span class="mi">50080&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">scheme&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">301&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//$&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">50443&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">request_uri&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">error_page&lt;/span> &lt;span class="mi">497&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//$&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">50443&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">#解决http到ssl端口的400错误;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client_max_body_size&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">G&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_pass&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.52&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">Host&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Real&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="ne">IP&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">remote_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Forwarded&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">For&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Forwarded&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Host&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">http_host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Forwarded&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Port&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">server_port&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">X&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Forwarded&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Proto&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">scheme&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_http_version&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">Upgrade&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="n">Connection&lt;/span> &lt;span class="s2">&amp;#34;upgrade&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_redirect&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">proxy_set_header&lt;/span> &lt;span class="ne">Range&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">http_range&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 解决webdav不能创建文件夹问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">request_method&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">MKCOL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">rewrite&lt;/span> &lt;span class="o">^&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">.*&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">^/&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 解决webdav不能重命名问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">request_filename&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rewrite&lt;/span> &lt;span class="o">^&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">.*&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">^/&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">webdav_dest&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">webdav_dest&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">more_set_input_headers&lt;/span> &lt;span class="s1">&amp;#39;Destination: $webdav_dest&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 解决webdav不能复制、移动文件问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">request_method&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">MOVE&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">COPY&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">more_set_input_headers&lt;/span> &lt;span class="s1">&amp;#39;Destination: $webdav_dest&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>我的all in one 以及路由器 nas 的纠结和最终的方案</title><link>https://dev.leiyanhui.com/all-in-one/my-jiujie/</link><pubDate>Tue, 31 Jan 2023 11:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/my-jiujie/</guid><description>&lt;h2 id="设备情况如下">设备情况如下：
&lt;/h2>&lt;p>1、AP： 小米路由器 AP 2个 1个是访客网络 一个是北厂区的AP，还有一个K2P 在用
2、x86 ： 两台 一个i7 8850h 装的pve 另外一个是信步的N2600 装的openwrt
3、终端：几十个2.4G的物联网设备 14个ppoe监控 监控硬盘机 手机 笔记本若干&lt;/p>
&lt;p>一直没扔的k2p 是因为他的2.4G信号很稳，适合物联网设备覆盖。之前也是拿他当作主路由使用了10多年。&lt;/p>
&lt;p>一直以来的纠结 就是 软路由和 pve 的功能重叠，以及信步这个板子的一些问题。&lt;/p>
&lt;h2 id="纠结的地方">纠结的地方
&lt;/h2>&lt;h3 id="关于-信步这个板子">关于 信步这个板子
&lt;/h3>&lt;p>断电后偶尔会出现不能自动启动，另外N2600 不支持虚拟化，自带显卡也无法在linux下驱动 这就导致很多限制。&lt;/p>
&lt;p>还是想去掉他，卖掉的钱还能换一个 1-2T矿场硬盘。&lt;/p>
&lt;h3 id="路由的思考">路由的思考
&lt;/h3>&lt;p>在不添加新硬件（穷）的情况下，想用靠谱的网络。 最终的解决方案 可能还是 旁路由（旁网关）方案。
我的k2p 在不跑科学软件的情况下，实际是可以跑满带宽，内网有交换机不需要他。驼子里面拔将军，还是尝试用他做主路由。然后再尝试指定ip的网关到pve上的旁路由。
这就需要，k2p刷的固件的dhcp支持这个功能.&lt;br>
因为 运行pve的aio本身是不需要科学的。 为了全局科学（物联网设备可以在openwrt排除） 考虑方案如下&lt;/p>
&lt;h3 id="新方案">新方案
&lt;/h3>&lt;p>尽量不影响现有设备的情况下快速平滑过度。&lt;/p>
&lt;h4 id="k2p-固件">k2p 固件
&lt;/h4>&lt;p>k2p 是肯定不能刷爱快的，硬改后可以但是不少人说内网都会掉到500M。剩下的就是高ge 官改 openwrt 和 Padavan。&lt;br>
openwrt 熟悉很多，但是padaven 有人说 是可以跑满1000M 的，而openwrt 不太清楚，本着能用就行的态度。我决定 还是 用 padaven ，只是dhcp静态绑定的迁移有一点麻烦。两者的配置文件不通用。&lt;/p>
&lt;h4 id="旁路由网关">旁路由网关
&lt;/h4>&lt;p>系统肯定是op了。 用pve的虚拟机跑吧 省心。然后除了跑openclash ipsec 其他基本都不需要。dhcp也暂定关掉。&lt;/p>
&lt;h4 id="最重要的-自动网关文末">最重要的： 自动网关（文末）
&lt;/h4>&lt;p>因为我主路由受固件限制无法指定部分设备走旁路由网关，手动处理确实也比较麻烦，并且我需要 新设备加入后可以自动科学 ipsec拨进来的设备也可以。 所以打算在主路由上定时（1分钟）ping一下旁路由，如果不通，那么就把dhcp的网关切换回主路由，并重启 dhcp服务器。
另外 dhcp的生命周期也尽可能短一些 这样才能尽快生效。 （虽然对padaven不熟悉，但是好在他也提供ssh的，总可以搞定。 ）&lt;br>
这样就完美实现了，全局都走科学，部分不需要科学的设备，单独从openclash里面用规则处理掉即可。&lt;/p>
&lt;p>这样带来的好处就是 ，无论怎么折腾 主路由都可以提供基本的上网服务。旁路由上线 后 就提供科学和ipsec等。&lt;/p>
&lt;h4 id="小问题的处理">小问题的处理
&lt;/h4>&lt;h5 id="padaven-的内置ddns">padaven 的内置ddns
&lt;/h5>&lt;p>不支持我常用的3322（自定义可以） 和 dnspod 以及 cloudfare， 暂时注册一个它支持的，然后用cname解决。&lt;/p>
&lt;h5 id="padaven-的静态dhcp的备份">padaven 的静态dhcp的备份
&lt;/h5>&lt;p>喜欢备份是一个好习惯。。 系统管理 - 配置管理 直接备份&lt;/p>
&lt;h5 id="padaven--的ipv6">padaven 的ipv6
&lt;/h5>&lt;p>可以开启 ，以及 padaven 详情：https://www.jianshu.com/p/cb51fb0fb2ac&lt;/p>
&lt;h5 id="padaven-p段的迁移">padaven p段的迁移
&lt;/h5>&lt;p>之前的ip段是10.1.1.1 自定义的op固件，但padaven 默认的ip&lt;/p>
&lt;h5 id="vlmcsd">vlmcsd
&lt;/h5>&lt;p>padaven 有自带&lt;/p>
&lt;h5 id="alist">alist
&lt;/h5>&lt;p>挪到pve里面，单独一个容器/vm运行&lt;/p>
&lt;h5 id="nginxwebui">nginxWebUI
&lt;/h5>&lt;p>挪到pve里面，单独一个容器/vm运行&lt;/p>
&lt;h5 id="rustdesk服务">rustdesk服务
&lt;/h5>&lt;p>挪到pve里面，单独一个容器/vm运行&lt;/p>
&lt;h5 id="内网穿透">内网穿透
&lt;/h5>&lt;p>因为我有公网ip所以不需要其他穿透，仅需要80个443的穿透映射。
pve 和 路由器的 web界面 用 ddnsto 直接弄 简单省心。
3389 之类的端口可以直接用不费心。
80和443端口穿透 有两个解决，是备案过的域名 用 腾讯cdn穿透，未备案的域名用cloudfare穿透&lt;br>
一些应用级的，直接用非标端口解决&lt;/p>
&lt;h5 id="端口转发">端口转发
&lt;/h5>&lt;p>怎么都没想到，会在端口转发的上遇到问题 padaven 的固件的端口转发竟然有问题。&lt;br>
临时解决方案：dmz 到旁路由，在旁路由上 直接上 socat&lt;/p>
&lt;h5 id="pve的自动备份">pve的自动备份
&lt;/h5>&lt;p>qm stop 后，直接cp磁盘出来。&lt;/p>
&lt;h5 id="nas的处理">nas的处理
&lt;/h5>&lt;p>暂时用黑群晖简单很多，核心数据定时导出备份，影片等数据外挂直通的矿渣机械盘&lt;/p>
&lt;h4 id="自动检测旁路由脚本">自动检测旁路由脚本
&lt;/h4>&lt;p>实现：全局科学，去广告等，外网可以用ipsec协议链回家并科学。指定ip段 禁止科学。
旁路由离线后1-2分钟内，全局改为普通模式上网。 旁路由上限后 自动恢复。
&lt;a class="link" href="https://dev.leiyanhui.com/openwrt/auto-change-gatway" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/openwrt/auto-change-gatway&lt;/a>&lt;/p></description></item><item><title>2023 搭建私有网盘的一些需求和想法</title><link>https://dev.leiyanhui.com/all-in-one/my-netdisk/</link><pubDate>Sat, 28 Jan 2023 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/my-netdisk/</guid><description>&lt;p>几个私有网盘的对比：https://dev.leiyanhui.com/all-in-one/mynetdisk-duibi&lt;/p>
&lt;p>之前一直用 smb/nfs 在局域网内使用，主要是解决 几个wifi摄像头转存以及 macos的备份。 后续开始用webdav。&lt;/p>
&lt;p>时间旧了以后开始对在线文档编辑有需求。&lt;/p>
&lt;p>其实想要的功能很多，比如 在线思维导图，当然是自己可控的。 还有类似win快捷方式的链接功能（只能手写文本的样子）。&lt;/p></description></item><item><title>几个私有盘的选择和对比</title><link>https://dev.leiyanhui.com/all-in-one/mynetdisk-duibi/</link><pubDate>Sat, 28 Jan 2023 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/mynetdisk-duibi/</guid><description>&lt;h2 id="私有网盘程序功能对比">私有网盘程序功能对比
&lt;/h2>&lt;h3 id="基本需求">基本需求
&lt;/h3>&lt;p>如果只是要基本的 网盘功能，几乎所有的网盘程序都可以。
甚至nginx 自带的webdav也挺不错的。甚至sftp可能都可以。支持的客户端也众多。
下面从几个常见的网盘客户端程序中作一个对比，并根据我的需求来简单选择一下。&lt;/p>
&lt;h3 id="简单对比">简单对比
&lt;/h3>&lt;p>先说结论，很多网盘程序软文满天飞，广告天花乱坠。但是实际提供的功能 也就是 远程文件管理+权限管理。
在 在线文档方面 很弱智。&lt;/p>
&lt;h5 id="我想要的网盘功能">我想要的网盘功能：
&lt;/h5>&lt;ul>
&lt;li>协议：肯定要支持webdav，不然玩个锤子，最好能兼容sftp，是否兼通smb不强求&lt;/li>
&lt;li>ios客户端：如果支持相册视频备份最好（不过有FE文件管理器 PhotoSync Resilio Sync 可以替代[部分收费]）&lt;/li>
&lt;li>不要求一定可以支持云盘备份挂载，因为有 其他替代方案可以实现。&lt;/li>
&lt;li>一定要有比较好用的在线makedown编辑工具&lt;/li>
&lt;li>最好有基本的doc和execl编辑功能 可以对接onlyoffice&lt;/li>
&lt;/ul>
&lt;h4 id="nextcloud-owncloud">nextcloud /owncloud
&lt;/h4>&lt;p>虽然是基于php的，但是多数人实测是可以跑满内网100M的。&lt;br>
但是 功能强大，扩展性强。
因为文件是按照原始格式储存，不清楚 加密本地储存以及 smb/sftp 配合使用会出什么问题
ios客户端免费
致命缺点：性能要求高，吃cpu 吃内存 有人说还有大文件上传下载的资源占用bug&lt;/p>
&lt;h4 id="cloudreve">Cloudreve
&lt;/h4>&lt;p>最大最大的优点，不是php pythone脚本语言写的，是用的golang。 性能提升N倍数资源占用降低N倍。非常适合cpu性能低的清空下使用。
支持在线makedown，其他对比nextcloud的缺点没有在线文档功能，只有预览
缺点：ios客户端收费而且还不便宜，当然可以替代。文件目录 好像打乱了 。
另外论坛发现可以 对接 &lt;a class="link" href="https://forum.cloudreve.org/d/1200" target="_blank" rel="noopener"
>https://forum.cloudreve.org/d/1200&lt;/a>&lt;/p>
&lt;h4 id="filebrowser">filebrowser
&lt;/h4>&lt;p>只有很简单的功能，好像连webdav 都没有&lt;/p>
&lt;h4 id="seafile">seafile
&lt;/h4>&lt;p>文件本地是分块储存的，貌似就无法提供smb sftp了&lt;br>
界面丑陋上个世纪的东西。没有扩展性。office文件直接无法预览，但是可以创建。。。md文件预览加载出不来。。。&lt;br>
觉得。。。这么一个东西。。还是算了。&lt;/p>
&lt;h4 id="可道云">可道云
&lt;/h4>&lt;p>可道云有两个版本，界面玄，功能。。弱鸡。但是在群晖 或者群晖衍伸的人群中很受欢迎，甚至有人奉为信仰。。。还是两个字：弱鸡&lt;/p>
&lt;h4 id="alist">alist
&lt;/h4>&lt;p>可以挂本地，也可以挂多数网盘以及共享等。在挂载这方面可以说无人能比。但是完全不支持在线文档。非常适合作一个网盘 列表程序，但是不适合作一个功能齐全的网盘程序。&lt;/p>
&lt;h4 id="中间发现一些非常奇葩的网盘程序">中间发现一些非常奇葩的网盘程序
&lt;/h4>&lt;p>比如 dzzoffice，你新建一个文本，重命名为 .md 他非要给你加上.txt你再改一次，依旧。。。十年脑血栓&lt;/p></description></item><item><title>选择arch-aio，彻底抛弃pve esxi unraid</title><link>https://dev.leiyanhui.com/all-in-one/arch-aio/</link><pubDate>Fri, 30 Dec 2022 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/arch-aio/</guid><description>&lt;p>旧版查看 ：&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/diy/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/diy/&lt;/a>&lt;/p>
&lt;h2 id="安装和下载">安装和下载
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.123pan.com/s/EqorVv-K2nPA" target="_blank" rel="noopener"
>https://www.123pan.com/s/EqorVv-K2nPA&lt;/a> 提取码:arch
下载后解压，然后用ventoy，用支持x11转发的ssh客户端（例如 MobaXterm） 登录 用户名yanhui 密码 1 root 密码也是 1 但是root默认禁止登录。&lt;/p>
&lt;h2 id="简明使用方法">简明使用方法
&lt;/h2>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio-use/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/arch-aio-use/&lt;/a>&lt;/p>
&lt;h2 id="部分需要你继续处理的">部分需要你继续处理的
&lt;/h2>&lt;p>仅限2022-12-29 版本 ： &lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/server-after/" target="_blank" rel="noopener"
>修改服务引导顺序&lt;/a>&lt;/p>
&lt;h2 id="使用桥接网络">使用桥接网络
&lt;/h2>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/&lt;/a>&lt;/p>
&lt;h2 id="自动挂载其他磁盘的案例">自动挂载其他磁盘的案例
&lt;/h2>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/arch/auto--dock-kvm/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/arch/auto&amp;ndash;dock-kvm/&lt;/a>&lt;/p>
&lt;h2 id="其他常见问题">其他常见问题
&lt;/h2>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/faq" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/faq&lt;/a>&lt;/p></description></item><item><title>arch-aio 常见问题</title><link>https://dev.leiyanhui.com/all-in-one/faq/</link><pubDate>Thu, 29 Dec 2022 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/faq/</guid><description>&lt;h2 id="libvirtdvirt-manager-找不到磁盘">libvirtd/virt-manager 找不到磁盘
&lt;/h2>&lt;p>libvirtd 应该在rc.local 之后启动&lt;/p>
&lt;h2 id="virt-manager-弹不出界面">virt-manager 弹不出界面
&lt;/h2>&lt;p>1、 使用支持x11转发的客户端，win下使用 MobaXterm Macos和linux andriod下也又对应的客户端。如果是ios设备也有弯道解决方案
2、后台有virt-manager进程，那么先关掉 &lt;code>killall virt-manager&lt;/code>&lt;/p>
&lt;h2 id="virt-manager-无法连接">virt-manager 无法连接
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Unable to connect to libvirt qemu:///system.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="连不到virtqemud-sock">连不到virtqemud-sock
&lt;/h3>&lt;p>因为 libvirtd 没启动，可以用下面两种方式启动&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">systemctl enable libvirtd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start libvirtd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="修改dockerkvm目录后无法自动启动">修改docker/kvm目录后，无法自动启动
&lt;/h3>&lt;p>自动挂载建议放到rc-local 服务用，docker和libvirtd 在rc-local之后启动 &lt;a class="link" href="https://dev.leiyanhui.com/arch/auto-mount-dock-kvm/" target="_blank" rel="noopener"
>具体方法&lt;/a>&lt;/p></description></item><item><title>arch-aio 的 virt-manager上配置桥接网络</title><link>https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/</link><pubDate>Thu, 29 Dec 2022 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/</guid><description>&lt;p>本文基于&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/diy/" target="_blank" rel="noopener"
> arch-aio&lt;/a>，如果你是其他系统，请先处理好相关依赖。&lt;/p>
&lt;blockquote>
&lt;p>未完成&lt;/p>&lt;/blockquote>
&lt;h3 id="查看">查看
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat /etc/qemu/bridge.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">allow virbr0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>virbr0 是自动创建的，并不能完成虚拟机 映射到外网&lt;br>
继续查看其他情况&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo brctl show
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>判断出来物理口是 &lt;code>enp1s0&lt;/code>&lt;/p>
&lt;h3 id="安装-networkmanager">安装 networkmanager
&lt;/h3>&lt;p>我这里还是选用传统的networkmanager来处理，感觉更简单无脑一些。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pacman -S networkmanager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl enable NetworkManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start NetworkManager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置桥接br0">配置桥接br0
&lt;/h3>&lt;p>根据你的实际情况修改ip网关dns等&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nmcli connection add type bridge ifname br0 con-name br0 ipv4.addresses 10.1.1.1/24 ipv4.gateway 10.1.1.254 ipv4.dns 114.114.114.114 ipv4.method manual
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我这里还是打算用dhcp所以执行下面的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nmcli connection add type bridge ifname br0 con-name br0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="桥接网卡子网卡-关联物理卡">桥接网卡子网卡 关联物理卡
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nmcli connection add type bridge-slave con-name br0-slave1 ifname enp1s0 master br0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="开启">开启
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nmcli connection up br0-slave1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli connection up br0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nmcli connection show
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># systemctl restart NetworkManager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>此时网络会断开，原来ip无法连接，可以使用br0上的ip 重新连接。 如果是dhcp 可以从路由器看到多分配到br0上的ip。&lt;br>
重启 NetworkManager 后，或者重启物理机器后，两个ip都可以连接。&lt;/p>
&lt;h3 id="后续可选处理">后续可选处理
&lt;/h3>&lt;p>关闭br0的stp&lt;br>
禁止物理卡开机启动 可以避免要占用两个ip的问题&lt;/p>
&lt;h3 id="开启ip4转发">开启ip4转发
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sysctl net.ipv4.ip_forward=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano /etc/sysctl.d/99-sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward = 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="加载tun">加载tun
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">modprobe&lt;/span> &lt;span class="n">tun&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nano&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nb">load&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tun&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tun&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="恢复之前的操作未经测试">恢复之前的操作(未经测试)
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo ip link set br0 down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo brctl delif br0 enp1s0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ip link set enp1s0 down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ip link set up enp1s0 #重启物理网卡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ip link set dev br0 down #关闭 删除br0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo brctl delbr br0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参考文章：&lt;/p>
&lt;p>&lt;a class="link" href="https://wiki.archlinux.org/title/Network_bridge" target="_blank" rel="noopener"
>https://wiki.archlinux.org/title/Network_bridge&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/qq_42197548/article/details/120655449" target="_blank" rel="noopener"
>https://blog.csdn.net/qq_42197548/article/details/120655449&lt;/a>&lt;/p></description></item><item><title>arch-aio 免费高扩展性灵活且开放的all in one 系统的基本使用</title><link>https://dev.leiyanhui.com/all-in-one/arch-aio-use/</link><pubDate>Thu, 29 Dec 2022 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/arch-aio-use/</guid><description>&lt;h3 id="下载">下载
&lt;/h3>&lt;p>1、 arch-aio：https://dev.leiyanhui.com/all-in-one/diy/ 下载后解压到硬盘或U盘，要求分区格式是（exFAT/NTFS/UDF/XFS/Ext2(3)(4) ）&lt;br>
2、 &lt;a class="link" href="https://www.ventoy.net" target="_blank" rel="noopener"
>www.ventoy.net&lt;/a> 下载 ，并安装到U盘 或者硬盘（新版支持无损安装了）&lt;br>
3、 配置ventoy的自动启动以及VTOY_LINUX_REMOUNT ，可以使用arch-aio 下载链接里面的ventoy文件的json文件，具体参考 ventoy官网说明&lt;br>
4、 配置 lnk.vtoy 等等，具体参考 ventoy官网说明，也可以在ventoy引导界面按下F2 浏览找到对应的 vhd.vtoy 文件&lt;/p>
&lt;h3 id="启动">启动
&lt;/h3>&lt;p>使用ventoy启动即可，具体参考 ventoy官网说明&lt;/p>
&lt;h3 id="登录arch-aio">登录arch-aio
&lt;/h3>&lt;p>使用默认用户 yanhui 或 root 登录。&lt;br>
win客户端登录建议使用&lt;a class="link" href="https://mobaxterm.mobatek.net/download-home-edition.html" target="_blank" rel="noopener"
>MobaXterm免费版&lt;/a>&lt;/p>
&lt;h3 id="修改密码">修改密码
&lt;/h3>&lt;p>root和yanhui的密码 都要修改,yanhui&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">passwd yanhui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd root
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="可选shell和neofetch">可选shell和neofetch
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S fish neofetch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#编辑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nano .bashrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加两行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">neofetch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fish
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>neofetch 是登录后自动打印系统信息，fish是一个还不错的shell终端，命令补充和提示好用一些，另外一个不错的shell 叫做&lt;code>nushell&lt;/code> 安装后启动命令是&lt;code>nu&lt;/code>&lt;br>
&lt;code>.bashrc&lt;/code> 文件是你命令行登录后自动执行的一个文件。可以让它自动启动一些脚本方便使用。&lt;/p>
&lt;h3 id="检查和自动配置挂载">检查和自动配置挂载
&lt;/h3>&lt;h4 id="检查">检查
&lt;/h4>&lt;p>使用 &lt;code>fdisk -l &lt;/code> 和 &lt;code>lsblk&lt;/code> 查看分区情况，使用 &lt;code>df -h&lt;/code> 查看挂载情况。 值得注意的是，/dev/mapper/ventoy 的两个分区 是arch-aio 虚拟磁盘镜像的两个分区分别对应efi和&lt;code>/&lt;/code>&lt;/p>
&lt;h4 id="配置自动挂载">配置自动挂载
&lt;/h4>&lt;p>建议使用&lt;code>rc-local&lt;/code> 这个系统服务来处理，不建议使用fstab&lt;br>
以下实例直接从yanhui这个用户下处理&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p mnt/nvme mnt/efi mnt/exfat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 测试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo mount /dev/nvme0n1p6 /home/yanhui/mnt/exfat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo mount /dev/nvme0n1p5 /home/yanhui/mnt/nvme
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo mount /dev/nvme0n1p1 /home/yanhui/mnt/efi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>没问题后修改 &lt;code>sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh&lt;/code> 内容&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mount /dev/nvme0n1p6 /home/yanhui/mnt/exfat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/nvme0n1p5 /home/yanhui/mnt/nvme
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/nvme0n1p1 /home/yanhui/mnt/efi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启测试&lt;/p>
&lt;h3 id="迁移和配置docker和kvm">迁移和配置docker和kvm
&lt;/h3>&lt;h4 id="docker">docker
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="n">docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">rsync&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">avzP&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">mv&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bak&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">ln&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 完成后 rm -rf /var/lib/docker.bak&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="kvmlibvirtd">kvm/libvirtd
&lt;/h4>&lt;p>此步骤 可以不处理&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">systemctl&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="n">libvirtd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rsync&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">avzP&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">libvirt&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mv&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">libvirt&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">libvirt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bak&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ln&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">yanhui&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">nvme&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">libvirt&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 完成后 rm -rf /var/lib/libvirt.bak&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置docker和libvirtd开机自动启动">配置docker和libvirtd开机自动启动
&lt;/h4>&lt;p>先禁止他们的开机自动启动，改为从rc.local这个服务里面启动，已方便在挂载完成后再启动对应的服务&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">systemctl disable docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl disable libvirtd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改 &lt;code>sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh&lt;/code> 内容 添加两行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">systemctl start docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start libvirtd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>2022-12-29版本这个默认文件的libvirtd少了一个字母d，注意修改以下
重启&lt;/p>&lt;/blockquote>
&lt;h3 id="安装一个系统win10为例">安装一个系统（win10为例）
&lt;/h3>&lt;h4 id="安装镜像">安装镜像
&lt;/h4>&lt;p>先去弄一个win安装镜像,我这里有了&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mnt/exfat/iso/SW_DVD9_Win_Pro_10_22H2_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-20012.ISO
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>对应的目录是 &lt;code>/var/lib/libvirt/images &lt;/code>&lt;/p>
&lt;h4 id="windows-virio驱动镜像">windows virio驱动镜像
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">pacman&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">S&lt;/span> &lt;span class="n">wget&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="n">mnt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">exfat&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">iso&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">fedorapeople&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">groups&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">virt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">virtio&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">direct&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">downloads&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">archive&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">virtio&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">virtio&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">0.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">225&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">virtio&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">0.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">225.&lt;/span>&lt;span class="n">iso&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个网站访问速度很慢，最好挂个代理，或者下载后用MobaXterm上传到对应目录&lt;/p>
&lt;h4 id="准备安装">准备安装
&lt;/h4>&lt;p>MobaXterm或者其他支持x11的ssh客户端里面 用yanhui登录，执行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">systemctl start libvirtd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">virt-manager
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>会弹出virt-manager 图形界面窗口，先connect上默认的&lt;code>QEMU/KVM&lt;/code>&lt;br>
点 file -&amp;gt; New virual Machine 选默认的 local install，点下一步 Forward&lt;br>
点后面的浏览&lt;code>Browse&lt;/code> 弹出来一个 locate Iso 管理窗口，点左下角的 &lt;code>+&lt;/code> 号 Name 输入 ISO ，&lt;code>type&lt;/code> 保持默认 &lt;code>dir:&lt;/code> ,目标路径 Target 输入ISO储存路径&lt;code>/home/yanhui/mnt/exfat/iso&lt;/code> 然后点&lt;code>Finish&lt;/code> 结束&lt;/p>
&lt;p>然后选中新建的iso里面的win10安装镜像， 返回虚拟主机的配置界面 去掉&lt;code>automatically ...&lt;/code> 这个自动识别系统版本的勾号，在上面输入win10 搜索 选中对应的系统。然后 点下一步 Forward&lt;/p>
&lt;p>可能弹出一个权限的提醒，下一步忽略就好，分配cpu和内存。下一步 Forward 创建磁盘。参考前面iso的配置同样的方法创建一个专门放置vdisk的目录&lt;code>/home/yanhui/mnt/nvme/vdisk&lt;/code>，并创建一个磁盘 win10-base.qcow2 在这里个目录，大小要14G以上哦，不然不够win10安装用的，下一步 Forward ，勾选上 &lt;code>Customize configuration before install&lt;/code>&lt;/p>
&lt;p>继续配置，添加一个ide磁盘cdrom 到 驱动virtio-win-0.1.225.iso。&lt;/p>
&lt;p>默认磁盘改为 virtIO,缓存 unfase，&lt;/p>
&lt;p>如果需要和宿主机文件的交互，添加 File System，选择 virtio-9p&lt;/p>
&lt;p>网络接口等等 其他简单也配置以下，点&lt;code>begin installxxx&lt;/code>&lt;/p>
&lt;p>开始安装 就好了。
找不到磁盘 记得加载驱动，完成后 记得装完整驱动。别的都简单 不用多说。&lt;/p>
&lt;p>网络如果不会配置桥接的话，暂时先用NAT&lt;/p>
&lt;blockquote>
&lt;p>win11 的话记得添加tpm
桥接网络的配置 &lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/" target="_blank" rel="noopener"
>点这里查看&lt;/a>&lt;/p>&lt;/blockquote></description></item><item><title>常见all in one 系统的一些问题</title><link>https://dev.leiyanhui.com/all-in-one/other-os/</link><pubDate>Thu, 29 Dec 2022 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/other-os/</guid><description>&lt;p>我选择 arch-aio的理由&lt;/p>
&lt;blockquote>
&lt;p>arch-aio的简介 &lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/diy/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/diy/&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h5 id="pve">pve
&lt;/h5>&lt;ul>
&lt;li>磁盘分区 需要12-20G左右，备份起来不方便 ，虚拟磁盘名称不方便自定义&lt;/li>
&lt;li>多了不太常用的lxc，没有原生docker 需要自己处理&lt;/li>
&lt;/ul>
&lt;h5 id="hyper-v">hyper-v
&lt;/h5>&lt;ul>
&lt;li>宿主机占用资源偏多&lt;/li>
&lt;li>部分硬件的直通存在一些问题&lt;/li>
&lt;li>hyper-v 虽然免费，但win是收费的 破解版不适合商用&lt;/li>
&lt;/ul>
&lt;h5 id="esxi">esxi
&lt;/h5>&lt;ul>
&lt;li>个人免费，商用收费&lt;/li>
&lt;li>非原生linux，功能限制太多。&lt;/li>
&lt;li>硬件要求尤其是网卡要求多&lt;/li>
&lt;/ul>
&lt;h5 id="unraid">unraid
&lt;/h5>&lt;ul>
&lt;li>占用一个usb口&lt;/li>
&lt;li>需要一个非常靠谱的u盘&lt;/li>
&lt;li>墙内使用麻烦，需要梯子&lt;/li>
&lt;li>会破坏一块硬盘的数据&lt;/li>
&lt;li>收费，破解版多数有挖矿后台&lt;/li>
&lt;/ul>
&lt;h5 id="爱快">爱快
&lt;/h5>&lt;ul>
&lt;li>这个怎么说呢&amp;hellip;也就比较适合不折腾的用户吧&lt;/li>
&lt;li>虽然支持docker，但是没有shell 扩展性太差，简直可以说是垃圾中的战斗机&lt;/li>
&lt;li>但是他的dhcp 以及流控 都很简单易用&lt;/li>
&lt;li>有黑历史 慎重&lt;/li>
&lt;/ul>
&lt;h5 id="群晖">群晖
&lt;/h5>&lt;ul>
&lt;li>要么硬件买，钱多可以&lt;/li>
&lt;li>黑群晖 有一些莫名其妙的问题，有时候可能是致命性的，不少人出现一段时间后无法启动需要接上显示器处理。&lt;/li>
&lt;/ul>
&lt;h5 id="openwrt">openwrt
&lt;/h5>&lt;ul>
&lt;li>路由器系统，不太适合宿主机折腾&lt;/li>
&lt;/ul></description></item><item><title>旧版本 arch-aio all in one系统的，docker和kvm 与挂载磁盘顺序的一个小地方需要自己处理以下</title><link>https://dev.leiyanhui.com/all-in-one/server-after/</link><pubDate>Thu, 29 Dec 2022 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/server-after/</guid><description>&lt;p>为了灵活管理，arch-aio 单独创建一个了rc-local服务，用来添加开机自动启动的脚本。 同时也是这个原因，建议在rc-local 里面处理自动挂载脚本。&lt;/p>
&lt;p>仅限2022-12-29 版本&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /usr/lib/systemd/system/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>分别编辑 &lt;code>sudo nano libvirtd.service&lt;/code> 和 &lt;code>sudo nano docker.service&lt;/code> 在&lt;code>[Unit]&lt;/code> 段 增加一行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">After=rc-local.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这行是为了让docker和libvirtd 在rc-local这个服务之后启动，方便我们在 rc-local 内先挂载好磁盘
最后这两个服务设置为自动启动&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo systemctl enable libvirtd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl enable docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>关于和自动挂载其他分区配合的方法，可以参考这里：&lt;a class="link" href="https://dev.leiyanhui.com/arch/auto--dock-kvm/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/arch/auto&amp;ndash;dock-kvm/&lt;/a>&lt;/p></description></item><item><title>选择arch-aio，彻底抛弃pve esxi unraid</title><link>https://dev.leiyanhui.com/all-in-one/diy/</link><pubDate>Thu, 29 Dec 2022 17:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/diy/</guid><description>&lt;blockquote>
&lt;p>本文停止更新，新版查看 &lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio-use" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/arch-aio/&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="前言">前言
&lt;/h2>&lt;h3 id="经历">经历
&lt;/h3>&lt;p>前前后后用过很多 all in one 系统，hyper-v pve6-7.3 unraid，esxi 还有 群晖 爱快，感觉到很多不方便的地方。所以自己做了一个基于arch 和 ventoy的all in one 母系统。&lt;/p>
&lt;p>缺点：门槛略微高一点点。你需要会用linux的基本命令。包括不限&lt;code>ln mount &lt;/code>&lt;br>
优点：灵活，免费,不占用额外分区，强大扩展，较新并非常稳定的内核&lt;/p>
&lt;h3 id="使用方法">使用方法
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.123pan.com/s/EqorVv-K2nPA" target="_blank" rel="noopener"
>https://www.123pan.com/s/EqorVv-K2nPA&lt;/a> 提取码:arch&lt;br>
下载后解压，然后用ventoy，用支持x11转发的ssh客户端（例如 &lt;code>MobaXterm&lt;/code>） 登录 用户名&lt;code>yanhui&lt;/code> 密码 &lt;code>1&lt;/code>
root 密码也是 &lt;code>1&lt;/code> 但是root默认禁止登录。&lt;/p>
&lt;p>简明使用方法：&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio-use/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/arch-aio-use/&lt;/a>&lt;/p>
&lt;h4 id="虚拟机">虚拟机
&lt;/h4>&lt;p>先挂载分区，并 &lt;code> ln -s /var/lib/libvirt/images /目录&lt;/code> 或者直接把这个目录挂载到分区
MobaXterm 中运行 &lt;code>virt-manager&lt;/code> 会弹出&lt;code>virt-manager&lt;/code>界面&lt;br>
如果你只想用命令行，也可以卸载掉它。&lt;/p>
&lt;blockquote>
&lt;p>在不支持x11 转发的设备上管理虚拟机，请继续看后面&lt;/p>&lt;/blockquote>
&lt;h4 id="docker">docker
&lt;/h4>&lt;p>先挂载分区，并ln /var/lib/docker 目录 或者直接把这个目录挂载到分区
如果要图形界面，可以安装portainer&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">8000&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8000&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="mi">9443&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9443&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">portainer&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">restart&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">always&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">v&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sock&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">portainer&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">portainer&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">latest&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后浏览器访问：https://ip:9443&lt;/p>
&lt;h4 id="新建用户">新建用户
&lt;/h4>&lt;p>新建用户请 添加到wheel组 和 libvirt 组，例如用户名 xiaolei&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo useradd -m -G wheel -s /bin/bash xiaolei
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo usermod -a -G libvirt xiaolei
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后设置密码&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo passwd xiaolei
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="清理日志和缓存文件">清理日志和缓存文件
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sh /root/del-log.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="扩容">扩容
&lt;/h4>&lt;p>如果默认容量不够，需要扩容。请参考
&lt;a class="link" href="https://dev.leiyanhui.com/arch/ventoy-vdisk-resize" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/arch/ventoy-vdisk-resize&lt;/a>&lt;/p>
&lt;h4 id="exfat4-和ntfs支持">exfat4 和ntfs支持
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S exfat-utils
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo pacman -S ntfs-3g
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>exfat 和 ntfs 在linux下性能一般，ntfs稳定性更是一般，不建议高强度使用&lt;/p>&lt;/blockquote>
&lt;h4 id="关于sudo-和-vi-vim">关于sudo 和 vi vim
&lt;/h4>&lt;p>用doas 和nano替代的 软连接对应的sudo 和 vi vim&lt;/p>
&lt;h4 id="运行浏览器和其他软件">运行浏览器和其他软件
&lt;/h4>&lt;p>请尽量挂载到其他分区后用appimages
例如火狐&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">pacman&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">S&lt;/span> &lt;span class="n">fuse&lt;/span> &lt;span class="c1">#AppImage 依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">pacman&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">S&lt;/span> &lt;span class="n">dbus&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">glib&lt;/span> &lt;span class="c1"># 火狐依赖&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="err">挂载目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">apprepo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">de&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">appimage&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">firefox&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">document&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Firefox&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AppImage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">chmod&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">./*.&lt;/span>&lt;span class="n">AppImage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">./&lt;/span>&lt;span class="n">Firefox&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AppImage&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>火狐在x11转发下首次启动很卡，等一会关掉再次打开就流畅很多
中文字体支持&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo pacman -S wqy-zenhei
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>中文输入法：&lt;a class="link" href="https://wiki.archlinuxcn.org/wiki/Fcitx5" target="_blank" rel="noopener"
>https://wiki.archlinuxcn.org/wiki/Fcitx5&lt;/a>&lt;/p>
&lt;h4 id="开机自动启动脚本">开机自动启动脚本
&lt;/h4>&lt;p>rc-local服务：&lt;code>/usr/lib/systemd/system/rc-local.service&lt;/code> 和 &lt;code>/etc/rc.local&lt;/code>&lt;/p>
&lt;p>sh脚本放到 /etc/rc.local.d 目录&lt;/p>
&lt;h4 id="开机自动挂载">开机自动挂载
&lt;/h4>&lt;p>建议放到 /etc/rc.local.d目录。
参考编辑文件&lt;code>sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh&lt;/code>&lt;br>
详细说明参考这里：&lt;a class="link" href="https://dev.leiyanhui.com/arch/auto-mount-dock-kvm" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/arch/auto-mount-dock-kvm&lt;/a>&lt;/p>
&lt;h4 id="开机自动启动其他分区的vm-或者docker">开机自动启动其他分区的vm 或者docker
&lt;/h4>&lt;p>参考编辑文件&lt;code>sudo nano /etc/rc.local.d/auto-mount-and-start-aio.sh&lt;/code>&lt;br>
详细说明参考这里：&lt;a class="link" href="https://dev.leiyanhui.com/arch/auto-mount-dock-kvm" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/arch/auto-mount-dock-kvm&lt;/a>&lt;/p>
&lt;h4 id="桥接虚拟机网络">桥接虚拟机网络
&lt;/h4>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/&lt;/a>&lt;/p>
&lt;h4 id="关于远程访问虚拟机">关于远程访问虚拟机
&lt;/h4>&lt;p>如果客户端非ios设备，网络尚可 直接用支持x11转发的ssh客户端管理&lt;br>
如果是ios设备，因为没有可用的客户端，建议kvm 或者docker中运行一个 有桌面的win 或者linux，再远程过去.再套娃访问宿主机&lt;/p>
&lt;blockquote>
&lt;p>docker 运行linux桌面参考 &lt;a class="link" href="https://dev.leiyanhui.com/docker/run-deskto-gpu-usb/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/docker/run-deskto-gpu-usb/&lt;/a>&lt;br>
上文中的docker 支持网页vnc和xrdp微软远程链接，你甚至可以v挂载虚拟磁盘目录进去，里面有一些基本的软件，包括浏览器完成网盘备份等操作。&lt;/p>&lt;/blockquote>
&lt;p>当然，你也可以直接在宿主系统上安装一个gnome kde等桌面系统，然后开xrdp或者vnc 或者 向日葵 rustdesk 等等 尽情想想&amp;hellip;&lt;/p>
&lt;h4 id="关于winwinpe下访问">关于win/winpe下访问
&lt;/h4>&lt;p>因为镜像是vhd格式的，在win系统和多数winpe下可以直接挂载。 brtfs分区的访问请安装驱动，&lt;a class="link" href="https://dev.leiyanhui.com/win/winbtrfs/" target="_blank" rel="noopener"
>详情&lt;/a>&lt;/p>
&lt;h3 id="系统内软件包">系统内软件包
&lt;/h3>&lt;h4 id="母盘">母盘
&lt;/h4>&lt;p>archlinux-2022.12.01-x86_64.iso arch滚动更新，我用的母盘的版本不影响你 你可随意随时升级到最新版&lt;br>
用archinstall 直接安装的 minimal 模式&lt;br>
源 改为清华源，未开启archlinuxcn源，如果你需要aur软件包自行开启 &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/help/archlinuxcn/" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/help/archlinuxcn/&lt;/a> &lt;br>
内核考虑到安卓x86 选择 linux-zen&lt;/p>
&lt;h4 id="额外的软件包和配置">额外的软件包和配置
&lt;/h4>&lt;h5 id="基本">基本
&lt;/h5>&lt;p>开启了非root用户的x11转发，依赖&lt;code>xorg-xauth&lt;/code>
基本包： &lt;code>openssh dhcpcd nano doas&lt;/code>&lt;br>
ventoy依赖：&lt;code>which lvm2&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>sudo用doas替换了，但是同时ln到/bin/sudo&lt;br>
vi 未安装 如果不喜欢用nano自行处理&lt;/p>&lt;/blockquote>
&lt;h5 id="kvm和docker相关">kvm和docker相关
&lt;/h5>&lt;p>&lt;code>exfat-utils rsync &lt;/code> &lt;code>qemu-base samba dnsmasq dmidecode iptables-nft bridge-utils openbsd-netcat libvirt virt-manager docker&lt;/code>&lt;/p>
&lt;h3 id="开机自定启动的额外服务">开机自定启动的额外服务
&lt;/h3>&lt;p>&lt;code>sshd dhcpcd&lt;/code>&lt;/p>
&lt;blockquote>
&lt;p>注意 docker 和 kvm的libvirt 默认是通过 &lt;code>/etc/rc.local.d/auto-mount-and-start-aio.sh&lt;/code> 启动的&lt;/p>&lt;/blockquote>
&lt;h3 id="我对all-in-one的一点要求">我对all in one的一点要求
&lt;/h3>&lt;p>自定义、灵活、内核新，不破坏原来硬盘。&lt;/p>
&lt;h3 id="简单说一下各个系统的缺陷">简单说一下各个系统的缺陷
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/all-in-one/other-os/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/all-in-one/other-os/&lt;/a>&lt;/p>
&lt;h3 id="为什么选择arch">为什么选择arch
&lt;/h3>&lt;ul>
&lt;li>只使用qemu 等几个软件的情况下，也不存在滚挂的可能性。除非你真的大半年不更新。&lt;/li>
&lt;li>相对 debian centos系，内核新，很多新特性都可以支持&lt;/li>
&lt;li>wiki资料丰富，扩展容易&lt;/li>
&lt;/ul>
&lt;h3 id="为什么选择ventoy引导">为什么选择ventoy引导
&lt;/h3>&lt;p>ventoy新版已经有限的支持无损安装到硬盘，同时也兼容grub4dos&lt;/p>
&lt;h3 id="磁盘容量的纠结">磁盘容量的纠结
&lt;/h3>&lt;p>控制到3.7G 以内是最好的选择，但是可用空间实在是太少了。安装qemu的常用依赖后，剩余空间只有几百M。无法满足正常使用的需求。
考虑许久后，决定抛弃兼容fat32和4G U盘的不实际的想法，改为7.3G。 即便是要安装一个桌面系统 应该也勉强够用。
另外 home opt等目录都可以挂载出来。&lt;/p>
&lt;h3 id="磁盘格式的选择">磁盘格式的选择
&lt;/h3>&lt;p>ventoy只支持 固定大小的vhd vdi raw/img 三种格式 虚拟磁盘启动linux。kvm只支持其中raw，vbox支持前两者，win可以直接挂载vhd&lt;br>
linux可以用qemu-img随意转换其他格式，vhd文件也可以转换成raw/img后挂载。
综合考虑，还是选择了vhd格式&lt;/p>
&lt;h3 id="vdisk内efi分区的大小">vdisk内efi分区的大小
&lt;/h3>&lt;p>考虑到换内核的可能性和内核更新的情况，还是用多数情况适用的512M（正常只占用60m左右）&lt;/p>
&lt;h3 id="vdisk内根分区文件系统的选择">vdisk内根分区文件系统的选择
&lt;/h3>&lt;p>我这里选择brtfs，支持压缩和快照。并且几乎所有winpe下都可以 右键加载驱动后访问，虽然不够稳定但是要比其他文件系统简单一些。&lt;/p>
&lt;h3 id="swap的选择">swap的选择
&lt;/h3>&lt;p>默认不开启，如果需要自行创建swap文件即可&lt;/p></description></item><item><title>一个可以不动硬盘分区，直接从一个文件启动的proxmox（pve） 打造all in one</title><link>https://dev.leiyanhui.com/all-in-one/pve-ventoy-vdisk/</link><pubDate>Thu, 22 Dec 2022 03:14:20 +0800</pubDate><guid>https://dev.leiyanhui.com/all-in-one/pve-ventoy-vdisk/</guid><description>&lt;h2 id="有什么用">有什么用
&lt;/h2>&lt;ul>
&lt;li>可以在不修改你磁盘分区的情况下，只占用5G的硬盘空间(新版占用12G，剩余7G+)，使用vhd虚拟磁盘的方式 启动一个性能和功能完全不受影响在物理机运行的pve系统。&lt;/li>
&lt;li>可以和其他系统共存并不需要额外的分区&lt;/li>
&lt;li>可以同时存在多个pve系统 自由切换，例如一个开启gvt-g的一个开启核显直通的&lt;/li>
&lt;li>可以很方便的整个系统备份和恢复&lt;/li>
&lt;/ul>
&lt;h2 id="开始使用">开始使用
&lt;/h2>&lt;p>1、准备一个空白U盘，或者硬盘安装好 ventoy,下载 解压 pve.vhd 文件到 任意一个分区（exFAT/NTFS/UDF/XFS/Ext2(3)(4)格式的分区），重命名为 pve.vhd.vtoy &lt;br>
2、开机用ventoy磁盘引导，按下F2 浏览，找到 pve.vhd.vtoy，正常启动 用户名root 密码root &lt;br>
3、配置网卡和ip等 重启，&lt;a class="link" href="https://dev.leiyanhui.com/pve/changip-and-netcard" target="_blank" rel="noopener"
>详细说明看这里&lt;/a> &lt;br>
4、挂载其他磁盘修改虚拟机和ct容器目录 详细说明看后文&lt;/p>
&lt;blockquote>
&lt;p>只是修改了pve内部的引导挂载路径,使用方法 和正常安装的pve一样 ，不影响直通和其他任何功能。更不影响任何性能。&lt;/p>&lt;/blockquote>
&lt;h2 id="进阶">进阶
&lt;/h2>&lt;p>1、扩容方法（以后补 剩余7G其实足够了&amp;hellip; 先用工具扩容vhd，然后在从pve内部处理lvm即可） &lt;br>
2、配置开机启动启动pve &lt;a class="link" href="https://dev.leiyanhui.com/os/ventoy-auto-boot" target="_blank" rel="noopener"
>查看这里&lt;/a> &lt;br>
3、不使用ventoy的启动（整理中..）&lt;/p>
&lt;h2 id="pve通用进阶教程">pve通用进阶教程
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://dev.leiyanhui.com/pve/igpu-pass/" target="_blank" rel="noopener"
>开启pci直通简明教程&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://dev.leiyanhui.com/pve/pve-vm-esxi" target="_blank" rel="noopener"
>开启虚拟化嵌套&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://dev.leiyanhui.com/pve/install-macos-ventura" target="_blank" rel="noopener"
>安装macos&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="更新说明">更新说明
&lt;/h2>&lt;p>2022-12-23&lt;/p>
&lt;ul>
&lt;li>更新为12G 容量，剩余空间7G左右，放弃5G镜像，之所以做一个容量大一些的，是发现1.3G的剩余空间在安装几个常用软件后经常就占满了，再次去扩容过于折腾。而7G容量足够安装常用软件，甚至可以安装上一个桌面系统。&lt;/li>
&lt;li>&lt;del>安装firefox 和 hrub&lt;/del>&lt;/li>
&lt;li>为了减少体积，网盘包改为 7zip 格式 linux解压命令，debian/ubuntu:&lt;code>apt-get install p7zip &amp;amp;&amp;amp; 7z x pve20221223.vhd.vtoy.7z -r -o /目标路径 &lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="概述">概述
&lt;/h2>&lt;ul>
&lt;li>基于 Virtual Environment 7.3-3 内核最新版（目前是 5.15.74-1）&lt;/li>
&lt;li>基于vtoyboot-1.0.25（ventoy） 支持硬盘/U盘安装的 vtoyboot，也支持grub4dos插件启动，推荐用vtoyboot&lt;/li>
&lt;li>硬盘占用空间5G 剩余空间1.1G 左右（可扩容）&lt;/li>
&lt;li>默认ip：5G版：10.0.0.8 12G初始版：10.0.0.120&lt;/li>
&lt;li>默认用户名root 密码 root&lt;/li>
&lt;li>Local-lvm 默认没有启用(低容量会默认禁用)Local开启全功能&lt;/li>
&lt;li>开启x11 转发，方便在上面运行图形化软件，支持浏览器 文件管理等所有linux图形化软件&lt;/li>
&lt;li>开启了sftp 可以用alist rclone之类的软件挂载 &lt;a class="link" href="https://dev.leiyanhui.com/pve/open-sftp" target="_blank" rel="noopener"
>详情&lt;/a>&lt;/li>
&lt;li>修改为国内源&lt;/li>
&lt;li>&lt;del>显示cpu主频 cpu温度 nvme硬盘温度 sata硬盘温度&lt;/del>&lt;/li>
&lt;li>&lt;del>去掉订阅弹窗&lt;/del>&lt;/li>
&lt;li>支持升级&lt;/li>
&lt;li>不影响pci直通等操作&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>绝对没有后门，所有修改过的文件，都备份了一份在 /root/bak-sources, 所有的历史命令和操作记录 都保留，&lt;a class="link" href="https://dev.leiyanhui.com/pve/del-log" target="_blank" rel="noopener"
>你可以自行删除&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="计划中的功能">计划中的功能
&lt;/h2>&lt;p>精简到4G 以内 方便fat32 分区使用&lt;/p>
&lt;h2 id="已经处理的步骤和常见问题">已经处理的步骤和常见问题
&lt;/h2>&lt;h3 id="挂载其他分区">挂载其他分区
&lt;/h3>&lt;p>查看所有磁盘和分区&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">fdisk -l
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>挂载一个分区到/mnt/nvme1&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir /mnt/nvme1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mount /dev/nvmen0p2 /mnt/nvme1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>开机自动挂载，修改fstab 或者 添加开机自动执行脚本。
查看本文 &lt;a class="link" href="https://dev.leiyanhui.com/pve/auto-mount-exfat" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/auto-mount-exfat&lt;/a>
更多内容请自行google &amp;ldquo;linux 挂载分区&amp;quot;关键词&lt;/p>
&lt;blockquote>
&lt;p>pve 可以挂载ntfs分区，但是不建议长期使用，性能和稳定性都有问题。&lt;/p>&lt;/blockquote>
&lt;h3 id="修改ct和虚拟机主机的路径">修改ct和虚拟机主机的路径
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/pve/pve-mv-dir" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/pve-mv-dir&lt;/a>&lt;/p>
&lt;h3 id="国内源">国内源
&lt;/h3>&lt;p>已经更换到清华源 &lt;a class="link" href="https://dev.leiyanhui.com/pve/guonei" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/guonei&lt;/a>&lt;/p>
&lt;h3 id="显示温度">&lt;del>显示温度&lt;/del>
&lt;/h3>&lt;p>&lt;del>已经处理过，不需要你再处理&lt;/del>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cp /usr/share/perl5/PVE/API2/Nodes.pm /root/bak-sources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /usr/share/pve-manager/js/pvemanagerlib.js /root/bak-sources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#覆盖文件后 执行下面命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install lm-sensors &amp;amp;&amp;amp; apt-get install nvme-cli &amp;amp;&amp;amp; apt-get install hddtemp &amp;amp;&amp;amp; chmod +s /usr/sbin/nvme &amp;amp;&amp;amp; chmod +s /usr/sbin/hddtemp &amp;amp;&amp;amp; chmod +s /usr/sbin/smartctl &amp;amp;&amp;amp; systemctl restart pveproxy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="订阅弹出窗口">&lt;del>订阅弹出窗口&lt;/del>
&lt;/h3>&lt;p>&lt;del>已经处理过，不需要你再处理&lt;/del>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">javascript&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">proxmox&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">widget&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">toolkit&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">proxmoxlib&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">js&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bak&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sources&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sed&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Ezi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bak&lt;/span> &lt;span class="s2">&amp;#34;s/(Ext.Msg.show\(\{\s+title: gettext\(&amp;#39;No valid sub)/void\(\{ \/\/&lt;/span>&lt;span class="se">\1&lt;/span>&lt;span class="s2">/g&amp;#34;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">javascript&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">proxmox&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">widget&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">toolkit&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">proxmoxlib&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">js&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">restart&lt;/span> &lt;span class="n">pveproxy&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可能需要清理缓存&lt;/p>
&lt;h3 id="x11-转发">X11 转发
&lt;/h3>&lt;p>已经处理过，不需要你再处理：&lt;a class="link" href="https://dev.leiyanhui.com/pve/x11" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/x11&lt;/a>
用 Xming 或者MobaXterm 连接上，安装一个图形界面软件 测试，比如 &lt;code>apt install firefox-esr thunar&lt;/code> 然后执行firefox 即可打开火狐，thunar 也是一个简单的文件管理工具。&lt;/p>
&lt;blockquote>
&lt;p>注意：x11 转发 只适合简单的场景使用。如果你要流畅，还是考虑 扩容后安装一个完整的桌面系统kde gnome等，然后xrdp vnc或者todesk之类的连接上使用。&lt;/p>&lt;/blockquote>
&lt;h3 id="清理日志和历史命令">清理日志&lt;del>和历史命令&lt;/del>
&lt;/h3>&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/pve/del-log/" target="_blank" rel="noopener"
>https://dev.leiyanhui.com/pve/del-log/&lt;/a>&lt;/p>
&lt;h3 id="系统升级到最新版">系统升级到最新版
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apt update &amp;amp;&amp;amp; apt full-upgrade
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd /root/vtoyboot-*/ &amp;amp;&amp;amp; sh vtoyboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="更新vtoyboot">更新vtoyboot
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /root/vtoyboot-*/ &amp;amp;&amp;amp; sh vtoyboot.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>应该在系统更新和修改grub后，重启之前执行一次，详情参考 &lt;a class="link" href="https://www.ventoy.net/cn/plugin_vtoyboot.html" target="_blank" rel="noopener"
>https://www.ventoy.net/cn/plugin_vtoyboot.html&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h3 id="怎么访问-vhd所在的分区">怎么访问 vhd所在的分区
&lt;/h3>&lt;p>参考 &lt;a class="link" href="https://www.ventoy.net/cn/faq.html" target="_blank" rel="noopener"
>ventoy faq手册&lt;/a> 启动类问题的说明第四条 &lt;code>默认情况下，Linux系统启动之后，存放ISO文件的分区无法挂载（会提示 Busy）。如果确实需要挂载，请使用 全局控制插件 中的 VTOY_LINUX_REMOUNT 选项。&lt;/code>&lt;/p>
&lt;p>&lt;a class="link" href="https://dev.leiyanhui.com/os/ventoy-auto-boot" target="_blank" rel="noopener"
>也可以查看本文 关于自动启动的说明&lt;/a>&lt;/p>
&lt;h3 id="winpewin下如何备份和配置pve">winpe/win下如何备份和配置pve
&lt;/h3>&lt;h4 id="备份">备份
&lt;/h4>&lt;p>直接复制压缩 XXX.vtoy 文件&lt;/p>
&lt;h4 id="配置ventoy">配置ventoy
&lt;/h4>&lt;p>建议用完整win，或者firpe，然后 用它自带的工具 VentoyPlugson.exe ，默认地址是 http://127.0.0.1:24681&lt;/p>
&lt;h4 id="修改pve内部文件">修改pve内部文件
&lt;/h4>&lt;p>重命名为 .vhd，然后挂载到Windows，而后用支持ext4分区的软件来操作 推荐 ExtFS 最稳定，免费10天，也有XXX的版本&lt;br>
&lt;a class="link" href="https://china.paragon-software.com/home-windows/extfs-for-windows/download.html" target="_blank" rel="noopener"
>https://china.paragon-software.com/home-windows/extfs-for-windows/download.html&lt;/a>&lt;/p>
&lt;h2 id="ventoy和pve的使用需要注意">ventoy和pve的使用需要注意
&lt;/h2>&lt;ul>
&lt;li>ventoy 不支持差分vhd磁盘，不要尝试改为vhd文件后再次差分，但是可以自己转换为vdi或者img格式&lt;/li>
&lt;li>修改grub后或者内核升级后记得运行一次 vtoyboot.sh 再重启。平时不需要&lt;/li>
&lt;li>vhd.vtoy文件可以放在ntfs分区，不影响使用。但不建议pve内的虚拟机放在ntfs分区，所有的非win系统，对ntfs的支持都不够稳定。&lt;/li>
&lt;li>记得修改密码！！！！！&lt;/li>
&lt;/ul>
&lt;h2 id="下载地址">下载地址
&lt;/h2>&lt;p>如果失效，请联系 &lt;a class="link" href="mailto:joyanhui@qq.com" >joyanhui@qq.com&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.123pan.com/s/EqorVv-fPnPA" target="_blank" rel="noopener"
>https://www.123pan.com/s/EqorVv-fPnPA&lt;/a> 提取码:0pve&lt;/p>
&lt;p>其他未尽事宜 请参考ventoy手册：&lt;a class="link" href="https://www.ventoy.net/cn/doc_news.html" target="_blank" rel="noopener"
>https://www.ventoy.net/cn/doc_news.html&lt;/a>&lt;/p></description></item></channel></rss>