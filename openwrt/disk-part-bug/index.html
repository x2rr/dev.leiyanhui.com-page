<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="今天第一次弄x86的openwrt，遇到分区扩容的一个坑。网上太多太多的资料 都是坑。\n原因是原版的openwrt 有一个挂载的覆盖的bug，多数固件并未解决。我一开始用squashfs的固件，都没有搞定，最后换到ext4 解决。前后折腾2个多小时。 具体可以参考：https://github.com/openwrt/openwrt/issues/7352\n然后下午在群里，发现有人手把手教别人弄，最后还是出现和我一样的问题。\ndf -h 查看容量正常，但是网页端 software查看容量 并没有增加。装软件也会提示容量不足\n我的解决办法 就是用ext4模式安装，我用的官网的ext4固件。因为我设备是x86 并且没有很特殊的硬件，官网固件都是可以驱动的（N2600显卡除外，非efi模式启动黑屏）\n如果你也和我一样 是x86的路由，那么强烈建议你用最精简的官网固件,原因\n第三方固件，不安全，虽然说都号称没有后门，但是你有时间和精力 或者有能力去查找后门嘛？ 鉴于openwrt这个圈子的特殊性，与其相信第三方固件作者是用爱发电，我更多相信他是一个半吊子菜鸟一时的热忱 但openwrt圈内也确实有一些 完全开源甚至编译过程都开源的第三方固件，但是我们没有那么多时间去甄别，更没有那么多时间和经历 去折腾试用 openwrt 是一个完整的linux系统，官网固件只要能开机，能识别你的有线网卡，或者usb口，哪怕只能识别显示屏，那么剩下的都可以解决 openwrt 本身是一个很强壮 稳定高性能的 路由器系统，所有的问题 都出在第三方固件作者和 第三方插件上！！！看看那些第三方固件作者的声明 第三方作者的水平层次不齐，甚至论坛上下载过万的固件 哪怕他最精简的版本bug多到都无法完成最基本的路由功能！ 当然，如果你网卡不识别，并且还是linux小白，又不想学习，那么就冒险试用第三方，或者付费找人编译吧。能用钱和安全解决的 问题，都不是问题 哈哈。 如果有时间又能力去编译自定义固件，那么这个文章和这个观点也不适合你，自己忽略就好了。 今天群里还有人问 官网地址。。。 www.openwrt.org\n下载官网稳定版固件 下载地址： https://archive.openwrt.org/releases/ 选择版本 再选择 cpu平台 就可以了。我这里是x86 64位的 cpu，所以 依次点击 22.03.2 -> targets -> x86 -> 64 ，然后选择 generic-ext4-combined.img.gz 这个ext4分区的\n如果你机器只支持efi启动不支持传统bois启动，那就选generic-ext4-combined-efi.img.gz，如果同时支持，那么还是建议无脑选这个。如果你情况特殊非要用efi 那就选择 generic-ext4-combined-efi.img.gz 这个\n很多第三方固件是 squashfs-combined 的，如果制作者没有处理overlay的bug，那么肯定会遇到挂载问题，网上有资料说可以通过删除/etc 目录的方法来解决，但是我试过也不行。\n还有群友说看不懂英文的官网。。那么你就直接点我下面地址下载好了\n"><title>openwrt分区扩容的问题---多数openwrt固件的一个巨坑 保姆教程/ 顺带 linux和openwrt 扫盲 /常用扩展插件安装</title><link rel=canonical href=https://dev.leiyanhui.com/openwrt/disk-part-bug/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="openwrt分区扩容的问题---多数openwrt固件的一个巨坑 保姆教程/ 顺带 linux和openwrt 扫盲 /常用扩展插件安装"><meta property='og:description' content="今天第一次弄x86的openwrt，遇到分区扩容的一个坑。网上太多太多的资料 都是坑。\n原因是原版的openwrt 有一个挂载的覆盖的bug，多数固件并未解决。我一开始用squashfs的固件，都没有搞定，最后换到ext4 解决。前后折腾2个多小时。 具体可以参考：https://github.com/openwrt/openwrt/issues/7352\n然后下午在群里，发现有人手把手教别人弄，最后还是出现和我一样的问题。\ndf -h 查看容量正常，但是网页端 software查看容量 并没有增加。装软件也会提示容量不足\n我的解决办法 就是用ext4模式安装，我用的官网的ext4固件。因为我设备是x86 并且没有很特殊的硬件，官网固件都是可以驱动的（N2600显卡除外，非efi模式启动黑屏）\n如果你也和我一样 是x86的路由，那么强烈建议你用最精简的官网固件,原因\n第三方固件，不安全，虽然说都号称没有后门，但是你有时间和精力 或者有能力去查找后门嘛？ 鉴于openwrt这个圈子的特殊性，与其相信第三方固件作者是用爱发电，我更多相信他是一个半吊子菜鸟一时的热忱 但openwrt圈内也确实有一些 完全开源甚至编译过程都开源的第三方固件，但是我们没有那么多时间去甄别，更没有那么多时间和经历 去折腾试用 openwrt 是一个完整的linux系统，官网固件只要能开机，能识别你的有线网卡，或者usb口，哪怕只能识别显示屏，那么剩下的都可以解决 openwrt 本身是一个很强壮 稳定高性能的 路由器系统，所有的问题 都出在第三方固件作者和 第三方插件上！！！看看那些第三方固件作者的声明 第三方作者的水平层次不齐，甚至论坛上下载过万的固件 哪怕他最精简的版本bug多到都无法完成最基本的路由功能！ 当然，如果你网卡不识别，并且还是linux小白，又不想学习，那么就冒险试用第三方，或者付费找人编译吧。能用钱和安全解决的 问题，都不是问题 哈哈。 如果有时间又能力去编译自定义固件，那么这个文章和这个观点也不适合你，自己忽略就好了。 今天群里还有人问 官网地址。。。 www.openwrt.org\n下载官网稳定版固件 下载地址： https://archive.openwrt.org/releases/ 选择版本 再选择 cpu平台 就可以了。我这里是x86 64位的 cpu，所以 依次点击 22.03.2 -> targets -> x86 -> 64 ，然后选择 generic-ext4-combined.img.gz 这个ext4分区的\n如果你机器只支持efi启动不支持传统bois启动，那就选generic-ext4-combined-efi.img.gz，如果同时支持，那么还是建议无脑选这个。如果你情况特殊非要用efi 那就选择 generic-ext4-combined-efi.img.gz 这个\n很多第三方固件是 squashfs-combined 的，如果制作者没有处理overlay的bug，那么肯定会遇到挂载问题，网上有资料说可以通过删除/etc 目录的方法来解决，但是我试过也不行。\n还有群友说看不懂英文的官网。。那么你就直接点我下面地址下载好了\n"><meta property='og:url' content='https://dev.leiyanhui.com/openwrt/disk-part-bug/'><meta property='og:site_name' content='小类随手记'><meta property='og:type' content='article'><meta property='article:section' content='Openwrt'><meta property='article:published_time' content='2022-11-24T04:40:20+08:00'><meta property='article:modified_time' content='2022-11-24T04:40:20+08:00'><meta name=twitter:title content="openwrt分区扩容的问题---多数openwrt固件的一个巨坑 保姆教程/ 顺带 linux和openwrt 扫盲 /常用扩展插件安装"><meta name=twitter:description content="今天第一次弄x86的openwrt，遇到分区扩容的一个坑。网上太多太多的资料 都是坑。\n原因是原版的openwrt 有一个挂载的覆盖的bug，多数固件并未解决。我一开始用squashfs的固件，都没有搞定，最后换到ext4 解决。前后折腾2个多小时。 具体可以参考：https://github.com/openwrt/openwrt/issues/7352\n然后下午在群里，发现有人手把手教别人弄，最后还是出现和我一样的问题。\ndf -h 查看容量正常，但是网页端 software查看容量 并没有增加。装软件也会提示容量不足\n我的解决办法 就是用ext4模式安装，我用的官网的ext4固件。因为我设备是x86 并且没有很特殊的硬件，官网固件都是可以驱动的（N2600显卡除外，非efi模式启动黑屏）\n如果你也和我一样 是x86的路由，那么强烈建议你用最精简的官网固件,原因\n第三方固件，不安全，虽然说都号称没有后门，但是你有时间和精力 或者有能力去查找后门嘛？ 鉴于openwrt这个圈子的特殊性，与其相信第三方固件作者是用爱发电，我更多相信他是一个半吊子菜鸟一时的热忱 但openwrt圈内也确实有一些 完全开源甚至编译过程都开源的第三方固件，但是我们没有那么多时间去甄别，更没有那么多时间和经历 去折腾试用 openwrt 是一个完整的linux系统，官网固件只要能开机，能识别你的有线网卡，或者usb口，哪怕只能识别显示屏，那么剩下的都可以解决 openwrt 本身是一个很强壮 稳定高性能的 路由器系统，所有的问题 都出在第三方固件作者和 第三方插件上！！！看看那些第三方固件作者的声明 第三方作者的水平层次不齐，甚至论坛上下载过万的固件 哪怕他最精简的版本bug多到都无法完成最基本的路由功能！ 当然，如果你网卡不识别，并且还是linux小白，又不想学习，那么就冒险试用第三方，或者付费找人编译吧。能用钱和安全解决的 问题，都不是问题 哈哈。 如果有时间又能力去编译自定义固件，那么这个文章和这个观点也不适合你，自己忽略就好了。 今天群里还有人问 官网地址。。。 www.openwrt.org\n下载官网稳定版固件 下载地址： https://archive.openwrt.org/releases/ 选择版本 再选择 cpu平台 就可以了。我这里是x86 64位的 cpu，所以 依次点击 22.03.2 -> targets -> x86 -> 64 ，然后选择 generic-ext4-combined.img.gz 这个ext4分区的\n如果你机器只支持efi启动不支持传统bois启动，那就选generic-ext4-combined-efi.img.gz，如果同时支持，那么还是建议无脑选这个。如果你情况特殊非要用efi 那就选择 generic-ext4-combined-efi.img.gz 这个\n很多第三方固件是 squashfs-combined 的，如果制作者没有处理overlay的bug，那么肯定会遇到挂载问题，网上有资料说可以通过删除/etc 目录的方法来解决，但是我试过也不行。\n还有群友说看不懂英文的官网。。那么你就直接点我下面地址下载好了\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_6049d840d4e2d14.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🐟</span></figure><div class=site-meta><h1 class=site-name><a href=/>小类随手记</a></h1><h2 class=site-description>just so so.</h2></div></header><ol class=menu-social><li><a href=https://github.com/joyanhui/dev.leiyanhui.com-src target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>列表</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>站内搜索</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>links</span></a></li><li><a href=/contact/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>contact</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#下载官网稳定版固件>下载官网稳定版固件</a></li><li><a href=#刷入硬盘>刷入硬盘</a></li><li><a href=#什么都不要动-直接去开机>什么都不要动 直接去开机</a></li><li><a href=#启动openwrt>启动openwrt</a></li><li><a href=#shell登录openwrt>shell登录openwrt</a></li><li><a href=#准备安装软件>准备安装软件</a><ol><li><a href=#修改国内源此步骤可以省略>修改国内源（此步骤可以省略）</a></li></ol></li><li><a href=#安装常用的磁盘工具>安装常用的磁盘工具</a></li><li><a href=#安装网页中文汉化包和主题此步骤可以省略>安装网页中文汉化包和主题（此步骤可以省略）</a></li><li><a href=#开始之前-linux的磁盘管理的入门扫盲小知识>开始之前 linux的磁盘管理的入门扫盲小知识</a></li><li><a href=#处理分区和磁盘>处理分区和磁盘</a></li><li><a href=#格式化这个新分区>格式化这个新分区</a></li><li><a href=#不要关闭shell回到openwrt网页端处理挂载>不要关闭shell，回到openwrt网页端处理挂载</a></li><li><a href=#重启检查>重启检查</a></li><li><a href=#后续--安装常用插件>后续- 安装常用插件</a></li><li><a href=#最后写在结尾的话>最后写在结尾的话</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/openwrt/>Openwrt</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/openwrt/disk-part-bug/>openwrt分区扩容的问题---多数openwrt固件的一个巨坑 保姆教程/ 顺带 linux和openwrt 扫盲 /常用扩展插件安装</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2022-11-24</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 4 分钟</time></div></footer></div></header><section class=article-content><p>今天第一次弄x86的openwrt，遇到分区扩容的一个坑。网上太多太多的资料 都是坑。</p><p>原因是原版的openwrt 有一个挂载的覆盖的bug，多数固件并未解决。我一开始用squashfs的固件，都没有搞定，最后换到ext4 解决。前后折腾2个多小时。
具体可以参考：https://github.com/openwrt/openwrt/issues/7352</p><p>然后下午在群里，发现有人手把手教别人弄，最后还是出现和我一样的问题。</p><blockquote><p>df -h 查看容量正常，但是网页端 software查看容量 并没有增加。装软件也会提示容量不足</p></blockquote><p>我的解决办法 就是用ext4模式安装，我用的官网的ext4固件。因为我设备是x86 并且没有很特殊的硬件，官网固件都是可以驱动的（N2600显卡除外，非efi模式启动黑屏）</p><p>如果你也和我一样 是x86的路由，那么强烈建议你用最精简的官网固件,原因</p><ul><li>第三方固件，不安全，虽然说都号称没有后门，但是你有时间和精力 或者有能力去查找后门嘛？</li><li>鉴于openwrt这个圈子的特殊性，与其相信第三方固件作者是用爱发电，我更多相信他是一个半吊子菜鸟一时的热忱</li><li>但openwrt圈内也确实有一些 完全开源甚至编译过程都开源的第三方固件，但是我们没有那么多时间去甄别，更没有那么多时间和经历 去折腾试用</li><li>openwrt 是一个完整的linux系统，官网固件只要能开机，能识别你的有线网卡，或者usb口，哪怕只能识别显示屏，那么剩下的都可以解决</li><li>openwrt 本身是一个很强壮 稳定高性能的 路由器系统，所有的问题 都出在第三方固件作者和 第三方插件上！！！看看那些第三方固件作者的声明</li><li>第三方作者的水平层次不齐，甚至论坛上下载过万的固件 哪怕他最精简的版本bug多到都无法完成最基本的路由功能！</li><li>当然，如果你网卡不识别，并且还是linux小白，又不想学习，那么就冒险试用第三方，或者付费找人编译吧。能用钱和安全解决的 问题，都不是问题 哈哈。</li><li>如果有时间又能力去编译自定义固件，那么这个文章和这个观点也不适合你，自己忽略就好了。</li></ul><p>今天群里还有人问 官网地址。。。<code> www.openwrt.org</code></p><h2 id=下载官网稳定版固件>下载官网稳定版固件</h2><p>下载地址： <a class=link href=https://archive.openwrt.org/releases/ target=_blank rel=noopener>https://archive.openwrt.org/releases/</a>
选择版本 再选择 cpu平台 就可以了。我这里是x86 64位的 cpu，所以 依次点击 22.03.2 -> targets -> x86 -> 64 ，然后选择 generic-ext4-combined.img.gz 这个ext4分区的</p><p>如果你机器只支持efi启动不支持传统bois启动，那就选generic-ext4-combined-efi.img.gz，如果同时支持，那么还是建议无脑选这个。如果你情况特殊非要用efi 那就选择 generic-ext4-combined-efi.img.gz 这个</p><p>很多第三方固件是 squashfs-combined 的，如果制作者没有处理overlay的bug，那么肯定会遇到挂载问题，网上有资料说可以通过删除/etc 目录的方法来解决，但是我试过也不行。</p><p>还有群友说看不懂英文的官网。。那么你就直接点我下面地址下载好了</p><p>我最终选中的固件是截至目前最新的稳定版：https://archive.openwrt.org/releases/22.03.2/targets/x86/64/openwrt-22.03.2-x86-64-generic-ext4-combined.img.gz</p><p>下载后 解压，不会解压或者你的解压工具出错，那么就直接用 winrar 解压他。 解压后是一个img文件</p><h2 id=刷入硬盘>刷入硬盘</h2><p>如果你原来是squashfs 那么是无法从op的网页后台升级刷入ext4的固件的，需要重新硬刷。</p><p>一般建议 是 吧上面的<code>openwrt-22.03.2-x86-64-generic-ext4-combined.img.gz</code> 解压后，从winpe下，或者linux live下 或者干脆把 硬盘挂到另外一个电脑，用<code>balenaEtcher</code> 或DD命令等 写盘工具写入到对应的磁盘</p><p>这个经常折腾系统的，都会，就不用细说了。 不会刷的，就自己搜一下balenaEtcher 的教程，基本就是 选择磁盘文件*.img 选择磁盘，写入 等待写入 等待校验 ，就完事了。</p><h2 id=什么都不要动-直接去开机>什么都不要动 直接去开机</h2><p>网上很多教程，甚至是都一个文章抄出来的，说让你 在diskgen下调整分区，这个方法很不靠谱，且不说 diskgen对linux的分区支持不好，你可能压根操作不了，再说，diskgen可能会破坏UUID或者分区表兼容性，会导致 fstab和gurb出错。导致你的openwrt 压根启动不起来</p><p>linux下的文件系统，你尽量少用win下的软件去鼓捣。第三方的这些商业化软件 ，真的不靠谱。</p><p>所以 如果你调整不了 或 调整后启动不起来 那么是正常的。 不要用diskgen调整分区！！！ 不要用diskgen调整分区！！！不要用diskgen调整分区！！！</p><h2 id=启动openwrt>启动openwrt</h2><p>电脑接入openwrt，可以网线直接插上，也可以接入下属ap设备的wifi。自动获取ip，获取到 192.168.1.XX的就对了。
官网版本默认网页地址是： http://192.168.1.1 用户名 root 密码 空的</p><p>进入后，先拨号 联网，官网版本全英文界面 ，看不懂 自己手机翻译</p><p>点击 NetWork > Interfaces</p><p>编辑 edit wan口，接入方式 默认是dhcp 切换到 pppoe 会提示一次确认切换，然后输入 宽带用户密码，保存 应用保存(aplay save)</p><p>或者干脆直接接到 你现在的路由下dhcp自动获取ip，然后在现在的路由器 的dhcp列表里面找到他的ip然后用对应的ip 打开网页 以及登录shell
正常就可以拨号成功了。</p><h2 id=shell登录openwrt>shell登录openwrt</h2><p>如果用putty 或者 其他工具比如MobaXterm fineshell 等等，甚至 win10以上电脑的cmd都可以。这里以简单的cmd命令好为例,win10、win11 下 win+R 快捷键，运行 cmd
在 cmd 窗口输入
执行 <code>ssh root@192.168.1.1</code> 第一次登录 会处理key的问题，输入yes 确认， 因为现在密码是空的不用输入密码 就可以了登录了。</p><p>如果有提示known_hosts的错误，打开 <code>C:\Users\你的用户名\.ssh</code> 这个隐藏文件夹，删除 known_hosts 文件，或者记事本打开编辑一下删除对应的行。</p><p>后面多数操作都是基于shell下的openwrt 。虽然很多操作是可以在网页端完成的，只是点来点去麻烦</p><h2 id=准备安装软件>准备安装软件</h2><h3 id=修改国内源此步骤可以省略>修改国内源（此步骤可以省略）</h3><p>以修改清华源为例，执行以下命令sed正则替换downloads.openwrt.org为清华源的地址，如果你用其他源 找一下官网帮助，修改下面的命令就好</p><pre><code>sed -i 's_downloads.openwrt.org_mirrors.tuna.tsinghua.edu.cn/openwrt_' /etc/opkg/distfeeds.conf
</code></pre><p>或者你用<code>vim /etc/opkg/distfeeds.conf</code> 手动编辑也行。
执行完成后更新一次本地list，记得openwrt每次重启后，如果要安装软件，都需要在网页端更新一次list 或者 shell执行下面命令。这个是openwrt的机制，他把源的数据放内存去了。重启就就没有了。</p><pre><code>opkg update
</code></pre><h2 id=安装常用的磁盘工具>安装常用的磁盘工具</h2><p>op的官网版本 极度精简，精简到只有核心的基本功能，所以多数工具需要自己装。用过opwnwrt的都知道 ，约少的功能和插件，才越稳定。很多国内第三方固件，精简版，还要收费。。。真的 是坑小白。。。</p><pre><code>opkg install block-mount fdisk cfdisk  lsblk 
</code></pre><p>解释下opkg 是openwrt的包管理工具的安装,同其他linux发行版的 apk apt yum pacman 等命令一样道理 ，你可以理解成 Windows的 exe msi setup等可以直接双击安装的安装包</p><p>安装：<code>opkg install 在线软件包名称或者本地路径</code><br>卸载:先查看<code>opkg list_installed</code> 然后卸载<code>opkg remove 软件包名（上一步找到的名称）</code></p><ul><li>block-mount 是一个可以在openwrt网页端 操作挂载点的工具，这也是为什么你的openwrt菜单 系统下 没有挂载点这个按钮的原因 就是缺少这个包</li><li>fdisk 磁盘分区工具管理 同Windows下的fdisk 一样的</li><li>cfdisk 命令行可视化的磁盘分区工具，你可以理解为 这就是一个简化的linux版本 diskgen，或者fdisk的易用性工具</li><li>lsblk 磁盘分区和挂载点的一个查看工具</li></ul><p>上面的 cfdisk lsblk 甚至block-mount 都不是必须软件，但是为了简单使用，还是建议你参考我教程 都装上，这些软件也都很小</p><p>block-mount 安装完成后 需要重启一下 openwrt ，才可以在网页端的 系统菜单 找到 mount/挂载点 这个按钮</p><h2 id=安装网页中文汉化包和主题此步骤可以省略>安装网页中文汉化包和主题（此步骤可以省略）</h2><pre><code>opkg install  luci-i18n-base-zh-cn luci-theme-material
</code></pre><p>解释</p><ul><li>luci-i18n-base-zh-cn 是网页端的中文语言包</li><li>luci-theme-material 是一个左右分栏，并且兼容手机等设备的openwrt网页界面主题，也可以不装，随便你。</li></ul><p>中文语言包，虽然可以自动识别，但是部分软件 会显示中英文混杂的情况，所以最好 还是在 openwrt网页端的 system(系统) -> system(系统) -> lanuage and style(语言和主题) 选择一下 简体中文</p><p>主题 可以选择前面安装的 material，也可用默认的</p><h2 id=开始之前-linux的磁盘管理的入门扫盲小知识>开始之前 linux的磁盘管理的入门扫盲小知识</h2><p>window 我们都知道 有C盘D盘什么的，但是linux 不存在这个，Linux下 一切皆为文件，包括硬件设备的：内存 硬盘 usb 甚至显卡 等等，这些都是文件，对应的 都是 Linux下 /dev下的文件。
我们所有的硬件的操作，都是对 /dev下的文件的操作。</p><p>因为没有C D 盘符的概念，linux下完整的路径 都是以<code>/xxx</code> 开头的，而非Windows下 C:/ D:/ 这样开头的</p><p>我们都知道 Windows可以修改盘符，比如 我可以把D盘从windows磁盘管理里面 分别E给他，他就同时可以用D和E 两个盘符了，删掉D 就变成E。 linux下就是用挂载和解除挂载的方式来解决不同分区的路径变化。。</p><p>如果是临时的挂载，我们直接用 <code>mount /dev/【磁盘名称】【分区编号】 /【挂载地址】</code> 命令就可以了。如果是开机启动挂载，就需要修改/etc 目录的下的 fstab文件</p><p>/etc这个目录，你可以理解成 Windows 的注册表 组策略。 几乎所有的软件和系统的配置项 都在这个目录里面。</p><p>但是因为直接编辑 /etc/fstab 这个文本文件，需要处理uuid可能不太直观，而且可能还存在其他分区甚至U盘 sd卡等，所以我们在openwrt下借用 上面说的<code>block-mount</code> 这个软件包，可以可视化的在openwrt网页端来操作。后续管理u盘sd卡 或nas也方便</p><h2 id=处理分区和磁盘>处理分区和磁盘</h2><p>cmd再次登录到openwrt的shell下，执行命令 <code>fdisk -l</code> 查看磁盘</p><pre><code>root@OpenWrt:~# fdisk -l
Disk /dev/sda: 29.5 GiB, 31675383808 bytes, 61865984 sectors
Disk model: BIWIN SSD
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: C120D9F5-D6F9-D15B-05A7-0D348F8A4B00

Device       Start      End  Sectors  Size Type
/dev/sda1      512    33279    32768   16M Linux filesystem
/dev/sda2    33280   246271   212992  104M Linux filesystem
/dev/sda128     34      511      478  239K BIOS boot

Partition table entries are not in disk order.
</code></pre><p>我这里 就一个磁盘 磁盘名称是 sda<code>Disk /dev/sda: 29.5 GiB</code>，有三个分区 sda1 sda2 sda128</p><ul><li>sda1 是他的基本启动文件</li><li>sda2 就是openwrt的系统分区，如果是overlay的openwrt固件情况还要复杂一些，如果你要用overlay,不妨去看一下overlay相关的文章。我这里是ext4的固件，所以简单很多。
如果你是efi的镜像，可能还多出来一个efi分区。</li></ul><p>如果你要有多个磁盘，注意看 每一个磁盘的名字 还有 磁盘的编号。如果是nvme 磁盘的换，多数是<code>/dev/nvmeXXX</code> mmc磁盘的话<code>/dev/mmcXXX</code> 虚拟机的话根据虚拟平台不一样可能是<code>/dev/vdXXXX</code> <code>/dev/vmXXX</code> <code>/dev/virXXX</code> <code>/dev/qemuXXX</code> u盘或者sd卡的话，那么多数就usb 或者 sd开头的</p><p>我们现在需要增加容量的磁盘上扩建空间，我这里 以我的/dev/sda 这个磁盘为例子，shell命令再次执行<code>cfdisk /dev/sda</code>（ 空格后面 指的要操作的磁盘 ）</p><p>用键盘方向键操作，上下键盘，选择中绿色的部分 free space （空闲空间） 左右键 选择 New（新建）回车，输入新分区的容量。 你可以弄一个1-2G的给系统用，剩下一点分区给docker用（挂载到/opt）或者干脆简单简单的 全部空间 给到系统</p><p>然后 会新建一个分区 /dev/sdaXXX 我 这里是/dev/sda3, 然后左右键 选择 保存（write）输入 <code>yes</code>确认 左右键选择退出（quit）</p><p>这样我们就新建了一个分区</p><h2 id=格式化这个新分区>格式化这个新分区</h2><p>Windows下格式化命令 我们都知道 是format，Linux下用 mkfs.XXX, Linux常用的分区很多种，这里不展开说，但是这里肯定适合用NTFS exfat fat之类，不是说不能用，而是说稳定性和速度在linux下表现不好，
所以还是用linux的常用分区格式，我这里用传统的ext4 兼容性和稳定最好</p><pre><code>mkfs.ext4  /dev/sda3
</code></pre><h2 id=不要关闭shell回到openwrt网页端处理挂载>不要关闭shell，回到openwrt网页端处理挂载</h2><p>点 系统> 挂载点 <code>生成配置</code> 自动生成配置</p><p>在挂载点那个位置，可以看到 多出来的一个分区/dev/sda3 他想自动挂载到/mnt/sda3上，我们编辑一下这条</p><p>UUID 保持是这个分区的没错 我这里是<code>xx-xx-xx /dev/sda3 29.38G</code></p><p>挂载点选择 <code>/ 作为根目录使用</code></p><p>然后看一下这行地方有一个提示<code> 根目录准备，确保使用以下命令来复制根文件系统</code>，后面几行命令，其中一行 <code>mount /dev/sda1 /tmp/extroot</code></p><p>这个地方 他的实例是处理的/dev/sda1 第一分区，需要改为你刚刚新建的分区 我这是<code>/dev/sda3</code>，最终命令和解释</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mkdir -p /tmp/introot  #创建一个文件夹
</span></span><span class=line><span class=cl>mkdir -p /tmp/extroot #创建一个文件夹
</span></span><span class=line><span class=cl>mount --bind / /tmp/introot # 用临时屏蔽的方法 挂载/ 到introot这个目录 方便我们后面复制
</span></span><span class=line><span class=cl>mount /dev/sda3 /tmp/extroot  # 这行需要编辑一下  把我们的新建的分区 临时挂载到extroot
</span></span><span class=line><span class=cl>tar -C /tmp/introot -cvf - . | tar -C /tmp/extroot -xf -  # 用tar的方式，把原来根分区的 文件 保留权限同步复制到extroot（/dev/sda3 就是新分区） 并打印出详细信息和进度
</span></span><span class=line><span class=cl>umount /tmp/introot # 取消挂载
</span></span><span class=line><span class=cl>umount /tmp/extroot # 取消挂载
</span></span></code></pre></td></tr></table></div></div><p>先在网页的 保存挂载点的配置，然后删除 和sda2 之前的那个100M左右的分区的挂载。 然后应用保存。
再把上面的命令逐行 或者全部复制到 openwrt的shell 里面 执行</p><p>注意顺序别搞错了。</p><h2 id=重启检查>重启检查</h2><p>重启路由器，启动完成后检查 shell运行<code>df -h</code></p><pre><code>root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root               102.3M     20.5M     79.7M  20% /rom
tmpfs                     1.9G    572.0K      1.9G   0% /tmp
/dev/sda3                28.8G    348.8M     26.9G   1% /
/dev/sda1                16.0M      5.7M     10.2M  36% /boot
/dev/sda1                16.0M      5.7M     10.2M  36% /boot
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/sda3                28.8G    348.8M     26.9G   1% /opt/docker
</code></pre><p>shell运行<code>lsblk</code></p><pre><code>root@OpenWrt:~# lsblk
NAME     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda        8:0    0 29.5G  0 disk
├─sda1     8:1    0   16M  0 part /boot
│                                 /boot
├─sda2     8:2    0  104M  0 part /rom
├─sda3     8:3    0 29.4G  0 part /opt/docker
│                                 /
└─sda128 259:0    0  239K  0 part
</code></pre><p>网页端依次点开 系统 Software 查看 Free space 30G 左右</p><p>这就正常了</p><h2 id=后续--安装常用插件>后续- 安装常用插件</h2><p>能用docker跑的，尽量用docker，能放到旁路路由的尽量不要放主路由</p><p>安装方法和清单 <a class=link href=https://dev.leiyanhui.com/openwrt/openwrt-plus/ target=_blank rel=noopener>https://dev.leiyanhui.com/openwrt/openwrt-plus/</a></p><h2 id=最后写在结尾的话>最后写在结尾的话</h2><p>openwrt这个国内圈子有一点畸形，做固件的也不是什么大神，更多是一些linux一知半解的小白的做，可能比完全不懂linux的你好不到哪里去。甚至还有收费的第三方定制固件，甚至还有x86的精简固件收费。。有点匪夷所思。</p><p>openwrt群里，还一些人自己可以编译固件 沾沾自喜自诩为大神 甚至收费。。</p><p>其实 openwrt 是一个完整的linux系统，只是官网没有出iso安装镜像，而且img格式的磁盘镜像。 大部分内容你甚至可以直接挂载img文件编辑后写入磁盘。。。</p><p>最后，openwrt本身很强壮很稳定， 不稳定的是第三方插件。</p><p>所以能不用第三方固件 就不要用，能用精简版 就不要用什么高大全，能修改img文件搞定的事情，就不要自己编译固件。折腾。</p><p>如果是x86_64 尽量用ext4的方法安装，系统如果损坏有资料需要导出或者文件误删除 都好处理。overlay 系统恢复初始化简单一些。但是扩容这个地方需要自己编译固件，或者用第三方已经处理好的固件来弄。
完整编译一次固件，看网络和机器性能 差不多需要2-4小时时间，得不偿失。。</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/c/adguardhome-rules/><div class=article-details><h2 class=article-title>adguard home单实例自动更新分流规则</h2></div></a></article><article><a href=/openwrt/replacebypass/><div class=article-details><h2 class=article-title>旁路由-主路由自动替代旁路由的自动切换方案</h2></div></a></article><article><a href=/route/mosdns-all-in-one/><div class=article-details><h2 class=article-title>mosdns all in one 分流加自定义解析，不依赖 AdGuardHome</h2></div></a></article><article><a href=/cloudflare/vless/><div class=article-details><h2 class=article-title>利用cfwokr免费搭建自己的节点</h2></div></a></article><article><a href=/route/clash-new/><div class=article-details><h2 class=article-title>clash删库事件发生后的替代方案</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//xiao-lei-sui-shou-ji.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 小类随手记</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>