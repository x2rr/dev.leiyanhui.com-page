<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="尝试在 单网口的 all in one 主机上 使用kvm运行 openwrt 实现替代一个x86软路由的方案。 为什么 要吧路由器放到 aio主机上，是因为想节省一台设备 避免维护复杂化。 为了避免 all in boom，单独找了一个闲置小米路由，配置好dhcp静态分配和ppoe 作为备用路由器。\n硬件设备：\n光猫 桥接模式 硬路由 k2p 信号不错，但是性能不够，所以做AP模式 交换机 4口万兆 8口千兆 16口poe交换机 和监控若干 组装机一台 24小时开机，qnct魔改U 8代4核，64G内存 pio主板 带一个pice口 单网卡 nvme硬盘512G 机械盘 4块 加起来 5T 软件情况： 硬路由 k2p 刷 Padavan all in one主机，自己做的 ventoy+ archlinux+docker+kvm系统 https://dev.leiyanhui.com/all-in-one/arch-aio/\nall in one系统情况：\n主要跑三个系统 win archlinux/kde（kvm） 直通macos win主要做rdp转发和游戏串流 日用 archlinux 编译适合主机的openwrt 核心软件包 1 autocore-x86 automount base-files bash block-mount busybox ca-bundle coremark curl dnsmasq-full dropbear ds-lite e2fsprogs fdisk firewall fstools grub2-bios-setup htop kmod-8139cp kmod-8139too kmod-alx kmod-amazon-ena kmod-amd-xgbe kmod-bnx2 kmod-bnx2x kmod-button-hotplug kmod-drm-amdgpu kmod-drm-i915 kmod-e1000 kmod-e1000e kmod-forcedeth kmod-fs-vfat kmod-i40e kmod-iavf kmod-igb kmod-igbvf kmod-igc kmod-ipt-nat kmod-ipt-nat6 kmod-ixgbe kmod-lib-zstd kmod-mlx4-core kmod-mlx5-core kmod-mmc kmod-pcnet32 kmod-phy-broadcom kmod-r8125 kmod-r8168 kmod-sdhci kmod-tcp-bbr kmod-tg3 kmod-tulip kmod-usb-hid kmod-vmxnet3 libc libgcc libustream-wolfssl lm-sensors-detect logd lsblk luci-app-advanced luci-app-autoreboot luci-app-firewall luci-app-gpsysupgrade luci-app-opkg luci-app-upnp luci-app-wizard luci-base luci-compat luci-lib-fs luci-lib-ipkg mkf2fs mtd nano netifd odhcp6c odhcpd-ipv6only openssh-sftp-server opkg partx-utils pciutils ppp ppp-mod-pppoe procd procd-seccomp resolveip swconfig uci uclient-fetch urandom-seed urngd usbutils wget-ssl zram-swap 附加软件包 1 luci-app-socat luci-app-ipsec-vpnd luci-app-ddns luci-app-diskman luci-app-ksmbd luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config 去掉了docker 和alist等 增加了 openclash\n"><title>openwrt 定制版本 我自用的版本- kvm版本</title><link rel=canonical href=https://dev.leiyanhui.com/openwrt/kvm-my/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="openwrt 定制版本 我自用的版本- kvm版本"><meta property='og:description' content="尝试在 单网口的 all in one 主机上 使用kvm运行 openwrt 实现替代一个x86软路由的方案。 为什么 要吧路由器放到 aio主机上，是因为想节省一台设备 避免维护复杂化。 为了避免 all in boom，单独找了一个闲置小米路由，配置好dhcp静态分配和ppoe 作为备用路由器。\n硬件设备：\n光猫 桥接模式 硬路由 k2p 信号不错，但是性能不够，所以做AP模式 交换机 4口万兆 8口千兆 16口poe交换机 和监控若干 组装机一台 24小时开机，qnct魔改U 8代4核，64G内存 pio主板 带一个pice口 单网卡 nvme硬盘512G 机械盘 4块 加起来 5T 软件情况： 硬路由 k2p 刷 Padavan all in one主机，自己做的 ventoy+ archlinux+docker+kvm系统 https://dev.leiyanhui.com/all-in-one/arch-aio/\nall in one系统情况：\n主要跑三个系统 win archlinux/kde（kvm） 直通macos win主要做rdp转发和游戏串流 日用 archlinux 编译适合主机的openwrt 核心软件包 1 autocore-x86 automount base-files bash block-mount busybox ca-bundle coremark curl dnsmasq-full dropbear ds-lite e2fsprogs fdisk firewall fstools grub2-bios-setup htop kmod-8139cp kmod-8139too kmod-alx kmod-amazon-ena kmod-amd-xgbe kmod-bnx2 kmod-bnx2x kmod-button-hotplug kmod-drm-amdgpu kmod-drm-i915 kmod-e1000 kmod-e1000e kmod-forcedeth kmod-fs-vfat kmod-i40e kmod-iavf kmod-igb kmod-igbvf kmod-igc kmod-ipt-nat kmod-ipt-nat6 kmod-ixgbe kmod-lib-zstd kmod-mlx4-core kmod-mlx5-core kmod-mmc kmod-pcnet32 kmod-phy-broadcom kmod-r8125 kmod-r8168 kmod-sdhci kmod-tcp-bbr kmod-tg3 kmod-tulip kmod-usb-hid kmod-vmxnet3 libc libgcc libustream-wolfssl lm-sensors-detect logd lsblk luci-app-advanced luci-app-autoreboot luci-app-firewall luci-app-gpsysupgrade luci-app-opkg luci-app-upnp luci-app-wizard luci-base luci-compat luci-lib-fs luci-lib-ipkg mkf2fs mtd nano netifd odhcp6c odhcpd-ipv6only openssh-sftp-server opkg partx-utils pciutils ppp ppp-mod-pppoe procd procd-seccomp resolveip swconfig uci uclient-fetch urandom-seed urngd usbutils wget-ssl zram-swap 附加软件包 1 luci-app-socat luci-app-ipsec-vpnd luci-app-ddns luci-app-diskman luci-app-ksmbd luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config 去掉了docker 和alist等 增加了 openclash\n"><meta property='og:url' content='https://dev.leiyanhui.com/openwrt/kvm-my/'><meta property='og:site_name' content='小类随手记'><meta property='og:type' content='article'><meta property='article:section' content='Openwrt'><meta property='article:published_time' content='2023-01-24T02:12:20+08:00'><meta property='article:modified_time' content='2023-01-24T02:12:20+08:00'><meta name=twitter:title content="openwrt 定制版本 我自用的版本- kvm版本"><meta name=twitter:description content="尝试在 单网口的 all in one 主机上 使用kvm运行 openwrt 实现替代一个x86软路由的方案。 为什么 要吧路由器放到 aio主机上，是因为想节省一台设备 避免维护复杂化。 为了避免 all in boom，单独找了一个闲置小米路由，配置好dhcp静态分配和ppoe 作为备用路由器。\n硬件设备：\n光猫 桥接模式 硬路由 k2p 信号不错，但是性能不够，所以做AP模式 交换机 4口万兆 8口千兆 16口poe交换机 和监控若干 组装机一台 24小时开机，qnct魔改U 8代4核，64G内存 pio主板 带一个pice口 单网卡 nvme硬盘512G 机械盘 4块 加起来 5T 软件情况： 硬路由 k2p 刷 Padavan all in one主机，自己做的 ventoy+ archlinux+docker+kvm系统 https://dev.leiyanhui.com/all-in-one/arch-aio/\nall in one系统情况：\n主要跑三个系统 win archlinux/kde（kvm） 直通macos win主要做rdp转发和游戏串流 日用 archlinux 编译适合主机的openwrt 核心软件包 1 autocore-x86 automount base-files bash block-mount busybox ca-bundle coremark curl dnsmasq-full dropbear ds-lite e2fsprogs fdisk firewall fstools grub2-bios-setup htop kmod-8139cp kmod-8139too kmod-alx kmod-amazon-ena kmod-amd-xgbe kmod-bnx2 kmod-bnx2x kmod-button-hotplug kmod-drm-amdgpu kmod-drm-i915 kmod-e1000 kmod-e1000e kmod-forcedeth kmod-fs-vfat kmod-i40e kmod-iavf kmod-igb kmod-igbvf kmod-igc kmod-ipt-nat kmod-ipt-nat6 kmod-ixgbe kmod-lib-zstd kmod-mlx4-core kmod-mlx5-core kmod-mmc kmod-pcnet32 kmod-phy-broadcom kmod-r8125 kmod-r8168 kmod-sdhci kmod-tcp-bbr kmod-tg3 kmod-tulip kmod-usb-hid kmod-vmxnet3 libc libgcc libustream-wolfssl lm-sensors-detect logd lsblk luci-app-advanced luci-app-autoreboot luci-app-firewall luci-app-gpsysupgrade luci-app-opkg luci-app-upnp luci-app-wizard luci-base luci-compat luci-lib-fs luci-lib-ipkg mkf2fs mtd nano netifd odhcp6c odhcpd-ipv6only openssh-sftp-server opkg partx-utils pciutils ppp ppp-mod-pppoe procd procd-seccomp resolveip swconfig uci uclient-fetch urandom-seed urngd usbutils wget-ssl zram-swap 附加软件包 1 luci-app-socat luci-app-ipsec-vpnd luci-app-ddns luci-app-diskman luci-app-ksmbd luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config 去掉了docker 和alist等 增加了 openclash\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_6049d840d4e2d14.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🐟</span></figure><div class=site-meta><h1 class=site-name><a href=/>小类随手记</a></h1><h2 class=site-description>just so so.</h2></div></header><ol class=menu-social><li><a href=https://github.com/joyanhui/dev.leiyanhui.com-src target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>列表</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>站内搜索</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>links</span></a></li><li><a href=/contact/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>contact</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#编译适合主机的openwrt>编译适合主机的openwrt</a><ol><li><a href=#核心软件包>核心软件包</a></li><li><a href=#附加软件包>附加软件包</a></li><li><a href=#其他配置>其他配置</a></li></ol></li><li><a href=#创建op虚拟主机>创建op虚拟主机</a></li><li><a href=#更改物理布局>更改物理布局</a><ol><li><a href=#后续>后续</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/openwrt/>Openwrt</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/openwrt/kvm-my/>openwrt 定制版本 我自用的版本- kvm版本</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2023-01-24</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 2 分钟</time></div></footer></div></header><section class=article-content><p>尝试在 单网口的 all in one 主机上 使用kvm运行 openwrt 实现替代一个x86软路由的方案。<br>为什么 要吧路由器放到 aio主机上，是因为想节省一台设备 避免维护复杂化。 为了避免 all in boom，单独找了一个闲置小米路由，配置好dhcp静态分配和ppoe 作为备用路由器。</p><p>硬件设备：</p><ul><li>光猫 桥接模式</li><li>硬路由 k2p 信号不错，但是性能不够，所以做AP模式</li><li>交换机 4口万兆 8口千兆</li><li>16口poe交换机 和监控若干</li><li>组装机一台 24小时开机，qnct魔改U 8代4核，64G内存 pio主板 带一个pice口 单网卡 nvme硬盘512G 机械盘 4块 加起来 5T
软件情况：</li><li>硬路由 k2p 刷 Padavan</li><li>all in one主机，自己做的 ventoy+ archlinux+docker+kvm系统 <a class=link href=https://dev.leiyanhui.com/all-in-one/arch-aio/ target=_blank rel=noopener>https://dev.leiyanhui.com/all-in-one/arch-aio/</a><br>all in one系统情况：<br>主要跑三个系统 win archlinux/kde（kvm） 直通macos win主要做rdp转发和游戏串流 日用 archlinux</li></ul><h2 id=编译适合主机的openwrt>编译适合主机的openwrt</h2><h3 id=核心软件包>核心软件包</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>autocore</span><span class=o>-</span><span class=n>x86</span> <span class=n>automount</span> <span class=n>base</span><span class=o>-</span><span class=n>files</span> <span class=n>bash</span> <span class=n>block</span><span class=o>-</span><span class=n>mount</span> <span class=n>busybox</span> <span class=n>ca</span><span class=o>-</span><span class=n>bundle</span> <span class=n>coremark</span> <span class=n>curl</span> <span class=n>dnsmasq</span><span class=o>-</span><span class=n>full</span> <span class=n>dropbear</span> <span class=n>ds</span><span class=o>-</span><span class=n>lite</span> <span class=n>e2fsprogs</span> <span class=n>fdisk</span> <span class=n>firewall</span> <span class=n>fstools</span> <span class=n>grub2</span><span class=o>-</span><span class=n>bios</span><span class=o>-</span><span class=n>setup</span> <span class=n>htop</span> <span class=n>kmod</span><span class=o>-</span><span class=mi>8139</span><span class=n>cp</span> <span class=n>kmod</span><span class=o>-</span><span class=mi>8139</span><span class=n>too</span> <span class=n>kmod</span><span class=o>-</span><span class=n>alx</span> <span class=n>kmod</span><span class=o>-</span><span class=n>amazon</span><span class=o>-</span><span class=n>ena</span> <span class=n>kmod</span><span class=o>-</span><span class=n>amd</span><span class=o>-</span><span class=n>xgbe</span> <span class=n>kmod</span><span class=o>-</span><span class=n>bnx2</span> <span class=n>kmod</span><span class=o>-</span><span class=n>bnx2x</span> <span class=n>kmod</span><span class=o>-</span><span class=n>button</span><span class=o>-</span><span class=n>hotplug</span> <span class=n>kmod</span><span class=o>-</span><span class=n>drm</span><span class=o>-</span><span class=n>amdgpu</span> <span class=n>kmod</span><span class=o>-</span><span class=n>drm</span><span class=o>-</span><span class=n>i915</span> <span class=n>kmod</span><span class=o>-</span><span class=n>e1000</span> <span class=n>kmod</span><span class=o>-</span><span class=n>e1000e</span> <span class=n>kmod</span><span class=o>-</span><span class=n>forcedeth</span> <span class=n>kmod</span><span class=o>-</span><span class=n>fs</span><span class=o>-</span><span class=n>vfat</span> <span class=n>kmod</span><span class=o>-</span><span class=n>i40e</span> <span class=n>kmod</span><span class=o>-</span><span class=n>iavf</span> <span class=n>kmod</span><span class=o>-</span><span class=n>igb</span> <span class=n>kmod</span><span class=o>-</span><span class=n>igbvf</span> <span class=n>kmod</span><span class=o>-</span><span class=n>igc</span> <span class=n>kmod</span><span class=o>-</span><span class=n>ipt</span><span class=o>-</span><span class=n>nat</span> <span class=n>kmod</span><span class=o>-</span><span class=n>ipt</span><span class=o>-</span><span class=n>nat6</span> <span class=n>kmod</span><span class=o>-</span><span class=n>ixgbe</span> <span class=n>kmod</span><span class=o>-</span><span class=n>lib</span><span class=o>-</span><span class=n>zstd</span> <span class=n>kmod</span><span class=o>-</span><span class=n>mlx4</span><span class=o>-</span><span class=n>core</span> <span class=n>kmod</span><span class=o>-</span><span class=n>mlx5</span><span class=o>-</span><span class=n>core</span> <span class=n>kmod</span><span class=o>-</span><span class=n>mmc</span> <span class=n>kmod</span><span class=o>-</span><span class=n>pcnet32</span> <span class=n>kmod</span><span class=o>-</span><span class=n>phy</span><span class=o>-</span><span class=n>broadcom</span> <span class=n>kmod</span><span class=o>-</span><span class=n>r8125</span> <span class=n>kmod</span><span class=o>-</span><span class=n>r8168</span> <span class=n>kmod</span><span class=o>-</span><span class=n>sdhci</span> <span class=n>kmod</span><span class=o>-</span><span class=n>tcp</span><span class=o>-</span><span class=n>bbr</span> <span class=n>kmod</span><span class=o>-</span><span class=n>tg3</span> <span class=n>kmod</span><span class=o>-</span><span class=n>tulip</span> <span class=n>kmod</span><span class=o>-</span><span class=n>usb</span><span class=o>-</span><span class=n>hid</span> <span class=n>kmod</span><span class=o>-</span><span class=n>vmxnet3</span> <span class=n>libc</span> <span class=n>libgcc</span> <span class=n>libustream</span><span class=o>-</span><span class=n>wolfssl</span> <span class=n>lm</span><span class=o>-</span><span class=n>sensors</span><span class=o>-</span><span class=n>detect</span> <span class=n>logd</span> <span class=n>lsblk</span> <span class=n>luci</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>advanced</span> <span class=n>luci</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>autoreboot</span> <span class=n>luci</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>firewall</span> <span class=n>luci</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>gpsysupgrade</span> <span class=n>luci</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>opkg</span> <span class=n>luci</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>upnp</span> <span class=n>luci</span><span class=o>-</span><span class=n>app</span><span class=o>-</span><span class=n>wizard</span> <span class=n>luci</span><span class=o>-</span><span class=n>base</span> <span class=n>luci</span><span class=o>-</span><span class=n>compat</span> <span class=n>luci</span><span class=o>-</span><span class=n>lib</span><span class=o>-</span><span class=n>fs</span> <span class=n>luci</span><span class=o>-</span><span class=n>lib</span><span class=o>-</span><span class=n>ipkg</span> <span class=n>mkf2fs</span> <span class=n>mtd</span> <span class=n>nano</span> <span class=n>netifd</span> <span class=n>odhcp6c</span> <span class=n>odhcpd</span><span class=o>-</span><span class=n>ipv6only</span> <span class=n>openssh</span><span class=o>-</span><span class=n>sftp</span><span class=o>-</span><span class=n>server</span> <span class=n>opkg</span> <span class=n>partx</span><span class=o>-</span><span class=n>utils</span> <span class=n>pciutils</span> <span class=n>ppp</span> <span class=n>ppp</span><span class=o>-</span><span class=n>mod</span><span class=o>-</span><span class=n>pppoe</span> <span class=n>procd</span> <span class=n>procd</span><span class=o>-</span><span class=n>seccomp</span> <span class=n>resolveip</span> <span class=n>swconfig</span> <span class=n>uci</span> <span class=n>uclient</span><span class=o>-</span><span class=n>fetch</span> <span class=n>urandom</span><span class=o>-</span><span class=nb>seed</span> <span class=n>urngd</span> <span class=n>usbutils</span> <span class=n>wget</span><span class=o>-</span><span class=n>ssl</span> <span class=n>zram</span><span class=o>-</span><span class=n>swap</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=附加软件包>附加软件包</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>luci-app-socat luci-app-ipsec-vpnd  luci-app-ddns luci-app-diskman luci-app-ksmbd  luci-app-ttyd luci-app-vlmcsd luci-app-watchcat luci-app-argon-config 
</span></span></code></pre></td></tr></table></div></div><p>去掉了docker 和alist等 增加了 openclash</p><h3 id=其他配置>其他配置</h3><ul><li>内置ppoe帐号</li><li>ip 改为 10.1.0.1</li><li>初始密码： <code>dev.leiyanhui.com</code></li><li>主机名称 kvm-op</li><li>根目录(Overlay)容量(M) : 512M 因为不打算用他跑太多东西了。所以512M足够了。</li></ul><h2 id=创建op虚拟主机>创建op虚拟主机</h2><p>12核 512M内存。
cd /home/yanhui/mnt/nvme/vdisk/
qemu-img convert -p -f ram -O qcow2 openwrt-01.24.2023-x86-64-generic-squashfs-combined.img op.qcow2</p><p>创建 虚拟主机 12核 1G内存。 注意要另外添加一个虚拟网卡给这个虚拟机。都是走桥接，arch-aio 桥接问题看 <a class=link href=https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/ target=_blank rel=noopener>https://dev.leiyanhui.com/all-in-one/arch-aio-use-bridge-network/</a></p><h2 id=更改物理布局>更改物理布局</h2><p>光猫 -> 交换机 -> arch-aio主机 去掉 原来的n2600的op</p><h3 id=后续>后续</h3><p>可能会尝试 用docker来跑 openwrt 作为主路由</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/c/adguardhome-rules/><div class=article-details><h2 class=article-title>adguard home单实例自动更新分流规则</h2></div></a></article><article><a href=/openwrt/replacebypass/><div class=article-details><h2 class=article-title>旁路由-主路由自动替代旁路由的自动切换方案</h2></div></a></article><article><a href=/route/mosdns-all-in-one/><div class=article-details><h2 class=article-title>mosdns all in one 分流加自定义解析，不依赖 AdGuardHome</h2></div></a></article><article><a href=/cloudflare/vless/><div class=article-details><h2 class=article-title>利用cfwokr免费搭建自己的节点</h2></div></a></article><article><a href=/route/clash-new/><div class=article-details><h2 class=article-title>clash删库事件发生后的替代方案</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//xiao-lei-sui-shou-ji.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 小类随手记</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>